<rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>
<![CDATA[Hacker News - Small Sites - Score >= 50]]>
        </title>
        <description>
<![CDATA[Hacker News stories from domains that aren't in the top 1M and that have a score of at least 50. Updated nightly via https://github.com/awendland/hacker-news-small-sites]]>
        </description>
        <link>https://news.ycombinator.com</link>
        <generator>RSS for Node</generator>
        <lastBuildDate>Tue, 27 Oct 2020 12:38:45 GMT</lastBuildDate>
        <atom:link href="https://raw.githubusercontent.com/awendland/hacker-news-small-sites/generated/feeds/hn-small-sites-score-50.xml" rel="self" type="application/rss+xml"></atom:link>
        <pubDate>Tue, 27 Oct 2020 12:38:45 GMT</pubDate>
        <language>
<![CDATA[en-US]]>
        </language>
        <managingEditor>
<![CDATA[me@alexwendland.com (Alex Wendland)]]>
        </managingEditor>
        <ttl>240</ttl>
        <item>
            <title>
<![CDATA[My toothbrush streams gyroscope data]]>
            </title>
            <description>
<![CDATA[
Score 140 | Comments 81 (<a href="https://news.ycombinator.com/item?id=24881729">thread link</a>) | @zdw
<br/>
October 24, 2020 | https://blog.johannes-mittendorfer.com/artikel/2020/10/my-toothbrush-streams-gyroscope-data | <a href="https://web.archive.org/web/*/https://blog.johannes-mittendorfer.com/artikel/2020/10/my-toothbrush-streams-gyroscope-data">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div itemprop="articleBody">
            <p>Since a few month I own an electrical toothbrush from Phillips called <a href="https://www.google.com/search?q=Sonicare+HX992B">Sonicare HX992B</a>. It connects to <a href="https://play.google.com/store/apps/details?id=com.philips.cdp.ohc.tuscany" title="App">an mobile App</a> using Bluetooth that tells you how well you brushed your teeth, shows the orientation in real-time, and also notifies you when to change the brush for a new one.</p>
            <p><img src="https://blog.johannes-mittendorfer.com/assets/img/sonicare-image.jpeg" alt="Phillips Sonicare"></p>
            <p>I was curious how this exactly works. Since the application uses Bluetooth Low Energy (BLE), I used the <a href="https://play.google.com/store/apps/details?id=no.nordicsemi.android.mcp">nRF Connect</a> app for Android to get a list of advertised services.</p>
            <p><img src="https://blog.johannes-mittendorfer.com/assets/img/whatsapp-image-2020-10-09-at-19-34-24.jpeg" alt="Screenshot of nRF connect" title="Screenshot of nRF connect"></p>
            <p>Now I had a list of 12 BLE services of which only four are <a href="https://www.bluetooth.com/de/specifications/gatt/" title="List of common services">standard services described on bluetooth.com</a>. In addition to well-known services like Generic Access, Generic Attribute, Device Information and Battery Service, also eight custom services exist, that were created by the manufacturer. Every one of the first seven service UUIDs starts with <code>477ea600-a260-11e4-ae37-0002a5d5000</code> and ends with a number from 1 to 8 with number 3 missing. An additional eight service has a completely different prefix than the others.</p>
            <table>
              <thead>
                <tr>
                  <th>UUID</th>
                  <th>Service</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>0x1800</td>
                  <td>Generic Access</td>
                </tr>
                <tr>
                  <td>0x1801</td>
                  <td>Generic Attribute</td>
                </tr>
                <tr>
                  <td>0x180a</td>
                  <td>Device Information</td>
                </tr>
                <tr>
                  <td>0x180f</td>
                  <td>Battery Service</td>
                </tr>
                <tr>
                  <td>477ea600-a260-11e4-ae37-0002a5d50001</td>
                  <td>Unknown Service 1</td>
                </tr>
                <tr>
                  <td>477ea600-a260-11e4-ae37-0002a5d50002</td>
                  <td>Unknown Service 2</td>
                </tr>
                <tr>
                  <td>477ea600-a260-11e4-ae37-0002a5d50004</td>
                  <td>Unknown Service 4</td>
                </tr>
                <tr>
                  <td>477ea600-a260-11e4-ae37-0002a5d50005</td>
                  <td>Unknown Service 5</td>
                </tr>
                <tr>
                  <td>477ea600-a260-11e4-ae37-0002a5d50006</td>
                  <td>Unknown Service 6</td>
                </tr>
                <tr>
                  <td>477ea600-a260-11e4-ae37-0002a5d50007</td>
                  <td>Unknown Service 7</td>
                </tr>
                <tr>
                  <td>477ea600-a260-11e4-ae37-0002a5d50008</td>
                  <td>Unknown Service 8</td>
                </tr>
                <tr>
                  <td>a651fff1-4074-4131-bce9-56d4261bc7b1</td>
                  <td>Unknown Other Service</td>
                </tr>
              </tbody>
            </table>
            <p>By switching the device on and off, changing the strength and mode and also by changing the brush back and forth, I was able to identify some of the characteristics of the six services. By reverse engineering the code of the Android app using <a href="https://github.com/skylot/jadx">jadx</a> I found information about the session storage and many other things.</p>
            <table>
              <thead>
                <tr>
                  <th>Service</th>
                  <th>Suffix</th>
                  <th>Actions</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Handle (1)</td>
                  <td>4010</td>
                  <td>RWN</td>
                  <td>Handle State: Off(0), Standby(1), Run(2),Charge(3), Shutdown(4) Validate(6), LightsOut(7)</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4020</td>
                  <td>R–</td>
                  <td>?</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4022</td>
                  <td>R–</td>
                  <td>?</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4030</td>
                  <td>R-N</td>
                  <td>?</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4040</td>
                  <td>RW-</td>
                  <td>?</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4050</td>
                  <td>RW-</td>
                  <td>Current Time (Unix Timestamp)</td>
                </tr>
                <tr>
                  <td>Brushing (2)</td>
                  <td>4070</td>
                  <td>R-N</td>
                  <td>Current session id</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4080</td>
                  <td>R–</td>
                  <td>Mode (0x0=Clean, 0x2=White+, …)</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4082</td>
                  <td>RWN</td>
                  <td>State (0=Ready, 1=Active, 2=Resume)</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4090</td>
                  <td>R-N</td>
                  <td>Active time in seconds</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4091</td>
                  <td>R-N</td>
                  <td>Mode 2 (0x78=Clean, 0xa0=White+, 0xc8=Gum Health, 0xb4=Deep Clean+)</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>40a0</td>
                  <td>R-N</td>
                  <td>?</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>40b0</td>
                  <td>R-N</td>
                  <td>Strength (0,1,2)</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>40c0</td>
                  <td>R-N</td>
                  <td>?</td>
                </tr>
                <tr>
                  <td>Session Storage (4)</td>
                  <td>40d0</td>
                  <td>R-N</td>
                  <td>Last session id (e.g. 0x2c05 = 1324)</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>40d2</td>
                  <td>R–</td>
                  <td>?</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>40d5</td>
                  <td>RW-</td>
                  <td>Session Type</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>40e0</td>
                  <td>-WN</td>
                  <td>Request session (write session id, write 0x00 to 4110, get notification with data here and at 4100)</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4100</td>
                  <td>–N</td>
                  <td>?</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4110</td>
                  <td>-WN</td>
                  <td>Session Access Control Point</td>
                </tr>
                <tr>
                  <td>Orientation (5)</td>
                  <td>4120</td>
                  <td>RW-</td>
                  <td>?</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4130</td>
                  <td>–N</td>
                  <td>Gyroscope Data</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4140</td>
                  <td>-WN</td>
                  <td>?</td>
                </tr>
                <tr>
                  <td>Brush (6)</td>
                  <td>4210</td>
                  <td>R–</td>
                  <td>NFC Tag Version</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4220</td>
                  <td>R–</td>
                  <td>? INT8</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4230</td>
                  <td>R-N</td>
                  <td>Brush Serial</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4240</td>
                  <td>R–</td>
                  <td>Brush Manufacturing Date?</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4250</td>
                  <td>R–</td>
                  <td>?</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4254</td>
                  <td>R–</td>
                  <td>?</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4260</td>
                  <td>R–</td>
                  <td>?</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4270</td>
                  <td>R–</td>
                  <td>?</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4280</td>
                  <td>R–</td>
                  <td>Brush Lifetime (Seconds)</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4290</td>
                  <td>R–</td>
                  <td>Brush Usage (Seconds)</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>42a0</td>
                  <td>R–</td>
                  <td>Brush Type (None, Adaptive Clean, Adaptive White, Tongue Care, Adaptive Gums)</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>42a2</td>
                  <td>R–</td>
                  <td>?</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>42a4</td>
                  <td>R–</td>
                  <td>?</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>42a6</td>
                  <td>RWN</td>
                  <td>?</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>42b0</td>
                  <td>R–</td>
                  <td>NFC Payload (always phillips.com)</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>42c0</td>
                  <td>R–</td>
                  <td>? INT16</td>
                </tr>
                <tr>
                  <td>7</td>
                  <td>4310</td>
                  <td>R–</td>
                  <td>? INT16</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4320</td>
                  <td>R–</td>
                  <td>? INT16</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4330</td>
                  <td>R–</td>
                  <td>?</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4360</td>
                  <td>R–</td>
                  <td>? (Only uses second byte)</td>
                </tr>
                <tr>
                  <td>8</td>
                  <td>4410</td>
                  <td>RW-</td>
                  <td>? INT16</td>
                </tr>
                <tr>
                  <td>&nbsp;</td>
                  <td>4420</td>
                  <td>RW-</td>
                  <td>? INT32</td>
                </tr>
              </tbody>
            </table>
            <p>According to the application sources, the last unknown service is called “Moonshine Streaming” and is used to update the firmware. I agreed with myself to not touch this one, since I could damage the firmware and would need to brush my teeth by hand again.</p>
            <p>Since I could see a very course orientation displayed in the app during a cleaning session, I expected orientation data somewhere in the characteristics. I found them in the service <code>5</code>. Once you enable notifications for the <code>4130</code> service, you get a data stream to byte arrays. It turns out, these are indeed the values of the gyroscope.</p>
            <p><img src="https://blog.johannes-mittendorfer.com/assets/img/sonicare-gyro.png" alt="Gyroscrope" title="Gyroscope"></p>
            <p>I created a python library to interface with the toothbrush in Python. Feel free to experiment, find the meaning of the missing services and submit pull requests: <a href="https://github.com/joushx/python-sonicare">https://github.com/joushx/python-sonicare</a></p>
          </div></div>]]>
            </description>
            <link>https://blog.johannes-mittendorfer.com/artikel/2020/10/my-toothbrush-streams-gyroscope-data</link>
            <guid isPermaLink="false">hacker-news-small-sites-24881729</guid>
            <pubDate>Sat, 24 Oct 2020 20:26:05 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[The four dangerous animals of product development]]>
            </title>
            <description>
<![CDATA[
Score 67 | Comments 33 (<a href="https://news.ycombinator.com/item?id=24880218">thread link</a>) | @ochronus
<br/>
October 24, 2020 | https://ochronus.online/four-dangerous-animals-of-product-development/ | <a href="https://web.archive.org/web/*/https://ochronus.online/four-dangerous-animals-of-product-development/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article id="post-233" itemtype="https://schema.org/CreativeWork" itemscope="itemscope">
<div>

<div itemprop="text">
<p>This is going to be a short walk in the product development zoo, I hope you’ll enjoy the ride!</p>
<p><em>Caveat</em>: what you’ll read about are (usually) not personality types but behaviors in a specific (type of) situation. Acting like a HIPPO, a WOLF, a RHINO or a ZEBRA doesn’t make anyone a bad person. You’re still a team, aim to understand where they are coming from, and, well, they might even be right, with the wrong communication style. </p>
<h2>The HIPPO – the Highest Paid Person’s Opinion</h2>
<div>
<div>
<div>
<div>
<figure><picture title="The four dangerous animals of product development 3">
<source type="image/webp" data-lazy-srcset="https://ochronus.online/wp-content/uploads/2020/10/hippo.png.webp 484w, https://ochronus.online/wp-content/uploads/2020/10/hippo-300x300.png.webp 300w, https://ochronus.online/wp-content/uploads/2020/10/hippo-150x150.png.webp 150w" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20484%20484'%3E%3C/svg%3E" data-lazy-sizes="(max-width: 484px) 100vw, 484px">
<img width="484" height="484" src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20484%20484'%3E%3C/svg%3E" alt="hippo - Highest Paid Person's Opinion" data-lazy-srcset="https://ochronus.online/wp-content/uploads/2020/10/hippo.png 484w, https://ochronus.online/wp-content/uploads/2020/10/hippo-300x300.png 300w, https://ochronus.online/wp-content/uploads/2020/10/hippo-150x150.png 150w" data-lazy-sizes="(max-width: 484px) 100vw, 484px" data-lazy-src="https://ochronus.online/wp-content/uploads/2020/10/hippo.png">
</picture>
</figure>
</div>
<div>
<p>It can be tempting to give in to the HIPPOs – founders or CEO or VPS who want to make all the decisions – but don’t let them steer you off course.</p>
<p>Bring everything back to your vision and objectives. If the HIPPOs aren’t aligned with those, you could be headed for dangerous waters.</p>
<p>Don’t let your HiPPO kill your ideas – inform them with data and make them a <a href="https://www.forbes.com/sites/bernardmarr/2017/10/26/data-driven-decision-making-beware-of-the-hippo-effect/" target="_blank" rel="noopener">Data-driven HiPPO</a>! </p>
<p>Read more about <a href="https://www.forbes.com/sites/derosetichy/2013/04/15/what-happens-when-a-hippo-runs-your-company/" target="_blank" rel="noopener">what happens when a HIPPO runs your company</a>.</p>
</div>
</div>
</div>
</div>
<h2>The WOLF – Working On the Latest Fire</h2>
<div>
<div>
<p>The WOLF has a short attention span and a temptation to jump from one problem to the next. They tend to only enjoy fighting fires, This will disrupt your team’s focus and effectiveness, making you easy prey for your competitors.</p>
<p>Create a process for collecting feedback about problems, bugs and only consider these along with all other requests. Set up triaging and set clear priorities and a method for prioritization.</p>
<p>There’s a whole book on WOLF prioritization: <a href="https://www.amazon.com/gp/product/1942788290/" target="_blank" rel="noopener">The Phoenix Project</a></p>
</div>
<div>
<figure><picture title="The four dangerous animals of product development 4">
<source type="image/webp" data-lazy-srcset="https://ochronus.online/wp-content/uploads/2020/10/wolf.png.webp 484w, https://ochronus.online/wp-content/uploads/2020/10/wolf-300x300.png.webp 300w, https://ochronus.online/wp-content/uploads/2020/10/wolf-150x150.png.webp 150w" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20484%20484'%3E%3C/svg%3E" data-lazy-sizes="(max-width: 484px) 100vw, 484px">
<img width="484" height="484" src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20484%20484'%3E%3C/svg%3E" alt="wolf - Working On the Latest Fire" data-lazy-srcset="https://ochronus.online/wp-content/uploads/2020/10/wolf.png 484w, https://ochronus.online/wp-content/uploads/2020/10/wolf-300x300.png 300w, https://ochronus.online/wp-content/uploads/2020/10/wolf-150x150.png 150w" data-lazy-sizes="(max-width: 484px) 100vw, 484px" data-lazy-src="https://ochronus.online/wp-content/uploads/2020/10/wolf.png">
</picture>
</figure>
</div>
</div>
<h2>The RHINO – Really Here In Name Only</h2>
<div>
<div>
<figure><picture title="The four dangerous animals of product development 5">
<source type="image/webp" data-lazy-srcset="https://ochronus.online/wp-content/uploads/2020/10/rhino.png.webp 478w, https://ochronus.online/wp-content/uploads/2020/10/rhino-300x300.png.webp 300w, https://ochronus.online/wp-content/uploads/2020/10/rhino-150x150.png.webp 150w" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20478%20478'%3E%3C/svg%3E" data-lazy-sizes="(max-width: 478px) 100vw, 478px">
<img width="478" height="478" src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20478%20478'%3E%3C/svg%3E" alt="rhino - Reall Here In Name Only" data-lazy-srcset="https://ochronus.online/wp-content/uploads/2020/10/rhino.png 478w, https://ochronus.online/wp-content/uploads/2020/10/rhino-300x300.png 300w, https://ochronus.online/wp-content/uploads/2020/10/rhino-150x150.png 150w" data-lazy-sizes="(max-width: 478px) 100vw, 478px" data-lazy-src="https://ochronus.online/wp-content/uploads/2020/10/rhino.png">
</picture>
</figure>
</div>
<div>
<p>The RHINO is just there to collect a paycheck without contributing much to the team. They might not be actively impeding your decision-making, but they are not helping much either. </p>
<p>Having a clearly defined prioritization process can help ensure all your team members understand how decisions are made and give them the confidence to actively participate. Hopefully, in this process, everyone is empowered to have a say and it doesn’t turn into “Well our process is that the boss tells you what’s important” – which is exactly how you end up with a team of disillusioned RHINOs.</p>
</div>
</div>
<h2>The ZEBRA – Zero Evidence But Really Arrogant</h2>
<div>
<div>
<p>ZEBRAs think they know it all but rely on their instinct rather than any actual evidence. To stave off the ZEBRAs in your midst, make sure that you’ve got data to back up your decisions.</p>
<p>Come up with quick experiments you can run to test ideas and gather evidence. Push for a data-driven culture.</p>
<p>An interesting article for the HIPPO vs. the ZEBRA: <a href="https://kromatic.com/blog/in-defense-of-the-hi-p-p-o/" target="_blank" rel="noopener">In defense of the HIPPO…fear the ZEBRA</a></p>
</div>
<div>
<figure><picture title="The four dangerous animals of product development 6">
<source type="image/webp" data-lazy-srcset="https://ochronus.online/wp-content/uploads/2020/10/zebra.png.webp 484w, https://ochronus.online/wp-content/uploads/2020/10/zebra-300x300.png.webp 300w, https://ochronus.online/wp-content/uploads/2020/10/zebra-150x150.png.webp 150w" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20484%20484'%3E%3C/svg%3E" data-lazy-sizes="(max-width: 484px) 100vw, 484px">
<img width="484" height="484" src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20484%20484'%3E%3C/svg%3E" alt="zebra - Zero Evindence But Really Aggressive" data-lazy-srcset="https://ochronus.online/wp-content/uploads/2020/10/zebra.png 484w, https://ochronus.online/wp-content/uploads/2020/10/zebra-300x300.png 300w, https://ochronus.online/wp-content/uploads/2020/10/zebra-150x150.png 150w" data-lazy-sizes="(max-width: 484px) 100vw, 484px" data-lazy-src="https://ochronus.online/wp-content/uploads/2020/10/zebra.png">
</picture>
</figure>
</div>
</div>
<h2>And one extra…. the RHINO again! This time, Really High value New Opportunity</h2>
<p>Usually, it’s a salesperson with an amazing value customer deal for an unplanned feature insisting re-allocating resources to build what’s required to win the deal. The results, sadly, are an ignored strategy and roadmap and resources allocated to serve a single customer.</p>
<p>There are two ways here:</p>
<p>1, Chase the RHINO away: Compare the opportunity cost and value and argue against signing the deal if you have customer insight supporting the roadmap.<br>2, Tame the RHINO: Adjust the roadmap if the opportunity includes features you already had planned for later in the year.</p>
<p>Read more here: <a href="https://www.productfocus.com/taming-the-rhino/" target="_blank" rel="noopener">Taming the Rhino</a></p>

<p>There’s an amazing doc called <a href="https://www.productboard.com/wp-content/uploads/2020/09/The-Essential-Guide-to-Prioritization.pdf" target="_blank" rel="noopener">The Essential Guide to Prioritization</a> which explains the above with more context and more detail.</p>
<hr>
<h4>You might be interested in these posts, too:</h4>
<p><a href="https://ochronus.online/goal-setting/">The 101 of effective goal setting</a></p>
<p><a href="https://ochronus.online/learning-at-work-is-work/">Learning at work is absolutely work</a></p>
<p><a href="https://ochronus.online/how-to-stop-winning-arguments/">How to stop winning arguments</a></p>
<p><a href="https://ochronus.online/stories-we-tell-ourselves/">The stories we tell ourselves</a></p>


</div>
</div>

</article></div>]]>
            </description>
            <link>https://ochronus.online/four-dangerous-animals-of-product-development/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24880218</guid>
            <pubDate>Sat, 24 Oct 2020 16:34:38 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[/.bashrc VS –/.profile VS –/.bash_profile]]>
            </title>
            <description>
<![CDATA[
Score 128 | Comments 33 (<a href="https://news.ycombinator.com/item?id=24880170">thread link</a>) | @keyboardman
<br/>
October 24, 2020 | https://leimao.github.io/blog/bashrc-VS-profile-VS-bash_profile/ | <a href="https://web.archive.org/web/*/https://leimao.github.io/blog/bashrc-VS-profile-VS-bash_profile/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="main" role="main">
  <div>
    
	<p><img src="https://leimao.github.io/images//author_images/Lei-Bio-Medium.jpg" alt="Lei Mao bio photo"></p><h3>Lei Mao</h3>
<p>Machine Learning, Artificial Intelligence, Computer Science.</p>
<p>

<a href="http://facebook.com/dukeleimao" target="_blank"><i></i> Facebook</a>
<a href="http://linkedin.com/in/lei-mao" target="_blank"><i></i> LinkedIn</a>


<a href="http://github.com/leimao" target="_blank"><i></i> GitHub</a>
<a href="http://scholar.google.com/citations?user=R2VUf7YAAAAJ" target="_blank"><i></i>&nbsp; G. Scholar</a>






<a href="mailto:dukeleimao@gmail.com" target="_blank"><i></i> E-Mail</a>

<a href="https://leimao.github.io/feed.xml" target="_blank"> RSS</a>
  </p></div>
  <article>
    <!--/ .headline-wrap -->
    <div>
      <h3 id="introduction">Introduction</h3>

<p>Sometimes, when I remotely login to some Linux computers or use Docker containers, I would find the shell is plain black and white, different from the colorful shell I am used to dealing with on my local machine. This sometimes makes it difficult to look for libraries, executables, and folders. Sometimes, some executables could be called directly from a local shell but from a remote login shell they are not directly callable.</p>



<p>It turns out that the shell is an executable and it is “configured” by special shell scripts such as <code>~/.bashrc</code>, <code>~/.profile</code>, <code>~/.bash_profile</code>. In this blog post, I would like to briefly discuss the differences between these scripts.</p>

<h3 id="bashrc">~/.bashrc</h3>

<p>I modify the <code>~/.bashrc</code> file from time to time, because sometimes I would like to set some environment variables, including <code>PATH</code> which is an environmental variable in Linux and other Unix-like operating systems that tells the shell which directories to search when looking for executable files. But I have been ignoring the commented block at its beginning for decades.</p>

<div><div><pre><code>$ cat ~/.bashrc 
# ~/.bashrc: executed by bash(1) for non-login shells.
# see /usr/share/doc/bash/examples/startup-files (in the package bash-doc)
# for examples
...
</code></pre></div></div>

<p>This means that in a local shell where <code>bash</code> is being used, this shell script will be executed immediately after <code>bash</code> is executed. There are many other shell executable variants, such as <code>zsh</code>. <code>~/.bashrc</code> is only specific to <code>bash</code>.</p>



<p>There are many settings in the <code>~/.bashrc</code> that makes the shell look colorful. For example,</p>

<div><div><pre><code># enable color support of ls and also add handy aliases
if [ -x /usr/bin/dircolors ]; then
    test -r ~/.dircolors &amp;&amp; eval "$(dircolors -b ~/.dircolors)" || eval "$(dircolors -b)"
    alias ls='ls --color=auto'
    #alias dir='dir --color=auto'
    #alias vdir='vdir --color=auto'

    alias grep='grep --color=auto'
    alias fgrep='fgrep --color=auto'
    alias egrep='egrep --color=auto'
fi
</code></pre></div></div>

<h3 id="profile">~/.profile</h3>

<p>The comment block found in the <code>~/.profile</code> explicitly tells us that it will be executed for the login shells. However, if <code>~/.bash_profile</code> or <code>~/.bash_login</code> exists, <code>~/.profile</code> will not be executed.</p>

<div><div><pre><code>$ cat ~/.profile 
# ~/.profile: executed by the command interpreter for login shells.
# This file is not read by bash(1), if ~/.bash_profile or ~/.bash_login
# exists.
# see /usr/share/doc/bash/examples/startup-files for examples.
# the files are located in the bash-doc package.

# the default umask is set in /etc/profile; for setting the umask
# for ssh logins, install and configure the libpam-umask package.
#umask 022

# if running bash
if [ -n "$BASH_VERSION" ]; then
    # include .bashrc if it exists
    if [ -f "$HOME/.bashrc" ]; then
	. "$HOME/.bashrc"
    fi
fi

# set PATH so it includes user's private bin if it exists
if [ -d "$HOME/bin" ] ; then
    PATH="$HOME/bin:$PATH"
fi

# set PATH so it includes user's private bin if it exists
if [ -d "$HOME/.local/bin" ] ; then
    PATH="$HOME/.local/bin:$PATH"
fi
</code></pre></div></div>

<p>The default content of the <code>~/.profile</code> is simple. In most cases, it inherits whatever is in the <code>~/.bashrc</code>, and adds some user specific executable filepath to the environment variable <code>PATH</code>. So if there are commands that make the shell look colorful in the <code>~/.bashrc</code>, the login shell should also look colorful.</p>

<h3 id="bash_profile">~/.bash_profile</h3>

<p>Unfortunately, in most of my login trials, the shells were never colorful, and sometimes the environment variables did not match my expectation. In those cases, this is because there exists a <code>~/.bash_profile</code> and therefore <code>~/.profile</code> or <code>~/.bashrc</code> is never executed. Usually the <code>~/.bash_profile</code> will be empty, which means that we would not have the environment and appearance that we have in our local shell.</p>



<p>To make the login shell “back to normal”, we could either delete the <code>~/.bash_profile</code> or modify the <code>~/.bash_profile</code> by adding some commands like</p>



<h3 id="caveats">Caveats</h3>

<p>Sometimes, a non-color shell could be helpful. It can be used to indicate that you are not working in local shell, and that what you are seeing could either be a Docker shell or a remote login shell. When we know what shell we are dealing with, we will be more likely to avoid dangerous operations. For example, in a Docker shell, we could do almost anything, such as <code>rm -rf /</code> without sudo, without harming the local system.</p>

<h3 id="acknowledgement">Acknowledgement</h3>

<p>I would like to thank Liam Keane from Hacker News for correcting the grammars and polishing the words in the blog post.</p>

      <hr>
      
    </div><!-- /.article-wrap -->
  
    <!-- /#disqus_thread -->
  
  </article>
</div></div>]]>
            </description>
            <link>https://leimao.github.io/blog/bashrc-VS-profile-VS-bash_profile/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24880170</guid>
            <pubDate>Sat, 24 Oct 2020 16:28:34 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Microsoft Tilecode]]>
            </title>
            <description>
<![CDATA[
Score 399 | Comments 43 (<a href="https://news.ycombinator.com/item?id=24879861">thread link</a>) | @Impossible
<br/>
October 24, 2020 | https://microsoft.github.io/tilecode/ | <a href="https://web.archive.org/web/*/https://microsoft.github.io/tilecode/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/>Unable to extract article]]>
            </description>
            <link>https://microsoft.github.io/tilecode/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24879861</guid>
            <pubDate>Sat, 24 Oct 2020 15:42:48 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA['changeme' is valid base64]]>
            </title>
            <description>
<![CDATA[
Score 57 | Comments 24 (<a href="https://news.ycombinator.com/item?id=24879062">thread link</a>) | @todsacerdoti
<br/>
October 24, 2020 | https://blog.3fx.ch/post/changeme-base64/ | <a href="https://web.archive.org/web/*/https://blog.3fx.ch/post/changeme-base64/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
    <article>
        <header>
            
        </header>

        


        <p><a href="https://en.wikipedia.org/wiki/Base64">Base64-encoding</a> is ubiquitous in our
modern world. Many programs communicate in base64-encoded messages, since these
have nice properties: They consist of a very limited subset of ASCII characters,
and can thus be displayed as text. E-Mails for example are commonly encoded in
base64 in transfer, which can be seen in the <code>Content-Transfer-Encoding</code> header.</p>

<p>Where I volunteer we have a tradition of putting <code>changeme</code> as a placeholder for
many template variables indicating that they should be overwritten later. Thus,
if we later still see <code>changeme</code> anywhere we know that somewhere somebody must
have forgotten to specify a variable<sup id="fnref:1"><a href="#fn:1">1</a></sup>.</p>

<p>Sometimes these template variables should correspond to base64-encoded content,
i.e. the base64-decoding of said variable should produce meaningful content. But
what happens if somebody forgets to define said variable, and it is substituted
with<code>changeme</code> instead? I always thought that it would fail to
decode the string since the probability that <code>changeme</code> is actually valid base64
encoding must be very low. But lo and behold, this is not the case:</p>

<pre><code>% echo changeme | base64 -d
r�[1m
</code></pre>

<p>Running <code>hexdump</code> on the output we can identify the characters:</p>

<pre><code>% echo changeme | base64 -d | hexdump -C
00000000  72 16 a7 81 e9 9e      |r.....|
00000006
</code></pre>

<p>Mostly nonsense, but the second byte is interesting: It is an ASCII control
character <sup id="fnref:2"><a href="#fn:2">2</a></sup>, meaning trips up all sorts of programs which expect to read
printable ASCII characters, such as JSON deserializers.</p>

<p>This bug actually occurred when I was migrating some applications between
different Kubernetes clusters: In the old cluster the application ran without
problems, but I forgot to specify some variable in the new cluster, and it lead
to Go complaining about non-ASCII characters in a JSON string.</p>

<p>I guess the moral of the story is: If you use dummy values be sure that they
cannot be misinterpreted.</p>



        
    </article>
</div></div>]]>
            </description>
            <link>https://blog.3fx.ch/post/changeme-base64/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24879062</guid>
            <pubDate>Sat, 24 Oct 2020 13:24:36 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[September 2020 least deadly month ever in Sweden]]>
            </title>
            <description>
<![CDATA[
Score 129 | Comments 132 (<a href="https://news.ycombinator.com/item?id=24878723">thread link</a>) | @ptr
<br/>
October 24, 2020 | https://cornucopia.cornubot.se/2020/10/september-2020-least-deadly-month-ever.html?m=1 | <a href="https://web.archive.org/web/*/https://cornucopia.cornubot.se/2020/10/september-2020-least-deadly-month-ever.html?m=1">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="post-body-2414610535484946156" itemprop="articleBody"><p>
According to the state authority Statistics Sweden (SCB) data, september 2020 was the least deadly month per capita ever in Swedish history. So far the year 2020 has been the third least deadly year per capita ever in the country, despite the tragic and global Covid-19 pandemic.</p><table><tbody><tr><td><a href="https://1.bp.blogspot.com/-9FFnIABbac4/X5Pw8Wo0YFI/AAAAAAABB58/SHSv6ZYjdD0Vz6mP10Bp1YI3UlnpY_zBwCLcBGAsYHQ/s2048/1.png"><img data-original-height="1176" data-original-width="2048" height="160" src="https://1.bp.blogspot.com/-9FFnIABbac4/X5Pw8Wo0YFI/AAAAAAABB58/SHSv6ZYjdD0Vz6mP10Bp1YI3UlnpY_zBwCLcBGAsYHQ/w640-h366/1.png" width="280"></a></td></tr><tr><td>Deaths in September 1860 - 2020 in Sweden per 100 000 population. Data: SCB</td></tr></tbody></table><div><p>September 2020 was the least deadly month ever in Sweden, at least so far back as the data from SCB:s public database provides data. There were 63.07 deaths per 100 000 people in September 2020, and the previous record low was 64.24 in June 2019, and before that 65.13 in June 2018.</p><div><div><p>For the year 2020 so far, ie January - September, the number of deaths per capita is the third lowest ever.</p><table><tbody><tr><td><a href="https://1.bp.blogspot.com/-0S5HrrSJ-u4/X5Pw8Yv4K1I/AAAAAAABB6A/-sEnWALKjRAJy_5Z6GM4xDDZsYzg1QhFACLcBGAsYHQ/s2048/2.png"><img data-original-height="1176" data-original-width="2048" height="160" src="https://1.bp.blogspot.com/-0S5HrrSJ-u4/X5Pw8Yv4K1I/AAAAAAABB6A/-sEnWALKjRAJy_5Z6GM4xDDZsYzg1QhFACLcBGAsYHQ/w640-h366/2.png" width="280"></a></td></tr><tr><td>Deaths January - September 1860 - 2020 in Sweden per 100 000 population. Data: SCB</td></tr></tbody></table><br></div></div></div><p>The number of deaths per 100 000 population in Sweden was 675 for January - September 2020. 2019 January - September have the record low at 636 and 2016 had the record before that at &nbsp;673. Data sources are the same as above.</p><p><b>Both 2017 and 2018 had a higher numer of deaths per capita January - September than Sweden have had for the same months in 2020, despite the Covid-19 pandemic.</b></p><p>Possible confounding factors might be demographic mix. However, the average age in Sweden (<a href="https://www.statistikdatabasen.scb.se/pxweb/sv/ssd/START__BE__BE0101__BE0101B/BefolkningMedelAlder/">SCB database table</a>) was 41.1 years in 2011, and had a plateau at 41.2 for the years 2012 - 2018, and increased to 41.3 years in 2019, so the average population age is increasing. There is no data for 2020 yet.&nbsp;</p><p><i>I am not an epidemiologist. It is not up to me to draw conclusions from this. The numbers above are simple facts, based on the high quality official statistics. My only merit is running the independent blog in economics and politics in Sweden with the highest traffic since the start 2008, and being used to crunch official statistics and data. As my Swedish language article on the subject got some international attention, I have published this article in bad English.</i></p><p><i>New visitors will be unable to comment, as my moderator robot deletes any comments made by non-listed accounts.&nbsp;</i></p>

</div></div>]]>
            </description>
            <link>https://cornucopia.cornubot.se/2020/10/september-2020-least-deadly-month-ever.html?m=1</link>
            <guid isPermaLink="false">hacker-news-small-sites-24878723</guid>
            <pubDate>Sat, 24 Oct 2020 12:22:27 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Porting Firecracker to a Raspberry Pi 4 (2019)]]>
            </title>
            <description>
<![CDATA[
Score 136 | Comments 15 (<a href="https://news.ycombinator.com/item?id=24878698">thread link</a>) | @k__
<br/>
October 24, 2020 | https://blog.cloudkernels.net/posts/firecracker-rpi4/ | <a href="https://web.archive.org/web/*/https://blog.cloudkernels.net/posts/firecracker-rpi4/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
      

<p>Since we got our hands on the new Raspberry Pi 4, we started exploring how
various virtualization technologies behave on the board. First thing we tried is how to run <a href="https://cloudkernels.github.io/posts/rpi4-64bit-virt/">Nabla</a> on it and how it compares to native KVM.</p>

<p>Next thing we wanted to try is <a href="https://github.com/firecracker-microvm/firecracker">firecracker</a>, the notorious micro-VMM that
Amazon Lambda &amp; Fargate run on. To our disappointment, firecracker was not
<a href="https://github.com/firecracker-microvm/firecracker/issues/1196">yet</a> running on RPi4. So we started looking into coding in the necessary
changes :)</p>

<p>After a bit of investigation, we figured out that the key missing piece is
support for the GICv2 ARM interrupt controller. In fact, firecracker only
supports GIC version 3 since it was open-sourced, but not version 2, which is
the version appearing in the Raspberry Pi series, as well as in other popular
boards, like the Hikey 970 we got our hands on, or Khadas VIM3. A bit more
digging into the internals of firecracker and the Linux kernel, helped us
work out the details and open a <a href="https://github.com/firecracker-microvm/firecracker/pull/1235">pull-request</a> which adds support for the
missing parts.</p>

<h4 id="changes-in-firecracker">Changes in Firecracker</h4>

<p>The Generic Interrupt Controller (GIC) is the IP block in the ARM processors
that implements interrupt handling. The Linux kernel supports user- and
kernel-space emulation for GICv2 as well as GICv3 and v4. However, Firecracker
only handles the GICv3-related configuration of the virtual GIC (VGIC).
Similarly, setting up the FDT for the guest microVM from Firecracker only
handles GIC-v3 devices.</p>

<p>In terms of code organization, the GIC related code currently exposes a function
for setting up GICv3 performing the corresponding <code>ioctl</code> KVM commands. The
first part of our PR changes this by introducing a GIC Trait which defines the
common interface for all GIC implementations. Even though it is still under
discussion, what exactly will be in the Trait in its final form, it will be
something along the following lines:</p>
<div><pre><code data-lang="rs"><span>/// Trait for GIC devices.
</span><span></span><span>pub</span><span> </span><span>trait</span><span> </span>GICDevice<span> </span>{<span>
</span><span>    </span><span>/// Returns the GIC version of the device
</span><span></span><span>    </span><span>fn</span> <span>version</span>(<span>&amp;</span><span>self</span>)<span> </span>-&gt; <span>u32</span>;<span>
</span><span>
</span><span>    </span><span>/// Returns the file descriptor of the GIC device
</span><span></span><span>    </span><span>fn</span> <span>device_fd</span>(<span>&amp;</span><span>self</span>)<span> </span>-&gt; <span>&amp;</span><span>DeviceFd</span>;<span>
</span><span>
</span><span>    </span><span>/// Returns an array with GIC device properties
</span><span></span><span>    </span><span>fn</span> <span>device_properties</span>(<span>&amp;</span><span>self</span>)<span> </span>-&gt; <span>&amp;</span>[<span>u64</span>];<span>
</span><span></span>}<span>
</span></code></pre></div>
<p>With this in place, we can define objects per GIC version, which implement this
Trait, and still have the rest of the code deal with the <code>GICDevice</code> Trait,
which is transparent to the GIC version.</p>

<p>The implementations for each version, implement the Trait and a <code>new</code> function
which is used to create the new object:</p>
<div><pre><code data-lang="rs"><span>pub</span><span> </span><span>fn</span> <span>new</span>(vm: <span>&amp;</span><span>VmFd</span>,<span> </span>vcpu_count: <span>u64</span>)<span> </span>-&gt; <span>Result</span><span>&lt;</span><span>Box</span><span>&lt;</span>GICDevice<span>&gt;&gt;</span><span>
</span></code></pre></div>
<p>The differentiation between the two versions lays in the VGIC register
attributes that each device exposes. As a result, the work we need to do is essentially to <code>mmap</code> their addresses.</p>

<p>GICv2 relevant addresses include the <strong>distributor</strong> and <strong>cpu</strong> groups:</p>
<div><pre><code data-lang="rs"><span>/* Setting up the distributor attribute.
</span><span> We are placing the GIC below 1GB so we need to substract the size of the distributor.
</span><span>*/</span><span>
</span><span></span>set_device_attribute(<span>
</span><span>    </span><span>&amp;</span>vgic_fd,<span>
</span><span>    </span>kvm_bindings::KVM_DEV_ARM_VGIC_GRP_ADDR,<span>
</span><span>    </span><span>u64</span>::from(kvm_bindings::KVM_VGIC_V2_ADDR_TYPE_DIST),<span>
</span><span>    </span><span>&amp;</span>get_dist_addr()<span> </span><span>as</span><span> </span><span>*</span><span>const</span><span> </span><span>u64</span><span> </span><span>as</span><span> </span><span>u64</span>,<span>
</span><span>    </span><span>0</span>,<span>
</span><span></span>)<span>?</span>;<span>
</span><span>
</span><span></span><span>/* Setting up the CPU attribute.
</span><span> */</span><span>
</span><span></span>set_device_attribute(<span>
</span><span>    </span><span>&amp;</span>vgic_fd,<span>
</span><span>    </span>kvm_bindings::KVM_DEV_ARM_VGIC_GRP_ADDR,<span>
</span><span>    </span><span>u64</span>::from(kvm_bindings::KVM_VGIC_V2_ADDR_TYPE_CPU),<span>
</span><span>    </span><span>&amp;</span>get_cpu_addr()<span> </span><span>as</span><span> </span><span>*</span><span>const</span><span> </span><span>u64</span><span> </span><span>as</span><span> </span><span>u64</span>,<span>
</span><span>    </span><span>0</span>,<span>
</span><span></span>)<span>?</span>;<span>
</span></code></pre></div>
<p>whereas the GICv3 includes the <strong>distributor</strong> and <strong>redistributor</strong> groups:</p>
<div><pre><code data-lang="rs"><span>/* Setting up the distributor attribute.
</span><span> We are placing the GIC below 1GB so we need to substract the size of the distributor.
</span><span>*/</span><span>
</span><span></span>set_device_attribute(<span>
</span><span>    </span><span>&amp;</span>vgic_fd,<span>
</span><span>    </span>kvm_bindings::KVM_DEV_ARM_VGIC_GRP_ADDR,<span>
</span><span>    </span><span>u64</span>::from(kvm_bindings::KVM_VGIC_V3_ADDR_TYPE_DIST),<span>
</span><span>    </span><span>&amp;</span>get_dist_addr()<span> </span><span>as</span><span> </span><span>*</span><span>const</span><span> </span><span>u64</span><span> </span><span>as</span><span> </span><span>u64</span>,<span>
</span><span>    </span><span>0</span>,<span>
</span><span></span>)<span>?</span>;<span>
</span><span>
</span><span></span><span>/* Setting up the redistributors' attribute.
</span><span>We are calculating here the start of the redistributors address. We have one per CPU.
</span><span>*/</span><span>
</span><span></span>set_device_attribute(<span>
</span><span>    </span><span>&amp;</span>vgic_fd,<span>
</span><span>    </span>kvm_bindings::KVM_DEV_ARM_VGIC_GRP_ADDR,<span>
</span><span>    </span><span>u64</span>::from(kvm_bindings::KVM_VGIC_V3_ADDR_TYPE_REDIST),<span>
</span><span>    </span><span>&amp;</span>get_redists_addr(<span>u64</span>::from(vcpu_count))<span> </span><span>as</span><span> </span><span>*</span><span>const</span><span> </span><span>u64</span><span> </span><span>as</span><span> </span><span>u64</span>,<span>
</span><span>    </span><span>0</span>,<span>
</span><span></span>)<span>?</span>;<span>
</span></code></pre></div>
<p>Finally, for both versions of GIC we finalize the device initialization by
setting the number of supported interrupts and the <em>control_init</em> group.</p>
<div><pre><code data-lang="rs"><span>/// Finalize the setup of a GIC device
</span><span></span><span>pub</span><span> </span><span>fn</span> <span>finalize_device</span>(fd: <span>&amp;</span><span>DeviceFd</span>)<span> </span>-&gt; <span>Result</span><span>&lt;</span>()<span>&gt;</span><span> </span>{<span>
</span><span>    </span><span>/* We need to tell the kernel how many irqs to support with this vgic.
</span><span>     * See the `layout` module for details.
</span><span>     */</span><span>
</span><span>    </span><span>let</span><span> </span>nr_irqs: <span>u32</span> <span>=</span><span> </span><span>super</span>::layout::IRQ_MAX<span> </span><span>-</span><span> </span><span>super</span>::layout::IRQ_BASE<span> </span><span>+</span><span> </span><span>1</span>;<span>
</span><span>    </span><span>let</span><span> </span>nr_irqs_ptr<span> </span><span>=</span><span> </span><span>&amp;</span>nr_irqs<span> </span><span>as</span><span> </span><span>*</span><span>const</span><span> </span><span>u32</span>;<span>
</span><span>    </span>set_device_attribute(<span>
</span><span>        </span>fd,<span>
</span><span>        </span>kvm_bindings::KVM_DEV_ARM_VGIC_GRP_NR_IRQS,<span>
</span><span>        </span><span>0</span>,<span>
</span><span>        </span>nr_irqs_ptr<span> </span><span>as</span><span> </span><span>u64</span>,<span>
</span><span>        </span><span>0</span>,<span>
</span><span>    </span>)<span>?</span>;<span>
</span><span>
</span><span>    </span><span>/* Finalize the GIC.
</span><span>     * See https://code.woboq.org/linux/linux/virt/kvm/arm/vgic/vgic-kvm-device.c.html#211.
</span><span>     */</span><span>
</span><span>    </span>set_device_attribute(<span>
</span><span>        </span>fd,<span>
</span><span>        </span>kvm_bindings::KVM_DEV_ARM_VGIC_GRP_CTRL,<span>
</span><span>        </span><span>u64</span>::from(kvm_bindings::KVM_DEV_ARM_VGIC_CTRL_INIT),<span>
</span><span>        </span><span>0</span>,<span>
</span><span>        </span><span>0</span>,<span>
</span><span>    </span>)<span>?</span>;<span>
</span><span>
</span><span>    </span><span>Ok</span>(())<span>
</span><span></span>}<span>
</span></code></pre></div>
<p>Regarding the FDT creation, there are differences between v2 and v3 regarding
the interrupt controller <code>intc</code> node.</p>

<p>First, we need to define the GICv2 <code>compatible</code> property to be <code>arm,gic-400</code>,
since it is the GIC-400 chip which implements GICv2. Next is the <code>reg</code>
property of the FDT, which includes the addresses and the corresponding sizes of
the GIC registers, i.e. distributor and CPU for GICv2, distributor and
redistributor for GICv3. Finally, we fix the <code>interrupts</code> property which
determines the interrupt source of the VGIC maintenance interrupt. The
corresponding values for GICv2 were taken from the respective <a href="https://github.com/torvalds/linux/blob/master/Documentation/devicetree/bindings/interrupt-controller/arm%2Cgic.yaml">Linux Kernel entries</a>.</p>

<h4 id="build-firecracker-with-rpi4-support">Build firecracker with RPi4 support</h4>

<p>While waiting for the patch to merge upstream you can go ahead and check out it
yourself.</p>

<p>Clone and build our fork of firecracker (keep in mind that while the PR review
is going on, we might force-update the branch).</p>
<div><pre><code data-lang="bash">$ git clone https://github.com/cloudkernels/firecracker.git
$ <span>cd</span> firecracker
$ ./tools/devtool build</code></pre></div>
<p>Next you need a kernel image and a root filesystem to run with your firecracker
build. You can grab the pre-built kernel image and rootfs here:</p>
<div><pre><code data-lang="bash">$ wget https://s3.amazonaws.com/spec.ccfc.min/img/aarch64/ubuntu_with_ssh/kernel/vmlinux.bin
$ wget https://s3.amazonaws.com/spec.ccfc.min/img/aarch64/ubuntu_with_ssh/fsfiles/xenial.rootfs.ext4 </code></pre></div>
<p>Alternatively, you can build your own kernel and rootfs using the following
steps provided by the firecracker docs
<a href="https://github.com/cloudkernels/firecracker/blob/master/docs/rootfs-and-kernel-setup.md">here</a></p>

<h4 id="launch-our-image">Launch our image</h4>

<p>To launch our image we will use the <a href="https://github.com/firecracker-microvm/firectl">firectl</a> tool. We need, to setup a tap
device for the networking or our firecracker microVM.</p>
<div><pre><code data-lang="bash">$ sudo ip tuntap add dev tap0 mode tap
$ sudo ip addr add <span>172</span>.16.0.1/24 dev tap0
$ sudo ip link <span>set</span> tap0 up</code></pre></div>
<p>And we launch the microVM using firectl:</p>
<div><pre><code data-lang="bash">firectl --firecracker-binary<span>=</span><span>${</span><span>PATH_TO_FC_BIN</span><span>}</span> --kernel<span>=</span>vmlinux.bin <span>\
</span><span></span>	--tap-device<span>=</span>tap0/aa:fc:00:00:00:01 <span>\
</span><span></span>	--kernel-opts<span>=</span><span>"console=ttyS0 reboot=k panic=1 pci=off ip=172.16.0.42::172.16.0.1:255.255.255.0::eth0:off"</span> <span>\
</span><span></span>	--root-drive<span>=</span>./nginx_fc.ext4</code></pre></div>
<p>Here, we used here the <code>ip</code> kernel boot parameter to give the <code>172.16.0.42</code>.</p>

<p>Finally, we try out our nginx server:</p>
<div><pre><code data-lang="html">curl 172.16.0.42
<span>&lt;!DOCTYPE html&gt;</span>
&lt;<span>html</span>&gt;
&lt;<span>head</span>&gt;
&lt;<span>title</span>&gt;Welcome to nginx!&lt;/<span>title</span>&gt;
&lt;<span>style</span>&gt;
    <span>body</span> {
        <span>width</span>: <span>35</span><span>em</span>;
        <span>margin</span>: <span>0</span> <span>auto</span>;
        <span>font-family</span>: Tahoma, Verdana, Arial, <span>sans-serif</span>;
    }
&lt;/<span>style</span>&gt;
&lt;/<span>head</span>&gt;
&lt;<span>body</span>&gt;
&lt;<span>h1</span>&gt;Welcome to nginx!&lt;/<span>h1</span>&gt;
&lt;<span>p</span>&gt;If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.&lt;/<span>p</span>&gt;

&lt;<span>p</span>&gt;For online documentation and support please refer to
&lt;<span>a</span> <span>href</span><span>=</span><span>"http://nginx.org/"</span>&gt;nginx.org&lt;/<span>a</span>&gt;.&lt;<span>br</span>/&gt;
Commercial support is available at
&lt;<span>a</span> <span>href</span><span>=</span><span>"http://nginx.com/"</span>&gt;nginx.com&lt;/<span>a</span>&gt;.&lt;/<span>p</span>&gt;

&lt;<span>p</span>&gt;&lt;<span>em</span>&gt;Thank you for using nginx.&lt;/<span>em</span>&gt;&lt;/<span>p</span>&gt;
&lt;/<span>body</span>&gt;
&lt;/<span>html</span>&gt;</code></pre></div>
      
    </div></div>]]>
            </description>
            <link>https://blog.cloudkernels.net/posts/firecracker-rpi4/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24878698</guid>
            <pubDate>Sat, 24 Oct 2020 12:15:21 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Anki as Learning Superpower: Computer Science Edition]]>
            </title>
            <description>
<![CDATA[
Score 357 | Comments 214 (<a href="https://news.ycombinator.com/item?id=24878171">thread link</a>) | @Smaug123
<br/>
October 24, 2020 | https://www.gresearch.co.uk/article/anki-as-learning-superpower-computer-science-edition/ | <a href="https://web.archive.org/web/*/https://www.gresearch.co.uk/article/anki-as-learning-superpower-computer-science-edition/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
			<div>
        <p><span>Life at G-Research</span>
          <span>23/10/2020</span>
        </p>
			</div>
    </div><div>
			<div>
        
        <p><em>Patrick Stevens is a Developer at G-Research.</em></p>
<p>TL;DR: <em>If you aren’t using <a href="https://apps.ankiweb.net/">Anki</a> or one of its siblings to remember what you learn, you are missing out on literal superpowers. There are specific techniques which I’ve found helpful for using it to learn maths and computer science in particular.</em></p>
<p>This post will discuss extremely briefly what Anki is, but is mainly aimed at helping the student of maths or computer science to squeeze out some extra droplets of productivity from it. If you aren’t already familiar with Anki, go and read Michael Nielsen’s post <a href="http://augmentingcognition.com/ltm.html">Augmenting Long-Term Memory</a> as well or instead of this one; if you’re short of time, the main value of the post to someone new to Anki is in the first one-eighth or so, up to but not including “Using Anki to thoroughly read a research paper in an unfamiliar field”. That essay gives a broad-strokes motivation for why one might want to use Anki at all. (Spoiler: it gives you a superhuman memory!)</p>
<h2 id="what-is-anki-">What is Anki?</h2>
<p><a href="https://apps.ankiweb.net/">Anki</a> is a <a href="https://en.wikipedia.org/wiki/Spaced_repetition">spaced repetition system</a>: essentially a program that shows you flashcards at intervals tailored to help you remember their contents. Such systems are based on the observation that while you can’t stop memories from decaying, repeated exposure makes the decay exponentially slower.</p>
<p>So while you need to rehearse a fact frequently when you first come to learn it, reviews can become very sparse very quickly without losing much of your hard-won memory.</p>
<p>Anki is only one such system; other implementations such as SuperMemo and Mnemosyne exist.<br>
There are also applications using the same principles for more specific goals; for example, Memrise is designed for language learning. This post is phrased in terms of Anki, because for historical reasons that’s the one I use.</p>

<p>I’ve placed this section at the start, because I believe that spaced repetition is genuinely a superpower that anyone can acquire. If I can’t hold your interest in this post, I encourage you to glance over these other resources in the hope that one of them does the trick!</p>
<ul>
<li><a href="http://augmentingcognition.com/ltm.html">Augmenting Long-Term Memory</a> –&nbsp; a brief introduction to various memory systems with a particular focus on Anki. The money quote: “Anki makes memory a choice”. If you choose to remember something, you can.</li>
<li><a href="https://quantum.country/">Quantum Country</a> – an introduction to quantum computation with integrated spaced-repetition flashcards, which comes with emailed reminders to use the site at intervals. Even if you have no interest in quantum computation, I recommend skimming at least the first bits of the site, so that you can see what really good flashcards based on a text can look like. (Note that some of its cards are not ideal; the site does sometimes fall into the “yes/no” pattern, with flashcards whose answer is a bald “yes” or “no”. Cards of this form aren’t as good as cards which get you to reproduce actually content-based parts of a fact.)</li>
<li><a href="https://www.supermemo.com/en/archives1990-2015/articles/20rules">The Twenty Rules of Formulating Knowledge in Learning</a> – the creator of the spaced-repetition system SuperMemo discusses how to formulate knowledge so that it sticks. Again, even if you don’t use spaced repetition, definitely read this; the advice is absolutely foundational to my understanding of how to learn. A nontrivial amount of this very blog post is essentially specialising some of these rules to the case of maths and computer science.</li>
<li><a href="https://www.reddit.com/r/medicalschoolanki/">Reddit: Medical School Anki</a>, a subreddit with almost 55,000 subscribers at the time of writing. This link is here just to demonstrate that there are fields (such as medicine) in which Anki is very popular and nowhere near as niche as it is in most areas.</li>
</ul>

<p>Absolutely crucial to the effective use of Anki for even a moderate collection of cards is that answering a card should be a single mental motion.</p>
<p>What does this mean? We’ll demonstrate with some positive and negative examples.</p>
<ul>
<li>“What is the capital of France?” is probably answered with a single mental motion: it’s just “Paris”, obtained by a simple lookup in your memory.</li>
<li>“What is 367 times 399?” is many mental motions unless you are really unusually good at mental arithmetic. Almost everyone has to carry out some algorithm to get an answer to this question.</li>
<li>“What is the composition of air?” is probably many mental motions: for example, a lookup of “which gases are in air?” and a number of motions like “what proportion of air is this specific gas?”. Or it could be the various mental motions of “Which gas is the nth most common in air, and what is its proportion in air?” as n varies.</li>
<li>“What is the most common gas in air, and what is its proportion?” is very possibly a single mental motion despite the multiple components in its answer. For me, the knowledge that “nitrogen is the most common gas in air” is intimately bound up with “78% of air is nitrogen”; to answer one question is to access the same mental lump of storage as is required to answer the other question. Of course, for someone else, this may be two distinct facts and two distinct memory lookups.</li>
</ul>
<p>A card that is answered with one mental motion may be multiple motions for someone else; and a question answered with many mental motions may become one motion after you learn some additional fact or part of the model that ties the facts together. So it’s helpful if you personally keep track of what you’re doing to answer a given card, so that you can recognise some of this structure in your own mind.</p>
<p>Any card which is multiple mental motions should be broken down into smaller chunks.</p>
<p>If you’re doing too much work to answer a card, it’s important to notice, so that you can break the card down. And don’t worry that you might “break down a card too much”; if the cards are easy, Anki will exponentially decrease how often it shows them to you. The cost of creating a card that’s too easy is almost entirely in the time it takes you to create the card in the first place; a card that’s too difficult will sap your time and energy again and again.</p>

<p>As an example, recall the <a href="https://en.wikipedia.org/wiki/Ratio_test">ratio test for convergence</a>, likely to be covered in any first course in analysis:</p>
<p><em>Let$\sum_{n=1}^{\infty} a_n$ be a complex series, with each $a_i$ nonzero.<br>
Suppose that there is $a$ such that $|\frac{a_{n+1}}{a_n}| \to a$.<br>
Then, if $a &lt; 1$ then the series converges absolutely; if $a &gt; 1$ then the series diverges.</em></p>
<p>(We’ll discuss its proof in a later section.)</p>
<p>This statement has a number of moving parts, and is definitely much too large to appear as a single card. (Remember the rule of thumb: answering a single card should be a single mental motion.)<br>
How could we formulate this statement in an Anki-friendly way?</p>
<p>My own personal Anki collection contains the following cards. (Anki does allow LaTeX, though I often optimise for speed of card creation and just use plain text, however ugly it ends up. As long as it’s easily legible, it doesn’t need to be pretty.)</p>
<ul>
<li>What conditions exist on the ratio test? (answer: nonzero, sequence of ratios has a limit)</li>
<li>When does the ratio test let us conclude something? (answer: successive ratios converge to something not equal to 1)</li>
<li>Which cases exist on the ratio test? (answer: ratios converge to less than, or greater than, 1)</li>
<li>What can we say from the ratio test if the ratios converge to something less than 1? (answer: converges absolutely)</li>
<li>What can we say from the ratio test if the ratios converge to something greater than 1? (answer: diverges)</li>
<li>What can we say from the ratio test if the ratios converge to 1? (answer: nothing)</li>
<li>Give an example where the ratio test is inconclusive. (answer: <a href="https://en.wikipedia.org/wiki/Harmonic_series_(mathematics)">harmonic series</a>)</li>
</ul>
<p>All these cards are very simple; perhaps they might look laughably simple. This is fine! Remember that Anki will rapidly stop showing you cards you already know. Crucially each card is really a single mental motion to answer.</p>
<p>Note also that information is duplicated between cards. For example, there are two cards saying in slightly different ways that the ratio test talks about when successive ratios converge to something not equal to 1. Again, it’s fine to repeat information, because cards are cheap. Here, the information is duplicated to better facilitate the links between the cards: one card is a general “when can we conclude anything”, and one card is the same information rephrased as “which cases do I need to consider to produce more information here”. Without the additional rephrasing, there’s more of a risk of developing “isolated” clusters of cards; the aim is that given just the prompt “ratio test”, I can reproduce the <em>entire</em> cluster without thinking any further.</p>
<p>And don’t forget to store key examples and counterexamples!</p>

<p>Remembering a definition is rather like remembering the statement of a theorem.<br>
Without further ado, here is my definition of a <a href="https://en.wikipedia.org/wiki/Red-black_tree">red-black tree</a>:</p>
<ul>
<li>What, imprecisely, are the colouring rules on a red-black tree? (“global; local; base-case”)</li>
<li>What are the leaves of a red-black tree? (“null, black”)</li>
<li>What is the base-case colouring rule of a red-black tree? (“leaves are black”)</li>
<li>What is the local colouring rule of a red-black tree? (“red node =&gt; black children”)</li>
<li>What is the global colouring rule of a red-black tree? (“black depth is well defined”)</li>
<li>What is the black depth of a node in a red-black tree? (“the number of black nodes encountered on a path from that node down to a leaf”)</li>
</ul>
<p>Again, there is some duplication (two cards note that the leaves of a red-black tree are coloured black), and all the cards are extremely simple. The point is to make sure not only that the actual <em>content</em> is remembered, but also that the content is interlinked enough that you can reproduce the entire definition from the single prompt “red-black tree”. Moreover, one card is explicitly structural and carries no actual content as such: the card that lists the three types of colouring rule. This card is there solely to allow me to remember which <em>cards</em> are relevant.</p>
<p>Naively, one might create instead a single card, “what is a red-black tree?”. But in my experience, this is too big. If you’re reviewing even 30 cards a day, and …</p></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://www.gresearch.co.uk/article/anki-as-learning-superpower-computer-science-edition/">https://www.gresearch.co.uk/article/anki-as-learning-superpower-computer-science-edition/</a></em></p>]]>
            </description>
            <link>https://www.gresearch.co.uk/article/anki-as-learning-superpower-computer-science-edition/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24878171</guid>
            <pubDate>Sat, 24 Oct 2020 10:10:37 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Ungrammar]]>
            </title>
            <description>
<![CDATA[
Score 149 | Comments 14 (<a href="https://news.ycombinator.com/item?id=24878098">thread link</a>) | @todsacerdoti
<br/>
October 24, 2020 | https://rust-analyzer.github.io//blog/2020/10/24/introducing-ungrammar.html | <a href="https://web.archive.org/web/*/https://rust-analyzer.github.io//blog/2020/10/24/introducing-ungrammar.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
<p>So, what exactly does “describing syntax trees” mean and why is it useful?
When writing an IDE, one of the core data structure is the concrete syntax tree.
It is a full-fidelity tree which represents the original source code in detail, including parenthesis, comments, and whitespace.
CSTs are used for initial analysis of the language.
They are also a vocabulary type for refactors.
Although the ultimate result of a refactor is a text diff, tree modification is a more convenient internal representation.</p>

<p>At the lowest level, the CST is typically unityped: there’s some <code>Node</code> superclass, which has a collection of <code>Node</code> children and an optional <code>Node</code> parent.
On top of this raw layer, a more AST-like API is provided: <code>Struct</code> has a <code>.name()</code> and a list of <code>.fields()</code>, etc.
This typed API is huge!
For rust-analyzer, it is comprised of more than 130 <em>types</em>!
And it is also more detailed than a typical AST: <code>Struct</code> also has <code>.l_curly()</code> and <code>.r_curly()</code>.</p>
<p>What’s worse, this API changes a lot, especially at the beginning.
You may start with nesting <code>.fields()</code> directly under the <code>Struct</code>, but then introduce a <code>StructFields</code> node for everything between the curly braces to share the code with enum variants.</p>
<p>In short, writing this by hand sucks :-)
Ungrammar is a notation to concisely describe the structure of the syntax tree, which can be used by a code generator to build an API in the target language.
If you’ve heard about <a href="https://www.oilshell.org/blog/2016/12/11.html">ASDL</a>, ungrammar is ASDL for concrete syntax trees.
For rust-analyzer’s case, that means taking the following input:</p>
<div>
<div>
<pre><code><table><tbody><tr><td><pre>1
2
3
4
</pre></td><td><pre>Module =
  Attr* Visibility?
  'mod' Name
  (ItemList | ';')
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<p>And generating the following output:</p>
<div>
<div>
<pre><code data-lang="rust"><table><tbody><tr><td><pre>1
2
3
4
5
6
7
8
</pre></td><td><pre><span>impl</span> <span>ast</span><span>::</span><span>AttrsOwner</span>      <span>for</span> <span>Module</span> <span>{}</span>
<span>impl</span> <span>ast</span><span>::</span><span>VisibilityOwner</span> <span>for</span> <span>Module</span> <span>{}</span>
<span>impl</span> <span>ast</span><span>::</span><span>NameOwner</span>       <span>for</span> <span>Module</span> <span>{}</span>
<span>impl</span> <span>Module</span> <span>{</span>
    <span>pub</span> <span>fn</span> <span>mod_token</span><span>(</span><span>&amp;</span><span>self</span><span>)</span>       <span>-&gt;</span> <span>Option</span><span>&lt;</span><span>SyntaxToken</span><span>&gt;</span> <span>{</span> <span>...</span> <span>}</span>
    <span>pub</span> <span>fn</span> <span>item_list</span><span>(</span><span>&amp;</span><span>self</span><span>)</span>       <span>-&gt;</span> <span>Option</span><span>&lt;</span><span>ItemList</span><span>&gt;</span>    <span>{</span> <span>...</span> <span>}</span>
    <span>pub</span> <span>fn</span> <span>semicolon_token</span><span>(</span><span>&amp;</span><span>self</span><span>)</span> <span>-&gt;</span> <span>Option</span><span>&lt;</span><span>SyntaxToken</span><span>&gt;</span> <span>{</span> <span>...</span> <span>}</span>
<span>}</span>
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<p>In typical parser generators, something similar can be achieved by generating <em>both</em> the parser and the syntax tree from the same grammar.
This works to some extent, but has an inherent problem that the shape of the tree you want for the programmatic API, and the shape of the grammar you need to implement the parser are often different.
“Technical” transformations like left-recursion elimination don’t affect the language described by the grammar, but completely change the shape of the parse tree.
In contrast, ungrammar focuses solely on the second task, which radically reduces the complexity of the grammar.
In rust-analyzer, it is paired with a hand-written parser.</p>
<p>Treated as an ordinary (context free) grammar, ungrammar describes a superset of the language.
For example, for programmatic API it might be convenient to treat commas in comma-separate lists as a part of the list element
(rust-analyzer doesn’t do this yet, but it should).
This leads to the following ungrammar, which obviously doesn’t treat commas precisely:</p>
<div>
<div>
<pre><code><table><tbody><tr><td><pre>1
2
3
4
5
</pre></td><td><pre>FieldList =
  '{' Field* '}'

Field:
  Name ':' Type ','?
</pre></td></tr></tbody></table></code></pre>
</div>
</div>
<p>Similarly, ungrammar defines binary and unary expressions, but doesn’t specify their relative precedence and associativity.</p>
<p>An interesting side-effect is that the resulting grammars turn out to be pretty human readable.
For example, a full production ready Rust grammar takes about 600 short lines:<br></p>

<p>This might be a good fit for reference documentation!</p>
</div></div>]]>
            </description>
            <link>https://rust-analyzer.github.io//blog/2020/10/24/introducing-ungrammar.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-24878098</guid>
            <pubDate>Sat, 24 Oct 2020 09:55:32 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Faasd – Lightweight Serverless for Raspberry Pi]]>
            </title>
            <description>
<![CDATA[
Score 71 | Comments 46 (<a href="https://news.ycombinator.com/item?id=24877846">thread link</a>) | @alexellisuk
<br/>
October 24, 2020 | https://blog.alexellis.io/faasd-for-lightweight-serverless/ | <a href="https://web.archive.org/web/*/https://blog.alexellis.io/faasd-for-lightweight-serverless/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div role="main">
    <article>

        

        <section>
            <div><p>Kick the tires with faasd today, for a lightweight serverless experience that doesn't require Kubernetes. Instead it uses containerd and the existing OpenFaaS ecosystem.</p>
<blockquote>
<p>Last updated: 24th October 2020 - upgraded faasd &amp; containerd versions. Added instructions for core components logs such as the gateway.</p>
</blockquote>
<p>You can run <a href="https://github.com/openfaas/faasd">faasd</a> anywhere, even on a <a href="https://www.raspberrypi.org/">Raspberry Pi</a>, but why would you want to do that? faasd offers many of the benefits of containers and <a href="https://github.com/openfaas/faas">OpenFaaS</a>, but without the complexity and operational costs of Kubernetes. <a href="https://github.com/containerd/containerd">containerd</a> is a low-level tool for automating containers, and a <a href="https://landscape.cncf.io/">CNCF project</a>.</p>
<p><img src="https://blog.alexellis.io/content/images/2019/12/ofctr.png" alt="OpenFaaS and containerd logos"></p>
<p>The use-cases for <a href="https://blog.alexellis.io/introducing-functions-as-a-service/">Serverless / FaaS are fairly well-known</a>, but you could use faasd at the edge, in a smart-car, as part of an IoT device, for crunching data before uploading samples to the cloud, for webhook receivers/alerting, bots, webservices, API integrations or even providing your own APIs. Compute is compute, and OpenFaaS with containerd makes it easy to both consume and provide.</p>
<blockquote>
<p>🚀 Support the development of faasd - <a href="https://github.com/sponsors/openfaas">Sponsor OpenFaaS on GitHub</a><br>
⭐️ Star or fork <a href="https://github.com/openfaas/faasd">faasd on GitHub</a></p>
</blockquote>
<h2 id="beforewestart">Before we start</h2>
<p>Use Raspbian Lite (now called RaspiOS) for this tutorial. Do not install Docker on the same Raspberry Pi as it may cause conflicts with networking and the version of containerd we are using.</p>
<p>You should use RPi 2, 3 or 4. If you have only one Raspberry Pi, then you'll be able to deploy pre-built images from the OpenFaaS Function Store, but if you have a second Raspberry Pi, then you can use it to build new functions too.</p>
<p>You can also deploy to a PC or cloud VM:</p>
<ul>
<li><a href="https://www.openfaas.com/blog/faasd-tls-terraform/">Deploy faasd to DigitalOcean with Terraform</a></li>
<li><a href="https://github.com/openfaas/faasd/blob/master/docs/MULTIPASS.md">Deploy faasd to your laptop with Multipass</a></li>
</ul>
<h2 id="installation">Installation</h2>
<p>Installation only takes a few moments, and in the future should be quicker if we can secure binaries for containerd from the upstream project.</p>
<h3 id="getfaascli">Get <code>faas-cli</code></h3>
<p>The <a href="https://github.com/openfaas/faas-cli/">faas-cli</a> can be used to build, deploy, manage, and invoke functions with OpenFaaS. OpenFaaS offers a REST API, asynchronous invocations, authentication, metrics, and a UI out of the box.</p>
<p>Install using the utility script, or alternatively the binaries are also available on the <a href="https://github.com/openfaas/faas-cli/releases">releases page</a>.</p>
<pre><code># Install to local directory
curl -sLfS https://cli.openfaas.com | sh
sudo mv faas-cli to /usr/local/bin

# Or run with sudo to move to /usr/local/bin in one step
curl -sLfS https://cli.openfaas.com | sudo sh
</code></pre>
<p>See also: <a href="https://docs.openfaas.com/">OpenFaaS docs</a></p>
<h3 id="getcontainerd">Get containerd</h3>
<p>Unfortunately the <a href="https://github.com/containerd/containerd">containerd</a> maintainers only provide binaries for <code>x86_64</code> (regular PCs), so we have to install Go and build containerd from source.</p>
<p>We'll install some dependencies that will help us in the tutorial and after installation</p>
<pre><code>sudo apt update \
  &amp;&amp; sudo apt install -qy \
    runc \
    bridge-utils \
    tmux \
    git
</code></pre>
<p>Pick option A or B.</p>
<h4 id="ausemycontainerdarmhfbinariesfast">A) Use my containerd armhf binaries (fast)</h4>
<p>I have compiled binaries for containerd, which you can use if you wish. <a href="https://github.com/alexellis/containerd-armhf/releases">alexellis/containerd/armhf</a>.</p>
<pre><code>curl -sSL https://github.com/alexellis/containerd-arm/releases/download/v1.3.5/containerd-1.3.5-linux-armhf.tar.gz | sudo tar -xvz --strip-components=1 -C /usr/local/bin/
</code></pre>
<h4 id="bbuildyourowncontainerdbinariesslow">B) Build your own containerd binaries (slow)</h4>
<p>Raspbian needs a few additional build-time dependencies for containerd:</p>
<pre><code>sudo apt update \
  &amp;&amp; sudo apt install -qy \
    build-essential \
    libbtrfs-dev \
    libseccomp-dev
</code></pre>
<p>You can use my utility script to build containerd now:</p>
<pre><code>export GOPATH=$HOME/go/
mkdir $GOPATH/src/github.com/openfaas
cd $GOPATH/src/github.com/openfaas
git clone https://github.com/openfaas/faasd

cd cd faasd

./hack/build-containerd-armhf.sh
</code></pre>
<p>This could take a few moments on RPi2 or 3, and is a little quicker on RPi4.</p>
<h3 id="configurecontainerdtostartonboot">Configure containerd to start on boot</h3>
<p>Install a systemd unit file for <code>containerd</code>:</p>
<pre><code>curl -SLfs https://raw.githubusercontent.com/containerd/containerd/v1.3.5/containerd.service | sudo tee /etc/systemd/system/containerd.service

sudo systemctl enable containerd
sudo systemctl start containerd
</code></pre>
<p>Check that <code>containerd</code> started with <code>sudo systemctl status containerd</code>, if not then you may need to <code>unmask</code> it and run the commands again. See <a href="https://blog.ruanbekker.com/blog/2017/12/09/unmask-a-masked-service-in-systemd/">unmasking a service</a>.</p>
<h3 id="installnetworking">Install networking</h3>
<ul>
<li>
<p>Enable the Kernel's bridge module</p>
<pre><code># One-off
sudo modprobe br_netfilter &amp;&amp; \
sudo sysctl net.bridge.bridge-nf-call-iptables=1

# Make it permanent
echo "br_netfilter" | sudo tee -a /etc/modules-load.d/modules.conf

echo "net.bridge.bridge-nf-call-iptables=1" | sudo tee -a /etc/sysctl.conf
</code></pre>
</li>
<li>
<p>Install CNI plugins</p>
<p>Fortunately there are upstream ARM binaries available for the CNI plugins.</p>
<pre><code>sudo mkdir -p /opt/cni/bin

curl -sSL https://github.com/containernetworking/plugins/releases/download/v0.8.5/cni-plugins-linux-arm-v0.8.5.tgz | sudo tar -xz -C /opt/cni/bin
</code></pre>
</li>
<li>
<p>Enable NAT</p>
<p>Enable NAT between the container network and your wider network and the Internet:</p>
<pre><code>sudo /sbin/sysctl -w net.ipv4.conf.all.forwarding=1

echo "net.ipv4.conf.all.forwarding=1" | sudo tee -a /etc/sysctl.conf
</code></pre>
<p>Optional step - if you have Docker running on your system, then disable it and reboot at this point.</p>
<pre><code>sudo systemctl disable docker
sudo systemctl disable docker.sock # or docker.socket - You may also need this step
</code></pre>
<p>Docker's IP address range conflicts with the one chosen by netns, this will be resolved when moving to CNI.</p>
</li>
</ul>
<h3 id="getfaasd">Get <code>faasd</code></h3>
<p>faasd is a Go binary that runs on your system and packages all of OpenFaaS, it's a similar tool to docker-compose.</p>
<p>One of faasd's commands <code>faasd provider</code> runs an OpenFaaS provider which implements the OpenFaaS "CRUD" API for functions.</p>
<p>Clean-up old versions, if required:</p>
<pre><code># Stop systemd services, if you have them
sudo systemctl stop faasd
sudo systemctl stop faasd-provider

# Remove old binaries if you have them
sudo rm -rf /usr/local/bin/faasd
</code></pre>
<p>Download the faasd binary:</p>
<pre><code>sudo curl -sSLf "https://github.com/openfaas/faasd/releases/download/0.9.5/faasd-armhf" \
    --output "/usr/local/bin/faasd" \
    &amp;&amp; sudo chmod a+x "/usr/local/bin/faasd"
</code></pre>
<p>Now run the installation:</p>
<pre><code>export GOPATH=$HOME/go/
mkdir -p $GOPATH/src/github.com/openfaas
cd $GOPATH/src/github.com/openfaas

git clone https://github.com/openfaas/faasd --depth=1

cd faasd

sudo faasd install
</code></pre>
<h2 id="postinstall">Post-install</h2>
<p>The <code>faasd install</code> command creates two systemd unit files which can be used to start/stop <code>faasd</code> and <code>faasd-provider</code>.</p>
<h3 id="checktheinstallation">Check the installation</h3>
<p>Check the services:</p>
<pre><code>sudo systemctl status faasd
sudo systemctl status faasd-provider
</code></pre>
<p>Find logs:</p>
<pre><code>sudo journalctl -u faasd --lines 40
sudo journalctl -u faasd-provider --lines 40
</code></pre>
<p>You'll find your login details for the gateway in <code>/var/lib/faasd/secrets</code>, the user is <code>admin</code> and the password is in <code>/var/lib/faasd/secrets/basic-auth-password</code></p>
<h3 id="checkthelogsfromtheopenfaascoreservices">Check the logs from the OpenFaaS Core Services</h3>
<p>You can access the logs from any of the core services deployed with faasd as follows:</p>
<pre><code>sudo journalctl -t default:gateway --lines 40
sudo journalctl -t default:nats --lines 40
sudo journalctl -t default:queue-worker --lines 40
sudo journalctl -t default:prometheus --lines 40
</code></pre>
<p>For more, see the <code>docker-compose.yaml</code> file in the current directory.</p>
<h3 id="accessopenfaasfromyourlaptop">Access OpenFaaS from your laptop</h3>
<p>faasd deploys OpenFaaS along with its core logic <code>faasd-provider</code>, which uses containerd instead of Kubernetes to start, stop, and manage functions.</p>
<p>The <code>faasd</code> process will proxy any incoming requests on HTTP port 8080 to the OpenFaaS gateway container, you can also find the IP of the container in your <code>hosts</code> file in the <code>faasd</code> directory.</p>
<p>You can also access the built-in Prometheus container by editing <code>docker-compose.yaml</code> to expose its ports, either to 127.0.0.1, or all your network adapters.</p>
<h3 id="deployafunctionfromthestore">Deploy a function from the store</h3>
<p>Obtain your OpenFaaS password. You need to run this command on your Raspberry Pi:</p>
<pre><code>sudo cat /var/lib/faasd/secrets/basic-auth-password
</code></pre>
<p>Log in to the gateway, either on your RPi, or from your own computer.</p>
<pre><code># If connecting remotely
export IP=192.168.0.101
export OPENFAAS_URL=http://$IP:8080
echo $PASSWORD | faas-cli login

# Or on device:

sudo cat /var/lib/faasd/secrets/basic-auth-password | faas-cli login --password-stdin
</code></pre>
<p>Look at what's available in the function store for the armhf platform, then deploy something:</p>
<pre><code>faas-cli store list --platform armhf

# Deploy figlet
faas-cli store deploy --platform armhf figlet

# Find the URLs for the function
faas-cli store inspect figlet

# Create some ASCII

echo "faasd" | faas-cli invoke figlet
</code></pre>
<p>Try a function that can generate an <code>identicon</code> like you may have seen for default avatar logos on GitHub.com</p>
<pre><code>faas-cli store deploy --platform armhf identicon

echo $USER | faas-cli invoke identicon &gt; avatar.png
</code></pre>
<p>Here's an example of the avatar for the user <code>pi</code>:</p>
<p><img src="https://blog.alexellis.io/content/images/2020/01/avatar.png" alt="avatar"></p>
<h3 id="runanasyncfunction">Run an async function</h3>
<p>You can also run your functions in the background or asynchronously.</p>
<p>Create a webhook receiver using a public service such as:</p>
<ul>
<li><a href="https://requestbin.com/">https://requestbin.com/</a></li>
<li><a href="https://postb.in/">https://postb.in/</a></li>
</ul>
<pre><code>faas-cli store deploy --platform armhf nodeinfo

curl -d "verbose" \
  http://127.0.0.1:8080/async-function/nodeinfo \
  --header "X-Callback-Url: https://postb.in/1578562711776-8760500776115"
</code></pre>
<p>You'll be able to refresh your webhook receiver and see the value.</p>
<p><img src="https://blog.alexellis.io/content/images/2020/01/Screenshot-2020-01-09-at-09.41.11.png" alt="Screenshot-2020-01-09-at-09.41.11"></p>
<h3 id="buildanewcontainerimage">Build a new container image</h3>
<p>You'll need a second Raspberry Pi for this step since we do not have <code>docker</code> installed on the device.</p>
<p>There are a couple of workarounds if you don't have a second device: use buildkit per as my post <a href="https://blog.alexellis.io/building-containers-without-docker/">Building containers without Docker</a>. Or build on your PC using <a href="https://github.com/alexellis/multiarch-templates">one of my multi-arch templates</a>.</p>
<p>You can also use one of my prebuilt functions such as <a href="https://github.com/alexellis/2020/">ascii-2020</a>, but you should only run the <code>faas-cli deploy</code> step.</p>
<ul>
<li>
<p>Log into the Raspberry Pi with <code>ssh</code> and install the <code>faas-cli</code> and <code>docker</code>.</p>
<pre><code>curl -sLfS https://cli.openfaas.com | sudo sh
</code></pre>
<pre><code>curl -sLfS https://get.docker.com | sudo sh

sudo usermod -aG docker pi
newgrp
</code></pre>
</li>
<li>
<p>Log into the Docker Hub</p>
<pre><code>docker login
</code></pre>
</li>
<li>
<p>Create a Golang function</p>
<pre><code>export DOCKER_HUB_NAME="alexellis2"

faas-cli template store pull golang-middleware

faas-cli new --lang golang-middleware \
  hello-world \
  --prefix $DOCKER_HUB_NAME
</code></pre>
</li>
<li>
<p>Now build and push the image</p>
<pre><code>faas-cli push -f hello-world.yml
faas-cli deploy -f hello-world.yml
</code></pre>
</li>
</ul>
<h3 id="deployyournewcontainer">Deploy your new container</h3>
<p>You can set your OpenFaaS …</p></div></section></article></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://blog.alexellis.io/faasd-for-lightweight-serverless/">https://blog.alexellis.io/faasd-for-lightweight-serverless/</a></em></p>]]>
            </description>
            <link>https://blog.alexellis.io/faasd-for-lightweight-serverless/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24877846</guid>
            <pubDate>Sat, 24 Oct 2020 08:48:17 GMT</pubDate>
        </item>
    </channel>
</rss>
