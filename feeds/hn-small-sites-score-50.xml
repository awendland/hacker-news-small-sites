<rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>
<![CDATA[Hacker News - Small Sites - Score >= 50]]>
        </title>
        <description>
<![CDATA[Hacker News stories from domains that aren't in the top 1M and that have a score of at least 50. Updated nightly via https://github.com/awendland/hacker-news-small-sites]]>
        </description>
        <link>https://news.ycombinator.com</link>
        <generator>RSS for Node</generator>
        <lastBuildDate>Tue, 29 Sep 2020 08:26:55 GMT</lastBuildDate>
        <atom:link href="https://raw.githubusercontent.com/awendland/hacker-news-small-sites/generated/feeds/hn-small-sites-score-50.xml" rel="self" type="application/rss+xml"></atom:link>
        <pubDate>Tue, 29 Sep 2020 08:26:55 GMT</pubDate>
        <language>
<![CDATA[en-US]]>
        </language>
        <managingEditor>
<![CDATA[me@alexwendland.com (Alex Wendland)]]>
        </managingEditor>
        <ttl>240</ttl>
        <item>
            <title>
<![CDATA[All you need is λ, part one: booleans]]>
            </title>
            <description>
<![CDATA[
Score 107 | Comments 23 (<a href="https://news.ycombinator.com/item?id=24601981">thread link</a>) | @azhenley
<br/>
September 26, 2020 | https://antitypical.com/posts/2020-03-29-all-you-need-is-lambda-1-booleans/ | <a href="https://web.archive.org/web/*/https://antitypical.com/posts/2020-03-29-all-you-need-is-lambda-1-booleans/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
    


    <div role="main">
      <div>
        

<article>
  <p>Nearly a century ago, Alonzo Church invented the simple, elegant, and yet elusive lambda calculus. Along with Alan Turing, he then proved the Church-Turing thesis: that anything computable with a Turing machine can also be computed in the lambda calculus. However, nearly as soon as we had digital computers, we started inventing programming languages, and with them a vast treasure of features, beautiful and terrible, many of which seem very hard to relate to the fundamental nature of computability, let alone the lambda calculus specifically.</p>
<!--more-->
<p>While it’s true that anything which can be computed, period, can be computed in the lambda calculus, you might not want to: it’s austere, to say the least, and was not designed with modern sensibilities regarding readability in mind. We developed all those languages and features for a reason! Still, Church demonstrated not just that it was possible to compute anything computable with the lambda calculus, but also <em>how</em> one might do so.</p>
<p>In this series, we’ll examine some ways to express common programming language features using the minimalistic tools of the lambda calculus. We begin with perhaps the most ubiquitous type: booleans.</p>
<h2 id="λ-is-blind">λ is blind</h2>
<p>The lambda calculus’s austerity is extreme: you don’t even have booleans. All you have are:</p>
<ol type="1">
<li><p>Lambda abstractions;</p></li>
<li><p>Applications; and</p></li>
<li><p>Variables.</p></li>
</ol>
<p>We’ll now review these in some detail; feel free to skip this section if you’re already familiar with the lambda calculus.</p>
<h3 id="lambda-abstractions">Lambda abstractions</h3>
<p>Lambda abstractions (“lambdas,” “abstractions,” and “functions” will also be used interchangeably) introduce a function of a single variable.</p>
<p>Abstractions are written <code>λ x . y</code>, for variable <code>x</code> and expression <code>y</code>, where <code>x</code> is now available as a bound variable in the body, and any enclosing definition of <code>x</code> is shadowed (i.e.&nbsp;<code>λ x . λ x . x</code> = <code>λ x . λ y . y</code> ≠ <code>λ x . λ y . x</code>). (We shall assume strictly lexical scoping for the time being.)</p>
<p>In Haskell, we would write <code>\ x -&gt; y</code> instead; in JavaScript, <code>function (x) { return y }</code> or <code>(x) =&gt; y</code>.</p>
<h3 id="applications">Applications</h3>
<p>Applications (“function application” and “function call” will be used interchangeably) apply the result of the expression on the left to the expression on the right.</p>
<p>Applications are written as <code>x y</code>, for expressions x and y, and left-associated, i.e.&nbsp;<code>a b c</code> = <code>(a b) c</code> ≠ <code>a (b c)</code>. Function application binds tighter than lambda abstraction, i.e.&nbsp;<code>λ x . λ y . y x</code> = <code>λ x . λ y . (y x)</code> ≠ <code>λ x . (λ y . y) x</code>.</p>
<p>The syntax is the same in Haskell; in JavaScript, we would write <code>x(y)</code> or <code>a(b, c)</code>. Note however that since lambda calculus functions are all single-argument functions, a more direct (though less idiomatic) equivalent for the latter would be <code>a(b)(c)</code>.</p>
<h3 id="variables">Variables</h3>
<p>Variables introduced by enclosing lambdas.</p>
<p>Variable are written as more or less arbitrary names, typically alphanumeric (e.g.&nbsp;<code>x</code> or <code>y0</code> or <code>thing</code>); however, we will feel free to include non-alphanumeric characters in names as we see fit, since the paucity of syntax means there’s little risk of ambiguity.</p>
<p>Since the only available variables are those bound by enclosing lambdas, we can also infer that there are no <code>let</code> bindings for local variables, and no globals of any sort; the lambda calculus doesn’t come with a standard library.</p>
<h3 id="summary">Summary</h3>
<p>In quasi-BNF, the grammar for the lambda calculus is extremely minimal:</p>
<figure>
<p><em>e</em> <strong>:=</strong> <code>λ</code> <em>x</em> <code>.</code> <em>e</em> <strong>|</strong> <em>e</em> <em>e</em> <strong>|</strong> <em>x</em> <strong>|</strong> (<em>e</em>)</p>
</figure>
<p>And finally, this table gives a side-by-side comparison of the syntax of the lambda calculus with the corresponding syntax in Haskell &amp; JavaScript:</p>
<table>
<caption>
Syntax of the lambda calculus, Haskell, &amp; JavaScript
</caption>
<thead>
<tr>
<th scope="col">
</th>
<th scope="col">
Lambda calculus
</th>
<th scope="col">
Haskell
</th>
<th scope="col">
JavaScript
</th>
</tr>
</thead>
<tbody>
<tr>
<th scope="row">
Abstraction
</th>
<td>
<code>λ x . y</code>
</td>
<td>
<code>\ x -&gt; y</code>
</td>
<td>
<code>(x) =&gt; y</code>
</td>
</tr>
<tr>
<th scope="row">
Application
</th>
<td>
<code>f x</code>
</td>
<td>
<code>f x</code>
</td>
<td>
<code>f(x)</code>
</td>
</tr>
<tr>
<th scope="row">
Variable
</th>
<td>
<code>x</code>
</td>
<td>
<code>x</code>
</td>
<td>
<code>x</code>
</td>
</tr>
</tbody>
</table>

<h2 id="unconditional-λ">Unconditional λ</h2>
<p>Lambdas are the only way to introduce values—they’re the only “literal” syntax in the language. We can therefore infer that the only kinds of runtime values must be closures. In an interpreter for the lambda calculus, closures might consist of the name of the introduced variable, the body of the lambda, &amp; a map relating the names and values of any variables it closed over when constructed (again, we assume strict lexical scoping). There are no bits, bytes, words, pointers, or objects in the language’s semantics; only this runtime representation of lambdas.</p>
<p>Likewise, lambdas are also the only way to introduce variables—there’s no standard library, built-ins, primitives, prelude, or global environment to provide common definitions. We’re truly baking the apple pie from scratch.</p>
<p>All of this raises the question: how do you <em>do</em> anything when you don’t even have <code>true</code> and <code>false</code>? Lambdas and variables don’t <em>do</em>, they merely <em>are</em>, so that leaves application. When all you have is application, everything looks like a lambda abstraction, so we’ll represent booleans using lambdas.</p>
<p>Of course, it’s not <em>just</em> booleans we’re after; <code>true</code> and <code>false</code> aren’t much use without <code>and</code>, <code>or</code>, <code>not</code>, <code>if</code>, and all the rest. To be useful, our representation of booleans should therefore suffice to define these, as well. But how do you define <code>if</code> without using <code>if</code>? In a lazy language like Haskell, we might define <code>if</code> as a function something like so:</p>
<div id="cb1"><pre><code><span id="cb1-1"><span>if_ ::</span> <span>Bool</span> <span>-&gt;</span> a <span>-&gt;</span> a <span>-&gt;</span> a</span>
<span id="cb1-2">if_ cond then_ else_ <span>=</span> <span>if</span> cond <span>then</span> then_ <span>else</span> else_</span></code></pre></div>
<p>In a strict language like JavaScript, we’d instead take functions for the alternatives:</p>
<div id="cb2"><pre><code><span id="cb2-1"><span>function</span> <span>if_</span>(cond<span>,</span> then_<span>,</span> else_) {</span>
<span id="cb2-2">  <span>if</span> (cond) {</span>
<span id="cb2-3">    <span>then_</span>()<span>;</span></span>
<span id="cb2-4">  } <span>else</span> {</span>
<span id="cb2-5">    <span>else_</span>()<span>;</span></span>
<span id="cb2-6">  }</span>
<span id="cb2-7">}</span></code></pre></div>
<p>Both these definitions use the language’s native booleans and <code>if</code> syntax (a tactic for implementing embedded DSLs known as “meta-circularity”), and thus aren’t viable in the lambda calculus. However, they do give us a hint: in both cases we have a function taking a condition, consequence, and alternative, and using the first to select one of the latter two. In the lambda calculus, we might start by writing:</p>
<pre><code>if = λ cond then else . ?</code></pre>
<p>(Note: there aren’t any keywords in the lambda calculus, so there’s nothing stopping me from naming variables things like <code>if</code>, a fact which I will take free advantage of.)</p>
<p>We’ve introduced a definition for <code>if</code>, as a function of three parameters; now what do we do with them? The lambda calculus’s stark palette makes it easy to enumerate <em>all</em> the things we can do with some variable <code>a</code>:</p>
<ol type="1">
<li><p>Ignore it, whether by simply not mentioning it at all (as in <code>λ a . λ b . b</code>), or by shadowing it with another lambda which binds the same name (as in <code>λ a . λ a . a</code>).</p></li>
<li><p>Mention it, whether on its own in the body of a lambda (as in <code>λ a . a</code> or <code>λ a . λ b . a</code>), somewhere within either side of an application (as in <code>λ a . λ b . a b</code> or <code>λ a . λ b . b a</code>), or some combination of both (as in <code>λ a . (λ b . a) a</code>).</p></li>
</ol>
<p>We could for example simply return <code>then</code> or <code>else</code>:</p>
<pre><code>if = λ cond then else . then
if = λ cond then else . else</code></pre>
<p>But in that case the conditional isn’t conditional at all—the value in no way depends on <code>cond</code>. Clearly the body must make use of all three variables if we want it to behave like the <code>if</code>s we know and love from other languages.</p>
<p>Taking a step back for a moment, let’s examine the roles of <code>if</code>’s arguments. <code>then</code> and <code>else</code> are passive; we only want to use or evaluate one or the other depending on the value of <code>cond</code>. <code>cond</code>, then, is the key: it takes the active role.</p>
<p>Thus, in the same way that our <code>if_</code> functions in Haskell &amp; JavaScript employed those language’s features to implement, we’re going to define <code>if cond then else</code> as the application of the condition to the other two parameters:</p>
<pre><code>if = λ cond then else . cond then else</code></pre>

<p>This feels strangely like cheating: surely we’ve only moved the problem around. Now instead of <code>if</code> making the decision about which argument to return, we’ve deferred it to <code>cond</code>. But <code>if</code> and <code>cond</code> aren’t the same, semantically; <code>if</code> takes a boolean and two other arguments and returns one of the latter, while <code>cond</code> <em>is</em> a boolean—albeit evidently a boolean represented as a function. Let’s make that precise by writing down <code>if</code>’s type:</p>
<pre><code>if : Bool -&gt; a -&gt; a -&gt; a</code></pre>
<p>Notwithstanding our use of the yet-to-be-defined name <code>Bool</code> for the type of the condition, this is the same type as we gave <code>if_</code> in Haskell; that’s a good sign that we’re on the right track! It takes a <code>Bool</code> and two arguments of type <code>a</code>, and it must return one of those because that’s the only way for it to come up with the <code>a</code> that it returns. But what <em>is</em> <code>Bool</code>?</p>
<p>Working backwards from the type and definition of <code>if</code>, we see that <code>cond</code> is applied to two arguments, and therefore must be a function of two parameters. Further, these are both of type <code>a</code>, and the value it returns must also be of type <code>a</code> for <code>if</code>’s type to hold. Thus, we can define the type <code>Bool</code> like so:</p>
<pre><code>Bool = ∀ a . a -&gt; a -&gt; a</code></pre>

<p>If a given <code>Bool</code> is a function of two arguments of arbitrary type, returning the same type, it must therefore select one of its arguments to return. There are only two distinguishable inhabitants of <code>Bool</code>, <code>true</code> and <code>false</code>, so we can therefore deduce that since <code>if</code> defers the selection of the result to the <code>Bool</code>, for <code>true</code> and <code>false</code> to actually differ they must make opposite selections. In other words, <code>true</code> must return the <code>then</code> parameter, while <code>false</code> must return the <code>else</code> one:</p>
<pre><code>true, false : Bool
true  = λ then else . then
false = λ then else . else</code></pre>
<p>We didn’t move the problem around after all; we solved it. What we noticed was a deeper insight: this encoding of booleans makes <code>if</code> redundant, since if we can apply <code>if</code> to a <code>Bool</code> and two arguments, we could equally apply the <code>Bool</code> to those arguments directly.</p>

<p>It’s frequently convenient to conflate booleans with bits, their minimal representation, but in truth they’re not the same at all. Practically, some programming languages define booleans as a byte in memory, perhaps clamping its values to 0 and 1; others define them as instances of some boolean class, or constructors of an algebraic datatype. Some provide no formal relationship between <code>true</code> and <code>false</code> at all, save for a common interface—duck typing.</p>
<p>Mathematically, booleans are the values in propositional logic; the upper and lower bounds of a lattice; the zero and one of a semiring; the members of the set with cardinality 2; …</p></article></div></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://antitypical.com/posts/2020-03-29-all-you-need-is-lambda-1-booleans/">https://antitypical.com/posts/2020-03-29-all-you-need-is-lambda-1-booleans/</a></em></p>]]>
            </description>
            <link>https://antitypical.com/posts/2020-03-29-all-you-need-is-lambda-1-booleans/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24601981</guid>
            <pubDate>Sat, 26 Sep 2020 20:46:44 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Pikchr – PIC-like markup language for diagrams in technical documentation]]>
            </title>
            <description>
<![CDATA[
Score 62 | Comments 8 (<a href="https://news.ycombinator.com/item?id=24601971">thread link</a>) | @smartmic
<br/>
September 26, 2020 | https://pikchr.org/home/doc/trunk/homepage.md | <a href="https://web.archive.org/web/*/https://pikchr.org/home/doc/trunk/homepage.md">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><div>

<p>Pikchr (pronounced "picture") is a <a href="https://en.wikipedia.org/wiki/Pic_language">PIC</a>-like markup
language for diagrams in technical documentation.  Pikchr is
designed to be embedded in <a href="https://spec.commonmark.org/0.29/#fenced-code-blocks">fenced code blocks</a> of
Markdown or similar mechanisms of other documentation markup languages.</p>

<p>For example, the diagram:</p>
<!--0AE9A9FE7F8709DE1A4247530E0FFB195BDA2975EAEFFA8449101573E8B04ADB-->
<div><p>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 423.821 195.84">
<polygon points="146,37 134,41 134,33" style="fill:rgb(0,0,0)"></polygon>
<path d="M2,37L140,37" style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);"></path>
<text x="74" y="25" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">Markdown</text>
<text x="74" y="49" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">Source</text>
<path d="M161,72L258,72A15 15 0 0 0 273 57L273,17A15 15 0 0 0 258 2L161,2A15 15 0 0 0 146 17L146,57A15 15 0 0 0 161 72Z" style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);"></path>
<text x="209" y="17" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">Markdown</text>
<text x="209" y="37" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">Formatter</text>
<text x="209" y="57" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">(markdown.c)</text>
<polygon points="417,37 405,41 405,33" style="fill:rgb(0,0,0)"></polygon>
<path d="M273,37L411,37" style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);"></path>
<text x="345" y="25" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">HTML+SVG</text>
<text x="345" y="49" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">Output</text>
<polygon points="209,72 214,84 205,84" style="fill:rgb(0,0,0)"></polygon>
<polygon points="209,123 205,111 214,111" style="fill:rgb(0,0,0)"></polygon>
<path d="M209,78L209,117" style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);"></path>
<path d="M176,193L243,193A15 15 0 0 0 258 178L258,138A15 15 0 0 0 243 123L176,123A15 15 0 0 0 161 138L161,178A15 15 0 0 0 176 193Z" style="fill:none;stroke-width:2.16;stroke:rgb(0,0,0);"></path>
<text x="209" y="138" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">Pikchr</text>
<text x="209" y="158" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">Formatter</text>
<text x="209" y="178" text-anchor="middle" fill="rgb(0,0,0)" dominant-baseline="central">(pikchr.c)</text>
</svg>
</p>
<pre>arrow right 200% "Markdown" "Source"
box rad 10px "Markdown" "Formatter" "(markdown.c)" fit
arrow right 200% "HTML+SVG" "Output"
arrow &lt;-&gt; down 70% from last box.s
box same "Pikchr" "Formatter" "(pikchr.c)" fit
</pre>
</div>
<!--0AE9A9FE7F8709DE1A4247530E0FFB195BDA2975EAEFFA8449101573E8B04ADB-->

<p>Is generated by 7 lines of Markdown:</p>
<pre><code>   ``` pikchr
   arrow right 200% "Markdown" "Source"
   box rad 10px "Markdown" "Formatter" "(markdown.c)" fit
   arrow right 200% "HTML+SVG" "Output"
   arrow &lt;-&gt; down 70% from last box.s
   box same "Pikchr" "Formatter" "(pikchr.c)" fit
   ```
</code></pre>
<p>Pikchr diagrams can appear in:</p>

<ul>
<li>Documentation</li>
<li>Wiki pages</li>
<li>Tickets and bug reports</li>
<li>Forum posts</li>
<li>Check-in comments</li>
<li>Anywhere else that Markdown or similar markup languages are used</li>
</ul>

<p>Pikchr diagrams are easy to generate.  The language is simple.
There is lots of documentation and examples on-line (links below).
Anyone who is comfortable using Markdown should be able to pick up Pikchr
with minimal extra effort.</p>

<p>Pikchr is safe for use in internet-facing applications.  Hostile
Pikchr scripts cause no harm (apart from generating ugly diagrams).</p>

<h2>Demos</h2>
<ul>
<li><a href="https://pikchr.org/home/doc/trunk/doc/examples.md">Example Pikchr Scripts</a></li>
<li><a href="https://pikchr.org/home/pikchrshow">/pikchrshow</a> ← Enter Pikchr text and see the result on-line</li>
</ul>

<h2>Documentation Is A Work In Progress</h2>
<p>As of 2020-09-16, the Pikchr code is stable and is in active use.
However, documentation is still under development.
We are using Pikchr to write the Pikchr documentation (in Markdown),
hence it was necessary to deploy Pikchr into a working content
management system (<a href="https://fossil-scm.org/fossil">Fossil</a> in this case) prior to having
complete documentation available.  Volunteer assistance is welcomed!</p>

<h2>Pikchr Documentation (<em>still under development</em>)</h2>
<ul>
<li><a href="https://pikchr.org/home/doc/trunk/doc/userman.md">Pikchr User Manual</a></li>
<li><a href="https://pikchr.org/home/doc/trunk/doc/teardown01.md">An Example Of How A Pikchr Script Is Written</a></li>
<li><a href="https://pikchr.org/home/doc/trunk/doc/grammar.md">Pikchr Language Grammar</a></li>
<li><a href="https://pikchr.org/home/doc/trunk/doc/differences.md">Differences From PIC</a></li>
<li><a href="https://pikchr.org/home/doc/trunk/doc/usepikchr.md">Invoking Pikchr From Markdown</a></li>
<li><a href="https://pikchr.org/home/doc/trunk/doc/build.md">How To Build Pikchr From Source</a></li>
</ul>

<h2>Copies Of Historical PIC Documentation</h2>
<ul>
<li><a href="https://pikchr.org/home/uv/pic.pdf">BWK paper on the original PIC</a></li>
<li><a href="https://pikchr.org/home/uv/dpic-doc.pdf">DPIC Documentation</a></li>
<li><a href="https://pikchr.org/home/uv/gpic.pdf">ESR GnuPIC Docs</a></li>
</ul>

<h2>Source-Code License: 0-clause BSD</h2>
<p>The Pikchr source code is a self-contained original work.  It has no
external dependencies apart from the standard C library and does not
use code taken from the internet or other external sources.  All of the Pikchr
source code is released under a <a href="https://spdx.org/licenses/0BSD.html">zero-clause BSD license</a>.  After being
processed using <a href="https://www.sqlite.org/lemon.html">Lemon</a>, the Pikchr source code is a single
file of C89 named "<code>pikchr.c</code>".  These features
are designed to make Pikchr <a href="https://pikchr.org/home/doc/trunk/doc/integrate.md">easy to integrate into other systems</a>.</p>

</div>


</div></div>]]>
            </description>
            <link>https://pikchr.org/home/doc/trunk/homepage.md</link>
            <guid isPermaLink="false">hacker-news-small-sites-24601971</guid>
            <pubDate>Sat, 26 Sep 2020 20:45:33 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[How to properly manage SSH keys for server access]]>
            </title>
            <description>
<![CDATA[
Score 284 | Comments 142 (<a href="https://news.ycombinator.com/item?id=24599837">thread link</a>) | @mpaepper
<br/>
September 26, 2020 | https://www.paepper.com/blog/posts/how-to-properly-manage-ssh-keys-for-server-access/ | <a href="https://web.archive.org/web/*/https://www.paepper.com/blog/posts/how-to-properly-manage-ssh-keys-for-server-access/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
      <p>Every developer needs access to some servers for example to check the application logs.</p>
<p>Usually, this is done using public-private key encryption where each developer generates their own public-private key pair.
The public keys of each developer are added to the <code>authorized_keys</code> file on each server they should have access to.</p>
<h2 id="painful-manual-changes">Painful manual changes</h2>
<p>So far so good. However, what happens when one developer leaves the company?</p>
<p>In that case, the public keys of that developer should be removed from all servers. This could be quite a bit of work depending on how many servers they had access to.
And even worse, if it’s done manually, there is quite some risk that the key is still forgotten on some server, so the access remains open.</p>
<h2 id="alternative-solutions">Alternative solutions</h2>
<p>There are some commercial and open source solutions out there which want to help out with this problem. The basic idea is that you add and maintain the keys and the access lists on that service and when you remove a key, they will remove it from all your servers.</p>
<p>Sounds good, but it has one very big disadvantage: it’s a potential single source of failure. If someone captures access to that service, they can gain access to all your servers. And if you lose access to that service, you also lose access to all your servers in the worst case.</p>
<h2 id="the-solution-signing-keys">The solution: signing keys</h2>
<p>When I was facing this problem, I asked on <a href="https://news.ycombinator.com/item?id=24157180">HackerNews</a> how others are tackling this problem.</p>
<p>There were some great suggestions and insights from the community and the best solution to the problem seems to be the signing of keys which I will present to you here in detail.</p>
<h3 id="the-rough-idea">The rough idea</h3>
<p>The rough idea is this: You still generate a public-private key pair for each developer. However, you don’t upload the public keys to your servers.</p>
<p>Instead, you sign the public keys with a so-called certificate authority (CA) key which you generate before. This signing simply generates a third certificate file which you give back to the developer and they put it inside of their <code>.ssh/</code> folder next to the private and public key.</p>
<p>On the servers, you simply tell the server the public key of your CA and the server can detect if a user has a properly signed certificate and only allows access to the developers who have such a signed certificate.</p>
<h3 id="the-advantages">The advantages</h3>
<p>When you sign a certificate, you can determine how long that signing is valid. So if you sign it with a validity of 3 months and the developer leaves the company, then after 3 months they won’t have access to any of the servers for sure.</p>
<p>Now you say: well, but I don’t want to sign keys of everyone every 3 months which is a fair point.</p>
<p>One possibility is to automate the process for example by building a service where a user can automatically get a signed certificate when they authorize with their company e-mail and password, but that is beyond the scope of this article.</p>
<p>The simple alternative is that you issue certificates that are valid longer and then if someone leaves the company, you can revoke the certificate, i.e. invalidate it. You can put a list of invalid certificates on your servers and they will not accept the user any more.
This could for example be done by having this list on AWS S3 or some other storage and a cronjob on each server that regularly pulls this.</p>
<h3 id="show-me-how-to-do-this">Show me how to do this</h3>
<p>Glad that you asked!</p>
<p>It’s actually super simple once you know the drill.</p>
<p>First, you generate a certificate authority public-private key pair of which you should keep the private key very secure:</p>
<div><pre><code data-lang="bash">umask <span>77</span>                        <span># you want it to be private</span>
mkdir ~/my-ca <span>&amp;&amp;</span> cd ~/my-ca
ssh-keygen -C CA -f ca -b <span>4096</span>  <span># be sure to use a passphrase and store it securely</span>
</code></pre></div><p>Then on your server you specify that all users signed by your CA are allowed to access the server:</p>
<ol>
<li>Upload the public key of your CA on your server, e.g. at <code>/etc/ssh/ca.pub</code></li>
<li>Tell the server to allow access to users signed by it by adding a line to <code>/etc/ssh/sshd_config</code>:</li>
</ol>
<div><pre><code data-lang="bash">TrustedUserCAKeys /etc/ssh/ca.pub <span># Trust all with a certificate signed by ca.pub</span>
</code></pre></div><p>To make the changes effective, you should reload the ssh service: <code>sudo service ssh reload</code>.</p>
<p>Now if a developer generated their public-private key pair (e.g. <code>ssh-keygen -t ecdsa -b 521</code>), they simply send you their public key (note that you never need to send any private keys around!).
Then you sign their public key to generate their certificate:</p>
<div><pre><code data-lang="bash"><span># Inside your ~/my-ca folder, sign their public key (here: id_ecdsa.pub)</span>
ssh-keygen -s ca -I USER_ID -V +12w -z <span>1</span> id_ecdsa.pub
</code></pre></div><p>Quick explanation for the different parts:</p>
<ul>
<li><code>-s ca</code> - you want to use your CA to sign</li>
<li><code>-I USER_ID</code> - the id of your user / the username</li>
<li><code>-V +12w</code> - how long before the certificate expires - here valid for 12 weeks</li>
<li><code>-z 1</code> - the serial number of this certificate - can be used to make this particular certificate invalid later, should be unique</li>
<li><code>id_ecdsa.pub</code>: the public key of the developer which you want to sign</li>
</ul>
<p>It will generate the certificate <code>id_ecdsa-cert.pub</code> which you can send to the developer and they put it into their <code>~/.ssh</code> folder next to their public-private key pair.</p>
<h3 id="it-gets-even-better">It gets even better</h3>
<p>Sounds cool, right? But you can do even better!</p>
<p>You probably have developers with different experience and different teams and roles and not everyone accessing the same servers.</p>
<p>So let’s add roles into the signing process!</p>
<p>That way, on the server you specify which roles are allowed to access the server and during the signing process you specify the roles of the developer you are signing.</p>
<p>Then, that developer can access all servers matching to their roles.</p>
<p>When you on board a new developer, you only need to generate that one certificate and boom they have access to all relevant servers without adding anything on those servers.</p>
<p>Here is how this looks like schematically:</p>

  <figure>
    <img src="https://www.paepper.com/blog/posts/how-to-properly-manage-ssh-keys-for-server-access/ssh-keys-with-roles.png" alt="ssh certificate signing with roles">
    
      <figcaption>ssh certificate signing with roles</figcaption>
    
  </figure>


<p>This is how you configure roles on a server:</p>
<p>First, create the folder to configure access: <code>sudo mkdir /etc/ssh/auth_principals</code>
Inside that folder, you can create files with the name of the server user that someone could login as. For example to grant root access to some roles, add the file <code>/etc/ssh/auth_principals/root</code>.</p>
<p>Inside <code>/etc/ssh/auth_principals/root</code> you simply list all roles which should be able to login as root with one role per line:</p>
<p>Finally, configure on the server to use roles by again adding a line to <code>/etc/ssh/sshd_config</code>:</p>
<div><pre><code data-lang="bash">AuthorizedPrincipalsFile /etc/ssh/auth_principals/%u
</code></pre></div><p>To make the changes effective, you should reload the ssh service: <code>sudo service ssh reload</code>.</p>
<p>This is how you sign a key with roles (they are added to the certificate):</p>
<div><pre><code data-lang="bash">ssh-keygen -s ca -I USER_ID -n ROLE1,ROLE2 -V +12w -z <span>2</span> id_ecdsa.pub
</code></pre></div><p>It’s the same as before, but with the <code>-n ROLE1,ROLE2</code> flag. Important: there can’t be spaces between the comma for different roles!</p>
<p>Now, that developer could log onto any server where <code>ROLE1</code> or <code>ROLE2</code> are in an auth_principals file for a user name they try to login as.</p>
<h3 id="revoking-keys">Revoking keys</h3>
<p>Finally, if you want to invalidate a certificate, you can do that by the user name or the serial number of the certicate (<code>-z</code> flag). It’s recommended to make a list of generated certificates in an Excel spreadsheet or have a database depending on the number of your peeps.</p>
<div><pre><code data-lang="bash">ssh-keygen -k -f revoked-keys -u -s ca list-to-revoke
</code></pre></div><p>This is when you already have a <code>revoked-keys</code> list and want to update it (<code>-u</code> flag). For the initial generation, use it without the update flag.</p>
<p>The <code>list-to-revoke</code> needs to consist of usernames (ids) or serial numbers (<code>-z</code> flag during generation) like this:</p>
<pre><code>serial: 1
id: test.user
</code></pre><p>This would revoke access to the certificate with serial 1 and all certificates with id <code>test.user</code>.</p>
<p>To make the server respect revoked keys, you need to add the generated / updated <code>revoked keys</code> file to <code>/etc/ssh/revoked-keys</code> and configure it again in <code>/etc/ssh/sshd_config</code>:</p>
<p>Warning: make sure that the <code>revoked-keys</code> file is accessable and readable, otherwise you might lose access to your server</p>
<div><pre><code data-lang="bash">RevokedKeys /etc/ssh/revoked-keys
</code></pre></div><h2 id="summary-good-ssh-key-management">Summary: good ssh key management</h2>
<p>In my opinion, this solution is as good as it gets. You have the option to manage the access to your servers via ssh based on roles. You only need to configure your servers once (which roles are allowed to access it). For each new developer, you only need to generate a signed certificate and they immediately have access to all relevant machines matching their role / experience.
And when they leave the company, you can revoke their access also in a simple way.</p>
<p>And even if a mishap occurs and a developer leaves without having their access revoked, their certificate will expire after some time, so they also lose access automatically.</p>
<p>For small teams, you can do these steps manually as they are very fast to do; then as you grow, you can automate the certificate signing with a login service based on company authentication details.</p>
<p>Happy ssh-ing!</p>

    </div></div>]]>
            </description>
            <link>https://www.paepper.com/blog/posts/how-to-properly-manage-ssh-keys-for-server-access/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24599837</guid>
            <pubDate>Sat, 26 Sep 2020 16:13:09 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Stop Asking Me to “Sign Up” (2014)]]>
            </title>
            <description>
<![CDATA[
Score 372 | Comments 235 (<a href="https://news.ycombinator.com/item?id=24599642">thread link</a>) | @jeremylevy
<br/>
September 26, 2020 | https://www.gkogan.co/blog/stop-asking-me-to-sign-up/ | <a href="https://web.archive.org/web/*/https://www.gkogan.co/blog/stop-asking-me-to-sign-up/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    <p><img src="https://d33wubrfki0l68.cloudfront.net/6682ce0e9be9292fb093d16e4b89a6cbec481554/1fe8d/images/uploads/sign-up-buttons.png" alt="SaaS Startups Using Sign Up Buttons"></p>

<p>The fate of many&nbsp;startups depends almost entirely on one&nbsp;conversion point: When a visitor becomes a user.</p>

<p>All too often, this pivotal role&nbsp;falls on the shoulders of a pitifully generic “sign up” button that’s lucky to get even a minute of consideration during development.</p>

<p>If you take a moment to consider the wording of your signup button, you can drastically increase how many of your visitors turn into users.</p>

<p><em>(What happens after the conversion is important, too, but things get significantly easier once you have someone’s email and opt-in.)</em></p>
<h2>Why "Sign Up" buttons don't work.</h2>
<ul>
  <li><strong>They're&nbsp;ignored.&nbsp;</strong>When visitors see common elements repeated on many sites, they begin unconsciously ignoring those elements (aka "habituation").&nbsp;Doesn't matter if they're blue or green or hell-fire-orange.</li>
  <li><strong>You're asking for blind commitment.</strong>&nbsp;Don't&nbsp;assume visitors&nbsp;know what you're asking them to sign up for. People don't read pages, they skim. They could've easily missed the part where you mention a&nbsp;free trial or key benefits.</li>
  <li><strong>You're not offering any value.</strong> Asking someone to "sign up" offers no help in changing the visitor's thinking from "Why should I?" to "I want this!"</li>
</ul>
<h2>How to get more signups&nbsp;from your signup button:</h2>
<ul>
  <li><strong>Tie it to your product.</strong> If you have a SaaS for trading bitcoins: "Start Trading Bitcoins." If&nbsp;you have a marketplace for artists: "Start Selling Art." This helps prevent the button from being overlooked.</li>
  <li><strong>Give, don't take.</strong> "Get Access" and "Sign Up" both lead to the same thing, but one makes the visitor feel they're getting something, while the other doesn't.</li>
  <li><strong>Compel people to act.</strong> Use action verbs such as <em>get</em>, <em>start</em>, and <em>try</em>.</li>
</ul>
<p>Examples from startups that get it right:</p>

<p><img src="https://d33wubrfki0l68.cloudfront.net/a5e786dc725cdf0d2cc7d265cf2130fd5e785f5e/09f83/images/uploads/sign-up-buttons-2.png" alt="Startups with Good Signup Buttons"></p>

<p>(I especially like gliffy’s “Start Drawing,” which implies how quickly you can get started, and directly relates to&nbsp;their product: <a href="http://www.gliffy.com/">an app for easily drawing diagrams</a>.)</p>
<h2>Case study: Getting 3x more clicks by changing two words.</h2>
<p>Take this example from one of my clients. Like many software companies, Scalyr—a <a href="https://www.scalyr.com/">log aggregation and monitoring tool</a>—asked its visitors to “sign up.” I suggested that we test a version of the button that <em>gives</em> and <em>compels</em>: “Try it Free”. Here’s what happened:</p>

<p><strong>Asking visitors to <em>Try it Free</em> <span>increased clicks by 212%</span>.</strong></p>

<p>Complete obliteration of the old “Sign Up” button, and a&nbsp;huge win for a test that took two minutes to set up.</p>

<p><img src="https://d33wubrfki0l68.cloudfront.net/7562f9ce9e08b024e6c838126e1d6f54e24e07ed/7465d/images/uploads/scalyr-test-result.png" alt="A/B test on Scalyr resulted in 212% increase in clicks."></p>
<h2>Now try it yourself...</h2>
<p>Test a variation of your “sign up” button with something that <em>gives</em>,&nbsp;<em>compels</em>, and is <em>tied to your product</em>. It’s one of the easiest things to test, and could have a huge effect on your conversion rates. If you follow my advice then you’re almost certain to do better than asking visitors to “sign up.”</p>


    <p>◼</p>

    <p>PS - Liked this article? I write one every month or so, covering lessons learned on B2B startup growth. Don't miss the next one:</p>

    <!-- Begin MailChimp Signup Form -->
    

    <!--End mc_embed_signup-->
    
    <p>If you need help with marketing and revenue growth, <a href="https://www.gkogan.co/contact/">get in touch</a>.</p>

  </div>

  

  
  
  



</article>

<!-- Begin MailChimp popup signup form -->



<!-- End MailChimp popup signup form -->
      </div>
    </div></div>]]>
            </description>
            <link>https://www.gkogan.co/blog/stop-asking-me-to-sign-up/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24599642</guid>
            <pubDate>Sat, 26 Sep 2020 15:47:39 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Towards Principled Reactive UI]]>
            </title>
            <description>
<![CDATA[
Score 205 | Comments 79 (<a href="https://news.ycombinator.com/item?id=24599560">thread link</a>) | @raphlinus
<br/>
September 26, 2020 | https://raphlinus.github.io/rust/druid/2020/09/25/principled-reactive-ui.html | <a href="https://web.archive.org/web/*/https://raphlinus.github.io/rust/druid/2020/09/25/principled-reactive-ui.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    <p>This is a followup to my post about a year ago, <a href="https://raphlinus.github.io/ui/druid/2019/11/22/reactive-ui.html">Towards a unified theory of reactive UI</a>. It is a deeper exploration of the question: “what is the best way to express reactive UI in Rust?”</p>

<h2 id="introduction">Introduction</h2>

<p>There is an astonishing diversity of “literature” on reactive UI systems. I put “literature” in quotes here, because, with some exceptions, the best primary sources are the code of open source projects. Some of the diversity comes from differences in goals, but some of it is accidental. In many cases, it’s simply because the designers didn’t have insight at the time about better solutions. My post last year attempted to put some order to this diversity, by discovering common patterns.</p>

<p>I believe it’s likely that the answer to “the best way to express reactive UI in Rust” is to be found in the existing literature, at least by combining major themes, if not in a single existing system to copy. It seems unlikely we’ll have to invent something completely new. But sorting through it is not easy. It is not the intent of this post to provide a comprehensive review of the literature (though I think such a thing would be interesting), it is to guide inquiry into the most promising avenues. I want to do mining, not stamp collecting. Where is the richest vein of ore?</p>

<p>To focus the inquiry, I will start by listing some goals. While in general these goals all seem like good things, it’s important to understand them as tradeoffs. Prioritizing different goals will lead you to different places, and not everyone has the same needs. Take overall system complexity, for example. If you’re a trillion dollar corporation, then a complex system is merely a question of allocating resources, and may even be strategically useful as a moat to discourage competition. But if you’re an indie game developer trying to integrate basic UI, you have a very different perspective.</p>

<p>Each goal will be presented primarily as a way to introduce design decisions made by existing reactive systems, and filter the ones that seem most promising as sources and inspiration.</p>

<p>Then I will go into deeper into three principles, which I feel are critically important in any reactive UI framework: whether to use “observable objects,” how to express the mutation of the render object tree (or trees in general), and the notion of stable identity of nodes in that tree.</p>

<p>Finally, I will introduce <a href="https://github.com/raphlinus/crochet">Crochet</a>, a research prototype built for the purpose of exploring these ideas.</p>

<h2 id="goals">Goals</h2>

<h3 id="concise-expression-of-application-logic">Concise expression of application logic</h3>

<p>The main point of a reactive UI architecture is so that the app can express its logic clearly and concisely, and the results can drive the rest of the UI stack in a reasonable way.</p>

<p>A central feature of reactive UI is for the app to declaratively express the current state of the view tree. In traditional object-oriented UI, it’s more common to specify the initial state (often as a static document, not even code), plus additional logic for state changes. I think the debate is now essentially over, the reactive approach is winning.</p>

<p>SwiftUI has gained considerable attention due to its excellent ergonomics in this regard. But other approaches are also worth studying. In particular, immediate mode GUI (<a href="https://github.com/ocornut/imgui">imgui</a>) is nearly as declarative, it just achieves it in a very different way (about which more below). And React and its many derivatives are also “good enough.” <a href="https://svelte.dev/">Svelte</a> is another example from the JS world that deserves praise, though considerably more difficult to adapt to Rust because of its reliance on a sophisticated compiler.</p>

<p>It’s very popular in Rust GUI land to adapt <a href="https://guide.elm-lang.org/architecture/">Elm</a> patterns; we see clear influence in <a href="https://github.com/antoyo/relm">relm</a>, <a href="https://github.com/hecrj/iced">Iced</a>, <a href="https://github.com/bodil/vgtk">vgtk</a>, and others. But I think much of the conciseness and friendliness of Elm comes from the language itself, particularly its facility with higher-order composition. When adapting to a more pragmatic language such as Rust, I consider each subtask of view building and dispatching messages to components as each a half-lens, requiring the writing out of two pieces of logic to integrate a component. For this reason, I find Rust UI code adapted from Elm to be not as clear and concise as possible.</p>

<p>A great resource for comparing the concision of different toolkits is <a href="https://eugenkiss.github.io/7guis/">7GUIs</a>. We don’t have these ported to Crochet yet, except for counter, but plan to. For reference, here’s the <code>run</code> method for that:</p>

<div><div><pre><code>    <span>fn</span> <span>run</span><span>(</span><span>&amp;</span><span>mut</span> <span>self</span><span>,</span> <span>cx</span><span>:</span> <span>&amp;</span><span>mut</span> <span>Cx</span><span>)</span> <span>{</span>
        <span>Label</span><span>::</span><span>new</span><span>(</span><span>format!</span><span>(</span><span>"current count: {}"</span><span>,</span> <span>self</span><span>.count</span><span>))</span><span>.build</span><span>(</span><span>cx</span><span>);</span>
        <span>if</span> <span>Button</span><span>::</span><span>new</span><span>(</span><span>"Increment"</span><span>)</span><span>.build</span><span>(</span><span>cx</span><span>)</span> <span>{</span>
            <span>self</span><span>.count</span> <span>+=</span> <span>1</span><span>;</span>
        <span>}</span>
    <span>}</span>
</code></pre></div></div>

<h3 id="actually-being-incremental">Actually being incremental</h3>

<p>While imgui can express UI concisely, it cheats somewhat by not being incremental. Generally, it makes up for this by being able to repaint the world very quickly (using GPU acceleration), but there are downsides, including power consumption. In the context of a game which is actively using the GPU anyway, it’s fine, but is a good reason not to choose imgui outside that context.</p>

<p>The documentation of <a href="https://github.com/PistonDevelopers/conrod">Conrod</a> expresses a goal fairly well: “Conrod aims to adopt the best of both worlds by providing an immediate mode API over a hidden, retained widget state graph.” And once you have that, doing efficient incremental updates in the retained widget graph is a solved problem, though the details can be intricate. Unfortunately, I do not believe Conrod delivers on this promise, because app logic does an awful lot of explicit graph construction and juggling of node id’s, neither of which you would find in an actual immediate mode API.</p>

<p>On the other side, <a href="https://github.com/hecrj/iced">Iced</a>, while having many desirable properties, does not satisfy the “actually incremental” goal: while there is caching in the renderer, it builds a full view tree every 16ms (actually twice when there are incoming events). This is fine when the view tree is relatively small, but is a serious problem at scale.</p>

<p>The popularity of “virtual DOM” approaches requires a discussion of diffing, which I feel is (modulo escape hatches for lower level direct tree mutation) a form of half-incrementality. The idea is that it should be cheap to produce a full view tree, then a reconciliation engine computes a minimal diff between that and the old tree, which is then be applied, through DOM mutation or some other means. Because DOM is slow, it’s certainly faster than ham-handed direct DOM mutation (which is difficult to make truly minimal), but still creates performance problems as the view tree grows. React programmers should be well familiar with this issue.</p>

<p>When escape hatches are provided, are they a reasonably principled way to achieve lower level access to tree mutation, simply shifting some tracking of state to the component (often a list view or similar collection), or are they a dirty hack to work around fundamental architectural decisions that limit performance? Both are represented in the literature.</p>

<h3 id="tab-focusing">Tab focusing</h3>

<p>It seems like a relatively simple feature, but proper implementation of tab focusing requires fairly deep architectural support (or, in the case of Web-based UI, it is punted to the browser). Basically, it requires the toolkit to maintain state of which widget is focused, and to query enough of the entire view tree to determine which is the next in tab focus order. Proponents of imgui have suggested a very hacky partial solution (see <a href="http://www.johno.se/book/imgui.html">johno on IMGUI</a>), but I find such things unsatisfying.</p>

<p>Again, Iced is an example of an existing Rust GUI toolkit that is lacking this feature, and I think would require nontrivial architectural work to address, at least in a systematic way that would satisfy similar future needs. Down the line, those needs include accessibility, a serious Achilles heel for imgui-flavored designs in particular.</p>

<p>I believe a proper approach to this problem involves stable identity of widgets, about which much more below.</p>

<h3 id="simple-types">Simple types</h3>

<p>Now we get into more controversial goals. One that I personally am finding increasingly important is expressing the interface between app logic and UI toolkit using simple types.</p>

<p>Rust in particular invites the use of complex types, largely because it has a rich type system that is capable of expressing many concepts as types. By contrast, it’s traditional in object oriented UI to have very loosely coupled dynamic typing; a lot of the values being passed around have a type which is some variant of “any.”</p>

<p>A great example of complex types is SwiftUI, in which a component returns a statically-known type implementing the <a href="https://developer.apple.com/documentation/swiftui/view"><code>View</code></a> protocol. As a consequence, the concrete return type of a component generally encodes its entire view hierarchy, including special conditional and looping combinators; this is explained well in the <a href="https://www.objc.io/blog/2019/11/05/static-types-in-swiftui/">Static Types in SwiftUI</a> blog.</p>

<p>There are advantages to such a scheme, but also serious downsides. Error messages from the compiler get… interesting. And it also has a serious impact on compile times, as (at least in Rust) the compiler has to monomorphize the types before even starting to generate code.</p>

<p>To me, one of the most serious drawbacks to the complex type approach is that scripting languages can’t easily play, as the types must be known at compile time.</p>

<p>Again, imgui is an example of an architecture that avoids complex types, by drawing the UI directly rather than constructing an intermediate tree of view objects. But imgui is not the only such; another compelling example to learn from is <a href="https://medium.com/androiddevelopers/under-the-hood-of-jetpack-compose-part-2-of-2-37b2c20c6cdd">Jetpack Compose</a>.</p>

<h3 id="simple-control-flow">Simple control flow</h3>

<p>It is very tempting to use complex control flow patterns: putting significant logic in callbacks, using higher order composition techniques, or using a compiler to significantly transform the code. Yet, such techniques have downsides.</p>

<p>The first is simply that this complexity leaks out into the app. In current Druid, we use some higher order composition techniques such as lenses. While fairly simple by Haskell standards, and our users with Haskell background tend to like them, a lot of people coming to Druid find them confusing.</p>

<p>The simplest mechanism for …</p></div></article></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://raphlinus.github.io/rust/druid/2020/09/25/principled-reactive-ui.html">https://raphlinus.github.io/rust/druid/2020/09/25/principled-reactive-ui.html</a></em></p>]]>
            </description>
            <link>https://raphlinus.github.io/rust/druid/2020/09/25/principled-reactive-ui.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-24599560</guid>
            <pubDate>Sat, 26 Sep 2020 15:36:12 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[The fresh smell of ransomed coffee]]>
            </title>
            <description>
<![CDATA[
Score 130 | Comments 178 (<a href="https://news.ycombinator.com/item?id=24599434">thread link</a>) | @zdw
<br/>
September 26, 2020 | https://decoded.avast.io/martinhron/the-fresh-smell-of-ransomed-coffee/ | <a href="https://web.archive.org/web/*/https://decoded.avast.io/martinhron/the-fresh-smell-of-ransomed-coffee/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article id="post-720">

                    
                    
                    
                    <div>
                        
<div><figure><img src="https://lh3.googleusercontent.com/edWAE16W2o2XYc5tH2XhF49IdvtCSlgypcNVCDiuoLXHmq-1Cs3oN4fbZMwIhrnyKmx4HCDBi4u8oIA8FalwMddd_dHQ9emWYzmv6EWZTAqccf4_OFsrb2trEqiK-K7I3m8y4Si_" alt=""></figure></div>



<p>We turned a coffee maker into a dangerous machine asking for ransom by modifying the maker’s firmware. While we could, could someone else do it too? As you might expect, the answer is: Yes. Follow us on a journey where we show you that firmware is the new software.&nbsp;</p>







<p>Some research is so fun that it confirms why I do this work. I was asked to prove a myth, call it a suspicion, that the threat to IoT devices is not just to access them via a weak router or exposure to the internet, but that an IoT device itself is vulnerable and can be easily owned without owning the network or the router. I also bet that I could make that threat persist and present a true danger to any user. We often say that your home network, thought of as a chain of trust, is only as strong as its weakest link, but what if the same were true at the device level? What would that mean?&nbsp;</p>



<p>Let’s say you have an IoT device that is well protected with functions that can be accessed through a well-defined API; even if you can control the device through the API, you probably can’t do too much harm. Firmware, the programming inside the device has logical constraints that don’t allow you, for example, to close garage doors while someone is in the way of them or overheat a device so that it combusts.&nbsp;</p>



<p>We used to trust that hardware, such as a common kitchen appliance, could be trusted and could not be easily altered without physically dismounting the device. But with today’s “smart” appliances, this is no longer the case.</p>



<p>My colleagues often hear me say that&nbsp; “firmware is a new software.” And that software is very often flawed. We see it everywhere. CPU flaws, and cryptographic chips generating weak keys that can be easily broken. The weakened state of IoT security is due in large part to the fact that, nowadays, it is more convenient and cheap to place a processor inside a device which controls and orchestrates all hardware parts, motors, sensors, heating elements, etc. based on a short program called firmware. This solution is not only cheap, but has also one important property – it can be updated</p>



<p><br>Back in the day, if there was a so-called design flaw in a piece of hardware, the rigid design (often hardwired) meant the vendor would need to replace the whole component or logic board or even replace the entire device. Manufacturers would have to change the manufacturing process and at potentially great financial losses. In the era of firmware, this can be easily mitigated just by issuing a firmware update.&nbsp;</p>



<p>The process of updating firmware can vary greatly, from connecting to the special device using a special tool (which still requires the vendor’s physical interaction) to the more and more popular way of OTA (over the air) updates. In this case, a vendor doesn’t have to be physically present and the whole process is done either automatically over the internet or semi-automatically after a user’s notification and approval of the update.&nbsp;</p>







<div><p>So let’s see what we have. We have a coffee maker that allows you to make coffee the old fashioned way by pressing a few buttons or via a mobile phone or tablet using an app. The maker operates with Wi-Fi and when unboxed you have to connect it to your network through a companion app on your mobile phone. When turned on for the first time, the coffee maker works in a local mode and it creates its own Wi-Fi network that the hopeful coffee drinker first connects to in order to set up the device.&nbsp;</p><p>It’s worth to mention that this coffee maker is no longer supported by the vendor as they moved to a more secure platform in 2017 and technology because of all the flaws illustrated in this research. But this also shows a general problem we have with abandoned IoT devices.</p><p>When we downloaded the companion app, we saw that it allows you to create a network of any&nbsp; devices of this particular vendor and connects these devices to the&nbsp; home network and then allows you to control all the functions of your coffee maker or smart kettle. It also allows you to check the firmware version of the device and update it if needed.&nbsp;</p></div>



<p>The protocol that this device speaks has already been documented on the internet by <a href="#references">several other researchers</a>. As expected, it’s a simple binary protocol with hardly any encryption, authorization or authentication. Communication with machines takes place on <code>TCP</code> port <code>2081</code>. The format of the command is very simple:</p>



<div><figure><img loading="lazy" width="593" height="111" src="https://decoded.avast.io/wp-content/uploads/sites/2/2020/09/image-6.png" alt="" srcset="https://decoded.avast.io/wp-content/uploads/sites/2/2020/09/image-6.png 593w, https://decoded.avast.io/wp-content/uploads/sites/2/2020/09/image-6-300x56.png 300w" sizes="(max-width: 593px) 100vw, 593px"></figure></div>







<p>In response (if there is a response) the coffee maker sends back:</p>



<div><figure><img loading="lazy" width="593" height="111" src="https://decoded.avast.io/wp-content/uploads/sites/2/2020/09/image-10.png" alt="" srcset="https://decoded.avast.io/wp-content/uploads/sites/2/2020/09/image-10.png 593w, https://decoded.avast.io/wp-content/uploads/sites/2/2020/09/image-10-300x56.png 300w" sizes="(max-width: 593px) 100vw, 593px"></figure></div>



<p><code>response_type</code> differs based on the command, but the general rule is: If the response contains data <code>response_type = command + 1</code>, if it’s just a status then <code>response_type=3</code> and then there is only one <code>data</code> byte which contains resulting status, where <code>1</code> means success. The complete list of commands is in the  <a href="https://github.com/avast/ioc/tree/master/SmarterCoffee" target="_blank" rel="noreferrer noopener">GitHub repository</a>.<br></p>



<p>&nbsp;So just for illustration, by issuing this command:</p>



<div><figure><img loading="lazy" width="396" height="78" src="https://decoded.avast.io/wp-content/uploads/sites/2/2020/09/image-8.png" alt="" srcset="https://decoded.avast.io/wp-content/uploads/sites/2/2020/09/image-8.png 396w, https://decoded.avast.io/wp-content/uploads/sites/2/2020/09/image-8-300x59.png 300w" sizes="(max-width: 396px) 100vw, 396px"><figcaption><em>making a nice cup of coffee with “default” settings</em></figcaption></figure></div>







<p>You’ll make yourself a nice cup/cups of coffee based on the default settings of the coffee maker. As you can see, there is no security, so anyone who has access to the network and is able to reach the IP address of the coffee maker can control it. What is more interesting, is that all these commands are also available through that default opened Wi-Fi network when the device is not joined to a home network yet.&nbsp;</p>







<p>Let’s return to our main goal of hijacking the coffee maker for nefarious purposes. How secure is the updating process? Can we break into it? Can we even change the firmware to do something else than was originally intended? Can we turn the device into a physically dangerous device? Can we do it remotely? As I said in the beginning, the weakest link always compromises the whole system. Either it’s a network or a device. The goal is answering all the above questions and prove that IoT devices could be also compromised at the firmware level.</p>



<p>To start, we wanted to learn how the update process works. We have several options to do this, but we already have a recipe for this based on similar past research we have done. The general rule is to make it as simple as possible; here is our to-do list when trying to reverse the update process of a piece of firmware.</p>



<ol><li>Get it (the file with the firmware)</li><li>Unpack it (if it is packed/encrypted)</li><li>Reverse engineer it (translate those zeroes and ones into meaningful code)</li><li>Modify it (add the malicious content)</li><li>Upload it (and push it back to the device)</li></ol>



<p>It’s simple right?</p>







<p>First, we need to get the firmware somehow, and again there are several options. Let’s stick to the rule, the simplest option first:</p>



<ol><li>Google it – as obvious as it seems,&nbsp; sometimes security researchers omit this step which could save them a lot of work. Firmware is often available on the internet to be downloaded.</li><li>Capture and analyze network traffic – if the protocol is unencrypted the easiest way is to just capture the network traffic, in that case, we have three more options where to look<ul><li>traffic between the device and the internet</li><li>traffic between device and companion app, if there is any</li><li>traffic between the companion app and the internet</li></ul></li><li>Analyze and reverse engineer the companion app. Before we dive deeply into the device, it’s advisable to first peek into the device’s companion app, it’s usually the easiest solution for grabbing the communication protocol and commands. No luck with any of the above? It’s time to dismount the device, trace the board to identify all the components, get datasheets to find debugging ports, and possibly dump the firmware directly from the chip. This is really an adventure in hardware and not for everyone.</li></ol>



<p>Life is not so simple, and neither is reverse engineering IoT devices. It turned out that we had to use a combination of all the aforementioned techniques. First, we googled it, and as the commands have already been documented, we found a command that says <code>“update the firmware.”</code> But the command itself (its parameters and format) had not been documented. So by issuing:</p>







<div><figure><img loading="lazy" src="https://decoded.avast.io/wp-content/uploads/sites/2/2020/09/image-9.png" alt="" width="396" height="78" srcset="https://decoded.avast.io/wp-content/uploads/sites/2/2020/09/image-9.png 396w, https://decoded.avast.io/wp-content/uploads/sites/2/2020/09/image-9-300x59.png 300w" sizes="(max-width: 396px) 100vw, 396px"><figcaption>t<em>his simple (two bytes) command switches coffee maker into update mode</em></figcaption></figure></div>







<p>the coffee maker goes into an update mode (on the newer firmware you have to push a button to actually start the update, but this is not the case with older versions !)</p>



<div><figure><img src="https://lh4.googleusercontent.com/zt-eEhReRyN8xe20y_NoBwNR_TCZ02Y87hyXVZDDiU6WtGGW2s4bmTBy37tdaIS9TBm5hLoBKwqcc1iE0tHjhC4HzVqqhSX_DB1bRUvGy9QTeuwGiYuSRVXTuoWxnkGFwOn57tVX" alt=""></figure></div>







<p>Hmm nice, but nothing happens. By analyzing network traffic, we concluded that there is nothing to analyze, as there is no traffic coming out of the coffee maker at this stage. So we tried the Android companion app.&nbsp;</p>



<div><figure><img src="https://decoded.avast.io/wp-content/uploads/sites/2/2019/08/Screen-Shot-2019-08-02-at-9.30.47-AM.png" alt="This image has an empty alt attribute; its file name is Screen-Shot-2019-08-02-at-9.30.47-AM.png"><figcaption><em>Android application for smart coffee maker, right picture shows an update screen</em></figcaption></figure></div>







<p>You can see the update button is grayed out, so obviously, the firmware is up-to-date and there is no easy option to push the firmware update to be able to see what’s in the network traffic. What’s interesting here is what’s missing. There was no communication to the internet neither from the coffee maker nor from the app. So how is it possible that the app knows that the coffee maker has the latest firmware? The only packets of data that went through were those between the machine and app when the app had been asking the machine for the version of the firmware.</p>



<div><figure><img loading="lazy" width="677" height="177" src="https://decoded.avast.io/wp-content/uploads/sites/2/2020/09/image-4.png" alt="" srcset="https://decoded.avast.io/wp-content/uploads/sites/2/2020/09/image-4.png 677w, https://decoded.avast.io/wp-content/uploads/sites/2/2020/09/image-4-300x78.png 300w" sizes="(max-width: 677px) 100vw, 677px"><figcaption>Typical traffic analysis of IoT with companion app: we are interested in traffic between app and internet and app and device.</figcaption></figure></div>







<p>This is strange, and it seemed to tell us that the firmware is probably not on the internet and must be part of the app. So we opened the .apk file as easy as a .zip file. What we found there, proved our assumption.&nbsp;</p>



<div><figure><img src="https://lh5.googleusercontent.com/reUvllV7KNcZW0e9A4E_XljR0jknTZL-CLUbS3vJx0uiyArpgKdEVSpK1vEUUG0Q6Tu00I0wUlZMdQ8nG1w_Mdxz611TUCxA2DozEy0wftaC0qynZhhx8_pKNc6VeST1djzBgVti" alt=""><figcaption><em>Files inside the apk: You can see firmware for both products are contained in the two files with suffix .bin&nbsp;</em></figcaption></figure></div>







<p>The firmware is part of the Android app and it also means that new versions of the firmware always come with new versions of the app. This makes perfect sense if you think about it for a second. The new firmware usually adds new …</p></div></article></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://decoded.avast.io/martinhron/the-fresh-smell-of-ransomed-coffee/">https://decoded.avast.io/martinhron/the-fresh-smell-of-ransomed-coffee/</a></em></p>]]>
            </description>
            <link>https://decoded.avast.io/martinhron/the-fresh-smell-of-ransomed-coffee/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24599434</guid>
            <pubDate>Sat, 26 Sep 2020 15:17:33 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[On not choosing WordPress for the W3C redesign project]]>
            </title>
            <description>
<![CDATA[
Score 196 | Comments 192 (<a href="https://news.ycombinator.com/item?id=24596769">thread link</a>) | @ziodave
<br/>
September 25, 2020 | https://w3c.studio24.net/updates/on-not-choosing-wordpress/ | <a href="https://web.archive.org/web/*/https://w3c.studio24.net/updates/on-not-choosing-wordpress/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div tabindex="0"> <div>  <div class="page"> <div id="main-content" role="main">  <p> <span>Updates</span> <span>CMS</span> </p>  <hr> <p>The W3C redesign project is an incredibly exciting one for us at Studio 24, it’s an honour to be working with an organisation we have looked up to for our whole career. But it’s also challenging, with many aspects coming under more scrutiny than we’re normally used to. It’s also made harder in this time of pandemic, with increased anxiety and challenges working effectively during this “new normal” we’re all living in.</p> <p>We’re happy to rise to this challenge. Yesterday a well written article was published by WordPress Tavern on <a href="https://wptavern.com/w3c-drops-wordpress-from-consideration-for-redesign-narrows-cms-shortlist-to-statamic-and-craft">W3C dropping WordPress from consideration</a> which I’d like to respond to.</p> <h2 id="in-context-of-the-project"> <a href="#in-context-of-the-project"></a> In context of the project </h2> <p>We’ve tackled a huge variety of work so far from initial Discovery, User Research, Information Architecture, Content Design and UX Design that has helped move the project forward.</p> <p>The CMS platform decision is just part of this and for the end website is one of the less visible aspects. As you can read from <a href="https://w3c.studio24.net/docs/cms-selection-report/">Marie’s report on the work we did to choose Craft CMS</a> you can see the steps we went through to help shortlist and choose a CMS.</p> <p>For us, and the requirements from W3C, the delivery of accessible HTML/CSS pages that meet user needs is the most important part of this project - and where we are focussing our time. All in, we spent around 15 days on the CMS platform choice. Enough to help evaluate a limited number of options, but not enough to do a thorough review of the state of accessibility in a wide range of CMSs.</p> <p>We were surprised by the accessibility issues that cropped up in CMS platforms after our <a href="https://w3c.studio24.net/docs/w3c-cms-selection-process-update/">initial CMS review</a>. This prompted us to prioritise accessibility above other requirements due to the <a href="https://www.w3.org/Consortium/mission#principles">principles and values of W3C</a>.</p> <h2 id="challenges-of-gutenberg-for-now"> <a href="#challenges-of-gutenberg-for-now"></a> Challenges of Gutenberg (for now) </h2> <p><a href="https://www.studio24.net/">Studio 24</a> is a firm supporter of open source software and we use <a href="https://www.wordpress.org/">WordPress</a> extensively for our client work. For this project we had committed to not selecting a CMS until we’d had the chance to better understand client requirements.</p> <p>An important consideration for WordPress was accessibility concerns with the new Gutenberg editor. Many have written about the <a href="https://www.marcozehe.de/my-thoughts-on-gutenberg-accessibility/">accessibility issues</a> the project has had as well as the positive <a href="https://www.marcozehe.de/whats-new-for-accessibility-in-gutenberg-7-2/">steps to improve accessibility in Gutenberg</a>.</p> <p>Gutenberg is an exciting and really interesting development. Many CMS vendors are looking at ways to allow editors to create more flexible content from compontents or blocks. However, this comes with huge challenges on how to make innovative user interfaces accessible. WordPress decided to use the JavaScript framework <a href="https://reactjs.org/">React</a> to meet these needs.</p> <p>We <a href="https://medium.com/studio24/we-tried-converting-a-bespoke-website-design-in-wordpress-with-gutenberg-42e11986b05a">tested Gutenberg</a> six months before it was released in WordPress 5. Recently we worked on a project for the University of Cambridge creating a site for their <a href="https://magazine.alumni.cam.ac.uk/">Alumni magazine</a>. This launched in April 2020 and uses Gutenberg to manage content. This gave us a good idea of how Gutenberg works. In June, we reviewed the current accessibility issue backlog (<a href="https://github.com/WordPress/gutenberg/labels/Accessibility%20%28a11y%29">issues</a>, <a href="https://github.com/WordPress/gutenberg/projects/25">a11y project</a>) and had some feedback from users with accessibility needs who had difficulties using the current user interface. This was a contributing factor in our decision that WordPress was not a good fit for this project.</p> <p>Given the importance the WordPress project has put on Gutenberg as the future of WordPress we did not feel it was reasonable to recommend using the Classic Editor if there is a good chance this will not be supported in the future. At present <a href="https://make.wordpress.org/core/2018/11/07/classic-editor-plugin-support-window/">Classic Editor is slated for end of life in Dec 2021</a>.</p> <p>We look forward to the continued development of Gutenberg and applaud efforts to make it more accessible. We appreciate improvements have been made since our review and we’re very glad to see the <a href="https://wpaccessibilityday.org/">WordPress Accessibility Day</a> on 2nd October.</p> <h2 id="front-end-complexity"> <a href="#front-end-complexity"></a> Front-end complexity </h2> <p>From a business perspective I also believe Gutenberg creates a complexity issue that makes it challenging for use by many agencies who create custom websites for clients; where we have a need to create lots of bespoke blocks and page elements for individual client projects.</p> <p>The use of React complicates front-end build. We have very talented front-end developers, however, they are not React experts - nor should they need to be. I believe front-end should be built as standards-compliant HTML/CSS with JavaScript used to enrich functionality where necessary and appropriate.</p> <p>As of yet, we have not found a satisfactory (and profitable) way to build custom Gutenberg blocks for commercial projects. We won’t stop trying though and plan to do more R&amp;D with Gutenberg in the future. The W3C project, however, did not feel like the right place to do this. On a project as wide-ranging as this one, development time does become a factor.</p> <p>Drupal also has this complexity issue which makes developing sites harder than it needs to be, and is why we didn’t consider that platform either. I’ve talked to <a href="https://torchbox.com/blog/torchbox-has-dropped-drupal/">other agencies who have decided to drop Drupal</a> due to its complexity.</p> <h2 id="the-question-of-open-source"> <a href="#the-question-of-open-source"></a> The question of open source </h2> <p>The W3C embraces and supports the open web. However, as an agency we also have to be practical when it comes to the tools we use to build sites. From our review, which was focussed on PHP-based CMSs, Craft and Statamic came out as meeting all the key requirements and are both very developer-friendly platforms. An important consideration for a tool that we need to hand over to W3C to maintain in the future.</p> <p>While their <a href="https://github.com/craftcms/cms">source code</a> is open, they do have commercial licenses and cost money (though a modest sum). Charging money enables small teams to develop good software, so we’re not ideologically against this business model. Both platforms are well respected in the community and well-used by professionals, running sites such as <a href="https://media.netflix.com/en/">Netflix</a> and <a href="https://www.bigcommerce.com/">Big Commerce</a> in Craft, <a href="https://www.spiegel.de/plus/">Spiegel Plus</a> and <a href="https://www.freshbooks.com/">FreshBooks</a> in Statamic.</p> <p>We are using open source technology in the majority of this project (HTML/CSS, JavaScript, PHP, Symfony). While Craft is a proprietary CMS, this has given us the advantage of direct access to the team developing the CMS which has helped improve accessibility in these CMSs. We hope this helps move accessibility forward in the CMS industry.</p> <p>Open tools will continue to be used to publish the standards of the web. The <a href="https://www.w3.org/TR/">Technical Reports</a> page is powered by <a href="https://symfony.com/">Symfony</a> and specifications will continue to be published to <a href="https://github.com/w3c">GitHub</a> to facilitate open discussion. Nothing’s changing with how the W3C work in the open.</p> <h2 id="a-note-on-front-end-delivery"> <a href="#a-note-on-front-end-delivery"></a> A note on front-end delivery </h2> <p>One final note. We are currently considering a <a href="https://www.studio24.net/blog/what-is-a-headless-cms/">Headless CMS</a> option for front-end page delivery. This means using the CMS in a decoupled way to manage content but use a separate system to deliver front-end pages. Please note this solution would not be reliant on JavaScript (e.g. a single page app which is common with headless). Under this option we’d use Symfony to deliver front-end pages which is an established technology W3C already use across a lot of the site.</p> <p>This may give W3C better flexibility for the future, though comes at a cost of added complexity. The W3C site is already made up of a lot of different systems, the CMS is just one part of the what makes up the varied content on <a href="https://www.w3.org/">w3.org</a>.</p> <p>I hope this helps explain the thought process behind our decision a little more and addresses some of the valid concerns highlighted in the WordPress Tavern post.</p> <hr>  </div> </div> </div> </div></div>]]>
            </description>
            <link>https://w3c.studio24.net/updates/on-not-choosing-wordpress/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24596769</guid>
            <pubDate>Sat, 26 Sep 2020 06:05:43 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Let's talk about safety of Pinephone]]>
            </title>
            <description>
<![CDATA[
Score 164 | Comments 65 (<a href="https://news.ycombinator.com/item?id=24596248">thread link</a>) | @lostmsu
<br/>
September 25, 2020 | https://xnux.eu/log/#017 | <a href="https://web.archive.org/web/*/https://xnux.eu/log/#017">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page">

<ul>
	<li><a href="#019">2020–09–20: Downsizing the multi-boot image</a></li>
	<li><a href="#018">2020–09–20: Some ways to improve Pinephone safety</a></li>
	<li><a href="#017">2020–09–18: Let's talk about safety of Pinephone</a></li>
	<li><a href="#016">2020–09–17: Video acceleration experiments with PinePhone</a></li>
	<li><a href="#015">2020–09–16: PineBook Pro and Levinboot again</a></li>
	<li><a href="#014">2020–09–14: Putting 13 PinePhone distributions on a 8GiB uSD card</a></li>
	<li><a href="#013">2020–09–11: Adding postmarket OS to multi-distro image</a></li>
	<li><a href="#012">2020–09–11: Ways to help improve Pinephone kernel</a></li>
	<li><a href="#011">2020–09–11: PinePhone multi-boot image deduplication tool complete</a></li>
	<li><a href="#010">2020–09–10: PinePhone multi-boot image deduplication</a></li>
	<li><a href="#009">2020–09–08: PinePhone multi-boot finishing touches / modem improvements</a></li>
	<li><a href="#008">2020–09–08: PinePhone multi-boot image optimizations</a></li>
	<li><a href="#007">2020–09–07: PinePhone multi-boot image boot testing</a></li>
	<li><a href="#006">2020–09–05: PinePhone multi-boot image</a></li>
	<li><a href="#005">2020–09–04: Pinebook Pro and Levinboot</a></li>
	<li><a href="#004">2020–09–02: Progress on the multi-boot image</a></li>
	<li><a href="#003">2020–09–01: More p-boot cleanups and an example configuration</a></li>
	<li><a href="#002">2020–08–31: Releasing p-boot GUI bootloader</a></li>
	<li><a href="#001">2020–08–31: Getting started</a></li>
</ul>

<article id="019">
<h2 id="toc-2020-09-20-downsizing-the-multi-boot-image">2020–09–20:
Downsizing the multi-boot image</h2>

<p>If the multi-boot image doesn't fit your 8GiB uSD card, because it's&nbsp;a tad
too big, you can downsize it a bit by using this script:</p>

<pre><span>#!/bin/bash</span>

<span>set -e -x</span>

<span>mkdir</span> <span>-p</span> m
L<span>=</span><span>`losetup -P --show -f multi.img`</span>
mount <span>-o</span> <span>compress</span><span>-force</span><span>=</span>zstd <span>${L}</span>p2 m
btrfs filesystem resize <span>7000</span>M m
<span>echo</span> <span>",7000M"</span> <span>|</span> sfdisk <span>-N</span> <span>2</span> <span>${L}</span>
umount m
losetup <span>-d</span> <span>"</span><span>$L</span><span>"</span>

truncate <span>-s</span> <span>$((128+7000)</span><span>)</span>M multi.img
</pre>

<p>If something fails in the middle, you may need to recover by calling
<code>umount</code> and <code>losetup -d</code> yourself.
<code>losetup -l</code> can tell you if the image is still exported as a loop
device, and which&nbsp;one.</p>

<p>The image will have the size of 7128&nbsp;MiB after resize and this should fit
more „8“ giga something uSD cards, as there are obviously some other giga
units than gigabyte and gigibyte used by some manufacturers.</p>
</article>

<article id="018">
<h2 id="toc-2020-09-20-some-ways-to-improve-pinephone-safety">2020–09–20:
Some ways to improve Pinephone safety</h2>

<p>This is a follow up on some issues from the previous article. On surface,
solutions to some of the previously presented issues can seem simple. Toggle a
few registers in PMIC, and we're mostly done. Trouble is that safety mechanisms
are barely ever triggered, by definition. Safety events occur rarely. That means
that the mechanisms are not regularly tested, and it is not known that
they&nbsp;work.</p>

<p>Also it's&nbsp;not clear which code's&nbsp;responsibility fixing the issues should
be. Bootloader, or kernel, or userspace? Finally, there are a bunch of devils in
the details, that complicate the upstreamability of any solution. And having
fixes upstream is necessary to make sure they reach the most&nbsp;users.</p>

<h3 id="toc-necessary-minimum">Necessary minimum</h3>

<p>Nevertheless, at least enabling some pre-existing PMIC functionality blindly
is better than nothing, so that's&nbsp;precisely what I&nbsp;decided to do <a href="https://megous.com/git/p-boot/commit/?id=db73ff85c60944207b7f7368e554003494148a05">in
p-boot</a>. It's&nbsp;the easiest place to start resolving these issues for me
personally, and for other p-boot&nbsp;users.</p>

<p>I&nbsp;fixed two issues:</p>

<ul>
	<li>I&nbsp;enabled the battery temperature monitoring and charging regulation based
	on temperature thresholds defined in the Pinephone battery specification.</li>

	<li>I&nbsp;enabled emergency shutdown when crossing the critical temperature
	of&nbsp;PMIC.</li>
</ul>

<p>I&nbsp;didn't measure the 3kOhm NTC used in Pinephone battery and third party
batteries I&nbsp;bought. I&nbsp;just used a table from some random 3kOhm NTC spec on The
Internet, that seemed like it could match. Hopefully it's&nbsp;close enough.</p>

<p>Trouble with the second fix is that it's&nbsp;a hard power cut-off, so data loss
may occur when PMIC overheats. There are three fixed temperature levels in
AXP803. On level 1&nbsp;the charging is limited, on level 2&nbsp;the interrupt is sent
to SoC, on level 3&nbsp;the PMIC shuts down if configured to do so (by default it
keeps running, and this is what my p-boot fix changes). Ideally, the crossing of
level 2&nbsp;would be handled by Linux to make it safely shut down the system, and
level 3&nbsp;forced power cut-off would never happen. Arguably, if charging was
source of the heating, crossing level 1&nbsp;will lead to resolving the issue, so
the next level will not be reached.</p>

<h3 id="toc-suggested-fixes-elsewhere">Suggested fixes elsewhere</h3>

<p>These fixes will reach a very limited audience. It would be nice to have
these fixes in U-Boot too, but that's&nbsp;not possible at the moment, because
U-Boot doesn't have access to&nbsp;PMIC.</p>

<p>Other places to put the fix is to ATF or Linux kernel. That can reach more
people faster, but there would have to be some generic mechanism to make the fix
upstreamable, otherwise it will not reach people using the mainline Linux kernel
or mainline&nbsp;ATF.</p>

<p>There are some ways to approach this:</p>

<ul>
	<li>Use battery description in DT from <a href="https://github.com/ARM-software/arm-trusted-firmware">ATF</a> to set up
	thresholds in PMIC (ATF has access to&nbsp;PMIC).</li>

	<li>Use battery description in DT from Linux's&nbsp;battery charger driver for
	AXP803 to set up thresholds in PMIC and stop disabling temperature
	monitoring.</li>

	<li>Use <a href="https://elixir.bootlin.com/linux/latest/source/Documentation/devicetree/bindings/power/supply/charger-manager.txt">charger
	manager</a> in Linux, but that looks like it's&nbsp;a completely software solution,
	that will be inferior to PMIC handling the regulation. And it seems it would not
	work in system suspend, anyway, because Linux is not running&nbsp;then.</li>

	<li>Detect Pinephone compatible string in either ATF or Linux and set up the
	thresholds to ad-hoc values for 3kOhm NTC. (easiest, unlikely to be acceptable
	upstream)</li>
</ul>

<p>First, the most generic solution would be to have a description of the
battery in DT describing the Pinephone. Sadly, the <a href="https://elixir.bootlin.com/linux/v5.9-rc5/source/Documentation/devicetree/bindings/power/supply/battery.yaml">current
bindings</a> don't include battery temperature limits.</p>

<p>Also converting from temperature to NTC resistance (which is necessary to
determine the code word from ADC for the limits used by the temperature monitor
logic in PMIC) is not straightforward. It is usually defined in NTC datasheet as
a table. Do I&nbsp;have NTC datasheet? No. I&nbsp;bought the batteries online from some
mobile phone service&nbsp;shop.</p>

<p>There are also equations that approximate the temperature&nbsp;– resistance
relationship for the NTC, which could be used instead of a fixed table, if one
knows the relevant coefficients. These can be calculated after measuring the
NTC's&nbsp;resistance at a few temperature points when we lack the datasheet.</p>

<p>So generic solution may look like this:</p>

<ul>
	<li>DT contains battery temperature limits from the battery&nbsp;spec</li>

	<li>DT contains NTC coefficients (perhaps also on the battery&nbsp;node)</li>

	<li>some routine would use all this info from DT to calculate code words used by
	AXP803 ADC and program them to PMIC (either in ATF, or&nbsp;Linux)</li>
</ul>

<p>Kernel also has support for NTC devices, so maybe NTC can be described
outside of the battery node (even though it's&nbsp;part of the battery).</p>

<p>This may all fail to be upstreamed on one thing: the battery is user
swappable, so it's&nbsp;arguably not part of the Pinephone, and describing it inside
the pinephone DT will not be appropriate.</p>

<p>I&nbsp;don't have any plans implementing any of the above, atm. Maybe with the
exception of adding a 4th approach to the fix to my Linux kernel (the easiest
one ;)). I'd like to work on my multi-boot image. So these are mostly pointers
for somebody else who'd like to tackle&nbsp;this.</p>

<h3 id="toc-other-issues">Other issues</h3>

<p>Fast charging is not necesary in many situations, so having it as a default
is not great. User should be able to decide if he wants to trade off slower,
safer charging and battery longetivity over speed. This tradeoff can be realized
in many&nbsp;ways.</p>

<p>All this is already controllable from userspace via sysfs. Ideally there
would be some charging monitoring daemon that would take into account
users's&nbsp;wishes and select proper strategy for charging, based on preference for
battery longetivity or&nbsp;speed.</p>

<p>There are several trade offs the deamon would be able to handle:</p>

<ul>
	<li>0.2C charging all the way (slow, but safer)</li>

	<li>0.5C charging to 40% and 0.2C charging to 100% (middle ground)</li>

	<li>0.5C charging all the way to 100%</li>
</ul>

<p>All this is decision making that doesn't belong to the kernel.</p>

<p>Similar daemon could monitor power usage of the phone and try to limit it to
safer levels, or warn the user if that's&nbsp;not possible.</p>
</article>

<article id="017">
<h2 id="toc-2020-09-18-let-s-talk-about-safety-of-pinephone">2020–09–18:
Let's&nbsp;talk about safety of Pinephone</h2>

<p>My gf read me some articles about exploding phones today. :) I&nbsp;think there
needs to be some serious conversation about Pinephone safety. Safety needs to
become an important concern now, when more and more people are getting their
Pinephones every month. It's&nbsp;just a matter of time before the first major
safety incident hits this community, and it may be more than just a hacked
store. It's&nbsp;just a numbers&nbsp;game.</p>

<p>Pinephone is an interesting device in one way. You can run whatever software
you like on it (and you do!), and this software comes almost universally with
<strong>zero</strong> guarantees. Read the license to any of the program you run
on your Pinephone and it will almost certainly tell&nbsp;you:</p>

<blockquote>
	<p>THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR IMPLIED
	WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF
	MERCHANTABILITY AND FITNESS FOR A&nbsp;PARTICULAR PURPOSE.</p>
</blockquote>

<p>or</p>

<blockquote>
	<p>THIS SOFTWARE IS PROVIDED BY &lt;COPYRIGHT HOLDER&gt; AS IS AND ANY EXPRESS
	OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF
	MERCHANTABILITY AND FITNESS FOR A&nbsp;PARTICULAR PURPOSE ARE DISCLAIMED. IN NO
	EVENT SHALL &lt;COPYRIGHT HOLDER&gt; BE LIABLE FOR ANY DIRECT, INDIRECT,
	INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</p>
</blockquote>

<p>or</p>

<blockquote>
	<p>This program is distributed in the hope that it will be useful, but WITHOUT
	ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
	FOR A&nbsp;PARTICULAR PURPOSE. See the GNU General Public License for more
	details.</p>
</blockquote>

<p>etc.</p>

<p>In case of Pinephone you have to take these warnings <strong>very
seriously</strong>, because this software is not provided by the manufacturer
(Pine64), and as far as I&nbsp;know, there's&nbsp;no software related safety testing
going on at&nbsp;all.</p>

<h3 id="toc-some-skeletons-hiding-at-the-lower-levels">Some skeletons, hiding at
the lower levels…</h3>

<p>I'll give you a few reasons why things may not be so rosy, when it comes to
safety.</p>

<p>There's&nbsp;no unchangeable well tested guardian angel management engine that
safely manages battery, power supplies, thermal behavior, that is provided by
the manufacturer, and that is independent of the operating system.</p>

<p>Pinephone's&nbsp;SoC is quite bare when it comes to software/firmware
(that's&nbsp;why FOSS enthusiasts like it, no blobs, you know!). This has a dark</p></article></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://xnux.eu/log/#017">https://xnux.eu/log/#017</a></em></p>]]>
            </description>
            <link>https://xnux.eu/log/#017</link>
            <guid isPermaLink="false">hacker-news-small-sites-24596248</guid>
            <pubDate>Sat, 26 Sep 2020 03:45:40 GMT</pubDate>
        </item>
    </channel>
</rss>
