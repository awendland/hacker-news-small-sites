<rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>
<![CDATA[Hacker News - Small Sites - Score >= 50]]>
        </title>
        <description>
<![CDATA[Hacker News stories from domains that aren't in the top 1M and that have a score of at least 50. Updated nightly via https://github.com/awendland/hacker-news-small-sites]]>
        </description>
        <link>https://news.ycombinator.com</link>
        <generator>RSS for Node</generator>
        <lastBuildDate>Fri, 07 Aug 2020 12:26:04 GMT</lastBuildDate>
        <atom:link href="https://raw.githubusercontent.com/awendland/hacker-news-small-sites/generated/feeds/hn-small-sites-score-50.xml" rel="self" type="application/rss+xml"></atom:link>
        <pubDate>Fri, 07 Aug 2020 12:26:04 GMT</pubDate>
        <language>
<![CDATA[en-US]]>
        </language>
        <managingEditor>
<![CDATA[me@alexwendland.com (Alex Wendland)]]>
        </managingEditor>
        <ttl>240</ttl>
        <item>
            <title>
<![CDATA[When Should You Not Use Rails?]]>
            </title>
            <description>
<![CDATA[
Score 52 | Comments 41 (<a href="https://news.ycombinator.com/item?id=24057715">thread link</a>) | @luu
<br/>
August 4, 2020 | http://codefol.io/posts/when-should-you-not-use-rails/ | <a href="https://web.archive.org/web/*/http://codefol.io/posts/when-should-you-not-use-rails/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article>
            <!-- .post-header -->
            <div>
                  
<figure>
    <p><img src="http://codefol.io/img/chimp_keyboard_aside_216_135.png" alt="A chimpanzee in a white coat types at a keyboard lit by glowing LEDs." width="216" height="135" title="He's gorgeous, yes. But is his talent natural&amp;hellip; or is it Ruby on Rails?">
    </p>

      <figcaption>
        He's gorgeous, yes. But is his talent natural… or is it Ruby on Rails?
        
        
      </figcaption>
</figure>

                <p>I was <a href="https://www.codewithjason.com/rails-with-jason-podcast/noah-gibbs-3/">recently on Jason Swett’s podcast again</a>. He’s a great interviewer and I always have fun with him.</p>

<p>By Twitter request we talked about… When would you <strong><em>not</em></strong> use Rails? It’s a great question.</p>

<p>For the entertaining version, <a href="https://www.codewithjason.com/rails-with-jason-podcast/noah-gibbs-3/">listen to the podcast</a>. For the just-the-facts extra-complete version, I’m writing this post.</p>

<h2>When Is Rails the Wrong Choice?</h2>

<p>I’ll start with a few simple, obvious times you wouldn’t use Rails, and then I’ll talk about some technically interesting times.</p>

<p>First, and most important, is team familiarity. If your team doesn’t already know Rails and isn’t especially interested in learning it then Rails is the wrong choice. This should be obvious, but it still deserves first billing.</p>

<p>Second, when you know some other framework fits better. I’ll talk more below about when that is. But sometimes you have a specific concern that trumps everything else. If you need to use a Java-language machine learning library and you don’t want to use JRuby for some reason, Rails isn’t your framework. If you’re writing a WordPress plugin, you’ll be doing it in PHP. Often there’s one specific compatibility concern that overrides everything else.</p>

<p>You can also think of it as: use it where Rails’ good points hold and its bad points don’t. So we’ll also talk about the good and bad points.</p>

<p>Separately: you’d normally only use Rails as an HTTP server, so some tasks just aren’t Rails-shaped.</p>

<h2>When is Rails Too Much?</h2>

<figure>
    <a href="https://rubymadscience.com/img/assistant_pirate_with_sphere_bigthumb.png">
      <img src="https://rubymadscience.com/img/assistant_pirate_with_sphere_bigthumb.png" alt="A pirate puppet with an eyepatch, safety goggles and a huge scraggly mustache watches over a purple crystal ball at his feet.'" title="He's too much lab assistant for your lab.">
    </a>
        <figcaption>He’s too much lab assistant for your lab.</figcaption> 
</figure>

<p>Some places not to use Rails can include:</p>

<p><strong>Really Small Tasks that Won’t Grow</strong>: if a server does very little, Rails is often too much. Not going to touch a database? Then the DB setup isn’t helping you, is it? Just a tiny low-traffic intermediate server with no caching? A lot of Rails is more trouble than it’s worth.</p>

<p>Be careful with tasks that grow, though — making a tiny server scale up to do a lot more can be ugly. If you’re already serving HTTP pages to a human with a web browser, consider that you may have to add features to it later. Something like <strong><em>that</em></strong> is already fairly large from the word “go”.</p>

<p><strong>When It’s ‘Just’ an API Server</strong>: Rails has less to offer an API server that speaks JSON over the wire. A lot of its HTTP security doesn’t matter for that case (e.g. SQL injection safeguards, XSS prevention.) While ActiveRecord can be nice for some database use cases, Rails really shines when you’re building an HTML site that talks to browsers. Very small projects that mostly speak a structured format read by machines will often get less from Rails.</p>

<p>Related to that is when you’re doing in-browser rendering and Rails is ‘just’ serving JSON. It’s a weird kind of in-between case. A lot of Rails security and convenience functions no longer help you, but you’re still doing things where internal libraries (ActiveRecord, ActiveJob, ActionMailer) can be highly useful. But if you’re never rendering HTML on the server and you’re very sure you never will, Rails will probably help you less.</p>

<h2>When Is Rails Not Enough?</h2>

<p>Rails is also designed for a small team and a medium-sized codebase. A huge team (lots of programmers) or a huge codebase (lots of controllers, models and/or lines of code) will tend to drag down the standard Rails-app structure.</p>

<p>Ruby allows for a <strong><em>lot</em></strong> of <a href="https://en.wikipedia.org/wiki/Side_effect_(computer_science)">non-local effects</a>. Whether that’s monkeypatching, writing to a database or creating new types at runtime, Ruby isn’t designed for a team of 200 programmers where you don’t trust some of them. There are too many ways for them to cause you trouble. You can use <a href="https://sorbet.org/">good tooling</a> to scale Ruby to larger teams, but even that will <a href="https://sorbet.org/docs/troubleshooting#escape-hatches">tend to have exceptions and difficulties</a>. That’s not really Ruby’s sweet spot.</p>

<p>In most cases you can cut up a large project into smaller projects. If one Rails app is too big, you can often separate it into multiple apps, or a thinner app with more back-end services, or an app and a separate microservice, or… One way or another there is usually a way to separate out smaller pieces. Ruby strongly encourages that, as do I.</p>

<p>There are also not-quite-Rails structures that can scale better. Avdi Grimm’s (now retired) <a href="https://www.goodreads.com/book/show/13481927-objects-on-rails">Objects on Rails</a> was an attempt in that direction, as is <a href="https://medium.com/@vsavkin/hexagonal-architecture-for-rails-developers-8b1fee64a613">the Hexagonal architecture for Rails</a>, which in turn has a lot in common with the older and more general <a href="https://en.wikipedia.org/wiki/Multitier_architecture">N-tier architecture</a>.</p>

<p>But at some point you might want to consider a different framework. <a href="https://hanamirb.org/">Hanami</a> is an obvious choice, designed to be less quick and nimble than Rails for getting a tiny app off the ground, but more scalable if you want to use the same code with a lot more contributors.</p>

<p>I’d still start out in Rails, personally. If you’re building something quickly to see if anybody cares, I know of no framework that comes close to its productivity. Wait to rewrite (in a more rigid framework) until you’re successful and you can afford the drag on your development speed.</p>

<p>The other worry here can be performance. If you’re rewriting a project that is already as large as the current Basecamp… then you’re <a href="https://m.signalvnoise.com/only-15-of-the-basecamp-operations-budget-is-spent-on-ruby/">actually fine for performance</a>. Rails still scales <strong><em>great</em></strong> for them. But if you’re looking at something a hundred times larger (which by definition means B2C, not B2B) then you might have a situation where your server costs are substantially greater than your engineering payroll. In that case it can make sense to slow down your engineers to pay lower server costs. To check this, see what your EC2-or-equivalent costs are <strong><em>just for your application servers</em></strong>, which are what run Rails. And check your payroll <strong><em>just for web engineers</em></strong>, which is who writes in Rails. Normally the engineering payroll is much larger and you should stick with trading cheap machine time for expensive engineering time. But at some point the balance may tip and you should consider raising your engineering payroll to cut your server costs.</p>

<h2>When Does Rails Have the Wrong Assumptions?</h2>

<figure>
    <a href="https://rubymadscience.com/img/dr_bear_microscope_bigthumb.png">
      <img src="https://rubymadscience.com/img/dr_bear_microscope_bigthumb.png" alt="A pirate, a bear and a chimp sit at a wicker table. The bear looks into a very old-fashioned microscope as the other two look on." title="They're checking the microscope for real-world use cases where Rails might be wrong.">
    </a>
        <figcaption>They’re checking the microscope for real-world use cases where Rails might be wrong.</figcaption> 
</figure>

<p>Before checking if Rails’ assumptions are right for you, we should see what those assumptions actually are.</p>

<p>Before you take my word for it, I recommend taking <a href="https://rubyonrails.org/doctrine/">David Heinemeier Hansson’s word for it</a> in the form of The Rails Doctrine. It’s a great document and it covers a lot of ground.</p>

<p>Indeed, if you want to better understand why Rails isn’t amazing for large, low-trust teams, you should read <a href="https://rubyonrails.org/doctrine/#provide-sharp-knives">“Provide Sharp Knives”</a> in the Rails Doctrine several times. A lot of Rails’ tradeoffs are entirely by design.</p>

<p>Rails also has some simpler assumptions: it assumes you’re writing an interactive app with server-rendered HTML. It assumes that security is vital (Rails trades a lot for security) but that you don’t want to build your own custom security system in most cases. And it assumes that you either have a small, excellent team doing prototyping work (“Provide Sharp Knives”) or that you have a possibly-mediocre team that needs powerful built-in guidelines (<a href="https://rubyonrails.org/doctrine/#omakase">“The Menu is Omakase.”</a>)</p>

<p>Rails also assumes you want high developer velocity at a cost of technical debt. In other words, it’s designed for building very quickly. That makes sense when <strong><em>technical execution is not your biggest risk</em></strong>. For instance: if you’re building a small startup, and you’re pretty sure you can build the site but people may not buy your product, you are dominated by market risk. That’s when Rails is perfect. You want to build very quickly. And even if you build perfectly, you’re probably going to have to throw away the result for nontechnical reasons, like “people don’t want to buy it.”</p>

<p>As part of “high dev velocity, technical debt is okay” Rails assumes things like, “you’ll want to use a lot of gems” and “dependencies that work are fine if they speed you up.”</p>

<p>Rails assumes you don’t mind scaling out application servers horizontally (by bringing more of them online.) It’s designed to scale well <strong><em>if</em></strong> you can do that. Rails assumes CPU is fairly cheap and it’s usually right about that. Relatedly, Rails assumes that the database is usually your most serious performance bottleneck, which is how web applications usually work.</p>

<p>Rails also assumes you’ll have some calculation or data transformation in your application. It assumes that it’s okay to use some CPU because you’ll be doing that anyway.</p>

<p>(When does that last assumption matter? Let’s talk about Evented Servers and see.)</p>

<h2>What Isn’t Rails Good At?</h2>

<figure>
    <a href="http://codefol.io/posts/when-should-you-not-use-rails/node_js_logo.png">
      <img src="http://codefol.io/posts/when-should-you-not-use-rails/node_js_logo.png" alt="The Node.js logo." title="Sometimes you need it, or something like it.">
    </a>
        <figcaption>Sometimes you need it, or something like it.</figcaption> 
</figure>

<p>While Rails is great at a lot of things, there’s one particular task that it’s not amazing for: shim servers.</p>

<p>By “shim servers” I mean servers that do very little calculation but integrate answers from a few other back-end services and relay the result. Imagine a server that queries two JSON services and combines the result with simple string-manipulation, for instance. It does very little calculation, but it juggles a lot of events.</p>

<p>And that’s the relevant word: “events.”</p>

<p>There is a specific kind of app architecture embodied by Node.js and its relatives called “Evented” programming. It can support many thousands, or even millions, of simultaneous connections with a tiny amount of server resources. It can be both high-throughput and low-latency. Its benchmark numbers are matchless… for the cases where it works.</p>

<p>Rails can’t match Evented programming at what Evented programming is good at. Basically no framework can. There are Evented frameworks for Ruby (e.g. <a href="https://github.com/eventmachine/eventmachine">EventMachine</a>, <a href="https://github.com/socketry/async">Async</a>.) Rails is built differently.</p>

<p>If Evented is so much better, why don’t we use it for everything? Because it doesn’t work for everything. I emphasise calculation per-request because an Evented server will fall down and die if you try to make it do very much calculation per-request. Having one server handle a million connections is no good if each connection …</p></div></article></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="http://codefol.io/posts/when-should-you-not-use-rails/">http://codefol.io/posts/when-should-you-not-use-rails/</a></em></p>]]>
            </description>
            <link>http://codefol.io/posts/when-should-you-not-use-rails/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24057715</guid>
            <pubDate>Wed, 05 Aug 2020 06:03:30 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[The Fundamental Axiom of Floating Point Arithmetic]]>
            </title>
            <description>
<![CDATA[
Score 85 | Comments 31 (<a href="https://news.ycombinator.com/item?id=24057293">thread link</a>) | @johnbcoughlin
<br/>
August 4, 2020 | http://www.johnbcoughlin.com/posts/floating-point-axiom/ | <a href="https://web.archive.org/web/*/http://www.johnbcoughlin.com/posts/floating-point-axiom/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="content">
            

            

<p>If you’ve been a software engineer for long enough, it is very likely that you’ve seen this example of floating point perfidy:</p>
<div><pre><code data-lang="python">&gt;&gt;&gt; <span>3.0</span> / <span>10</span>
<span>0.3</span>
&gt;&gt;&gt; <span>0.1</span> * <span>3</span>
<span>0.30000000000000004</span>
</code></pre></div><p>We understand that this is due to the fact that floating point numbers, stored
with only 64 bits of precision, cannot represent the entire real number line.
Moreover, when we perform operations with these floating point numbers, the
errors inherent in their representation can accumulate and multiply. The moral
of the story is, never use a floating point number to represent money.</p>
<p>At least, that is the moral for financial applications. At Square, we used a
<code>long amount_cents</code>, and we got along with our lives. However, for most
applications that have a good reason to use floating point, this can’t be the
end of the story. If floating point were the unpredictable, unreliable thing
that I once believed it to be, we wouldn’t be able to numerically solve
differential equations, or linear systems, or land on the moon. Rather, there is
a science of floating point error, forming part of a science of numerical errors
in general, which seeks to tame and understand what happens to errors as they
flow through our calculations. In general, numerical error is something that can
be rather precisely quantified, as we’ll see. Along the way we’ll look at the
Fundamental Axiom of Floating Point Arithmetic, which, at the very least, sounds
way cooler than “10 things every developer should know about floating point
numbers”.</p>
<h2 id="machine-epsilon">Machine Epsilon</h2>
<p>Fundamentally, error in floating point is due to the problem of “roundoff”. Just as in base 10, we cannot represent the
number \(1/3\) without rounding it off somewhere:</p>
<p>\begin{equation*}
\frac{1}{3} = 0.33333333333333 \dots \approx 0.33333333,
\end{equation*}</p>
<p>in base 2, we cannot represent many numbers without rounding. Of course, some numbers we <em>can</em> represent exactly. The
number 1, for example. Or any integer in the range \((-2^{53}, 2^{53})\). Also notably, many fractions can be exactly
represented:</p>
<p>\begin{align*}
\frac{1}{2} &amp;= 0.1_2 \\\<br>
\frac{3}{4} &amp;= 0.11_2 \\\<br>
\frac{17}{8} &amp;= 10.001_2 \\\<br>
&amp;\vdots
\end{align*}</p>
<p>However, a number like \(1/10\), just like \(1/3\) in base 10, must be truncated to fit in the 24 or 53 bits of the
<a href="https://en.wikipedia.org/wiki/Significand">mantissa</a>. When we enter <code>0.1</code> in a console or in source code, the value that is <em>actually stored</em> is very slightly
different than <code>0.1</code>. According to this excellent <a href="https://www.exploringbinary.com/floating-point-converter/">IEEE-754 Floating Point Converter</a>, the floating point number that is
actually stored (for 64-bit floating point) is</p>
<p>\begin{align*}
&amp;(0.0001100110011001100110011001100110011001100110011001101)_2 = \\\<br>
&amp;(0.1000000000000000055511151231257827021181583404541015625)_{10}
\end{align*}</p>
<p>So the initial input to our calculation was flawed! We weren’t calculating <code>0.1 * 3</code>, we were actually calculating</p>
<div><pre><code data-lang="python"><span>0.1000000000000000055511151231257827021181583404541015625</span> * <span>3</span>
</code></pre></div><p>How much of an error is this? We can get an idea by counting the zeros in between the significant
digits, \(0.100\dots 00055\). In this case, there are 16. So in simply entering a number which is not representable
exactly in floating point, we have incurred a relative error of roughly \(10^{-16}\).</p>
<p>Indeed, in <em>all</em> cases we can expect to incur a relative error of
roughly \(10^{-16}\). This magnitude is called machine epsilon, often
written \(\epsilon_{\text{machine}}\). It comes from the relative difference
between two successive floating point numbers. For every representable floating
point number \(x\), there is a <em>next</em> floating point number, and it is
approximately \(x + \epsilon_{\text{machine}} x\). So for an arbitrary real
number \(x_0\), it falls between two floating point values \(x\)
and \(x + \epsilon x\) (leaving off the subscript of \(\epsilon\) for conciseness). When we
represent \(x_0\) in floating point, we will get one of these two values. Let’s denote
the floating point representation of \(x_0\) by \(\text{fl}(x_0)\). The absolute
error incurred just by representing \(x_0\) in floating point is</p>
<p>\begin{equation*}
e_{\text{abs}} = |\text{fl}(x_0) - x_0| \leq \max(|x_0 - x|, |x_0 - (x + \epsilon x)|) \leq |\epsilon x|.
\end{equation*}</p>
<p>The relative error, then, i.e. the absolute error divided by the true value, is</p>
<p>\begin{equation*}
e_{\text{rel}} = \frac{e_{\text{abs}}}{x_0} \leq \frac{|\epsilon x|}{x_0} \approx \epsilon.
\end{equation*}</p>
<p>Cool! So we’ve seen that the worst we can do, in relative terms, when representing a floating point number, is
approximately \(10^{-16}\). This is, for almost all practical purposes, <em>very good</em>. Because remember, we’re speaking of
a relative error. That means we’re able to represent even very small values, very accurately. Here’s the nearest floating point
number to \(10^{-20}\):</p>
<p>\begin{equation*}
0.000000000000000000009999999999999999451532\dots
\end{equation*}</p>
<p>If you’re curious, I invite you to count the 9’s. There are 16 of them. Even when dealing with extremely small numbers,
we maintain the same relative precision.</p>
<h2 id="the-fundamental-axiom-of-floating-point-arithmetic">The Fundamental Axiom of Floating Point Arithmetic</h2>
<p>Now you might be thinking, wait! It’s all good and well that we can get excellent relative accuracy when <em>representing</em>
floating point numbers, but what about when we go to <em>do</em> something with them? Here we’ve got two floating point
numbers, both of which are inexact, and we’re about to multiply them! Who knows what might happen?</p>
<p>This concern is well-founded, because the algorithms of floating point arithmetic must be implemented with finite
precision. If we are asked to multiply two large numbers with pen and paper, the algorithm that most
of us will use is the one we learned in school, which involves lots of addition, carrying, sub-multiplications, and so
on. If all of those intermediate steps are using some kind of binary representation, then the intermediate products may
be losing precision as we go along! This seems like a recipe for disaster. Fortunately, there is a property that we can
require of a floating point implementation, one which is satisfied by IEEE-754 and most other popular floating point
standards, that will save us from total anarchy. This is what Trefethen and Bau, <em>Numerical Linear Algebra</em>, refer to
as the <strong>Fundamental Axiom of Floating Point Arithmetic</strong>:</p>
<blockquote>
<p>All floating point arithmetic operations are exact up to a relative error of \(\epsilon_{\text{machine}}\).</p>
</blockquote>
<p>This means that for any two floating point numbers, say \(x\) and \(y\), any operation involving them will give a floating
point result which is within a factor of \(1 + \epsilon_{\text{machine}}\) of the true result. This is easiest to
understand if we use a special notation to represent the floating point version of, say, \(+\). Let’s write \(\oplus\) to
denote floating point addition, and \(+\) to denote exact addition. Then the Fundamental Axiom tells us,</p>
<p>\begin{equation*}
\frac{|(x \bigoplus y) - (x + y)|}{x + y} \leq \epsilon_{\text{machine}}.
\end{equation*}</p>
<p>Remember, \(x\) and \(y\) are exactly representable as floating point numbers, but of course they are also, mathematically,
just real numbers. So \(x + y\) is a real number (point on the number line), which <em>may not be exactly representable in
floating point</em>. The Fundamental Axiom is telling us that the floating point operation \(\oplus\) can do no worse than
simply trying to represent the number \(x + y\) as a floating point value directly, assuming our computer had access to the
mathematical, infinite precision object \(x + y\).</p>
<p>Put another way, we incur no extra error by going through floating point
arithmetic than we would by using a magical computer to do exact arithmetic on
our floating point values and then casting back to floating point. In
mathematical terms,</p>
<p>\begin{equation*}
\frac{\left|(\text{fl}(a) \oplus \text{fl}(b)) - (a + b)\right|}{a + b} \approx \frac{\left|\text{fl}(\text{fl}(a) + \text{fl}(b)) - (a + b)\right|}{a + b} \approx \epsilon_{\text{machine}}.
\end{equation*}</p>
<p>Recall that \(\text{fl}(a)\) is the mathematical number we actually represent when
we try to represent \(a\) in floating point. So the first fraction gives the
relative error from performing \(\oplus\) on the floating point representations
of \(a\) and \(b\), and the second fraction gives the relative error from performing
the exact arithmetic operation, \(+\), on the floating point representations
of \(a\) and \(b\), then casting the result to floating point.</p>
<h2 id="error-analysis">Error Analysis</h2>
<p>The Fundamental Axiom of Floating Point Arithmetic allows us to analyze the numerical error that may be incurred by even
complex arithmetic operations. To see an idea of how this works, let’s consider the problem of computing the length of a
2D vector, \([x, y]\). Mathematically, this has the form</p>
<p>\begin{equation*}
d = \sqrt{x^2 + y^2}.
\end{equation*}</p>
<p>There are several stages to the computation, and at each one we will incur a little bit of numerical error:</p>
<ul>
<li>Enter the numbers \(x\) and \(y\) into the computer, incurring roundoff error.</li>
<li>Compute \(x^2\) and \(y^2\), using floating point multiplication.</li>
<li>Compute \(x^2 + y^2\), using floating point addition.</li>
<li>Compute \(\sqrt{x^2 + y^2}\), using the floating point square root operation.</li>
</ul>
<p>At each step, the result we get will be equal to the true result, times some error factor \((1 + \epsilon)\), where
each \(\epsilon\) is very small, on the order of \(\epsilon_\text{machine}\). Each operation may have a different
error \(\epsilon\), but we’ll use the same symbol for all of them. We don’t care so much about the exact value
of \(\epsilon\), only that it is very small.</p>
<p>We’re going to carry these \(\epsilon\) through the computation to see how they
affect the final result. To make that easier, we can use special rules of arithmetic to manipulate \(\epsilon\):</p>
<ul>
<li>\(\epsilon^2 = 0\). If \(\epsilon \approx 10^{-16}\), then \(\epsilon^2 \approx 10^{-32}\), which is so small that we just
decide to completely ignore it.</li>
<li>\((1 + \epsilon)^2 = 1 + 2\epsilon + \epsilon^2 = 1 + 2\epsilon\).</li>
<li>\(\sqrt{1 + \epsilon} = 1 + \frac{\epsilon}{2} - …</li></ul></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="http://www.johnbcoughlin.com/posts/floating-point-axiom/">http://www.johnbcoughlin.com/posts/floating-point-axiom/</a></em></p>]]>
            </description>
            <link>http://www.johnbcoughlin.com/posts/floating-point-axiom/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24057293</guid>
            <pubDate>Wed, 05 Aug 2020 04:41:08 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Magnasanti: The Largest and Most Terrifying SimCity (2010)]]>
            </title>
            <description>
<![CDATA[
Score 251 | Comments 91 (<a href="https://news.ycombinator.com/item?id=24052413">thread link</a>) | @riboflavin
<br/>
August 4, 2020 | https://rumorsontheinternets.org/2010/10/14/magnasanti-the-largest-and-most-terrifying-simcity/ | <a href="https://web.archive.org/web/*/https://rumorsontheinternets.org/2010/10/14/magnasanti-the-largest-and-most-terrifying-simcity/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>

					

					

					<p><a href="https://rumorsontheinternets.files.wordpress.com/2010/10/magna.jpg"><img data-attachment-id="2960" data-permalink="https://rumorsontheinternets.org/2010/10/14/magnasanti-the-largest-and-most-terrifying-simcity/magna/" data-orig-file="https://rumorsontheinternets.files.wordpress.com/2010/10/magna.jpg" data-orig-size="600,450" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;}" data-image-title="magna" data-image-description="" data-medium-file="https://rumorsontheinternets.files.wordpress.com/2010/10/magna.jpg?w=300" data-large-file="https://rumorsontheinternets.files.wordpress.com/2010/10/magna.jpg?w=600" title="magna" src="https://rumorsontheinternets.files.wordpress.com/2010/10/magna.jpg?w=630" alt="" srcset="https://rumorsontheinternets.files.wordpress.com/2010/10/magna.jpg 600w, https://rumorsontheinternets.files.wordpress.com/2010/10/magna.jpg?w=150 150w, https://rumorsontheinternets.files.wordpress.com/2010/10/magna.jpg?w=300 300w" sizes="(max-width: 600px) 100vw, 600px"></a></p>
<p>This picture  may appear to be a collection of color fields without meaning or  purpose, but there is a ton of math and evil genius behind this image.</p>
<p><strong>This is a view of Magnasanti, the metropolis that pushes SimCity to its population limits. </strong></p>
<p><strong><span id="more-2933"></span></strong>Here is a closer view:</p>
<p><a href="https://rumorsontheinternets.files.wordpress.com/2010/10/magna1.jpeg"><img data-attachment-id="2942" data-permalink="https://rumorsontheinternets.org/2010/10/14/magnasanti-the-largest-and-most-terrifying-simcity/magna1/" data-orig-file="https://rumorsontheinternets.files.wordpress.com/2010/10/magna1.jpeg" data-orig-size="600,450" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;}" data-image-title="magna1" data-image-description="" data-medium-file="https://rumorsontheinternets.files.wordpress.com/2010/10/magna1.jpeg?w=300" data-large-file="https://rumorsontheinternets.files.wordpress.com/2010/10/magna1.jpeg?w=600" title="magna1" src="https://rumorsontheinternets.files.wordpress.com/2010/10/magna1.jpeg?w=630" alt="" srcset="https://rumorsontheinternets.files.wordpress.com/2010/10/magna1.jpeg 600w, https://rumorsontheinternets.files.wordpress.com/2010/10/magna1.jpeg?w=150 150w, https://rumorsontheinternets.files.wordpress.com/2010/10/magna1.jpeg?w=300 300w" sizes="(max-width: 600px) 100vw, 600px"></a></p>
<p>Vincent Oscala, a 22-year old architecture student from the Philippines, spent years decoding the formula for success in Sim City 3000.</p>
<p>Sounds like lunacy…but his insane investment of effort into “beating” SimCity raises interesting questions about the urban landscapes we inhabit, and the ways in which they can go horribly wrong.</p>
<p><a href="https://rumorsontheinternets.files.wordpress.com/2010/10/magna21.jpg"><img data-attachment-id="2944" data-permalink="https://rumorsontheinternets.org/2010/10/14/magnasanti-the-largest-and-most-terrifying-simcity/magna2-2/" data-orig-file="https://rumorsontheinternets.files.wordpress.com/2010/10/magna21.jpg" data-orig-size="600,825" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;}" data-image-title="magna2" data-image-description="" data-medium-file="https://rumorsontheinternets.files.wordpress.com/2010/10/magna21.jpg?w=218" data-large-file="https://rumorsontheinternets.files.wordpress.com/2010/10/magna21.jpg?w=600" title="magna2" src="https://rumorsontheinternets.files.wordpress.com/2010/10/magna21.jpg?w=630" alt="" srcset="https://rumorsontheinternets.files.wordpress.com/2010/10/magna21.jpg 600w, https://rumorsontheinternets.files.wordpress.com/2010/10/magna21.jpg?w=109 109w, https://rumorsontheinternets.files.wordpress.com/2010/10/magna21.jpg?w=218 218w" sizes="(max-width: 600px) 100vw, 600px"></a></p>
<p>After a massive amount of planning and a great deal of trial and error, he was able to create a city with over six million inhabitants.</p>
<p>Moreover, the city he created was remarkably stable, with no abandoned buildings and no wasted space. There are no roads — all transit is mass transit. An omniscient police force has eliminated all crime in the city. Magnasanti’s water and power needs are supplied by neighboring cities, eliminating the need for much of the related infrastructure.</p>
<p><a href="https://rumorsontheinternets.files.wordpress.com/2010/10/magna3.jpg"><img data-attachment-id="2945" data-permalink="https://rumorsontheinternets.org/2010/10/14/magnasanti-the-largest-and-most-terrifying-simcity/magna3/" data-orig-file="https://rumorsontheinternets.files.wordpress.com/2010/10/magna3.jpg" data-orig-size="600,450" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;}" data-image-title="magna3" data-image-description="" data-medium-file="https://rumorsontheinternets.files.wordpress.com/2010/10/magna3.jpg?w=300" data-large-file="https://rumorsontheinternets.files.wordpress.com/2010/10/magna3.jpg?w=600" title="magna3" src="https://rumorsontheinternets.files.wordpress.com/2010/10/magna3.jpg?w=630" alt="" srcset="https://rumorsontheinternets.files.wordpress.com/2010/10/magna3.jpg 600w, https://rumorsontheinternets.files.wordpress.com/2010/10/magna3.jpg?w=150 150w, https://rumorsontheinternets.files.wordpress.com/2010/10/magna3.jpg?w=300 300w" sizes="(max-width: 600px) 100vw, 600px"></a></p>
<p><strong>In SimCity </strong><strong>terms</strong><strong>, it is a masterpiece.</strong></p>
<p><strong>But at the “street level,” so to speak, it looks like a horrifying dystopia. </strong></p>
<p>Unemployment is high, air pollution is stifling, education is largely absent, medical care and fire response are non-existent. Citizens do not live to reach retirement age. The police state has essentially eliminated free will and allowed the city to maximize its size while reducing quality of life to a minimum — and still maintaining total control over the citizens.</p>
<p>Every person living in Magnasanti spends his life working and residing in one small, massively efficient block of space, until death around age 50.</p>
<p><a href="https://rumorsontheinternets.files.wordpress.com/2010/10/magnachart.jpg"><img data-attachment-id="2946" data-permalink="https://rumorsontheinternets.org/2010/10/14/magnasanti-the-largest-and-most-terrifying-simcity/magnachart/" data-orig-file="https://rumorsontheinternets.files.wordpress.com/2010/10/magnachart.jpg" data-orig-size="422,438" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;}" data-image-title="magnachart" data-image-description="" data-medium-file="https://rumorsontheinternets.files.wordpress.com/2010/10/magnachart.jpg?w=289" data-large-file="https://rumorsontheinternets.files.wordpress.com/2010/10/magnachart.jpg?w=422" title="magnachart" src="https://rumorsontheinternets.files.wordpress.com/2010/10/magnachart.jpg?w=630" alt="" srcset="https://rumorsontheinternets.files.wordpress.com/2010/10/magnachart.jpg 422w, https://rumorsontheinternets.files.wordpress.com/2010/10/magnachart.jpg?w=145 145w, https://rumorsontheinternets.files.wordpress.com/2010/10/magnachart.jpg?w=289 289w" sizes="(max-width: 422px) 100vw, 422px"></a></p>
<p><a href="https://rumorsontheinternets.files.wordpress.com/2010/10/magnalife.jpg"><img data-attachment-id="2947" data-permalink="https://rumorsontheinternets.org/2010/10/14/magnasanti-the-largest-and-most-terrifying-simcity/magnalife/" data-orig-file="https://rumorsontheinternets.files.wordpress.com/2010/10/magnalife.jpg" data-orig-size="424,440" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;}" data-image-title="magnalife" data-image-description="" data-medium-file="https://rumorsontheinternets.files.wordpress.com/2010/10/magnalife.jpg?w=289" data-large-file="https://rumorsontheinternets.files.wordpress.com/2010/10/magnalife.jpg?w=424" title="magnalife" src="https://rumorsontheinternets.files.wordpress.com/2010/10/magnalife.jpg?w=630" alt="" srcset="https://rumorsontheinternets.files.wordpress.com/2010/10/magnalife.jpg 424w, https://rumorsontheinternets.files.wordpress.com/2010/10/magnalife.jpg?w=145 145w, https://rumorsontheinternets.files.wordpress.com/2010/10/magnalife.jpg?w=289 289w" sizes="(max-width: 424px) 100vw, 424px"></a></p>
<p>Here is a video that explains some of the development process for Magnasanti, including two smaller cities that served as development prototypes for Oscala’s final achievement:</p>
<p><span><iframe width="630" height="355" src="https://www.youtube.com/embed/NTJQTc-TqpU?version=3&amp;rel=1&amp;fs=1&amp;autohide=2&amp;showsearch=0&amp;showinfo=1&amp;iv_load_policy=1&amp;wmode=transparent" allowfullscreen="true"></iframe></span></p>
<p>As the soundtrack indicates, Oscala was highly influenced by the art film <a href="http://en.wikipedia.org/wiki/Koyaanisquatsi" target="_blank">Koyaanisquatsi</a>, or “Life out of Balance,” directed by Godfrey Reggio with music by Philip Glass.</p>
<p>Koyaanisquatsi is a non-narrative work that examines and explores the contrasts between the form and pace of nature and modern human life. Ultimately, the film confronts us with the fact that our species is living a life out of balance with nature, for better or for worse.</p>
<p>It’s a really cool movie that is highly recommended. Here’s a teaser:</p>
<p><span><iframe width="630" height="355" src="https://www.youtube.com/embed/LFBijDU8PpE?version=3&amp;rel=1&amp;fs=1&amp;autohide=2&amp;showsearch=0&amp;showinfo=1&amp;iv_load_policy=1&amp;wmode=transparent" allowfullscreen="true"></iframe></span></p>
<p>Now, you may be asking, what in the world does a game of SimCity — in an obsolete version, no less — have to teach us about a “life out of balance”?</p>
<p>Magnasanti is, first and foremost, a study in how to game SimCity to a maximum-population win condition.</p>
<p>However, I do think it raises some intriguing questions.</p>
<p>Oscala <a href="http://www.viceland.com/blogs/uk-games/2010/05/10/the-totalitarian-buddhist-who-beat-sim-city/" target="_blank">comments</a>:</p>
<blockquote>
<p><strong>The film presented the world in a way I never really looked at before  and that captivated me. Moments like these compel me to physically  express progressions in my thought, I have just happened to do that  through the form of creating these cities in <em>SimCity 3000.</em> I  could probably have done something similar – depicting the awesome  regimentation and brutality of our society – with a series of paintings  on a canvas, or through hideous architectural models.</strong></p>
<p><strong>But it wouldn’t be  the same as doing it in the game, for the reason that I wanted to  magnify the unbelievably sick ambitions of egotistical political  dictators, ruling elites and downright insane architects, urban planners  and social engineers.</strong></p>
</blockquote>
<p>Australian architecture blog <a href="http://supercolossal.ch/2010/10/07/pay-to-click-get-rich-quick-urbanism-and-the-ideal-simcity/" target="_blank">Super Colossal discusses</a> some of the issues provoked by Magnasanti (link <a href="http://m.ammoth.us/blog/2010/10/magnasanti/" target="_blank">via</a>):</p>
<blockquote>
<p>This is the kind of archiporn that I am a sucker for; gamespace urbanism  exploited to its extreme condition. Can you ‘win’ urbanism? Is this  even urbanism? If not, can we take anything from its construction? The  primary move that the city makes is to remove cars altogether and base  transport purely on subways. I suspect this is a method to exploit the  space otherwise taken up by roads for real estate allowing for an  increased population per tile, however, it is a strategy that many  cities—Sydney included—are seriously looking into. Remove motor  vehicles, increase public transport. Seems like a sound idea.</p>
</blockquote>
<p>It is interesting to see a world in which the lack of cars exists alongside a lack of freedom, and indeed may even be symptomatic of it. Oscala has created a system so “sustainable” that citizens are chained to their city blocks; they’re able to access the rest of the city through mass transit, but in effect have been relieved of the need to do so by the ruthless efficiency of their cookie-cutter “neighborhoods.”</p>
<p>Maybe — all right, probably — this is effective because the game engine is warped. Super Colossal concludes that “Ultimately, Magnasanti has little to do with urban design and everything to do with gaming systems for maximum&nbsp;reward.”</p>
<p>I can’t help but think that Magnasanti represents a semi-realistic dark side of centralized urban planning: the tools of modern construction and city planning as wielded by a despotic madman bent on maximizing population at any cost. Creativity, vibrancy and nature itself are cast away as a focus on efficiency and the bottom line are elevated to a religion and a science.</p>
<p>And of course, the police force are ever-present, just in case disorder begins to stir.</p>
<p>As Oscala <a href="http://www.viceland.com/blogs/uk-games/2010/05/10/the-totalitarian-buddhist-who-beat-sim-city/" target="_blank">explained in an interview with Viceland</a>, Magnasanti represents a “cage” in which he has imprisoned six million “economic slaves”. He <a href="http://images.shareapic.net/images7/022530174.jpg" target="_blank">utilized the geometry</a> of the Buddhist Wheel of Life and Death as further symbolic comment on the topic.</p>
<blockquote><p><strong>Technically, no one is leaving or coming into the  city. Population growth is stagnant. Sims don’t need to travel long  distances, because their workplace is just within walking distance. In  fact they do not even need to leave their own block. Wherever they go  it’s like going to the same place. </strong></p>
<p><strong>There are a lot of other problems in the city hidden under the  illusion of order and greatness: Suffocating air pollution, high  unemployment, no fire stations, schools, or hospitals, a regimented  lifestyle – this is the price that these sims pay for living in the city  with the highest population. It’s a sick and twisted goal to strive  towards. </strong></p>
<p><strong>The ironic thing about it is the sims in Magnasanti tolerate  it. They don’t rebel, or cause revolutions and social chaos. No one  considers challenging the system by physical means since a  hyper-efficient police state keeps them in line. They have all been  successfully dumbed down, sickened with poor health, enslaved and  mind-controlled just enough to keep this system going for thousands of  years. 50,000 years to be exact. They are all imprisoned in space and  time.</strong></p></blockquote>
<p>The <a href="http://m.ammoth.us/blog/2010/10/magnasanti/" target="_blank">Mammoth blog</a> calls Magnasanti “An intentionally hellish vision which exploits the game’s internal logic as commentary.”</p>
<p>Oscala <a href="http://www.viceland.com/blogs/uk-games/2010/05/10/the-totalitarian-buddhist-who-beat-sim-city/" target="_blank">adds </a>that “if we make maximizing profits the absolute objective, we fail to take  into consideration the social and environmental consequences.”</p>
<p><strong>At the very least, it’s delicious food for thought for would-be urban planners and simulation gamers.</strong></p>
<p>Further reading and sources:<strong><br>
</strong></p>
<p>Viceland: <a title="Permanent Link to The Totalitarian Buddhist Who Beat Sim City" rel="bookmark" href="http://www.viceland.com/blogs/uk-games/2010/05/10/the-totalitarian-buddhist-who-beat-sim-city/">The Totalitarian Buddhist Who Beat Sim City</a><br>
Mammoth: <a href="http://m.ammoth.us/blog/2010/10/magnasanti/#" target="_blank">Magnasanti</a><br>
Super Colossal: <a rel="bookmark" href="http://supercolossal.ch/2010/10/07/pay-to-click-get-rich-quick-urbanism-and-the-ideal-simcity/" target="_blank">Pay to Click Get Rich Quick: Urbanism and the Ideal SimCity<br>
</a>Imperar’s Millionaire Experiment: <a href="http://imperar.blogs.linkbucks.com/who-is-imperar/" target="_blank">Who is Imperar?</a></p>
<p>Mildly related: <a href="http://en.wikipedia.org/wiki/The_Power_Broker" target="_blank">The Power Broker</a> and <a href="http://en.wikipedia.org/wiki/The_Death_and_Life_of_Great_American_Cities" target="_blank">The Death and Life of Great American Cities</a></p>
			
			
			
					
					<!--
					<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://rumorsontheinternets.org/2010/10/14/magnasanti-the-largest-and-most-terrifying-simcity/"
    dc:identifier="https://rumorsontheinternets.org/2010/10/14/magnasanti-the-largest-and-most-terrifying-simcity/"
    dc:title="Magnasanti: The Largest and Most Terrifying&nbsp;SimCity"
    trackback:ping="https://rumorsontheinternets.org/2010/10/14/magnasanti-the-largest-and-most-terrifying-simcity/trackback/" />
</rdf:RDF>					-->

				</div></div>]]>
            </description>
            <link>https://rumorsontheinternets.org/2010/10/14/magnasanti-the-largest-and-most-terrifying-simcity/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24052413</guid>
            <pubDate>Tue, 04 Aug 2020 17:34:18 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[You may finally use JSHint for evil]]>
            </title>
            <description>
<![CDATA[
Score 63 | Comments 74 (<a href="https://news.ycombinator.com/item?id=24051655">thread link</a>) | @catacombs
<br/>
August 4, 2020 | http://mikepennisi.com/blog/2020/jshint-watching-the-ship-sink/ | <a href="https://web.archive.org/web/*/http://mikepennisi.com/blog/2020/jshint-watching-the-ship-sink/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><section>

<p><strong>This is the first essay in <a href="http://mikepennisi.com/blog/2020/you-may-finally-use-jshint-for-evil/">a four-part series about relicensing the JSHint
software project</a>.</strong></p>

<p>The process of relicensing JSHint took seven years. That’s far longer than
anyone expected, but seeing this through wasn’t just a matter of endurance. As
I worked with people around the world to move to the MIT Expat license, I
regularly experienced how non-free licensing (even as seemingly trivial as
“Good, not Evil”) poisons the well of free software.</p>

<p>Some numbers might help here. The following graph shows how many times JSHint
has been downloaded from <a href="https://docs.npmjs.com/">npm</a> each week over the past
five years:</p>

<p><img src="http://mikepennisi.com/blog/jshint-watching-the-ship-sink-graph-1.png" alt="JSHint downloads over time"></p>

<p>We had a dip last year, but we’ve since recovered and then some. Over half a
million downloads per week sure sounds impressive, doesn’t it?</p>

<p>It <em>was</em> impressive in 2015. The fact is, npm’s usage has exploded over the
past half decade. Holding steady in this space is actually falling behind. Take
a look at the same statistic for <a href="https://eslint.org/">ESLint</a>, a truly open
source project with the same purpose and target audience as JSHint:</p>

<p><img src="http://mikepennisi.com/blog/jshint-watching-the-ship-sink-graph-2.png" alt="JSHint and ESLint downloads over time"></p>

<p>Suddenly that dip in 2019 doesn’t seem so important. How did JSHint go from
being the most popular tool in this space to one that most developers today
consider antiquated? There are many explanations, but in this essay, I’ll focus
on the effects of non-free licensing.</p>

<h3 id="for-license-sensitive-users">For license-sensitive users</h3>

<p>JSHint was partly licensed under <a href="https://www.gnu.org/licenses/license-list.html#JSON">the JSON
license</a>. It is nearly
identical to the widely-used MIT Expat license, but it includes one additional
clause:</p>

<blockquote>
<p>The Software shall be used for Good, not Evil.</p>
</blockquote>

<p>Because of this clause, folks who respect the practice of software licensing
simply could not use JSHint.</p>

<p>If you’re not versed in legal matters, that probably seems like an odd
restriction. By rejecting JSHint, are people admitting that they want to do
evil? And is that clause actually enforceable, anyway?</p>

<p>The answer to the second question is “no,” and that helps answer the first
question. Legally-conscious objectors aren’t betraying their own dastardly
motivations; they’re refusing to enter into an ambiguous contract. Put
differently: they’re not saying, “I’m an evildoer,” they’re saying, “I don’t
understand what you want.” This consideration disqualified JSHint from
inclusion in all sorts of contexts.</p>

<p>First, there were legally-conscious software repositories. Developers from the
<a href="https://www.debian.org/">Debian</a> and <a href="https://getfedora.org/">Fedora</a>
GNU/Linux distributions independently concluded that they could not include
JSHint due to licensing concerns. That’s why <a href="https://ubuntu.com/">Ubuntu</a>
users can’t download JSHint via <code>sudo apt-get install jshint</code>.</p>

<p>Even in less discerning package managers, folks built tools to empower
developers to make similar decisions on their own. For instance, JSHint has
been available on <a href="https://docs.npmjs.com/">npm</a> since its initial release, but
<a href="https://spdx.org/">SPDX</a> (along with tools like
<a href="https://github.com/ironSource/license-report"><code>license-report</code></a> and
<a href="https://classic.yarnpkg.com/en/docs/cli/licenses">Yarn</a>) has since been
designed to help folks understand the legal requirements of their dependencies.
This seemed like an encouraging trend toward conscientious code sharing, so <a href="https://github.com/jshint/jshint/pull/2420">we
did our part by adopting SPDX in
JSHint</a>.</p>

<p>More recently, an instructor at a US university wrote to the JSHint team asking
for permission to use JSHint in their course. I replied,</p>

<blockquote>
<p>By all means, you are welcome to use the project and its website in your
courses. Please note, however, that the source code is partially
published under the JSON license. The FSF does not recognize this as <a href="http://www.gnu.org/licenses/license-list.html">a
free software license</a> nor
does the Open Source Initiative recognize it as <a href="https://opensource.org/licenses/alphabetical">an open source
license</a>. This detail does not
effect most people in practice, but you may want to verify with your legal
team before relying on the code base.</p>
</blockquote>

<p>Honesty may be the best policy, but it also means fewer people are going to use
your bizarrely-encumbered JavaScript linter.</p>

<p>Finally, programming platforms that “repackaged” JSHint have reconsidered that
practice because of the license issue. There was a time when the popular
content management system <a href="https://wordpress.org/">WordPress</a> repackaged JSHint
in this way. Once they learned of the JSON license, <a href="https://core.trac.wordpress.org/ticket/42850">they replaced JSHint in a
matter of weeks</a>.</p>

<h3 id="for-feature-craving-users">For feature-craving users</h3>

<p>Plenty of people don’t give a fig about free software. Whatever their reason,
they couldn’t care less about the legal terms that are bundled with
publicly-available source code. The “Good, not Evil” clause also pushed them
away, even if they didn’t realize it.</p>

<p>It began with the decline in license-sensitive users. The word “user” is a bit
too passive in the context of open source tooling because folks who use the
software are particularly empowered to contribute back to it. The “user-base”
is directly correlated to the “contributor-base.” When a project like JSHint
loses users, it also loses contributors.</p>

<p>This slows the addition of new features and the correction of bugs. Timeliness
is important for these things, and people perceive delays very negatively. The
best example of this comes from JSHint’s delayed support for async functions.</p>

<p>(The async function is a JavaScript language feature which was <a href="https://tc39.es/ecma262/#sec-intro">introduced in
2017</a>. It’s very popular among developers
but also very difficult for parsers to implement correctly. <a href="https://jshint.com/blog/2019-02-05/release-2-10-0/">It took us over a
year to support it in
JSHint.</a>).</p>

<p>Some expressed their dissatisfaction with the delay in <a href="https://github.com/jshint/jshint/issues/2604#issuecomment-342173639">calm (though somewhat
impatient)
terms</a>:</p>

<blockquote>
<p>Async/await has been at stage 4 for over a month now (and baked into Node and
many mainstream browsers for longer), but jshint has yet to add support.</p>
</blockquote>

<p>…but others were more emotional:</p>

<ul>
<li><a href="https://github.com/jshint/jshint/issues/2604#issuecomment-329704124">“You just lost my interest in jshint. Sorry, to [sic]
slow.”</a></li>
<li><a href="https://github.com/jshint/jshint/issues/2604#issuecomment-331985362">“Thank you JSHint. It was good while it lasted. Switched to
ESLint.”</a></li>
<li><a href="https://github.com/jshint/jshint/issues/2604#issuecomment-340112372">“RIP
Jshint”</a></li>
<li><a href="https://github.com/jshint/jshint/issues/2604#issuecomment-455643712">“Seems like we waited enough. Bye JSHint. It was a good
time.”</a></li>
<li>“I know that you get a lot of complaints about this, but… if you can’t find
a way to include support for async/await, jshint is useless to me. I’m
switching to just using <code>node -c &lt;filename&gt;</code>” (via e-mail)</li>
</ul>

<p>The Internet has a way of surfacing the loudest and angriest perspectives, but
it seems safe to assume there was a substantial group of less vocal developers
who came to a similar conclusion.</p>

<p>A dwindling user/contributor-base is a vicious cycle. Though the movement may
have started with license-conscious folks, everyone felt the pain of the
release cycle equally, and their exodus exacerbated the problem.</p>

<p>This isn’t just a story of open-source “market” forces, though. My own
management decisions contributed to JSHint’s dissatisfying release cycle.</p>

<p>You see, many people express their dependency on software using a range of
versions. They don’t say, “give me Firefox at version 67.02.3” because they
don’t really care about that particular release. What they want is the software
to be familiar but also secure. They’re more likely to say, “give me the latest
version of Firefox 67.” With this statement, they’re trusting the maintainers
of Firefox to provide a program that looks and acts a certain way (i.e. not
exactly like version 65 or version 68) but that also has the latest bug fixes
(so 67.02.4 is preferable to 67.02.3).</p>

<p>This practice generally benefits users and developers alike. In my case,
though, I had a conflicting personal goal: I wanted the relicensed version of
JSHint to reach as many people as possible.</p>

<p>If we made drastic improvements to JSHint, we’d have to release a new major
version. The relicensing effort could continue with the new version, but many
people would continue to use the old version. For all the obsessing I’ve done
about JSHint over the years, I haven’t forgotten that most people aren’t
particularly concerned with the release schedule of their JavaScript linter.
When and if we succeeded, the users of the old version would be cut off from
our success (not to mention the improvements we made from that point forward).</p>

<p>This consideration made me averse to drastic changes in JSHint. Pretty
antithetical for a project maintainer.</p>

<h3 id="software-freedom-matters">Software freedom matters</h3>

<p>For many people, licensing is an esoteric part of software development. It’s a
relatable opinion: the legal frameworks are intimidating, and most
considerations can be addressed by simply defaulting to well-known
free/open-source licenses.</p>

<p>The trouble is that not all software is distributed under well-known
free/open-source licenses. My hope is that the particulars of JSHint’s decay
help folks understand why licensing matters.</p>

<p>After reading the drudgery of JSHint’s slow decline, you might be wondering why
we didn’t just give up. A sinking ship is only tragic if you value the ship. If
<a href="https://eslint.org/">a newer, faster, similarly-named ship</a> sails by, then
maybe it’s time to put down the bailer. It’ll take <a href="http://mikepennisi.com/blog/2020/jshint-dug-in/">another
essay</a> to address that fully.</p>
<ul>
  
</ul>

    </section></div>]]>
            </description>
            <link>http://mikepennisi.com/blog/2020/jshint-watching-the-ship-sink/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24051655</guid>
            <pubDate>Tue, 04 Aug 2020 16:35:53 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Let's build a full-text search engine]]>
            </title>
            <description>
<![CDATA[
Score 354 | Comments 65 (<a href="https://news.ycombinator.com/item?id=24051229">thread link</a>) | @elorant
<br/>
August 4, 2020 | https://artem.krylysov.com/blog/2020/07/28/lets-build-a-full-text-search-engine/ | <a href="https://web.archive.org/web/*/https://artem.krylysov.com/blog/2020/07/28/lets-build-a-full-text-search-engine/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article>
        

        


        <p>Full-Text Search is one of those tools people use every day without realizing it. If you ever googled "golang coverage report" or tried to find "indoor wireless camera" on an e-commerce website, you used some kind of full-text search.</p>
<p>Full-Text Search (FTS) is a technique for searching text in a collection of documents. A document can refer to a web page, a newspaper article, an email message, or any structured text.</p>
<p>Today we are going to build our own FTS engine. By the end of this post, we'll be able to search across millions of documents in less than a millisecond. We'll start with simple search queries like "give me all documents that contain the word <em>cat</em>" and we'll extend the engine to support more sophisticated boolean queries.</p>
<div>
<p>Note</p>
<p>Most well-known FTS engine is <a href="https://lucene.apache.org/" target="_blank">Lucene</a> (as well as <a href="https://github.com/elastic/elasticsearch" target="_blank">Elasticsearch</a> and Solr built on top of it).</p>
</div>
<div id="why-fts">
<h3>Why FTS<a href="#why-fts" title="Permalink to this headline"> #</a></h3>
<p>Before we start writing code, you may ask "can't we just use <em>grep</em> or have a loop that checks if every document contains the word I'm looking for?". Yes, we can. However, it's not always the best idea.</p>
</div>
<div id="corpus">
<h3>Corpus<a href="#corpus" title="Permalink to this headline"> #</a></h3>
<p>We are going to search a part of the abstract of English Wikipedia. The latest dump is available at <a href="https://dumps.wikimedia.org/enwiki/latest/enwiki-latest-abstract1.xml.gz" target="_blank">dumps.wikimedia.org</a>. As of today, the file size after decompression is 913 MB. The XML file contains over 600K documents.</p>
<p>Document example:</p>
<pre><code><span>&lt;title&gt;</span>Wikipedia: Kit-Cat Klock<span>&lt;/title&gt;</span>
<span>&lt;url&gt;</span>https://en.wikipedia.org/wiki/Kit-Cat_Klock<span>&lt;/url&gt;</span>
<span>&lt;abstract&gt;</span>The Kit-Cat Klock is an art deco novelty wall clock shaped like a grinning cat with cartoon eyes that swivel in time with its pendulum tail.<span>&lt;/abstract&gt;</span></code></pre>
</div>
<div id="loading-documents">
<h3>Loading documents<a href="#loading-documents" title="Permalink to this headline"> #</a></h3>
<p>First, we need to load all the documents from the dump. The built-in <span>encoding/xml</span> package comes very handy:</p>
<pre><code><span>import</span> <span>(</span>
    <span>"encoding/xml"</span>
    <span>"os"</span>
<span>)</span>

<span>type</span> <span>document</span> <span>struct</span> <span>{</span>
    <span>Title</span> <span>string</span> <span>`xml:"title"`</span>
    <span>URL</span>   <span>string</span> <span>`xml:"url"`</span>
    <span>Text</span>  <span>string</span> <span>`xml:"abstract"`</span>
    <span>ID</span>    <span>int</span>
<span>}</span>

<span>func</span> <span>loadDocuments</span><span>(</span><span>path</span> <span>string</span><span>)</span> <span>([]</span><span>document</span><span>,</span> <span>error</span><span>)</span> <span>{</span>
    <span>f</span><span>,</span> <span>err</span> <span>:=</span> <span>os</span><span>.</span><span>Open</span><span>(</span><span>path</span><span>)</span>
    <span>if</span> <span>err</span> <span>!=</span> <span>nil</span> <span>{</span>
        <span>return</span> <span>nil</span><span>,</span> <span>err</span>
    <span>}</span>
    <span>defer</span> <span>f</span><span>.</span><span>Close</span><span>()</span>

    <span>dec</span> <span>:=</span> <span>xml</span><span>.</span><span>NewDecoder</span><span>(</span><span>f</span><span>)</span>
    <span>dump</span> <span>:=</span> <span>struct</span> <span>{</span>
        <span>Documents</span> <span>[]</span><span>document</span> <span>`xml:"doc"`</span>
    <span>}{}</span>
    <span>if</span> <span>err</span> <span>:=</span> <span>dec</span><span>.</span><span>Decode</span><span>(</span><span>&amp;</span><span>dump</span><span>);</span> <span>err</span> <span>!=</span> <span>nil</span> <span>{</span>
        <span>return</span> <span>nil</span><span>,</span> <span>err</span>
    <span>}</span>

    <span>docs</span> <span>:=</span> <span>dump</span><span>.</span><span>Documents</span>
    <span>for</span> <span>i</span> <span>:=</span> <span>range</span> <span>docs</span> <span>{</span>
        <span>docs</span><span>[</span><span>i</span><span>].</span><span>ID</span> <span>=</span> <span>i</span>
    <span>}</span>
    <span>return</span> <span>docs</span><span>,</span> <span>nil</span>
<span>}</span></code></pre>
<p>Every loaded document gets assigned a unique identifier.
To keep things simple, the first loaded document gets assigned ID=0, the second ID=1 and so on.</p>
</div>
<div id="first-attempt">
<h3>First attempt<a href="#first-attempt" title="Permalink to this headline"> #</a></h3>
<div id="searching-the-content">
<h4>Searching the content<a href="#searching-the-content" title="Permalink to this headline"> #</a></h4>
<p>Now that we have all documents loaded into memory, we can try to find the ones about cats. At first, let's loop through all documents and check if they contain the substring <em>cat</em>:</p>
<pre><code><span>func</span> <span>search</span><span>(</span><span>docs</span> <span>[]</span><span>document</span><span>,</span> <span>term</span> <span>string</span><span>)</span> <span>[]</span><span>document</span> <span>{</span>
    <span>var</span> <span>r</span> <span>[]</span><span>document</span>
    <span>for</span> <span>_</span><span>,</span> <span>doc</span> <span>:=</span> <span>range</span> <span>docs</span> <span>{</span>
        <span>if</span> <span>strings</span><span>.</span><span>Contains</span><span>(</span><span>doc</span><span>.</span><span>Text</span><span>,</span> <span>term</span><span>)</span> <span>{</span>
            <span>r</span> <span>=</span> <span>append</span><span>(</span><span>r</span><span>,</span> <span>doc</span><span>)</span>
        <span>}</span>
    <span>}</span>
    <span>return</span> <span>r</span>
<span>}</span></code></pre>
<p>On my laptop, the search phase takes 103ms - not too bad.
If you spot check a few documents from the output, you may notice that the function matches <em>caterpillar</em> and <em>category</em>, but doesn't match <em>Cat</em> with the capital <em>C</em>. That's not quite what I was looking for.</p>
<p>We need to fix two things before moving forward:</p>
<ul>
<li><p>Make the search case-insensitive (so <em>Cat</em> matches as well).</p></li>
<li><p>Match on a word boundary rather than on a substring (so <em>caterpillar</em> and <em>communication</em> don't match).</p></li>
</ul>
</div>
<div id="searching-with-regular-expressions">
<h4>Searching with regular expressions<a href="#searching-with-regular-expressions" title="Permalink to this headline"> #</a></h4>
<p>One solution that quickly comes to mind and allows implementing both requirements is <em>regular expressions</em>.</p>
<p>Here it is - <span><span>(?i)\bcat\b</span></span>:</p>
<ul>
<li><p><span><span>(?i)</span></span> makes the regex case-insensitive</p></li>
<li><p><span>\b</span> matches a word boundary (position where one side is a word character and another side is not a word character)</p></li>
</ul>
<pre><code><span>func</span> <span>search</span><span>(</span><span>docs</span> <span>[]</span><span>document</span><span>,</span> <span>term</span> <span>string</span><span>)</span> <span>[]</span><span>document</span> <span>{</span>
    <span>re</span> <span>:=</span> <span>regexp</span><span>.</span><span>MustCompile</span><span>(</span><span>`(?i)\b`</span> <span>+</span> <span>term</span> <span>+</span> <span>`\b`</span><span>)</span> <span>// Don't do this in production, it's a security risk. term needs to be sanitized.
</span>    <span>var</span> <span>r</span> <span>[]</span><span>document</span>
    <span>for</span> <span>_</span><span>,</span> <span>doc</span> <span>:=</span> <span>range</span> <span>docs</span> <span>{</span>
        <span>if</span> <span>re</span><span>.</span><span>MatchString</span><span>(</span><span>doc</span><span>.</span><span>Text</span><span>)</span> <span>{</span>
            <span>r</span> <span>=</span> <span>append</span><span>(</span><span>r</span><span>,</span> <span>doc</span><span>)</span>
        <span>}</span>
    <span>}</span>
    <span>return</span> <span>r</span>
<span>}</span></code></pre>
<p>Ugh, the search took more than 2 seconds. As you can see, things started getting slow even with 600K documents. While the approach is easy to implement, it doesn't scale well. As the dataset grows larger, we need to scan more and more documents. The time complexity of this algorithm is linear - the number of documents required to scan is equal to the total number of documents. If we had 6M documents instead of 600K, the search would take 20 seconds. We need to do better than that.</p>
</div>
</div>
<div id="inverted-index">
<h3>Inverted Index<a href="#inverted-index" title="Permalink to this headline"> #</a></h3>
<p>To make search queries faster, we'll preprocess the text and build an index in advance.</p>
<p>The core of FTS is a data structure called <em>Inverted Index</em>.
The Inverted Index associates every word in documents with documents that contain the word.</p>
<p>Example:</p>
<pre><code><span>documents</span> <span>=</span> <span>{</span>
    <span>1</span><span>:</span> <span>"a donut on a glass plate"</span><span>,</span>
    <span>2</span><span>:</span> <span>"only the donut"</span><span>,</span>
    <span>3</span><span>:</span> <span>"listen to the drum machine"</span><span>,</span>
<span>}</span>

<span>index</span> <span>=</span> <span>{</span>
    <span>"a"</span><span>:</span> <span>[</span><span>1</span><span>],</span>
    <span>"donut"</span><span>:</span> <span>[</span><span>1</span><span>,</span> <span>2</span><span>],</span>
    <span>"on"</span><span>:</span> <span>[</span><span>1</span><span>],</span>
    <span>"glass"</span><span>:</span> <span>[</span><span>1</span><span>],</span>
    <span>"plate"</span><span>:</span> <span>[</span><span>1</span><span>],</span>
    <span>"only"</span><span>:</span> <span>[</span><span>2</span><span>],</span>
    <span>"the"</span><span>:</span> <span>[</span><span>2</span><span>,</span> <span>3</span><span>],</span>
    <span>"listen"</span><span>:</span> <span>[</span><span>3</span><span>],</span>
    <span>"to"</span><span>:</span> <span>[</span><span>3</span><span>],</span>
    <span>"drum"</span><span>:</span> <span>[</span><span>3</span><span>],</span>
    <span>"machine"</span><span>:</span> <span>[</span><span>3</span><span>],</span>
<span>}</span></code></pre>
<p>Below is a real-world example of the Inverted Index. An index in a book where a term references a page number:</p>
<p><img alt="" src="https://artem.krylysov.com/images/2020-fts/book-index.png">
</p></div>
<div id="text-analysis">
<h3>Text analysis<a href="#text-analysis" title="Permalink to this headline"> #</a></h3>
<p>Before we start building the index, we need to break the raw text down into a list of words (tokens) suitable for indexing and searching.</p>
<p>The text analyzer consists of a tokenizer and multiple filters.</p>
<p><img alt="" src="https://artem.krylysov.com/images/2020-fts/text-analysis.png">
</p></div>
<div id="tokenizer">
<h3>Tokenizer<a href="#tokenizer" title="Permalink to this headline"> #</a></h3>
<p>The tokenizer is the first step of text analysis. Its job is to convert text into a list of tokens. Our implementation splits the text on a word boundary and removes punctuation marks:</p>
<pre><code><span>func</span> <span>tokenize</span><span>(</span><span>text</span> <span>string</span><span>)</span> <span>[]</span><span>string</span> <span>{</span>
    <span>return</span> <span>strings</span><span>.</span><span>FieldsFunc</span><span>(</span><span>text</span><span>,</span> <span>func</span><span>(</span><span>r</span> <span>rune</span><span>)</span> <span>bool</span> <span>{</span>
        <span>// Split on any character that is not a letter or a number.
</span>        <span>return</span> <span>!</span><span>unicode</span><span>.</span><span>IsLetter</span><span>(</span><span>r</span><span>)</span> <span>&amp;&amp;</span> <span>!</span><span>unicode</span><span>.</span><span>IsNumber</span><span>(</span><span>r</span><span>)</span>
    <span>})</span>
<span>}</span></code></pre>
<pre><code><span>&gt;</span> <span>tokenize</span><span>(</span><span>"A donut on a glass plate. Only the donuts."</span><span>)</span>

<span>[</span><span>"A"</span><span>,</span> <span>"donut"</span><span>,</span> <span>"on"</span><span>,</span> <span>"a"</span><span>,</span> <span>"glass"</span><span>,</span> <span>"plate"</span><span>,</span> <span>"Only"</span><span>,</span> <span>"the"</span><span>,</span> <span>"donuts"</span><span>]</span></code></pre>
</div>
<div id="filters">
<h3>Filters<a href="#filters" title="Permalink to this headline"> #</a></h3>
<p>In most cases, just converting text into a list of tokens is not enough. To make the text easier to index and search, we'll need to do additional normalization.</p>
<div id="lowercase">
<h4>Lowercase<a href="#lowercase" title="Permalink to this headline"> #</a></h4>
<p>In order to make the search case-insensitive, the lowercase filter converts tokens to lower case. <em>cAt</em>, <em>Cat</em> and <em>caT</em> are normalized to <em>cat</em>.
Later, when we query the index, we'll lower case the search terms as well. This will make the search term <em>cAt</em> match the text <em>Cat</em>.</p>
<pre><code><span>func</span> <span>lowercaseFilter</span><span>(</span><span>tokens</span> <span>[]</span><span>string</span><span>)</span> <span>[]</span><span>string</span> <span>{</span>
    <span>r</span> <span>:=</span> <span>make</span><span>([]</span><span>string</span><span>,</span> <span>len</span><span>(</span><span>tokens</span><span>))</span>
    <span>for</span> <span>i</span><span>,</span> <span>token</span> <span>:=</span> <span>range</span> <span>tokens</span> <span>{</span>
        <span>r</span><span>[</span><span>i</span><span>]</span> <span>=</span> <span>strings</span><span>.</span><span>ToLower</span><span>(</span><span>token</span><span>)</span>
    <span>}</span>
    <span>return</span> <span>r</span>
<span>}</span></code></pre>
<pre><code><span>&gt;</span> <span>lowercaseFilter</span><span>([]</span><span>string</span><span>{</span><span>"A"</span><span>,</span> <span>"donut"</span><span>,</span> <span>"on"</span><span>,</span> <span>"a"</span><span>,</span> <span>"glass"</span><span>,</span> <span>"plate"</span><span>,</span> <span>"Only"</span><span>,</span> <span>"the"</span><span>,</span> <span>"donuts"</span><span>})</span>

<span>[</span><span>"a"</span><span>,</span> <span>"donut"</span><span>,</span> <span>"on"</span><span>,</span> <span>"a"</span><span>,</span> <span>"glass"</span><span>,</span> <span>"plate"</span><span>,</span> <span>"only"</span><span>,</span> <span>"the"</span><span>,</span> <span>"donuts"</span><span>]</span></code></pre>
</div>
<div id="dropping-common-words">
<h4>Dropping common words<a href="#dropping-common-words" title="Permalink to this headline"> #</a></h4>
<p>Almost any English text contains commonly used words like <em>a</em>, <em>I</em>, <em>the</em> or <em>be</em>. Such words are called <em>stop words</em>. We are going to remove them since almost any document would match the stop words.</p>
<p>There is no "official" list of stop words. Let's exclude the top 10 by the <a href="https://en.wikipedia.org/wiki/Most_common_words_in_English" target="_blank">OEC rank</a>. Feel free to add more:</p>
<pre><code><span>var</span> <span>stopwords</span> <span>=</span> <span>map</span><span>[</span><span>string</span><span>]</span><span>struct</span><span>{}{</span> <span>// I wish Go had built-in sets.
</span>    <span>"a"</span><span>:</span> <span>{},</span> <span>"and"</span><span>:</span> <span>{},</span> <span>"be"</span><span>:</span> <span>{},</span> <span>"have"</span><span>:</span> <span>{},</span> <span>"i"</span><span>:</span> <span>{},</span>
    <span>"in"</span><span>:</span> <span>{},</span> <span>"of"</span><span>:</span> <span>{},</span> <span>"that"</span><span>:</span> <span>{},</span> <span>"the"</span><span>:</span> <span>{},</span> <span>"to"</span><span>:</span> <span>{},</span>
<span>}</span>

<span>func</span> <span>stopwordFilter</span><span>(</span><span>tokens</span> <span>[]</span><span>string</span><span>)</span> <span>[]</span><span>string</span> <span>{</span>
    <span>r</span> <span>:=</span> <span>make</span><span>([]</span><span>string</span><span>,</span> <span>0</span><span>,</span> <span>len</span><span>(</span><span>tokens</span><span>))</span>
    <span>for</span> <span>_</span><span>,</span> <span>token</span> <span>:=</span> <span>range</span> <span>tokens</span> <span>{</span>
        <span>if</span> <span>_</span><span>,</span> <span>ok</span> <span>:=</span> <span>stopwords</span><span>[</span><span>token</span><span>];</span> <span>!</span><span>ok</span> <span>{</span>
            <span>r</span> <span>=</span> <span>append</span><span>(</span><span>r</span><span>,</span> <span>token</span><span>)</span>
        <span>}</span>
    <span>}</span>
    <span>return</span> <span>r</span>
<span>}</span></code></pre>
<pre><code><span>&gt;</span> <span>stopwordFilter</span><span>([]</span><span>string</span><span>{</span><span>"a"</span><span>,</span> <span>"donut"</span><span>,</span> <span>"on"</span><span>,</span> <span>"a"</span><span>,</span> <span>"glass"</span><span>,</span> <span>"plate"</span><span>,</span> <span>"only"</span><span>,</span> <span>"the"</span><span>,</span> <span>"donuts"</span><span>})</span>

<span>[</span><span>"donut"</span><span>,</span> <span>"on"</span><span>,</span> <span>"glass"</span><span>,</span> <span>"plate"</span><span>,</span> <span>"only"</span><span>,</span> <span>"donuts"</span><span>]</span></code></pre>
</div>
<div id="stemming">
<h4>Stemming<a href="#stemming" title="Permalink to this headline"> #</a></h4>
<p>Because of the grammar rules, documents may include different forms of the same word.
Stemming reduces words into their base form. For example, <em>fishing</em>, <em>fished</em> and <em>fisher</em> may be reduced to the base form (stem) <em>fish</em>.</p>
<p>Implementing a stemmer is a non-trivial task, it's not covered in this post. We'll take one of the <a href="https://github.com/kljensen/snowball" target="_blank">existing</a> modules:</p>
<pre><code><span>import</span> <span>snowballeng</span> <span>"github.com/kljensen/snowball/english"</span>

<span>func</span> <span>stemmerFilter</span><span>(</span><span>tokens</span> <span>[]</span><span>string</span><span>)</span> <span>[]</span><span>string</span> <span>{</span>
    <span>r</span> <span>:=</span> <span>make</span><span>([]</span><span>string</span><span>,</span> <span>len</span><span>(</span><span>tokens</span><span>))</span>
    <span>for</span> <span>i</span><span>,</span> <span>token</span> <span>:=</span> <span>range</span> <span>tokens</span> <span>{</span>
        <span>r</span><span>[</span><span>i</span><span>]</span> <span>=</span> <span>snowballeng</span><span>.</span><span>Stem</span><span>(</span><span>token</span><span>,</span> <span>false</span><span>)</span>
    <span>}</span>
    <span>return</span> <span>r</span>
<span>}</span></code></pre>
<pre><code><span>&gt;</span> <span>stemmerFilter</span><span>([]</span><span>string</span><span>{</span><span>"donut"</span><span>,</span> <span>"on"</span><span>,</span> <span>"glass"</span><span>,</span> <span>"plate"</span><span>,</span> <span>"only"</span><span>,</span> <span>"donuts"</span><span>})</span>

<span>[</span><span>"donut"</span><span>,</span> <span>"on"</span><span>,</span> <span>"glass"</span><span>,</span> <span>"plate"</span><span>,</span> <span>"only"</span><span>,</span> <span>"donut"</span><span>]</span></code></pre>
<div>
<p>Note</p>
<p>A stem is not always a valid word. For example, some stemmers may reduce <em>airline</em> to <em>airlin</em>.</p>
</div>
</div>
</div>
<div id="putting-the-analyzer-together">
<h3>Putting the analyzer together<a href="#putting-the-analyzer-together" title="Permalink to this headline"> #</a></h3>
<pre><code><span>func</span> <span>analyze</span><span>(</span><span>text</span> <span>string</span><span>)</span> <span>[]</span><span>string</span> <span>{</span>
    <span>tokens</span> <span>:=</span> <span>tokenize</span><span>(</span><span>text</span><span>)</span>
    <span>tokens</span> <span>=</span> <span>lowercaseFilter</span><span>(</span><span>tokens</span><span>)</span>
    <span>tokens</span> <span>=</span> <span>stopwordFilter</span><span>(</span><span>tokens</span><span>)</span>
    <span>tokens</span> <span>=</span> <span>stemmerFilter</span><span>(</span><span>tokens</span><span>)</span>
    <span>return</span> <span>tokens</span>
<span>}</span></code></pre>
<p>The tokenizer and filters convert sentences into a list of tokens:</p>
<pre><code><span>&gt;</span> <span>analyze</span><span>(</span><span>"A donut on a glass plate. Only the donuts."</span><span>)</span>

<span>[</span><span>"donut"</span><span>,</span> <span>"on"</span><span>,</span> <span>"glass"</span><span>,</span> <span>"plate"</span><span>,</span> <span>"only"</span><span>,</span> <span>"donut"</span><span>]</span></code></pre>
<p>The tokens are ready for indexing.</p>
</div>
<div id="building-the-index">
<h3>Building the index<a href="#building-the-index" title="Permalink to this headline"> #</a></h3>
<p>Back to the inverted index. It maps every word in documents to document IDs.
The built-in <span>map</span> is a good candidate for storing the mapping.
The key in the map is a token (string) and the value is a list of document IDs:</p>
<pre><code><span>type</span> <span>index</span> <span>map</span><span>[</span><span>string</span><span>][]</span><span>int</span></code></pre>
<p>Building the index consists of analyzing the documents and adding their IDs to the map:</p>
<pre><code><span>func</span> <span>(</span><span>idx</span> <span>index</span><span>)</span> <span>add</span><span>(</span><span>docs</span> <span>[]</span><span>document</span><span>)</span> <span>{</span>
    <span>for</span> <span>_</span><span>,</span> <span>doc</span> <span>:=</span> <span>range</span> <span>docs</span> <span>{</span>
        <span>for</span> <span>_</span><span>,</span> <span>token</span> <span>:=</span> <span>range</span> <span>analyze</span><span>(</span><span>doc</span><span>.</span><span>Text</span><span>)</span> <span>{</span>
            <span>ids</span> <span>:=</span> <span>idx</span><span>[</span><span>token</span><span>]</span>
            <span>if</span> <span>ids</span> <span>!=</span> <span>nil</span> <span>&amp;&amp;</span> <span>ids</span><span>[</span><span>len</span><span>(</span><span>ids</span><span>)</span><span>-</span><span>1</span><span>]</span> <span>==</span> <span>doc</span><span>.</span><span>ID</span> <span>{</span>
                <span>// Don't add same ID twice.
</span>                <span>continue</span>
            <span>}</span>
            <span>idx</span><span>[</span><span>token</span><span>]</span> <span>=</span> <span>append</span><span>(</span><span>ids</span><span>,</span> <span>doc</span><span>.</span><span>ID</span><span>)</span>
        <span>}</span>
    <span>}</span>
<span>}</span>

<span>func</span> <span>main</span><span>()</span> <span>{</span>
    <span>idx</span> <span>:=</span> <span>make</span><span>(</span><span>index</span><span>)</span>
    <span>idx</span><span>.</span><span>add</span><span>([]</span><span>document</span><span>{{</span><span>ID</span><span>:</span> <span>1</span><span>,</span> <span>Text</span><span>:</span> <span>"A donut on a glass plate. Only the donuts."</span><span>}})</span>
    <span>idx</span><span>.</span><span>add</span><span>([]</span><span>document</span><span>{{</span><span>ID</span><span>:</span> <span>2</span><span>,</span> <span>Text</span><span>:</span> <span>"donut is a donut"</span><span>}})</span>
    <span>fmt</span><span>.</span><span>Println</span><span>(</span><span>idx</span><span>)</span>
<span>}</span></code></pre>
<p>It works! Each token in the map refers to IDs of the documents that contain the token:</p>
<pre><code>map[donut:[1 2] glass:[1] …</code></pre></div></article></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://artem.krylysov.com/blog/2020/07/28/lets-build-a-full-text-search-engine/">https://artem.krylysov.com/blog/2020/07/28/lets-build-a-full-text-search-engine/</a></em></p>]]>
            </description>
            <link>https://artem.krylysov.com/blog/2020/07/28/lets-build-a-full-text-search-engine/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24051229</guid>
            <pubDate>Tue, 04 Aug 2020 15:59:01 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Planning for My Kidnapping]]>
            </title>
            <description>
<![CDATA[
Score 100 | Comments 96 (<a href="https://news.ycombinator.com/item?id=24050837">thread link</a>) | @polote
<br/>
August 4, 2020 | https://blog.luap.info/planning-for-my-kidnapping.html | <a href="https://web.archive.org/web/*/https://blog.luap.info/planning-for-my-kidnapping.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>

		  <div role="main">
	<article>

		


		<p>Imagine tomorrow you go shopping and, for whatever reason, you never come back. Maybe be someone killed you, maybe someone kidnapped you, maybe you had an accident ... Now imagine you are travelling alone in Thailand and you die. How people who know you are going to find out what happen ? if you are being kidnaped how the police will do to find you, if you got lost how people will find you ? If you die how your family is going to find your papers ?</p>
<p>I wanted to find a way to answer all those questions, basically we can sum up the issues in 3 points :
- In case of being kidnaped or getting lost send as much information on your last location, and following locations, your last activity, all your digital information to someone who is going to help liberating you
- In case of dying, sending all your documents (passwords, friends list, legal documents, ...) to your family
- Not sending those documents by mistakes if you are not on the situations above</p>
<h2>First step : collect your position, your activity, your documents, ...</h2>
<p>The first step is to be sure that you have the data that you want to send, on my part, the data are:</p>
<ol>
<li>My current position and recent history</li>
<li>My last know activity and a recent history</li>
<li>The list of my credentials</li>
<li>The list of my legal documents (id, passport, health insurance, work papers, ...)</li>
</ol>
<p>I've written an <a href="https://blog.luap.info/how-i-track-my-life.html">article</a> explaining how I'm doing 1. and 2. (position in real time, and last activity), so this is fixed.</p>
<p>For my credentials, I use <a href="https://keepassxc.org/">keepassXC</a> with a keyfile + a master password, the keyfile and the password db is synced using <a href="https://syncthing.net/">syncthingd</a> with a server that I rent</p>
<p>My legal documents are all tied in one folder on my laptop which is also synced on the same server</p>
<p>So basically we have all the needed documents which are synced in real time on the same server</p>
<h2>Second step : Choose how to trigger the sharing of documents</h2>
<p>The biggest problem is you want the alert to react quickly but not fire because you have been sleeping for 8 hours. So I chose to rely on the time since I last changed of activity. Currently after 24h without changing activity a first notification is sent to my own email so that if this is a mistake I can stop the system before it is too late. And if 6 hours later I've still haven't changed of activity then a mail is sent to my parents.</p>
<p>So basically if something happens to me my parents will be notified maximum 30h after the event, this is not so great but this is a good beginning. In the future I should try to have an adaptive delay depending on the last activity, for example if my last activity is eating, then I won't eat for 24 hours, so I can trigger the alert after for example 4 hours.</p>
<h2>Last step : What to put inside the notification</h2>
<p>So my parents will receive an email after 30 hours of inactivity. In this email there is a link to a page which will allow them to retrieve all the documents.
<img alt="email" src="https://blog.luap.info/static/kidnap/email.png"></p>
<p>The link is random generated link available only 6 hours, this is important to be safe as you don't want anyone to be able to access all your passwords ...</p>
<p>And the page, there are explanations of that page is about, like, "maybe I was kidnaped, maybe I'm lost, check my last time active on whatsapp, contact xxxx to see if he knows anything"
You can also view the current position of my phone and a small location history, that way you can see if I'm still moving, or if the last point if 30 hours old, you can also see my last activity and when it started</p>
<p>And finally you can get the list of all my passwords, for that purpose I created a form, with 6 facts on my life, that only my parents can know all of them, like what was the color of my first car ..., then there you can submit your answer, there is a rate limit on the number of requests you can make to prevent a brute force. If the 6 answers are true, the backend will decode the keepassxc archive and return a json of the archive, containing all of my credentials, including the ssh password to connect on the server to get all the paper documents.</p>
<h2>Conclusion</h2>
<p>I know that all of that is far from being perfect. I check every few months that the alerting is working, by decreasing the delay to trigger the alert, but the server can go down, ton of things can happen to make the system not working, so that's why I tried to keep everything as simple as possible, postgresql + django + cron. Someone should create a service to manage that at a bigger scale, or maybe that's something that 1password or others could include in their offer</p>	

	</article>


		  </div>	

		  

	  </div></div>]]>
            </description>
            <link>https://blog.luap.info/planning-for-my-kidnapping.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-24050837</guid>
            <pubDate>Tue, 04 Aug 2020 15:20:39 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Unlearn rotation matrices as rotations]]>
            </title>
            <description>
<![CDATA[
Score 247 | Comments 103 (<a href="https://news.ycombinator.com/item?id=24049593">thread link</a>) | @dosshell
<br/>
August 4, 2020 | https://kodkodgames.gitlab.io/rotation_matrices/ | <a href="https://web.archive.org/web/*/https://kodkodgames.gitlab.io/rotation_matrices/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
      <main id="main">
        




<i data-feather="calendar"></i> <time datetime="2020-06-12">2020-06-12</time>

<p>– Hey, Markus! What format is this head-rotation representation in?</p>
<p>– It is a rotation matrix, I answer. Right handed, z forward through the nose and x through the left ear. Our young newly graduated colleague nods his/her head.</p>
<p>After about 10 minutes I hear my name again.</p>
<p>– Markus…. Eh, what order is it?</p>
<p>– Oh no! You have opened Wikipedia? Haven’t you? I answer in despair from my desk.</p>
<p>It happens time to time that a newly graduated engineer (or summer intern) asks me exactly this question. Almost always with the Wikipedia page open at the screen, which I think is horrible (or even worse, some “Learn OpenGL” tutorial).</p>
<p>I <s>steal</s> take a chair to sit down beside the person. This will take a few minutes, we are going to do something that is harder than learning: we are going to unlearn.</p>
<p>It is interesting, I get no questions, or only very short questions, on Euler angels, Rodriguez rotations and actually only one recurrent question on quaternions. But very often I get questions on rotation matrices. I think it is a bit odd since rotation matrices are very simple in comparison to many other rotation representations. I think a big reason for this is the Wikipedia page. It looks something like this:</p>
<p>
\[
R_x(\theta) =
\begin{bmatrix}
1 &amp; 0 &amp; 0 \\
0 &amp; \cos \theta &amp;  -\sin \theta \\
0 &amp; \sin \theta  &amp;  \cos \theta
\end{bmatrix}
\]
\[
R_y(\theta) =
\begin{bmatrix}
\cos \theta &amp; 0 &amp; \sin \theta \\
0 &amp; 1 &amp; 0 \\
-\sin \theta &amp; 0 &amp; \cos \theta
\end{bmatrix}
\]
\[
R_z(\theta) =
\begin{bmatrix}
\cos \theta &amp;  -\sin \theta &amp; 0 \\
\sin \theta &amp;   \cos \theta &amp; 0\\
0 &amp; 0 &amp; 1\\
\end{bmatrix}
\]
\[
R =
\begin{bmatrix}
\cos\alpha\cos\beta &amp; \cos\alpha\sin\beta\sin\gamma - \sin\alpha\cos\gamma &amp; \cos\alpha\sin\beta\cos\gamma + \sin\alpha\sin\gamma \\
\sin\alpha\cos\beta &amp; \sin\alpha\sin\beta\sin\gamma + \cos\alpha\cos\gamma &amp; \sin\alpha\sin\beta\cos\gamma - \cos\alpha\sin\gamma \\
-\sin\beta &amp; \cos\beta\sin\gamma &amp; \cos\beta\cos\gamma \\
\end{bmatrix}
\]
</p>
<p>It talks about rotations. Rotation around different axes and their relation to Euler angles. This can be a bit confusing when working with for example a head pose. You can of course think about rotation matrices as if the head rotates around different axes in different order, but it becomes kind of hard to interpret:</p>
<p>
\[
\begin{bmatrix}
 -0.9987820 &amp; 0.0348782 &amp; -0.0348995 \\
  0.0283128 &amp; 0.9844193 &amp;  0.1735424 \\
  0.0404086 &amp; 0.1723429 &amp; -0.9842078
\end{bmatrix}
\]
</p>
<p>So to interpret this we need to solve the following equation system:</p>
<p>
\[
\begin{cases}
-\sin(\beta) &amp; = 0.0404086 \\
\cos(\beta)\sin(\gamma) &amp; = 0.1723429 \\
\cos(\alpha)\cos(\beta) &amp; = -0.9987820
\end{cases}
\]
</p>
<p>and then we get an <em>“intrinsic rotation whose Tait–Bryan angles are α, β, γ, about axes z, y, x”</em> to visualize in our head.</p>
<p>Its sad because I think rotation matrices are one of the easiest representation to interpret.</p>
<p>Don’t think of them as rotations, think of them as a unit vectors of a new coordinate systems.</p>
<p><img src="https://kodkodgames.gitlab.io/post/matrix_cs.png#center" alt="plot of the coordinate system"></p>
<p>We describe where the coordinate system is located related to another coordinate system (where we rotate from), for example from the camera’s coordinate system perspective (z forward, y upwards). The first column of the rotation matrix is the new x-axis expressed in the old coordinate system, the second column is the y-axis and so on. An identity matrix would yield in no rotation since all unit vectors would be the same as the previous coordinate system.</p>
<p>
\[
R =
\begin{bmatrix}
  X_x &amp; Y_x &amp; Z_x \\
  X_y &amp; Y_y &amp;  Z_y \\
  X_z &amp; Y_z &amp; Z_z
\end{bmatrix}
\]
</p> 
<p>Lets go back to the example with the head expressed in the camera coordinate system and assume the head position is atfront of the camera. So by interpret the previous matrix, we can look at the new z-axis:</p>
<p>
\[
Z_{axis} = 
\begin{bmatrix}
Z_x \\
Z_y \\
Z_z
\end{bmatrix}
=
\begin{bmatrix}
-0.0348995 \\
0.1735424 \\
-0.9842078
\end{bmatrix}
\]
</p>
<p>(Remember that z-axis is where the head’s nose is pointing)</p>
<p>We can quickly see that z-part of the z-axis is almost -1. This means the nose is pointing at the opposite direction as the camera, eg. towards the camera if the person is sitting at front of it.</p>
<p>We can also se that the persons head is rotated a little bit up (positive y component of the z-axis) and is pointing a little bit to the right of the camera (negative x component).</p>
<p>And that’s it! Rotation matrices just describe the unit vectors of a new coordinate system.</p>
<p>…</p>
<p>– Hey, Markus! How come this matrix is 4x4?</p>
<p>// Markus</p>
<p><a href="https://news.ycombinator.com/item?id=24049593">HN discussion</a></p>




      </main>
    </div></div>]]>
            </description>
            <link>https://kodkodgames.gitlab.io/rotation_matrices/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24049593</guid>
            <pubDate>Tue, 04 Aug 2020 13:12:55 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Crux SQL]]>
            </title>
            <description>
<![CDATA[
Score 169 | Comments 29 (<a href="https://news.ycombinator.com/item?id=24049349">thread link</a>) | @yogthos
<br/>
August 4, 2020 | https://juxt.pro/blog/crux-sql | <a href="https://web.archive.org/web/*/https://juxt.pro/blog/crux-sql">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><div id="preamble">
<div>
<p>We were pleased when <a href="https://opencrux.com/">Crux</a> was included in the
ThoughtWorks
<a href="https://www.thoughtworks.com/radar/platforms/crux">technology radar</a>
with a recommendation to <strong>assess</strong>:</p>
<div>
<blockquote>
<p>Crux is an open-source document database with bitemporal graph
queries…​ it’s currently in alpha and lacks SQL support, but you can
use a Datalog query interface for reading and traversing
relationships.</p>
</blockquote>
<p>
— ThoughtWorks Technology Radar
</p>
</div>
<p>We are fans of <a href="https://en.wikipedia.org/wiki/Datalog">Datalog</a> and the
power it gives. Although it’s not directly compatible and may drift
out further, we’ve based our Datalog query API on
<a href="https://docs.datomic.com/on-prem/query">Datomic’s</a>, where Datalog
is represented as a pattern-matching declarative data-structure.</p>
<p>Datalog is easy to construct and parse and it is natural to make use
of custom predicates and rules as part of the logical pattern
matching.</p>
<p>We love Datalog, but it’s also fair to say that a sizeable chunk of
potential users will want to use SQL. Be it for users who want to run
ad-hoc SQL queries without needing to know Datalog, or for integration
between systems where SQL is the lingua franca, it’s important that we
support it.</p>
</div>
</div>
<div>
<h2 id="_code_crux_sql_code"><a href="#_code_crux_sql_code"></a><code>crux-sql</code></h2>
<div>
<p>We have created a new <code>crux-sql</code> module in Crux which makes use of the
<a href="https://calcite.apache.org/">Apache Calcite</a> SQL query planning engine. Calcite
is a powerful library for exposing SQL queries against arbitrary data-sources
and has been integrated with a variety of DBMSs such as Cassandra, Mongo and
Elastic, as well as Big Data systems like Hive, Drill, Flink and Dremio.</p>
<p>Calcite has been around for a long while and is still very
active. We’re grateful for the work the Calcite team have put into
this tool and the power it gives, as well as the friendly community that
has built up around it.</p>
<p>We run Calcite in-process as part of a Crux node, so there’s no need
to set up any additional infrastructure. Rather you just need to add
the <code>crux-sql</code> module dependency:</p>
<div>
<div>
<pre><code data-lang="clojure">[juxt/crux-sql "RELEASE"]]</code></pre>
</div>
</div>
<p>We have integrated Calcite such that SQL queries are translated to
efficient Datalog queries, including sorts and inner joins.</p>
<p>You can avoid the relatively small overhead of preparing queries by
using PreparedStatements.</p>
<p>Please visit the
<a href="https://github.com/juxt/crux/blob/master/crux-sql/README.adoc">module
README</a> for how to get going with some simple steps, or please watch
this video:</p>
<div>
<p>
<iframe src="https://www.youtube.com/embed/HEBL_ue2wbw?rel=0" frameborder="0" allowfullscreen=""></iframe>
</p>
</div>
<p>The <code>crux-sql</code> module allows for both in-process SQL queries and for
remote JDBC queries using
<a href="https://calcite.apache.org/avatica/">Avatica</a>. This is covered in the
docs.</p>
</div>
</div>
<div>
<h2 id="_next_up"><a href="#_next_up"></a>Next Up</h2>
<div>
<p>See the <code>crux-sql</code>
<a href="https://github.com/juxt/crux/tree/master/crux-sql">README</a> for more
details.</p>
<p>Stay tuned for another blog and video on how to write Crux SQL
bitemporal queries.</p>
<p>As ever, if you have queries about Crux, please ping the team:</p>

<p><em>Image credit: Oliver Hine</em></p>
</div>
</div></div></div>]]>
            </description>
            <link>https://juxt.pro/blog/crux-sql</link>
            <guid isPermaLink="false">hacker-news-small-sites-24049349</guid>
            <pubDate>Tue, 04 Aug 2020 12:45:10 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[SIMD Everywhere: 0.5.0]]>
            </title>
            <description>
<![CDATA[
Score 155 | Comments 53 (<a href="https://news.ycombinator.com/item?id=24048562">thread link</a>) | @lelf
<br/>
August 4, 2020 | https://simd-everywhere.github.io/blog/announcements/release/2020/06/21/0.5.0-release.html | <a href="https://web.archive.org/web/*/https://simd-everywhere.github.io/blog/announcements/release/2020/06/21/0.5.0-release.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    <p>I’m pleased to announce the availability of the first release of <a href="https://github.com/simd-everywhere/simde">SIMD
Everywhere</a> (SIMDe),
<a href="https://github.com/simd-everywhere/simde/releases">version 0.5.0</a>,
representing more than three years of work by over a dozen developers.</p>

<p>SIMDe is a permissively-licensed (MIT) header-only library which
provides fast, portable implementations of
<a href="https://en.wikipedia.org/wiki/SIMD">SIMD</a> intrinsics for platforms
which aren’t natively supported by the API in question.</p>

<p>For example, with SIMDe you can use
<a href="https://en.wikipedia.org/wiki/Streaming_SIMD_Extensions">SSE</a> on
<a href="https://en.wikipedia.org/wiki/ARM_architecture">ARM</a>,
<a href="https://en.wikipedia.org/wiki/IBM_POWER_instruction_set_architecture">POWER</a>,
<a href="https://webassembly.org/">WebAssembly</a>, or almost any platform with a
C compiler.  That includes, of course, x86 CPUs which don’t support
the ISA extension in question (<em>e.g.</em>, calling AVX-512F functions on a
CPU which doesn’t natively support them).</p>

<p>If the target natively supports the SIMD extension in question there
is no performance penalty for using SIMDe.  Otherwise, accelerated
implementations, such as NEON on ARM, AltiVec on POWER, WASM SIMD on
WebAssembly, etc., are used when available to provide good
performance.</p>

<p>SIMDe has already been used to port several packages to additional
architectures through either upstream support or distribution
packages, <a href="https://wiki.debian.org/SIMDEverywhere">particularly on
Debian</a>.</p>

<p>If you’d like to play with SIMDe online, you can do so <a href="https://simde.netlify.app/godbolt/demo">on Compiler
Explorer</a>.</p>

<h2 id="what-is-in-050">What is in 0.5.0</h2>

<p>The 0.5.0 release is SIMDe’s first release.  It includes complete
implementations of:</p>

<ul>
  <li>MMX</li>
  <li>SSE</li>
  <li>SSE2</li>
  <li>SSE3</li>
  <li>SSSE3</li>
  <li>SSE4.1</li>
  <li>AVX</li>
  <li>FMA</li>
  <li>GFNI</li>
</ul>

<p>We also have rapidly progressing implementations of many other
extensions including NEON, AVX2, SVML, and several AVX-512 extensions
(AVX-512F, AVX-512BW, AVX-512VL, etc.).</p>

<p>Additionally, we have an extensive test suite to verify our
implementations.</p>

<h2 id="what-is-coming-next">What is coming next</h2>

<p>Work on SIMDe is proceeding rapidly, but there are a lot of functions
to implement… x86 alone has about 6,000 SIMD functions, and we’ve
implemented about 2,000 of them.  We will keep adding more functions
and improving the implementations we already have.</p>

<p>Our NEON implementation is being worked on very actively right now
by Sean Maher and Christopher Moore, and is expected to continue
progressing rapidly.</p>

<p>We currently have two Google Summer of Code students working on the
project as well; <a href="https://masterchef2209.wordpress.com/2020/06/17/guide-to-intel-sse4-2-crc-intrinisics-implementation-for-simde/">Hidayat
Khan</a>
is working on finishing up AVX2, and <a href="https://medium.com/@himanshi18037">Himanshi
Mathur</a> is focused on SVML.</p>

<p>If you’re interested in using SIMDe but need some specific functions
to be implemented first, please <a href="https://github.com/simd-everywhere/simde/issues/new">file an
issue</a> and we may
be able to prioritize those functions.</p>

<h2 id="getting-involved">Getting Involved</h2>

<p>If you’re interested in helping out please get in touch.  We have <a href="https://gitter.im/simd-everywhere/community">a
chat room on Gitter</a>
which is fairly active if you have questions, or of course you can
just dive right in on <a href="https://github.com/simd-everywhere/simde/issues">the issue
tracker</a>.</p>

  </div>
</article>

      </div>
    </div></div>]]>
            </description>
            <link>https://simd-everywhere.github.io/blog/announcements/release/2020/06/21/0.5.0-release.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-24048562</guid>
            <pubDate>Tue, 04 Aug 2020 10:36:29 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Show HN: Royalty-Free SVG Illustrations and Animations]]>
            </title>
            <description>
<![CDATA[
Score 205 | Comments 21 (<a href="https://news.ycombinator.com/item?id=24048508">thread link</a>) | @andyydao
<br/>
August 4, 2020 | https://www.pixeltrue.com/free-illustrations | <a href="https://web.archive.org/web/*/https://www.pixeltrue.com/free-illustrations">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page">
<!-- End Facebook Pixel Code -->


<!-- Global site tag (gtag.js) - Google Analytics -->










<div><div data-collapse="medium" data-animation="default" data-duration="400" role="banner"><div><p><a href="https://www.pixeltrue.com/illustrations"><img src="https://uploads-ssl.webflow.com/5dd3495558fd7f3d1fcb52bc/5e3aa42df0539d7ca0cc413e_Artboard.png" srcset="https://uploads-ssl.webflow.com/5dd3495558fd7f3d1fcb52bc/5e3aa42df0539d7ca0cc413e_Artboard-p-500.png 500w, https://uploads-ssl.webflow.com/5dd3495558fd7f3d1fcb52bc/5e3aa42df0539d7ca0cc413e_Artboard-p-800.png 800w, https://uploads-ssl.webflow.com/5dd3495558fd7f3d1fcb52bc/5e3aa42df0539d7ca0cc413e_Artboard.png 969w" sizes="(max-width: 991px) 120px, (max-width: 1439px) 130px, (max-width: 1919px) 150px, 200px" alt=""></a></p></div></div></div><div><div><div><p>To be the first to know about upcoming free illustrations consider signing up to our <a href="#newsletter">newsletter</a> <a target="_blank" href="http://bit.ly/popupcheck"><strong></strong></a>.</p><p>These <strong>Free SVG Illustrations</strong> AND <strong>Lottie Animations</strong> are available for free for personal and commercial use (MIT License). In other words: <strong>you can do whatever you want with them.</strong></p></div></div></div><div><div role="list"><div role="listitem"><p>robot error settings broken repair</p><a href="https://www.pixeltrue.com/free/error-monochrome" target="_blank"></a><p><a href="https://firebasestorage.googleapis.com/v0/b/illustrations-membership.appspot.com/o/Free%20Illustrations%2FError%20BW.zip?alt=media&amp;token=a45f1df1-2a6d-4197-8708-95a6881eb3ad" data-gatrack="free illustrations,download button,User clicked download button">DOWNLOAD</a></p></div><div role="listitem"><p>robot error settings broken repair</p><a href="https://www.pixeltrue.com/free/error-colour" target="_blank"></a><p><a href="https://firebasestorage.googleapis.com/v0/b/illustrations-membership.appspot.com/o/Free%20Illustrations%2FError%20-%20Colour.zip?alt=media&amp;token=ed6065b8-f5cd-4348-9f91-2da69a82f6e8" data-gatrack="free illustrations,download button,User clicked download button">DOWNLOAD</a></p></div><div role="listitem"><p>success health fitness celebration finish marathon</p><a href="https://www.pixeltrue.com/free/success-monochrome" target="_blank"></a><p><a href="https://firebasestorage.googleapis.com/v0/b/illustrations-membership.appspot.com/o/Free%20Illustrations%2FSuccess%20BW.zip?alt=media&amp;token=0a501d4a-66d4-4dda-8f7b-dbf32ee138f9" data-gatrack="free illustrations,download button,User clicked download button">DOWNLOAD</a></p></div><div role="listitem"><p>success health fitness celebration finish marathon</p><a href="https://www.pixeltrue.com/free/success-colour" target="_blank"></a><p><a href="https://firebasestorage.googleapis.com/v0/b/illustrations-membership.appspot.com/o/Free%20Illustrations%2FSuccess%20Colour.zip?alt=media&amp;token=95783604-14b8-40eb-b4a5-6fc36adefb95" data-gatrack="free illustrations,download button,User clicked download button">DOWNLOAD</a></p></div></div></div><div id="newsletter"><div><p>Get new free illustrations every week emailed to you<br></p><p>Plus nothing but quality pixels in your inbox every week!<br></p><div><div><p>Success! Stay tuned for some exciting content 🔥</p></div><div><p>Oops! Something went wrong while submitting the form.</p></div></div></div></div><!--[if lte IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif]-->
 



















<!-- Start Infinite Scroll -->



<!-- End Infinite Scroll -->





</div>]]>
            </description>
            <link>https://www.pixeltrue.com/free-illustrations</link>
            <guid isPermaLink="false">hacker-news-small-sites-24048508</guid>
            <pubDate>Tue, 04 Aug 2020 10:25:46 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Shipshape RenderMan Art Challenge]]>
            </title>
            <description>
<![CDATA[
Score 54 | Comments 6 (<a href="https://news.ycombinator.com/item?id=24047731">thread link</a>) | @mariuz
<br/>
August 4, 2020 | https://blog.yiningkarlli.com/2020/07/shipshape-renderman-challenge.html | <a href="https://web.archive.org/web/*/https://blog.yiningkarlli.com/2020/07/shipshape-renderman-challenge.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div role="main">
    <article>

            
            <span>July 31, 2020 
                 | Tags: 
                     
                        Art
                      
                </span>

            <section>
                <div>

  <p>Last year, I <a href="https://blog.yiningkarlli.com/2019/11/woodville-renderman-challenge.html">participated in one of Pixar’s RenderMan Art Challenges</a> as a way to learn more about RenderMan <a href="https://dl.acm.org/citation.cfm?id=3182162">(Christensen et al. 2018)</a> and as a way to get some exposure to tools outside of my normal day-to-day toolset (Disney’s Hyperion Renderer professionally, Takua Render as a hobby and learning exercise).
I had a lot of fun, and wound up doing better in the “Woodville” art challenge contest than I expected to!
Recently, I entered another one of <a href="https://renderman.pixar.com/news/renderman-shipshape-art-challenge">Pixar’s RenderMan Art Challenges, “Shipshape”</a>.
This time around I entered just for fun; since I had so much fun last time, I figured why not give it another shot!
That being said though, I want to repeat the main point I made in my post about the previous “Woodville” art challenge: I believe that for rendering engineers, there is enormous value in learning to use tools and renderers that aren’t the ones we work on ourselves.
Our field is filled with brilliant people on every major rendering team, and I find both a lot of useful information/ideas and a lot of joy in seeing the work that friends and peers across the field have put into commercial renderers such as RenderMan, Arnold, Vray, Corona, and others.</p>

  <p>As usual for the RenderMan Art Challenges, Pixar <a href="https://renderman.pixar.com/shipshape-pup-asset">supplied some base models</a> without any uvs, texturing, shading, lighting or anything else, and challenge participants had to start with the base models and come up with a single compelling image for a final entry.
I had a lot of fun spending evenings and weekends throughout the duration of the contest to create my final image, which is below.
I got to explore and learn a lot of new things that I haven’t tried before, which this post will go through.
To my enormous surprise, this time around my entry <a href="https://renderman.pixar.com/news/renderman-shipshape-art-challenge-final-results">won first place in the contest</a>!</p>

  <p><a href="https://blog.yiningkarlli.com/content/images/2020/Jul/shipshape/shipshape_full_4k.jpg"><img src="https://blog.yiningkarlli.com/content/images/2020/Jul/shipshape/preview/shipshape_full.jpg" alt="Figure 1: My entry to Pixar's RenderMan Shipshape Art Challenge, titled &quot;Oh Good, The Bus is Here&quot;. Click for 4K version. Base ship, robot, and sextant models are from Pixar; all shading, lighting, additional modeling, and environments are mine. Ship concept by Ian McQue. Robot concept by Ruslan Safarov. Models by Cheyenne Chapel, Aliya Chen, Damian Kwiatkowski, Alyssa Minko, Anthony Muscarella, and Miguel Zozaya © Disney / Pixar - RenderMan &quot;Shipshape&quot; Art Challenge."></a></p>

  <p><strong>Initial Explorations</strong></p>

  <p>For this competition, Pixar provided five models: a futuristic scifi ship based on an Ian McQue concept, a robot based on a Ruslan Safarov concept, an old wooden boat, a butterfly, and a sextant.
The fact that one of the models was based on an Ian McQue concept was enough to draw me in; I’ve been a big fan of Ian McQue’s work for many years now!
I like to start these challenges by just rendering the provided assets as-is from a number of different angles, to try to get a sense of what I like about the assets and how I will want to showcase them in my final piece.
I settled pretty quickly on wanting to focus on the scifi ship and the robot, and leave the other three models aside.
I did find an opportunity to bring in the sextant in my final piece as well, but wound up dropping the old wooden boat and the butterfly altogether.
Here are some simple renders showing what was provided out of the box for the scifi ship and the robot:</p>

  <p><a href="https://blog.yiningkarlli.com/content/images/2020/Jul/shipshape/scifiship_base.jpg"><img src="https://blog.yiningkarlli.com/content/images/2020/Jul/shipshape/scifiship_base.jpg" alt="Figure 2: Scifi ship base model provided by Pixar, rendered against a white cyclorama background using a basic skydome."></a></p>

  <p><a href="https://blog.yiningkarlli.com/content/images/2020/Jul/shipshape/robot_base.jpg"><img src="https://blog.yiningkarlli.com/content/images/2020/Jul/shipshape/robot_base.jpg" alt="Figure 3: Robot base model provided by Pixar, rendered against a white cyclorama background using a basic skydome."></a></p>

  <p>I initially had a lot of trouble settling on a concept and idea for this project; I actually started blocking out an entirely different idea before pivoting to the idea that eventually became my final image.
My initial concept included the old wooden boat in addition the scifi ship and the robot; this initial concept was called “River Explorer”.
My initial instinct was to try to show the scifi ship from a top-down view, in order to get a better view of the deck-boards and the big VG engine and the crane arm.
I liked the idea of putting the camera at roughly forest canopy height, since forest canopy height is a bit of an unusual perspective for most photographs due to canopy height being this weird height that is too high off the ground for people to shoot from, but too low for helicopters or drones to be practical either.
My initial idea was about a robot-piloted flying patrol boat exploring an old forgotten river in a forest; the ship would be approaching the old sunken boat in the river water.
With this first concept, I got as far as initial compositional blocking and initial time-of-day lighting tests:</p>

  <p><a href="https://blog.yiningkarlli.com/content/images/2020/Jul/shipshape/progress_012.jpg"><img src="https://blog.yiningkarlli.com/content/images/2020/Jul/shipshape/preview/progress_012.jpg" alt="Figure 4: Initial &quot;River Explorer&quot; concept, daylight lighting test."></a></p>

  <p><a href="https://blog.yiningkarlli.com/content/images/2020/Jul/shipshape/progress_013.jpg"><img src="https://blog.yiningkarlli.com/content/images/2020/Jul/shipshape/preview/progress_013.jpg" alt="Figure 5: Initial &quot;River Explorer&quot; concept, dusk lighting test."></a></p>

  <p>If you’ve followed my blog for a while now, those pine trees might look familiar.
They’re actually the same trees from <a href="https://blog.yiningkarlli.com/2018/10/bidirectional-mipmap.html">the forest scene I used a while back</a>, ported from Takua’s shading system to RenderMan’s PxrSurface shader.</p>

  <p>I wasn’t ever super happy with the “River Explorer” concept; I think the overall layout was okay, but it lacked a sense of dynamism and overall just felt very static to me, and the robot on the flying scifi ship felt kind of lost in the overall composition.
Several other contestants wound up also going for similar top-down-ish views, which made me worry about getting lost in a crowd of similar-looking images.
After a week of trying to get the “River Explorer” concept to work better, I started to play with some completely different ideas; I figured that this early in the process, a better idea was worth more than a week’s worth of sunk time.</p>

  <p><strong>Layout and Framing</strong></p>

  <p>I had started UV unwrapping the ship already, and whilst tumbling around the ship unwrapping all of the components one-by-one, I got to see a lot more of the ship and a lot more interesting angles, and I suddenly came up with a completely different idea for my entry.
The idea that popped into my head was to have a bunch of the little robots waiting to board one of the flying ships at a quay or something of the sort.
I wanted to convey a sense of scale between the robots and the flying scifi ship, so I tried putting the camera far away and zooming in using a really long lens.
Since long lenses have the effect of flattening perspective a bit, using a long lens helped make the ships feel huge compared to the robots.
At this point I was just doing very rough, quick, AO render “sketches”.
This is the AO sketch where my eventual final idea started:</p>

  <p><a href="https://blog.yiningkarlli.com/content/images/2020/Jul/shipshape/progress_015.jpg"><img src="https://blog.yiningkarlli.com/content/images/2020/Jul/shipshape/progress_015.jpg" alt="Figure 6: Rough AO render &quot;sketch&quot; that eventually evolved into my final idea."></a></p>

  <p>I’ve always loved the idea of the mundane fantastical; the flying scifi ship model is fairly fantastical, which led me to want to do something more everyday with them.
I thought it would be fun to texture the scifi ship model as if it was just part of a regular metro system that the robots use to get around their world.
My wife, Harmony, suggested a fun idea: set the entire scene in drizzly weather and give two of the robots umbrellas, but give the third robot a briefcase instead and have the robot use the briefcase as a makeshift umbrella, as if it had forgotten its umbrella at home.
The umbrella-less robot’s reaction to seeing the ship arriving provided the title for my entry- “Oh Good, The Bus Is Here”.
Harmony also pointed out that the back of the ship has a lot more interesting geometric detail compared to the front of the ship, and suggested placing the focus of the composition more on the robots than on the ships.
To incorporate all of these ideas, I played more with the layout and framing until I arrived at the following image, which is broadly the final layout I used:</p>

  <p><a href="https://blog.yiningkarlli.com/content/images/2020/Jul/shipshape/progress_019.jpg"><img src="https://blog.yiningkarlli.com/content/images/2020/Jul/shipshape/progress_019.jpg" alt="Figure 7: Rough AO render &quot;sketch&quot; of my final layout."></a></p>

  <p>I chose to put an additional ship in the background flying away from the dock for two main reasons.
First, I wanted to be able to showcase more of the ship, since the front ship is mostly obscured by the foreground dock.
Second, the background ship helps fill out and balance the right side of the frame more, which would otherwise have been kind of empty.</p>

  <p>In both this project and in the previous Art Challenge, my workflow for assembling the final scene relies heavily on Maya’s referencing capabilities.
Each separate asset is kept in its own .ma file, and all of the .ma files are referenced into the main scene file.
The only the things the main scene file contains are references to assets, along with scene-level lighting, overrides, and global-scale effects such as volumes and, in the case of this challenge, the rain streaks.
So, even though the flying scifi ship appears in my scene twice, it is actually just the same .ma file referenced into the main scene twice instead of two separate ships.</p>

  <p>The idea of a rainy scene largely drove the later lighting direction of my entry; from this point I basically knew that the final scene was going to have to be overcast and drizzly, with a heavy reliance on volumes to add depth separation into the scene and to bring out practical lights on the ships.
I had a lot of fun modeling out the dock and gangway, and may have gotten slightly carried away.
I modeled every single bolt and rivet that you would expect to be there in real life, and I also added lampposts to use later as practical light sources for illuminating the dock and the robots.
Once I had finished modeling the dock and had made a few more layout tweaks, I arrived at a point where I was happy to start with shading and initial light blocking.
Zoom in if you want to see all of the rivets and bolts and stuff on the dock:</p>

  <p><a href="https://blog.yiningkarlli.com/content/images/2020/Jul/shipshape/progress_032.jpg"><img src="https://blog.yiningkarlli.com/content/images/2020/Jul/shipshape/progress_032.jpg" alt="Figure 8: AO render of my layout going into shading and lighting. Check out all of the crazy detail on the dock that I modeled!"></a></p>

  <p><strong>UV Unwrapping</strong></p>

  <p>UV unwrapping the ship took a ton of time.
For the last challenge, I relied on a combination of manual UV unwrapping by hand in Maya and using <a href="https://www.sidefx.com/tutorials/houdini-game-dev-tools-auto-uvs/">Houdini’s Auto UV SOP</a>, but I found that the Auto UV SOP didn’t work as well on this challenge due to the ship and robot having a lot of strange geometry with really complex topology.
On the treehouse in the last challenge, everything was more or less some version of a cylinder or a rectangular prism, with some morphs and warps and extra bits and bobs applied.
Almost every piece of the ship aside from the floorboards are very complex shapes that aren’t easy to find good seams for, so the Auto UV SOP wound up making a lot of choices for UV cuts that I didn’t like.
As a result, I basically manually UV unwrapped this entire challenge in Maya.</p>

  <p>A lot of the complex undercarriage type stuff around the back thrusters on the ship was really insane to unwrap.
The muffler manifold and mechanical parts of the crane arm were difficult too.
Fortunately though, the models came with subdivision creases, and a lot of the subd crease tags wound up proving to be useful hints towards good places to place UV edge cuts.
I also found …</p></div></section></article></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://blog.yiningkarlli.com/2020/07/shipshape-renderman-challenge.html">https://blog.yiningkarlli.com/2020/07/shipshape-renderman-challenge.html</a></em></p>]]>
            </description>
            <link>https://blog.yiningkarlli.com/2020/07/shipshape-renderman-challenge.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-24047731</guid>
            <pubDate>Tue, 04 Aug 2020 08:02:40 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[The best Parts of Visual Studio Code are proprietary]]>
            </title>
            <description>
<![CDATA[
Score 418 | Comments 263 (<a href="https://news.ycombinator.com/item?id=24047638">thread link</a>) | @ingve
<br/>
August 4, 2020 | https://underjord.io/the-best-parts-of-visual-studio-code-are-proprietary.html | <a href="https://web.archive.org/web/*/https://underjord.io/the-best-parts-of-visual-studio-code-are-proprietary.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
<small>2020-08-03</small><!-- RSS:2020-08-03T07:25:00Z -->
<p>I've been very surprised and delighted over a number of years now by Microsoft's strong efforts in open
    source. I understand the skeptics, I was on Slashdot when they tried to sue Linux out of existence and I think only
    time will tell. I figure MS contributing is better than them hunting Linux distributions for sport. So I was mostly
    onboard for Microsofts efforts and I've especially found Visual Studio Code useful.</p>
<p>To settle a few things. When I tweeted on this subject I only got the response that I should use vim. Thanks. Great.
    I can and do on use vim. That misses a number of points. Visual Studio Code is an immensely popular editor and
    likely the most common recommendations to new developers. The primary reason I've used Visual Studio Code is
    that it has an incredibly compelling solution for remote pairing in the form of LiveShare. I've used that for a
    while with great success mentoring, coaching and generally working with other developers of varying experience and
    editor preferences. Most programmers can handle a "normal" editor like VS Code while something like Emacs
    or Vim depends a lot more on what they've learned.</p>
<p>I also ended up enjoying the Remote series of extensions for developing effectively inside remote servers or local
    containers.</p>
<h2>These things are proprietary</h2>
<p>At some point I read a piece of license that said that LiveShare could only be used with the Visual Studio family of
    products. "Huh, that sounds weird, VS Code is open source right?"</p>
<p>Sure enough. VS Code is fully MIT. The binary distribution has a separate license to allow telemetry and protect
    Microsoft trademarks and stuff. Nothing particularly weird, I can't really get worked up about telemetry, I know
    some can. But the extensions.. These extensions are in my book core differentiators that makes VS Code compelling.
    For me it is definitely part of what pushes it beyond the much leaner Sublime (paid, closed source) I was using
    before.</p>
<p>These extensions have a license limiting them and their online service parts to only be used with the Visual Studio
    family of products. This is the <a href="https://microsoftdocs.github.io/live-share/license/eula.html" title="License for LiveShare">license for LiveShare</a> and this is the <a href="https://code.visualstudio.com/preview-license" title="License for Remote">license for Remote</a>.</p>
<p>For me LiveShare is the most important thing. Google Docs style collaborative code editing, terminal sharing, port
    sharing and a bunch more features. I know Atom had an extension like this, I haven't checked the licensing there
    or tried it recently.</p>
<p>Remote is a very strong extension as well for anyone working on a server over SSH or in a container. It helps by
    installing extensions on the destination to allow language servers and such. I've seen it do terrible things to
    servers sometimes but it is very useful and generally works well.</p>
<p>It makes me uneasy to accept VS Code as an "open" project in any wider meaning of the word when compelling
    features are legally locked to only work inside the family of Visual Studio products. It makes me less certain that
    this isn't the Extend in Embrace, Extend, Extinguish. It also frustrates me that this prevents someone from
    building a compatible plugin for VIM or any other editor. This would be much more powerful if it could be in all the
    IntelliJs as well.</p>
<p>You'll find a repo for <a href="https://github.com/MicrosoftDocs/live-share" title="LiveShare on GitHub">LiveShare on GitHub</a> but it is only for documentation and issue tracking. There
    is no code. Same for <a href="https://github.com/microsoft/vscode-remote-release" title="Remote on GitHub">Remote</a>.</p>
<h2>The entire marketplace is proprietary</h2>
<p>Some additional salt in this particular wound is that the use of the Marketplace of VS Code extensions is also
    proprietarily licensed. So all these open source developers are shoving their extensions into a competitive
    advantage for one of the world's largest tech firms. And they disallow other uses of the marketplace. Even if
    the letter of open source is followed there is none of the openness, collaborative or community essence that I think
    exemplifies open source and free software projects.</p>
<p>What does this mean in practice? I guess it protects from the competition. Such as the <a href="https://github.com/VSCodium/vscodium" title="VS Codium">VS Codium</a> project which provides VS Code
    binaries without the proprietary parts. But also, as a consequence of this, without the Marketplace of extensions.
    There is an open source alternative called <a href="https://open-vsx.org/" title="Open VSX">Open VSX</a>, but since
    it isn't the canonical one it is missing a bunch of extensions and the big Liveshare and Remote ones are still
    not allowed.</p>
<p>This also blocks the <a href="https://github.com/cdr/code-server" title="code-server">code-server editor</a> that
    allows running VS Code in the browser from using it which otherwise would have been perfect for me to do development
    on an iPad Pro. I can still use that but a lot of packages are not in Open VSX.</p>
<h2>What about lock-in?</h2>
<p>Visual Studio Code is marketed with LiveShare and Remote as powerful extensions. VS Code is also marketed as open
    source. It is easy to use the editor, install the extensions and be under the impression that you are using an open
    source software suite where Microsoft simply hosts the peering service for identifying and connecting you and your
    collaborator.</p>
<p>But the peering service is not the only closed part. The extensions are not open source projects as far as I can find
    and they are licensed during distribution in a way that disallows using them with anything but Visual Studio
    products.</p>
<p>This leaves me with a sour taste in my mouth. I wasn't sold on having an Electron-based editor to begin with but
    VS Code was substantially leaner than Atom so I've been mostly accepting it.</p>
<p>If you have good suggestions for strong collaborative development tools that are open source, please let me know at
    <a href="mailto:lars@underjord.io">lars@underjord.io</a> or on Twitter <a href="https://twitter.com/lawik">@lawik</a>. If you want to follow my writing the RSS feed is
    right below. If you want more of my writing I have a tracking-free newsletter that I'd love for you to sign up for,
    also below.</p></div></div>]]>
            </description>
            <link>https://underjord.io/the-best-parts-of-visual-studio-code-are-proprietary.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-24047638</guid>
            <pubDate>Tue, 04 Aug 2020 07:42:40 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Learn Functional Programming Design from Redux]]>
            </title>
            <description>
<![CDATA[
Score 55 | Comments 44 (<a href="https://news.ycombinator.com/item?id=24046631">thread link</a>) | @daiyanze
<br/>
August 3, 2020 | https://pitayan.com/posts/redux-fp-design/?ref=hackernews | <a href="https://web.archive.org/web/*/https://pitayan.com/posts/redux-fp-design/?ref=hackernews">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><p>Before I set my eyes on the Redux source code, I naively thought OOP is superior than FP(Functional Programming) as a programming paradigm. But this is not right. As we know that FP is dedicated to forming a easy to understand and clear workflow without those obscure abstracted objects and relations. It's much closer to human's procedural mode of thinking.</p><p>Now <code>React</code> has already got hooks which can handle the "states" properly event without <a href="https://redux.js.org/" target="_blank" rel="nofollow noopener noreferrer">Redux</a>. The demand for <a href="https://redux.js.org/" target="_blank" rel="nofollow noopener noreferrer">Redux</a> could be declining but its code base is still worth learning. Especially for those who wants to enlighten themselves in functional programming. So, I guess it's never a bad idea to learn from a good example even though it is "obsolete" (not at all).</p><p>When I started reading the <a href="https://redux.js.org/" target="_blank" rel="nofollow noopener noreferrer">Redux</a> source code, I immediately felt the power of this unfamiliar usage of my familiar programming language. It feels like exploring an acient cave with a torch lighting up the paintings and found the great secret.</p><p>In order to know more about what Redux benefits from FP, I researched the <a href="https://redux.js.org/" target="_blank" rel="nofollow noopener noreferrer">Redux</a> source code and created a mini version of it.</p><blockquote><p>Never be afraid of reinventing the wheel.</p></blockquote><p><strong>Contents:</strong></p><ul><li><a href="#recap-how-redux-works">Recap How Redux Works</a></li><li><a href="#redux-approach-comparison-fp-vs-oop">Redux Approach Comparison: FP vs OOP</a></li><li><a href="#wonderful-redux-fp-design">Wonderful Redux FP Design</a><ul><li><a href="#createstore">createStore</a></li><li><a href="#combinereducers">combineReducers</a></li><li><a href="#applymiddleware">applyMiddleware</a></li></ul></li><li><a href="#redux-middlewares">Redux Middlewares</a><ul><li><a href="#redux-thunk">Redux Thunk</a></li><li><a href="#redux-logger">Redux Logger</a></li></ul></li><li><a href="#a-demo-app">A demo app</a></li><li><a href="#conclusion">Conclusion</a></li><li><a href="#references">References</a></li></ul><h2 id="recap-how-redux-works"><a href="#recap-how-redux-works">Recap How Redux Works</a></h2><p>There are 4 basic key points for <a href="https://redux.js.org/" target="_blank" rel="nofollow noopener noreferrer">Redux</a>:</p><ol><li>Create a store for data and let the view subscribe to it</li><li>The view dispatches an action to submit the changs</li><li>The reducer changes the state based on the action type</li><li>Finally return the new state and triggers the view to change</li></ol><p>This is the classic diagram explaining how <a href="https://redux.js.org/" target="_blank" rel="nofollow noopener noreferrer">Redux</a> works:</p><p><img src="https://d33wubrfki0l68.cloudfront.net/b1117a23634125a8e2195b0dfc8fc1a29c511fac/3f628/assets/static/redux.b474ba6.ff6f3365031ebcab6ddfefc3aadeb376.jpg" width="1088" alt="redux diagram" data-old-src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1088 573' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-7e552fcbb64e466973e8c4226e516330'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-7e552fcbb64e466973e8c4226e516330)' width='1088' height='573' xlink:href='data:image/jpeg%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAiCAYAAADvVd%2bPAAAACXBIWXMAAAsSAAALEgHS3X78AAAEqklEQVRo3tWZ2U7sMAyG%2b/5vgcQ1V4C4AIkbQCAh9n3f931fc/RFco8n0zZOGEBEstppUrv%2bYzu2p3h5eXFvb2/u4%2bPDRO/v7453Xl9fy2sVhWus/KEY7yo5ufwLlL%2b5uXGnp6fu/PzcnZ2dVRJzrLm6uvKAWT5QwH18fIzy13IsAOv55%2bfnKF9NT09P5fsFyi8sLLjd3V23vb3dSKxZWlryHwmSMQuQ%2bdXVVbexseF2dnai/FnL/efnpwkALBLeFv7Mb25uehliyQU7g2DrQHkYMSwuwO4j0Dp4j/UAwM5aLGxxcdGlDDZRrLhAIdBhgEqT7zOOj489YDzjA2Wn6%2bjh4cGtrKyYfJNxd3fnAbDwl3kUAhBAa%2bLPPHosLy//BwCfEABkUTh4Js9PTk7c0dFRy/o6koF5VvENZTDu7%2b%2b9mVr4C2jwRyHNp44/77RYQAgAg127vLx019fX/l7PHR4eusnJSX/FFbCGOmJ%2bcHDQjY%2bPlx8BH3gTe25vb/2O4yYykDcxMeEODg6i/Pf29tzIyIgbGhpqUxbLFhkaFBMACMdMMEXu9Y6i%2bMzMjI%2bm3GMNIfEcV%2bEDu7q63OjoaPlhmCB8Cbx8CP5LHNIAADDPmvhDrOnp6XG9vb1tloqMtbU1737iviYAYiYUukDMp7/iAk0xqckF6tzYDECTMAmCEqVjQRCFJAhq362SIQDkBEEUCuOD5i0EqG0ApByDev13HIMolXoMolD2MUhmNz8/73cWfxfCzDF3/Yw1vMzVkgjJlXeIB/it5hcSMjHn9fV1MwDsKBZGwAz5I5OrPOfKM%2bJOmQiBBCAgHMVYROTs7%2b933d3dPkpLUGPNxcVFciqMWQv/GAG6KG5NhUltq/hwmqAw93oOqyxTYUFR/EWCydzcnBsbG/P3uljKKYZSiq1OFUNYENYEmGFMaCmGdN4ugQUlQQp/5z4MRqHwWC0QC5RVlGIBdTxwDayvak1pAVVMQWx/f9%2bbj/i6dUd%2bm8IiDACaXLaoehkAJJD8JQDCHQ4BqNKhqKqtUVpSTXGBFL/8LeXlqvMDgnhVg6bWArgyOBkgCYJ/xQLk%2byVtl991G1iERxaIkRcQQTEhzuSULtBPBsG6I3Fra8t/O7kBgRAdqDEaLUAmWMgJAAjS/dGRNMckwzQ1VuLmuJt2YUl6KNokh9FtMJMLSOLTZD7WRAhQJbO0JEI5FhDmBIBJNYjiZheQKww4BiGd8uZYgERjCi6CahMhD3O19gRjOUGYB0QtQOcB4TGYG5A60RPMjT3JeUAIADtSlQmmkABg7QlKOfxVudoCsgBAeXzS0ptrIoRLdVfXs9NNDD5Yym1AyJXLIAZ8yQJmZ2fLElJigpWkFOVImpqaauvKSL%2bOXdZz/B4YGHDDw8NlSZsiX9ZyRa6u/MwAiO/qOjqHiPzs5vT0dIuSXDmjqTjhr%2beQ39fX55up0qPIkQ0IFHNhXIgCkPt/W12bCz6pLiB/vDT1BFP/x6yjIrXETM3mdBBs6tl9RxAMdTFbQCfz8u/sCXaCip%2bozviPgaCke/pVhM/TEpc2%2bp8GIOwJStPTEjh/svz%2bEQuQYsgSNHOLoVz6Bye%2b7fLOqLjeAAAAAElFTkSuQmCC' /%3e%3c/svg%3e" data-src="https://d33wubrfki0l68.cloudfront.net/b1117a23634125a8e2195b0dfc8fc1a29c511fac/3f628/assets/static/redux.b474ba6.ff6f3365031ebcab6ddfefc3aadeb376.jpg" data-srcset="https://d33wubrfki0l68.cloudfront.net/d23ede7d66304da8179f8bd5b5cb30d1a54c39df/29340/assets/static/redux.82a2fbd.ff6f3365031ebcab6ddfefc3aadeb376.jpg 480w, https://d33wubrfki0l68.cloudfront.net/b1117a23634125a8e2195b0dfc8fc1a29c511fac/3f628/assets/static/redux.b474ba6.ff6f3365031ebcab6ddfefc3aadeb376.jpg 1088w"></p><p>From the diagram above, it's easy to find the keywords: <code>action</code><code>store</code><code>reducer</code><code>view</code><code>subscribe</code> and <code>dispatch</code>. And the next is to handle the relations among these keywords.</p><h2 id="redux-approach-comparison-fp-vs-oop"><a href="#redux-approach-comparison-fp-vs-oop">Redux Approach Comparison: FP vs OOP</a></h2><p>Example usage of <a href="https://redux.js.org/" target="_blank" rel="nofollow noopener noreferrer">Redux</a></p><pre><code><span>const</span> store <span>=</span> <span>createStore</span><span>(</span>
  <span>combineReducers</span><span>(</span><span>{</span>
    one<span>:</span> oneReducer<span>,</span>
    two<span>:</span> twoReducer
  <span>}</span><span>)</span><span>,</span>
  <span>applyMiddleware</span><span>(</span><span>ReduxThunk</span><span>,</span> <span>ReduxLogger</span><span>)</span>
<span>)</span><span>;</span></code></pre><p>Imagine if we do this in OOP, it may look like this:</p><p>(The following is just my imagination. Not how older <a href="https://redux.js.org/" target="_blank" rel="nofollow noopener noreferrer">Redux</a> behaves)</p><pre><code><span>const</span> store <span>=</span> <span>new</span> <span>Store</span><span>(</span><span>)</span>
store<span>.</span><span>setReducers</span><span>(</span><span>{</span>
  one<span>:</span> oneReducer<span>,</span>
  two<span>:</span> twoReducer
<span>}</span><span>)</span>
store<span>.</span><span>setMiddlewares</span><span>(</span><span>{</span>
  <span>ReduxThunk</span><span>,</span>
  <span>ReduxLogger</span>
<span>}</span><span>)</span></code></pre><p>So, what are the differences? Both are good approaches IMO.</p><p>FP does a good job on combining the functions together without side-effects. The return value is consistent which made the program returnings foreseeable during or after the execution.</p><p>OOP made a solid structure which defined all the attributes a data model should contain. It makes it easy to modify or configure the data model.</p><p>In <a href="https://redux.js.org/" target="_blank" rel="nofollow noopener noreferrer">Redux</a>, the <code>reduers</code> and <code>middlewares</code> are usually defined only once. It means, we don't need the ability to update these properties and we don't hope them to be altered during the runtime. As for FP approach, it utilizes the <code>closure</code> technique that kills the possbility of exposing the internal properties. With some fantastic FP techniques (curry, compose, pipe), it's even making the program much more human-readable than OOP.</p><p>I would say FP should be the best fit for such scenario. Of course, the FP I'm talking about here is far from the real functional programming like Haskell. But at least the idea of utilizing FP techniques in Javascript is something to follow.</p><p><img src="https://d33wubrfki0l68.cloudfront.net/66984ccd5661fa81bc4c1806c64e980181165a7d/88b43/assets/static/haskell.cbab2cf.82d9f5b0912290333a547a32e17d3642.jpg" width="1024" alt="haskell functional programming" data-old-src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1024 576' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-52e08e1070b234d120b65ac6e29a8487'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-52e08e1070b234d120b65ac6e29a8487)' width='1024' height='576' xlink:href='data:image/jpeg%3bbase64%2c/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wAARCAAkAEADASIAAhEBAxEB/8QAGwAAAgMBAQEAAAAAAAAAAAAAAAQCAwUGAQj/xAAwEAABBAEDAQYCCwAAAAAAAAABAAIDEQQSITFRBRMiQWFxJKEGFBUyQlKCkrHB8P/EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/EABkRAQEBAAMAAAAAAAAAAAAAAAABERIhQf/aAAwDAQACEQMRAD8A%2bqSQASdgEvj5uLki8fIilHVjgf8AcFMEWCFz0oyIJ5ceETuhvTqPeucQR%2ba6vc8enRBuwzxTAGJ7XAixSsWFJmZ0DmiKLVDVNLoJHPqq8Vedp77R0yujdj5biDVtgdp46%2baUPoN0aFlUwTiV8je7kZoNW9tA%2b3VXEAgggEHyQcl2J9O%2bzO04JXd3kxSQl3eMEZk00au2WCPboVt9mdt4Pac7ocN0zntbrOqF7BV1y4BOY%2bLj44Ax4IogBpGhgbQ5rZXLVs8Hj70Oq7ralh4WaYXPgnleckGu7kna43WwsNA6LdSpzCL%2bHm29Bv8ANZGXDLKdDpZpmt2IrJa675/D0NrQfJDHGwPy5ACDTjyfkifID2lrsfII33Ya49QVWC173fD5Zo1es1x5eLhXlaupsxe9Z4M7KIIq2uA/rlMwwGN5cZpX7VTyK9%2bEnqD374uYC3TvrIu/1b15qyGNkkztUWSw/etzzp59/RXesQ8hQjibGXab8Rs2bU1kCX%2bpYodqGPFq330jzQhDQMLFHGPF%2b0dK/jZWxRRwgiJjWAmyGirKEIJoQhAIQhB//9k=' /%3e%3c/svg%3e" data-src="https://d33wubrfki0l68.cloudfront.net/66984ccd5661fa81bc4c1806c64e980181165a7d/88b43/assets/static/haskell.cbab2cf.82d9f5b0912290333a547a32e17d3642.jpg" data-srcset="https://d33wubrfki0l68.cloudfront.net/2c16467debebdf254444700dab6213bb45ece8a2/b30b3/assets/static/haskell.82a2fbd.82d9f5b0912290333a547a32e17d3642.jpg 480w, https://d33wubrfki0l68.cloudfront.net/66984ccd5661fa81bc4c1806c64e980181165a7d/88b43/assets/static/haskell.cbab2cf.82d9f5b0912290333a547a32e17d3642.jpg 1024w"></p><h2 id="wonderful-redux-fp-design"><a href="#wonderful-redux-fp-design">Wonderful Redux FP Design</a></h2><p>In Redux, there is no class at all (In the earlier versions, it was once based on <code>Class</code>). All of its core APIs return either value or function (function factory). And this is exactly what FP expects a function to behave:</p><blockquote><p>Pure with no side effects.</p></blockquote><ul><li><strong>createStore</strong>: returns new <code>Object</code> { getState, dispatch, subscribe }</li><li><strong>combineReducers</strong>: returns new <code>Function</code></li><li><strong>applyMiddleware</strong>: returns new <code>Function</code></li></ul><p>To explain the <a href="https://redux.js.org/" target="_blank" rel="nofollow noopener noreferrer">Redux</a> design in an easy way, I implemented only the very core part of the APIs above. Since the latest version's core concept hasn't changed much, I wrote the source code based on very primitive version of <a href="https://github.com/reduxjs/redux/tree/v1.0.1/src" target="_blank" rel="nofollow noopener noreferrer">Redux v1.0.1</a>. Because I believe the very first related version would be the most comprehensive one to look at.</p><p>Let's have a look.</p><h4 id="createstore"><a href="#createstore">createStore</a></h4><p><code>createStore</code> defines those APIs that can be used within components. It's more like <code>setter</code> and <code>getter</code></p><ul><li>getState</li><li>dispatch</li><li>subscribe</li></ul><pre><code><span>export</span> <span>default</span> <span>function</span> <span>createStore</span> <span>(</span><span>reducer<span>,</span> enhancer</span><span>)</span> <span>{</span>
  <span>if</span> <span>(</span>enhancer<span>)</span> <span>{</span>
    <span>return</span> <span>enhancer</span><span>(</span>createStore<span>)</span><span>(</span>reducer<span>)</span><span>;</span>
  <span>}</span>

  <span>let</span> currentState<span>;</span>
  
  
  <span>let</span> currentListeners <span>=</span> <span>[</span><span>]</span><span>;</span>

  <span>function</span> <span>getState</span> <span>(</span><span>)</span> <span>{</span>
    <span>return</span> currentState<span>;</span>
  <span>}</span>

  
  <span>function</span> <span>subscribe</span> <span>(</span><span>listener</span><span>)</span> <span>{</span>
    currentListeners<span>.</span><span>push</span><span>(</span>listener<span>)</span><span>;</span>

    <span>return</span> <span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
      
      <span>const</span> index <span>=</span> currentListeners<span>.</span><span>indexOf</span><span>(</span>listener<span>)</span><span>;</span>
      currentListeners<span>.</span><span>splice</span><span>(</span>index<span>,</span> <span>1</span><span>)</span><span>;</span>
    <span>}</span><span>;</span>
  <span>}</span>

  <span>function</span> <span>dispatch</span> <span>(</span><span>action</span><span>)</span> <span>{</span>
    currentState <span>=</span> <span>reducer</span><span>(</span>currentState<span>,</span> action<span>)</span><span>;</span>
    
    currentListeners<span>.</span><span>forEach</span><span>(</span><span>listener</span> <span>=&gt;</span> <span>listener</span><span>(</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>

  
  <span>dispatch</span><span>(</span><span>{</span> type<span>:</span> <span>"MY-MINI-REDUX"</span> <span>}</span><span>)</span><span>;</span>

  <span>return</span> <span>{</span>
    getState<span>,</span>
    dispatch<span>,</span>
    subscribe
  <span>}</span><span>;</span>
<span>}</span></code></pre><h4 id="combinereducers"><a href="#combinereducers">combineReducers</a></h4><p>Returns a new function that can return the new state. Can't be any purer.</p><pre><code>
<span>function</span> <span>mapValues</span><span>(</span><span>obj<span>,</span> fn</span><span>)</span> <span>{</span>
  <span>return</span> <span>Object</span><span>.</span><span>keys</span><span>(</span>obj<span>)</span><span>.</span><span>reduce</span><span>(</span><span>(</span><span>result<span>,</span> key</span><span>)</span> <span>=&gt;</span> <span>{</span>
    result<span>[</span>key<span>]</span> <span>=</span> <span>fn</span><span>(</span>obj<span>[</span>key<span>]</span><span>,</span> key<span>)</span><span>;</span>
    <span>return</span> result<span>;</span>
  <span>}</span><span>,</span> <span>{</span><span>}</span><span>)</span><span>;</span>
<span>}</span>

<span>export</span> <span>default</span> <span>function</span> <span>combineReducers</span> <span>(</span><span>reducers</span><span>)</span> <span>{</span>
  <span>return</span> <span>function</span> <span>combination</span> <span>(</span><span>state <span>=</span> <span>{</span><span>}</span><span>,</span> action</span><span>)</span> <span>{</span>
    
    
    <span>return</span> <span>mapValues</span><span>(</span>reducers<span>,</span> <span>(</span><span>reducer<span>,</span> key</span><span>)</span> <span>=&gt;</span> <span>reducer</span><span>(</span>state<span>[</span>key<span>]</span><span>,</span> action<span>)</span><span>)</span>
  <span>}</span><span>;</span>
<span>}</span></code></pre><h4 id="applymiddleware"><a href="#applymiddleware">applyMiddleware</a></h4><p>I personally think the <code>applyMiddleware</code> API is the most amazing part of Redux. It provides an optimal solution to apply 3rd party plugins.</p><p>The FP <code>compose</code> in the source code is corresponding to Math's <a href="https://en.wikipedia.org/wiki/Associative_property" target="_blank" rel="nofollow noopener noreferrer">associative law</a> in my understanding.</p><blockquote><p>( <em>x</em> ∗ ( <em>y</em> ∗ <em>z</em> ) ) = <em>x</em> ∗ <em>y</em> ∗ <em>z</em></p></blockquote><p>The usage of <code>applyMiddleware</code> is actually a form of a <code>pipe</code> that allows us to inject enhancement functions that returns the store Object. It's pretty similar to <code>Aspect Oriented Programming</code> which the most typical example is the annotation / decorator.</p><pre><code>

<span>function</span> <span>compose</span><span>(</span><span><span>...</span>funcs</span><span>)</span> <span>{</span>
  <span>return</span> funcs<span>.</span><span>reduceRight</span><span>(</span><span>(</span><span>composed<span>,</span> f</span><span>)</span> <span>=&gt;</span> <span>f</span><span>(</span>composed<span>)</span><span>)</span><span>;</span>
<span>}</span>

<span>export</span> <span>default</span> <span>function</span> <span>applyMiddleware</span><span>(</span><span><span>...</span>middlewares</span><span>)</span> <span>{</span>
  <span>return</span> <span>next</span> <span>=&gt;</span> <span>(</span><span>reducer<span>,</span> initialState</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> store <span>=</span> <span>next</span><span>(</span>reducer<span>,</span> initialState<span>)</span><span>;</span>
    <span>let</span> dispatch <span>=</span> store<span>.</span><span>dispatch</span><span>;</span>
    <span>const</span> middlewareAPI <span>=</span> <span>{</span>
      getState<span>:</span> store<span>.</span><span>getState</span><span>,</span>
      <span>dispatch</span><span>:</span> <span>action</span> <span>=&gt;</span> <span>dispatch</span><span>(</span>action<span>)</span>
    <span>}</span><span>;</span>
    <span>const</span> chain <span>=</span> middlewares<span>.</span><span>map</span><span>(</span><span>middleware</span> <span>=&gt;</span> <span>middleware</span><span>(</span>middlewareAPI<span>)</span><span>)</span><span>;</span>

    
    dispatch <span>=</span> <span>compose</span><span>(</span><span>...</span>chain<span>,</span> store<span>.</span><span>dispatch</span><span>)</span><span>;</span>

    <span>return</span> <span>{</span>
      <span>...</span>store<span>,</span>
      dispatch
    <span>}</span><span>;</span>
  <span>}</span><span>;</span>
<span>}</span></code></pre><h2 id="redux-middlewares"><a href="#redux-middlewares">Redux Middlewares</a></h2><p>There are some famous middlewares for <a href="https://redux.js.org/" target="_blank" rel="nofollow noopener noreferrer">Redux</a> like <a href="https://github.com/reduxjs/redux-thunk" target="_blank" rel="nofollow noopener noreferrer">redux-thunk</a> and [redux-logger(<a href="https://github.com/LogRocket/redux-logger" target="_blank" rel="nofollow noopener noreferrer">https://github.com/LogRocket/redux-logger</a>). These are the good examples using <code>applyMiddleware</code> API to enhance the functionalities. Furthermore, their code base is astonishingly small. The core part has only a few lines of code.</p><p>All of the middlewares are <code>curry</code> functions.</p><blockquote><p>funcA =&gt; funcB =&gt; funcC</p><p>funcB = funcA()</p><p>funcC = funcB()</p></blockquote><p> This is extremly helpful when I need other contexts to use within the code block. As of the examples, it's easy to find that <code>next</code> and <code>action</code> are passed in as context to help handle some complex cases.</p><h4 id="redux-thunk"><a href="#redux-thunk">Redux Thunk</a></h4><p><code>redux-thunk</code> allows to use function as <code>dispatch</code> parameter so that I could do something right before "dispatching".</p><pre><code>
<span>dispatch</span><span>(</span><span>{</span> type<span>:</span> <span>'action'</span><span>,</span> payload<span>:</span> <span>'value'</span> <span>}</span><span>)</span>



<span>dispatch</span><span>(</span><span>function</span> <span>(</span><span>dispatch<span>,</span> getState</span><span>)</span> <span>{</span>
  <span>console</span><span>.</span><span>log</span><span>(</span><span>'redux-thunk'</span><span>)</span>
  <span>dispatch</span><span>(</span><span>{</span> type<span>:</span> <span>'action'</span><span>,</span> payload<span>:</span> <span>'value'</span> <span>}</span><span>)</span>
<span>}</span><span>)</span></code></pre><p>Here is the core:</p><pre><code>
<span>export</span> <span>default</span> <span>function</span> <span>thunk</span><span>(</span><span><span>{</span> dispatch<span>,</span> getState <span>}</span></span><span>)</span> <span>{</span>
  <span>return</span> <span>next</span> <span>=&gt;</span> <span>action</span> <span>=&gt;</span> <span>{</span>
    <span>if</span> <span>(</span><span>typeof</span> action <span>===</span> <span>"function"</span><span>)</span> <span>{</span>
      <span>return</span> <span>action</span><span>(</span>dispatch<span>,</span> getState<span>)</span><span>;</span>
    <span>}</span>

    <span>return</span> <span>next</span><span>(</span>action<span>)</span><span>;</span>
  <span>}</span><span>;</span>
<span>}</span></code></pre><h4 id="redux-logger"><a href="#redux-logger">Redux Logger</a></h4><p>It's easy to guess what this middleware does. It simply outputs the state changes.</p><pre><code>
<span>export</span> <span>default</span> <span>function</span> <span>logger</span><span>(</span><span><span>{</span> getState <span>}</span></span><span>)</span> <span>{</span>
  <span>return</span> <span>next</span> <span>=&gt;</span> <span>action</span> <span>=&gt;</span> <span>{</span>
    <span>console</span><span>.</span><span>log</span><span>(</span><span>"======== Redux Logger ========"</span><span>)</span><span>;</span>
    <span>console</span><span>.</span><span>log</span><span>(</span><span>"Action Type: "</span><span>,</span> action<span>.</span><span>type</span><span>)</span><span>;</span>
    <span>const</span> prevState <span>=</span> <span>getState</span><span>(</span><span>)</span><span>;</span>
    <span>console</span><span>.</span><span>log</span><span>(</span><span>"Prev: "</span><span>,</span> prevState<span>)</span><span>;</span>

    <span>const</span> returnValue <span>=</span> <span>next</span><span>(</span>action<span>)</span><span>;</span>

    <span>const</span> nextState <span>=</span> <span>getState</span><span>(</span><span>)</span><span>;</span>
    <span>console</span><span>.</span><span>log</span><span>(</span><span>"Next: "</span><span>,</span> nextState<span>)</span><span>;</span>
    <span>console</span><span>.</span><span>log</span><span>(</span><span>"=============================="</span><span>)</span><span>;</span>
    <span>return</span> returnValue<span>;</span>
  <span>}</span><span>;</span>
<span>}</span></code></pre><h2 id="a-demo-app"><a href="#a-demo-app">A demo app</a></h2><p>I implemented mini version of redux and a small counter application to demostrate the functions. The application will do four arithmetic operations: <strong>plus</strong>, <strong>minus</strong>, <strong>multiply</strong> and <strong>divide</strong>. The number will change after clicking the operation button. Meanwhile, <code>multiply</code> and <code>divide</code> will have 300ms' delay which is enabled by a custom middleware (a mini redux-thunk).</p><p><strong>Repository link of "mini-redux":</strong></p><p><a href="https://github.com/daiyanze/mini-redux" target="_blank" rel="nofollow noopener noreferrer">https://github.com/daiyanze/mini-redux</a></p><p><strong>Demo App link:</strong></p><p><a href="https://daiyanze.com/mini-redux/build/index.html" target="_blank" rel="nofollow noopener noreferrer">https://daiyanze.com/mini-redux/build/index.html</a></p><p><img src="https://d33wubrfki0l68.cloudfront.net/9dc95481270c7b145b30a963ce578c185d75a44c/06bfe/assets/static/app.28b8b81.42e70fdda76e9bc70c1818fe62939d86.png" width="1078" alt="app" data-old-src="data:image/svg+xml,%3csvg fill='none' viewBox='0 0 1078 586' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3e%3cdefs%3e%3cfilter id='__svg-blur-b8a33714e79343718b882b0853556166'%3e%3cfeGaussianBlur in='SourceGraphic' stdDeviation='40'/%3e%3c/filter%3e%3c/defs%3e%3cimage x='0' y='0' filter='url(%23__svg-blur-b8a33714e79343718b882b0853556166)' width='1078' height='586' xlink:href='data:image/png%3bbase64%2ciVBORw0KGgoAAAANSUhEUgAAAEAAAAAjCAYAAAAkCQwqAAAACXBIWXMAABYlAAAWJQFJUiTwAAACzElEQVRo3u1YSWsyQRD1v/oHAgoKinqQHDyIHrwIKl7MRYRcvAsJiBcPbkRcEpO4JcZdca2PV9BhvmGci84YRxuKnunu6aGqX79aTKRR2%2b/3v/12u%2bVeKrvd7lfkc9JvtW4mLTc/RgE9lNfUAEKBn58fSqfT1Ov1aD6fs%2bC5Wq1SoVDgfjKZ0HQ65bnX11caj8eXjwBAG61cLpPVaqV4PE6BQIAeHh7o%2bfmZYrEYeTwecjqdFIlEyO/385pcLkcvLy//7XHRCFiv18wBo9GIOp0OIwKy2Wz4xDEOBLTbbR6H0pi7cYBROEDO/FKWFzCXzxnGCygZRShVLBZ1vetnNYAcDWilUok9gBQFekJfdwQcUlBvyJ8dAUqKqxno4g0gJTa4w%2bVyyYEOXB3eF4sFB0GGNoDocdf7/T69vb1xfAAjwPcjMlRChaEQgIYTh9JCeem78ASGJ8G/EPxoYgAlV6cU2KjJRSFAfreVIjr5s9KctC5wKCpUiiZPZSyT1rDWau9T/ftoBMCt1Wo1ZnK4M4S3w%2bGQMzwwPtZ1u12O/N7f32m1WnFWCMFpfnx88PPn5yfV63X2Cs1mk/eGu/z6%2buJ9sB/WYy%2bQ59kRIFgbSrlcLrLb7eTz%2bcjhcJDFYqFgMEg2m40ymQw9PT2R1%2bul%2b/t7ikajvNZsNtPj4yOlUimWRCLBa7LZLH%2bfTCYpHA5zLcHtdtPd3R2FQiGuGcDoZzeA1LUhr8dJiaoPEp3v72%2bu%2bOBkkfNDcKJAh/D9oh4A5KAegG%2bwZjAY8BrMYQw95vP5PLVarZO6zD/LAXr9%2byRe4BBTH2JzafqrxvhqVeQ/gYBjokJAWZDdOZGkezYoTh88cRX1ALWrcihyNCwC1MbPdQ10zwYRCCGoERkgXOBV1QNAfpVK5TcNbjQaHCtcTT1AVICEAWazGY/d6gFk0KKoYesBRmk3A1y7Af4BkCyMSb7bRvcAAAAASUVORK5CYII=' /%3e%3c/svg%3e" data-src="https://d33wubrfki0l68.cloudfront.net/9dc95481270c7b145b30a963ce578c185d75a44c/06bfe/assets/static/app.28b8b81.42e70fdda76e9bc70c1818fe62939d86.png" data-srcset="https://d33wubrfki0l68.cloudfront.net/6cd10d41d4c5361482bb8734550719faaa7f13e9/0e513/assets/static/app.82a2fbd.42e70fdda76e9bc70c1818fe62939d86.png 480w, https://d33wubrfki0l68.cloudfront.net/9dc95481270c7b145b30a963ce578c185d75a44c/06bfe/assets/static/app.28b8b81.42e70fdda76e9bc70c1818fe62939d86.png 1078w"></p><p>The app has one child component: <code>MiniReduxComp</code>. In my mini-redux, I didn't create a context provider to trigger updates. Instead, I subscribe to the store changes within the component and  do <code>forceUpdate</code> to react to changes.</p><p>I also applied the custom middlewares <code>redux-thunk</code> and <code>redux-logger</code> to enrich the functions.</p><pre><code><span>import</span> <span>React</span><span>,</span> <span>{</span> <span>Component</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>
<span>import</span> store <span>from</span> <span>'../store'</span>

<span>export</span> <span>default</span> <span>class</span> <span>MiniReduxComp</span> <span>extends</span> <span>Component</span> <span>{</span>

  <span>componentDidMount</span><span>(</span><span>)</span> <span>{</span>
    <span>this</span><span>.</span><span>unsubscribe</span> <span>=</span> store<span>.</span><span>subscribe</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>this</span><span>.</span><span>forceUpdate</span><span>(</span><span>)</span><span>)</span><span>;</span>
  <span>}</span>

  <span>componentWillUnmount</span><span>(</span><span>)</span> <span>{</span>
    <span>this</span><span>.</span><span>unsubscribe</span> <span>&amp;&amp;</span> <span>this</span><span>.</span><span>unsubscribe</span><span>(</span><span>)</span><span>;</span>
  <span>}</span>

  <span>plus</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> store<span>.</span><span>dispatch</span><span>(</span><span>{</span> type<span>:</span> <span>"PLUS"</span> <span>}</span><span>)</span>

  <span>minus</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> store<span>.</span><span>dispatch</span><span>(</span><span>{</span> type<span>:</span> <span>'MINUS'</span> <span>}</span><span>)</span>

  <span>multiply</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> store<span>.</span><span>dispatch</span><span>(</span><span>(</span><span>dispatch<span>,</span> getState</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>setTimeout</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>dispatch</span><span>(</span><span>{</span> type<span>:</span> <span>'MULTIPLY'</span> <span>}</span><span>)</span>
    <span>}</span><span>,</span> <span>300</span><span>)</span>
  <span>}</span><span>)</span>

  <span>divide</span> <span>=</span> <span>(</span><span>)</span> <span>=&gt;</span> store<span>.</span><span>dispatch</span><span>(</span><span>(</span><span>dispatch<span>,</span> getState</span><span>)</span> <span>=&gt;</span> <span>{</span>
    <span>setTimeout</span><span>(</span><span>(</span><span>)</span> <span>=&gt;</span> <span>{</span>
      <span>dispatch</span><span>(</span><span>{</span> type<span>:</span> <span>'DIVIDE'</span> <span>}</span><span>)</span>
    <span>}</span><span>,</span> <span>300</span><span>)</span>
  <span>}</span><span>)</span>

  <span>render</span><span>(</span><span>)</span> <span>{</span>
    <span>return</span> <span>(</span>
      <span><span><span>&lt;</span>div</span><span>&gt;</span></span><span>
        </span><span><span><span>&lt;</span>h4</span><span>&gt;</span></span><span>Plus / Minus 1</span><span><span><span>&lt;/</span>h4</span><span>&gt;</span></span><span>

        </span><span><span><span>&lt;</span>p</span><span>&gt;</span></span><span>{</span>store<span>.</span><span>getState</span><span>(</span><span>)</span><span>.</span><span>count</span><span>}</span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span><span>

        </span><span><span><span>&lt;</span>button</span> <span>onClick</span><span><span>=</span><span>{</span><span>this</span><span>.</span><span>plus</span><span>}</span></span><span>&gt;</span></span><span>+1</span><span><span><span>&lt;/</span>button</span><span>&gt;</span></span><span>
        </span><span><span><span>&lt;</span>button</span> <span>onClick</span><span><span>=</span><span>{</span><span>this</span><span>.</span><span>minus</span><span>}</span></span><span>&gt;</span></span><span>-1</span><span><span><span>&lt;/</span>button</span><span>&gt;</span></span><span>

        </span><span><span><span>&lt;</span>br</span> <span>/&gt;</span></span><span>
        </span><span><span><span>&lt;</span>br</span> <span>/&gt;</span></span><span>

        </span><span><span><span>&lt;</span>h4</span><span>&gt;</span></span><span>Multiply / Divide 2 (0.3s delay)</span><span><span><span>&lt;/</span>h4</span><span>&gt;</span></span><span>
        </span><span><span><span>&lt;</span>p</span><span>&gt;</span></span><span>{</span>store<span>.</span><span>getState</span><span>(</span><span>)</span><span>.</span><span>double</span><span>}</span><span><span><span>&lt;/</span>p</span><span>&gt;</span></span><span>

        </span><span><span><span>&lt;</span>button</span> <span>onClick</span><span><span>=</span><span>{</span><span>this</span><span>.</span><span>mult…</span></span></span></code></pre></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://pitayan.com/posts/redux-fp-design/?ref=hackernews">https://pitayan.com/posts/redux-fp-design/?ref=hackernews</a></em></p>]]>
            </description>
            <link>https://pitayan.com/posts/redux-fp-design/?ref=hackernews</link>
            <guid isPermaLink="false">hacker-news-small-sites-24046631</guid>
            <pubDate>Tue, 04 Aug 2020 04:33:23 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Harry Potter and the Mnemonic Major System]]>
            </title>
            <description>
<![CDATA[
Score 54 | Comments 17 (<a href="https://news.ycombinator.com/item?id=24045475">thread link</a>) | @krisfris
<br/>
August 3, 2020 | https://darkshadow.io/2020/07/09/harry-potter-and-the-mnemonic-major-system.html | <a href="https://web.archive.org/web/*/https://darkshadow.io/2020/07/09/harry-potter-and-the-mnemonic-major-system.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  <div itemprop="articleBody">
    <p>As most reasonable people are familiar with the Harry Potter books,
their content serves as ideal material for building a mnemonic system.
The mnemonic major system, in particular, is used to memorize number sequences.</p>

<p>In order to implement the steps outlined in this post you need the content of the Harry Potter books (or other book(s) if you prefer).
In a previous post I showed you how to
<a href="https://darkshadow.io/2020/06/29/building-a-fantasy-book-db.html">download fantasy books and extract their text</a>.
Among the downloaded data were the Harry Potter books which I will use in this post.</p>

<h3 id="step-1-learn-the-sound-number-mapping">Step 1: Learn the sound-number mapping</h3>

<p>In the mnemonic major system each number from 0 to 9 is associated with one or more
consonant sounds. Use the following table as a reference.</p>

<table>
  <thead>
    <tr>
      <th>Number</th>
      <th>Sounds (IPA)</th>
      <th>Letters with example words</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>s, z</td>
      <td>s (see), c (city), z (zero), x (xylophone)</td>
    </tr>
    <tr>
      <td>1</td>
      <td>t, d, ð, θ</td>
      <td>t (tee), d (dad), th (though), th (think)</td>
    </tr>
    <tr>
      <td>2</td>
      <td>n, ŋ</td>
      <td>n (nail)</td>
    </tr>
    <tr>
      <td>3</td>
      <td>m</td>
      <td>m (monster)</td>
    </tr>
    <tr>
      <td>4</td>
      <td>r</td>
      <td>r (right), l (colonel)</td>
    </tr>
    <tr>
      <td>5</td>
      <td>l</td>
      <td>l (left)</td>
    </tr>
    <tr>
      <td>6</td>
      <td>ʤ, ʧ, ʃ, ʒ</td>
      <td>ch (cheese), j (juice), g (ginger), sh (shell), c (cello, special),<br> cz (czech), s (tissue, vision), sc (fascist), sch (eschew),<br>t (ration), tsch (putsch), z (seizure)</td>
    </tr>
    <tr>
      <td>7</td>
      <td>k, ɡ</td>
      <td>k (kid), c (cake), q (quarter), g (good), ch (loch)</td>
    </tr>
    <tr>
      <td>8</td>
      <td>f, v</td>
      <td>f (face), ph (phone), v (alive), gh (laugh)</td>
    </tr>
    <tr>
      <td>9</td>
      <td>p, b</td>
      <td>p (power), b (baby)</td>
    </tr>
  </tbody>
</table>

<p>In English, letters are pronounced in different ways depending on the context,
that’s why some letters are repeated in different rows. But in the end,
only the sound matters, not the spelling.</p>

<p>Here are a few examples for words, their IPA representation and the number they encode.</p>

<table>
  <thead>
    <tr>
      <th>Word</th>
      <th>IPA</th>
      <th>Number</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>action</td>
      <td>ækʃən</td>
      <td>762</td>
    </tr>
    <tr>
      <td>muddy</td>
      <td>mədi</td>
      <td>31</td>
    </tr>
    <tr>
      <td>midday</td>
      <td>mɪddeɪ</td>
      <td>311</td>
    </tr>
    <tr>
      <td>accept</td>
      <td>æksɛpt</td>
      <td>7091</td>
    </tr>
    <tr>
      <td>fax</td>
      <td>fæks</td>
      <td>870</td>
    </tr>
    <tr>
      <td>exam</td>
      <td>ɪgzæm</td>
      <td>703</td>
    </tr>
    <tr>
      <td>anxious</td>
      <td>æŋkʃəs</td>
      <td>2760</td>
    </tr>
    <tr>
      <td>luxury</td>
      <td>ləgʒəri</td>
      <td>5764</td>
    </tr>
    <tr>
      <td>pizza</td>
      <td>pitsə</td>
      <td>910</td>
    </tr>
    <tr>
      <td>ghost</td>
      <td>goʊst</td>
      <td>701</td>
    </tr>
    <tr>
      <td>enough</td>
      <td>inəf</td>
      <td>28</td>
    </tr>
    <tr>
      <td>fear</td>
      <td>fɪr</td>
      <td>84</td>
    </tr>
  </tbody>
</table>

<p>To familiarize yourself with the IPA notation, try to read the following excerpt.</p>

<figure><pre><code data-lang="html">Sorting Hat: həm, dɪfəkəlt. vɛri dɪfəkəlt. plɛnti əv kərɪʤ, aɪ si.
             nɑt ə bæd maɪnd, iðər. ðɛrz tælənt, oʊ jɛs. ənd ə θərst tɪ pruv jʊrsɛlf.
             bət wɛr tɪ pʊt ju?
Harry:       nɑt slɪðərɪn. nɑt slɪðərɪn.
Sorting Hat: nɑt slɪðərɪn, ɛ? ər ju ʃʊr? ju kʊd bi greɪt, ju noʊ. ɪts ɔl hir ɪn jʊr hɛd.
             ənd slɪðərɪn wɪl hɛlp ju ɔn ðə weɪ tɪ greɪtnəs, ðɛrz noʊ daʊt əbaʊt ðət. noʊ?
Harry:       pliz, pliz. ɛniθɪŋ bət slɪðərɪn, ɛniθɪŋ bət slɪðərɪn.
Sorting Hat: wɛl ɪf jʊr ʃʊr, bɛtər bi... grɪfɪndɔː!</code></pre></figure>

<p>Consider the same lines converted to number sequences.</p>

<figure><pre><code data-lang="html">Sorting Hat: 3 18751 84 18751 9521 8 746 0 21 91 321 14 140 1521 0 21 8401 1 948 4058 91 4 1 91
Harry:       21 05142 21 05142
Sorting Hat: 21 05142 4 64 71 9 741 2 10 5 4 2 4 1 21 05142 5 59 2 1 1 74120 140 2 11 91 11 2
Harry:       950 950 282 91 05142 282 91 05142
Sorting Hat: 5 8 4 64 914 9 74821</code></pre></figure>

<p>I’m going to show you how to write a training program to internalize
the concept of mapping sounds to numbers in Step 4. But first, you need the ability
to convert text automatically to numbers. This happens in 2 steps. First, the text is converted
to IPA. Then, the IPA is converted to numbers.</p>

<h3 id="step-2-converting-ipa-to-numbers">Step 2: Converting IPA to numbers</h3>

<p>The process of converting IPA to numbers is very simple. I iterate through the IPA chars
and if there is a number associated with the char I append the number to the result.</p>

<figure><pre><code data-lang="python"><span># Mapping from number to sounds
</span><span>num_to_phones</span> <span>=</span> <span>{</span><span>0</span><span>:</span> <span>[</span><span>'s'</span><span>,</span> <span>'z'</span><span>],</span> <span>1</span><span>:</span> <span>[</span><span>'t'</span><span>,</span> <span>'d'</span><span>,</span> <span>'ð'</span><span>,</span> <span>'θ'</span><span>],</span> <span>2</span><span>:</span> <span>[</span><span>'n'</span><span>,</span> <span>'ŋ'</span><span>],</span> <span>3</span><span>:</span> <span>[</span><span>'m'</span><span>],</span> <span>4</span><span>:</span> <span>[</span><span>'r'</span><span>],</span>
                 <span>5</span><span>:</span> <span>[</span><span>'l'</span><span>],</span> <span>6</span><span>:</span> <span>[</span><span>'ʤ'</span><span>,</span> <span>'ʧ'</span><span>,</span> <span>'ʃ'</span><span>,</span> <span>'ʒ'</span><span>],</span> <span>7</span><span>:</span> <span>[</span><span>'k'</span><span>,</span> <span>'g'</span><span>],</span> <span>8</span><span>:</span> <span>[</span><span>'f'</span><span>,</span> <span>'v'</span><span>],</span>
                 <span>9</span><span>:</span> <span>[</span><span>'p'</span><span>,</span> <span>'b'</span><span>]}</span>

<span># Reverse mapping from sound to number
</span><span>phone_to_num</span> <span>=</span> <span>{</span><span>x</span><span>:</span> <span>k</span> <span>for</span> <span>k</span><span>,</span> <span>v</span> <span>in</span> <span>num_to_phones</span><span>.</span><span>items</span><span>()</span> <span>for</span> <span>x</span> <span>in</span> <span>v</span><span>}</span>

<span>def</span> <span>major_decode_from_ipa</span><span>(</span><span>ipa</span><span>):</span>
    <span>"""Convert IPA to number sequence."""</span>
    <span>result</span> <span>=</span> <span>[]</span>
    <span>for</span> <span>char</span> <span>in</span> <span>ipa</span><span>:</span>
        <span>if</span> <span>(</span><span>num</span> <span>:</span><span>=</span> <span>phone_to_num</span><span>.</span><span>get</span><span>(</span><span>char</span><span>))</span> <span>is</span> <span>not</span> <span>None</span><span>:</span>
            <span>result</span><span>.</span><span>append</span><span>(</span><span>num</span><span>)</span>
    <span>return</span> <span>result</span></code></pre></figure>

<p>For example, <code>major_decode_from_ipa('dɪfəkəlt')</code> yields <code>[1, 8, 7, 5, 1]</code>.</p>

<p>Additionally, I define a couple functions for converting number sequences to and from strings.</p>

<figure><pre><code data-lang="python"><span>def</span> <span>numseq_to_str</span><span>(</span><span>numseq</span><span>):</span>
    <span>"""Convert number sequence to string."""</span>
    <span>return</span> <span>''</span><span>.</span><span>join</span><span>(</span><span>str</span><span>(</span><span>x</span><span>)</span> <span>for</span> <span>x</span> <span>in</span> <span>numseq</span><span>)</span>

<span>def</span> <span>str_to_numseq</span><span>(</span><span>s</span><span>):</span>
    <span>"""Convert string to number sequence."""</span>
    <span>return</span> <span>[</span><span>int</span><span>(</span><span>x</span><span>)</span> <span>for</span> <span>x</span> <span>in</span> <span>s</span> <span>if</span> <span>x</span><span>.</span><span>isdigit</span><span>()]</span></code></pre></figure>

<p>For example, <code>numseq_to_str([1, 8, 7, 5, 1])</code> yields <code>'18751'</code>.</p>

<h3 id="step-3-converting-text-to-ipa">Step 3: Converting text to IPA</h3>

<p>In order to automatically convert text to IPA (and then to numbers) you need to use an IPA
dictionary.</p>

<p>Python’s <a href="https://pypi.org/project/eng-to-ipa/">eng-to-ipa</a> package is able to convert text to
IPA using the <em>Carnegie-Mellon University Pronouncing Dictionary</em>.</p>

<figure><pre><code data-lang="python"><span>import</span> <span>eng_to_ipa</span>

<span>s</span> <span>=</span> <span>'“I’ll bring up some sandwiches.”'</span>  <span># Sentence from the HP books
</span><span>ipa</span> <span>=</span> <span>eng_to_ipa</span><span>.</span><span>convert</span><span>(</span><span>s</span><span>,</span> <span>retrieve_all</span><span>=</span><span>True</span><span>,</span> <span>keep_punct</span><span>=</span><span>False</span><span>,</span> <span>stress_marks</span><span>=</span><span>False</span><span>)</span>
<span>print</span><span>(</span><span>ipa</span><span>)</span></code></pre></figure>

<p>This yields:</p>

<figure><pre><code data-lang="html">['“i’ll* brɪŋ əp səm sandwiches.”*']</code></pre></figure>

<p>According to the docs, eng-to-ipa will reprint words that cannot be found in the CMU dictionary
with an asterisk. Thus, <code>“i’ll</code> and <code>sandwiches.”</code> have not been found. Clearly, the punctuation is the issue.
I preprocess the text in order to ease the conversion to IPA.</p>

<figure><pre><code data-lang="python"><span># Punctuation including unicode chars
</span><span>punctuation</span> <span>=</span> <span>''</span><span>.</span><span>join</span><span>(</span><span>chr</span><span>(</span><span>i</span><span>)</span> <span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>sys</span><span>.</span><span>maxunicode</span><span>)</span>
                      <span>if</span> <span>unicodedata</span><span>.</span><span>category</span><span>(</span><span>chr</span><span>(</span><span>i</span><span>)).</span><span>startswith</span><span>(</span><span>'P'</span><span>))</span>

<span>def</span> <span>preprocess</span><span>(</span><span>text</span><span>):</span>
    <span>"""Strip punctuation between words, normalize space, lowercase, replace unicode apostrophe."""</span>
    <span>return</span> <span>' '</span><span>.</span><span>join</span><span>(</span><span>x</span><span>.</span><span>strip</span><span>(</span><span>punctuation</span><span>).</span><span>lower</span><span>().</span><span>replace</span><span>(</span><span>'’'</span><span>,</span> <span>'</span><span>\'</span><span>'</span><span>)</span>
                    <span>for</span> <span>x</span> <span>in</span> <span>text</span><span>.</span><span>split</span><span>())</span>
                    
<span>print</span><span>(</span><span>eng_to_ipa</span><span>.</span><span>convert</span><span>(</span><span>preprocess</span><span>(</span><span>s</span><span>),</span> <span>retrieve_all</span><span>=</span><span>True</span><span>,</span> <span>keep_punct</span><span>=</span><span>False</span><span>,</span> <span>stress_marks</span><span>=</span><span>False</span><span>))</span></code></pre></figure>

<p>And…</p>

<figure><pre><code data-lang="html">['aɪl brɪŋ əp səm sæmwɪʧɪz', 'aɪl brɪŋ əp səm sændwɪʧɪz', 'aɪl brɪŋ əp səm sænwɪʧɪz']</code></pre></figure>

<p>As you can see, there are 3 ways to pronounce this sentence depending on whether you like
to pronounce <code>sandwich</code> with <code>m</code>, <code>n</code> or <code>nd</code>. In order to use the major system effectively,
you should use the version that sounds most natural to you.</p>

<p>Let’s look at another example.</p>

<figure><pre><code data-lang="python"><span>print</span><span>(</span><span>eng_to_ipa</span><span>(</span><span>preprocess</span><span>(</span><span>'Well, if you’re sure — better be GRYFFINDOR!'</span><span>),</span> <span>retrieve_all</span><span>=</span><span>True</span><span>,</span>
                 <span>keep_punct</span><span>=</span><span>False</span><span>,</span> <span>stress_marks</span><span>=</span><span>False</span><span>))</span></code></pre></figure>

<figure><pre><code data-lang="html">['wɛl ɪf jur ʃʊr bɛtər bi gryffindor*', 'wɛl ɪf jʊr ʃʊr bɛtər bi gryffindor*']</code></pre></figure>

<p>The word <code>gryffindor</code> was not found in the CMU dictionary, which can be expected.
After a quick search for the word’s pronunciation I found <a href="https://youglish.com/pronounce/gryffindor/english">YouGlish</a>
which uses YouTube videos to find IPAs. While their API is not free, a limited number of IPA’s can be scraped
for our purpose.</p>

<figure><pre><code data-lang="python"><span>import</span> <span>time</span><span>,</span> <span>random</span><span>,</span> <span>requests</span><span>,</span> <span>lxml</span><span>.</span><span>html</span><span>.</span><span>soupparser</span>

<span>def</span> <span>ipa_from_youglish</span><span>(</span><span>word</span><span>):</span>
    <span>"""Scrape IPA for word from youglish.com."""</span>
    <span>url</span> <span>=</span> <span>f'https://youglish.com/pronounce/</span><span>{</span><span>word</span><span>}</span><span>/english?'</span>
    <span>while</span> <span>True</span><span>:</span>
        <span>print</span><span>(</span><span>f'Scraping word "</span><span>{</span><span>word</span><span>}</span><span>" from youglish...'</span><span>,</span> <span>end</span><span>=</span><span>''</span><span>,</span> <span>flush</span><span>=</span><span>True</span><span>)</span>
        <span>response</span> <span>=</span> <span>requests</span><span>.</span><span>get</span><span>(</span><span>url</span><span>)</span>
        <span>if</span> <span>'Usage limit exceeded'</span> <span>in</span> <span>response</span><span>.</span><span>text</span><span>:</span>
            <span>raise</span> <span>Exception</span><span>(</span><span>'YouGlish usage limit exceeded'</span><span>)</span>
        <span>root</span> <span>=</span> <span>lxml</span><span>.</span><span>html</span><span>.</span><span>soupparser</span><span>.</span><span>fromstring</span><span>(</span><span>response</span><span>.</span><span>text</span><span>)</span>
        <span>if</span> <span>root</span><span>.</span><span>xpath</span><span>(</span><span>'//div[@class="g-recaptcha"]'</span><span>):</span>
            <span>print</span><span>(</span><span>'RECAPTCHA'</span><span>)</span>
            <span>input</span><span>(</span><span>f'Open </span><span>{</span><span>url</span><span>}</span><span>, submit CAPTCHA challenge, press enter to continue.'</span><span>)</span>
        <span>else</span><span>:</span>
            <span>break</span>
    <span>time</span><span>.</span><span>sleep</span><span>(</span><span>random</span><span>.</span><span>random</span><span>()</span> <span>*</span> <span>3</span><span>)</span>
    <span>d</span> <span>=</span> <span>root</span><span>.</span><span>xpath</span><span>(</span><span>'//div[@id="phoneticPanel"]/div/ul[@class="transcript"]'</span>
                  <span>'/li/span[contains(text(), "Traditional IPA")]'</span>
                  <span>'/following-sibling::text()'</span><span>)</span>
    <span>if</span> <span>d</span><span>:</span>
        <span>print</span><span>(</span><span>'SUCCESS'</span><span>)</span>
        <span>return</span> <span>d</span><span>[</span><span>0</span><span>].</span><span>strip</span><span>(</span><span>' ˈ'</span><span>)</span>
    <span>print</span><span>(</span><span>'FAILED'</span><span>)</span></code></pre></figure>

<p>As you can see, this function is semi-interactive. Without user intervention it will
get stuck on a CAPTCHA. Even then, you’ll eventually reach their daily usage limit
and won’t be able to continue. For our purpose this shall be good enough though.</p>

<figure><pre><code data-lang="python"><span>&gt;</span> <span>ipa_from_youglish</span><span>(</span><span>'gryffindor'</span><span>)</span>
<span>Scraping</span> <span>word</span> <span>"gryffindor"</span> <span>from</span> <span>youglish</span><span>...</span><span>SUCCESS</span>
<span>grɪfɪndɔː</span></code></pre></figure>

<p>I have shown that for many words there are several possible pronunciations, from which you need to choose
your preferred one, and that some words are not in the CMU dictionary and
require scraping the IPA from another source or are not available at all.
For these 2 reasons, you will need to build your own personal IPA dictionary.</p>

<p>I’m going to build my IPA dictionary by iterating through the words of the Harry Potter books
and adding each word and the corresponding IPA to my dictionary.</p>

<p>First, I define
some functions for managing my dictionary (a simple JSON file in this case).</p>

<figure><pre><code data-lang="python"><span>import</span> <span>os</span><span>,</span> <span>glob</span><span>,</span> <span>json</span>

<span>ipa_dict_path</span> <span>=</span> <span>'data/ipa-dict.json'</span>

<span>def</span> <span>load_json_file_or_dict</span><span>(</span><span>filename</span><span>):</span>
    <span>"""Load data from json file if exists otherwise return empty dict."""</span>
    <span>if</span> <span>os</span><span>.</span><span>path</span><span>.</span><span>isfile</span><span>(</span><span>filename</span><span>):</span>
        <span>with</span> <span>open</span><span>(</span><span>filename</span><span>)</span> <span>as</span> <span>f</span><span>:</span>
            <span>return</span> <span>json</span><span>.</span><span>load</span><span>(</span><span>f</span><span>)</span>
    <span>return</span> <span>dict</span><span>()</span>

<span>def</span> <span>save_to_json_file</span><span>(</span><span>data</span><span>,</span> <span>filename</span><span>):</span>
    <span>"""Save data to json file."""</span>
    <span>with</span> <span>open</span><span>(</span><span>filename</span><span>,</span> <span>'w'</span><span>)</span> <span>as</span> <span>f</span><span>:</span>
        <span>json</span><span>.</span><span>dump</span><span>(</span><span>data</span><span>,</span> <span>f</span><span>)</span>

<span>def</span> <span>load_ipa_dict</span><span>():</span>
    <span>"""Load IPA dict from json file."""</span>
    <span>return</span> <span>load_json_file_or_dict</span><span>(</span><span>ipa_dict_path</span><span>)</span>

<span>def</span> <span>save_ipa_dict</span><span>(</span><span>ipa_dict</span><span>):</span>
    <span>"""Save IPA dict to json file."""</span>
    <span>save_to_json_file</span><span>(</span><span>ipa_dict</span><span>,</span> <span>ipa_dict_path</span><span>)</span></code></pre></figure>

<p>Next, I iterate through the words of the books and enter
each word and whatever is returned by <em>eng-to-ipa</em> into my dictionary.</p>

<figure><pre><code data-lang="python"><span>def</span> <span>harry_potter_text</span><span>():</span>
    <span>"""Return entire content of the Harry Potter books in a single string."""</span>
    <span>data</span> <span>=</span> <span>[]</span>
    <span>for</span> <span>filename</span> <span>in</span> <span>glob</span><span>.</span><span>glob</span><span>(</span><span>'data/json/Harry Potter*'</span><span>):</span>
        <span>with</span> <span>open</span><span>(</span><span>filename</span><span>)</span> <span>as</span> <span>f</span><span>:</span>
            <span>data</span><span>.</span><span>append</span><span>(</span><span>json</span><span>.</span><span>load</span><span>(</span><span>f</span><span>)[</span><span>'text'</span><span>])</span>
    <span>return</span> <span>' '</span><span>.</span><span>join</span><span>(</span><span>data</span><span>)</span>
    
<span>def</span> <span>populate_ipa_dict_from_text</span><span>(</span><span>text</span><span>):</span>
    <span>"""Get all IPA information from eng_to_ipa and save to ipa_dict."""</span>
    <span>ipa_dict</span> <span>=</span> <span>load_ipa_dict</span><span>()</span>
    <span>words</span> <span>=</span> <span>preprocess</span><span>(</span><span>text</span><span>).</span><span>split</span><span>()</span>
    <span>for</span> <span>word</span> <span>in</span> <span>set</span><span>(</span><span>words</span><span>)</span> <span>-</span> <span>set</span><span>(</span><span>ipa_dict</span><span>.</span><span>keys</span><span>()):</span>
        <span>ipa</span> <span>=</span> <span>eng_to_ipa</span><span>.</span><span>convert</span><span>(</span><span>word</span><span>,</span> <span>retrieve_all</span><span>=</span><span>True</span><span>,</span> <span>keep_punct</span><span>=</span><span>False</span><span>,</span>
                                 <span>stress_marks</span><span>=</span><span>False</span><span>)</span>
        <span>ipa_dict</span><span>[</span><span>word</span><span>]</span> <span>=</span> <span>ipa</span>
    <span>save_ipa_dict</span><span>(</span><span>ipa_dict</span><span>)</span>
    
<span>populate_ipa_dict_from_text</span><span>(</span><span>harry_potter_text</span><span>())</span></code></pre></figure>

<p>Each value in the dictionary is now a list of possible IPAs as that is what
<em>eng-to-ipa</em> returned. Before the dictionary can be used, we need to ensure
that each word …</p></div></article></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://darkshadow.io/2020/07/09/harry-potter-and-the-mnemonic-major-system.html">https://darkshadow.io/2020/07/09/harry-potter-and-the-mnemonic-major-system.html</a></em></p>]]>
            </description>
            <link>https://darkshadow.io/2020/07/09/harry-potter-and-the-mnemonic-major-system.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-24045475</guid>
            <pubDate>Tue, 04 Aug 2020 01:14:31 GMT</pubDate>
        </item>
    </channel>
</rss>
