<rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>
<![CDATA[Hacker News - Small Sites - Score >= 50]]>
        </title>
        <description>
<![CDATA[Hacker News stories from domains that aren't in the top 1M and that have a score of at least 50. Updated nightly via https://github.com/awendland/hacker-news-small-sites]]>
        </description>
        <link>https://news.ycombinator.com</link>
        <generator>RSS for Node</generator>
        <lastBuildDate>Sun, 27 Dec 2020 17:02:47 GMT</lastBuildDate>
        <atom:link href="https://raw.githubusercontent.com/awendland/hacker-news-small-sites/generated/feeds/hn-small-sites-score-50.xml" rel="self" type="application/rss+xml"></atom:link>
        <pubDate>Sun, 27 Dec 2020 17:02:47 GMT</pubDate>
        <language>
<![CDATA[en-US]]>
        </language>
        <managingEditor>
<![CDATA[me@alexwendland.com (Alex Wendland)]]>
        </managingEditor>
        <ttl>240</ttl>
        <item>
            <title>
<![CDATA[Backdoor in Zyxel Products]]>
            </title>
            <description>
<![CDATA[
Score 121 | Comments 27 (<a href="https://news.ycombinator.com/item?id=25539876">thread link</a>) | @ta988
<br/>
December 25, 2020 | https://www.eyecontrol.nl/blog/undocumented-user-account-in-zyxel-products.html | <a href="https://web.archive.org/web/*/https://www.eyecontrol.nl/blog/undocumented-user-account-in-zyxel-products.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
					<div>
						<div>
							<p>TL;DR: If you have a Zyxel USG, ATP, VPN, ZyWALL or USG FLEX you should update to the latest firmware version today. You can find the full list of affected devices <a href="https://businessforum.zyxel.com/discussion/5252/zld-v4-60-revoke-and-wk48-firmware-release">here</a> and the Zyxel advisory <a href="https://www.zyxel.com/support/CVE-2020-29583.shtml">here</a>.</p>
                            <p>Zyxel is a popular brand for firewalls that are marketed towards small and medium businesses. Their Unified Security Gateway (USG) product line is often used as a firewall or VPN gateway. As a lot of us are working from home, VPN-capable devices have been quite selling well lately.</p>
                            <p>When doing some research (rooting) on my Zyxel USG40, I was surprised to find a user account 'zyfwp' with a password hash in the latest firmware version (4.60 patch 0). The plaintext password was visible in one of the binaries on the system. I was even more surprised that this account seemed to work on both the SSH and web interface.</p>
                            <pre>$ ssh <a href="https://www.eyecontrol.nl/cdn-cgi/l/email-protection" data-cfemail="651f1c03121525545c574b54535d4b544b575057">[email&nbsp;protected]</a>
Password: Pr*******Xp
Router&gt; show users current
No: 1
  Name: zyfwp
  Type: admin
(...)
Router&gt;</pre>
                            <p>The user is not visible in the interface and its password cannot be changed. I checked the previous firmware version (4.39) and although the user was present, it did not have a password. It seemed the vulnerability had been introduced in the latest firmware version. Even though older versions do not have this vulnerability, they do have others (such as this <a href="https://www.zyxel.com/us/en/support/Zyxel-security-advisory-for-buffer-overflow-vulnerability.shtml">buffer overflow</a>) so you should still update.</p>
                            <p>As SSL VPN on these devices operates on the same port as the web interface, a lot of users have exposed port 443 of these devices to the internet. Using publicly available data from Project Sonar, I was able to identify about 3.000 Zyxel USG/ATP/VPN devices in the Netherlands. Globally, more than 100.000 devices have exposed their web interface to the internet.</p>
                            <p>In our experience, most users of these devices will not update the firmware very often. Zyxel devices do not expose their firmware version to unauthenticated users, so determining if a device is vulnerable is a bit more difficult. We wanted to get an idea of the amount of affected devices, but simply trying the password is not really an option (ethically and legally). Luckily, some javascript and css files can be requested from the web interface of these devices without authentication. These files seem to change with every firmware release. Using this information, we can obtain a unique fingerprint of the vulnerable firmware version. We used this information to identify the firmware version of 1.000 devices in The Netherlands and found that around 10% of devices are running the affected firmware version. Zyxel does offer automatic updates, but these are not enabled by default. Luckily, we were able to find this vulnerability just a few weeks after it had been introduced, or the number of affected devices could have been much larger.</p>
                            <p>As the zyfwp user has admin privileges, this is a serious vulnerability. An attacker could completely compromise the confidentiality, integrity and availability of the device. Someone could for example change firewall settings to allow or block certain traffic. They could also intercept traffic or create VPN accounts to gain access to the network behind the device.  Combined with a vulnerability like Zerologon this could be devastating to small and medium businesses.</p>
                            <p>Because of the seriousness of the vulnerability and it being so easy to exploit, we have decided not to release the password for this account at this time. We do expect others to find and release it, which is why we suggest you install the updated firmware as soon as possible.</p>
                            <p>I quickly sent out a mail to Zyxel to report the undocumented user account. According to Zyxel, the account was designed to deliver automatic firmware updates for access points via FTP. They released a fixed firmware version less than two weeks later. You can find the release notes for the USG40 <a href="ftp://ftp.zyxel.com/USG40/firmware/USG40_4.60(AALA.1)C0_2.pdf">here</a>.</p>
                            <p>This is the entry in the release notes that describes this vulnerability:</p>
                            <pre>[BUG FIX][CVE-2020-29583]
a. Vulnerability fix for undocumented user account.</pre>
                            <p>We would like to thank the Zyxel Security Team for their quick response and patch.</p>
                            <p><b>Disclosure timeline</b></p>
                            <p>2020-11-29: EYE reports vulnerability to Zyxel security</p>
                            <p>2020-11-30: Zyxel acknowledges receipt</p>
                            <p>2020-12-02: Zyxel requests more information about how the vulnerability was discovered</p>
                            <p>2020-12-03: EYE sends more details</p>
                            <p>2020-12-08: Zyxel releases beta firmware 4.60-WK48 and removes the vulnerable firmware version from their site</p>
                            <p>2020-12-15: Zyxel releases firmware 4.60 patch 1 for most devices</p>
                            <p>2020-12-18: Zyxel releases firmware 4.60 patch 1 for all remaining devices</p>
                            <p>2020-12-23: Zyxel publishes <a href="https://www.zyxel.com/support/CVE-2020-29583.shtml">advisory</a></p>

						</div>
						
					</div>
                </div></div>]]>
            </description>
            <link>https://www.eyecontrol.nl/blog/undocumented-user-account-in-zyxel-products.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-25539876</guid>
            <pubDate>Fri, 25 Dec 2020 23:15:18 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[A Complete Guide to LLVM for Programming Language Creators]]>
            </title>
            <description>
<![CDATA[
Score 284 | Comments 29 (<a href="https://news.ycombinator.com/item?id=25539797">thread link</a>) | @mseri
<br/>
December 25, 2020 | https://mukulrathi.co.uk/create-your-own-programming-language/llvm-ir-cpp-api-tutorial/ | <a href="https://web.archive.org/web/*/https://mukulrathi.co.uk/create-your-own-programming-language/llvm-ir-cpp-api-tutorial/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article><h3>Creating the Bolt Compiler: Part 8</h3><p><h3>December 24, 2020</h3><h3>12 min read</h3></p><nav><h2>Series: Creating the Bolt Compiler</h2><ul><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li><strong>Part 8: A Complete Guide to LLVM for Programming Language Creators</strong></li><li><em>Part 9: Concurrency is a Runtime Feature, Not a Compiler Feature*</em></li><li><em>Part 10: Inheritance and method overriding in Bolt*</em></li><li><em>Part 11: Generics - adding polymorphism to Bolt*</em></li><p>*coming soon! </p></ul></nav><hr><p><strong>Update</strong>: this post has now taken off on <a href="https://news.ycombinator.com/item?id=25539797">Hacker News</a> and <a href="https://www.reddit.com/r/programming/comments/kjjijf/a_complete_guide_to_llvm_for_programming_language/">Reddit</a>. Thank you all!</p><p>I have a small request:</p><div><div><div> <h3>Share This On Twitter</h3><p>If you find this useful, please share on Twitter, thank you!</p></div></div></div><h2 id="whos-this-tutorial-for"><a href="#whos-this-tutorial-for" aria-label="whos this tutorial for permalink"></a>Who’s this tutorial for?</h2><p>This series of compiler tutorials is for people who don’t just want to create a <em>toy</em> language.
You want objects. You want polymorphism. You want concurrency. You want garbage collection. Wait you don’t want GC? Okay, no worries, we won’t do that :P</p><p>If you’ve just joined the series at this stage, here’s a quick recap. We’re designing a Java-esque concurrent object-oriented programming language <em>Bolt</em>. We’ve gone through the compiler frontend, where we’ve done the parsing, type-checking and dataflow analysis. We’ve <a href="https://mukulrathi.co.uk/create-your-own-programming-language/lower-language-constructs-to-llvm/">desugared our language to get it ready for LLVM</a> - the main takeaway is that objects have been desugared to structs, and their methods desugared to functions.</p><p>Learn about LLVM and you’ll be the envy of your friends. Rust uses LLVM for its backend, so it must be cool. You’ll beat them on all those performance benchmarks, without having to hand-optimise your code or write machine assembly code. Shhhh, I won’t tell them.</p><h2 id="just-give-me-the-code"><a href="#just-give-me-the-code" aria-label="just give me the code permalink"></a>Just give me the code!</h2><p>All the code can be found in the <a href="https://github.com/mukul-rathi/bolt">Bolt compiler repository</a>.</p><p>The C++ class definitions for our desugared representation (we call this <em>Bolt IR</em>) can be found in <a href="https://github.com/mukul-rathi/bolt/tree/master/src/llvm-backend/deserialise_ir">deserialise_ir</a> folder. The code for this post (the LLVM IR generation) can be found in the <a href="https://github.com/mukul-rathi/bolt/tree/master/src/llvm-backend/llvm_ir_codegen">llvm_ir_codegen</a> folder. The repo uses the Visitor design pattern and ample use of <code>std::unique_ptr</code> to make memory management easier.</p><p>To cut through the boilerplate, to find out how to generate LLVM IR for a particular language expression, search for the <code>IRCodegenVisitor::codegen</code> method that takes in the corresponding <code>ExprIR</code> object. e.g. for if-else statements:</p><div><div><pre><p><span>Value </span><span>*</span><span>IRCodegenVisitor</span><span>::</span><span>codegen</span><span>(</span><span>const</span><span> ExprIfElseIR </span><span>&amp;</span><span>expr</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>      </span><span>.</span><span>.</span><span>.</span><span> </span><span></span></p><p><span></span><span>}</span></p></pre></div></div><h2 id="understanding-llvm-ir"><a href="#understanding-llvm-ir" aria-label="understanding llvm ir permalink"></a>Understanding LLVM IR</h2><p>LLVM sits in the <strong>middle-end</strong> of our compiler, <em>after</em> we’ve desugared our language features, but <em>before</em> the backends that target specific machine architectures (x86, ARM etc.)</p><p>LLVM’s IR is pretty low-level, it can’t contain language features present in some languages but not others (e.g. classes are present in C++ but not C). If you’ve come across instruction sets before, LLVM IR is a <a href="https://en.wikipedia.org/wiki/Reduced_instruction_set_computer#:~:text=A%20reduced%20instruction%20set%20computer,instruction%20set%20computer%20(CISC).">RISC</a> instruction set.</p><p>The upshot of it is that LLVM IR looks like a more <em>readable</em> form of assembly. As LLVM IR is <strong>machine independent</strong>, we don’t need to worry about the number of registers, size of datatypes, calling conventions or other machine-specific details.</p><p>So instead of a fixed number of physical registers, in LLVM IR we have an unlimited set of <em>virtual</em> registers (labelled <code>%0</code>, <code>%1</code>, <code>%2</code>, <code>%3</code>… we can write and read from. It’s the backend’s job to map from virtual to physical registers.</p><p>And rather than allocating specific sizes of datatypes, we retain <strong>types</strong> in LLVM IR. Again, the backend will take this type information and map it to the size of the datatype. LLVM has types for different sizes of <code>int</code>s and floats, e.g. <code>int32</code>, <code>int8</code>, <code>int1</code> etc. It also has derived types: like <strong>pointer</strong> types, <strong>array</strong> types, <strong>struct</strong> types, <strong>function</strong> types. To find out more, check out the <a href="https://llvm.org/doxygen/classllvm_1_1Type.html">Type</a> documentation.</p><p>Now, built into LLVM are a set of optimisations we can run over the LLVM IR e.g. <a href="https://en.wikipedia.org/wiki/Dead_code_elimination">dead-code elimination</a>, <a href="https://en.wikipedia.org/wiki/Inline_expansion">function inlining</a>, <a href="https://cran.r-project.org/web/packages/rco/vignettes/opt-common-subexpr.html">common subexpression elimination</a> etc. The details of these algorithms are irrelevant: LLVM implements them for us.</p><p>Our side of the bargain is that we write LLVM IR in <a href="https://en.wikipedia.org/wiki/Static_single_assignment_form">Static Single Assignment (SSA) form</a>, as SSA form makes life easier for optimisation writers. SSA form sounds fancy, but it just means we define variables before use and assign to variables <strong>only once</strong>. In SSA form, we cannot reassign to a variable, e.g. <code>x = x+1</code>; instead we assign to a fresh variable each time (<code>x2 = x1 + 1</code>).</p><p>So in short: LLVM IR looks like assembly with <strong>types</strong>, minus the messy machine-specific details. LLVM IR must be in SSA form, which makes it easier to optimise. Let’s look at an example!</p><h3 id="an-example-factorial"><a href="#an-example-factorial" aria-label="an example factorial permalink"></a>An example: Factorial</h3><p>Let’s look at a simple factorial function in our language Bolt:</p><div><p><span>factorial.bolt</span></p><div><pre><p><span>function </span><span>int</span><span> </span><span>factorial</span><span>(</span><span>int</span><span> n</span><span>)</span><span>{</span><span></span></p><p><span>  </span><span>if</span><span> </span><span>(</span><span>n</span><span>==</span><span>0</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>    </span><span>1</span><span></span></p><p><span>  </span><span>}</span><span></span></p><p><span>  </span><span>else</span><span>{</span><span></span></p><p><span>    n </span><span>*</span><span> </span><span>factorial</span><span>(</span><span>n </span><span>-</span><span> </span><span>1</span><span>)</span><span></span></p><p><span>  </span><span>}</span><span></span></p><p><span></span><span>}</span></p></pre></div></div><p>The corresponding LLVM IR is as follows:</p><div><p><span>factorial.ll</span></p><div><pre><p><span>define i32 @</span><span>factorial</span><span>(</span><span>i32</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>entry</span><span>:</span><span></span></p><p><span>  </span><span>%</span><span>eq </span><span>=</span><span> icmp eq i32 </span><span>%</span><span>0</span><span>,</span><span> </span><span>0</span><span>   </span><span></span></p><p><span>  br i1 </span><span>%</span><span>eq</span><span>,</span><span> label </span><span>%</span><span>then</span><span>,</span><span> label </span><span>%</span><span>else</span><span></span></p><p><span>then</span><span>:</span><span>                                             </span><span>;</span><span> preds </span><span>=</span><span> </span><span>%</span><span>entry</span></p><p><span>  br label </span><span>%</span><span>ifcont</span></p><p><span></span><span>else</span><span>:</span><span>                                             </span><span>;</span><span> preds </span><span>=</span><span> </span><span>%</span><span>entry</span></p><p><span>  </span><span>%</span><span>sub </span><span>=</span><span> sub i32 </span><span>%</span><span>0</span><span>,</span><span> </span><span>1</span><span>   </span><span></span></p><p><span>  </span><span>%</span><span>2</span><span> </span><span>=</span><span> call i32 @</span><span>factorial</span><span>(</span><span>i32 </span><span>%</span><span>sub</span><span>)</span><span> </span><span></span></p><p><span>  </span><span>%</span><span>mult </span><span>=</span><span> mul i32 </span><span>%</span><span>0</span><span>,</span><span> </span><span>%</span><span>2</span><span>  </span><span></span></p><p><span>  br label </span><span>%</span><span>ifcont</span></p><p><span>ifcont</span><span>:</span><span>                                           </span><span>;</span><span> preds </span><span>=</span><span> </span><span>%</span><span>else</span><span>,</span><span> </span><span>%</span><span>then</span></p><p><span>  </span><span>%</span><span>iftmp </span><span>=</span><span> phi i32 </span><span>[</span><span> </span><span>1</span><span>,</span><span> </span><span>%</span><span>then </span><span>]</span><span>,</span><span> </span><span>[</span><span> </span><span>%</span><span>mult</span><span>,</span><span> </span><span>%</span><span>else</span><span> </span><span>]</span><span></span></p><p><span>  ret i32 </span><span>%</span><span>iftmp</span></p><p><span></span><span>}</span></p></pre></div></div><p>Note the <code>.ll</code> extension is for <strong>human-readable</strong> LLVM IR output. There’s also <code>.bc</code> for bit-code, a more compact machine representation of LLVM IR.</p><p>We can walk through this IR in 4 levels of detail:</p><h4 id="at-the-instruction-level"><a href="#at-the-instruction-level" aria-label="at the instruction level permalink"></a>At the Instruction Level:</h4><p>Notice how LLVM IR contains assembly instructions like <code>br</code> and <code>icmp</code>, but abstracts the machine-specific messy details of function calling conventions with a single <code>call</code> instruction.</p><p><span>
      <a href="https://mukulrathi.co.uk/static/f987ee45552570ad7aa513f6d3fc19a7/565cc/factorial-instructions.png" target="_blank" rel="noopener">
    <span></span>
  <img alt="Factorial instructions" title="Factorial instructions" src="https://mukulrathi.co.uk/static/f987ee45552570ad7aa513f6d3fc19a7/a6d36/factorial-instructions.png" srcset="https://mukulrathi.co.uk/static/f987ee45552570ad7aa513f6d3fc19a7/222b7/factorial-instructions.png 163w,https://mukulrathi.co.uk/static/f987ee45552570ad7aa513f6d3fc19a7/ff46a/factorial-instructions.png 325w,https://mukulrathi.co.uk/static/f987ee45552570ad7aa513f6d3fc19a7/a6d36/factorial-instructions.png 650w,https://mukulrathi.co.uk/static/f987ee45552570ad7aa513f6d3fc19a7/e548f/factorial-instructions.png 975w,https://mukulrathi.co.uk/static/f987ee45552570ad7aa513f6d3fc19a7/3c492/factorial-instructions.png 1300w,https://mukulrathi.co.uk/static/f987ee45552570ad7aa513f6d3fc19a7/565cc/factorial-instructions.png 1806w" sizes="(max-width: 650px) 100vw, 650px" loading="lazy">
  </a>
    </span></p><h4 id="at-the-control-flow-graph-level"><a href="#at-the-control-flow-graph-level" aria-label="at the control flow graph level permalink"></a>At the Control Flow Graph Level:</h4><p>If we take a step back, you can see the IR defines the <strong>control flow graph</strong> of the program. IR instructions are grouped into labeled <strong>basic blocks</strong>, and the <code>preds</code> labels for each block represent incoming edges to that block. e.g. the <code>ifcont</code> basic block has predecessors <code>then</code> and <code>else</code>:</p><p>At this point, I’m going to assume you have come across Control Flow Graphs and basic blocks. We introduced Control Flow Graphs in a previous post in the series, where we used them to perform different dataflow analyses on the program. I’d recommend you go and check the <a href="http://mukulrathi.co.uk/create-your-own-programming-language/data-race-dataflow-analysis/#control-flow-graph">CFG section of that dataflow analysis post</a> now. I’ll wait here :)</p><p><span>
      <a href="https://mukulrathi.co.uk/static/6a6edf6d916150ea4de92c0fc1a68e1a/11864/factorial-cfg.png" target="_blank" rel="noopener">
    <span></span>
  <img alt="Factorial control flow graph" title="Factorial control flow graph" src="https://mukulrathi.co.uk/static/6a6edf6d916150ea4de92c0fc1a68e1a/a6d36/factorial-cfg.png" srcset="https://mukulrathi.co.uk/static/6a6edf6d916150ea4de92c0fc1a68e1a/222b7/factorial-cfg.png 163w,https://mukulrathi.co.uk/static/6a6edf6d916150ea4de92c0fc1a68e1a/ff46a/factorial-cfg.png 325w,https://mukulrathi.co.uk/static/6a6edf6d916150ea4de92c0fc1a68e1a/a6d36/factorial-cfg.png 650w,https://mukulrathi.co.uk/static/6a6edf6d916150ea4de92c0fc1a68e1a/e548f/factorial-cfg.png 975w,https://mukulrathi.co.uk/static/6a6edf6d916150ea4de92c0fc1a68e1a/3c492/factorial-cfg.png 1300w,https://mukulrathi.co.uk/static/6a6edf6d916150ea4de92c0fc1a68e1a/11864/factorial-cfg.png 2034w" sizes="(max-width: 650px) 100vw, 650px" loading="lazy">
  </a>
    </span></p><p>The <code>phi</code> instruction represents <strong>conditional assignment</strong>: assigning different values depending on which preceding basic block we’ve just come from. It is of the form <code>phi type [val1, predecessor1], [val2, predecessor2], ...</code> In the example above, we set <code>%iftmp</code> to 1 if we’ve come from the <code>then</code> block, and <code>%mult</code> if we’ve come from the <code>else</code> block. Phi nodes must be at the <strong>start</strong> of a block, and include one entry for each predecessor.</p><h4 id="at-the-function-level"><a href="#at-the-function-level" aria-label="at the function level permalink"></a>At the Function Level:</h4><p>Taking another step back, the overall structure of a function in LLVM IR is as follows:</p><p><span>
      <a href="https://mukulrathi.co.uk/static/c80bbba94459a0ac84429c53299823b2/b2b2c/factorial-fn.png" target="_blank" rel="noopener">
    <span></span>
  <img alt="Factorial fn" title="Factorial fn" src="https://mukulrathi.co.uk/static/c80bbba94459a0ac84429c53299823b2/a6d36/factorial-fn.png" srcset="https://mukulrathi.co.uk/static/c80bbba94459a0ac84429c53299823b2/222b7/factorial-fn.png 163w,https://mukulrathi.co.uk/static/c80bbba94459a0ac84429c53299823b2/ff46a/factorial-fn.png 325w,https://mukulrathi.co.uk/static/c80bbba94459a0ac84429c53299823b2/a6d36/factorial-fn.png 650w,https://mukulrathi.co.uk/static/c80bbba94459a0ac84429c53299823b2/e548f/factorial-fn.png 975w,https://mukulrathi.co.uk/static/c80bbba94459a0ac84429c53299823b2/3c492/factorial-fn.png 1300w,https://mukulrathi.co.uk/static/c80bbba94459a0ac84429c53299823b2/b2b2c/factorial-fn.png 1708w" sizes="(max-width: 650px) 100vw, 650px" loading="lazy">
  </a>
    </span></p><h4 id="at-the-module-level"><a href="#at-the-module-level" aria-label="at the module level permalink"></a>At the Module Level:</h4><p>An LLVM <strong>module</strong> contains all the information associated with a program file. (For multi-file programs, we’d link together their corresponding modules.)</p><p><span>
      <a href="https://mukulrathi.co.uk/static/e21edb9623d8fb7bc23f57db23b93cf8/cad61/module.png" target="_blank" rel="noopener">
    <span></span>
  <img alt="LLVM Module" title="LLVM Module" src="https://mukulrathi.co.uk/static/e21edb9623d8fb7bc23f57db23b93cf8/a6d36/module.png" srcset="https://mukulrathi.co.uk/static/e21edb9623d8fb7bc23f57db23b93cf8/222b7/module.png 163w,https://mukulrathi.co.uk/static/e21edb9623d8fb7bc23f57db23b93cf8/ff46a/module.png 325w,https://mukulrathi.co.uk/static/e21edb9623d8fb7bc23f57db23b93cf8/a6d36/module.png 650w,https://mukulrathi.co.uk/static/e21edb9623d8fb7bc23f57db23b93cf8/e548f/module.png 975w,https://mukulrathi.co.uk/static/e21edb9623d8fb7bc23f57db23b93cf8/3c492/module.png 1300w,https://mukulrathi.co.uk/static/e21edb9623d8fb7bc23f57db23b93cf8/cad61/module.png 1988w" sizes="(max-width: 650px) 100vw, 650px" loading="lazy">
  </a>
    </span></p><p>Our <code>factorial</code> function is just one function definition in our module. If we want to execute the program, e.g. to compute <code>factorial(10)</code> we need to define a
<code>main</code> function, which will be the entrypoint for our program’s execution. The <code>main</code> function’s signature is a hangover from C (we return 0 to indicate successful execution):</p><div><p><span>example_program.c</span></p><div><pre><p><span></span><span>int</span><span> </span><span>main</span><span>(</span><span>)</span><span>{</span><span></span></p><p><span>  </span><span>factorial</span><span>(</span><span>10</span><span>)</span><span>;</span><span></span></p><p><span>  </span><span>return</span><span> </span><span>0</span><span>;</span><span></span></p><p><span></span><span>}</span></p></pre></div></div><p>We specify that we want to compile for an Intel Macbook Pro in the module target info:</p><div><p><span>example_module.ll</span></p><div><pre><p><span>source_filename </span><span>=</span><span> </span><span>"Module"</span><span></span></p><p><span>target triple </span><span>=</span><span> </span><span>"x86_64-apple-darwin18.7.0"</span><span></span></p><p><span></span><span>.</span><span>.</span><span>.</span><span></span></p><p><span>define i32 @</span><span>factorial</span><span>(</span><span>i32</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>.</span><span>.</span><span>.</span><span></span></p><p><span></span><span>}</span><span></span></p><p><span>define i32 @</span><span>main</span><span>(</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>entry</span><span>:</span><span></span></p><p><span>  </span><span>%</span><span>0</span><span> </span><span>=</span><span> call i32 @</span><span>factorial</span><span>(</span><span>i32 </span><span>10</span><span>)</span><span></span></p><p><span>  ret i32 </span><span>0</span><span></span></p><p><span></span><span>}</span></p></pre></div></div><h2 id="the-llvm-api-key-concepts"><a href="#the-llvm-api-key-concepts" aria-label="the llvm api key concepts permalink"></a>The LLVM API: Key Concepts</h2><p>Now we’ve got the basics of LLVM IR down, let’s introduce the LLVM API. We’ll go through the key concepts, then introduce more of the API as we explore LLVM IR further.</p><p>LLVM defines a whole host of classes that map to the concepts we’ve talked about.</p><ul><li><code>Value</code></li><li><code>Module</code></li><li><code>Type</code></li><li><code>Function</code></li><li><code>BasicBlock</code></li><li><code>BranchInst</code>
…</li></ul><p>These are all in the namespace <code>llvm</code>. In the Bolt repo, I chose to make this namespacing explicit by referring to them as <code>llvm::Value</code>, <code>llvm::Module</code> etc.)</p><p>Most of the LLVM API is quite mechanical. Now you’ve seen the diagrams that define modules, functions and basic blocks, the relationship between their corresponding classes in the API falls out nicely. You can query a <code>Module</code> object to get a list of its <code>Function</code> objects, and query a <code>Function</code> to get the list of its <code>BasicBlock</code>s, and the other way round: you can query a <code>BasicBlock</code> to get its parent <code>Function</code> object.</p><p><code>Value</code> is the base class for any value computed by the program. This could be a function (<code>Function</code> subclasses <code>Value</code>), a basic block (<code>BasicBlock</code> also subclasses <code>Value</code>), an instruction, or the result of an intermediate computation.</p><p>Each of the expression <code>codegen</code> methods returns a <code>Value *</code>: the result of executing that expression. You can think of these <code>codegen</code> methods as generating the IR for that expression and the <code>Value *</code> representing the virtual register containing the expression’s result.</p><div><p><span><a href="https://github.com/mukul-rathi/bolt/blob/master/src/llvm-backend/llvm_ir_codegen/ir_codegen_visitor.h#L64-L84"> <!-- -->ir_codegen_visitor.h</a></span></p><div><pre><p><span>virtual</span><span> Value </span><span>*</span><span>codegen</span><span>(</span><span>const</span><span> ExprIntegerIR </span><span>&amp;</span><span>expr</span><span>)</span><span> override</span><span>;</span><span></span></p><p><span></span><span>virtual</span><span> Value </span><span>*</span><span>codegen</span><span>(</span><span>const</span><span> ExprBooleanIR </span><span>&amp;</span><span>expr</span><span>)</span><span> override</span><span>;</span><span></span></p><p><span></span><span>virtual</span><span> Value </span><span>*</span><span>codegen</span><span>(</span><span>const</span><span> ExprIdentifierIR </span><span>&amp;</span><span>expr</span><span>)</span><span> override</span><span>;</span><span></span></p><p><span></span><span>virtual</span><span> Value </span><span>*</span><span>codegen</span><span>(</span><span>const</span><span> ExprConstructorIR </span><span>&amp;</span><span>expr</span><span>)</span><span> override</span><span>;</span><span></span></p><p><span></span><span>virtual</span><span> Value </span><span>*</span><span>codegen</span><span>(</span><span>const</span><span> ExprLetIR </span><span>&amp;</span><span>expr</span><span>)</span><span> override</span><span>;</span><span></span></p><p><span></span><span>virtual</span><span> Value </span><span>*</span><span>codegen</span><span>(</span><span>const</span><span> ExprAssignIR </span><span>&amp;</span><span>expr</span><span>)</span><span> override</span><span>;</span></p></pre></div></div><p>How do we generate the IR for these expressions? We create a <strong>unique</strong> <code>Context</code> object to tie our whole code generation together. We use this <code>Context</code> to get access to core LLVM data structures e.g LLVM modules and <code>IRBuilder</code> objects.</p><p>We’ll use the context to create just one module, which we’ll imaginatively name <code>"Module"</code>.</p><div><p><span><a href="https://github.com/mukul-rathi/bolt/blob/master/src/llvm-backend/llvm_ir_codegen/ir_codegen_visitor.cc#L17-L19"> <!-- -->ir_codegen_visitor.cc</a></span></p><div><pre><p><span>context </span><span>=</span><span> make_unique</span><span>&lt;</span><span>LLVMContext</span><span>&gt;</span><span>(</span><span>)</span><span>;</span><span></span></p><p><span>builder </span><span>=</span><span> std</span><span>::</span><span>unique_ptr</span><span>&lt;</span><span>IRBuilder</span><span>&lt;</span><span>&gt;&gt;</span><span>(</span><span>new</span><span> IRBuilder</span><span>&lt;</span><span>&gt;</span><span>(</span><span>*</span><span>context</span><span>)</span><span>)</span><span>;</span><span></span></p><p><span>module </span><span>=</span><span> make_unique</span><span>&lt;</span><span>Module</span><span>&gt;</span><span>(</span><span>"Module"</span><span>,</span><span> </span><span>*</span><span>context</span><span>)</span><span>;</span></p></pre></div></div><h3 id="irbuilder"><a href="#irbuilder" aria-label="irbuilder permalink"></a>IRBuilder</h3><p>We use the <code>IRBuilder</code> object to incrementally build up our IR. It is intuitively the equivalent of a file pointer when reading/writing a file - it carries around <em>implicit</em> state, e.g. the last instruction added, the basic block of that …</p></article></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://mukulrathi.co.uk/create-your-own-programming-language/llvm-ir-cpp-api-tutorial/">https://mukulrathi.co.uk/create-your-own-programming-language/llvm-ir-cpp-api-tutorial/</a></em></p>]]>
            </description>
            <link>https://mukulrathi.co.uk/create-your-own-programming-language/llvm-ir-cpp-api-tutorial/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25539797</guid>
            <pubDate>Fri, 25 Dec 2020 23:03:50 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[NixOS on ARM/Raspberry Pi]]>
            </title>
            <description>
<![CDATA[
Score 103 | Comments 15 (<a href="https://news.ycombinator.com/item?id=25538764">thread link</a>) | @botayhard
<br/>
December 25, 2020 | https://nixos.wiki/wiki/NixOS_on_ARM/Raspberry_Pi | <a href="https://web.archive.org/web/*/https://nixos.wiki/wiki/NixOS_on_ARM/Raspberry_Pi">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="mw-content-text" lang="en" dir="ltr">
<div>
<table>
<tbody><tr>
<th colspan="2">Raspberry Pi Family
</th></tr>
<tr>
<td colspan="2"><a href="https://nixos.wiki/wiki/File:Raspberry_pi_3_glamour.jpg" title="A Raspberry Pi 3 with enclosure."><img alt="A Raspberry Pi 3 with enclosure." src="https://nixos.wiki/images/thumb/4/40/Raspberry_pi_3_glamour.jpg/x256px-Raspberry_pi_3_glamour.jpg.pagespeed.ic.oggU_vQtmX.jpg" width="256" height="204" srcset="https://nixos.wiki/images/thumb/4/40/Raspberry_pi_3_glamour.jpg/x384px-Raspberry_pi_3_glamour.jpg.pagespeed.ic.Jh6nwVCkVn.jpg 1.5x, https://nixos.wiki/images/thumb/4/40/Raspberry_pi_3_glamour.jpg/x512px-Raspberry_pi_3_glamour.jpg.pagespeed.ic.oXV576JEG6.jpg 2x"></a>
</td></tr>
<tr>
<th colspan="2">Raspberry Pi
</th></tr>
<tr>
<th>Architecture
</th>
<td>ARMv6
</td></tr>
<tr>
<th colspan="2">Raspberry Pi 2
</th></tr>
<tr>
<th>Architecture
</th>
<td>ARMv7
</td></tr>
<tr>
<th colspan="2">Raspberry Pi 3
</th></tr>
<tr>
<th>Architecture
</th>
<td>AArch64 + ARMv7
</td></tr>
<tr>
<th colspan="2">Raspberry Pi 4
</th></tr>
<tr>
<th>Architecture
</th>
<td>AArch64 + ARMv7
</td></tr></tbody></table>
</div>
<p>The Raspberry Pi family of devices is a series of single-board computers made by the Raspberry Pi Foundation. They are all based on Broadcom System-on-a-chip (SOCs). 
</p>


<h2><span id="Status"></span>Status</h2>
<p>Only the <i>Raspberry Pi 3 Family</i> is supported upstream, with the AArch64 effort.
</p><p>The Raspberry Pi 4B is not <em>supported</em> by NixOS, though a beta-quality disk image specific for it is produced. It will be supported the same as the Pi 3 family once the mainline kernel and mainline U-Boot boot fine through the generic mainline image.
</p><p>Other Raspberry Pis (0, 1, and 2) are part of diverse community porting efforts to ARMv6 and ARMv7.
</p><p>The Linux kernel in use, except for the Raspberry Pi 1 family, is the mainline Linux kernel, and not the Raspberry Pi Foundation's fork. This could reduce compatibility with some add-on boards or third-party libraries<sup>[expanded explanation needed]</sup>.
</p><p>The following table is intended to be updated by the NixOS contributors with the current status of the boards. For a list of products, <a rel="nofollow" href="https://www.raspberrypi.org/products/">see the <i>Products Archive</i></a>.
</p>
<table>

<tbody><tr>
<th> Board name
</th>
<th> Architecture
</th>
<th> Support
</th></tr>
<tr>
<th colspan="3">Raspberry&nbsp;Pi&nbsp;1
</th></tr>
<tr>
<td> Raspberry Pi 1 Model B
</td>
<td rowspan="5"> armv6
</td>
<td> C
</td></tr>
<tr>
<td> Raspberry Pi 1 Model A+
</td>
<td> C*
</td></tr>
<tr>
<td> Raspberry Pi 1 Model B+
</td>
<td> C
</td></tr>
<tr>
<td> Raspberry Pi Zero
</td>
<td> C*
</td></tr>
<tr>
<td> Raspberry Pi Zero W
</td>
<td> C
</td></tr>
<tr>
<th colspan="3">Raspberry&nbsp;Pi&nbsp;2
</th></tr>
<tr>
<td> Raspberry Pi 2 Model B
</td>
<td> armv7
</td>
<td> C
</td></tr>
<tr>
<th colspan="3">Raspberry&nbsp;Pi&nbsp;3
</th></tr>
<tr>
<td> <a href="https://nixos.wiki/wiki/NixOS_on_ARM/Raspberry_Pi_3" title="NixOS on ARM/Raspberry Pi 3">Raspberry Pi 3 Model B</a>
</td>
<td rowspan="3"> AArch64<br> <i>+&nbsp;armv7</i>
</td>
<td> YES
</td></tr>
<tr>
<td> <a href="https://nixos.wiki/wiki/NixOS_on_ARM/Raspberry_Pi_3" title="NixOS on ARM/Raspberry Pi 3">Raspberry Pi 3 Model B+</a>
</td>
<td> YES
</td></tr>
<tr>
<td> <a href="https://nixos.wiki/wiki/NixOS_on_ARM/Raspberry_Pi_3" title="NixOS on ARM/Raspberry Pi 3">Raspberry Pi 3 Model A+</a>
</td>
<td>&nbsp;?
</td></tr>
<tr>
<th colspan="3">Raspberry Pi 4
</th></tr>
<tr>
<td> <a href="https://nixos.wiki/wiki/NixOS_on_ARM/Raspberry_Pi_4" title="NixOS on ARM/Raspberry Pi 4">Raspberry Pi 4 Model B</a>
</td>
<td> AArch64<br> <i>+ armv7</i>
</td>
<td> YES* (<a rel="nofollow" href="https://github.com/NixOS/nixpkgs/issues/63720">GitHub issue</a>)
</td></tr></tbody></table>
<p><i>Support</i>
</p>
<ul><li> YES: Supported architecture by Nixpkgs downstream and tested to be working.</li>
<li> YES*: Available in Nixpkgs downstream but experimental.</li>
<li> C: Community supported, and tested to be working.</li>
<li> C*: Community supported, unverified but should be working.</li>
<li>&nbsp;?&nbsp;: Unverified, unknown if it will work.</li></ul>
<p>The Raspberry Pi 3 Family is only supported as <b>AArch64</b>. Use as armv7 is community supported.
</p>
<h2><span id="Board-specific_installation_notes"></span>Board-specific installation notes</h2>
<p>First follow the <a href="https://nixos.wiki/wiki/NixOS_on_ARM#Installation" title="NixOS on ARM">generic installation steps</a> to get the installer image and install using the <a href="https://nixos.wiki/wiki/NixOS_on_ARM#NixOS_installation_.26_configuration" title="NixOS on ARM">installation and configuration steps</a>.
</p>
<h3><span id="Raspberry_Pi_.281.29"></span>Raspberry Pi (1)</h3>
<p>The ARMv6 image boots out-of-the-box.
</p>
<h3><span id="Raspberry_Pi_2"></span>Raspberry Pi 2</h3>
<p>The ARMv7 image should boot out-of-the-box, though the author hasn't personally tested this.
</p>
<h3><span id="Raspberry_Pi_3_.2F_3B.2B"></span>Raspberry Pi 3 / 3B+</h3>
<p><a href="https://nixos.wiki/wiki/NixOS_on_ARM/Raspberry_Pi_3#Board-specific_installation_notes" title="NixOS on ARM/Raspberry Pi 3">Raspberry Pi 3#Board-specific installation notes</a>
</p>
<h3><span id="Raspberry_Pi_4B"></span>Raspberry Pi 4B</h3>
<p><a href="https://nixos.wiki/wiki/NixOS_on_ARM/Raspberry_Pi_4#Board-specific_installation_notes" title="NixOS on ARM/Raspberry Pi 4">Raspberry Pi 4#Board-specific installation notes</a>
</p>
<h2><span id="Serial_console"></span>Serial console</h2>
<p>Your <code>configuration.nix</code> will need to add <code>console=ttyS1,115200n8</code> to the <code>boot.kernelParams</code> configuration to use the serial console.
</p>
<p><img alt="Breeze-text-x-plain.png" src="https://nixos.wiki/images/e/ef/xBreeze-text-x-plain.png.pagespeed.ic.CzagNXRrGf.png" width="16" height="16"></p><pre>/etc/nixos/configuration.nix
</pre><div dir="ltr"><pre><span>{</span> config<span>,</span> pkgs<span>,</span> lib<span>,</span> <span>...</span> <span>}:</span>
<span>{</span>
  boot<span>.</span><span>kernelParams =</span> <span>[</span>
    <span>"console=ttyS1,115200n8"</span>
  <span>];</span>
<span>}</span>
</pre></div>
<p>If the Raspberry Pi downstream kernel is used the serial interface is named <code>serial0</code> instead.
</p>
<h2><span id="Binary_Cache"></span>Binary Cache</h2>
<p>Depending on the architecture used, binary caches availability varies. Binary caches instructions are on the main <a href="https://nixos.wiki/wiki/NixOS_on_ARM#Binary_cache" title="NixOS on ARM">NixOS on ARM</a>&nbsp;page. The following table describes the architectures supported by each board. 
</p>
<table>

<tbody><tr>
<th> Raspberry Pi 1
</th>
<td> armv6
</td></tr>
<tr>
<th> Raspberry Pi 2
</th>
<td> armv7
</td></tr>
<tr>
<th rowspan="2">Raspberry Pi 3
</th>
<td> armv7
</td></tr>
<tr>
<td> AArch64
</td></tr>
<tr>
<th rowspan="2">Raspberry Pi 4
</th>
<td> armv7
</td></tr>
<tr>
<td> AArch64
</td></tr></tbody></table>
<h2><span id="Notes_about_the_boot_process"></span>Notes about the boot process</h2>
<p>The custom bootloader, part of the Raspberry Pi firmware, is abstracted away for NixOS by making it boot U-Boot instead.
</p><p>U-Boot gives us the ability to provide a generation selection menu during the boot process, in addition to storing the boot files on the main partition, rather than on the firmware partition.
</p>
<h3><span id="Raspberry_Pi_.28all_versions.29"></span>Raspberry Pi (all versions)</h3>
<p>USB keyboards and HDMI displays should work, though some issues have been reported (see Troubleshooting below).
</p><p>Using the 3.3v serial port via the pin headers (exact location depends on hardware version) will get u-boot output and, when configured, a Linux kernel console.
</p>
<h2><span id="Troubleshooting"></span>Troubleshooting</h2>
<h3><span id="Power_issues"></span>Power issues</h3>
<p>Especially with the newer power-hungry Raspberry Pi families (3, 4), it is important to have a <a rel="nofollow" href="https://www.raspberrypi.org/documentation/hardware/raspberrypi/power/README.md">sufficient enough power supply</a> or <i>weirdness</i> may happen. Weirdness may include:
</p>
<ul><li> Lightning bolt on HDMI output "breaking" the display.</li>
<li> Screen switching back to u-boot text
<ul><li> Fixable temporarily when power is sufficient by switching VT (alt+F2 / alt+F1)</li></ul></li>
<li> Random hangs</li></ul>
<p>This problem is a hard problem. It is caused by the Raspberry Pi warning about power issues, but the current drivers (as of 
Linux 4.14) have a hard time dealing with it properly. If the power supply is rated properly AND the cable is not incurring too much power losses, it may be required to disable the lightning bolt indicator so the display driver isn't messed up.<sup id="cite_ref-1"><a href="#cite_note-1">[1]</a></sup> The lightning bolt indicator can be disabled by adding the line <code>avoid_warnings=1</code> in config.txt<sup id="cite_ref-2"><a href="#cite_note-2">[2]</a></sup>
</p>
<p><strong> Note: </strong>A <i>properly rated</i> USB power supply, AND a good cable are necessary. The cable has to be short enough to not incur power losses through the length. Do note that thin and cheap cables usually have thinner copper wires, which in turn accentuates power losses.</p>
<h3><span id="Additional_Troubleshooting"></span>Additional Troubleshooting</h3>
<p>Additional troubleshooting information may be found <a rel="nofollow" href="https://elinux.org/R-Pi_Troubleshooting">at elinux.org</a>.
</p>
<hr><ol>
<li id="cite_note-1"><span><a href="#cite_ref-1">↑</a></span> <span><a rel="nofollow" href="https://logs.nix.samueldr.com/nixos/2017-12-20#1513784657-1513784714">https://logs.nix.samueldr.com/nixos/2017-12-20#1513784657-1513784714</a>;</span>
</li>
<li id="cite_note-2"><span><a href="#cite_ref-2">↑</a></span> <span><a rel="nofollow" href="https://www.raspberrypi.org/documentation/configuration/config-txt/README.md">https://www.raspberrypi.org/documentation/configuration/config-txt/README.md</a></span>
</li>
</ol>

<!-- 
NewPP limit report
Cached time: 20201118204625
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.016 seconds
Real time usage: 0.019 seconds
Preprocessor visited node count: 144/1000000
Preprocessor generated node count: 456/1000000
Post‐expand include size: 1767/2097152 bytes
Template argument size: 866/2097152 bytes
Highest expansion depth: 6/40
Expensive parser function count: 0/100
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    6.785      1 -total
 26.47%    1.796      1 Template:Note
 17.97%    1.219      1 Template:File
 17.95%    1.218      1 Template:META_Box_Blue
 10.17%    0.690      1 Template:META_Box
  8.31%    0.564      1 Template:ARM/breadcrumb
-->

<!-- Saved in parser cache with key nixoswiki-nixos:pcache:idhash:290-0!*!0!!en!5!* and timestamp 20201118204625 and revision id 4737
 -->
</div></div>]]>
            </description>
            <link>https://nixos.wiki/wiki/NixOS_on_ARM/Raspberry_Pi</link>
            <guid isPermaLink="false">hacker-news-small-sites-25538764</guid>
            <pubDate>Fri, 25 Dec 2020 20:22:54 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Show HN: Mountain Peaks in WebGL]]>
            </title>
            <description>
<![CDATA[
Score 259 | Comments 37 (<a href="https://news.ycombinator.com/item?id=25537377">thread link</a>) | @pheelicks
<br/>
December 25, 2020 | https://felixpalmer.github.io/peaks-of-austria/ | <a href="https://web.archive.org/web/*/https://felixpalmer.github.io/peaks-of-austria/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/>Unable to extract article]]>
            </description>
            <link>https://felixpalmer.github.io/peaks-of-austria/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25537377</guid>
            <pubDate>Fri, 25 Dec 2020 16:37:30 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Switching from Apple to Lenovo]]>
            </title>
            <description>
<![CDATA[
Score 84 | Comments 73 (<a href="https://news.ycombinator.com/item?id=25536216">thread link</a>) | @ynv
<br/>
December 25, 2020 | https://ayedo.github.io/hardware/2020/12/25/switching-from-apple-to-lenovo.html | <a href="https://web.archive.org/web/*/https://ayedo.github.io/hardware/2020/12/25/switching-from-apple-to-lenovo.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
<p>Some of my friends have been telling me that Windows machines got a lot better. I decided to give it a try, and bought a top of the line Lenovo X1 Carbon Gen 8. For all of you thinking about doing the same switch, you might want to read this first.</p>

<p>Even though Apple is known for overpricing, and taking advantage of their customer base, they do it in a larger scheme of things, and do not engage in business practices which have a low customer experience. Unfortunately, you can’t say the same about the Lenovo universe.</p>

<p>Just go to their <a href="https://www.lenovo.com/">website</a> for a minute. Try to figure out which Laptop to buy, without getting the feeling you are being scammed. Everything seems to be on sale all the time, there are laptops of different generations of the same product line being advertised to you. They lie to your face about the battery life-times. People who are buying these machines got used to this experience, and are proud of being able to navigate such websites. You really need to do your homework before buying anything.</p>

<p>For example: I bought the X1 with their standard FHD screen, and it feels older than my 7 years old MBP. When trying to figure out why, I found out that Lenovo has a “<a href="https://www.notebookcheck.net/Lenovo-s-Panel-Lottery-continues-with-3-different-14-inch-LowPower-displays.426538.0.html">panel lottery</a>”: They use different suppliers with remarkable quality differences for their displays. Which one you get is just based on luck. Turns out the panel I got is the same they use for their cheapest product line. This means I have a ghosting mouse pointer on a $2000 brand new machine. Nice.</p>

<p>Even if you are lucky with the screen: it does not come color calibrated out of the box! Good luck trying to find the correct color profile, unless you want to spend money on a calibration tool you’re only going to use once.
Then comes Windows:</p>

<p>Yeah, it got better, but wow, do they carry a lot of baggage around. When trying to calibrate the display I found out that Windows has no less than three different system configuration UIs, which are also intertwined in unexpected ways. On top of that Lenovo installed their own buggy configuration tool. Configuring Windows feels like walking on ice. Even with all this configuration might, it still was not possible to get the exact serial number of my display panel without installing a third party tool.</p>

<p>Microsoft is also constantly nagging you about something that marginally helps their bottom line, but costs you a lot of your user experience. Like their constant push to trick people into giving them their data, or the fact that they try to force you to use their browser whenever they can.</p>

<p>I’m still not sure if I ticked the right boxes so that Microsoft does not get my browsing behaviour. I feel stressed every time Microsoft wants something from me. How are they trying to scam me this time?</p>

<p>For me this reinforces my belief that people who like Windows are simply used to it, because they need it for work or playing games. There is no point arguing with this, as their added value is their own experience, and the fact they know the tools and tricks to make the system usable to them.</p>

<p>One friend even told me that one of his favourite improvements in newer Windows versions is that they made it a lot easier to completely reset the operation system. My Apple machine has never been reset since I bought it almost a decade ago, and works flawlessly.  His statement seems like a subtle warning as to what is expecting me in the near future using my new  machine.</p>

</div></div>]]>
            </description>
            <link>https://ayedo.github.io/hardware/2020/12/25/switching-from-apple-to-lenovo.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-25536216</guid>
            <pubDate>Fri, 25 Dec 2020 13:01:37 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Some Differences Between macOS and Common Unix Systems]]>
            </title>
            <description>
<![CDATA[
Score 160 | Comments 65 (<a href="https://news.ycombinator.com/item?id=25535971">thread link</a>) | @dongyx
<br/>
December 25, 2020 | https://www.dyx.name/posts/macunix.html | <a href="https://web.archive.org/web/*/https://www.dyx.name/posts/macunix.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><p>Discuss some differences between macOS and common Unix systems to help Unix users get familiar with macOS sooner.</p><div>
				
<h2 id="users-and-groups">Users and Groups</h2>

<p>macOS manages users and groups by directory services instead of <code>/etc/passwd</code> and  <code>/etc/group</code>.  Consider a local network, for example, the one in your office, there’re many computers in the network and each has its own files, accounts, etc. A directory service organizes these distributed resources into one single index and makes them look like a directory hierarchy.</p>

<p>For example, <code>/Hosts/PC1</code> represents a host in the network and <code>/Users/Smith</code> represents a user in the network.<sup id="fnref:1" role="doc-noteref"><a href="#fn:1">1</a></sup></p>

<p>macOS uses the <code>dscl</code> command to interact with directory services.</p>

<p>To list all users on the system, we could run the following.</p>



<p>The first argument sets which datasource we want to retrieve from. A dot means the local datasource.</p>

<div><div><pre><code># List groups
dscl . -list /Groups
</code></pre></div></div>

<p>The <code>-list</code> option lets <code>dscl</code> print subitems of a resource.  Subitems of <code>/Users</code> are all users. Subitems of <code>/Groups</code> are all groups.</p>

<p>If we want to check the information about the resource instead of listing subitems we should use <code>-read</code>. For example, we could check the information of the user <code>Smith</code> like
the following.</p>

<div><div><pre><code># Retrieve the information of Smith
dscl . -read /Users/Smith
</code></pre></div></div>

<p><code>-read</code> prints keys and values of the specified resource. We could also specify the keys we want.</p>

<div><div><pre><code># Get the primary group ID and default shell of Smith
dscl . -read /Users/Smith PrimaryGroupID UserShell
</code></pre></div></div>

<p>To add a resource, we use <code>dscl . -create</code>. The following command adds a new user <code>belson</code>.</p>

<div><div><pre><code>sudo dscl . -create /Users/belson
</code></pre></div></div>

<p>It seems ok but it’s actually not. If we try to set a password for <code>belson</code> using <code>sudo passwd belson</code>, <code>passwd</code> will tell us the user doesn’t exist. Because <code>dscl</code> just adds a record to the data source but is doesn’t check the integrity. It doesn’t even assign a UID for <code>belson</code>. We must assign a UID and a primary group for <code>belson</code> after adding it to the datasource by ourselves.</p>

<div><div><pre><code>sudo dscl . -create /Users/belson UniqueID 511	# UID 511 for example
sudo dscl . -create /Users/belson PrimaryGroupID 20	# The staff group
</code></pre></div></div>

<p>Now, <code>belson</code> is a Unix user and you can set a password for him using <code>passwd</code>. However, you still can’t login as <code>belson</code> for we don’t assign him a shell.</p>

<div><div><pre><code>sudo dscl . -create /Users/belson UserShell /bin/bash
</code></pre></div></div>

<p>Well we can login as <code>belson</code> now but he doesn’t have a home directory. We must create the directory and specify it with <code>dscl</code>.</p>

<div><div><pre><code>sudo dscl . -create /Users/belson NFSHomeDirectory /Users/belson
sudo mkdir /User/belson
sudo chmod -R belson:staff /User/belson
</code></pre></div></div>

<p>Sounds hell right? But it’s not over. Run <code>dscl . -read /Groups/staff</code> and you will find that
neither the <code>GroupMembers</code> nor the <code>GroupMembership</code> attribute has any information about <code>belson</code>.  We have specified his primary group to <code>staff</code>. But as mentioned above, <code>dscl</code> doesn’t check the integrity. Bidirectional relationships must be maintained manually. This is the real hell.</p>

<p>To solve the user-group relationship problem, we could use <code>dseditgroup</code>. The following command adds <code>belson</code> to the <code>staff</code> group and it takes care of the integrity.<sup id="fnref:2" role="doc-noteref"><a href="#fn:2">2</a></sup></p>

<div><div><pre><code>sudo dseditgroup -o edit -a belson -t user staff
</code></pre></div></div>

<p>We should make a summary here. To create a user <code>belson</code> in the group <code>staff</code>, we need:</p>

<div><div><pre><code>sudo dscl . -create /Users/belson
sudo dscl . -create /Users/belson UniqueID 511	# UID 511 for example
sudo dscl . -create /Users/belson PrimaryGroupID 20	# The staff group
sudo dscl . -create /Users/belson UserShell /bin/bash
sudo dscl . -create /Users/belson NFSHomeDirectory /Users/belson
sudo dseditgroup -o edit -a belson -t user staff
sudo mkdir /User/belson
sudo chmod -R belson:staff /User/belson
</code></pre></div></div>

<p>It is painful for a system administrator to type so many commands just to create a new user. You must miss <code>adduser</code> and <code>addgroup</code> in Debian so much.</p>

<p>Luckily, since Mac OS X 10.10, the <code>sysadminctl</code> command is provided. It’s a high-level interface of <code>dscl</code>. Type <code>sysadminctl</code> in the terminal to see its usage<sup id="fnref:3" role="doc-noteref"><a href="#fn:3">3</a></sup>.</p>

<div><div><pre><code>Usage: sysadminctl
	-deleteUser &lt;user name&gt; [-secure || -keepHome] (interactive || -adminUser &lt;administrator user name&gt; -adminPassword &lt;administrator password&gt;)
	-newPassword &lt;new password&gt; -oldPassword &lt;old password&gt; [-passwordHint &lt;password hint&gt;]
	-resetPasswordFor &lt;local user name&gt; -newPassword &lt;new password&gt; [-passwordHint &lt;password hint&gt;] (interactive] || -adminUser &lt;administrator user name&gt; -adminPassword &lt;administrator password&gt;)
	-addUser &lt;user name&gt; [-fullName &lt;full name&gt;] [-UID &lt;user ID&gt;] [-shell &lt;path to shell&gt;] [-password &lt;user password&gt;] [-hint &lt;user hint&gt;] [-home &lt;full path to home&gt;] [-admin] [-picture &lt;full path to user image&gt;] (interactive] || -adminUser &lt;administrator user name&gt; -adminPassword &lt;administrator password&gt;)
	-secureTokenStatus &lt;user name&gt;
	-secureTokenOn &lt;user name&gt; -password &lt;password&gt; (interactive || -adminUser &lt;administrator user name&gt; -adminPassword &lt;administrator password&gt;)
	-secureTokenOff &lt;user name&gt; -password &lt;password&gt; (interactive || -adminUser &lt;administrator user name&gt; -adminPassword &lt;administrator password&gt;)
	-guestAccount &lt;on || off || status&gt;
	-afpGuestAccess &lt;on || off || status&gt;
	-smbGuestAccess &lt;on || off || status&gt;
	-automaticTime &lt;on || off || status&gt;
	-filesystem status
	-screenLock &lt;immediate || off&gt; -password &lt;password&gt;

Pass '-' instead of password in commands above to request prompt.
'-adminPassword' used mostly for scripted operation. Use '-' or 'interactive' to get the authentication string interactivly. This preferred for security reasons
</code></pre></div></div>

<p>We use <code>sysadminctl</code> to delete <code>belson</code> first.</p>

<div><div><pre><code>sudo sysadminctl -deleteUser belson -secure
</code></pre></div></div>

<p>Using <code>dscl</code> to check the directory service, we could find that everything we did is removed.</p>

<p>Now, we add <code>belson</code> again with <code>sysadminctl</code>:</p>

<div><div><pre><code>sudo sysadminctl -addUser belson
sudo dseditgroup -o edit -a belson -t user staff
</code></pre></div></div>

<p>Two commands finish the job.</p>

<h2 id="filesystem-hierarchy">Filesystem Hierarchy</h2>

<p>If you check the root directory, you will see some traditional Unix things like <code>/usr</code>, <code>/var</code>, and <code>/etc</code>. You may also find mac-specified things like <code>/Library</code> <code>/Applications</code>, and <code>/cores</code>.</p>

<p>A list of mac-specified directories with their purposes in the root directory is here<sup id="fnref:4" role="doc-noteref"><a href="#fn:4">4</a></sup>.</p>

<table>
  <thead>
    <tr>
      <th>Directory</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>/private</td>
      <td>Contains the tmp, var, etc, directories. <code>/tmp</code>, <code>/var</code>, <code>/etc</code> are symbolic links to these subdirectories</td>
    </tr>
    <tr>
      <td>/Library</td>
      <td>Contains support files for locally installed applications, among other things.</td>
    </tr>
    <tr>
      <td>/System</td>
      <td>Contains a subdirectory, Library, that holds support files for the system and system applications, among other things.</td>
    </tr>
    <tr>
      <td>/Network</td>
      <td>Contains network-mounted Application, Library, and Users directories, as well as a Servers directory that contains directories mounted by the auto mount daemon.</td>
    </tr>
    <tr>
      <td>/Users</td>
      <td>Contains home directories for the users on the system. The root user’s home directory is /var/root (actually /private/var/root).</td>
    </tr>
    <tr>
      <td>/Volumes</td>
      <td>Contains all visible mounted filesystems, including removable media and mounted disk images.</td>
    </tr>
  </tbody>
</table>

<p>We could make a list to compare some of them with Linux.</p>

<table>
  <thead>
    <tr>
      <th>macOS</th>
      <th>Linux</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>/System/Library</td>
      <td>/lib</td>
    </tr>
    <tr>
      <td>/Library</td>
      <td>/usr/lib, /usr/local/lib</td>
    </tr>
    <tr>
      <td>/Users</td>
      <td>/home</td>
    </tr>
    <tr>
      <td>/Volumes</td>
      <td>/mnt, /media</td>
    </tr>
  </tbody>
</table>

<p>You may be confused here for the difference between <code>/Library</code> and <code>/usr/lib</code>. Which directory should we put libraries into?</p>

<p><code>/Library</code> is for macOS-specified softwares, like the data of things you download from the App Store, and BSD programs shipped with macOS, like modules of pre-installed Perl and of pre-installed Python.</p>

<p><code>/usr/lib</code> and <code>/usr/local/lib</code> are for Unix programs installed by yourself.</p>

<h2 id="booting">Booting</h2>

<p>In modern Linux, the first program launched by the kernel is <code>systemd</code>. In macOS it’s <code>launchd</code><sup id="fnref:5" role="doc-noteref"><a href="#fn:5">5</a></sup>.</p>

<p><code>launchd</code> manages two types of services, <code>LaunchDaemon</code> and <code>LaunchAgent</code>. <code>LaunchDaemon</code> will be launched after the system is booted. <code>LaunchAgent</code> will be launched after a user is logged-in.</p>

<p>If a program needs to be launched after the system is booted, a <code>.plist</code> file is required to be placed into <code>/Library/LaunchDaemons</code> or <code>/System/LaunchDaemons</code>.</p>

<p>If a program needs to be launched after a user logged-in, a <code>.plist</code> file is required to be placed into <code>/Library/LaunchAgents</code> or <code>/System/LaunchAgents</code>, or <code>~/Library/LaunchAgents</code> of the user.</p>

<p>The <code>launchctl</code> command is used to control services of <code>launchd</code>.</p>

<div><div><pre><code># to enable sshd
sudo launchctl load -w /System/Library/LaunchDaemons/ssh.plist

# to disable sshd
sudo launchctl unload -w /System/Library/LaunchDaemons/ssh.plist
</code></pre></div></div>

<h2 id="development">Development</h2>

<p>You bought a Mac for development. People told you that you need to do the following two things:</p>

<ul>
  <li>
    <p>Install Xcode from the app store</p>
  </li>
  <li>
    <p>Install command line tools using <code>xcode-select --install</code></p>
  </li>
</ul>

<p>You finished them, opened the terminal and found everything is familiar. You decided to write a classic Hello World with C to celebrate.</p>

<div><div><pre><code>#include &lt;stdio.h&gt;

int main(void)
{
	printf("%s\n", "hello, world");
	return 0;
}
</code></pre></div></div>

<p>If you’re using a 3rd party compiler, the compiler may tell you that <code>stdio.h</code> can’t be found.</p>

<p>No such fundamental file? You want to check <code>/usr/include</code> and you will find that even <code>/usr/include</code> doesn’t exist.</p>

<p>The reason is that header files are put into the package of Xcode in newer Xcode like Xcode 10. You can run <code>xcrun --show-sdk-path</code> to print the path<sup id="fnref:6" role="doc-noteref"><a href="#fn:6">6</a></sup>.</p>

<div><div><pre><code>$ xcrun --show-sdk-path
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
</code></pre></div></div>

<p>Then you can use <code>-isysroot</code> to specify the path for the compiler, for example:</p>

<div><div><pre><code>gcc -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk hello.c
</code></pre></div></div>

<h2 id="package-manager">Package Manager</h2>

<p>The first package installed to the system is usually a package manager. However, macOS has no default package manager. If you search online, you will find that <a href="https://brew.sh/">Homebrew</a> is the most popular package manager for macOS.</p>

<p>Homebrew is good for many people but not for one who wants things to go more like common Unix systems.</p>

<p>Homebrew can’t run as root. If you want to install python, you run <code>brew install python</code> instead of <code>sudo brew install python</code>. Homebrew installs packages to <code>/usr/local</code>. To achieve its goal about sudo-free, Homebrew changes the owner of all files and subdirectories under <code>/usr/local</code> to the user who installed Homebrew.</p>

<p>This brings security issues. Considering a malware …</p></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://www.dyx.name/posts/macunix.html">https://www.dyx.name/posts/macunix.html</a></em></p>]]>
            </description>
            <link>https://www.dyx.name/posts/macunix.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-25535971</guid>
            <pubDate>Fri, 25 Dec 2020 12:00:20 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Planner 2.6 – An open-source Todoist alternative for Linux]]>
            </title>
            <description>
<![CDATA[
Score 230 | Comments 42 (<a href="https://news.ycombinator.com/item?id=25535822">thread link</a>) | @rayrag
<br/>
December 25, 2020 | https://useplanner.com/release/2020/12/24/merry-christmas-everyone-planner-2-6-is-here/ | <a href="https://web.archive.org/web/*/https://useplanner.com/release/2020/12/24/merry-christmas-everyone-planner-2-6-is-here/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
		<h2 id="board-view-is-here">Board View is here</h2>

<p>For Todoist users, the Board View was introduced in this new update, a more visual way to organize your Planner projects. This new layout makes it easy to see the big picture of your projects and make progress from start to finish.</p>

<p><img src="https://useplanner.com/images/blogs/2020-12-24-merry-christmas-everyone-planner-2-6-is-here/board.png" alt="Planner 2.6 Planner Board"></p>

<p>To see your projects in the <b>Board View</b>, press the three dots icon in the top right, and select <b>View as board</b>. You’ll be able to rearrange your sections, create new ones, and drag your tasks to anywhere on your board.</p>

<p><img src="https://useplanner.com/images/blogs/2020-12-24-merry-christmas-everyone-planner-2-6-is-here/board-settings.png" alt="Planner 2.6 Planner Board 2"></p>

<h2 id="sub-project">Sub-project</h2>
<p>One of the most requested features comes to Planner 2.6, keep your ever-growing project list neat and organized with sub-projects.</p>

<p>You can collapse sub-projects under their “parent” projects to temporarily hide them from view. This helps to focus on the right projects at the right time, without getting distracted by everything else.</p>

<p><img src="https://useplanner.com/images/blogs/2020-12-24-merry-christmas-everyone-planner-2-6-is-here/sub-project.png" alt="Planner 2.6 Planner Board 2"></p>

<h3 id="how-to-turn-a-project-into-a-sub-project">How to turn a project into a sub-project</h3>

<ol>
  <li>Right click on a project.</li>
  <li>Select the <b>Move</b> option.</li>
  <li>Select a project.</li>
</ol>

<h2 id="new-features">New Features</h2>
<h3 id="quick-search">Quick Search</h3>

<p>A big update for the Quick Find feature is here, with new views and feactures.</p>

<p><img src="https://useplanner.com/images/blogs/2020-12-24-merry-christmas-everyone-planner-2-6-is-here/Quick%20Search.png" alt="Planner 2.6 Planner Board 2"></p>

<ul>
  <li>Quick Search now saves your last searches, so you can hop around without even typing.</li>
  <li>Added new <b>Tomorrow</b> view.</li>
  <li>Now it is possible to search between <b>Sections</b></li>
</ul>

<h3 id="task-defaults">Task defaults</h3>

<p>Added a new view in <b>Preferences</b> to edit task defaults.</p>

<p><img src="https://useplanner.com/images/blogs/2020-12-24-merry-christmas-everyone-planner-2-6-is-here/tasks-defaults.png" alt="Planner 2.6 Planner Board 2"></p>

<ul>
  <li>New tasks on top: Indicate the position where the new tasks were created.</li>
  <li>Underline completed tasks.</li>
  <li>Default priority: Select the default priority when creating a task.</li>
</ul>

<h3 id="add-tasks-projects-sections-asynchronously">Add tasks, projects, sections asynchronously</h3>

<p>Adding a task, project or section is a quick process but sometimes this process stops or does not respond mainly to problems with the internet connection. Planner 2.6 creates the tasks asynchronously with the possibility of being able to cancel the process at any time.</p>

<p><img src="https://useplanner.com/images/blogs/2020-12-24-merry-christmas-everyone-planner-2-6-is-here/AsyncTask.gif" alt="Planner 2.6 Planner Board 2"></p>

<h3 id="filter-your-projects-by-labels">Filter your projects by labels</h3>
<p>It is now possible to filter the tasks within a project by labels.</p>

<p><img src="https://useplanner.com/images/blogs/2020-12-24-merry-christmas-everyone-planner-2-6-is-here/filter-labels.gif" alt="Planner 2.6 Planner Board 2"></p>


<p>Labels have been added in the sidebar to make the use of filter by labels much faster.</p>

<p><img src="https://useplanner.com/images/blogs/2020-12-24-merry-christmas-everyone-planner-2-6-is-here/label-sidebar.png" alt="Planner 2.6 Planner Board 2"></p>

<h3 id="more-customization">More customization</h3>

<p>It is now possible to sort the position <b>Inbox</b>, <b>Today</b> and <b>Upcoming</b> by 
Drag &amp; Drop.</p>

<p><img src="https://useplanner.com/images/blogs/2020-12-24-merry-christmas-everyone-planner-2-6-is-here/ActionMoved.png" alt="Planner 2.6 Planner Board 2"></p>

<h3 id="code-cleanup--performance-improvement">Code cleanup &amp; performance improvement</h3>
<p>A giant code cleanup was done and resource usage was improved. Now Planner is faster and works much better.</p>

<p>Planner 2.6 is available for download now on <a href="https://appcenter.elementary.io/com.github.alainm23.planner/">AppCenter</a> and <a href="https://flathub.org/apps/details/com.github.alainm23.planner">Flathub</a>. We hope you’ll enjoy these improvements.</p>

<p>Planner is being developed with ❤️ and passion for Open Source. However, if you like Planner and want to support its development, consider donating to via:</p>
<ul>
  <li><a href="https://www.patreon.com/alainm23">Patreon</a></li>
  <li><a href="https://www.paypal.me/alainm23">PayPal</a></li>
</ul>



		<!-- <div class="author">
			
			
			<div class="square-image"><img src="https://avatars0.githubusercontent.com/u/33765137?v=4
" alt="Alain"/></div>
			<p class="blurb">Alain likes to discover and create new things.</p>
		</div> -->

		

		
			
			
			
		
	</div></div>]]>
            </description>
            <link>https://useplanner.com/release/2020/12/24/merry-christmas-everyone-planner-2-6-is-here/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25535822</guid>
            <pubDate>Fri, 25 Dec 2020 11:19:22 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Trading Time for Money]]>
            </title>
            <description>
<![CDATA[
Score 102 | Comments 33 (<a href="https://news.ycombinator.com/item?id=25535366">thread link</a>) | @nicbou
<br/>
December 25, 2020 | https://nicolasbouliane.com/blog/trading-time-for-money | <a href="https://web.archive.org/web/*/https://nicolasbouliane.com/blog/trading-time-for-money">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
                            <div>
        <article>
            <p>
                Posted on <time datetime="2020-12-24 09:53:00">December 24, 2020</time>
            </p>
                        <p>According to conventional wisdom, if you earn 31€/hour, and a task costs less than that to outsource, then you should always pay someone else to do it. For example, if your cleaning person charges 15€/hour, you save 16€ for every hour you spend at work instead of cleaning your house.</p>
<p>I've encountered this advice quite often, particularly among the wealthier, productivity porn-loving, <em>4-Hour Work Week</em>-thumping entrepreneur crowd.<br></p>
<p>I don't think that advice is quite right.</p>
<h2>Your time is worth less than you think</h2>
<p>There is a hefty tax on converting time to money. In Germany, if you earned the average income (42 421€ per year)<sup><a href="https://www.statista.com/statistics/416207/average-annual-wages-germany-y-on-y-in-euros/">1</a></sup>, you'd lose roughly a quarter of it to income tax<sup><a href="http://www.parmentier.de/steuer/index.php?site=einkommensteuerrechnerjava">1</a></sup>. Your 31€/hour salary<sup><a href="https://www.statista.com/statistics/416207/average-annual-wages-germany-y-on-y-in-euros/">1</a>, <a href="https://clockify.me/working-hours">2</a></sup> is actually worth 24€/hour after taxes.</p>
<p>But there is more to account for: health insurance (7.3%), unemployment insurance (1.25%), public pension (9.3%) and nursing care insurance (1.775%)<sup><a href="http://www.parmentier.de/steuer/index.php?site=lohnsteuerrechnerjava">1</a></sup> are also deducted from your salary. When it's all said and done, you take home about 20€/hour. If you also pay church tax and get the most expensive health insurance, you keep 19€/hour.</p>
<p>So again, if you earn the average 31€/hour, and work the average 1386 hours per year, you save about 4€ per hour - not 16€ - by hiring a cleaning person who charges half your rate.</p>
<p>Taxes aren't the only thing that whittle away your disposable income. You also have some unavoidable expenses, namely rent, groceries and utilities. That's 550€, 150€ and 100€ per month for a single, thrifty Berliner. That's 35% of your take-home salary, so you're left with 12.50€/hour in disposable income. At this point, I'm including decimals, because they start to matter.</p>
<p>In other words, you must sell 72 minutes of your life to buy 60 minutes of your cleaning person's life, even though you earn twice as much.</p>
<p>Here's a recap for the mathematically inclined:</p>
<pre>hourly_disposable income = (
    (gross_income - income_tax)
    - health_insurance
    - unemployment_insurance
    - pension_insurance
    - nursing_care_insurance
    - (rent + groceries + utilities) * 12
) / hours_worked_per_year</pre>
<p>Keep in mind that this describes the reality in Germany, where people work much less, but pay higher taxes. You will get wildly different results in your own country.</p>
<h2>Outsourcing costs more than you think</h2>
<p>Eating out is often used as an example of trading money for time. It's faster than cooking your own food: no shopping, no cooking, no cleaning.<br></p>
<p>In Berlin, you can get a square meal for 10€. A croissant, a coffee and two square meals would set you back 20€ a day. By comparison, my grocery bill is 5€ a day. That's a 450€/month difference, or 37.5 hours of your time (see above), but you'd probably spend that much time between the supermarket and the kitchen anyway.<br></p>
<p>However, getting to&nbsp;the restaurant, ordering, waiting for your food, then waiting for the bill takes time too. Personally, I&nbsp;find cooking every other day more convenient  than eating out twice a day. Eating out only makes sense when I'm too tired to cook.<br></p>
<p>This also applies to hiring professionals. You still need time to find one and to work with their schedule. I can change the oil or the brakes on my motorcycle in about 30 minutes. It takes me about as long to drop my bike off at the dealership, but I&nbsp;have to do it during office hours, and wait a few days to get it back.<br></p>
<p>In short, outsourcing your work does not always make life easier. It can lighten your mental load, but so does working less by having lower expenses.<br> </p>
<h2>Time is not a liquid asset</h2>
<p>In practice, you don't get to choose how much of your time you sell.&nbsp;If your expenses are covered, you just can't stop going to work. If you need more money, you could work more, but rarely on your own terms, just when you need to. You couldn't sell an extra 2 hours of programming on a Thursday night, because you have nothing else going on.&nbsp; There's also a limit on how much time you can sustainably sell, regardless of demand - about 60 hours a week.<br></p>
<p>You can't choose which time you sell either. Most employers will only buy your office hours. You can't decide to work night shifts, or to work 80 hour weeks in the winter, then take the summer off. You can't even decide where to allocate the time you <em>didn't</em> sell. Your employer usually decides when you take your lunch breaks, and when you can use your holidays. If you're on call, even your free time isn't quite yours.</p>
<p>In other words, you don't really trade more time at the office for less time cleaning your house. You're stuck at the office for 40 hours a week regardless, so you're just using some of your fixed budget. However, if you <em>don't</em> hire a cleaning person, and you don't spend your money, then you can buy some&nbsp;of your time back later, either as a gap year, or as an early retirement.</p>
<p>As a freelancer, you have much more control over what time you sell, and in which amount. Nonetheless, you are still bound to standard contract lengths, to the limits of your body, and to cyclical demand in your industry. A freelance accountant likely won't take time off during tax season. A freelance developer will mostly find 3 to 6 month contracts.<br></p>
<p>Put shortly, time is not a liquid asset. You can't easily  sell more or less of it according to your needs.</p>
<h2>Time does not have a fixed value</h2>
<p>Let's pretend that your boss lets you work for as long as you need, whenever you need to. You could spend an extra hour at the office, and pay someone to save you an hour of cleaning.</p>
<p>I'd make that deal. Swearing at my computer brings me joy, but doing the dishes doesn't. I'd gladly trade a few hours of programming for a few hours of cleaning.</p>
<figure><img src="https://nicolasbouliane.com/images/_fullWidth2x/good-time.jpg" alt=""><figcaption>My definition of a good time</figcaption></figure>
<p>After 30 hours a week, I'd start to value my time at the office a bit more. I'd rather spend that time at home, sipping a beer on my balcony with a pie in the oven, so I&nbsp;wouldn't be so keen to sell it.</p>
<p>After 50 hours, I'd be selling my time at a much higher price. There's a point where work takes a toll on your body, and seeps into other aspects of your life.&nbsp;By then, menial work feels like a release, rather than a chore.</p>
<p>Unless you&nbsp;<em>really</em> like your job, there comes a point where you'd rather do something else, even if has a lower market value than your profession.<br></p>
<h2>The hidden benefits of doing it yourself</h2>
<p>The most understated benefit of doing things yourself is the skills and the tools you acquire along the way. Your cooking gets better and more diversified with every meal you cook. Bike repairs get cheaper and easier with every attempt. Those skills stay with you, and over time, the benefits compound. You can tackle bigger and bigger projects, and the results look better and better.</p>
<figure><img src="https://nicolasbouliane.com/images/_fullWidth2x/level-up.jpg" alt=""></figure>
<p>Outsourcing, on the other hand, doesn't get better and cheaper. It either gets better and more expensive, or cheaper and worse. This ties your quality of life to a single variable: your income. Your lifestyle is much more reliant on your ability to stay employed, because it's the only thing you can do.<br></p>
<p>Beyond that, doing things yourself is immensely rewarding. Wrenching on your own motorcycle feels good. Delighting your guests with a home-cooked meal feels good. Using shelves you built yourself feels good. These are direct products of your hard work, and symbols of the control you have over your environment.</p>
<p>I'd also argue that it gives you a greater appreciation for the world you live in. It allows you to see things beyond the surface. Musicians appreciate music on a different level,
 and the same can be said for gardeners, machinists, architects and 
every other kind of enthusiast. My fledgling interest in gardening quite literally made me see the forest for the trees.<br></p>
<p>Paying someone else to do it robs you of this joy. Climbing through the career ladder provides its own rewards, but those always felt too abstract to me. If I  indirectly make my company a little leaner, I&nbsp;get 4% more disposable income. Big whoop.</p>
<h2>Caveats</h2>
<p>Some tasks don't develop useful skills. They don't get easier, cheaper or more enjoyable with time. Chores are chores, and some work is just plain tedious. No matter how good I&nbsp;get at painting walls, I still hate it with a passion.&nbsp;My father fixed cars his entire life, and he won't change his oil in the winter, when the car is caked in&nbsp;slush.</p>
<p>Life is short, and the 40 hour work week isn't going anywhere, so it's okay to spare your free time for things you enjoy. That's worth paying a premium for.</p>
<p>Even if you enjoy doing something, the timing isn't always right.&nbsp;I found that my motorcycle's front rim was bent just before leaving for a 3 month trip. I already had a lot on my plate with work and trip preparations, so I paid a mechanic to do it. Outsourcing lets you solve multiple problems in parallel.</p>
<p>In some cases, the upfront cost of doing things yourself is just too high. I won't resurface my motorcycle's cylinder head at home, because the tools cost more than my net worth, and highly trained machinists will do it for 100€.&nbsp;Sometimes, it's better to let economies of scale do their thing.</p>
<p>In other cases, the running costs are too high. All those things you maintain will chip away at your free time. In aggregate, they can swallow your evenings. For example, think twice about running your own server to save a few euros per month. These needy buggers tend to require your attention at the most inopportune times. Outsourcing means someone else is taking care of it, and invoicing you once a month.</p>
<p>Sometimes, the risk isn't worth the potential savings. It's important to learn how to do things yourself, but don't bite off more than you can chew. Don't cause hundreds of euros worth of damage to save a few euros. Hire a professional, and let them do their job.&nbsp;If they cock up, <em>they</em> are liable to fix the mess, not you.</p>
<h2>Conclusion</h2>
<p>Yes, outsourcing has its time and place, but it's more expensive than it appears. Sometimes, it's better to do things yourself, and acquire useful skills …</p></article></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://nicolasbouliane.com/blog/trading-time-for-money">https://nicolasbouliane.com/blog/trading-time-for-money</a></em></p>]]>
            </description>
            <link>https://nicolasbouliane.com/blog/trading-time-for-money</link>
            <guid isPermaLink="false">hacker-news-small-sites-25535366</guid>
            <pubDate>Fri, 25 Dec 2020 09:30:04 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[The impact of Apple Silicon Macs on Broadway]]>
            </title>
            <description>
<![CDATA[
Score 234 | Comments 271 (<a href="https://news.ycombinator.com/item?id=25534863">thread link</a>) | @da02
<br/>
December 24, 2020 | https://brianli.com/2020/12/the-impact-of-apple-silicon-macs-on-broadway/ | <a href="https://web.archive.org/web/*/https://brianli.com/2020/12/the-impact-of-apple-silicon-macs-on-broadway/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="container"><main><article role="article"><div><p>In a previous life, I was an electronic music designer working on Broadway shows in New York City. Broadway shows look glamorous and expensive on the outside, but it’s often quite the opposite on the inside –&nbsp;at least for the music department. One of the toughest parts of my job as an electronic music designer was to find the best performance-to-cost ratio for computer rigs powering keyboards, guitars, playback tracks, and more.</p><p>Over the past decade, Broadway has replaced large sections of traditional orchestras with synthesizers, playback systems, and electronic drum pads. I’m not in support of that, but that’s a story for another day. The point here is that Broadway’s reliance on computer-driven rigs has increased, while the typical budget required to build high-end stable rigs hasn’t increased at the same rate.</p><p>Some shows I’ve worked at set aside a $10,000-$12,000 budget for two keyboard rigs. That sounds like a lot of money at first, but it’s not. For live shows, it’s usually best to have a 1:1 backup in case the main rig fails. That fact alone means you have to design a rig that fits within 50% of the proposed budget. Furthermore, a high-quality keyboard controller alone is $1,500-2,000 –&nbsp;so that means there’s $3,000 left for a computer and everything else.</p><p>Due to budget constraints, many shows end up using Mac minis. Historically speaking, the Mac mini’s computing power has been a bottleneck for electronic music designers on Broadway. In a perfect world, we’d all like to use the best-sounding sample libraries for our work, but that was never feasible with the Mac mini. Thus, the compromise was always to reduce sound quality to fit within the Mac mini’s compute constraints.</p><p>Apple Silicon changes everything for Broadway electronic music designers. The new M1 Mac mini is capable of running high-end sample libraries and virtual instruments in a stable manner, and it’s only going to get better with M2, M3, and M4-series chips in the future. The performance per dollar characteristics of Apple Silicon machines are going to have a huge impact on Broadway’s sound, and I’m very excited to see, or hear, what happens.</p></div></article></main></div></div>]]>
            </description>
            <link>https://brianli.com/2020/12/the-impact-of-apple-silicon-macs-on-broadway/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25534863</guid>
            <pubDate>Fri, 25 Dec 2020 07:14:23 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Fictional Videogame Stills]]>
            </title>
            <description>
<![CDATA[
Score 154 | Comments 36 (<a href="https://news.ycombinator.com/item?id=25530307">thread link</a>) | @doener
<br/>
December 24, 2020 | https://www.suzannetreister.net/Ampages/Amenu.html | <a href="https://web.archive.org/web/*/https://www.suzannetreister.net/Ampages/Amenu.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div> 
      <td colspan="4"> 
        <p><span size="2" face="Verdana, Arial, Helvetica, sans-serif"><b><span size="1" color="#99CC33">Suzanne 
          Treister<br>
          </span></b><span size="1" face="Verdana, Arial, Helvetica, sans-serif" color="#99CC33">1991-1992</span><span size="1" color="#99CC33"> 
          </span></span> </p>
        <p><span size="1" face="Verdana, Arial, Helvetica, sans-serif" color="#99CC33"><i><strong>Fictional 
          Videogame Stills</strong></i> </span></p>
        <p><span size="1" face="Verdana, Arial, Helvetica, sans-serif" color="#99CC33">In 
          the late 1980s I was making paintings about computer games. In January 1991 I bought an Amiga computer and made a series of fictional 
          videogame stills using Deluxe Paint II. I photographed them straight 
          from the screen as there was no other way to output them that I knew 
          of apart from through a very primitive daisy wheel printer where they appeared as washed out dots. <p>
          
          The effect of the photographs perfectly reproduced the highly 
          pixellated, raised needlepoint effect of the Amiga screen image. Conceptually 
          this means of presentation was also appropriate in that it made it seem 
          like I had gone into a videogame arcade and photographed the games there, 
          lending authenticity to the fiction.</p></span><span color="#99cc33" face="Verdana, Arial, Helvetica, sans-serif" size="1">The first seven works on this page form a series titled, 'Q. Would you recognise a Virtual Paradise?'</span><span size="1" face="Verdana, Arial, Helvetica, sans-serif" color="#99CC33"><p>
          
          Many of these works were shown in London at the Edward Totah Gallery in March 
        1992 (<a href="https://www.suzannetreister.net/Ampics/Installations/Totah-Installation1992/EdwardTotah_1992.html" target="_self">view installation</a>) and later that year</p></span><span color="#99cc33" face="Verdana, Arial, Helvetica, sans-serif" size="1"> at the Exeter Hotel in Adelaide, Australia.<br> 
        In 1995 the 'Q. Would you recognise a Virtual Paradise?' series was shown in London at the Royal Festival Hall in the exhibition<em> It's a Pleasure</em>, curated by Leah Kharibian.</span><span size="1" face="Verdana, Arial, Helvetica, sans-serif" color="#99CC33"><br>
        Recent venues: Somerset House, London, 2018 <a href="https://www.suzannetreister.net/Ampics/Installations/SomersetHouse2018/SomersetHouse2018.html" target="_self">view installation</a> ; Akron Art Museum, Ohio, USA 2019 and tour; Moderna Museet, Stockholm, Sweden, 2019/20 <a href="https://www.suzannetreister.net/InstallationV/Moderna-Museet_2019.html" target="_self">view installation</a><p>
          
          The original Amiga floppy disks which stored the image files are  corrupt, but the  photographic art works remain.</p></span><span size="1" face="Verdana, Arial, Helvetica, sans-serif" color="#99CC33"><p>
          
          For 
          more information <a href="https://www.suzannetreister.net/Ampages/Treister_Essay.pdf">download my essay</a> 
          from '<a href="http://www.intellectbooks.co.uk/ppbooks.php?isbn=9781841501420" target="_blank">Videogames 
            and Art</a>', Ed. Andy Clarke, Grethe Mitchell, Publ. Intellect Books, 
        UK 2007</p></span></p>
<p><span color="#996633" size="1" face="Verdana, Arial, Helvetica, sans-serif"> <a href="https://www.suzannetreister.net/Videography/Videogames_Video.html" target="_self">view video version</a><p>
            
          click 
  titles below to view enlargements of photo works</p></span></p></td>
    </div></div>]]>
            </description>
            <link>https://www.suzannetreister.net/Ampages/Amenu.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-25530307</guid>
            <pubDate>Thu, 24 Dec 2020 19:01:14 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Making a digital clock in Google Sheets]]>
            </title>
            <description>
<![CDATA[
Score 60 | Comments 11 (<a href="https://news.ycombinator.com/item?id=25529618">thread link</a>) | @DamnInteresting
<br/>
December 24, 2020 | https://www.therobinlord.com/making-a-digital-clock-in-google-sheets/ | <a href="https://web.archive.org/web/*/https://www.therobinlord.com/making-a-digital-clock-in-google-sheets/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article id="post-920">

<div>
<p>“This is cool, really cool, but I feel like maybe you need an intervention” – Friend’s reaction when I showed them this.</p>

<h2>What have I done?</h2>
<p>Using only Google Sheets formulas I’ve made a digital clock. It updates every minute, it’s a clock, that’s pretty much it.</p>
<h2>Why have I done it?</h2>
<p><strong>I’m a very strong believer in getting the most out of the tools available to us and this kind of rubbish is a great way to learn things which are </strong><em><strong>way</strong></em><strong> more useful elsewhere</strong>!</p>
<p>Without doing anything like custom functions in JavaScript – Google Sheets is <em>amazingly </em>flexible. I’ve used it to automate things like <a href="https://moz.com/blog/visualising-time-using-google-sheets">project management tasks</a> and even <a href="https://www.distilled.net/resources/screaming-frog-and-google-sheets/">website change detection using Screaming Frog</a>. </p>
<p>Google Sheets is also <em>really</em> accessible – if you make something in Google Sheets you can share it with colleagues and clients without them needing to install anything, without them needing an account, and without them being made nervous by any mention of code.</p>
<p>Languages like Python and JavaScript are great ways to get things done but it is fun to see what we can achieve with little ole Sheets.</p>
<h2>The sheet</h2>
<p>Access the <a href="https://docs.google.com/spreadsheets/d/1_EjJsdfzLL6LaTtJnTZ26BzHRHBDJy1paHeeZ87toT0/copy">Google Sheets digital clock here</a> if you want to have a play with it. I’ve set the link to automatically copy so you have your own version where you can see the formulas at work.</p>

<h2>How have I done it? (The important bit!)</h2>
<p>As I say – the value of these things is what we are able to learn. So let’s see what we’ve learned.</p>
<h3>1. Getting the current time – now()</h3>
<p><em>=now()</em> returns current date and time in this format: <strong><em>24/10/2020 23:24:00</em></strong></p>
<figure><picture><source srcset="https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.24.12.png.webp" type="image/webp"><img src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.24.12.png" alt="" data-src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.24.12.png" data-old-src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></picture></figure>
<p>We’ll put that in cell A1.</p>
<h3>2. Getting minutes and hours – hour() and minute()</h3>
<p><em>=hour(A1)</em> will give us the hour contained in a specific time. If we used hour() on the timestamp above we would get <em><strong>23</strong></em></p>
<p><em>=minute(A1)</em> gives us the minute. If we used minute() on the timestamp above we’d get <strong><em>24</em></strong></p>
<figure><picture><source srcset="https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.24.06.png.webp" type="image/webp"><img src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.24.06.png" alt="" data-src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.24.06.png" data-old-src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></picture></figure>
<h3>3. Splitting minutes and hours into individual digits – regexextract()</h3>
<p>=regexextract() lets us get part of the value out of a cell, but only as long as it’s used on text (digits can be interpreted as either numbers or text in Sheets). So <span>first</span> we use =text(hour(A1),”##”) – that takes the hour from the timestamp and turn it into text.</p>
<p>You may notice below that the hour and minute values are left-aligned rather than right-aligned. That’s one way to spot whether Sheets might be treating digits as a number or as text.</p>
<figure><picture><source srcset="https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.27.16.png.webp" type="image/webp"><img src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.27.16.png" alt="" data-src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.27.16.png" data-old-src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></picture></figure>
<p>Then we use =regexextract() to get the first number of the hour like so <em>=regexextract(text(HOUR(A1),”##”),”^\d”)</em>. Don’t worry too much about that RegEx, all it means is “the first digit”. If you want to learn more about RegEx – check out my <a href="https://www.therobinlord.com/projects/slash-escape">RegEx learning game – Slash Escape</a>.</p>
<p>We’ll extract the last number of the hour like this; <em>=regexextract(text(HOUR(A1),”##”),”\d$”)</em></p>
<p>Then we do the same for both of the minute digits.</p>
<figure><picture><source srcset="https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.34.50.png.webp 329w, https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.34.50-300x158.png.webp 300w" sizes="(max-width: 329px) 100vw, 329px" type="image/webp"><img src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.34.50.png" alt="" srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.34.50.png 329w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.34.50-300x158.png 300w" sizes="(max-width: 329px) 100vw, 329px" data-srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.34.50.png 329w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.34.50-300x158.png 300w" data-src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.34.50.png" data-old-src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></picture></figure>
<h3>3. Changing colours – Sheets conditional formatting</h3>
<p>To create our digital clock, we need to tell sheets which cells to highlight at which time. To do that we’ll use Sheets’ amazingly flexible conditional formatting.</p>
<p>We’ll apply a different conditional format to each space in our clock. To make it clearer – here’s each of them highlighted in a different colour.</p>
<figure><picture><source srcset="https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45.png.webp 464w, https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45-300x184.png.webp 300w" sizes="(max-width: 464px) 100vw, 464px" type="image/webp"><img alt="" data-srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45.png 464w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45-300x184.png 300w" data-src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45.png" data-sizes="(max-width: 464px) 100vw, 464px" srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45.png 464w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45-300x184.png 300w" src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45.png"></picture></figure>
<p>We have four rules, one for each digit in our clock. Each splits out a portion of the time for our display. Our broad process is;</p>
<ul><li>The rule defining the green number above<ul><li>When the first digit of the hour is 1 – highlight all the cells in the first block which we’ve marked as “1 cells”</li><li>When the first digit of the hour is 8 – highlight all the cells in the first block which we’ve marked as “8 cells”<br></li></ul></li><li>The rule defining the blue number above<ul><li>When the first digit of the minute is 6 – highlight all the cells in the last block which we’ve marked as “6 cells”</li></ul></li></ul>
<p>etc. etc. etc.</p>
<div>
<div>
<figure><picture><source srcset="https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.14.05.png.webp 297w, https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.14.05-183x300.png.webp 183w" sizes="(max-width: 297px) 100vw, 297px" type="image/webp"><img src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.14.05.png" alt="" srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.14.05.png 297w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.14.05-183x300.png 183w" sizes="(max-width: 297px) 100vw, 297px" data-srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.14.05.png 297w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.14.05-183x300.png 183w" data-src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.14.05.png" data-old-src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></picture></figure>
</div>
<div>
<p>Our first, green digit, at maximum will occupy any of the cells between C3 and H14.</p>
<p>In each of the cells in that range, we’ve written out a RegEx which tells us if a digit will use that cell.</p>
<p>For example, cell C3 will be highlighted if we are creating the digits 4, 5 or 7. It won’t be highlighted if we’re creating the digits 0, 1, 2, 3, 6, 8, or 9. So in C3 we have written<em> ^(4|5|7)$</em> which means “match 4, 5, or 7, exactly – nothing else.</p>
<p>In this case – U1 is where we’ve put our first extracted digit of the hour. So the custom formula written there means “when the first digit of the hour matches 4, 5, or 7, highlight C3”. </p>
</div>
</div>
<p>One smart thing about custom formulas in Google Sheets is, if you apply it to a range of cells (like C3:H14) it will take relative and absolute cell references into account. In our formula we’ve used $U$1 – that’s an absolute cell reference – no matter where we are applying this custom formula – that part will always refer to U1. However – we haven’t written $C$3 – we’ve just written C3. So, in the first cell of our range, we’ll refer to C3 but if we apply this formula to a cell one row down it’ll refer to C4, if we then move one column across it’ll refer to D4.</p>
<p>This is how we create our clock without having to write out a different conditional formula for each one. When the conditional formatting is applied to C4, it’ll check whether the regex in C4 matches the first digit of the hour. The regex in C4 is <em>^(2|3|4|5|6|8|9|0)$</em> so if the first digit of the hour is 2 – C4 will be highlighted and C3 won’t be.</p>
<h3>4. Drawing all the numbers – join()</h3>
<p>It would be a massive pain to just try to write out all of these regex formulas one-by-one. Instead we’ll write out each of the possible digits we want to represent and then combine them into our regex.</p>
<figure><picture><source srcset="https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-1024x358.png.webp 1024w, https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-300x105.png.webp 300w, https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-768x269.png.webp 768w, https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38.png.webp 1440w" sizes="(max-width: 706px) 89vw, (max-width: 767px) 82vw, 740px" type="image/webp"><img src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-1024x358.png" alt="" srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-1024x358.png 1024w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-300x105.png 300w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-768x269.png 768w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38.png 1440w" sizes="(max-width: 706px) 89vw, (max-width: 767px) 82vw, 740px" data-srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-1024x358.png 1024w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-300x105.png 300w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-768x269.png 768w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38.png 1440w" data-src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-1024x358.png" data-old-src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></picture></figure>
<p>Our Clock C3 cell in our is a combination of the numbers in our digits sheet <em>A3, G3, M3, S3, Y3, AE3, AK3, AQ3, AW3, BC3</em>. Clock C4 is <em>A4, G4, M4</em> etc. etc. etc.</p>
<p>The formula we use to do that is; <em>JOIN(“|”,Digits!A3,Digits!G3,Digits!M3,Digits!S3,Digits!Y3,Digits!AE3,Digits!AK3,Digits!AQ3,Digits!AW3,Digits!BC3)</em></p>
<p>Basically – take the value from each of these cells and join them together with a pipe | in between them (because pipe in regex means <strong>or</strong>).</p>
<h3>5. Removing errant pipes – regexreplace()</h3>
<p>The problem with this is we have some empty cells so we can end up with a regex that reads <em>|||4|5||7||| </em> – having those empty spaces means we won’t just match numbers – we’ll match a lack of number too, which could screw up our clock. To get rid of those problematic extra bits we’ll use regex <em>on</em> our regex. </p>
<figure><picture><source srcset="https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Yo-Dawg-Heard-You.jpg.webp 500w, https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Yo-Dawg-Heard-You-300x194.jpg.webp 300w" sizes="(max-width: 500px) 100vw, 500px" type="image/webp"><img alt="" data-srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Yo-Dawg-Heard-You.jpg 500w, https://www.therobinlord.com/wp-content/uploads/2020/10/Yo-Dawg-Heard-You-300x194.jpg 300w" data-src="https://www.therobinlord.com/wp-content/uploads/2020/10/Yo-Dawg-Heard-You.jpg" data-sizes="(max-width: 500px) 100vw, 500px" srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Yo-Dawg-Heard-You.jpg 500w, https://www.therobinlord.com/wp-content/uploads/2020/10/Yo-Dawg-Heard-You-300x194.jpg 300w" src="https://www.therobinlord.com/wp-content/uploads/2020/10/Yo-Dawg-Heard-You.jpg"></picture></figure>
<p><em>=regexreplace(JOIN(…),”\|{2,}”,”|”)</em></p>
<p>This formula will take the result of our join, identify anything that matches <strong>\|{2,}</strong> (basically two or more pipes in the row) and replaces them with | – one pipe.</p>
<p>We also don’t want to end up with pipes at the start or end like this; |4|5| so we’ll regexreplace on our regexreplace</p>

<p><em>=regexreplace(regexreplace(…),”(^\||\|$)”,””))</em></p>
<p>This formula will look at the result of our last regexreplace(), find anything that matches <strong>^\|</strong> (a pipe at the start of the text) or <strong>\|$</strong> (a pipe at the end of the text) and replace either with “” (nothing).</p>
<p>So now we have a regex like this; <strong>4|5</strong></p>
<h2>5. Complete our regex – &amp; concatenation</h2>
<p>To make sure we have a nice, specific, regex to match on we can add some text to the start and end. Google Sheets has a concatenate function but I find using &amp; easier to read</p>
<p>=”^(“&amp;regexreplace(…)&amp;”)$”</p>
<p>That formula will take our cleaned up regex, add brakcets and a “start’ and “end” symbol so we have something like this; <strong>^(</strong>4|5)$</p>
<p>We know that regex will only match either the digit 4 or the digit 5 and nothing else. Nice and specific.</p>
<h3>6. Create all the rest of our digits – arrayformula()</h3>
<p>At this point we’ve created the template for our first hour digit. We don’t want to go through all of that for each of the other templates and they can all be identical. So we use arrayformula to copy one block of cells to another place.</p>
<p><em>=arrayformula($C$3:$H$14) </em>duplicates our template, we can do that for each of our other digits.</p>
<h3>7. Highlighting the rest of our digits – Sheets conditional formatting</h3>
<figure><picture><source srcset="https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45.png.webp 464w, https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45-300x184.png.webp 300w" sizes="(max-width: 464px) 100vw, 464px" type="image/webp"><img alt="" data-srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45.png 464w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45-300x184.png 300w" data-src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45.png" data-sizes="(max-width: 464px) 100vw, 464px" srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45.png 464w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45-300x184.png 300w" src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45.png"></picture></figure>
<p>Our first conditional formatting formula checked each cell in the green block against the first digit of the current hour. Our second formula checks the cells in the yellow block against the second digit of the hour, our third block checks the cells in the blue block against the first digit of the minute etc. etc.</p>

<h2>Any ideas?</h2>
<p>As above – feel free to play around with the Google Sheet and see how it works.</p>

<p>This is a bit of fun which hopefully helps you learn some Sheets tricks that’ll be valuable elsewhere. One thing I love about open platforms like sheets is there are <em>loads</em> of people creating this kind of thing. When I started to share this, a colleague pointed out that <a href="https://www.benlcollins.com/spreadsheets/google-sheets-formula-clock/">Ben Collins actually created a working </a><em><a href="https://www.benlcollins.com/spreadsheets/google-sheets-formula-clock/">analogue</a></em><a href="https://www.benlcollins.com/spreadsheets/google-sheets-formula-clock/"> clock using Sheets sparkline formulas, which is very impressive.</a></p>
<p>Have you seen any cool sheets projects recently? Anything you think I could have done better here? Tweet me @robinlord8 </p>
</div>
</article></div>]]>
            </description>
            <link>https://www.therobinlord.com/making-a-digital-clock-in-google-sheets/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25529618</guid>
            <pubDate>Thu, 24 Dec 2020 17:45:57 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[GoDaddy employees told they were getting a holiday bonus in a phishing test]]>
            </title>
            <description>
<![CDATA[
Score 194 | Comments 243 (<a href="https://news.ycombinator.com/item?id=25529584">thread link</a>) | @arkadiyt
<br/>
December 24, 2020 | https://coppercourier.com/story/godaddy-employees-holiday-bonus-secruity-test/ | <a href="https://web.archive.org/web/*/https://coppercourier.com/story/godaddy-employees-holiday-bonus-secruity-test/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
					
<h2>Roughly 500 employees failed the test, which claimed they would receive a $650 bonus.</h2>



<p>“2020 has been a record year for GoDaddy, thanks to you!” the email read.</p>



<p>Sent by Happyholiday@Godaddy.com, tucked underneath a glittering banner of a snowflake and stamped with the words “GoDaddy Holiday Party,” the Dec. 14 email to hundreds of GoDaddy employees promised some welcome financial relief during an <a href="https://coppercourier.com/story/tens-of-millions-of-americans-face-economic-ruin-unless-congress-gets-its-sht-together/">otherwise stressful year</a>.</p>



<p>“Though we cannot celebrate together during our annual Holiday Party, we want to show our appreciation and share a $650 one-time Holiday bonus!” the email read. “To ensure that you receive your one-time bonus in time for the Holidays, please select your location and fill in the details by Friday, December 18th.”</p>



<p>But, two days later, the company sent another email.</p>



<p>“You’re getting this email because you failed our recent phishing test,” the company’s chief security officer Demetrius Comes<strong> </strong>wrote. “You will need to retake the Security Awareness Social Engineering training.”</p>



<figure><picture>
	<source media="(max-width: 320px)" srcset="https://fwiw.imgix.net/wp-content/uploads/2020/12/GoDaddy-Email.png?w=284">
	<source media="(max-width: 768px)" srcset="https://fwiw.imgix.net/wp-content/uploads/2020/12/GoDaddy-Email.png?w=676">
	<source media="(max-width: 1280px)" srcset="https://fwiw.imgix.net/wp-content/uploads/2020/12/GoDaddy-Email.png?w=1400">
	<img src="https://fwiw.imgix.net/wp-content/uploads/2020/12/GoDaddy-Email.png?w=1400" width="1400" height="9999" alt="" title="">
	
	
</picture></figure>



<figure>
		<picture>
	<source media="(max-width: 320px)" srcset="https://fwiw.imgix.net/wp-content/uploads/2020/12/Use2.png?w=284">
	<source media="(max-width: 768px)" srcset="https://fwiw.imgix.net/wp-content/uploads/2020/12/Use2.png?w=676">
	<source media="(max-width: 1280px)" srcset="https://fwiw.imgix.net/wp-content/uploads/2020/12/Use2.png?w=1400">
	<img src="https://fwiw.imgix.net/wp-content/uploads/2020/12/Use2.png?w=1400" width="1400" height="9999" alt="" title="">
	
	
</picture><span>A Dec. 14 email sent to hundreds of GoDaddy employees offered a holiday bonus to employees. It turned out to be a phishing test.</span><figcaption>Screenshots of the email were sent to The Copper Courier by multiple GoDaddy employees.</figcaption>
	</figure>



<p>Phishing tests are sent by companies to gauge their employees’ susceptibility to phishing attacks, where people outside the company will attempt to disguise themselves as trusted sources to gain access to sensitive information, like usernames and passwords.</p>



<p>The follow-up email from Comes said that roughly 500 GoDaddy employees clicked on the holiday bonus email and “failed the test.”</p>



<p>Scottsdale-based GoDaddy, the world’s largest domain registrar and web-hosting company, did not respond to repeated requests for comment about the emails. The emails were forwarded to The Copper Courier by three GoDaddy employees.</p>



<p>Earlier this year, <a href="https://www.forbes.com/sites/daveywinder/2020/05/05/godaddy-confirms-data-breach-what-19-million-customers-need-to-know/?sh=235bf0a91daa">Forbes reported</a> that 28,000 GoDaddy customers were impacted after a data breach compromised their account usernames and passwords.&nbsp;</p>



<p>Despite the company <a href="https://investors.godaddy.net/newsroom/news-releases/press-release-details/2020/GoDaddy-Reports-Second-Quarter-2020-Earnings-Results/default.aspx">surpassing 20 million customers this year</a> and reporting “record customer growth,” the company <a href="https://aboutus.godaddy.net/newsroom/news-releases/press-release-details/2020/GoDaddy-Blog-Update/default.aspx">laid off or reassigned</a> hundreds of employees during the coronavirus pandemic, <a href="https://www.abc15.com/news/business/godaddy-to-lay-off-hundreds-close-texas-offices">including in Arizona</a>, Iowa, and Texas.</p>



<p>GoDaddy is not the first company this year to trick employees into falling for phishing scams by dangling the carrot of a potential bonus.</p>



<p>In September, Tribune Publishing, which owns <a href="https://www.tribpub.com/#">several major newspapers</a> around the country, sent a similar email to its employees.</p>



<p>The email, circulated by <a href="https://twitter.com/justin_fenton/status/1308851669397053440">several furious Tribune employees on Twitter</a>, said the company was giving out targeted bonuses of $5,000-$10,000, only to later reveal itself as a phishing test sent by the company.</p>



<figure><div>
<figure><blockquote data-width="500" data-dnt="true"><div lang="en" dir="ltr"><p>I've been able to confirm that this was in fact! an internal test from <a href="https://twitter.com/tribpub?ref_src=twsrc%5Etfw">@tribpub</a>. If you click the links, you get a message from the company's training contractor saying you clicked on a simulated phishing test.</p><p>The level of cruelty is actually stunning, even for this company.</p></div>— Danielle Ohl (@DTOhl) <a href="https://twitter.com/DTOhl/status/1308850196978298880?ref_src=twsrc%5Etfw">September 23, 2020</a></blockquote></figure>
</div></figure>



<p>“The level of cruelty is actually stunning,” Tribune reporter Danielle Ohl <a href="https://twitter.com/DTOhl/status/1308850196978298880?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1308850196978298880%7Ctwgr%5E%7Ctwcon%5Es1_&amp;ref_url=https%3A%2F%2Fwww.vice.com%2Fen%2Farticle%2Fy3z8g5%2Ftribune-publishing-out-evils-itself-with-phishing-email-promising-bonuses">wrote at the time</a>.</p>



<p>A Tribune spokesperson <a href="https://www.vice.com/en/article/y3z8g5/tribune-publishing-out-evils-itself-with-phishing-email-promising-bonuses">later told Vice News</a> that the exercise was part of a regular, internal test to assess phishing risks and said that it had no intention of offending its employees. “In retrospect, the topic of the email was misleading and insensitive, and the company apologizes for its use,” the statement read.</p>



<p><em>Want to talk about phishing tests you’ve received from your employer? Reach the reporter at <a href="mailto:lorraine@couriernewsroom.com">lorraine@couriernewsroom.com</a> or 480-243-4086.</em></p>
				</div><div>
	<hr>
	<div>
    <a href="https://coppercourier.com/author/lorrainelonghi/">
        <picture>
	<source media="(max-width: 90px)" srcset="https://fwiw.imgix.net/wp-content/uploads/2020/11/Lorraine-Longhi-.jpg?w=90">
	<img src="https://fwiw.imgix.net/wp-content/uploads/2020/11/Lorraine-Longhi-.jpg?w=90" width="90" height="9999" alt="Lorraine Longhi" title="Lorraine Longhi">
</picture>    </a>
    <div>
        <p>
            <a href="https://coppercourier.com/author/lorrainelonghi/">
                Lorraine Longhi            </a>
            is a reporter for The Copper Courier. She is a native of the Southwest and has lived in Phoenix since 2006. A graduate of ASU’s Walter Cronkite School of Journalism, she previously worked for The Arizona Republic, covering city government, education, and the impact of statewide decisions.        </p>
        
    </div>
</div>
</div></div>]]>
            </description>
            <link>https://coppercourier.com/story/godaddy-employees-holiday-bonus-secruity-test/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25529584</guid>
            <pubDate>Thu, 24 Dec 2020 17:42:26 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[In CPython, types implemented in C are part of the type tree]]>
            </title>
            <description>
<![CDATA[
Score 106 | Comments 96 (<a href="https://news.ycombinator.com/item?id=25528557">thread link</a>) | @todsacerdoti
<br/>
December 24, 2020 | https://utcc.utoronto.ca/~cks/space/blog/python/CPythonCTypesHaveTree | <a href="https://web.archive.org/web/*/https://utcc.utoronto.ca/~cks/space/blog/python/CPythonCTypesHaveTree">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><h2>In CPython, types implemented in C actually are part of the type tree</h2>

	<p><small>December 24, 2020</small></p>
</div><div><p>In Python, in theory all types descend from <code>object</code> (they are
direct or indirect subclasses of it). For years, I've believed (and
written) that this was not the case at the implementation level for
types written in native C code in CPython (the standard implementation
of Python and the one you're probably using). Types written in C
might behave as if they descended from <code>object</code>, but I thought their
behavior was actually entirely stand-alone, implemented by each
type separately in C. Courtesy of <a href="https://tenthousandmeters.com/blog/python-behind-the-scenes-6-how-python-object-system-works/">Python behind the scenes #6:
how Python object system works</a>,
I've discovered that I'm wrong.</p>

<p>In CPython, C level Python types are not literally subclasses of
the C level version of <code>object</code>, because of course C doesn't have
classes and subclasses in that sense. Instead, you usually describe
your type by defining a <a href="https://docs.python.org/3/c-api/typeobj.html"><code>PyTypeObject</code></a> struct for it, with
all sorts of fields that you fill in or don't fill in as you need
them, including a <a href="https://docs.python.org/3/c-api/typeobj.html#c.PyTypeObject.tp_base"><code>tp_base</code></a> field
for your base type (if you want more than one base type, you need
to take the alternate path of a <a href="https://docs.python.org/3/c-api/typeobj.html#heap-types">heap type</a>). When
CPython needs to execute special methods or other operations on
your type, it will directly use fields on your <code>PyTypeObject</code>
structure (and as far as I know, it only uses those fields, with
no fallbacks). On the surface, this looks like the <code>tp_base</code> field
is essentially decorative and is only used to report your claimed
<code>__base__</code> if people ask.</p>

<p>However, there is a bit of CPython magic hiding behind the scenes.
In order to actually use a <code>PyTypeObject</code> as a type, you must
register it and make it ready by calling <a href="https://docs.python.org/3/c-api/type.html#c.PyType_Ready"><code>PyType_Ready</code></a>. As part
of this, <code>PyType_Ready</code> will use your type's <code>tp_base</code> to fill
in various fields of your <code>PyTypeObject</code> if you didn't already do
that, which effectively means that your C level type will inherit
those fields from its base type (and so on all the way up to
<code>object</code>). This is outlined in <a href="https://docs.python.org/3/c-api/typeobj.html#cols">a section of the C API</a>, but of course
I never read the C API myself because I never needed to use it.
The <a href="https://tenthousandmeters.com/blog/python-behind-the-scenes-6-how-python-object-system-works/">how [the] Python object system works</a>
article has more details on how this works, if you're curious, along
with details on how special methods also work (which is more
interesting than I had any idea, and I've looked at this area
before).</p>

<p>(The distinction between what is considered a 'type' and what is
considered a 'class' by <code>repr()</code> is somewhat arbitrary; see the
sidebar <a href="https://utcc.utoronto.ca/~cks/space/blog/python/ClassesAndTypes">here</a>. C level things defined with
<code>PyTypeObject</code> will probably always be considered types instead of
classes.)</p>
</div></div>]]>
            </description>
            <link>https://utcc.utoronto.ca/~cks/space/blog/python/CPythonCTypesHaveTree</link>
            <guid isPermaLink="false">hacker-news-small-sites-25528557</guid>
            <pubDate>Thu, 24 Dec 2020 15:54:18 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Oklab: A perceptual color space for image processing]]>
            </title>
            <description>
<![CDATA[
Score 228 | Comments 82 (<a href="https://news.ycombinator.com/item?id=25525726">thread link</a>) | @ingve
<br/>
December 23, 2020 | https://bottosson.github.io/posts/oklab/ | <a href="https://web.archive.org/web/*/https://bottosson.github.io/posts/oklab/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><article><div><p>A perceptual color space is desirable when doing many kinds of image processing. It is useful for things like:</p><ul><li>Turning an image grayscale, while keeping the perceived lightness the same</li><li>Increasing the saturation of colors, while maintaining perceived hue and lightness</li><li>Creating smooth and uniform looking transitions between colors</li></ul><p>Unfortunately, as far as I am aware, while there are color spaces that aim to be perceptually uniform, none are without significant drawbacks when used for image processing.</p><p>For this reason I have designed a new perceptual color space, designed to be simple to use, while doing a good job at predicting perceived lightness, <a href="https://en.wikipedia.org/wiki/Colorfulness">chroma</a> and hue. It is called the <strong>Oklab color space</strong>, because it is an OK Lab color space.</p><p>Before diving into the details of why a new color space is needed and how it was derived, here is the everything needed to use the color space:</p><p>A color in Oklab is represented with three coordinates, similar to how <a href="https://en.wikipedia.org/wiki/CIELAB_color_space">CIELAB</a> works, but with better perceptual properties. Oklab uses a D65 whitepoint, since this is what sRGB and other common color spaces use. The three coordinates are:</p><ul><li><span><span><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span></span> – perceived lightness</li><li><span><span><math><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span></span> – how green/red the color is</li><li><span><span><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span></span> – how blue/yellow the color is</li></ul><p>For many operations, <span><span><math><semantics><mrow><mi>L</mi><mi>a</mi><mi>b</mi></mrow><annotation encoding="application/x-tex">Lab</annotation></semantics></math></span></span>-coordinates can be used directly, but they can also be transformed into polar form, with the coordinates lightness, chroma and hue, <span><span><math><semantics><mrow><mi>L</mi><mi>C</mi><mi>h</mi></mrow><annotation encoding="application/x-tex">LCh</annotation></semantics></math></span></span>:</p><p><span><span><span><math><semantics><mrow><mi>C</mi><mo>=</mo><mrow><msqrt><mrow><msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup></mrow></msqrt></mrow><mo separator="true">,</mo><mspace width="2em"></mspace><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mtext><mi mathvariant="normal">a</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">n</mi><mn>2</mn></mtext><mo>(</mo><mi>b</mi><mo separator="true">,</mo><mi>a</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">C={\sqrt {a^2+b^2}}, \qquad h^{\circ}=\text{atan2}(b,a)</annotation></semantics></math></span></span></span></p><p>From <span><span><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span></span> and <span><span><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding="application/x-tex">h^{\circ}</annotation></semantics></math></span></span>, <span><span><math><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span></span> and <span><span><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span></span> can be computed like this:</p><p><span><span><span><math><semantics><mrow><mi>a</mi><mo>=</mo><mi>C</mi><mi>cos</mi><mo>(</mo><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>)</mo><mo separator="true">,</mo><mspace width="2em"></mspace><mi>b</mi><mo>=</mo><mi>C</mi><mi>sin</mi><mo>(</mo><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">a=C\cos(h^{\circ}),\qquad b=C\sin(h^{\circ})</annotation></semantics></math></span></span></span></p><p>Lets look at a practical example to see how Oklab performs, before looking at how the <span><span><math><semantics><mrow><mi>L</mi><mi>a</mi><mi>b</mi></mrow><annotation encoding="application/x-tex">Lab</annotation></semantics></math></span></span> coordinates are computed.</p><blockquote><h4 id="comparing-oklab-to-hsv">Comparing Oklab to HSV <a href="#comparing-oklab-to-hsv"><span><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h4><p>Here’s an Oklab color gradient with varying hue and constant lightness and chroma.</p><p><img alt="Oklab varying hue plot" decoding="async" height="169" loading="lazy" src="https://bottosson.github.io/img/oklab/hue_oklab.png" width="1130"></p><p>Compare this to a similar plot of a HSV color gradient with varying hue and constant value and saturation (HSV using the sRGB color space).</p><p><img alt="HSV varying hue plot" decoding="async" height="169" loading="lazy" src="https://bottosson.github.io/img/oklab/hue_hsv.png" width="1130"></p><p>The gradient is quite uneven and there are clear differences in lightness for different hues. Yellow, magenta and cyan appear much lighter than red and blue.</p><p>Here is lightness of the HSV plot, as predicted by Oklab:</p><p><img alt="HSV varying hue plot lightness" decoding="async" height="169" loading="lazy" src="https://bottosson.github.io/img/oklab/hue_hsv_lightness.png" width="1130"></p></blockquote><h3 id="implementation">Implementation <a href="#implementation"><span><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h3><h4 id="converting-from-xyz-to-oklab">Converting from XYZ to Oklab <a href="#converting-from-xyz-to-oklab"><span><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h4><p>Given a color in <span><span><math><semantics><mrow><mi>X</mi><mi>Y</mi><mi>Z</mi></mrow><annotation encoding="application/x-tex">XYZ</annotation></semantics></math></span></span> coordinates, with a D65 whitepoint, Oklab coordinates can be computed like this:</p><p>First the <span><span><math><semantics><mrow><mi>X</mi><mi>Y</mi><mi>Z</mi></mrow><annotation encoding="application/x-tex">XYZ</annotation></semantics></math></span></span> coordinates are converted to an approximate cone responses:</p><p><span><span><span><math><semantics><mrow><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mi>l</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>m</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>s</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">1</mn></msub></mrow><mo>×</mo><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mi>X</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>Y</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>Z</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{pmatrix} l \\ m \\ s \end{pmatrix} = \mathbf{M_1} \times \begin{pmatrix} X \\ Y \\ Z \end{pmatrix}</annotation></semantics></math></span></span></span></p><p>A non-linearity is applied:</p><p><span><span><span><math><semantics><mrow><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><msup><mi>l</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>m</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>s</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><msup><mi>l</mi><mrow><mfrac><mn>1</mn><mn>3</mn></mfrac></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>m</mi><mrow><mfrac><mn>1</mn><mn>3</mn></mfrac></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>s</mi><mrow><mfrac><mn>1</mn><mn>3</mn></mfrac></mrow></msup></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{pmatrix} l' \\ m' \\ s' \end{pmatrix} = \begin{pmatrix} l^{\frac 1 3} \\ m^{\frac 1 3} \\ s^{\frac 1 3} \end{pmatrix}</annotation></semantics></math></span></span></span></p><p>Finally, this is transformed into the <span><span><math><semantics><mrow><mi>L</mi><mi>a</mi><mi>b</mi></mrow><annotation encoding="application/x-tex">Lab</annotation></semantics></math></span></span>-coordinates:</p><p><span><span><span><math><semantics><mrow><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mi>L</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>a</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>b</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">2</mn></msub></mrow><mo>×</mo><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><msup><mi>l</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>m</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>s</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{pmatrix} L \\ a \\ b \end{pmatrix} = \mathbf{M_2} \times \begin{pmatrix} l' \\ m' \\ s' \end{pmatrix}</annotation></semantics></math></span></span></span></p><p>with the following values for <span><span><math><semantics><mrow><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">1</mn></msub></mrow></mrow><annotation encoding="application/x-tex">\mathbf{M_1}</annotation></semantics></math></span></span> and <span><span><math><semantics><mrow><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">2</mn></msub></mrow></mrow><annotation encoding="application/x-tex">\mathbf{M_2}</annotation></semantics></math></span></span>:</p><p><span><span><span><math><semantics><mrow><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">1</mn></msub></mrow><mo>=</mo><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>8</mn><mn>1</mn><mn>8</mn><mn>9</mn><mn>3</mn><mn>3</mn><mn>0</mn><mn>1</mn><mn>0</mn><mn>1</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>3</mn><mn>6</mn><mn>1</mn><mn>8</mn><mn>6</mn><mn>6</mn><mn>7</mn><mn>4</mn><mn>2</mn><mn>4</mn></mrow></mtd><mtd><mrow><mo>−</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>1</mn><mn>2</mn><mn>8</mn><mn>8</mn><mn>5</mn><mn>9</mn><mn>7</mn><mn>1</mn><mn>3</mn><mn>7</mn></mrow></mtd></mtr><mtr><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>0</mn><mn>3</mn><mn>2</mn><mn>9</mn><mn>8</mn><mn>4</mn><mn>5</mn><mn>4</mn><mn>3</mn><mn>6</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>9</mn><mn>2</mn><mn>9</mn><mn>3</mn><mn>1</mn><mn>1</mn><mn>8</mn><mn>7</mn><mn>1</mn><mn>5</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>0</mn><mn>3</mn><mn>6</mn><mn>1</mn><mn>4</mn><mn>5</mn><mn>6</mn><mn>3</mn><mn>8</mn><mn>7</mn></mrow></mtd></mtr><mtr><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>0</mn><mn>4</mn><mn>8</mn><mn>2</mn><mn>0</mn><mn>0</mn><mn>3</mn><mn>0</mn><mn>1</mn><mn>8</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>2</mn><mn>6</mn><mn>4</mn><mn>3</mn><mn>6</mn><mn>6</mn><mn>2</mn><mn>6</mn><mn>9</mn><mn>1</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>6</mn><mn>3</mn><mn>3</mn><mn>8</mn><mn>5</mn><mn>1</mn><mn>7</mn><mn>0</mn><mn>7</mn><mn>0</mn></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{M_1} = \begin{pmatrix} +0.8189330101 &amp; +0.3618667424 &amp; -0.1288597137 \\ +0.0329845436 &amp; +0.9293118715 &amp; +0.0361456387 \\ +0.0482003018 &amp; +0.2643662691 &amp; +0.6338517070 \end{pmatrix}</annotation></semantics></math></span></span></span></p><p><span><span><span><math><semantics><mrow><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">2</mn></msub></mrow><mo>=</mo><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>2</mn><mn>1</mn><mn>0</mn><mn>4</mn><mn>5</mn><mn>4</mn><mn>2</mn><mn>5</mn><mn>5</mn><mn>3</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>7</mn><mn>9</mn><mn>3</mn><mn>6</mn><mn>1</mn><mn>7</mn><mn>7</mn><mn>8</mn><mn>5</mn><mn>0</mn></mrow></mtd><mtd><mrow><mo>−</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>0</mn><mn>0</mn><mn>4</mn><mn>0</mn><mn>7</mn><mn>2</mn><mn>0</mn><mn>4</mn><mn>6</mn><mn>8</mn></mrow></mtd></mtr><mtr><mtd><mrow><mo>+</mo><mn>1</mn><mi mathvariant="normal">.</mi><mn>9</mn><mn>7</mn><mn>7</mn><mn>9</mn><mn>9</mn><mn>8</mn><mn>4</mn><mn>9</mn><mn>5</mn><mn>1</mn></mrow></mtd><mtd><mrow><mo>−</mo><mn>2</mn><mi mathvariant="normal">.</mi><mn>4</mn><mn>2</mn><mn>8</mn><mn>5</mn><mn>9</mn><mn>2</mn><mn>2</mn><mn>0</mn><mn>5</mn><mn>0</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>4</mn><mn>5</mn><mn>0</mn><mn>5</mn><mn>9</mn><mn>3</mn><mn>7</mn><mn>0</mn><mn>9</mn><mn>9</mn></mrow></mtd></mtr><mtr><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>0</mn><mn>2</mn><mn>5</mn><mn>9</mn><mn>0</mn><mn>4</mn><mn>0</mn><mn>3</mn><mn>7</mn><mn>1</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>7</mn><mn>8</mn><mn>2</mn><mn>7</mn><mn>7</mn><mn>1</mn><mn>7</mn><mn>6</mn><mn>6</mn><mn>2</mn></mrow></mtd><mtd><mrow><mo>−</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>8</mn><mn>0</mn><mn>8</mn><mn>6</mn><mn>7</mn><mn>5</mn><mn>7</mn><mn>6</mn><mn>6</mn><mn>0</mn></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{M_2} = \begin{pmatrix} +0.2104542553 &amp; +0.7936177850 &amp; -0.0040720468 \\ +1.9779984951 &amp; -2.4285922050 &amp; +0.4505937099 \\ +0.0259040371 &amp; +0.7827717662 &amp; -0.8086757660 \end{pmatrix}</annotation></semantics></math></span></span></span></p><p>The inverse operation, going from Oklab to XYZ is done with the following steps:</p><p><span><span><span><math><semantics><mrow><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><msup><mi>l</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>m</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>s</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><msup><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">2</mn></msub></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>×</mo><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mi>L</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>a</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>b</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo separator="true">,</mo><mspace width="2em"></mspace><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mi>l</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>m</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>s</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><msup><mrow><mo>(</mo><msup><mi>l</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup><mo>)</mo></mrow><mrow><mn>3</mn></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mrow><mo>(</mo><msup><mi>m</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup><mo>)</mo></mrow><mrow><mn>3</mn></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mrow><mo>(</mo><msup><mi>s</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup><mo>)</mo></mrow><mrow><mn>3</mn></mrow></msup></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo separator="true">,</mo><mspace width="2em"></mspace><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mi>X</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>Y</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>Z</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><msup><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">1</mn></msub></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>×</mo><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mi>l</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>m</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>s</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{pmatrix} l' \\ m' \\ s' \end{pmatrix} = \mathbf{M_2}^{-1} \times \begin{pmatrix} L \\ a \\ b \end{pmatrix},\qquad \begin{pmatrix} l \\ m \\ s \end{pmatrix} = \begin{pmatrix} {(l')}^{3} \\ {(m')}^{3} \\ {(s')}^{3} \end{pmatrix},\qquad \begin{pmatrix} X \\ Y \\ Z \end{pmatrix} = \mathbf{M_1}^{-1} \times \begin{pmatrix} l \\ m \\ s \end{pmatrix}</annotation></semantics></math></span></span></span></p><h4 id="converting-from-linear-srgb-to-oklab">Converting from linear sRGB to Oklab <a href="#converting-from-linear-srgb-to-oklab"><span><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h4><p>Since this will be a common use case, here is the code to convert linear sRGB values to Oklab and back. To compute linear sRGB values, see <a href="https://bottosson.github.io/posts/colorwrong/#what-can-we-do%3F">my previous post</a>.</p><p>The code is in C++, but without any fancy features so should be easy to translate. The code is available in public domain, feel free to use it any way you please.</p><pre><code>struct Lab {float L; float a; float b;};
struct RGB {float r; float g; float b;};

Lab linear_srgb_to_oklab(RGB c) 
{
    float l = 0.4121656120f * c.r + 0.5362752080f * c.g + 0.0514575653f * c.b;
    float m = 0.2118591070f * c.r + 0.6807189584f * c.g + 0.1074065790f * c.b;
    float s = 0.0883097947f * c.r + 0.2818474174f * c.g + 0.6302613616f * c.b;

    float l_ = cbrtf(l);
    float m_ = cbrtf(m);
    float s_ = cbrtf(s);

    return {
        0.2104542553f*l_ + 0.7936177850f*m_ - 0.0040720468f*s_,
        1.9779984951f*l_ - 2.4285922050f*m_ + 0.4505937099f*s_,
        0.0259040371f*l_ + 0.7827717662f*m_ - 0.8086757660f*s_,
    };
}

RGB oklab_to_linear_srgb(Lab c) 
{
    float l_ = c.L + 0.3963377774f * c.a + 0.2158037573f * c.b;
    float m_ = c.L - 0.1055613458f * c.a - 0.0638541728f * c.b;
    float s_ = c.L - 0.0894841775f * c.a - 1.2914855480f * c.b;

    float l = l_*l_*l_;
    float m = m_*m_*m_;
    float s = s_*s_*s_;

    return {
        + 4.0767245293f*l - 3.3072168827f*m + 0.2307590544f*s,
        - 1.2681437731f*l + 2.6093323231f*m - 0.3411344290f*s,
        - 0.0041119885f*l - 0.7034763098f*m + 1.7068625689f*s,
    };
}
</code></pre><p>This is everything you need to use the Oklab color space! If you need a simple perceptual color space, try it out.</p><p>The rest of the post will go into why a new color space was needed, how it has been constructed and how it compares with existing color spaces.</p><hr><p>What properties does a perceptual color space need to satisfy to be useful for image processing? The answer to this is always going to be a bit subjective, but based on my experience, these are a good set of requirements:</p><blockquote><ul><li><strong>Should be an opponent color space</strong>, similar to for example <a href="https://en.wikipedia.org/wiki/CIELAB_color_space">CIELAB</a>.</li><li><strong>Should predict lightness, chroma and hue well</strong>. <span><span><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span></span>, <span><span><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span></span> and <span><span><math><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span></span> should be perceived as orthogonal, so one can be altered without affecting the other two. This is useful for things like turning an image black and white and increasing colorfulness without introducing hue shifts etc.</li><li><strong>Blending two colors should result in even transitions</strong>. The transition colors should appear to be in between the blended colors (e.g. passing through a warmer color than either original color is not good).</li><li><strong>Should assume a D65 whitepoint</strong>. This is what common color spaces like sRGB, rec2020 and Display P3 uses.</li><li><strong>Should behave well numerically</strong>. The model should be easy to compute, numerically stable and differentiable.</li><li><strong>Should assume normal well lit viewing conditions</strong>. The complexity of supporting different viewing conditions is not practical in most applications. Other models could be used in conjunction if this is needed in some case.</li><li><strong>If the scale/exposure of colors are changed, the perceptual coordinates should just be scaled by a factor</strong>. More complex models that depend on absolute luminance should be avoided since the viewing conditions can not be accurately controlled and incorrect behavior would be confusing.</li></ul></blockquote><h3 id="what-about-existing-models%3F">What about existing models? <a href="#what-about-existing-models%3F"><span><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h3><p>Let’s look at existing models and how they stack up against these requirements. Further down there are graphs that illustrate some of these issues.</p><blockquote><ul><li><strong><a href="https://en.wikipedia.org/wiki/CIELAB_color_space">CIELAB</a> and <a href="https://en.wikipedia.org/wiki/CIELUV">CIELUV</a></strong> – Largest issue is their inability to predict hue. In particular blue hues are predicted badly. Other smaller issues exist as well</li><li><strong><a href="https://en.wikipedia.org/wiki/CIECAM02">CIECAM02-UCS</a> and the newer CAM16-UCS</strong> – Does a good job at being perceptually uniform overall, but doesn’t meet other requirements: Bad numerical behavior, it is not scale invariant and blending does not behave well because of its compression of chroma. Hue uniformity is decent, but other models predict it more accurately.</li><li><strong><a href="https://en.wikipedia.org/wiki/OSA-UCS">OSA-UCS</a></strong> – Overall does a good job. The transformation to OSA-UCS lacks an analytical inverse unfortunately which makes it impractical.</li><li><strong><a href="https://scholarworks.rit.edu/theses/2858/">IPT</a></strong> – Does a great job modelling hue uniformity. Doesn’t predict lightness and chroma well unfortunately, but meets all other requirements. Is simple computationally and does not depend on the scale/exposure.</li><li><strong><a href="https://www.osapublishing.org/oe/fulltext.cfm?uri=oe-25-13-15131&amp;id=368272">JzAzBz</a></strong> – Overall does a fairly good job. Designed to have uniform scaling of lightness for HDR data. While useful in some cases this introduces a dependence on the scale/exposure that makes it hard to use in general cases.</li><li><strong><a href="https://en.wikipedia.org/wiki/HSL_and_HSV">HSV</a> representation of sRGB</strong> – Only on this list because it is widely used. Does not meet any of the requirements except having a D65 whitepoint.</li></ul></blockquote><p>So, all in all, all these existing models have drawbacks.</p><p>Out of all of these, two models stand out: CAM16-UCS, for being the model with best properties of perceptual uniformity overall, and IPT for having a simple computational structure that meets all the requirements besides predicting lightness and chroma well.</p><p>For this reason it is reasonable to try to make a new color space, with the same computational structure as IPT, but that performs closer to CAM16-UCS in terms of predicting lightness and chroma. This exploration resulted in Oklab.</p><h3 id="how-oklab-was-derived">How Oklab was derived <a href="#how-oklab-was-derived"><span><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h3><p>To derive Oklab, three datasets were used:</p><ul><li>A generated data set of pairs of colors with the same lightness but random hue and chroma, generated using CAM16 and normal viewing conditions. Colors were limited to be within Pointer’s Gamut – the set of possible surface colors.</li><li>A generated data set of pairs of colors with the same chroma but random hue and lightness, generated using CAM16 and normal viewing conditions. Colors were limited to be within Pointer’s Gamut</li><li>The <a href="https://github.com/nschloe/colorio/blob/master/colorio/data/ebner_fairchild.yaml">uniform perceived hue</a> data used to derive IPT. From this data, colors were combined into pairs of colors with equal perceived hue.</li></ul><p>These datasets can be used to test prediction of lightness, chroma and hue respectively. If a color space accurately models <span><span><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span></span>, <span><span><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span></span> and <span><span><math><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span></span>, then all pairs in lightness dataset should have the same value for <span><span><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span></span>, all pairs in the chroma dataset the same value for <span><span><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span></span> and all pairs in the hue dataset the same values for <span><span><math><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span></span>.</p><p>To test a color space it is not possible to simply check the distance in predictions in the tested color space however, since that will depend on the scaling of the color space. It is also not desirable to exactly predict ground truth values for <span><span><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span></span>, <span><span><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span></span> and <span><span><math><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span></span>, since it is more important that our model has perceptually orthogonal coordinates, than that the model has the same spacing within each coordinate.</p><p>Instead the following approach was used to create an error metric independent of the color space:</p><ul><li>For each dataset all the pairs are converted to the tested color space.</li><li>Coordinates that are supposed to be the same within a pair are swapped to generate a new set of altered pairs:<ul><li>For the lightness dataset, the L coordinates are swapped between the pairs, and so on.</li><li>These altered pair would be equal to the original pair if the model predicts the datasets perfectly.</li></ul></li><li>The perceived distance between the original colors and the altered colors are are computed using <a href="https://en.wikipedia.org/wiki/Color_difference">CIEDE2000</a>.</li><li>The error for each pair is given as the minimum of the two color differences.</li><li>The error for the entire dataset is the root mean squared error of the color differences.</li></ul><p>Oklab was derived by optimizing the parameters of a color space with the same structure as IPT, to get a low error on all the datasets. For completeness, here is the structure of the color space – the parameters to optimize are the 3x3 matrices <span><span><math><semantics><mrow><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">1</mn></msub></mrow></mrow><annotation encoding="application/x-tex">\mathbf{M_1}</annotation></semantics></math></span></span> and <span><span><math><semantics><mrow><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">2</mn></msub></mrow></mrow><annotation encoding="application/x-tex">\mathbf{M_2}</annotation></semantics></math></span></span> and the positive number <span><span><math><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span></span>.</p><p><span><span><span><math><semantics><mrow><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mi>l</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>m</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>s</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">1</mn></msub></mrow><mo>×</mo><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mi>X</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>Y</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>Z</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{pmatrix} l \\ m \\ s \end{pmatrix} = \mathbf{M_1} \times \begin{pmatrix} X \\ Y \\ Z \end{pmatrix}</annotation></semantics></math></span></span></span></p><p><span><span><span><math><semantics><mrow><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mi>L</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>a</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>b</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">2</mn></msub></mrow><mo>×</mo><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><msup><mi>l</mi><mi>γ</mi></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>m</mi><mi>γ</mi></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>s</mi><mi>γ</mi></msup></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{pmatrix} L \\ a \\ b \end{pmatrix} = \mathbf{M_2} \times \begin{pmatrix} l^\gamma \\ m^\gamma \\ s^\gamma \end{pmatrix}</annotation></semantics></math></span></span></span></p><p>A couple of extra constraints were …</p></div></article></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://bottosson.github.io/posts/oklab/">https://bottosson.github.io/posts/oklab/</a></em></p>]]>
            </description>
            <link>https://bottosson.github.io/posts/oklab/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25525726</guid>
            <pubDate>Thu, 24 Dec 2020 07:34:49 GMT</pubDate>
        </item>
    </channel>
</rss>
