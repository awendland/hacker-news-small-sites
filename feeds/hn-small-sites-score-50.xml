<rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>
<![CDATA[Hacker News - Small Sites - Score >= 50]]>
        </title>
        <description>
<![CDATA[Hacker News stories from domains that aren't in the top 1M and that have a score of at least 50. Updated nightly via https://github.com/awendland/hacker-news-small-sites]]>
        </description>
        <link>https://news.ycombinator.com</link>
        <generator>RSS for Node</generator>
        <lastBuildDate>Thu, 15 Oct 2020 08:30:21 GMT</lastBuildDate>
        <atom:link href="https://raw.githubusercontent.com/awendland/hacker-news-small-sites/generated/feeds/hn-small-sites-score-50.xml" rel="self" type="application/rss+xml"></atom:link>
        <pubDate>Thu, 15 Oct 2020 08:30:21 GMT</pubDate>
        <language>
<![CDATA[en-US]]>
        </language>
        <managingEditor>
<![CDATA[me@alexwendland.com (Alex Wendland)]]>
        </managingEditor>
        <ttl>240</ttl>
        <item>
            <title>
<![CDATA[Towards Tactic Metaprogramming in Haskell]]>
            </title>
            <description>
<![CDATA[
Score 178 | Comments 34 (<a href="https://news.ycombinator.com/item?id=24759649">thread link</a>) | @headalgorithm
<br/>
October 12, 2020 | https://reasonablypolymorphic.com/blog/towards-tactics/index.html | <a href="https://web.archive.org/web/*/https://reasonablypolymorphic.com/blog/towards-tactics/index.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
    <center>
<img src="https://reasonablypolymorphic.com/images/fmaptree.gif">
</center>
<p>Isn’t it weird that we treat source code as text? That is, we have this extremely well-structured and strongly-typed object — the abstract syntax tree — that exists conceptually in our minds, and in actuality inside of our compiler, but for some reason we pretend it’s just a pile of bytes and edit it byte-by-byte rather than semantically?</p>
<p>When you stop and think about it, that’s like the stupidest idea ever. We as the authors don’t think of our code as bytes, nor does our interpreter or compiler. But instead we take the semantic understanding inside of our heads, serialize it into bytes, and then get the compiler to parse and rediscover the ideas inside our head. What a waste of effort.</p>
<p>Instead, you can use the incredible <a href="https://totbwf.github.io/">TOTBWF</a> and my new Tactics Plugin for the <a href="https://github.com/haskell/haskell-language-server">Haskell Language Server</a>, which will automatically and intelligently fill holes in your Haskell programs.</p>
<p>This blog post describes what a tactics engine is and why you want one, and is a good introduction to how in the hell we can automatically write your code for you.</p>
<h2 id="tactics">Tactics</h2>
<p>Imagine you’re pair programming with a junior engineer. In the navigator seat, you’ll be guiding your partner through the implementation, guiding them through the high-level strokes and letting them actually do the coding part. In order to implement <code>foldr :: (a -&gt; b -&gt; b) -&gt; b -&gt; [a] -&gt; b</code>, for example, the guidance you give your partner might be:</p>
<ol type="1">
<li>Bind the function arguments</li>
<li>Case split on the <code>[a]</code> parameter</li>
<li>If it’s <code>[]</code>, do the obvious thing</li>
<li>Otherwise call your function and recurse.</li>
</ol>
<p>These instructions aren’t a real program by any means, but you might call them a “program sketch.” The hard part of programming (thinking about what to do) is captured here, but <em>actually doing it</em> is left as an exercise to the reader.</p>
<p>A tactics engine transforms a program sketch like the above into an actual program. Tactics free us from the tyranny of text editing and pedantic details, allowing us to work at a higher semantic level of programming.</p>
<p>Tactics correspond to semantic operations over our program. Much like how the primitive commands in text editors (delete to end of line, insert parentheses, etc) can be composed to refine the textual representation of one program into the textual representation of another, we can compose small tactics in order to build larger ideas.</p>
<p>As an example, consider how we can fill in the following hole:</p>
<div id="cb1"><pre><code><span id="cb1-1"><span>data</span> <span>Id</span> a <span>=</span> <span>Id</span> a</span>
<span id="cb1-2"></span>
<span id="cb1-3"><span>instance</span> <span>Functor</span> <span>Id</span> <span>where</span></span>
<span id="cb1-4"><span>  fmap ::</span> (a <span>-&gt;</span> b) <span>-&gt;</span> <span>Id</span> a <span>-&gt;</span> <span>Id</span> b</span>
<span id="cb1-5">  <span>fmap</span> <span>=</span> _</span></code></pre></div>
<p>Rather than writing this function all at once, we can instead build it, one idea at a time. The first step is obviously to bind function arguments (the <code>intros</code> tactic), which results in the refined expression:</p>
<div id="cb2"><pre><code><span id="cb2-1"><span>fmap</span><span> ::</span> (a <span>-&gt;</span> b) <span>-&gt;</span> <span>Id</span> a <span>-&gt;</span> <span>Id</span> b</span>
<span id="cb2-2"><span>fmap</span> <span>=</span> \fab ida <span>-&gt;</span> _</span></code></pre></div>
<p>We’re left with a new hole, but this one is “smaller” than the old one; we’ve refined the previous hole, filling in some of its structure. As a result, the type of our new hole is <code>Id b</code>, and we now have both <code>fab :: a -&gt; b</code> and <code>ida :: Id a</code> in scope. We can simplify the hole further by now pattern matching on <code>ida</code> (the <code>destruct ida</code> tactic):</p>
<div id="cb3"><pre><code><span id="cb3-1"><span>fmap</span><span> ::</span> (a <span>-&gt;</span> b) <span>-&gt;</span> <span>Id</span> a <span>-&gt;</span> <span>Id</span> b</span>
<span id="cb3-2"><span>fmap</span> <span>=</span> \fab ida <span>-&gt;</span> <span>case</span> ida <span>of</span></span>
<span id="cb3-3">  <span>Id</span> a <span>-&gt;</span> _</span></code></pre></div>
<p>The resulting hole still has type <code>Id b</code>, but we’ve now introduced <code>a :: a</code> in scope. Our next step is to build an <code>Id</code> value, which we can do by producing its data constructor (the <code>split</code> tactic):</p>
<div id="cb4"><pre><code><span id="cb4-1"><span>fmap</span><span> ::</span> (a <span>-&gt;</span> b) <span>-&gt;</span> <span>Id</span> a <span>-&gt;</span> <span>Id</span> b</span>
<span id="cb4-2"><span>fmap</span> <span>=</span> \fab ida <span>-&gt;</span> <span>case</span> ida <span>of</span></span>
<span id="cb4-3">  <span>Id</span> a <span>-&gt;</span> <span>Id</span> _</span></code></pre></div>
<p>Again we’ve shrunk the problem — now our hole has type <code>b</code>. At this point we can call the <code>fab</code> function to produce a <code>b</code> (via the <code>apply fab</code> tactic):</p>
<div id="cb5"><pre><code><span id="cb5-1"><span>fmap</span><span> ::</span> (a <span>-&gt;</span> b) <span>-&gt;</span> <span>Id</span> a <span>-&gt;</span> <span>Id</span> b</span>
<span id="cb5-2"><span>fmap</span> <span>=</span> \fab ida <span>-&gt;</span> <span>case</span> ida <span>of</span></span>
<span id="cb5-3">  <span>Id</span> a <span>-&gt;</span> <span>Id</span> (fab _)</span></code></pre></div>
<p>All that’s left is a hole with type <code>a</code>. Fortunately, we have <code>a :: a</code> in scope, so we can just plop that in to the hole via the <code>assumption</code> tactic:</p>
<div id="cb6"><pre><code><span id="cb6-1"><span>fmap</span><span> ::</span> (a <span>-&gt;</span> b) <span>-&gt;</span> <span>Id</span> a <span>-&gt;</span> <span>Id</span> b</span>
<span id="cb6-2"><span>fmap</span> <span>=</span> \fab ida <span>-&gt;</span> <span>case</span> ida <span>of</span></span>
<span id="cb6-3">  <span>Id</span> a <span>-&gt;</span> <span>Id</span> (fab a)</span></code></pre></div>
<p>And just like that, we’ve produced an implementation of our desired function! By thinking in terms of the semantic operations we’d like to perform at each hole (instead of how to manipulate the bytes of text), we’ve changed the level of abstraction at which we think about editing. The implications of this might not be immediately obvious, so let’s explore them together.</p>
<p>Let’s list the tactic steps we took to derive <code>fmap</code>:</p>
<div id="cb7"><pre><code><span id="cb7-1">intros</span>
<span id="cb7-2">destruct ida</span>
<span id="cb7-3">split</span>
<span id="cb7-4">apply fab</span>
<span id="cb7-5">assumption</span></code></pre></div>
<p>Up to alpha renaming, this composition of tactics is sufficient to derive <code>fmap</code> for any sum or product type that doesn’t do anything “exciting” with its type variable. By running the same steps, we can implement <code>fmap</code> for any of the following types:</p>
<div id="cb8"><pre><code><span id="cb8-1">(a, b)</span>
<span id="cb8-2"><span>Either</span> a b</span>
<span id="cb8-3"><span>Maybe</span> a</span>
<span id="cb8-4"><span>Const</span> a b</span></code></pre></div>
<p>Let’s convince ourselves of this by quickly running through the derivation for <code>Maybe a</code>. We start again with <code>fmap</code> and its type:</p>
<div id="cb9"><pre><code><span id="cb9-1"><span>fmap</span><span> ::</span> (a <span>-&gt;</span> b) <span>-&gt;</span> <span>Maybe</span> a <span>-&gt;</span> <span>Maybe</span> b</span>
<span id="cb9-2"><span>fmap</span> <span>=</span> _</span></code></pre></div>
<p>After running <code>intros</code>:</p>
<div id="cb10"><pre><code><span id="cb10-1"><span>fmap</span><span> ::</span> (a <span>-&gt;</span> b) <span>-&gt;</span> <span>Maybe</span> a <span>-&gt;</span> <span>Maybe</span> b</span>
<span id="cb10-2"><span>fmap</span> <span>=</span> \fab ma <span>-&gt;</span> _</span></code></pre></div>
<p>and then <code>destruct ma</code></p>
<div id="cb11"><pre><code><span id="cb11-1"><span>fmap</span><span> ::</span> (a <span>-&gt;</span> b) <span>-&gt;</span> <span>Maybe</span> a <span>-&gt;</span> <span>Maybe</span> b</span>
<span id="cb11-2"><span>fmap</span> <span>=</span> \fab ma <span>-&gt;</span> <span>case</span> ma <span>of</span></span>
<span id="cb11-3">  <span>Nothing</span> <span>-&gt;</span> _</span>
<span id="cb11-4">  <span>Just</span> a  <span>-&gt;</span> _</span></code></pre></div>
<p>Applying <code>split</code> here is a little tricky; technically it will force us to try both <code>Nothing</code> and <code>Just _</code> at each hole in a weird sort of quantum superposition. Let’s ignore this detail for right now, and come back to it immediately after finishing the derivation. Assuming we pick the right data cons, after <code>split</code> our program looks like this:</p>
<div id="cb12"><pre><code><span id="cb12-1"><span>fmap</span><span> ::</span> (a <span>-&gt;</span> b) <span>-&gt;</span> <span>Maybe</span> a <span>-&gt;</span> <span>Maybe</span> b</span>
<span id="cb12-2"><span>fmap</span> <span>=</span> \fab ma <span>-&gt;</span> <span>case</span> ma <span>of</span></span>
<span id="cb12-3">  <span>Nothing</span> <span>-&gt;</span> <span>Nothing</span></span>
<span id="cb12-4">  <span>Just</span> a  <span>-&gt;</span> <span>Just</span> _</span></code></pre></div>
<p>Now we run <code>apply fab</code>. Because <code>Nothing</code> doesn’t take any arguments, it didn’t produce any holes, so we need look only at the <code>Just</code> case:</p>
<div id="cb13"><pre><code><span id="cb13-1"><span>fmap</span><span> ::</span> (a <span>-&gt;</span> b) <span>-&gt;</span> <span>Maybe</span> a <span>-&gt;</span> <span>Maybe</span> b</span>
<span id="cb13-2"><span>fmap</span> <span>=</span> \fab ma <span>-&gt;</span> <span>case</span> ma <span>of</span></span>
<span id="cb13-3">  <span>Nothing</span> <span>-&gt;</span> <span>Nothing</span></span>
<span id="cb13-4">  <span>Just</span> a  <span>-&gt;</span> <span>Just</span> (fab _)</span></code></pre></div>
<p>and finally we run <code>assumption</code> to fill in the hole:</p>
<div id="cb14"><pre><code><span id="cb14-1"><span>fmap</span><span> ::</span> (a <span>-&gt;</span> b) <span>-&gt;</span> <span>Maybe</span> a <span>-&gt;</span> <span>Maybe</span> b</span>
<span id="cb14-2"><span>fmap</span> <span>=</span> \fab ma <span>-&gt;</span> <span>case</span> ma <span>of</span></span>
<span id="cb14-3">  <span>Nothing</span> <span>-&gt;</span> <span>Nothing</span></span>
<span id="cb14-4">  <span>Just</span> a  <span>-&gt;</span> <span>Just</span> (fab a)</span></code></pre></div>
<p>Look at that! Even though it would require significantly different editing commands to write the syntax of these two functor instances, they are both descried by the same composition of tactics. This is what I mean by “semantic editing,” we’re moving the algorithm for producing functor instances out of our heads and reifying it into something the computer understands. In essence, by writing <code>fmap</code> once, we can teach the computer how to write it for us in the future.</p>
<p>I mentioned earlier that <code>split</code> gives us some issues here. Reading closely, you’ll notice that there is nothing in our tactics that say we need to <code>split</code> the same data constructor that we just <code>destruct</code>ed. In actuality there are four different, valid programs that can be produced by the above set of tactics:</p>
<div id="cb15"><pre><code><span id="cb15-1"><span>fmap</span> <span>=</span> \fab ma <span>-&gt;</span> <span>case</span> ma <span>of</span></span>
<span id="cb15-2">  <span>Nothing</span> <span>-&gt;</span> <span>Nothing</span></span>
<span id="cb15-3">  <span>Just</span> a  <span>-&gt;</span> <span>Nothing</span></span>
<span id="cb15-4"></span>
<span id="cb15-5"><span>fmap</span> <span>=</span> \fab ma <span>-&gt;</span> <span>case</span> ma <span>of</span></span>
<span id="cb15-6">  <span>Nothing</span> <span>-&gt;</span> <span>Nothing</span></span>
<span id="cb15-7">  <span>Just</span> a  <span>-&gt;</span> <span>Just</span> (fab a)</span>
<span id="cb15-8"></span>
<span id="cb15-9"><span>fmap</span> <span>=</span> \fab ma <span>-&gt;</span> <span>case</span> ma <span>of</span></span>
<span id="cb15-10">  <span>Nothing</span> <span>-&gt;</span> <span>Just</span> _</span>
<span id="cb15-11">  <span>Just</span> a  <span>-&gt;</span> <span>Nothing</span></span>
<span id="cb15-12"></span>
<span id="cb15-13"><span>fmap</span> <span>=</span> \fab ma <span>-&gt;</span> <span>case</span> ma <span>of</span></span>
<span id="cb15-14">  <span>Nothing</span> <span>-&gt;</span> <span>Just</span> _</span>
<span id="cb15-15">  <span>Just</span> a  <span>-&gt;</span> <span>Just</span> (fab a)</span></code></pre></div>
<p>Choosing the “best” implementation of these possibilities is largely a matter of heuristics, which I plan to describe in a later post. For now, let’s just assume our tactics engine is smart enough to come up with the one you had in mind.</p>
<p>Of course, the real issue here is that nothing forces our <code>destruct</code> and <code>split</code> tactics to use the same data constructor. We can eliminate this ambiguity by noticing that in <code>fmap</code>, we’re not actually trying to destruct and then split, but instead we’re trying to implement a homomorphism (a structure-preserving function.) In order to preserve structure, we’d better map a data constructor to itself. So instead, let’s use the <code>homo</code> tactic instead of <code>destruct</code> and <code>split</code>. Our new tactics metaprogram for writing functor instances is thus:</p>
<div id="cb16"><pre><code><span id="cb16-1">intros</span>
<span id="cb16-2">homo ida</span>
<span id="cb16-3">apply fab</span>
<span id="cb16-4">assumption</span></code></pre></div>
<p>This new version now can no longer generate any of the pathological <code>fmap</code> implementations for <code>Maybe</code>, as they are not structure preserving. We’re left only with the good implementation. Let’s do one more derivation, this time for <code>Either c a</code>. After <code>intros</code> and <code>homo eca</code>, we’re left with:</p>
<div id="cb17"><pre><code><span id="cb17-1"><span>fmap</span><span> ::</span> (a <span>-&gt;</span> b) <span>-&gt;</span> <span>Either</span> c a <span>-&gt;</span> <span>Either</span> c b</span>
<span id="cb17-2"><span>fmap</span> <span>=</span> \fab ma <span>-&gt;</span> <span>case</span> eca <span>of</span></span>
<span id="cb17-3">  <span>Left</span>  c <span>-&gt;</span> <span>Left</span> _</span>
<span id="cb17-4">  <span>Right</span> a <span>-&gt;</span> <span>Right</span> _</span></code></pre></div>
<p>For the first time, we’re now left with <em>two</em> holes. The default behavior is for a tactic to apply to all holes (although there are combinators for “zipping” holes), meaning that the <code>apply fab</code> tactic will be run on both holes. For the <code>Left</code> case, our hole has type <code>c</code>, but <code>fab _</code> has type <code>b</code>, so this tactic <em>fails to apply here.</em> Tactic failure is per-hole, so we can still apply it to the other hole, resulting in:</p>
<div id="cb18"><pre><code><span id="cb18-1"><span>fmap</span><span> ::</span> (a <span>-&gt;</span> b) <span>-&gt;</span> <span>Either</span> c a <span>-&gt;</span> <span>Either</span> c b</span>
<span id="cb18-2"><span>fmap</span> <span>=</span> \fab ma <span>-&gt;</span> <span>case</span> eca <span>of</span></span>
<span id="cb18-3">  <span>Left</span>  c <span>-&gt;</span> <span>Left</span> _</span>
<span id="cb18-4">  <span>Right</span> a <span>-&gt;</span> <span>Right</span> (fab _)</span></code></pre></div>
<p>And finally, <code>assumption</code> fills the hole with whatever would typecheck. In the first hole that’s <code>c</code>, and in the second it’s <code>a</code> as before.</p>
<div id="cb19"><pre><code><span id="cb19-1"><span>fmap</span><span> ::</span> (a <span>-&gt;</span> b) <span>-&gt;</span> <span>Either</span> c a <span>-&gt;</span> <span>Either</span> c b</span>
<span id="cb19-2"><span>fmap</span> <span>=</span> \fab ma <span>-&gt;</span> <span>case</span> eca <span>of</span></span>
<span id="cb19-3">  <span>Left</span>  c <span>-&gt;</span> <span>Left</span> c</span>
<span id="cb19-4">  <span>Right</span> a <span>-&gt;</span> <span>Right</span> (fab a)</span></code></pre></div>
<p>Amazing! Three different functor implementations, with different numbers of data constructors, type variables, and cardinalities. By programming at the level of tactics rather than bytes, we can ignore the superficial differences between these implementations, focusing instead on the fact that they’re all derived the same way.</p>
<p>Hopefully this post has given you some insight into what tactics are and why they’re valuable. In the next post we’ll look at how this stuff is implemented behind the scenes, and the difficulties we’ve had integrating it into the language server. Stay tuned!</p>

<p>
    <span>
        <a href="https://reasonablypolymorphic.com/blog/algebra-driven-design">←</a>
    </span>
</p>

</div></div>]]>
            </description>
            <link>https://reasonablypolymorphic.com/blog/towards-tactics/index.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-24759649</guid>
            <pubDate>Mon, 12 Oct 2020 21:30:45 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Durability: Linux File APIs]]>
            </title>
            <description>
<![CDATA[
Score 89 | Comments 38 (<a href="https://news.ycombinator.com/item?id=24758024">thread link</a>) | @zdw
<br/>
October 12, 2020 | https://www.evanjones.ca/durability-filesystem.html | <a href="https://web.archive.org/web/*/https://www.evanjones.ca/durability-filesystem.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>

<h3>[ 2020-October-12 10:26 ]</h3>
<p>As part of investigating the durability provided by cloud systems, I wanted to make sure I understood the basics. I started by <a href="https://www.evanjones.ca/durability-nvme.html">reading the NVMe specification, to understand the guarantees provided by disks</a>. The summary is that you should assume your data is corrupt between when a write is issued until after a flush or force unit access write completes. However, most programs use system calls to write data. This article looks at the guarantees provided by the Linux file APIs. It seems like this should be simple: a program calls <code>write()</code> and after it completes, the data is durable. However, <code>write()</code> only copies data from the application into the kernel's cache in memory. To force the data to be durable you need to use some additional mechanism. This article is a messy collection of notes about what I've learned. (The really brief summary: use fdatasync or open with O_DSYNC.) For a better and clearer overview, see LWN's <a href="https://lwn.net/Articles/457667/">Ensuring data reaches disk</a>, which walks from application code through to the disk.</p>


<h2>The semantics of write()</h2>

<p>The write system call is defined in the <a href="https://en.wikipedia.org/wiki/POSIX">IEEE POSIX standard</a> as attempting to write data to a file descriptor. After it successfully returns, reads are required to return the bytes that were written, even when read or written by other processes or threads (<a href="https://pubs.opengroup.org/onlinepubs/9699919799/functions/write.html#tag_16_685_08">POSIX standard write(); Rationale</a>). There is an addition note under <a href="https://pubs.opengroup.org/onlinepubs/9699919799/functions/V2_chap02.html#tag_15_09_07">Thread Interactions with Regular File Operations</a> that says "If two threads each call one of these functions, each call shall either see all of the specified effects of the other call, or none of them." This suggests that all file I/O must effectively hold a lock.</p>

<p>Does that mean write is atomic? Technically, yes: future reads must return the entire contents of the write, or none of it. However, write is not required to be <em>complete</em>, and is allowed to only transfer <em>part</em> of the data. For example, we could have two threads, each appending 1024-bytes to a single file descriptor. It would be acceptable for the two writes to each only write a single byte. This is still "atomic", but also results in undesirable interleaved output. There is a great <a href="https://stackoverflow.com/a/42442926/413438">StackOverflow answer with more details</a>.</p>


<h2>fsync/fdatasync</h2>

<p>The most straightforward way to get your data on disk is to call <a href="https://man7.org/linux/man-pages/man2/fsync.2.html">fsync()</a>. It requests the operating system to transfer all modified blocks in cache to disk, along with all file metadata (e.g. access time, modification time, etc). In my opinion, that metadata is rarely useful, so you should use fdatasync unless you know you need the metadata. The <a href="https://man7.org/linux/man-pages/man2/fdatasync.2.html">fdatasync man page</a> says it is required to flush as much metadata as necessary "for a subsequent data read to be handled correctly", which is what most applications care about.</p>

<p>One issue is this is not guaranteed to ensure you can <em>find</em> the file again. In particular, when you first create a file, you need to call fsync on the directory that contains it, otherwise it might not exist after a failure. The reason is basically that in UNIX, a file can exist in multiple directories due to hard links, so when you call fsync on a file, there is no way to tell which directories should be written out (<a href="https://www.quora.com/When-should-you-fsync-the-containing-directory-in-addition-to-the-file-itself">more details</a>). It appears that ext4 may actually <a href="https://lwn.net/Articles/799807/">fsync the directory automatically, but that might not be true for other filesystems</a>.</p>

<p>The way this is implemented will vary depending on the file system. I used <a href="https://git.kernel.org/pub/scm/linux/kernel/git/axboe/blktrace.git/tree/README">blktrace</a> to examine what disk operations ext4 and xfs use. They both issue normal disk writes for both the file data and the file system journal, use a cache flush, then finish with a FUA write to the journal, probably to indicate the operation has committed. On disks that do not support FUA, this involves two cache flushes. My experiments show that fdatasync is slightly faster than fsync, and blktrace shows fdatasync tends to write a bit less data (ext4: 20 kiB for fsync vs 16 kiB for fdatasync). My experiments also show that xfs is slightly faster than ext4, and again blktrace shows it tends to flush less data (xfs: 4 kiB for fdatasync).</p>


<h2>fsync controversies</h2>

<p>In my professional career, I can remember three fsync-related controversies. The first, in 2008, was that Firefox 3's UI would hang when lots of files were being written. The problem is the UI used the SQLite database to save state, which provides strong durability guarantees by calling fsync after each commit. On the ext3 filesystem of the time, fsync wrote out <em>all</em> dirty pages on the system, rather than just the relevant file. This meant that clicking a button in Firefox could wait for many megabytes of data to be written on magnetic disks, which could take seconds. The solution, as I understand <a href="http://shaver.off.net/diary/2008/05/25/fsyncers-and-curveballs/">from a blog</a>, was to move many database commits to asynchronous background tasks. This means Firefox was previously using stronger durability guarantees than it needed, although the problem was made much worse by the ext3 filesystem.</p>

<p>The second controversy, in 2009, was that after a system crash, users of the new ext4 filesystem found many recently created files would have zero length, which did not happen with the older ext3 filesystem. In the previous controversy, ext3 was flushing too much data, which caused really slow fsync calls. To fix it, ext4 flushes only the relevant dirty pages to disk. For other files, it keeps them in memory for much longer to improve performance (defaulting to 30 seconds, configured with <a href="https://www.kernel.org/doc/Documentation/sysctl/vm.txt">dirty_expire_centiseconds</a>; <a href="https://www.spinics.net/lists/linux-ext4/msg68941.html">note</a>). This means after a crash, lots of data might be missing. The solution is to add fsyncs to applications that want to ensure data will survive crashes, since fsyncs are much more efficient with ext4. The downside is this still makes operations like installing software slower. For more details, see <a href="https://lwn.net/Articles/322823/">LWN's article</a>, or <a href="https://thunk.org/tytso/blog/2009/03/12/delayed-allocation-and-the-zero-length-file-problem/">Ted Ts'o's explaination</a>.</p>

<p>The third controversy, in 2018, is that Postgres discovered that when fsync encounters an error, it can mark dirty pages as "clean", so future calls to fsync do nothing. This leaves modified pages in memory that are never written to disk. This is pretty catastrophic, since the application thinks some data has been written, but it has not. There are very few things an application can do in this rare case when fsync fails. Postgres and many other applications now crash when it happens. A paper titled <a href="https://www.usenix.org/conference/atc20/presentation/rebello">Can Applications Recover from fsync Failures?</a> published in USENIX ATC 2020 investigates the issue in detail. The best solution at the moment is to use Direct I/O with O_SYNC or O_DSYNC, which will report errors on specific write operations, but requires the application to manage buffers itself. For more details, see the <a href="https://lwn.net/Articles/752063/">LWN article</a> or the <a href="https://wiki.postgresql.org/wiki/Fsync_Errors">Postgres wiki page about fsync errors</a>.</p>


<h2>open with O_SYNC/O_DSYNC</h2>

<p>Back to system calls for durability. Another option is to use the O_SYNC or O_DSYNC options with the <a href="https://man7.org/linux/man-pages/man2/open.2.html">open() system call</a>. This causes every write to have the same semantics as a write followed by fsync/fdatasync, respectively. The POSIX specification calls this <a href="https://pubs.opengroup.org/onlinepubs/009695399/basedefs/xbd_chap03.html#tag_03_373">Synchronized I/O File Integrity Completion and Data Integrity Completion</a>. The main advantage of this approach is that you need a single system call, instead of write followed by fdatasync. The biggest disadvantage is that all writes using that file descriptor will be synchronized, which may limit how the application code is structured.</p>


<h2>Direct I/O with O_DIRECT</h2>

<p>The open() system call has an O_DIRECT option which is intended to bypass the operating system's cache, and instead do I/O directly with the disk. This means in many cases, an application's write call will translate directly into a disk command. However, in general this is not a replacement for fsync or fdatasync, since the <a href="https://www.evanjones.ca/durability-nvme.html">disk itself is free to delay or cache those writes</a>. Even worse, there are <a href="https://ext4.wiki.kernel.org/index.php/Clarifying_Direct_IO%27s_Semantics">edge cases that mean O_DIRECT I/O falls back to traditional buffered I/O</a>. The easiest solution is to also use the O_DSYNC option to open, which means each write is effectively followed by fdatasync.</p>

<p>It turns out that XFS somewhat recently added a "fast path" for O_DIRECT|O_DSYNC writes. If you are overwriting blocks with O_DIRECT|O_DSYNC, XFS will issue a FUA write if the device supports it, rather than using a cache flush. I used blktrace to confirm this happens on my Linux 5.4/Ubuntu 20.04 system. This should be more efficient, since it writes the minimum amount of data to disk, and uses a single operation instead of a write followed by a cache flush. I found a link to the <a href="https://patchwork.kernel.org/patch/10250257/">kernel patch that implemented this in 2018</a>, which has some discussion about implementing this optimization for other filesystems, but as far as I know XFS is the only one that does.</p>


<h2>sync_file_range</h2>

<p>Linux also has <a href="https://man7.org/linux/man-pages/man2/sync_file_range.2.html">sync_file_range</a>, which can allow flushing <em>part</em> of a file to disk, rather than the entire file, and triggering an asynchronous flush, rather than waiting for it. However, the man page states that it is "extremely dangerous" and discourages its use. The best description of some of the differences and dangers with sync_file_range is <a href="http://yoshinorimatsunobu.blogspot.com/2014/03/how-syncfilerange-really-works.html">Yoshinori Matsunobu's post about how it works</a>. Notably, it seems that RocksDB uses this to control when the kernel flushes dirty data to disk, and still uses fdatasync to ensure durability. It <a href="https://github.com/facebook/rocksdb/search?q=sync_file_range">has some interesting comments in its source code</a>. For example, it appears that with zfs, the sync_file_range call does not actually flush data. Given my experience that code that is rarely used probably has bugs, I would recommend avoiding this system call without very good reasons.</p>


<h2>System calls for durable I/O</h2>

<p>My conclusion is there are basically three approaches for durable I/O. All of them require you to call fsync() on the containing directory when you first create a file.</p>

<ol>
<li>fdatasync or fsync after a write (prefer fdatasync).</li>
<li>write on a file descriptor opened with O_DSYNC or O_SYNC (prefer O_DSYNC).</li>
<li>pwritev2 with the RWF_DSYNC or RWF_SYNC flag (prefer RWF_DSYNC).</li>
</ol>


<h2>Some random performance observations</h2>

<p>I have not measured these carefully, and many of these differences are very small, which means they could be false, or are highly likely to change. These are roughly ordered from …</p></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://www.evanjones.ca/durability-filesystem.html">https://www.evanjones.ca/durability-filesystem.html</a></em></p>]]>
            </description>
            <link>https://www.evanjones.ca/durability-filesystem.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-24758024</guid>
            <pubDate>Mon, 12 Oct 2020 18:55:27 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Advice to my young self: forget side projects and focus on your job]]>
            </title>
            <description>
<![CDATA[
Score 409 | Comments 337 (<a href="https://news.ycombinator.com/item?id=24758020">thread link</a>) | @megalomanu
<br/>
October 12, 2020 | https://manuel.darcemont.fr/posts/focus-on-jour-job/ | <a href="https://web.archive.org/web/*/https://manuel.darcemont.fr/posts/focus-on-jour-job/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><p>I’ve always been suspicious of the idea of being attached to a company.</p><p>It could be because of the leftist spirit of my generation in France, or because of my readings during my student years, or because of my familial history (which saw way more self-employed, farmers, nurses or teachers than company employees), but I’ve never accepted the idea of giving even a tiny portion of my independence of mind to a company. When I was a student, I wasn’t dreaming about joining a company like Google, who seemed too sectarian to me, to rather prefer boring companies, where we only expect you to work well. Keeping a distance from my company was, I thought, the way to stay <em>who I am</em>, without being infected by an external force.</p><p>It doesn’t mean that I didn’t care about my job. I’ve always been involved in my work, being proactive in bringing new technologies, mentoring the other developers, helping the team to grow, but I was doing this just because I liked my job. I was not considering this as something important in my career, simply because I didn’t want too. To develop my career, I was spending a lot of time outside work reading technical books, doing toy projects, going to meetups, browsing Hacker News. I was finding here what my company was fundamentally unable to give me, and I was feeling holding my fate in my own hands. I thought it was the best recipe to end with a successful career, while remaining free and protected from the meanders of corporate culture (or corporate politics, actually).</p><p>I was wrong.</p><p>First, most recruiters don’t care about your personal projects or how many meetups you went during the year.
What matters the most is your current company - and by that I mean the name of your current company. It was saddening me before, but now that I’m on the other side today, with a manager position, I better understand this. This is plain common sense. You can generally assume that a developer coming from a cutting-edge company has better chances to be a great developer than a developer coming from a Java 1.4 shop. He may not be smarter, but he has been hired by a company with a most demanding hiring process, and has been surrounded by some of the smartest developers.</p><p>Worse, having too many personal projects can raise a flag and be scary for the recruiter. When my entrepreneurial experience has been over, I was disappointed and somewhat regretful of some of our choices, but generally proud of everything we did and excited to share my story to recruiters. I was surprised to see that most of them were only asking questions about my previous experiences as an employee. My CTO experience was an anomaly, at best two lost years, at worst a sign that I was too independent, too individualistic, not a good team player. Only relatively small and ambitious startups, like the one I’m in today, were valuing this experience.<br>Today, I recommend not hiding your side projects, but to not displaying them as a primary part of your identity, to not scare the recruiter and let him feel that you have a secondary plan.</p><p>Secondly, I don’t think that multiplying the side projects is useful unless they are substantial.
Side projects that we consider futile, that we do just to get away from our daily work, don’t make us better in our job. The things that make us progress are the issues we want to avoid and that generally come only when your toy project has been transformed into a product and when you have to deal with users, production issues, and money (your money). Basically, all the things that no one wants to do on his free time. Even from a purely technical point of view, you will not really understand a library or a framework by just sticking to the tutorial or its basic features. You’ll have to dig into and to face its most painful aspects to deeply understand it.</p><p>Shallow side projects are useful to develop a first opinion about a technology that will need to be confirmed with a more elaborate project. I’d compare them to school.<br>When I was a teenager, I remember what we were saying about it: <em>it will never help us in our future job</em>. After all, how teachings about antiderivatives, Rimbaud’s poetry or Napoleonic wars could be useful for our future adult life? We were right. Most of what we learned is pretty useless today, whether you are a cook, a hairdresser or a developer.<br>But this formed a complete package that infuses our adult life. Junior school is great because you don’t learn to find a job. You’re at school to grow as a citizen, not to prepare to your future life, and actually you’re better not to think about your future if you don’t want to question yourself about the meaning of your existence. This is the same thing for side projects. See them as a way to discover a new topic and enlarge your horizon, not as something that you could action in your current position or to find a new job. Otherwise, you expose yourself to severe disillusions.</p><p>The best way to dig a new technology is to practice it in your daily job. You’ll spend seven hours a day on it and will quickly become infinitely more proficient than if you just barely used it on nights and weekends. You may tell me that we face a chicken or egg problem here. How to get a job where you’ll work on a really attractive technology if you never used it before? Well, instead of spending nights superficially learning this technology, spend your nights preparing interviews. Read “Cracking the code interview”, learn everything you need to know about algorithms and binary trees. As we all know, the interview process is broken. Instead of deploring it, take advantage of it.</p><p>I don’t want to make this blog post a rant against side projects. In fact, I’m advocating the exact opposite. Continue to do as many side projects as ever, code on nights and weekends if you want to, but don’t do them because you think they could be useful to you to get a new job. This is wrong. I know too many developers who are stuck into this pipe dream. This is an illusion and this leads to a waste of time and energy.</p><p>Don’t create a project just to prove that you know Vue.js, but use this weird technology that you saw yesterday on Hacker News and that intrigues you. Don’t think about what are the best (and boring) blog post topics that could expand your personal branding, but write poetry or a review of the last movie you saw. Create the apps, services, websites, or video games you want to use. These side-projects are truly great. They may not make your portfolio or your public image convincing for the next recruiter you’ll meet, but this is how you will be able to express all that you have in you and end up affirming yourself. At least, you should end having something meaningful to show, something to be proud about.</p><p>You want to feel free and have time for your projects? Focus your efforts on joining a great company. This will make your career considerably easier and will make you as free as you wanted to be initially. The link you’ll develop with your company will be a source of discomfort sometimes, but it will protect you from the never-ending competition on the job market. The satisfaction of seeing your career flourishing while you will use all your free time to do what you like (including… side projects) will give you a valuable peace of mind.<br>By trading a little bit of what you think is your independence, you’ll get the real one.</p></div></div>]]>
            </description>
            <link>https://manuel.darcemont.fr/posts/focus-on-jour-job/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24758020</guid>
            <pubDate>Mon, 12 Oct 2020 18:55:12 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Zheap – Reinvented PostgreSQL Storage]]>
            </title>
            <description>
<![CDATA[
Score 242 | Comments 63 (<a href="https://news.ycombinator.com/item?id=24757333">thread link</a>) | @PhilipTrauner
<br/>
October 12, 2020 | https://cybertec-postgresql.github.io/zheap/ | <a href="https://web.archive.org/web/*/https://cybertec-postgresql.github.io/zheap/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
        <p>
  <img width="500px" src="https://media.githubusercontent.com/media/cybertec-postgresql/zheap/master/img/zheap.png">
  <br>
  <i>Reinvented PostgreSQL Storage</i>
</p>

<hr>

<p>
  <a href="#about">About</a> •
  <a href="#contributing">Contributing</a> •
  <a href="#status">Status</a> •
  <a href="#documentation">Documentation</a> •
  <a href="#benchmarks">Benchmarks</a> •
  <a href="#contact">Contact</a>
</p>

<p><a href="https://github.com/postgres/postgres/tree/REL_13_STABLE"><img src="https://img.shields.io/badge/postgres-13-blue.svg" alt="Postgres 13"></a>
<a href="https://github.com/cybertec-postgresql/postgres/tree/REL_13_ZHEAP"><img src="https://img.shields.io/badge/status-early%20development-orange" alt="Status"></a></p>

<h2 id="about">About</h2>

<p><em>zheap</em> is a way to <strong>keep table bloat under control</strong> by implementing a new PostgreSQL storage engine capable of running <strong><code>UPDATE</code>-intense workloads</strong> more efficiently. The project was originally started by <a href="https://www.enterprisedb.com/">EnterpriseDB</a>.</p>

<p>To make <em>zheap</em> ready for production, we are proud to announce that our partners at <a href="https://heroiclabs.com/">Heroic Labs</a> have committed to <strong>fund the development</strong> of <em>zheap</em> and <strong>release all code to the community</strong>. <a href="https://www.cybertec-postgresql.com/en/">CYBERTEC</a> has decided to <strong>double the funding amount</strong>, and to put up additional expertise and manpower to move <em>zheap</em> forward.</p>

<h3 id="why">Why?</h3>

<p>Table bloat describes the phenomenon of tables and / or indices growing in size, even if the amount of data stored in the database stays constant. If one wants to support transactions it is necessary not to overwrite data in case it is rolled back.</p>

<p>PostgreSQL copies rows on <code>UPDATE</code> and stores them in the same table. Stale rows are periodically garbage-collected by an automatic process called <a href="https://www.postgresql.org/docs/current/sql-vacuum.html">VACUUM</a>. Problems start to crop up in <code>UPDATE</code>-heavy workloads, as VACUUM might not always be able to keep up.</p>

<h3 id="how">How?</h3>

<p>CYBERTEC has started a <a href="https://www.cybertec-postgresql.com/en/zheap-reinvented-postgresql-storage/">series of blog posts</a> that go into the design-goals of <em>zheap</em>.</p>

<h2 id="contributing">Contributing</h2>

<p>There are a number of active branches that will be merged together once they reach maturity.</p>

<ul>
  <li><a href="https://github.com/cybertec-postgresql/postgres/tree/zheap_logical_decoding">Logical decoding</a></li>
  <li><a href="https://github.com/cybertec-postgresql/postgres/tree/undo-record-set-ah">Undo record set</a></li>
  <li><a href="https://github.com/cybertec-postgresql/postgres/tree/REL_13_ZHEAP">Rebase on PostgreSQL 13</a></li>
</ul>

<h2 id="status">Status</h2>

<ul>
  <li>12-10-2020: <a href="https://github.com/cybertec-postgresql/postgres/blob/REL_13_ZHEAP/src/test/README.md">Most regression tests are passing</a>, but write-speeds are still low.</li>
</ul>

<h2 id="documentation">Documentation</h2>

<p>Managed through <a href="https://github.com/cybertec-postgresql/zheap/wiki">GitHub Wiki</a>.</p>

<h2 id="benchmarks">Benchmarks</h2>

<p>Will be conducted at a later date, as no attempts at performance tuning have been made yet.</p>



<ul>
  <li><a href="https://github.com/cybertec-postgresql/postgres/issues">Development</a></li>
  <li><a href="https://www.cybertec-postgresql.com/en/contact/">Business</a></li>
</ul>

    </div></div>]]>
            </description>
            <link>https://cybertec-postgresql.github.io/zheap/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24757333</guid>
            <pubDate>Mon, 12 Oct 2020 18:00:12 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Why Software Developers Suck at UX]]>
            </title>
            <description>
<![CDATA[
Score 59 | Comments 78 (<a href="https://news.ycombinator.com/item?id=24756902">thread link</a>) | @arvando
<br/>
October 12, 2020 | http://www.cakewalklabs.com/blog/2020/10/12/why-software-developers-suck-at-ux | <a href="https://web.archive.org/web/*/http://www.cakewalklabs.com/blog/2020/10/12/why-software-developers-suck-at-ux">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><div data-layout-label="Post Body" data-type="item" data-updated-on="1602523706766" id="item-5f8491cd13e290350fb22d87"><div><div><div data-block-type="2" id="block-131cb583c4d6196dd9ed"><div><p><em>Note: “Generally speaking” should be placed in front of basically every sentence in this post. These conclusions are completely based on my own subjective experiences of working in Silicon Valley for 3 years, running a startup for 2 and freelancing for 5.</em></p><p>I get brought into a lot of projects where the engineering team had created user flows and user interfaces, then either pre launch through user testing or post launch through user feedback, the client discovered those designs were far too complex for their end users. So why do those engineers suck at design? They’re far smarter than me, they understand their domain much better than me, and they’ve been working on that specific problem for many months or years. In fact, it’s so rare for a good engineer to be a great UX designer that they're called ‘unicorns’.</p><p>One of the more obvious reasons is that because they’ve been working on the specific problem for so long they have blinders on, and can no longer view it from a 30,000 ft view. There might be emotional attachment to already existing solutions that were thought up months ago. But the reason I wanna mainly talk about is that engineers, developers, whatever you want to call them, function in a different way than the general population, who tend to be the end users. When engineers are developing products strictly for other engineers, like a Chrome extension for debugging code or some sort of command line tool for example, their UX is fantastic. This is where the idea of building something for yourself comes from. So that means they don’t actually suck at design.</p><p>But when they have to design something for someone whose mind doesn’t work like an engineer, it’s a different story. They feel like things are getting “dumbed down” too much, and that “obviously this makes sense”, when for their end user it does not. There is too much of a disconnect between their understanding and mental framework of technology compared with the common person, and a larger amount of empathy is needed to bridge that gap. And that amount of empathy is hard to fake. I imagine that it’s like when you’re trying to explain something technologically mundane in your world, say, Instagram Stories, to your grandma who can barely send email. Bridging that gap requires a larger amount of empathy and patience, not because your grandma is dumb, but because her mental framework of technology is quite different than yours.</p><p>So why is it that UX designers supposedly have the ability to bridge that gap with everyone? I think great UX designers just grew up naturally having much more empathy towards others and having a much better ability to place themselves in others shoes and see the world from their eyes. I would argue that generally speaking in the real world this is a burden, when others can’t empathize with you but all you can do is empathize with them… makes it really difficult to not take on other’s pain, to not be the one who bends their rules to accommodate others, to not have solid boundaries, to not be as defensive in arguments. But in the technology world, that allows for great user friendly designs.</p></div></div></div></div></div></div></div>]]>
            </description>
            <link>http://www.cakewalklabs.com/blog/2020/10/12/why-software-developers-suck-at-ux</link>
            <guid isPermaLink="false">hacker-news-small-sites-24756902</guid>
            <pubDate>Mon, 12 Oct 2020 17:29:10 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Kautilya Arthashastra and its relevance to Urban Planning Studies [pdf]]]>
            </title>
            <description>
<![CDATA[
Score 52 | Comments 38 (<a href="https://news.ycombinator.com/item?id=24756863">thread link</a>) | @jelliclesfarm
<br/>
October 12, 2020 | http://www.itpi.org.in/uploads/journalfiles/jan8_10.pdf | <a href="https://web.archive.org/web/*/http://www.itpi.org.in/uploads/journalfiles/jan8_10.pdf">archive.org</a>
<br/><!-- hnss:readable-content --><hr/>Unable to retrieve article]]>
            </description>
            <link>http://www.itpi.org.in/uploads/journalfiles/jan8_10.pdf</link>
            <guid isPermaLink="false">hacker-news-small-sites-24756863</guid>
            <pubDate>Mon, 12 Oct 2020 17:25:32 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Don’t pay for 95% (2016)]]>
            </title>
            <description>
<![CDATA[
Score 245 | Comments 369 (<a href="https://news.ycombinator.com/item?id=24755614">thread link</a>) | @PascLeRasc
<br/>
October 12, 2020 | https://5kids1condo.com/dont-pay-for-95/ | <a href="https://web.archive.org/web/*/https://5kids1condo.com/dont-pay-for-95/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="container">
	
		

		
		
	<div id="main">	
			
	<div>	
<div id="content">
	
			
<div>
<article id="post-793">
	
	
			
				
		<div>				
			<p>Your car sits idle over <a href="http://www.reinventingparking.org/2013/02/cars-are-parked-95-of-time-lets-check.html">95% of the time</a>.</p>
<p>Your guest bedroom is occupied&nbsp;one week out of every 52.</p>
<p>Your kids use the yard less than <a href="http://www.usatoday.com/story/opinion/2012/10/04/backyards-overrated-outdoors-indoors/1613815/">40 minutes a week</a>.</p>
<p>Yet we consumers love to envision the maximum usage for a particular item – like a house or a car – then buy the item with a capacity high enough to accommodate our visions.&nbsp;It makes us feel prepared, it feeds our egos, and it feels as though we got more value for our money than if we’d bought something smaller.</p>
<p>We do this despite knowing that we won’t be boarding&nbsp;guests year ’round, driving groups of eight&nbsp;in our minivan, and hosting lavish backyard parties, nightly.</p>
<p>But rather than buy for peak usage, I prefer to stay flexible.</p>
<div id="attachment_810"><p><a href="http://5kids1condo.com/wp-content/uploads/2016/04/IMG_20160415_152650new.jpg"><img aria-describedby="caption-attachment-810" src="http://5kids1condo.com/wp-content/uploads/2016/04/IMG_20160415_152650new-1024x681.jpg" alt="" width="1024" height="681" srcset="https://5kids1condo.com/wp-content/uploads/2016/04/IMG_20160415_152650new-1024x681.jpg 1024w, https://5kids1condo.com/wp-content/uploads/2016/04/IMG_20160415_152650new-300x199.jpg 300w" sizes="(max-width: 1024px) 100vw, 1024px"></a></p><p id="caption-attachment-810">The kids in front of the Modo minivan we book every couple weeks or so. Just $8 an hour!</p></div>
<p>I scale my solutions up and down in response to my needs at the time.</p>
<p>Friends visiting from out of town? I’ll pay for their hotel, so I can live in a smaller, cheaper, better located condo for the rest of the year.</p>
<p>I have to schlep a bunch of kids far away? I’ll get a <a href="http://modo.coop/">Modo minivan</a>, a local car share, for a few hours. Let someone else maintain that gorgeous van.</p>
<p>Need some outdoors time? Walk a couple blocks to a park. I’m not interested in mowing something I only use a couple hours a week.</p>
<p>When I tell people this, they&nbsp;usually&nbsp;recoil at the cost. “Hotels are expensive!” “You RENT a car?!” They see only the short term price&nbsp;of my solutions.</p>
<p>They don’t see the other 95% of the time. The time when I didn’t need and therefore didn’t own or maintain those items.&nbsp;It’s in that 95% that I rack up huge savings. I make that 95% work <em>for me</em>, not against me.</p>
<p>Meanwhile, they’re living further out to afford that guest bedroom and yard, driving the $50,000 8-seater minivan, and paying for 5% usage,&nbsp;100% of the time.</p>
<div id="attachment_796"><p><a href="http://5kids1condo.com/wp-content/uploads/2016/04/IMG_20160327_114527-1.jpg"><img aria-describedby="caption-attachment-796" src="http://5kids1condo.com/wp-content/uploads/2016/04/IMG_20160327_114527-1-1024x766.jpg" alt="Being car-free, we're more likely to opt for active transportation modes - like biking. But we can scale up to vehicles when needed too." width="1024" height="766" srcset="https://5kids1condo.com/wp-content/uploads/2016/04/IMG_20160327_114527-1-1024x766.jpg 1024w, https://5kids1condo.com/wp-content/uploads/2016/04/IMG_20160327_114527-1-300x224.jpg 300w" sizes="(max-width: 1024px) 100vw, 1024px"></a></p><p id="caption-attachment-796">Being car-free, we’re more likely to opt for active transportation modes – like biking. But we can scale up to vehicles when needed too.</p></div>
<p>Not owning the high capacity solution also gives me huge flexibility. Do I need a two-seater car? Or a five-seater? Minivan, cargo van, sports car? I can access them all, only when I need them.</p>
<p>So what motivates&nbsp;people to plan for occasional peaks and idealized usage, rather than actual daily utilization?</p>
<p>Ego is part of it. A large SUV or huge house is still a sign of success to many. Your neighbours won’t congratulate you in your driveway for scaling up and&nbsp;down your transportation needs in a responsible, real-time fashion.</p>
<div id="attachment_797"><p><a href="http://5kids1condo.com/wp-content/uploads/2016/04/IMG_20160406_073653.jpg"><img aria-describedby="caption-attachment-797" src="http://5kids1condo.com/wp-content/uploads/2016/04/IMG_20160406_073653-1024x768.jpg" alt="For daily kid hauling, nothing beats the bus for price, independence and level of engagement." width="1024" height="768" srcset="https://5kids1condo.com/wp-content/uploads/2016/04/IMG_20160406_073653-1024x768.jpg 1024w, https://5kids1condo.com/wp-content/uploads/2016/04/IMG_20160406_073653-300x225.jpg 300w" sizes="(max-width: 1024px) 100vw, 1024px"></a></p><p id="caption-attachment-797">For daily kid hauling, nothing beats the bus for price, independence and level of engagement.</p></div>
<p>A mistaken sense of “value” is also at play. We’re often taught that “more is more,” up-selling ourselves to a larger house or car on the premise of “just in case.” It’s something we’ve all been guilty of at one time or another.</p>
<p>But&nbsp;next time a big decision comes up, try forgoing your ego and asking yourself if more really means more. Account for the hidden costs: longer commutes to a big house, higher&nbsp;expenses, more maintenance, etc. Try making a rational, needs-based decision. A decision&nbsp;based not on anticipated peaks, but on actual&nbsp;daily usage.</p>
<p><strong>In short, don’t pay for the 95% you won’t use.</strong></p>
<p>You’ll save a ton of money and gain a better quality of life.</p>
<div id="ts-fab-below"><p><span>The following two tabs change content below.</span></p><ul><li><a href="#ts-fab-bio-below">Bio</a></li><li><a href="#ts-fab-latest-posts-below">Latest Posts</a></li></ul><div>
	<div id="ts-fab-bio-below">
		<div><p><img src="https://secure.gravatar.com/avatar/ad8dc0b6838480ef540933f51be16685?s=80&amp;d=mm&amp;r=g" width="80" height="80" alt="Avatar"></p>
		</div>
		
		<div>
			<!-- /.ts-fab-header -->
			<p>Adrian Crook is a father of five living in beautiful downtown Vancouver, Canada. He's an advocate for rental housing and public transit.</p>
		</div>
	</div>
	<div id="ts-fab-latest-posts-below">
		<div><p><img src="https://secure.gravatar.com/avatar/ad8dc0b6838480ef540933f51be16685?s=80&amp;d=mm&amp;r=g" width="80" height="80" alt="Avatar"></p>
		</div>
		
	</div>
		</div>
	</div>					</div><!-- /entry-content -->
		
		
		
	</article><!-- /post-793 -->

</div><!-- /post-wrap -->		

		
			
</div><!-- /content -->

 
	<!-- /sidebar -->	
		</div><!-- /content-wrap -->
	</div><!-- /main -->
</div></div>]]>
            </description>
            <link>https://5kids1condo.com/dont-pay-for-95/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24755614</guid>
            <pubDate>Mon, 12 Oct 2020 15:45:13 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[I Tried to Reduce Pylint Memory Usage]]>
            </title>
            <description>
<![CDATA[
Score 241 | Comments 29 (<a href="https://news.ycombinator.com/item?id=24754397">thread link</a>) | @zdw
<br/>
October 12, 2020 | https://rtpg.co/2020/10/12/pylint-usage.html | <a href="https://web.archive.org/web/*/https://rtpg.co/2020/10/12/pylint-usage.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
      <div>
        
<div>

  

  <article>
    <p>Through work I have to deal with a pretty huge codebase, and run Pylint on it during our continuous integration process. It's always been a bit slow, but recently I also noticed that it was consuming a <em>lot</em> of memory, causing OOM failures if we tried to run it too much in parallel.</p>
<p>I decided to roll up my sleeves and figure out:</p>
<ul>
<li>What exactly was consuming so much memory?</li>
<li>Is there a way to avoid doing this?</li>
</ul>
<p>This is a log of how I went about these two questions, as future reference for when I do other profiling work in Python.</p>
<p>Looking at Pylint from the entrypoint(<code>pylint/__main__.py</code>), I end up digging downwards and finding the "quintessential" <code>for</code> loop that you would expect in a program that checks a bunch of files for errors:</p>
<pre><code>    def _check_files(self, get_ast, file_descrs):
            # in pylint/lint/pylinter.py
            with self._astroid_module_checker() as check_astroid_module:
                for name, filepath, modname in file_descrs:
                    self._check_file(get_ast, check_astroid_module, name, filepath, modname)
</code></pre>
<p>First I just threw in a <code>print("HI")</code> statement in there to confirm that this is indeed what's being run when I do <code>pylint my_code</code>, and that goes off without a hitch.</p>
<p>First is to try and figure out what's being held in memory, so I do a really basic "heap dump" with heapy to see if anything stands out</p>
<pre><code>        from guppy import hpy
        hp = hpy()
        i = 0
        for name, filepath, modname in file_descrs:
            self._check_file(get_ast, check_astroid_module, name, filepath, modname)
            i += 1
            if i % 10 == 0:
                print("HEAP")
                print(hp.heap())
            if i == 100:
                raise ValueError("Done")
</code></pre>
<p>My heap profiles end up being almost entirely "frame types" (which I was kind of expecting, for some reason), but also holding ont a bunch of tracebacks. Enough of these kinds of objects that I told myself "surely this is more than is needed".</p>
<pre><code>    Partition of a set of 2751394 objects. Total size = 436618350 bytes.
    Index  Count   %     Size   % Cumulative  % Kind (class / dict of class)
        0 429084  16 220007072  50 220007072  50 types.FrameType
        1 535810  19 30005360   7 250012432  57 types.TracebackType
        2 516282  19 29719488   7 279731920  64 tuple
        3 101904   4 29004928   7 308736848  71 set
        4 185568   7 21556360   5 330293208  76 dict (no owner)
        5 206170   7 16304240   4 346597448  79 list
        6 117531   4  9998322   2 356595770  82 str
        7  38582   1  9661040   2 366256810  84 dict of astroid.node_classes.Name
        8  76755   3  6754440   2 373011250  85 tokenize.TokenInfo
</code></pre>
<p>It's at this point that I discovered heapy's <a href="https://zhuyifei1999.github.io/guppy3/pbscreen.jpg">Profile Browser</a>, which seemed like a bit of a nicer way to look at this data</p>
<p>I switched up the heap mechanism to dump to a file every 10 iterations, then graph the entire runtime behaviour</p>
<pre><code>    for name, filepath, modname in file_descrs:
        self._check_file(get_ast, check_astroid_module, name, filepath, modname)
        i += 1
        if i % 10 == 0:
            hp.heap().stat.dump("/tmp/linting.stats")
        if i == 100:
            hp.pb("/tmp/linting.stats")
            raise ValueError("Done")
</code></pre>
<p>I get the following result, confirming that frames and tracebacks are a big deal in this run of Pylint:</p>
<p><a href="https://rtpg.co/files/pylint/browser-profile-1.png">
  <img src="https://rtpg.co/files/pylint/browser-profile-1.png">
</a></p>
<p>My next step is to actually look at the frame objects. Because Python is reference coutned, things are held in memory because <em>something</em> is pointing at them, so I'm going to try and find out which one.</p>
<p>The wonderful <code>objgraph</code> library takes advantage of the Python memory manager to let you look at all objects still in memory, as well as lookup references to an object.</p>
<p>It's actually very amazing that you can do this. Just have an object reference and you can find everything <em>pointing towards</em> that reference (there's some asterisks around C extensions but close enough). This is just wonderful technology for debugging, and another thing that makes Python a joy to work with, thanks to how much of CPython's internals are exposed for these kinds of tools.</p>
<p>First I struggled to find objects because <code>objgraph.by_type('types.TracebackType')</code> wasn't finding any objects, despite me having records of having half a million of them. Turns out the name to use was <code>traceback</code>. Didn't quite nail down why...</p>
<p><code>random.choice(objgraph.by_type('traceback'))</code></p>
<p>Gives me a "random traceback". <code>objgraph.show_backrefs</code> will draw a graph of objects referencing this traceback. </p>
<p>So I put an <code>import pdb; pdb.set_trace()</code> into the for loop after 100 iterations instead of just raising an exception, and I started looking at random tracebacks </p>
<pre><code>def exclude(obj):
    return 'Pdb' in str(type(obj))

def f(depth=7):
    objgraph.show_backrefs([random.choice(objgraph.by_type('traceback'))],
                            max_depth=depth,
                            filter=lambda elt: not exclude(elt))
</code></pre>
<p>Originally I was just seeing a chain of tracebacks, so I went for a depth of 100 and....</p>
<p><a href="https://rtpg.co/files/pylint/traceback-stack.png">
 <img src="https://rtpg.co/files/pylint/traceback-stack.png">
    </a>
  So a bunch of tracebacks referencing other tracebacks. Cool. So many of them were like this.</p>
<p>I ended up just trying a bunch and failing, so I went after a secondary target: the <code>frame</code> types. These also seemed suspicious to me, and whatI end up finding is something like the following:</p>
<p><a href="https://rtpg.co/files/pylint/traceback-nest.png">
 <img src="https://rtpg.co/files/pylint/traceback-nest.png">
 </a></p>
<p>So tracebacks are holding onto frames (hence some similar cardinality). It's all a big mess, but the frames were at least pointing to lines of code. And this made me realize something silly: <em>I had never bothered to actually look at the data using up so much memory</em>. I totally should have just looked at the traceback objects themselves.</p>
<p>So for this I ended up doing this in the most convoluted way possible, which is look at the addresses in the <code>objgraph</code> image dump, seeing the memory addresses, searching the web for "how do I get a Python object from its address" and ending up finding the neat trick that I had noted:</p>
<pre><code>ipdb&gt; import ctypes
ipdb&gt; ctypes.cast(0x7f187d22b880, ctypes.py_object)
py_object(&lt;traceback object at 0x7f187d22b880&gt;)
ipdb&gt; ctypes.cast(0x7f187d22b880, ctypes.py_object).value
&lt;traceback object at 0x7f187d22b880&gt;
ipdb&gt; my_tb = ctypes.cast(0x7f187d22b880, ctypes.py_object).value
ipdb&gt; traceback.print_tb(my_tb, limit=20)
</code></pre>
<p>You can just tell Python "hey look at this memory, it's definitely at least a python object" and it will work.</p>
<p>Later I realized I had references to these objects through <code>objgraph</code> and could just use that.</p>
<p>It looks like Astroid is building up tracebacks through exception handling code a bit all over the place. I feel like most "cool tricks" are gotten to by forgetting about the easy way to do something, so I won't complain too much.</p>
<p>The traceback itself had a bunch of lines going through Astroid, the AST parser backing Pylint. Progress! Astroid does seem like a program that might hold onto a lot of stuff in memory as its parsing files.</p>
<p>I look around and end up seeing the following line in <code>astroid/manager.py</code></p>
<pre><code>except Exception as ex:
    raise exceptions.AstroidImportError(
    "Loading {modname} failed with:\n{error}",
    modname=modname,
    path=found_spec.location,
) from ex
</code></pre>
<p>"Aha!" Itell myself. This is what I'm lookign for! Some sort of exception chain that would generate super long tracebacks. Plus it's file parsing so there's reccursion, etc... <code>raise thing from other_thing</code> would chain them together!</p>
<p>I remove this <code>from ex</code> and .... nothing. Memory usage is still basically the same, and the tracebacks are still here.</p>
<p>I remember that exceptions hold their local bindings in the tracebacks, so the <code>ex</code> is still accessible. It can't be garbage colleceted just yet! </p>
<p>I do a bunch of refactorings to try and remove the <code>except</code> block for the most part, at least to avoid the reference to <code>ex</code>. Again, nothing!</p>
<p>For the life of me I can't get these tracebacks to garbage collect, despite there being no references to them. At least I thought this was the remaining reference.</p>
<p>Really though, this was all a red herring. I don't know if this actually had anything to do with my memory leak, because at one point I started noticing that <strong>I had no evidence</strong> backing up this entire exception chaining theory. Just a bunch of hunches, plus half a million tracebacks. </p>
<p>I started just kind of randomly looking at tracebacks looking for any extra clues. I tried going up the chain of references by hand but was getting nowhere. </p>
<p>Then I had the revelation: these tracebacks are all stacked on top of each other, but there will be a traceback that is above all these other ones. There is a traceback that doesn't just have another traceback pointing to it! </p>
<p>the references were through the <code>tb_next</code> property, as a simple chain. So I decided to look for the tracebacks at the end of their respective chains:</p>
<p><code>bottom_tbs = [tb for tb in objgraph.by_type('traceback') if tb.tb_next is None]</code></p>
<p>There's something magical about one-lining your way through 500,000 stack traces to find the one you actually care about.</p>
<p>This led me to what I was actually looking for: the reason why Python really wanted to keep these objects around in the first place.</p>
<p><a href="https://rtpg.co/files/pylint/traceback-filecache.png">
<img src="https://rtpg.co/files/pylint/traceback-filecache.png">
</a>
We had a file cache! </p>
<p>Basically Astroid will cache the results of loading a module, so that if some part of the code asks for the same module/file again, it can just provide the previous result. It will also reproduce the errors as well, by holding onto thrown exceptions.</p>
<p>This is where I made a bit of a judgement call. Caching the "error-ness" makes sense, but for me it's not at all worth holding onto the number of tracebacks our code is generating. </p>
<p>Instead I decided to throw away the exception, store a custom <code>Error</code> class, and then just re-building exceptions when they are asked for. The details can be found over at <a href="https://github.com/PyCQA/astroid/pull/837">this PR</a>, though it's not super interesting.</p>
<p>The end result: we went from 500MB memory usage to 100MB for the codebase I was working against</p>
<p><a href="https://rtpg.co/files/pylint/bp-post-fix.png">
    <img src="https://rtpg.co/files/pylint/bp-post-fix.png">
</a>
80% improvement's not bad, if I do say so myself.</p>
<p>The PR itself, I'm not sure if it will actually …</p></article></div></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://rtpg.co/2020/10/12/pylint-usage.html">https://rtpg.co/2020/10/12/pylint-usage.html</a></em></p>]]>
            </description>
            <link>https://rtpg.co/2020/10/12/pylint-usage.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-24754397</guid>
            <pubDate>Mon, 12 Oct 2020 14:01:04 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Giving up on wlroots-rs (2019)]]>
            </title>
            <description>
<![CDATA[
Score 53 | Comments 29 (<a href="https://news.ycombinator.com/item?id=24753626">thread link</a>) | @dgellow
<br/>
October 12, 2020 | http://way-cooler.org/blog/2019/04/29/rewriting-way-cooler-in-c.html | <a href="https://web.archive.org/web/*/http://way-cooler.org/blog/2019/04/29/rewriting-way-cooler-in-c.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
      <section>
        

<p><a href="https://github.com/way-cooler/way-cooler">Way Cooler</a> is a Wayland compositor
that was written in Rust using <a href="https://github.com/Cloudef/wlc">wlc</a>. Since
<a href="https://github.com/way-cooler/way-cooler/pull/516">last April</a> I’ve been
rewriting it to use <a href="https://github.com/swaywm/wlroots">wlroots</a>. In order to do
that however I had to wrap the library so that it could be used in Rust. I
worked on <a href="https://github.com/swaywm/wlroots-rs">wlroots-rs</a> and put Way Cooler
on the back burner for a long time. After over 1,000 commits I’m giving up on it.</p>

<h2 id="problems-with-wlroots-rs-in-detail">Problems with wlroots-rs in detail</h2>

<h3 id="ownership-with-handles">Ownership with handles</h3>

<p>wlroots-rs was going to be the safe Rust wrapper for the very complicated
<a href="https://github.com/swaywm/wlroots">wlroots library</a>. wlroots implements large
parts of a Wayland compositor and provides pluggable modules that most
compositors will want.</p>

<p>The biggest problem when wrapping wlroots was defining the ownership model of
the objects that wlroots exposes. To demonstrate this I will focus on a single
resource that illustrates the problem: an output.</p>

<p>A Wayland “output” is the resource that represents a display device. Commonly
this means it handles a computer monitor. This resource could disappear at any
time in the life cycle of the application. This is easy enough to imagine: all
it takes is a yank of the display’s power cord and the monitor goes away. This
is basically the exact opposite of the Rust memory model. Rust likes to own
things and give compile-time defined borrows of that memory. This is runtime
lifetime management that must be managed in some way.</p>

<p>You cannot simply define it like so:</p>

<div><div><pre><code><span>struct</span> <span>Output</span> <span>{</span>
    <span>output_c_ptr</span><span>:</span> <span>*</span><span>mut</span> <span>wlr_output</span>
<span>}</span>

<span>impl</span> <span>Output</span> <span>{</span>
    <span>// Forward all the calls to the c pointer</span>
<span>}</span>
</code></pre></div></div>

<p>If this was done then it would be possible to leak the memory using <code>Box::leak</code>
and say that an output will live forever – even though it can’t.</p>

<p>The simplest way to achieve this safely would be to use reference counted
pointers and expose only weak pointers. Here is a (fake) example of how this
could look:</p>

<div><div><pre><code><span>// This is a _very_ simple example for clarity.</span>
<span>// wlroots-rs is not implemented like this.</span>

<span>struct</span> <span>RealOutput</span> <span>{</span>
    <span>lifeline</span><span>:</span> <span>Rc</span><span>&lt;*</span><span>mut</span> <span>wlr_output</span><span>&gt;</span>
<span>}</span>

<span>struct</span> <span>Output</span> <span>{</span>
    <span>lifeline</span><span>:</span> <span>Weak</span><span>&lt;*</span><span>mut</span> <span>wlr_output</span><span>&gt;</span>
<span>}</span>

<span>impl</span> <span>Output</span> <span>{</span>
    <span>/// Changes the mode (resolution) of an output.</span>
    <span>pub</span> <span>fn</span> <span>change_mode</span><span>(</span><span>&amp;</span><span>mut</span> <span>self</span><span>,</span> <span>mode</span><span>:</span> <span>Mode</span><span>)</span> <span>-&gt;</span> <span>Result</span><span>&lt;</span><span>(),</span> <span>()</span><span>&gt;</span> <span>{</span>
        <span>unsafe</span> <span>{</span>
            <span>let</span> <span>output_ptr</span> <span>=</span> <span>lifeline</span><span>.upgrade</span><span>()</span><span>.ok_or</span><span>(())</span><span>?</span><span>;</span>
            <span>wlr_output_change_mode</span><span>(</span><span>output_ptr</span><span>,</span> <span>mode</span><span>.into</span><span>());</span>
        <span>}</span>
    <span>}</span>
<span>}</span>
</code></pre></div></div>

<p>This naive style implementation could work, however it would cause a lot of
branching code. Each call to wlroots will require a check to see if the handle
has been dropped, even though it almost certainly has not been dropped (it can
only be dropped between event callbacks, wlroots/Wayland is callback based).
This means there will be unnecessary paths (that are hopefully marked cold) that
either panic or return an error.</p>

<p>This is obviously not wanted so the next best thing is define a range where it
is safe to use the reference to the resource: i.e. we want to be able to define
a lifetime for a code block. This leads us to the <em>actual</em> design of wlroots-rs,
using handles (note that this <em>is</em> actual code):</p>

<div><div><pre><code><span>/// A non-owned reference counted handle to a resource.</span>
<span>///</span>
<span>/// The resource could be destroyed at any time, it depends on the resource.</span>
<span>///</span>
<span>/// For example an output is destroyed when its physical output is</span>
<span>/// "disconnected" on DRM. "disconnected" depends on the output (e.g. sometimes</span>
<span>/// turning it off counts as "disconnected").</span>
<span>/// However, when the backend is instead headless an output lives until it is</span>
<span>/// destroyed explicitly by the library user.</span>
<span>///</span>
<span>/// Some resources are completely controlled by the user. For example although</span>
<span>/// you refer to a `Seat` with handles it is only destroyed when you call the</span>
<span>/// special destroy method on the seat handle.</span>
<span>///</span>
<span>/// Please refer to the specific resource documentation for a description of</span>
<span>/// the lifetime particular to that resource.</span>
<span>pub</span> <span>struct</span> <span>Handle</span><span>&lt;</span><span>D</span><span>:</span> <span>Clone</span><span>,</span> <span>T</span><span>,</span> <span>W</span><span>:</span> <span>Handleable</span><span>&lt;</span><span>D</span><span>,</span> <span>T</span><span>&gt;</span> <span>+</span> <span>Sized</span><span>&gt;</span> <span>{</span>
    <span>pub</span><span>(</span><span>crate</span><span>)</span> <span>ptr</span><span>:</span> <span>NonNull</span><span>&lt;</span><span>T</span><span>&gt;</span><span>,</span>
    <span>pub</span><span>(</span><span>crate</span><span>)</span> <span>handle</span><span>:</span> <span>Weak</span><span>&lt;</span><span>Cell</span><span>&lt;</span><span>bool</span><span>&gt;&gt;</span><span>,</span>
    <span>pub</span><span>(</span><span>crate</span><span>)</span> <span>_</span><span>marker</span><span>:</span> <span>PhantomData</span><span>&lt;</span><span>W</span><span>&gt;</span><span>,</span>
    <span>pub</span><span>(</span><span>crate</span><span>)</span> <span>data</span><span>:</span> <span>Option</span><span>&lt;</span><span>D</span><span>&gt;</span>
<span>}</span>


<span>impl</span><span>&lt;</span><span>D</span><span>:</span> <span>Clone</span><span>,</span> <span>T</span><span>,</span> <span>W</span><span>:</span> <span>Handleable</span><span>&lt;</span><span>D</span><span>,</span> <span>T</span><span>&gt;&gt;</span> <span>Handle</span><span>&lt;</span><span>D</span><span>,</span> <span>T</span><span>,</span> <span>W</span><span>&gt;</span> <span>{</span>
    <span>/// Upgrades a handle to a reference to the backing object.</span>
    <span>///</span>
    <span>/// # Safety</span>
    <span>/// This returns an "owned" value when really you don't own it all.</span>
    <span>/// Depending on the type, it's possible that the resource will be freed</span>
    <span>/// once this returned value is dropped, causing a possible double free.</span>
    <span>/// Potentially it instead is just unbound, it depends on the resource.</span>
    <span>///</span>
    <span>/// Regardless, you should not use this interface. Use the `run` method.</span>
    <span>#[doc(hidden)]</span>
    <span>pub</span> <span>unsafe</span> <span>fn</span> <span>upgrade</span><span>(</span><span>&amp;</span><span>self</span><span>)</span> <span>-&gt;</span> <span>HandleResult</span><span>&lt;</span><span>W</span><span>&gt;</span> <span>{</span>
        <span>self</span><span>.handle</span><span>.upgrade</span><span>()</span>
            <span>.ok_or</span><span>(</span><span>HandleErr</span><span>::</span><span>AlreadyDropped</span><span>)</span>
            <span>// NOTE</span>
            <span>// We drop the Rc here because having two would allow a dangling</span>
            <span>// pointer to exist!</span>
            <span>.and_then</span><span>(|</span><span>check</span><span>|</span> <span>{</span>
                <span>if</span> <span>check</span><span>.get</span><span>()</span> <span>{</span>
                    <span>return</span> <span>Err</span><span>(</span><span>HandleErr</span><span>::</span><span>AlreadyBorrowed</span><span>)</span>
                <span>}</span>
                <span>let</span> <span>wrapper_obj</span> <span>=</span> <span>W</span><span>::</span><span>from_handle</span><span>(</span><span>self</span><span>)</span><span>?</span><span>;</span>
                <span>check</span><span>.set</span><span>(</span><span>true</span><span>);</span>
                <span>Ok</span><span>(</span><span>wrapper_obj</span><span>)</span>
            <span>})</span>
    <span>}</span>

    <span>/// Run a function with a reference to the resource if its still alive.</span>
    <span>///</span>
    <span>/// Returns the result of the function, if successful.</span>
    <span>///</span>
    <span>/// # Safety</span>
    <span>/// By enforcing a rather harsh limit on the lifetime of the resource</span>
    <span>/// to a short lived scope of an anonymous function,</span>
    <span>/// this function ensures the resource does not live longer</span>
    <span>/// than it exists.</span>
    <span>///</span>
    <span>/// # Panics</span>
    <span>/// This function will panic if multiple mutable borrows are detected.</span>
    <span>/// This will happen if you call `upgrade` directly within this callback,</span>
    <span>/// or if a handle to the same resource was upgraded some where else up the</span>
    <span>/// stack.</span>
    <span>pub</span> <span>fn</span> <span>run</span><span>&lt;</span><span>F</span><span>,</span> <span>R</span><span>&gt;</span><span>(</span><span>&amp;</span><span>self</span><span>,</span> <span>runner</span><span>:</span> <span>F</span><span>)</span> <span>-&gt;</span> <span>HandleResult</span><span>&lt;</span><span>R</span><span>&gt;</span>
    <span>where</span>
        <span>F</span><span>:</span> <span>FnOnce</span><span>(</span><span>&amp;</span><span>mut</span> <span>W</span><span>)</span> <span>-&gt;</span> <span>R</span>
    <span>{</span>
        <span>let</span> <span>mut</span> <span>wrapped_obj</span> <span>=</span> <span>unsafe</span> <span>{</span> <span>self</span><span>.upgrade</span><span>()</span><span>?</span> <span>};</span>
        <span>// We catch panics here to deal with an extreme edge case.</span>
        <span>//</span>
        <span>// If the library user catches panics from the `run` function then their</span>
        <span>// resource used flag will still be set to `true` when it should be set</span>
        <span>// to `false`.</span>
        <span>let</span> <span>res</span> <span>=</span> <span>panic</span><span>::</span><span>catch_unwind</span><span>(</span><span>panic</span><span>::</span><span>AssertUnwindSafe</span><span>(||</span> <span>runner</span><span>(</span><span>&amp;</span><span>mut</span> <span>wrapped_obj</span><span>)));</span>
        <span>if</span> <span>let</span> <span>Some</span><span>(</span><span>check</span><span>)</span> <span>=</span> <span>self</span><span>.handle</span><span>.upgrade</span><span>()</span> <span>{</span>
            <span>// Sanity check that it hasn't been tampered with. If so, we should</span>
            <span>// just panic. If we are currently</span>
            <span>// panicking this will abort.</span>
            <span>if</span> <span>!</span><span>check</span><span>.get</span><span>()</span> <span>{</span>
                <span>wlr_log!</span><span>(</span><span>WLR_ERROR</span><span>,</span> <span>"After running callback, mutable lock was false"</span><span>);</span>
                <span>panic!</span><span>(</span><span>"Lock in incorrect state!"</span><span>);</span>
            <span>}</span>
            <span>check</span><span>.set</span><span>(</span><span>false</span><span>);</span>
        <span>}</span>
        <span>match</span> <span>res</span> <span>{</span>
            <span>Ok</span><span>(</span><span>res</span><span>)</span> <span>=&gt;</span> <span>Ok</span><span>(</span><span>res</span><span>),</span>
            <span>Err</span><span>(</span><span>err</span><span>)</span> <span>=&gt;</span> <span>panic</span><span>::</span><span>resume_unwind</span><span>(</span><span>err</span><span>)</span>
        <span>}</span>
    <span>}</span>
<span>}</span>
</code></pre></div></div>

<p>The full implementation can be found
<a href="https://github.com/swaywm/wlroots-rs/blob/91a18bd541a6ec565d6ef78d18ee5cc6a413f684/src/utils/handle.rs">here</a>,
its far too long and complicated to paste into a blog post.</p>

<p>This code is very complicated, which isn’t what you want for the defining
abstraction of your safe library. As far as I’m aware though it is correct. It’s
also incredibly ugly to use in practice:</p>

<div><div><pre><code><span>fn</span> <span>some_wlroots_callback</span><span>(</span><span>output_handle</span><span>:</span> <span>OutputHandle</span><span>,</span>
                         <span>surface_handle</span><span>:</span> <span>SurfaceHandle</span><span>)</span> <span>{</span>
    <span>output_handle</span><span>.run</span><span>(|</span><span>output</span><span>|</span> <span>{</span>
        <span>surface_handle</span><span>.run</span><span>(|</span><span>surface</span><span>|</span> <span>{</span>
            <span>// maybe some more nested layers...</span>
        <span>})</span><span>.unwrap</span><span>()</span>
    <span>})</span><span>.unwrap</span><span>()</span>
<span>}</span>
</code></pre></div></div>

<p>To avoid this callback hell, I defined two macros to help: <a href="https://github.com/swaywm/wlroots-rs/blob/91a18bd541a6ec565d6ef78d18ee5cc6a413f684/src/macros.rs#L355">one normal
macro</a>
and a very complicated <a href="https://github.com/swaywm/wlroots-rs/blob/91a18bd541a6ec565d6ef78d18ee5cc6a413f684/wlroots-dehandle/src/lib.rs">procedural
macro</a>.
Here’s what the procedural macro looks like:</p>

<div><div><pre><code><span>// This does the same thing as the above code, but nicer.</span>
<span>#[wlroots_dehandle]</span>
<span>fn</span> <span>some_wlroots_callback</span><span>(</span><span>output_handle</span><span>:</span> <span>OutputHandle</span><span>,</span>
                         <span>surface_handle</span><span>:</span> <span>SurfaceHandle</span><span>)</span> <span>{</span>
    <span>#[dehandle]</span> <span>let</span> <span>output</span> <span>=</span> <span>output</span><span>;</span>
    <span>#[dehandle]</span> <span>let</span> <span>surface</span> <span>=</span> <span>surface_handle</span><span>;</span>
<span>}</span>
</code></pre></div></div>

<p>This expands out the lines to use the non-proc macro, which in turn becomes the
callback hell mess. The only problem with this scheme is now that the control
flow is all wrong:</p>

<div><div><pre><code><span>// this is actual code I had to write (simplified)</span>
<span>for</span> <span>shell</span> <span>in</span> <span>mapped_shells</span> <span>{</span>
    <span>#[dehandle]</span>
    <span>let</span> <span>surface</span> <span>=</span> <span>shell</span><span>.surface</span><span>();</span>
    <span>// If not ready to render, don't render it yet</span>
    <span>if</span> <span>!</span><span>surface</span><span>.is_mapped</span><span>()</span> <span>{</span>
        <span>// What we _want_ to write</span>
        <span>// break</span>

        <span>// What we have to write because this is actually in a callback...</span>
        <span>return</span> <span>// actually goes to the next shell in the mapped_shells...</span>
    <span>}</span>
<span>}</span>
</code></pre></div></div>

<p>So this solution “works” but it’s not great. Ultimately it’s very confusing for
users. It was too confusing for <a href="https://puri.sm/posts/end-of-year-librem-5-update/">purism to get
working</a> (this
<a href="https://www.youtube.com/watch?v=oX5yVyLbLZE">video</a> was very painful for me to
watch - the library was unusable). <a href="https://github.com/buffet/kiwmi">Kiwmi</a>
initially tried using wlroots-rs but swiftly gave up and used wlroots itself.</p>

<h3 id="the-sheer-amount-of-api-to-wrap">The sheer amount of API to wrap</h3>

<p>Currently there is 11 <strong>THOUSAND</strong> lines of Rust in wlroots-rs. <em>All</em> of this
code is just wrapper code, it doesn’t do anything but memory management. This
isn’t just repeated code either, I defined a <a href="https://github.com/swaywm/wlroots-rs/blob/91a18bd541a6ec565d6ef78d18ee5cc6a413f684/src/macros.rs#L201">very complicated and ugly
macro</a>
to try to make it easier.</p>

<p>This wrapper code doesn’t cover even half of the API surface of wlroots. It’s
exhausting writing wlroots-rs code, memory management is constantly on my mind
because that’s the whole purpose of the library. It’s a very boring problem and
it’s always at odds with usability - see the motivation for the escape from
callback hell described above.</p>

<p>To do all of this, and then go write Way Cooler, already a big undertaking, is too
much for me to commit to. When the benefit at the end of the day is just so I
don’t have to write C, that doesn’t really make it worth it. If I got this out
of the box by simply linking to the library, like I can in C++, then it would be
much more tenable.</p>

<p>I can always just use unsafe bindings to wlroots, just like I would with any
other language. However, the <em>entire point</em> of Rust is that it’s safe. Doing
that is not an option because at that point you lose the entire …</p></section></div></article></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="http://way-cooler.org/blog/2019/04/29/rewriting-way-cooler-in-c.html">http://way-cooler.org/blog/2019/04/29/rewriting-way-cooler-in-c.html</a></em></p>]]>
            </description>
            <link>http://way-cooler.org/blog/2019/04/29/rewriting-way-cooler-in-c.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-24753626</guid>
            <pubDate>Mon, 12 Oct 2020 12:17:25 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Microsoft is not rebasing Windows to Linux]]>
            </title>
            <description>
<![CDATA[
Score 246 | Comments 299 (<a href="https://news.ycombinator.com/item?id=24753564">thread link</a>) | @sunbum
<br/>
October 12, 2020 | https://boxofcables.dev/no-microsoft-is-not-rebasing-windows-to-linux/ | <a href="https://web.archive.org/web/*/https://boxofcables.dev/no-microsoft-is-not-rebasing-windows-to-linux/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="site-main">
    <div>

        <article>

            

            <figure>
                <img srcset="https://boxofcables.dev/content/images/size/w300/2020/10/Screenshot-2020-10-11-184607.png 300w,
                            https://boxofcables.dev/content/images/size/w600/2020/10/Screenshot-2020-10-11-184607.png 600w,
                            https://boxofcables.dev/content/images/size/w1000/2020/10/Screenshot-2020-10-11-184607.png 1000w,
                            https://boxofcables.dev/content/images/size/w2000/2020/10/Screenshot-2020-10-11-184607.png 2000w" sizes="(max-width: 800px) 400px,
                        (max-width: 1170px) 1170px,
                            2000px" src="https://boxofcables.dev/content/images/size/w2000/2020/10/Screenshot-2020-10-11-184607.png" alt="No, Microsoft is not rebasing Windows to Linux">
            </figure>

            <section>
                <div>
                    <p>There have been a <a href="http://esr.ibiblio.org/?p=8764">string</a> <a href="https://www.zdnet.com/article/linux-based-windows-makes-perfect-sense/">of</a> <a href="https://www.techrepublic.com/article/could-microsoft-be-en-route-to-dumping-windows-in-favor-of-linux/?ftag=COS-05-10aaa0g&amp;taid=5f814f0d8911f90001eb9436&amp;utm_campaign=trueAnthem:+Twitter+Card&amp;utm_medium=trueAnthemCard&amp;utm_source=twitterCard">pieces</a> wondering aloud whether Microsoft is going to rebase Windows on the Linux kernel in the future.</p><p>I have a unique perspective on Microsoft's Linux involvement. I help deliver Ubuntu on Windows Subsystem for Linux in my job on the Desktop team at Canonical. I regularly talk to many Microsoft employees working on Linux and various open source projects. I also get briefings on Microsoft products and strategy as an MVP. Note though, these are my personal thoughts, and I am not sharing anything here that is not public.</p><p>I have become somewhat of an intermediary between the Microsoft and Linux communities. It is something I am glad to do. There are creative, kind, and fascinating people in both communities. Interesting things happen when the lines between them blur. Fostering cross-pollination will make computing better for everyone.</p><figure><blockquote data-width="550"><p lang="en" dir="ltr">WSL does not by default do unattended upgrades, there is no traditional init like systemd to do them in the background. You can set a Basic Task in Windows Task Scheduler to run apt update as root on login, then add an action to that task that runs apt upgrade: <a href="https://t.co/jvaJIwfaqs">pic.twitter.com/jvaJIwfaqs</a></p>— Hayden Barnes (@unixterminal) <a href="https://twitter.com/unixterminal/status/1314688641877315586?ref_src=twsrc%5Etfw">October 9, 2020</a></blockquote>

<figcaption>Using Windows Scheduler to run automated updates on Ubuntu on WSL</figcaption></figure><p>I am deeply skeptical of the notion that Microsoft is going to shift the core of the Windows operating system to the Linux kernel, for both product and engineering reasons, any time soon. Let me explain why.</p><p>First, the reasons why I think this fantasy this keeps cropping up on Slashdot and Hacker News.</p><ol><li>It is effective clickbait.</li><li>It is a long-held fantasy for open source and Linux advocates.</li><li>The role of Windows is changing in a world where the pie of operating systems powering devices is now shared with Android, iOS, macOS, Chrome OS, and Ubuntu.</li><li>The perceived plausibility of something like this is increasing, with things like Linux usage on Azure and WSL. The Overton Window has shifted.</li></ol><figure><blockquote data-width="550"><p lang="en" dir="ltr">Windows and Linux exist is an cosmic duality. Two opposing yet complimentary forces, we cannot have one without the other. Knowing how to blend the two is to conjure magic. <a href="https://t.co/Eoh22Rn4Fn">https://t.co/Eoh22Rn4Fn</a></p>— Hayden Barnes (@unixterminal) <a href="https://twitter.com/unixterminal/status/1276895377430634498?ref_src=twsrc%5Etfw">June 27, 2020</a></blockquote>

<figcaption>"Competition with Windows and macOS makes Linux a better operating system."</figcaption></figure><p>The reasons I do not think Windows will be rebasing to a Linux kernel are as followed:</p><ol><li>The NT kernel in Windows offers a degree of backward compatibility, long-term support, and driver availability that Linux is just now approaching. It would cost millions of dollars to replicate these in Linux. Microsoft has plenty of paying customers to continue supporting Windows as-is, some for decades. Windows is not a drain on Microsoft that would justify the expense of rebasing to Linux for savings, as <a href="http://esr.ibiblio.org/?p=8764">Raymond</a> has argued. <a href="https://www.arcanoae.com/">Lots</a> of <a href="https://www.oracle.com/solaris/solaris11/">profitable</a> <a href="https://vmssoftware.com/">companies</a> <a href="https://www.xinuos.com/">exist</a> solely to service existing operating systems. Even if it came down to rebasing to Linux, it could result in an undesirable kernel monoculture. Competition with Windows and macOS makes Linux a better operating system. The more desirable outcome is that open source innovation continues spreading across and between <em>all</em> operating systems. That Windows and Linux open source contributors share the best of both ecosystems.</li><li>It is unclear if the Windows user space could even be rebased from NT to the Linux kernel and maintain the compatibility that Windows is known for, specifically what enterprise clients with mission-critical applications are paying to get. Windows does not have the same strict division between kernel space and user space that Linux does. The NT kernel has about 400 documented syscalls plus about 1700 documented Win32 API calls. That would be a huge amount of re-implementation to ensure precise compatibility that Windows developers and their tools expect. It goes beyond contributing some fixes to Wine. Linux only has 313 syscalls on amd64 and, even then, part of the reason Microsoft switched from a syscall translation layer in WSL 1 to a virtualized kernel in WSL 2 is because re-implementing the dozens of non-standard ways developers had come to exploit the Linux ABI was <a href="https://github.com/microsoft/WSL/discussions/4022">a pain in the ass</a>. It is one thing to provide a NT-related compatibility layer for <a href="https://cloudblogs.microsoft.com/sqlserver/2016/12/16/sql-server-on-linux-how-introduction/">SQL Server on Linux</a>, which Microsoft owns, it is another to guarantee it for millions of other developer's applications.</li><li>Microsoft has doubled down on Windows in recent years. Microsoft has invested in usability, new features, and performance improvements for Windows 10 that have paid off. These improvements, <a href="https://www.windowscentral.com/what-are-microsoft-precision-touchpad-drivers">collaborations with OEMs</a>, and the Surface <a href="https://thejournal.com/articles/2020/01/29/traditional-pcs-seeing-resurgence-after-7-years-of-decline.aspx">helped revitalize</a> a PC market that at one point <a href="https://www.usatoday.com/story/tech/2013/03/06/apple-google-microsoft-hewlett-packard-dell-ipad-iphone-android-ios-samsung-galaxy/1946325/">looked in danger of falling</a> to iPads and Chromebooks. Microsoft has been working hard to make Windows an excellent development platform, with projects like Windows Terminal, <a href="https://github.com/microsoft/PowerToys">PowerToys</a>, Windows Subsystem for Linux, and Visual Studio 2019. The Insiders program is <a href="https://www.zdnet.com/article/microsoft-weve-got-10-million-insiders-testing-windows-10-to-keep-bugs-at-bay/">remarkably successful</a>. Windows powers most of the Surface device lineup, a key focus of Microsoft right now. Internal reorganizations in 2018 and <a href="https://www.geekwire.com/2020/microsoft-brings-windows-ux-surface-teams-together-exec-panos-panay-latest-reorg/">2020</a> show that the future of the Surface and Windows are now inextricably linked. Windows powers the Xbox and we are in a <a href="https://www.pcgamer.com/the-state-of-pc-gaming-in-2020/">resurgence</a> of mostly Windows-based PC gaming. Microsoft also has ideas for <a href="https://www.windowscentral.com/windows-10x">Windows 10X</a>, the next operating system concept following Windows 10 (that I think we will <a href="https://www.windowscentral.com/windows-10x-out-box-experienced-shown-leaked-video">get in gradual pieces</a>), with future hardware like the <a href="https://www.techradar.com/news/microsoft-confirms-its-dual-screen-surface-neo-has-been-delayed">Surface Neo</a> in mind.</li><li>Microsoft does not have to rebase to Linux to stay relevant. Microsoft is aware of a changing device landscape after losing on Windows in mobile. They recognize a more diverse set of operating systems and platforms are powering the computing devices we use, which now includes Android, Ubuntu, iOS, macOS, Alexa, Chrome OS, and not just x86 but ARM. Microsoft has shown they are able to adapt by making relevant products and services available on those other platforms while simultaneously keeping their own platform, Windows, competitive in its traditional footholds. Microsoft is now driving innovation on Android in the mobile space, not just with ported Office apps, but a home screen launcher, and now the Surface Duo. On Ubuntu, they offer their tools that would make sense for Linux workstations, such as Code, .NET, Azure tools, Teams, PowerShell, Sysinternals for Linux, and soon Edge, which comes with Microsoft's custom <a href="https://docs.microsoft.com/en-us/microsoft-edge/devtools-guide">web dev tools</a>. Do you want to run Ubuntu on Azure? Microsoft has you covered and works closely with Canonical to make that a wonderful experience. </li></ol><p>The much more interesting question is not whether Microsoft is planning to rebase Windows to Linux, but how far Windows will go on open source. We are already seeing components like <a href="https://github.com/Microsoft/Terminal">Windows Terminal</a>, PowerToys, and other Windows <a href="https://devblogs.microsoft.com/commandline/windows-command-line-introducing-the-windows-pseudo-console-conpty/">components</a> either begin life as or go open source. The more logical and realistic goal here is a continued opening of Windows components and the <a href="https://github.com/microsoft/WinDev">Windows development</a> process, even beyond the Insiders program, in a way that benefits other operating systems.</p><p>After all, Windows has already adopted the Ubuntu release cadence, of six-month releases in April and October with set releases getting extended support. Windows 2004 and Ubuntu 20.04 landed within days of each other. I kid.</p><p>Raymond is correct in one key part of his blog. I do think the era of the desktop OS wars is ending. We are entering a new era where your high-end workstation will run multiple operating systems simultaneously, like runtimes, and not necessarily all locally. The choice will not really be Windows or Linux, it will be whether you boot Hyper-V or KVM first, and Windows and Ubuntu stacks will be tuned to run well on the other. Microsoft contributes patches to the Linux kernel to <a href="https://www.zdnet.com/article/microsoft-these-patches-aim-to-make-linux-run-as-root-partition-on-hyper-v/">run Linux well on Hyper-V</a> and tweaks Windows to <a href="https://www.theregister.com/2019/03/11/windows_10_on_kvm/">play nicely on KVM</a>.</p><p>The best parts of Ubuntu will come to Windows and the best open source parts of Windows will come to Ubuntu, thanks to an increasing trend <a href="https://boxofcables.dev/microsoft-and-open-source-an-unofficial-timeline/">towards open source across Microsoft</a>.</p><figure><blockquote data-width="550"><p lang="en" dir="ltr">Check out this sneak preview of our work on adding Linux GUI application support to WSL! <a href="https://t.co/lcx4WWwxTo">pic.twitter.com/lcx4WWwxTo</a></p>— Craig Loewen (@craigaloewen) <a href="https://twitter.com/craigaloewen/status/1308452901266751488?ref_src=twsrc%5Etfw">September 22, 2020</a></blockquote>

</figure><p>The key take-away though is that <a href="https://boxofcables.dev/microsoft-and-open-source-an-unofficial-timeline/">open source has won</a>. And Raymond can be proud of helping to <a href="http://www.catb.org/~esr/writings/cathedral-bazaar/cathedral-bazaar/index.html">articulate the case</a> for the open source development model when he did.</p><figure><iframe width="612" height="344" src="https://www.youtube.com/embed/dLZRY3uLJ4s?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><figcaption>Excerpt from 'Revolution OS'&nbsp;</figcaption></figure><p>Neither Windows nor Ubuntu are going anywhere. They are just going to keep getting better through open source. Each will play to their relative strengths. Just now with more open source collaboration than imaginable before.</p><figure><blockquote data-width="550"><p lang="en" dir="ltr">Word on Ubuntu 20.04. Very usable on an i5-6300U with just integrated graphics. It is not WINE, remote/cloud, or GNOME on WSL. It is something else I put together. Next, I plan to add working file associations. <a href="https://t.co/nGQ8USeR0m">pic.twitter.com/nGQ8USeR0m</a></p>— Hayden Barnes (@unixterminal) <a href="https://twitter.com/unixterminal/status/1255919797692440578?ref_src=twsrc%5Etfw">April 30, 2020</a></blockquote>

<figcaption><em>The work being done for GUI support on WSL has the potentially to dramatically improve the remote desktop and Windows virtualization experience on Linux.</em></figcaption></figure><p><a href="https://pastebin.ubuntu.com/p/HHR4sVFn2S/">π</a></p>
                </div>
            </section>



        </article>

    </div>
</div></div>]]>
            </description>
            <link>https://boxofcables.dev/no-microsoft-is-not-rebasing-windows-to-linux/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24753564</guid>
            <pubDate>Mon, 12 Oct 2020 12:09:50 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[A tool that increased my typing speed]]>
            </title>
            <description>
<![CDATA[
Score 117 | Comments 146 (<a href="https://news.ycombinator.com/item?id=24753493">thread link</a>) | @chipz
<br/>
October 12, 2020 | https://vasilishynkarenka.com/how-to-type-3x-faster/ | <a href="https://web.archive.org/web/*/https://vasilishynkarenka.com/how-to-type-3x-faster/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="site-main">
    <div>

        <article>

            

            <figure>
                <img srcset="https://vasilishynkarenka.com/content/images/size/w300/2020/10/https___bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com_public_images_9d6b9df3-d665-43a4-bbd7-8cdf5910d6cb_599x409.jpeg 300w,
                            https://vasilishynkarenka.com/content/images/size/w600/2020/10/https___bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com_public_images_9d6b9df3-d665-43a4-bbd7-8cdf5910d6cb_599x409.jpeg 600w,
                            https://vasilishynkarenka.com/content/images/size/w1000/2020/10/https___bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com_public_images_9d6b9df3-d665-43a4-bbd7-8cdf5910d6cb_599x409.jpeg 1000w,
                            https://vasilishynkarenka.com/content/images/size/w2000/2020/10/https___bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com_public_images_9d6b9df3-d665-43a4-bbd7-8cdf5910d6cb_599x409.jpeg 2000w" sizes="(max-width: 800px) 400px,
                        (max-width: 1170px) 1170px,
                            2000px" src="https://vasilishynkarenka.com/content/images/size/w2000/2020/10/https___bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com_public_images_9d6b9df3-d665-43a4-bbd7-8cdf5910d6cb_599x409.jpeg" alt="How to type 3x faster">
            </figure>

            <section>
                <div>
                    <p>In the last post, I’ve explained how the speed of symbol manipulation <a href="https://vasilishynkarenka.com/writing-as-a-tool-for-thought/">augments our intellect</a>. Today, I will describe an interface I’ve designed that increased my typing speed 3x, changed how I plan projects, and helped me develop a growth mindset.</p><p>Here’s what’s coming:</p><ul><li>How QWERTY was invented</li><li>Why Dvorak keyboard failed despite being more efficient</li><li>The sausage theory of innovation</li><li>How to type 3x faster</li><li>How shortcuts help to discover new knowledge, plan projects in minutes and develop a growth mindset</li><li>What comes after shortcuts</li></ul><p>You can find references at the end of the post.</p><p>I hope you’ll enjoy your reading.</p><hr><h2 id="how-qwerty-was-invented"><strong><strong>How QWERTY was invented</strong></strong></h2><p>Most people type one symbol at a time.</p><p>That’s because our keyboard is designed that way. No matter how much time you spend in the gym, weightlifting your left thumb, there’s an apparent speed limit beyond which you can’t go. You’ve only got ten fingers.</p><p>But very few people know <em>why</em> the keyboard is designed that way. And if we want to go beyond the speed of the keyboard, we need to first understand how we ended up here.</p><p>So let’s travel back in time.</p><hr><figure><img src="https://cdn.substack.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F94fd314f-be54-46cf-9f08-759ae1975b7d_1500x1786.jpeg" alt=""></figure><p>On July 1, 1874, the first typewriter hit the market.</p><p>You’re probably now scratching the back of your head and thinking:</p><p><em>“Well, I’ve seen this keyboard somewhere..”</em></p><p>That’s right. The very first “Type-Writer,” designed by Christopher Sholes 146 years ago, used the exact same QWERTY keyboard that‘s in front of you.</p><p>Here’s how it worked.</p><p>His machine had a mechanism with characters at the end of a bar. When a key was struck, a linkage would swing the bar into a tape coated with ink. And when the character hit the tape, the impression of the character was transferred onto the paper.</p><p>The problem was that bars were colliding with each other and jamming. That’s why Christopher arranged the keys with the most common letters in hard to reach spots. He decided to slow typists down to prevent bars from jamming.</p><p>But that’s excusable. Christopher couldn’t have imagined one-third of humankind using his invention every day for hours. He lived 150 years ago when typing was not even a skill because typewriters didn’t exist.</p><p>And for the next 68 years after the “Type-Writer” hit the market, nobody cared about the speed.</p><p>But then one American professor tried to go faster.</p><h2 id="why-dvorak-keyboard-failed-despite-being-more-efficient"><strong><strong>Why Dvorak keyboard failed despite being more efficient</strong></strong></h2><p>By the 1930s, the typewriters started getting traction.</p><p>The Underwood typewriter was selling like hotcakes. They reached 5 million units sold by 1939, and that was just the beginning.</p><p>On May 12th, 1936, August Dvorak and his brother-in-law, William, submitted a patent for a better-designed keyboard that decreased typing errors, advanced typing speed, and lessened typist fatigue.</p><p>Here’s how it looked:</p><figure><img src="https://cdn.substack.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F7358b134-c94b-42d2-b51b-ceb79676f87a_1232x723.jpeg" alt=""></figure><p>Their idea was to minimize the distance traveled by the fingers. To do that, August placed all the most commonly used letters in the home row—so that your fingers don’t have to move at all to hit these keys.</p><p>August and William also improved how vowels and consonants are located. They put all the vowels to be used by the left hand and made the right hand to manipulate only consonants. This enabled at least 2x speed improvement as there are very few words in the English language that can be typed with only one hand on the Dvorak keyboard (for the curious, the two are “papaya” and “opaque”).</p><p>Below you can see how much work each of the fingers does when typing on Dvorak instead of QWERTY:</p><figure><img src="https://cdn.substack.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F9d6b9df3-d665-43a4-bbd7-8cdf5910d6cb_599x409.jpeg" alt=""></figure><p>But Dvorak’s keyboard never took off.</p><p>The timing was terrible. Amid the Great Depression, most companies didn’t have the cash to buy new typewriters. And when World War II started, many typewriter plants shut down manufacturing of all typewriters—including ones with Dvorak layouts.</p><p>But the most important reason was psychological.</p><p>Despite Dvorak-trained typists getting banned from typing contests for “unfair advantage,” the QWERTY layout got deep into people’s minds as “normal.” And as soon as something gets “normal,” we forget <em>why</em> we do the thing in the first place.</p><p>I call it the sausage theory.</p><h2 id="the-sausage-theory-of-innovation"><strong>The sausage theory of innovation</strong></h2><p>Here’s how the story goes.</p><p><em>The daughter-in-law is cooking dinner. She’s got some sausages from the local grocery store and is ready to boil them. But as soon as she takes the first one to throw it into the pot, the husband’s mom shows up.</em></p><p><em>The mother pulls the sausage from the daughter’s hands, cuts it in half, and throws into the boiling pot.</em></p><p><em>The daughter is shocked.</em></p><figure><img src="https://cdn.substack.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4bc6031b-c728-43b4-892a-fd1091d1d4df_1536x954.png" alt=""></figure><p><strong>D:</strong> “Why are you doing this?”</p><p><strong>M:</strong> “Because that’s how you cook sausages right.”</p><p><strong>D:</strong> “Why so?”</p><p><strong>M:</strong> “Because if you cut them in half, they end up being soft and juicy. And my mom has been doing that all the time, and she can’t be wrong<em>.”</em></p><p><em>So the daughter goes to the grandma.</em></p><figure><img src="https://cdn.substack.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F618d05a3-0ab6-4ff4-9369-8548ec7ddfa9_1536x732.png" alt=""></figure><p><strong>D:</strong> “Hey grandma, we were cooking some sausages last night, and mom started cutting them in half. I asked why and she said that’s because you’ve been doing that for years. What’s the point of cutting them in half??”</p><p><strong>G:</strong> “Well, dear, that’s because how you cook sausages right.”</p><p><strong>D:</strong> “Oh, really... Okay. And why is this the right way to cook them?”</p><p><strong>G:</strong> “You know, if you cut them in half, they don’t end up being dry and tough to bite. But as I remember, my mom has been doing that for decades, so I just picked it up from her. Mom can’t be wrong.”</p><p><em>To discover the ultimate why, the daughter goes to the grand-grandmother, a 103-year-old woman living hundreds of miles away from the town.</em></p><figure><img src="https://cdn.substack.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F7e7b283b-6706-4c2c-af23-ba5992384437_1536x852.png" alt=""></figure><p><strong>D:</strong> “Hey granny, we were doing sausages for dinner, and mom started cutting them in half. I’ve asked what’s the point, but she doesn’t know, and even your daughter said that she picked it up from you. WHY IN THE HELL DID YOU CUT SAUSAGES IN HALF???”</p><p><strong>GG:</strong> “Oh honey, are you still doing that? I had to cut them in half because they didn’t fit in my tiny pot…”</p><h2 id="how-to-type-3x-faster"><strong>How to type 3x faster</strong></h2><p>The first typewriter had only one symbol per key because of its mechanical nature. You couldn’t program it to type one word, a combination of words, or an entire sentence for one press of a key. It had to be universal so that everybody could type what they want.</p><p>In other words, the pot was tiny.</p><p>But 146 years later, we are still cutting sausages in half.</p><hr><p>The way to type faster is not to increase the typing speed but to rethink what typing actually is.</p><p>Here’s a demo of myself outlining this article:</p><figure><img src="https://cdn.substack.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fcd09c3ea-88ce-4a89-a422-93365264a3f2_600x450.gif" alt=""></figure><p><em>If your email client doesn’t support GIF, click on the image, and it will open in your browser.</em></p><p>40 words; 23 seconds in total. I don’t know if you noticed but I actually stopped for a second to sip my coffee.</p><p>Without shortcuts, it took me 62 seconds to type the same 40 words:</p><figure><img src="https://cdn.substack.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F774c5e6a-97b7-46a2-972b-c61c1135c0bc_600x450.gif" alt=""></figure><p>My method is built on two principles:</p><ol><li>You can’t go fast by typing one symbol at a time</li><li>Most words you type are exactly the same</li></ol><p>You can 3x your typing speed if you set up shortcuts for most frequently used words to decrease the number of symbols you have to type.</p><p>Here’s how it works on Mac OS or iOS. When you type a symbol, i.e., “rr” or “wd,” and press a space bar, the system transforms your input into “remember” or “would be” accordingly. You can set up these pairs in Settings/Keyboard/Text Replacement.</p><p>But it’s not only the speed that matters:</p><ul><li><em>Shortcuts work on your iPhone.</em> As you spend 2-4h a day with your iPhone and type at least a few times slower, it’s useful to have shortcuts to speed up your input process.</li><li><em>Shortcuts take care of apostrophes.</em> You can have a “dont” shortcut that turns into “don’t.” This removes the necessity to press the apostrophe key at all.</li><li><em>Shortcuts prevent typos.</em> Typos come from the word type, which means pressing keys one after another. When you do shortcuts, you don’t type. And if you don’t type, then you don’t have typos.</li><li><em>Shortcuts simplify blind typing.</em> Getting all eleven symbols of the word “progressive” right when staring at a screen requires deliberate practice and exceptional motor skills. But if you type two symbols, “pg,” instead of eleven, you will make fewer errors.</li><li><em>Shortcuts let you instantly look up relevant information.</em> If you have an iPad with a keyboard, you can look up stuff from Notes and other apps by pressing Cmd+Space and hitting your shortcut. Here’s how it works:</li></ul><figure><img src="https://cdn.substack.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_lossy/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe06b0035-b3f8-4979-9bc2-9aef3ace58ed_600x450.gif" alt=""></figure><ul><li><em>Shortcuts speed up your handwriting.</em> When you start using shortcuts extensively, you’ll notice that you also use them in handwriting. This happens because you remember the meaning behind the symbol. And as handwriting is even slower than typing on a 146-year-old keyboard, this yields enormous speed benefits compared to scribbling full words and sentences.</li><li><em>Shortcuts speed up your thinking.</em> Inevitably, you will start thinking in shortcuts as well. Thoughts such as “Can I TTS this OL?” (“Can I use my three three screens writing method for this essay outline?”) begin to pop up.</li></ul><p>I can speculate that after three years of using shortcuts every single day for 5-10 hours, my thought process became significantly faster. That’s not only because of smaller symbols but also because shortcuts compress knowledge. They serve as dynamic pointers to the territory in my brain where the meaning is stored.</p><p>This means that I’m climbing up the ladder of information just like a chess player does when he progresses from being an amateur to a grandmaster.</p><p>The between the two is that an amateur calculates moves of individual figures on the board, and the grandmaster can play blind chess with ten people because he operates different information units. The grandmaster thinks not only in combinations and positions but even in entire games.</p><hr><p>Here’s how to integrate shortcuts into your workflow:</p><ul><li><em>Go bottoms-up.</em> Don’t just download 300 most popular English words but make shortcuts based on your unique needs. This means,</li><li><em>Look for big words.</em> You must become the Sherlock of your own typing. Whenever you catch a big word that you type often, go ahead and set up a shortcut for it. The bigger the word, the more benefit you get. For example, you can take the word “progressive” and turn it into a “pg” shortcut. This reduces the number of symbols you need to type 5x and …</li></ul></div></section></article></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://vasilishynkarenka.com/how-to-type-3x-faster/">https://vasilishynkarenka.com/how-to-type-3x-faster/</a></em></p>]]>
            </description>
            <link>https://vasilishynkarenka.com/how-to-type-3x-faster/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24753493</guid>
            <pubDate>Mon, 12 Oct 2020 11:56:39 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[MIVD boss: Meet without a smartphone, risk of espionage too great]]>
            </title>
            <description>
<![CDATA[
Score 201 | Comments 119 (<a href="https://news.ycombinator.com/item?id=24753290">thread link</a>) | @jacquesm
<br/>
October 12, 2020 | https://www.nu.nl/tech/6083317/mivd-baas-vergader-zonder-smartphone-risico-op-spionage-te-groot.html | <a href="https://web.archive.org/web/*/https://www.nu.nl/tech/6083317/mivd-baas-vergader-zonder-smartphone-risico-op-spionage-te-groot.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="block-359449" data-id="block-359449" data-position="" data-type="article.body" data-sac-marker="block.article.body">
    <div>
        <div>
            <p>Jan Swillens, de directeur van de Militaire Inlichtingen- en Veiligheidsdienst (MIVD), adviseert grote organisaties niet met een smartphone of tablet op tafel te vergaderen. Het risico op spionage is dan te groot, zegt hij in een maandag verschenen interview met <a href="https://www.telegraaf.nl/nieuws/1347006281/mivd-baas-jan-swillens-prijst-tophackers-die-ons-land-veilig-houden" target="_blank"><em>De Telegraaf</em></a>.</p>

<p>"Ik denk dat geen raad van bestuur van een grote organisatie meer moet vergaderen over bedrijfsgeheimen met de smartphone of iPad op tafel", aldus Swillens.</p><p>In Nederland wordt de dreiging volgens hem onderschat. De MIVD-directeur noemt de cyberbeveiliging in Nederland nog niet goed genoeg. "Kennis wordt gestolen, vitale systemen en infrastructuur worden aangevallen en er worden pogingen gedaan om onze samenleving via desinformatie te beïnvloeden."</p><p>Swillens kan niet ingaan op recente grote zaken, waarbij werd gepoogd informatie te stelen. Ook legt hij niet uit hoe hackers organisaties via smartphones kunnen afluisteren.</p><p>In 2018 werden spionnen van de Russische inlichtingendienst op heterdaad betrapt door de MIVD. De spionnen probeerden op dat moment het wifinetwerk van de organisatie voor het verbod op chemische wapens (OPCW) binnen te dringen. De vier Russen kregen daarom dit jaar <a href="https://www.nu.nl/tech/6067694/eu-legt-vier-russen-sancties-op-voor-hackaanval-op-opcw-in-den-haag.html" target="_blank">sancties</a> opgelegd.</p>
        </div>
    </div>
</div></div>]]>
            </description>
            <link>https://www.nu.nl/tech/6083317/mivd-baas-vergader-zonder-smartphone-risico-op-spionage-te-groot.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-24753290</guid>
            <pubDate>Mon, 12 Oct 2020 11:20:34 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Hacking together a USB-C charger for a cheap Chromebook]]>
            </title>
            <description>
<![CDATA[
Score 167 | Comments 64 (<a href="https://news.ycombinator.com/item?id=24752714">thread link</a>) | @laktak
<br/>
October 12, 2020 | https://blog.filippo.io/usb-c-charger-for-a-cheap-chromebook/ | <a href="https://web.archive.org/web/*/https://blog.filippo.io/usb-c-charger-for-a-cheap-chromebook/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><section>
            <p>The era of USB-C has come. The other day I threw all other cables into a box, and bought a set of USB-C to USB-C, Lightning, and microUSB cables. USB-C chargers around the house, USB-C PD power bank, even a nice small USB-C dock that works with the Nintendo Switch if the charger can do the right voltage. It's glorious.</p><p>Only one thing won't charge with USB-C, my awfully cheap ($190 for 4GB of RAM) Samsung Chromebook 3, a machine I use when I want the extra security of the Chrome OS platform. Instead, this laptop charges from an old-school 12V barrel connector, forcing me to carry around an extra brick. 😢</p><figure><img src="https://blog.filippo.io/content/images/2020/04/zypds----1.jpeg" alt="side view of the laptop with round charging connector"></figure><p>USB traditionally delivers 5V of power, but with the introduction of the USB Power Delivery standard, devices can negotiate higher voltages with capable power bricks. Indeed, 12V is an option, and at least a couple of my chargers support it.</p><figure><img src="https://blog.filippo.io/content/images/2020/04/zypds----3.jpeg" alt="USB charger with 12V marking amongst others"></figure><p>It should be possible to hack together a USB-C charger for my cheap Chromebook!</p><p>What we need is called a "USB-C PD trigger", a little board that negotiates a specific PD voltage with a charger. There are a few variants, including ones with a button to select the voltage, but the most common one is a tiny board with a female USB-C connector called ZYPDS.</p><p>They are so cheap that I suspect the reason the laptops don't come with them is that 1) it requires a charger that can deliver that specific voltage, and people are already confused enough by USB-C and 2) the USB-C charger side is probably more expensive.</p><p>They usually support 15V/20V (selected by soldering a bridge), and while I suspect 15V would have worked too, I found one on eBay claiming 9V/12V. It has the same model name, but a different PCB color. Perfect!</p><figure><img src="https://blog.filippo.io/content/images/2020/04/Screen-Shot-2020-04-18-at-15.39.38.png" alt="an order for a blue 9V/12V ZYPDS for $4.42"></figure><p>This thing is small enough to fit in a cable (or even in the laptop, but I wanted to keep this as uninvasive as possible) so I also got a short cable with a barrel connector, and some heat shrink tubing.</p><p>When it arrived it was already configured for 12V, and delivered more or less on the spot.</p><figure><img src="https://blog.filippo.io/content/images/2020/04/zypds----7.jpeg" alt="multimeter connected to the ZYPDS showing 12.17V"></figure><p>The only tricky thing was figuring out the polarity of the cable and the connector. I learned that the polarity of the connector is the marking on the charger that looks a little like <code>⊖--Ｃ●--⊕</code>, and commonly the outer surface of the barrel is the negative. I figured out which wire connected to the outer surface with the multimeter continuity mode.</p><figure><img src="https://blog.filippo.io/content/images/2020/04/zypds----8.jpeg" alt="multimeter connected to the barrel connector and a wire from the cable"></figure><p>A mediocre soldering job later I had a short adaptor from USB-C to a barrel connector.</p><figure><img src="https://blog.filippo.io/content/images/2020/04/zypds----9-1.jpeg" alt="ZYPDS with two wires soldered to the connector pads"></figure><p>And it successfully charges the laptop!</p><figure><img src="https://blog.filippo.io/content/images/2020/04/zypds----11.jpeg" alt="the adaptor connected to a charging laptop"></figure><p>The only snag was that the barrel connector I got wasn't a perfect fit for the laptop, so it would lose connection if not pulled downwards. Knowing the setup worked, I just cut the stock charger and used its connector instead. It was more annoying to solder because it's a concentric cable, but it works perfectly.</p><p>With the heat shrink tubing on it doesn't even look that bad, and definitely beats carrying an extra charger around! (By the way, heat shrink tubing is amazing.)</p><figure><img src="https://blog.filippo.io/content/images/2020/04/zypds----2.jpeg" alt="the adaptor charging a laptop"></figure><p>For more hacks, <a href="https://twitter.com/FiloSottile">follow me on Twitter</a>.</p>
        </section></div>]]>
            </description>
            <link>https://blog.filippo.io/usb-c-charger-for-a-cheap-chromebook/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24752714</guid>
            <pubDate>Mon, 12 Oct 2020 09:20:42 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Overloading by Return Type in C++]]>
            </title>
            <description>
<![CDATA[
Score 91 | Comments 50 (<a href="https://news.ycombinator.com/item?id=24752527">thread link</a>) | @fanf2
<br/>
October 12, 2020 | https://artificial-mind.net/blog/2020/10/10/return-type-overloading | <a href="https://web.archive.org/web/*/https://artificial-mind.net/blog/2020/10/10/return-type-overloading">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="site-main" role="main">
    <div>

        <article>

            

            
            <figure>
            </figure>
            

            <section>
                <div>
                    <div><div><pre><code><span>// this is OK</span>
<span>std</span><span>::</span><span>string</span> <span>to_string</span><span>(</span><span>int</span> <span>i</span><span>);</span>
<span>std</span><span>::</span><span>string</span> <span>to_string</span><span>(</span><span>bool</span> <span>b</span><span>);</span>

<span>std</span><span>::</span><span>string</span> <span>si</span> <span>=</span> <span>to_string</span><span>(</span><span>0</span><span>);</span>
<span>std</span><span>::</span><span>string</span> <span>sb</span> <span>=</span> <span>to_string</span><span>(</span><span>true</span><span>);</span>

<span>// this is not OK</span>
<span>int</span> <span>from_string</span><span>(</span><span>std</span><span>::</span><span>string_view</span> <span>s</span><span>);</span>
<span>bool</span> <span>from_string</span><span>(</span><span>std</span><span>::</span><span>string_view</span> <span>s</span><span>);</span>

<span>int</span> <span>i</span> <span>=</span> <span>from_string</span><span>(</span><span>"7"</span><span>);</span>
<span>bool</span> <span>b</span> <span>=</span> <span>from_string</span><span>(</span><span>"false"</span><span>);</span>
</code></pre></div></div>

<p>Overloading by argument types is a pretty straightforward feature of many imperative languages.
However, most of them don’t support overloading by return types.
In particular, C++ does not.
For example, <a href="https://godbolt.org/z/ddWcE8">clang complains</a>:</p>

<div><div><pre><code><span>&lt;</span><span>source</span><span>&gt;:</span><span>4</span><span>:</span><span>6</span><span>:</span> <span>error</span><span>:</span> <span>functions</span> <span>that</span> <span>differ</span> <span>only</span> <span>in</span> <span>their</span> <span>return</span> <span>type</span> <span>cannot</span> <span>be</span> <span>overloaded</span>
<span>bool</span> <span>from_string</span><span>(</span><span>std</span><span>::</span><span>string_view</span> <span>s</span><span>);</span>
<span>~~~~</span> <span>^</span>

<span>&lt;</span><span>source</span><span>&gt;:</span><span>3</span><span>:</span><span>5</span><span>:</span> <span>note</span><span>:</span> <span>previous</span> <span>declaration</span> <span>is</span> <span>here</span>
<span>int</span> <span>from_string</span><span>(</span><span>std</span><span>::</span><span>string_view</span> <span>s</span><span>);</span>
<span>~~~</span> <span>^</span>
</code></pre></div></div>

<p>So… what if I told you we actually <em>can</em> overload by return type in C++?</p>

<p>…</p>

<p>By a slight misuse of user-defined conversion operators.</p>

<h2 id="a-proof-of-concept">A Proof-of-Concept</h2>

<p><a href="https://en.cppreference.com/w/cpp/language/cast_operator">Conversion operators can be user-defined</a> in C++.
They allow us to add custom implicit or explicit conversion to our types.
These conversions themselves can also be overloaded, which leads us to a simple prototype:</p>

<div><div><pre><code><span>struct</span> <span>to_string_t</span>
<span>{</span>
    <span>std</span><span>::</span><span>string_view</span> <span>s</span><span>;</span>

    <span>operator</span> <span>int</span><span>()</span> <span>const</span><span>;</span>  <span>// int  from_string(std::string_view s);</span>
    <span>operator</span> <span>bool</span><span>()</span> <span>const</span><span>;</span> <span>// bool from_string(std::string_view s);</span>
<span>};</span>

<span>int</span> <span>i</span> <span>=</span> <span>to_string_t</span><span>{</span><span>"7"</span><span>};</span>
<span>bool</span> <span>b</span> <span>=</span> <span>to_string_t</span><span>{</span><span>"true"</span><span>};</span>
</code></pre></div></div>

<p><a href="https://godbolt.org/z/f3chze">Looking at godbolt</a>, this compiles and calls the desired conversion operators.
An important point to note here is that the compiler needs to know the <em>target</em> type for the conversion.
Thus, <code>auto i = to_string_t{"7"};</code> does not work as intended.
<code>i</code> will be of type <code>to_string_t</code> and not <code>int</code>.</p>

<h2 id="packaging-and-usage">Packaging and Usage</h2>

<p>We can achieve the original goal of an overloaded function by simply returning <code>to_string_t</code>:</p>

<div><div><pre><code><span>to_string_t</span> <span>from_string</span><span>(</span><span>std</span><span>::</span><span>string_view</span> <span>s</span><span>)</span> <span>{</span> <span>return</span> <span>to_string_t</span><span>{</span><span>s</span><span>};</span> <span>}</span>

<span>int</span> <span>i</span> <span>=</span> <span>from_string</span><span>(</span><span>"7"</span><span>);</span>
<span>bool</span> <span>b</span> <span>=</span> <span>from_string</span><span>(</span><span>"true"</span><span>);</span>
</code></pre></div></div>

<p>Alternatively, one can adhere to <a href="https://herbsutter.com/2013/08/12/gotw-94-solution-aaa-style-almost-always-auto/">almost always auto</a> and write:</p>

<div><div><pre><code><span>auto</span> <span>i</span> <span>=</span> <span>int</span><span>(</span><span>from_string</span><span>(</span><span>"7"</span><span>));</span>
<span>auto</span> <span>b</span> <span>=</span> <span>bool</span><span>(</span><span>from_string</span><span>(</span><span>"true"</span><span>));</span>
</code></pre></div></div>

<p>This technique also works when calling other functions:</p>

<div><div><pre><code><span>void</span> <span>foo</span><span>(</span><span>bool</span> <span>b</span><span>,</span> <span>int</span> <span>i</span><span>);</span>

<span>foo</span><span>(</span><span>from_string</span><span>(</span><span>"false"</span><span>),</span> <span>from_string</span><span>(</span><span>"0"</span><span>));</span>
</code></pre></div></div>

<p>And even interacts properly with more complex, potentially templated objects:</p>

<div><div><pre><code><span>std</span><span>::</span><span>vector</span><span>&lt;</span><span>int</span><span>&gt;</span> <span>vec</span><span>;</span>
<span>std</span><span>::</span><span>map</span><span>&lt;</span><span>int</span><span>,</span> <span>bool</span><span>&gt;</span> <span>map</span><span>;</span>

<span>vec</span><span>.</span><span>push_back</span><span>(</span><span>from_string</span><span>(</span><span>"11"</span><span>));</span>
<span>map</span><span>[</span><span>from_string</span><span>(</span><span>"3"</span><span>)]</span> <span>=</span> <span>from_string</span><span>(</span><span>"true"</span><span>);</span>
<span>vec</span><span>.</span><span>emplace_back</span><span>(</span><span>from_string</span><span>(</span><span>"5"</span><span>));</span>
</code></pre></div></div>

<p>Note how <a href="https://en.cppreference.com/w/cpp/container/vector/emplace_back"><code>emplace_back</code> is templated</a> and internally constructs an <code>int</code> from our <code>to_string_t</code>.</p>

<p>Finally, <code>if (cond)</code> tries to convert <code>cond</code> to <code>bool</code> and thus also works:</p>

<div><div><pre><code><span>if</span> <span>(</span><span>from_string</span><span>(</span><span>"true"</span><span>))</span>
    <span>on_true</span><span>();</span>
<span>else</span>
    <span>on_false</span><span>();</span>
</code></pre></div></div>

<p>These examples can be seen in action <a href="https://godbolt.org/z/1x5de4">at godbolt</a>.</p>

<h2 id="where-it-doesnt-work">Where It Doesn’t Work</h2>

<p>While we can achieve overloading by return type in many cases using the conversion operator technique, it doesn’t always apply.
As previously mentioned, the compiler needs to know the target type to choose the proper conversion operator and will not convert unless forced to.
We already saw the simplest case where no conversion is applied:</p>

<div><div><pre><code><span>auto</span> <span>i</span> <span>=</span> <span>to_string</span><span>(</span><span>"7"</span><span>);</span>
<span>// decltype(i) is to_string_t, not int</span>
</code></pre></div></div>

<p>Another problematic case arises when paired with normal overloading that leads to ambiguities:</p>

<div><div><pre><code><span>void</span> <span>bar</span><span>(</span><span>int</span><span>);</span>
<span>void</span> <span>bar</span><span>(</span><span>bool</span><span>);</span>

<span>bar</span><span>(</span><span>from_string</span><span>(</span><span>"true"</span><span>));</span>
</code></pre></div></div>

<p>Which results in:</p>

<div><div><pre><code><span>error:</span> <span>call</span> <span>to</span> <span>'</span><span>bar</span><span>'</span> <span>is</span> <span>ambiguous</span>
<span>bar</span><span>(</span><span>from_string</span><span>(</span><span>"true"</span><span>));</span>
<span>^~~</span>
<span>&lt;</span><span>source</span><span>&gt;:</span><span>41</span><span>:</span><span>6</span><span>:</span> <span>note</span><span>:</span> <span>candidate</span> <span>function</span>
<span>void</span> <span>bar</span><span>(</span><span>int</span><span>);</span>
     <span>^</span>
<span>&lt;</span><span>source</span><span>&gt;:</span><span>42</span><span>:</span><span>6</span><span>:</span> <span>note</span><span>:</span> <span>candidate</span> <span>function</span>
<span>void</span> <span>bar</span><span>(</span><span>bool</span><span>);</span>
     <span>^</span>
</code></pre></div></div>

<p>Similarly, this means that <code>std::cout &lt;&lt; from_string("2") &lt;&lt; std::endl;</code> does not work.
(The error message for that is slightly ghastly as we have at least 16 candidate overloads.)</p>

<p>Finally, only one user-defined conversion can be applied implicitly, so the following <a href="https://godbolt.org/z/Gxq1rb">doesn’t work</a>:</p>

<div><div><pre><code><span>struct</span> <span>bar</span> 
<span>{</span>
    <span>bar</span><span>(</span><span>int</span> <span>i</span><span>);</span>
<span>};</span>

<span>void</span> <span>test_bar</span><span>(</span><span>bar</span> <span>b</span><span>);</span>

<span>test_bar</span><span>(</span><span>from_string</span><span>(</span><span>"3"</span><span>));</span>
</code></pre></div></div>

<p>The compiler only tries to directly convert <code>to_string_t</code> to <code>bar</code>:</p>

<div><div><pre><code><span>&lt;</span><span>source</span><span>&gt;:</span><span>22</span><span>:</span><span>5</span><span>:</span> <span>error</span><span>:</span> <span>no</span> <span>matching</span> <span>function</span> <span>for</span> <span>call</span> <span>to</span> <span>'</span><span>test_bar</span><span>'</span>
    <span>test_bar</span><span>(</span><span>from_string</span><span>(</span><span>"3"</span><span>));</span>
    <span>^~~~~~~~</span>
<span>&lt;</span><span>source</span><span>&gt;:</span><span>18</span><span>:</span><span>6</span><span>:</span> <span>note</span><span>:</span> <span>candidate</span> <span>function</span> <span>not</span> <span>viable</span><span>:</span> <span>no</span> <span>known</span> <span>conversion</span> <span>from</span> <span>'</span><span>to_string_t</span><span>'</span> <span>to</span> <span>'</span><span>bar</span><span>'</span> <span>for</span> <span>1s</span><span>t</span> <span>argument</span>
<span>void</span> <span>test_bar</span><span>(</span><span>bar</span> <span>b</span><span>);</span>
     <span>^</span>
</code></pre></div></div>

<p>All these cases can be resolved by explicitly adding a cast to the desired type, e.g. <code>int(to_string("10"))</code>.</p>

<h2 id="extensibility">Extensibility</h2>

<p>One important aspect of normal function overloading in C++ is the extensibility of the overload set.
Independent authors and libraries can add to the same overload set simply by providing a function with the proper name in the same namespace.
We might also add to the overload set via <a href="https://en.cppreference.com/w/cpp/language/adl">argument-dependent lookup</a>, though if this should be considered feature or bug is slightly controversial.</p>

<p>In its base form, our conversion operator approach is not extensible.
User-defined conversion functions must be member functions and we cannot add members to other classes post-hoc.
Thus, if our library defines</p>

<div><div><pre><code><span>struct</span> <span>to_string_t</span>
<span>{</span>
    <span>std</span><span>::</span><span>string_view</span> <span>s</span><span>;</span>

    <span>operator</span> <span>int</span><span>()</span> <span>const</span><span>;</span>  <span>// int  from_string(std::string_view s);</span>
    <span>operator</span> <span>bool</span><span>()</span> <span>const</span><span>;</span> <span>// bool from_string(std::string_view s);</span>
<span>};</span>
</code></pre></div></div>

<p>Then this means “overload for return types <code>int</code> and <code>bool</code>” and other libraries / files cannot add to that.</p>

<p>There is a way to fix this and add extensibility.
This will add some implementation complexity and for more specialized use cases, extensibility might not actually be desired.
However, I would argue that <code>from_string</code> should be designed with extensibility in mind.</p>

<blockquote>
  <p>Note: the rest of this section focuses more on metaprogramming and API design than the return-type overloading.
You can skip to the next section to see the final version.</p>
</blockquote>

<p>The solution here is that conversion functions can be templated.
We will use that to delegate the conversion to a template specialization, which is then properly extensible:</p>

<div><div><pre><code><span>template</span> <span>&lt;</span><span>class</span> <span>T</span><span>&gt;</span>
<span>struct</span> <span>to_string_impl</span> 
<span>{</span>
    <span>static_assert</span><span>(</span><span>always_false</span><span>&lt;</span><span>T</span><span>&gt;</span><span>,</span> <span>"conversion to T not supported"</span><span>);</span>
<span>};</span>

<span>struct</span> <span>to_string_t</span>
<span>{</span>
    <span>std</span><span>::</span><span>string_view</span> <span>s</span><span>;</span>

    <span>template</span> <span>&lt;</span><span>class</span> <span>T</span><span>&gt;</span>
    <span>operator</span> <span>T</span><span>()</span> <span>const</span> <span>{</span> <span>return</span> <span>to_string_impl</span><span>&lt;</span><span>T</span><span>&gt;::</span><span>from_string</span><span>(</span><span>s</span><span>);</span> <span>}</span>
<span>};</span>

<span>to_string_t</span> <span>from_string</span><span>(</span><span>std</span><span>::</span><span>string_view</span> <span>s</span><span>)</span> <span>{</span> <span>return</span> <span>to_string_t</span><span>{</span><span>s</span><span>};</span> <span>}</span>
</code></pre></div></div>

<p>The conversion in <code>to_string_t</code> is now templated and always calls <code>to_string_impl&lt;T&gt;::from_string(s)</code>.
<code>to_string_impl&lt;T&gt;</code> is a class template that is specialized for all supported conversions.
Should a non-supported conversion be called, the <a href="https://artificial-mind.net/blog/2020/10/03/always-false"><code>always_false&lt;T&gt;</code> produces a nice(-ish) error message</a>.
We can now add our supported conversions via:</p>

<div><div><pre><code><span>template</span> <span>&lt;</span><span>&gt;</span>
<span>struct</span> <span>to_string_impl</span><span>&lt;</span><span>int</span><span>&gt;</span>
<span>{</span>
    <span>static</span> <span>int</span> <span>from_string</span><span>(</span><span>std</span><span>::</span><span>string_view</span> <span>s</span><span>);</span>
<span>};</span>

<span>template</span> <span>&lt;</span><span>&gt;</span>
<span>struct</span> <span>to_string_impl</span><span>&lt;</span><span>bool</span><span>&gt;</span>
<span>{</span>
    <span>static</span> <span>bool</span> <span>from_string</span><span>(</span><span>std</span><span>::</span><span>string_view</span> <span>s</span><span>);</span>
<span>};</span>
</code></pre></div></div>

<p>And similarly, other authors or the end user can add conversions for custom types.
Sometimes, it is useful to conditionally add conversions.
For example <code>my_range&lt;T&gt;</code> might only be supported if <code>T</code> itself supports <code>from_string</code>.
Thus, it is customary to add a second template argument to the base template:</p>

<div><div><pre><code><span>template</span> <span>&lt;</span><span>class</span> <span>T</span><span>,</span> <span>class</span> <span>=</span> <span>void</span><span>&gt;</span>
<span>struct</span> <span>to_string_impl</span> 
<span>{</span>
    <span>static_assert</span><span>(</span><span>always_false</span><span>&lt;</span><span>T</span><span>&gt;</span><span>,</span> <span>"conversion to T not supported"</span><span>);</span>
<span>};</span>
</code></pre></div></div>

<p>This enables our imaginary end user to write:</p>

<div><div><pre><code><span>template</span> <span>&lt;</span><span>class</span> <span>T</span><span>&gt;</span>
<span>struct</span> <span>to_string_impl</span><span>&lt;</span><span>my_range</span><span>&lt;</span><span>T</span><span>&gt;</span><span>,</span> <span>std</span><span>::</span><span>enable_if_t</span><span>&lt;</span><span>has_from_string</span><span>&lt;</span><span>T</span><span>&gt;&gt;&gt;</span>
<span>{</span>
    <span>static</span> <span>my_range</span><span>&lt;</span><span>T</span><span>&gt;</span> <span>from_string</span><span>(</span><span>std</span><span>::</span><span>string_view</span> <span>s</span><span>);</span> <span>// e.g. "[1, 2, 3]"</span>
<span>};</span>
</code></pre></div></div>

<p>The partial specialization is only “active”, if <code>T</code> itself satisfies <code>has_from_string&lt;T&gt;</code>.
(This, of course, is an example of <a href="https://en.cppreference.com/w/cpp/language/sfinae">SFINAE</a>).</p>

<p>Such a <code>has_from_string&lt;T&gt;</code> might look like this:</p>

<div><div><pre><code><span>template</span> <span>&lt;</span><span>class</span> <span>T</span><span>&gt;</span>
<span>auto</span> <span>impl_has_from_string</span><span>(</span><span>int</span><span>)</span> <span>-&gt;</span> <span>decltype</span><span>(</span>
    <span>to_string_impl</span><span>&lt;</span><span>T</span><span>&gt;::</span><span>from_string</span><span>(</span><span>std</span><span>::</span><span>declval</span><span>&lt;</span><span>std</span><span>::</span><span>string_view</span><span>&gt;</span><span>()),</span> 
    <span>std</span><span>::</span><span>true_type</span><span>{});</span>

<span>template</span> <span>&lt;</span><span>class</span> <span>T</span><span>&gt;</span>
<span>std</span><span>::</span><span>false_type</span> <span>impl_has_from_string</span><span>(</span><span>char</span><span>);</span>

<span>template</span> <span>&lt;</span><span>class</span> <span>T</span><span>&gt;</span>
<span>constexpr</span> <span>bool</span> <span>has_from_string</span> <span>=</span> <span>decltype</span><span>(</span><span>impl_has_from_string</span><span>&lt;</span><span>T</span><span>&gt;</span><span>(</span><span>0</span><span>))</span><span>::</span><span>value</span><span>;</span>
</code></pre></div></div>

<p>Here, we use <a href="https://en.cppreference.com/w/cpp/language/sfinae#Expression_SFINAE">Expression SFINAE</a> to disable the first <code>impl_has_from_string</code> overload if <code>to_string_impl&lt;T&gt;::from_string</code> does not exist.
<code>impl_has_from_string</code> itself is overloaded on <code>int</code> and <code>char</code> and called via <code>impl_has_from_string&lt;T&gt;(0)</code>.
This is a cheap way to say “try the <code>int</code> overload first and if it doesn’t apply, take the <code>char</code> overload”.
However, if we try to check <code>has_from_string&lt;T&gt;</code> for some type that has no <code>from_string</code>, we trigger the <code>static_assert(always_false&lt;T&gt;);</code> in the base template.
Thus, we move the <code>static_assert</code> to <code>to_string_t::operator T()</code> (see next section).</p>

<p>Note that the templated <code>to_string_impl</code> class is not the only option.
We could also use <a href="https://arne-mertz.de/2016/10/tag-dispatch/">tag dispatch</a> or even normal overloading, e.g. by delegating to (a user-extensible) <code>void convert_to(std::string_view s, T&amp; v)</code> that is overloaded on the second parameter.</p>

<h2 id="final-version">Final Version</h2>

<p>For reference, our extensible and checkable version of return-type overloading in C++:</p>

<div><div><pre><code><span>// base template, specialize and provide a static from_string method</span>
<span>template</span> <span>&lt;</span><span>class</span> <span>T</span><span>,</span> <span>class</span> <span>=</span> <span>void</span><span>&gt;</span>
<span>struct</span> <span>to_string_impl</span> 
<span>{</span>
<span>};</span>

<span>namespace</span> <span>detail</span> <span>// hide impl detail</span>
<span>{</span>
<span>template</span> <span>&lt;</span><span>class</span> <span>T</span><span>&gt;</span>
<span>auto</span> <span>has_from_string</span><span>(</span><span>int</span><span>)</span> <span>-&gt;</span> <span>decltype</span><span>(</span>
    <span>to_string_impl</span><span>&lt;</span><span>T</span><span>&gt;::</span><span>from_string</span><span>(</span><span>std</span><span>::</span><span>declval</span><span>&lt;</span><span>std</span><span>::</span><span>string_view</span><span>&gt;</span><span>()),</span> 
    <span>std</span><span>::</span><span>true_type</span><span>{});</span>

<span>template</span> <span>&lt;</span><span>class</span> <span>T</span><span>&gt;</span>
<span>std</span><span>::</span><span>false_type</span> <span>has_from_string</span><span>(</span><span>char</span><span>);</span>
<span>}</span>

<span>// check if T has a from_string</span>
<span>template</span> <span>&lt;</span><span>class</span> <span>T</span><span>&gt;</span>
<span>constexpr</span> <span>bool</span> <span>has_from_string</span> <span>=</span> <span>decltype</span><span>(</span><span>detail</span><span>::</span><span>has_from_string</span><span>&lt;</span><span>T</span><span>&gt;</span><span>(</span><span>0</span><span>))</span><span>::</span><span>value</span><span>;</span>

<span>// return-type overload mechanism</span>
<span>struct</span> <span>to_string_t</span>
<span>{</span>
    <span>std</span><span>::</span><span>string_view</span> <span>s</span><span>;</span>

    <span>template</span> <span>&lt;</span><span>class</span> <span>T</span><span>&gt;</span>
    <span>operator</span> <span>T</span><span>()</span> <span>const</span> 
    <span>{</span>
        <span>static_assert</span><span>(</span><span>has_from_string</span><span>&lt;</span><span>T</span><span>&gt;</span><span>,</span> <span>"conversion to T not supported"</span><span>);</span>
        <span>return</span> <span>to_string_impl</span><span>&lt;</span><span>T</span><span>&gt;::</span><span>from_string</span><span>(</span><span>s</span><span>);</span> 
    <span>}</span>
<span>};</span>

<span>// convenience wrapper to provide a "return-type overloaded function"</span>
<span>to_string_t</span> <span>from_string</span><span>(</span><span>std</span><span>::</span><span>string_view</span> <span>s</span><span>)</span> <span>{</span> <span>return</span> <span>to_string_t</span><span>{</span><span>s</span><span>};</span> <span>}</span>
</code></pre></div></div>

<p>Anyone can register new types, optionally using SFINAE to conditionally support them:</p>

<div><div><pre><code><span>template</span> <span>&lt;</span><span>&gt;</span>
<span>struct</span> <span>to_string_impl</span><span>&lt;</span><span>int</span><span>&gt;</span>
<span>{</span>
    <span>static</span> <span>int</span> <span>from_string</span><span>(</span><span>std</span><span>::</span><span>string_view</span> <span>s</span><span>);</span>
<span>};</span>

<span>template</span> <span>&lt;</span>…</code></pre></div></div></div></section></article></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://artificial-mind.net/blog/2020/10/10/return-type-overloading">https://artificial-mind.net/blog/2020/10/10/return-type-overloading</a></em></p>]]>
            </description>
            <link>https://artificial-mind.net/blog/2020/10/10/return-type-overloading</link>
            <guid isPermaLink="false">hacker-news-small-sites-24752527</guid>
            <pubDate>Mon, 12 Oct 2020 08:43:13 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Case 001 – The Stolen Szechuan Sauce]]>
            </title>
            <description>
<![CDATA[
Score 80 | Comments 11 (<a href="https://news.ycombinator.com/item?id=24751122">thread link</a>) | @wglb
<br/>
October 11, 2020 | https://dfirmadness.com/the-stolen-szechuan-sauce/ | <a href="https://web.archive.org/web/*/https://dfirmadness.com/the-stolen-szechuan-sauce/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
          <p><span><span>Reading Time: </span> <span>5</span> <span>minutes</span></span></p><h2>The Case of the Stolen Szechuan Sauce</h2>
<div id="attachment_533"><p><img aria-describedby="caption-attachment-533" loading="lazy" src="https://i1.wp.com/dfirmadness.com/wp-content/uploads/2020/09/stolen-szechuan-sauce.jpg?resize=1024%2C930&amp;ssl=1" alt="The Stolen Szechuan Sauce" width="1024" height="930" srcset="https://i1.wp.com/dfirmadness.com/wp-content/uploads/2020/09/stolen-szechuan-sauce.jpg?w=1024&amp;ssl=1 1024w, https://i1.wp.com/dfirmadness.com/wp-content/uploads/2020/09/stolen-szechuan-sauce.jpg?resize=300%2C272&amp;ssl=1 300w, https://i1.wp.com/dfirmadness.com/wp-content/uploads/2020/09/stolen-szechuan-sauce.jpg?resize=768%2C698&amp;ssl=1 768w" sizes="(max-width: 1024px) 100vw, 1024px" data-recalc-dims="1"></p><p id="caption-attachment-533">The Stolen Szechuan Sauce [image courtesy of <a href="https://www.deviantart.com/artwork-tee/art/Mulan-Szechuan-McNugget-Sauce-683650185" target="_blank" rel="noopener noreferrer">artwork-tee</a>]</p></div><p>Your bedroom door bursts open, shattering your pleasant dreams. Your mad scientist of a boss begins dragging you out of bed by the ankle. He simultaneously explains between belches that the FBI contacted him. They found his recently-developed Szechuan sauce recipe on the dark web. As you careen past the door frame you are able to grab your incident response “Go-Bag”. Inside is your trusty incident thumb drive and laptop.</p>
<p>Resources for getting started will be provided at the <em><span>bottom of the post</span></em>. <em><span>Additionally</span><span>, i</span><span>ndividual articles on working through the artifacts and solving the case will be posted in the coming weeks!</span></em> So be sure to check back soon.</p>
<h3>Purpose</h3>
<p>This lab is for learning and practicing forensics obviously! We will also be providing training for free through a series of upcoming posts on how to solve the case!</p>
<h3>Target Audience</h3>
<p>Experienced digital forensics Jedi Masters who want a fun case as well as aspiring forensics folks who want to learn and practice.</p>
<p>Teachers, Professors, Mentors, and Students are welcome to use these materials so long as credit is given to this site and its authors.</p>
<h3>Game-isms</h3>
<p>With training in mind, there are intentional (not to mention unintentional) mistakes in the data. Consequently, the timelines are sometimes compressed. For example, the time between the victim’s notification and when someone acquired the images does not make sense in the real world. Likewise, some of the adversary activities are stealthy, funny, or enable training efforts. However, the attack mirrors real-world adversary tactics, techniques, tools, and procedures. Consequently, it will support training and real-world incident preparedness.</p>
<h3>Questions to Answer / Goals</h3>
<ol>
<li>What’s the Operating System of the Server?</li>
<li>What’s the Operating System of the Desktop?</li>
<li>What was the local time of the Server?</li>
<li>Was there a breach?</li>
<li>What was the initial entry vector (how did they get in)?</li>
<li>Was malware used? If so what was it? If there was malware answer the following:
<ol>
<li>What process was malicious?</li>
<li>Identify the IP Address that delivered the payload.</li>
<li>What IP Address is the malware calling to?</li>
<li>Where is this malware on disk?</li>
<li>When did it first appear?</li>
<li>Did someone move it?</li>
<li>What were the capabilities of this malware?</li>
<li>Is this malware easily obtained?</li>
<li>Was this malware installed with persistence on any machine?
<ol>
<li>When?</li>
<li>Where?</li>
</ol>
</li>
</ol>
</li>
<li>What malicious IP Addresses were involved?
<ol>
<li>Were any IP Addresses from known adversary infrastructure?</li>
<li>Are these pieces of adversary infrastructure involved in other attacks around the time of the attack?</li>
</ol>
</li>
<li>Did the attacker access any other systems?
<ol>
<li>How?</li>
<li>When?</li>
<li>Did the attacker steal or access any data?
<ol>
<li>When?</li>
</ol>
</li>
</ol>
</li>
<li>What was the network layout of the victim network?</li>
<li>What architecture changes should be made immediately?<strong><br>
</strong></li>
<li>Did the attacker steal the Szechuan sauce? If so, what time?</li>
<li>Did the attacker steal or access any other sensitive files? If so, what times?</li>
<li>Finally, when was the last known contact with the adversary?</li>
</ol>
<h3>Advanced and Bonus Questions</h3>
<ol>
<li>What CIS Top 20 or SANS Top 20 Controls would have <em>directly </em>prevented this breach?</li>
<li>What major architecture improvement could be made that would have prevented this breach?</li>
<li>Can you identify policy improvements or controls that should be implemented to secure this environment?</li>
<li>Which users have actually logged onto the DC?</li>
<li>Which users have actually logged onto the Desktop machine?</li>
<li>What are the passwords for the users in the domain?</li>
<li>Can you recover the original file about Beth’s Secrets?
<ol>
<li>What was the original name?</li>
<li>Original Contents?</li>
</ol>
</li>
<li>Finally, what file was time stomped?</li>
</ol>
<p>The answers for the Stolen Szechuan Sauce are here. A humble recommendation: require that students produce screenshots with their names in a report explaining their findings since the answers are here.</p>
<h3>Client Interview</h3>
<p><img loading="lazy" src="https://i1.wp.com/dfirmadness.com/wp-content/uploads/2020/09/RickSanchez.jpg?resize=600%2C338&amp;ssl=1" alt="Rick Sanchez and The Stolen Szechuan Sauce" width="600" height="338" srcset="https://i1.wp.com/dfirmadness.com/wp-content/uploads/2020/09/RickSanchez.jpg?w=600&amp;ssl=1 600w, https://i1.wp.com/dfirmadness.com/wp-content/uploads/2020/09/RickSanchez.jpg?resize=300%2C169&amp;ssl=1 300w" sizes="(max-width: 600px) 100vw, 600px" data-recalc-dims="1"></p>
<p>This interview was conducted while retrieving the artifacts from the system using FTK Imager Lite and a Redline Collector.</p>
<p><strong>Where were the files in question stored?</strong></p>
<p>On the <em>bellllcchhhh</em> File Server on the Domain Controller.</p>
<p><strong>What was the Operating System version of this server?</strong></p>
<p><em>Belch</em> Whatever that idiot Jerry put on there a few years back.</p>
<p><strong>May I have a network map where the affected systems were located?</strong></p>
<p>Sure. All the systems were loc-<em>bellllch</em>-ated in 10.42 something something</p>
<p><strong>Were there any other systems or files you are concerned about?</strong></p>
<p>Yeah, certainly. Morty is ramble <em>belllch</em> rambling on about something he might have had on there. Also, there was a secret about Be<em>belllech</em> …. Beth on the server. So if you find it, and YOU TELL ANYBODY I WILL KILL YOU!</p>
<p>(The threat here matches a character from a popular cartoon character and not any real threat so stay calm).</p>

<p><strong>Note:</strong> This incident occurred at an organization located in Colorado in September. So, this places the incident at UTC -6. Keep this in mind when looking at the output of various tools.</p>

<p><strong>The questions here are not a full example of what to ask during a breach.</strong> It’s part of the training scenario as much as anything else here. It’s also a decent starting point to your investigation would be going through the questions for the exercise and trying to answer those and use them as pivots.</p>
<h3>Potential Questions You May Have</h3>
<p><strong>Why (outdated) Windows 2012?</strong></p>
<p>Its end of life isn’t until 2023 and plenty of people still use it. In fact, investigations reveal that even Windows 2008r2 shows high usage despite an End of Life date of January 2020.</p>
<p><strong>Windows 10?</strong></p>
<p>This will contrast nicely with 2012 for the Memory Forensics as it uses compressed memory. There will also be a difference in Disk Artifacts to explore between the two.</p>
<p><strong>I Don’t Know Forensics! Where do I start?</strong></p>
<p>That’s specifically the point of this training set! We will teach you how to approach this investigation, how to set-up your environment, analyze artifacts, and then to generate a great report!</p>
<h3>The Artifacts</h3>
<p>Separate posts will start appearing soon on how to approach these artifacts, and how to answer the questions above.</p>
<h4>Estimated Difficulty Levels:</h4>
<p><strong>Nightmare</strong> – Disk Image Only</p>
<p><strong>Ultra-Violence</strong> – Disk and Memory</p>
<p><strong>Hurt Me Plenty</strong> – Disk, Memory, and Autoruns</p>
<p><strong>I’m Too Young to Die</strong> – Disk, Memory, Autoruns, and PCAPS.</p>
<p>Also, for a fun twist, try and solve as much of the case as you can without the artifacts from the Desktop.</p>
<hr>
<p><strong>To get the E01’s you may need to use Firefox in a Private Window, hit the back button, select the file, and hit Download.</strong></p>
<p>However, if you are worried about storage and bandwidth ditch the <code>protected files</code> and the <code>pagefiles</code> for now.</p>
<hr>
<p>DC01 <a href="https://dfirmadness.com/case001/DC01-E01.zip">Disk Image (EO1)</a></p>
<p>DC01 <a href="https://dfirmadness.com/case001/DC01-memory.zip">Memory</a> and <a href="https://dfirmadness.com/case001/DC01-pagefile.zip">PageFile</a></p>
<p>DC01 <a href="https://dfirmadness.com/case001/DC01-autorunsc.zip"><span>Autoruns</span></a></p>
<p>DC01 <a href="https://dfirmadness.com/case001/DC01-ProtectedFiles.zip"><span>Protected Files</span></a></p>
<p>Case001 <a href="https://dfirmadness.com/case001/case001-pcap.zip"><span>PCAP</span></a></p>
<p>Desktop <a href="https://dfirmadness.com/case001/DESKTOP-E01.zip">Disk Image (E01)</a></p>
<p>Desktop <a href="https://dfirmadness.com/case001/DESKTOP-SDN1RPT-memory.zip">Memory</a> and <a href="https://dfirmadness.com/case001/Desktop-SDN1RPT-pagefile.zip"><span>PageFile</span></a></p>
<p>Desktop <a href="https://dfirmadness.com/case001/DESKTOP-SDN1RPT-autorunsc.zip"><span>Autoruns</span></a></p>
<p>Desktop <a href="https://dfirmadness.com/case001/DESKTOP-SDN1RPT-Protected%20Files.zip"><span>Protected Files</span></a></p>
<p>To verify file integrity in Windows Powershell, from the Download Dir: Get-FileHash -Algorithm md5 *</p>
<p>To verify file integrity in Linux, from the Download Dir: md5sum *</p>
<p>MD5 422046B753CF8A4DF49D2C4CE892DB16&nbsp;&nbsp;&nbsp; case001-pcap.zip<br>
MD5 964F2D710687D170C77C94947DA29E66&nbsp;&nbsp;&nbsp; DC01-autorunsc.zip<br>
MD5 E57FC636E833C5F1AB58DFACE873BBDE&nbsp;&nbsp;&nbsp;&nbsp; DC01-E01.zip<br>
MD5 64A4E2CB47138084A5C2878066B2D7B1 &nbsp;&nbsp; DC01-memory.zip<br>
MD5 964EEAF0009D08CC101DE4A83A4E5D23&nbsp;&nbsp;&nbsp; DC01-pagefile.zip<br>
MD5 AD29830A583EFE49C8C1C35FAFFD264F&nbsp;&nbsp;&nbsp; DC01-ProtectedFiles.zip<br>
MD5 71C5C3509331F472ABCDF81EB6EFFF07&nbsp;&nbsp;&nbsp;&nbsp; DESKTOP-E01.zip<br>
MD5 3627DCAFA54E1365489A4EC0CC3D6A1C&nbsp;&nbsp; DESKTOP-SDN1RPT-autrunsc.zip<br>
MD5 CF31E2635C77811AAA1BB04A92A721E2&nbsp;&nbsp;&nbsp; DESKTOP-SDN1RPT-memory.zip<br>
MD5 45C096F2688A0B5DE0346FB72391B245&nbsp;&nbsp;&nbsp; Desktop-SDN1RPT-pagefile.zip<br>
MD5 3E1A358D50003A9351AC2160AE6F0495&nbsp;&nbsp;&nbsp; DESKTOP-SDN1RPT-Protected Files.zip</p>
<hr>
<h3>Choose Your Next Move</h3>
<p><a href="https://dfirmadness.com/case-001-memory-analysis/" target="_blank" rel="noopener noreferrer">Learn how to look at the memory!</a></p>
<p>How to look at the autoruns!</p>
<p><a href="https://dfirmadness.com/case-001-pcap-analysis/">Show me how to look at the PCAP</a>!</p>
<p>I want to learn how to look at the Disks!</p>
<p><a href="https://dfirmadness.com/answers-to-szechuan-case-001/" target="_blank" rel="noopener noreferrer">Give me the answers!</a></p>
<h3>That’s The Case of the Stolen Szechuan Sauce, in conclusion, please feel free to leave your thoughts in the comments.</h3>
                <div>
                    
                                        
        <div>

                <p><a href="https://dfirmadness.com/author/smithsjames/"><img alt="" src="https://secure.gravatar.com/avatar/7cdd754f0eabaed51cf5b298c8e0f5bb?s=150&amp;r=pg" srcset="https://secure.gravatar.com/avatar/7cdd754f0eabaed51cf5b298c8e0f5bb?s=300&amp;r=pg 2x" height="150" width="150" loading="lazy"></a>
                </p>
                
        </div>

                                            </div>
                
                              

        </div></div>]]>
            </description>
            <link>https://dfirmadness.com/the-stolen-szechuan-sauce/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24751122</guid>
            <pubDate>Mon, 12 Oct 2020 03:24:06 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[PySDR: A Guide to SDR and DSP Using Python]]>
            </title>
            <description>
<![CDATA[
Score 194 | Comments 13 (<a href="https://news.ycombinator.com/item?id=24750588">thread link</a>) | @sohkamyung
<br/>
October 11, 2020 | https://pysdr.org/index.html | <a href="https://web.archive.org/web/*/https://pysdr.org/index.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page">
  <div>
    
      <div role="navigation" aria-label="main navigation">
        <div>
<p>
  <a href="#">
    <img src="https://pysdr.org/_static/logo.svg" alt="Logo">
    
    </a></p>



<p>By <a href="https://www.cs.umd.edu/people/sdr">Dr. Marc Lichtman</a></p>






<h3>Navigation</h3>
<ul>
<li><a href="https://pysdr.org/content/intro.html">1. Introduction</a></li>
<li><a href="https://pysdr.org/content/frequency_domain.html">2. Frequency Domain</a></li>
<li><a href="https://pysdr.org/content/sampling.html">3. IQ Sampling</a></li>
<li><a href="https://pysdr.org/content/digital_modulation.html">4. Digital Modulation</a></li>
<li><a href="https://pysdr.org/content/pluto_intro.html">5. PlutoSDR Basics</a></li>
<li><a href="https://pysdr.org/content/pluto_advanced.html">6. PlutoSDR Advanced Topics</a></li>
<li><a href="https://pysdr.org/content/noise.html">7. Noise and dB</a></li>
<li><a href="https://pysdr.org/content/filters.html">8. Filters</a></li>
<li><a href="https://pysdr.org/content/link_budgets.html">9. Link Budgets</a></li>
<li><a href="https://pysdr.org/content/channel_coding.html">10. Channel Coding</a></li>
<li><a href="https://pysdr.org/content/iq_files.html">11. IQ Files</a></li>
<li><a href="https://pysdr.org/content/multipath_fading.html">12. Multipath Fading</a></li>
<li><a href="https://pysdr.org/content/pulse_shaping.html">13. Pulse Shaping</a></li>
<li><a href="https://pysdr.org/content/sync.html">14. Synchronization</a></li>
<li><a href="https://pysdr.org/content/appendix_text_comparison.html">15. Textbook Comparison</a></li>
<li><a href="https://pysdr.org/content/about_author.html">16. About the Author</a></li>
</ul>


<hr>
<ul>
    
    <li><a href="https://repl.it/languages/python3">Online Python Console</a></li>
    
</ul>
<div>
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
      <li>Next: <a href="https://pysdr.org/content/intro.html" title="next chapter"><span>1. </span>Introduction</a></li>
  </ul></li>
</ul>
</div>


        </div>
      </div>
      <div>
        <div>
              <div>
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          <a href="https://pysdr.org/content/intro.html" title="Next document"><span>1. </span>Introduction</a>
          →
        </li>
    </ul>
  </nav>
              </div>
          

          <div role="main">
            
  <div id="pysdr-a-guide-to-sdr-and-dsp-using-python">

<p>by <a href="https://www.cs.umd.edu/people/sdr/" rel="noopener noreferrer" target="_blank">Dr. Marc Lichtman</a></p>
<div>
<ul>
<li><a href="https://pysdr.org/content/intro.html">1. Introduction</a><ul>
<li><a href="https://pysdr.org/content/intro.html#purpose-and-target-audience">Purpose and Target Audience</a></li>
<li><a href="https://pysdr.org/content/intro.html#contributing">Contributing</a></li>
<li><a href="https://pysdr.org/content/intro.html#acknowledgements">Acknowledgements</a></li>
</ul>
</li>
<li><a href="https://pysdr.org/content/frequency_domain.html">2. Frequency Domain</a><ul>
<li><a href="https://pysdr.org/content/frequency_domain.html#fourier-series">Fourier Series</a></li>
<li><a href="https://pysdr.org/content/frequency_domain.html#time-frequency-pairs">Time-Frequency Pairs</a></li>
<li><a href="https://pysdr.org/content/frequency_domain.html#fourier-transform">Fourier Transform</a></li>
<li><a href="https://pysdr.org/content/frequency_domain.html#time-frequency-properties">Time-Frequency Properties</a></li>
<li><a href="https://pysdr.org/content/frequency_domain.html#fast-fourier-transform-fft">Fast Fourier Transform (FFT)</a></li>
<li><a href="https://pysdr.org/content/frequency_domain.html#negative-frequencies">Negative Frequencies</a></li>
<li><a href="https://pysdr.org/content/frequency_domain.html#order-in-time-doesn-t-matter">Order in Time Doesn’t Matter</a></li>
<li><a href="https://pysdr.org/content/frequency_domain.html#fft-in-python">FFT in Python</a></li>
<li><a href="https://pysdr.org/content/frequency_domain.html#windowing">Windowing</a></li>
<li><a href="https://pysdr.org/content/frequency_domain.html#fft-sizing">FFT Sizing</a></li>
<li><a href="https://pysdr.org/content/frequency_domain.html#spectrogram-waterfall">Spectrogram/Waterfall</a></li>
</ul>
</li>
<li><a href="https://pysdr.org/content/sampling.html">3. IQ Sampling</a><ul>
<li><a href="https://pysdr.org/content/sampling.html#sampling-basics">Sampling Basics</a></li>
<li><a href="https://pysdr.org/content/sampling.html#nyquist-sampling">Nyquist Sampling</a></li>
<li><a href="https://pysdr.org/content/sampling.html#quadrature-sampling">Quadrature Sampling</a></li>
<li><a href="https://pysdr.org/content/sampling.html#complex-numbers">Complex Numbers</a></li>
<li><a href="https://pysdr.org/content/sampling.html#receiver-side">Receiver Side</a></li>
<li><a href="https://pysdr.org/content/sampling.html#receiver-architectures">Receiver Architectures</a></li>
<li><a href="https://pysdr.org/content/sampling.html#carrier-and-downconversion">Carrier and Downconversion</a></li>
<li><a href="https://pysdr.org/content/sampling.html#baseband">Baseband</a></li>
<li><a href="https://pysdr.org/content/sampling.html#dc-spike-and-offset-tuning">DC Spike and Offset Tuning</a></li>
<li><a href="https://pysdr.org/content/sampling.html#sampling-using-the-plutosdr">Sampling Using the PlutoSDR</a></li>
<li><a href="https://pysdr.org/content/sampling.html#calculating-average-power">Calculating Average Power</a></li>
<li><a href="https://pysdr.org/content/sampling.html#calculating-power-spectral-density">Calculating Power Spectral Density</a></li>
</ul>
</li>
<li><a href="https://pysdr.org/content/digital_modulation.html">4. Digital Modulation</a><ul>
<li><a href="https://pysdr.org/content/digital_modulation.html#symbols">Symbols</a></li>
<li><a href="https://pysdr.org/content/digital_modulation.html#wireless-symbols">Wireless Symbols</a></li>
<li><a href="https://pysdr.org/content/digital_modulation.html#amplitude-shift-keying-ask">Amplitude Shift Keying (ASK)</a></li>
<li><a href="https://pysdr.org/content/digital_modulation.html#phase-shift-keying-psk">Phase Shift Keying (PSK)</a></li>
<li><a href="https://pysdr.org/content/digital_modulation.html#iq-plots-constellations">IQ Plots/Constellations</a></li>
<li><a href="https://pysdr.org/content/digital_modulation.html#quadrature-amplitude-modulation-qam">Quadrature Amplitude Modulation (QAM)</a></li>
<li><a href="https://pysdr.org/content/digital_modulation.html#frequency-shift-keying-fsk">Frequency Shift Keying (FSK)</a></li>
<li><a href="https://pysdr.org/content/digital_modulation.html#python-example">Python Example</a></li>
</ul>
</li>
<li><a href="https://pysdr.org/content/pluto_intro.html">5. PlutoSDR Basics</a><ul>
<li><a href="https://pysdr.org/content/pluto_intro.html#software-drivers-install">Software/Drivers Install</a></li>
<li><a href="https://pysdr.org/content/pluto_intro.html#python-exercises">Python Exercises</a></li>
</ul>
</li>
<li><a href="https://pysdr.org/content/pluto_advanced.html">6. PlutoSDR Advanced Topics</a><ul>
<li><a href="https://pysdr.org/content/pluto_advanced.html#automatic-gain-control">Automatic Gain Control</a></li>
<li><a href="https://pysdr.org/content/pluto_advanced.html#transmitting-over-the-air-legally">Transmitting Over the Air Legally</a></li>
</ul>
</li>
<li><a href="https://pysdr.org/content/noise.html">7. Noise and dB</a><ul>
<li><a href="https://pysdr.org/content/noise.html#gaussian-noise">Gaussian Noise</a></li>
<li><a href="https://pysdr.org/content/noise.html#decibels-db">Decibels (dB)</a></li>
<li><a href="https://pysdr.org/content/noise.html#noise-in-frequency-domain">Noise in Frequency Domain</a></li>
<li><a href="https://pysdr.org/content/noise.html#complex-noise">Complex Noise</a></li>
<li><a href="https://pysdr.org/content/noise.html#awgn">AWGN</a></li>
<li><a href="https://pysdr.org/content/noise.html#snr">SNR</a></li>
<li><a href="https://pysdr.org/content/noise.html#external-resources">External Resources</a></li>
</ul>
</li>
<li><a href="https://pysdr.org/content/filters.html">8. Filters</a><ul>
<li><a href="https://pysdr.org/content/filters.html#filter-basics">Filter Basics</a></li>
<li><a href="https://pysdr.org/content/filters.html#filter-representation">Filter Representation</a></li>
<li><a href="https://pysdr.org/content/filters.html#filter-implementation">Filter Implementation</a></li>
<li><a href="https://pysdr.org/content/filters.html#filter-design-tools">Filter Design Tools</a></li>
<li><a href="https://pysdr.org/content/filters.html#convolution">Convolution</a></li>
<li><a href="https://pysdr.org/content/filters.html#filter-design-in-python">Filter Design in Python</a></li>
<li><a href="https://pysdr.org/content/filters.html#intro-to-pulse-shaping">Intro to Pulse Shaping</a></li>
</ul>
</li>
<li><a href="https://pysdr.org/content/link_budgets.html">9. Link Budgets</a><ul>
<li><a href="https://pysdr.org/content/link_budgets.html#intro">Intro</a></li>
<li><a href="https://pysdr.org/content/link_budgets.html#signal-power-budget">Signal Power Budget</a></li>
<li><a href="https://pysdr.org/content/link_budgets.html#noise-power-budget">Noise Power Budget</a></li>
<li><a href="https://pysdr.org/content/link_budgets.html#snr">SNR</a></li>
<li><a href="https://pysdr.org/content/link_budgets.html#example-link-budget-ads-b">Example Link Budget: ADS-B</a></li>
</ul>
</li>
<li><a href="https://pysdr.org/content/channel_coding.html">10. Channel Coding</a><ul>
<li><a href="https://pysdr.org/content/channel_coding.html#why-we-need-channel-coding">Why We Need Channel Coding</a></li>
<li><a href="https://pysdr.org/content/channel_coding.html#types-of-codes">Types of Codes</a></li>
<li><a href="https://pysdr.org/content/channel_coding.html#code-rate">Code-Rate</a></li>
<li><a href="https://pysdr.org/content/channel_coding.html#modulation-and-coding">Modulation and Coding</a></li>
<li><a href="https://pysdr.org/content/channel_coding.html#hamming-code">Hamming Code</a></li>
<li><a href="https://pysdr.org/content/channel_coding.html#soft-vs-hard-decoding">Soft vs Hard Decoding</a></li>
<li><a href="https://pysdr.org/content/channel_coding.html#shannon-limit">Shannon Limit</a></li>
<li><a href="https://pysdr.org/content/channel_coding.html#state-of-the-art-codes">State of the Art Codes</a></li>
</ul>
</li>
<li><a href="https://pysdr.org/content/iq_files.html">11. IQ Files</a><ul>
<li><a href="https://pysdr.org/content/iq_files.html#binary-files">Binary Files</a></li>
<li><a href="https://pysdr.org/content/iq_files.html#python-examples">Python Examples</a></li>
<li><a href="https://pysdr.org/content/iq_files.html#max-values-and-saturation">Max Values and Saturation</a></li>
<li><a href="https://pysdr.org/content/iq_files.html#annotating-iq-files">Annotating IQ Files</a></li>
</ul>
</li>
<li><a href="https://pysdr.org/content/multipath_fading.html">12. Multipath Fading</a><ul>
<li><a href="https://pysdr.org/content/multipath_fading.html#multipath">Multipath</a></li>
<li><a href="https://pysdr.org/content/multipath_fading.html#fading">Fading</a></li>
<li><a href="https://pysdr.org/content/multipath_fading.html#mitigating-multipath-fading">Mitigating Multipath Fading</a></li>
</ul>
</li>
<li><a href="https://pysdr.org/content/pulse_shaping.html">13. Pulse Shaping</a><ul>
<li><a href="https://pysdr.org/content/pulse_shaping.html#inter-symbol-interference-isi">Inter-Symbol-Interference (ISI)</a></li>
<li><a href="https://pysdr.org/content/pulse_shaping.html#matched-filter">Matched Filter</a></li>
<li><a href="https://pysdr.org/content/pulse_shaping.html#splitting-a-filter-in-half">Splitting a Filter in Half</a></li>
<li><a href="https://pysdr.org/content/pulse_shaping.html#specific-pulse-shaping-filters">Specific Pulse Shaping Filters</a></li>
<li><a href="https://pysdr.org/content/pulse_shaping.html#roll-off-factor">Roll-off Factor</a></li>
<li><a href="https://pysdr.org/content/pulse_shaping.html#python-exercise">Python Exercise</a></li>
</ul>
</li>
<li><a href="https://pysdr.org/content/sync.html">14. Synchronization</a><ul>
<li><a href="https://pysdr.org/content/sync.html#introduction">Introduction</a></li>
<li><a href="https://pysdr.org/content/sync.html#simulating-wireless-channel">Simulating Wireless Channel</a></li>
<li><a href="https://pysdr.org/content/sync.html#time-synchronization">Time Synchronization</a></li>
<li><a href="https://pysdr.org/content/sync.html#time-synchronization-with-interpolation">Time Synchronization with Interpolation</a></li>
<li><a href="https://pysdr.org/content/sync.html#coarse-frequency-synchronization">Coarse Frequency Synchronization</a></li>
<li><a href="https://pysdr.org/content/sync.html#fine-frequency-synchronization">Fine Frequency Synchronization</a></li>
<li><a href="https://pysdr.org/content/sync.html#frame-synchronization">Frame Synchronization</a></li>
</ul>
</li>
<li><a href="https://pysdr.org/content/appendix_text_comparison.html">15. Textbook Comparison</a></li>
<li><a href="https://pysdr.org/content/about_author.html">16. About the Author</a></li>
</ul>
</div>
</div>


          </div>
              <div>
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          <a href="https://pysdr.org/content/intro.html" title="Next document"><span>1. </span>Introduction</a>
          →
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    
  </div>
    <p>
      ©2020, Marc Lichtman.
      
    </p>

    

    
  
</div>]]>
            </description>
            <link>https://pysdr.org/index.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-24750588</guid>
            <pubDate>Mon, 12 Oct 2020 01:19:07 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Basic Concepts in Unity for Software Engineers]]>
            </title>
            <description>
<![CDATA[
Score 263 | Comments 115 (<a href="https://news.ycombinator.com/item?id=24750263">thread link</a>) | @Eyas
<br/>
October 11, 2020 | https://blog.eyas.sh/2020/10/unity-for-engineers-pt1-basic-concepts/ | <a href="https://web.archive.org/web/*/https://blog.eyas.sh/2020/10/unity-for-engineers-pt1-basic-concepts/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><p>If you’re trying to get into game development as a Software Engineer, finding
learning materials with the right level of context can be challenging. You’ll
likely face a choice between following materials introducing you to basic C# and
OOP concepts while also describing Unity concepts, or starting with advanced
tutorials and be left to figure out the core concepts deductively.</p><p>To fill that gap, I’m writing a series called
<strong><a href="https://blog.eyas.sh/tag/unity-for-software-engineers">Unity for Software Engineers</a></strong>. This is
the first piece, and I’ll be releasing additional installments over the next few
weeks, so <a href="http://eepurl.com/gVgusL">make sure to subscribe</a> for updates. The
series is intended for folks already comfortable with programming and software
architecture, especially those who learn best as I do: starting with first
principles and working your way upwards.</p><hr><p>I started my programming journey around 17 years ago by picking up
<a href="https://www.yoyogames.com/gamemaker">Game Maker</a>. Countless hours spent coding
little games and tools led me to a bigger passion for programming. Eventually, I
was at a point where I focused mainly on Software Engineering. From my peers, I
know this is quite a common path that many of us took to find programming.</p><p>Yet the game development scene has changed significantly from those days. When I
went to pick up Unity after a long absence from game development, I was mostly
interested in understanding the basic concepts: what are the fundamental
building blocks of a game? What do I need to know about how these building
blocks are represented in memory or on disk? How is idiomatic code organized?
What patterns are preferred?</p><p>In the first article in the series, we’ll focus on those first two questions.</p><h2 id="scene">Scenes</h2><p>A <strong>Scene</strong> is the largest unit of organizing your objects in-memory. Scenes
contain the objects making up your game.</p><p>In basic use, one scene represents a <strong>single level</strong> in your game, where one
scene is loaded at any given point. In more “advanced” use, you can have two or
more active scenes at a time. Scenes can be loaded additively and unloaded <sup id="fnref-1"><a href="#fn-1">1</a></sup>.
Having multiple scenes loaded during gameplay comes especially handy when
building a massive world; keeping far-away areas on-disk rather than in-memory
will help you stay within your performance budget.</p><div><figure><p><span>
      <a href="https://blog.eyas.sh/static/8a63c592f9c8efe7c6fe5027f8075845/20a35/empty-scene.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
        <source srcset="https://blog.eyas.sh/static/8a63c592f9c8efe7c6fe5027f8075845/28a80/empty-scene.webp 400w,https://blog.eyas.sh/static/8a63c592f9c8efe7c6fe5027f8075845/8d2ea/empty-scene.webp 800w,https://blog.eyas.sh/static/8a63c592f9c8efe7c6fe5027f8075845/e1ffd/empty-scene.webp 1016w" sizes="(max-width: 1016px) 100vw, 1016px" type="image/webp">
        <source srcset="https://blog.eyas.sh/static/8a63c592f9c8efe7c6fe5027f8075845/a3397/empty-scene.png 400w,https://blog.eyas.sh/static/8a63c592f9c8efe7c6fe5027f8075845/a331c/empty-scene.png 800w,https://blog.eyas.sh/static/8a63c592f9c8efe7c6fe5027f8075845/20a35/empty-scene.png 1016w" sizes="(max-width: 1016px) 100vw, 1016px" type="image/png">
        <img src="https://blog.eyas.sh/static/8a63c592f9c8efe7c6fe5027f8075845/20a35/empty-scene.png" alt="A scene editor showing an empty scene in 3D Mode." title="A scene editor showing an empty scene in 3D Mode." loading="lazy">
      </picture>
  </a>
    </span></p><figcaption><p>Unity Scene editor opening a default empty scene in 3D mode. Empty Scenes in
Unity3D will by default include <em>Main Camera</em> and <em>Directional light</em> objects.</p></figcaption></figure><figure><p><span>
      <a href="https://blog.eyas.sh/static/3663ec5a133582da273a56e10f2811b6/02ee0/scene-with-objects.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
        <source srcset="https://blog.eyas.sh/static/3663ec5a133582da273a56e10f2811b6/28a80/scene-with-objects.webp 400w,https://blog.eyas.sh/static/3663ec5a133582da273a56e10f2811b6/8d2ea/scene-with-objects.webp 800w,https://blog.eyas.sh/static/3663ec5a133582da273a56e10f2811b6/97a89/scene-with-objects.webp 1014w" sizes="(max-width: 1014px) 100vw, 1014px" type="image/webp">
        <source srcset="https://blog.eyas.sh/static/3663ec5a133582da273a56e10f2811b6/a3397/scene-with-objects.png 400w,https://blog.eyas.sh/static/3663ec5a133582da273a56e10f2811b6/a331c/scene-with-objects.png 800w,https://blog.eyas.sh/static/3663ec5a133582da273a56e10f2811b6/02ee0/scene-with-objects.png 1014w" sizes="(max-width: 1014px) 100vw, 1014px" type="image/png">
        <img src="https://blog.eyas.sh/static/3663ec5a133582da273a56e10f2811b6/02ee0/scene-with-objects.png" alt="A scene editor showing a heavily populated scene in 3DM mode." title="A scene editor showing a heavily populated scene in 3DM mode." loading="lazy">
      </picture>
  </a>
    </span></p><figcaption><p>Unity Scene editor showing an example scene, with a few objects selected. You
can use the scene view to edit levels in your game.</p></figcaption></figure></div><p>Every <a href="#gameobject"><em>game object</em></a> in Unity needs to be <em>in</em> a scene.</p><h2 id="gameobject">Game Objects</h2><p>A <strong>Game Object</strong> (in code, <code>GameObject</code>) is one of the basic building blocks of
a game.</p><p>Game Objects can represent both <em>physical</em> things you see in the game (e.g., a
player, the ground, a tree, a terrain, lights, a weapon, a bullet, an explosion)
<em>as well as</em> <em>metaphysical</em> things (e.g., an inventory manager, a multiplayer
controller, etc.) in your game.</p><p>Every Game Object has a position and rotation. For metaphysical objects, this
doesn’t matter.</p><p>Game Objects can nest under each other. Each object’s position and rotation is
relative to its parent object. An object directly in the scene is relative to
“world space” coordinates.</p><figure><p><span>
      <a href="https://blog.eyas.sh/static/1fa53e027dc03e25490512c1ad1b4e93/d1176/nested-objects-organizational.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
        <source srcset="https://blog.eyas.sh/static/1fa53e027dc03e25490512c1ad1b4e93/28a80/nested-objects-organizational.webp 400w,https://blog.eyas.sh/static/1fa53e027dc03e25490512c1ad1b4e93/8d2ea/nested-objects-organizational.webp 800w,https://blog.eyas.sh/static/1fa53e027dc03e25490512c1ad1b4e93/43d96/nested-objects-organizational.webp 1600w,https://blog.eyas.sh/static/1fa53e027dc03e25490512c1ad1b4e93/b5638/nested-objects-organizational.webp 2045w" sizes="(max-width: 1600px) 100vw, 1600px" type="image/webp">
        <source srcset="https://blog.eyas.sh/static/1fa53e027dc03e25490512c1ad1b4e93/a3397/nested-objects-organizational.png 400w,https://blog.eyas.sh/static/1fa53e027dc03e25490512c1ad1b4e93/a331c/nested-objects-organizational.png 800w,https://blog.eyas.sh/static/1fa53e027dc03e25490512c1ad1b4e93/1a152/nested-objects-organizational.png 1600w,https://blog.eyas.sh/static/1fa53e027dc03e25490512c1ad1b4e93/d1176/nested-objects-organizational.png 2045w" sizes="(max-width: 1600px) 100vw, 1600px" type="image/png">
        <img src="https://blog.eyas.sh/static/1fa53e027dc03e25490512c1ad1b4e93/1a152/nested-objects-organizational.png" alt="Screenshot showing nested objects for organizational purposes" title="Screenshot showing nested objects for organizational purposes" loading="lazy">
      </picture>
  </a>
    </span></p><figcaption><p>A group of objects nested together in a scene under an empty “Interior_Props”
object, for organizational purposes.</p></figcaption></figure><p>You might choose to nest your objects for many reasons. For example, you might
decide it organizationally makes sense to put all your “environment” (e.g.,
individual pieces that make up a city or village) objects under an empty parent
object. This way, it can be collapsed in the scene view and easily moved
together when building your game.</p><figure><p><span>
      <a href="https://blog.eyas.sh/static/c5e377de23f2c41444e43b1dee3b86a7/171d2/nested-objects-functional.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
        <source srcset="https://blog.eyas.sh/static/c5e377de23f2c41444e43b1dee3b86a7/28a80/nested-objects-functional.webp 400w,https://blog.eyas.sh/static/c5e377de23f2c41444e43b1dee3b86a7/8d2ea/nested-objects-functional.webp 800w,https://blog.eyas.sh/static/c5e377de23f2c41444e43b1dee3b86a7/71c32/nested-objects-functional.webp 1106w" sizes="(max-width: 1106px) 100vw, 1106px" type="image/webp">
        <source srcset="https://blog.eyas.sh/static/c5e377de23f2c41444e43b1dee3b86a7/a3397/nested-objects-functional.png 400w,https://blog.eyas.sh/static/c5e377de23f2c41444e43b1dee3b86a7/a331c/nested-objects-functional.png 800w,https://blog.eyas.sh/static/c5e377de23f2c41444e43b1dee3b86a7/171d2/nested-objects-functional.png 1106w" sizes="(max-width: 1106px) 100vw, 1106px" type="image/png">
        <img src="https://blog.eyas.sh/static/c5e377de23f2c41444e43b1dee3b86a7/171d2/nested-objects-functional.png" alt="Screenshot showing nested objects for functional purposes" title="Screenshot showing nested objects for functional purposes" loading="lazy">
      </picture>
  </a>
    </span></p><figcaption><p>A group of objects nested under the player. These include the player’s weapon,
avatar, and various UI elements rendered around the player.</p></figcaption></figure><p>Game Object nesting can also have <em>functional significance</em>. For example, a
“Car” can be an object, with code that controls the car’s speed and rotation as
a whole. But individual child objects might represent the four wheels (these
would spin independently), the car body, windows, etc. Moving the parent car
object would move all the child objects, keeping their relative orientation to
the parent (and each other). We might want the player to interact with a door
separately from the rest of the car, for instance.</p><h2 id="component">Components (&amp; MonoBehaviors)</h2><figure><p><span>
      <a href="https://blog.eyas.sh/static/6c13139bed0d3e0340ef8308a17e47fd/faa4f/inspector-with-components.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
        <source srcset="https://blog.eyas.sh/static/6c13139bed0d3e0340ef8308a17e47fd/28a80/inspector-with-components.webp 400w,https://blog.eyas.sh/static/6c13139bed0d3e0340ef8308a17e47fd/8d2ea/inspector-with-components.webp 800w,https://blog.eyas.sh/static/6c13139bed0d3e0340ef8308a17e47fd/e432d/inspector-with-components.webp 878w" sizes="(max-width: 878px) 100vw, 878px" type="image/webp">
        <source srcset="https://blog.eyas.sh/static/6c13139bed0d3e0340ef8308a17e47fd/a3397/inspector-with-components.png 400w,https://blog.eyas.sh/static/6c13139bed0d3e0340ef8308a17e47fd/a331c/inspector-with-components.png 800w,https://blog.eyas.sh/static/6c13139bed0d3e0340ef8308a17e47fd/faa4f/inspector-with-components.png 878w" sizes="(max-width: 878px) 100vw, 878px" type="image/png">
        <img src="https://blog.eyas.sh/static/6c13139bed0d3e0340ef8308a17e47fd/faa4f/inspector-with-components.png" alt="Screenshot showing the inspector window on an object." title="Screenshot showing the inspector window on an object." loading="lazy">
      </picture>
  </a>
    </span></p><figcaption><p>The Warrior object from the previous screenshot is shown above in Unity’s
“Inspector” window. Each illustrated section (e.g., Animator, Rigidbody,
Collider) are <em>Components</em> making up this object.</p></figcaption></figure><p>Every Game Object is comprised of <strong>Components</strong>.</p><p>A Component implements a well-defined set of behaviors for a GameObject to
execute. Everything that makes an object what it is would come from the
components that make it up:</p><ul><li>A single “visible” piece of a car will have a <em>Renderer</em> component that
paints it, and likely a <em>Collider</em> component that sets up its collision
bounds.</li><li>If a car represents the player, the car object itself might have a <em>Player
Input Controller</em> that takes key input events and translates these to code
moving the car around.</li></ul><p>While you can write large and complex Components that correspond 1:1 to an
object (e.g., a player component codes the entire player, while an enemy
component codes the enemy as a whole), it’s typically common to factor out your
logic into streamlined pieces corresponding to individual <em>traits</em>. For example:</p><ul><li>All objects with <em>health</em>, whether a Player or an Enemy, might have a
<code>LivingObject</code> component that sets an initial health value, takes damage,
and triggers a death event once it dies.</li><li>A player might additionally have an input component controlling its
movement, while the enemy might have an AI component that controls its
movement instead.</li></ul><p>Components receive various callbacks throughout their lifetime, known in Unity
as <em>Messages</em>. Examples of Messages include <code>OnEnable</code>/<code>OnDisable</code>, <code>Start</code>,
<code>OnDestroy</code>, <code>Update</code>, and others. If an object implements an <code>Update()</code> method,
this method will automagically be called by Unity in every frame of the game
loop while the object is active, and the given component is enabled. These
methods can be marked <code>private</code>; the Unity engine will still call them.</p><p>Components can also expose public methods as you’d expect. Other components can
take a reference to a component and call these public methods.</p><h2 id="asset">Assets</h2><p><strong>Assets</strong> are the on-disk resources that make up your game project. These
include meshes (models), textures, sprites, sounds, and other resources.</p><p>When serialized to the disk, your scenes are represented as assets made up of
the Game Objects inside of them. We’ll also discuss in the next section how you
can make Game Objects that are reused often into an asset known as a
<a href="#prefab">Prefab</a>.<sup id="fnref-2"><a href="#fn-2">2</a></sup></p><figure><p><span>
      <a href="https://blog.eyas.sh/static/65a370888c3e5f061718bfab6daec6eb/3c2e3/assets-in-project-view.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
        <source srcset="https://blog.eyas.sh/static/65a370888c3e5f061718bfab6daec6eb/28a80/assets-in-project-view.webp 400w,https://blog.eyas.sh/static/65a370888c3e5f061718bfab6daec6eb/8d2ea/assets-in-project-view.webp 800w,https://blog.eyas.sh/static/65a370888c3e5f061718bfab6daec6eb/cedc5/assets-in-project-view.webp 1291w" sizes="(max-width: 1291px) 100vw, 1291px" type="image/webp">
        <source srcset="https://blog.eyas.sh/static/65a370888c3e5f061718bfab6daec6eb/a3397/assets-in-project-view.png 400w,https://blog.eyas.sh/static/65a370888c3e5f061718bfab6daec6eb/a331c/assets-in-project-view.png 800w,https://blog.eyas.sh/static/65a370888c3e5f061718bfab6daec6eb/3c2e3/assets-in-project-view.png 1291w" sizes="(max-width: 1291px) 100vw, 1291px" type="image/png">
        <img src="https://blog.eyas.sh/static/65a370888c3e5f061718bfab6daec6eb/3c2e3/assets-in-project-view.png" alt="Unity Asset view showing visual assets in a game project" title="Unity Asset view showing visual assets in a game project" loading="lazy">
      </picture>
  </a>
    </span></p></figure><p>Assets can also represent less tangible things, such as Input Control Maps,
Graphics Settings, i18n string databases, and more. You can also create your own
custom asset types
<a href="https://unity.com/how-to/architect-game-code-scriptable-objects">using ScriptableObjects</a>.
I wrote about how these are saved
<a href="https://blog.eyas.sh/2020/09/where-scriptableobjects-live/">here</a>.</p><p>For your in-development project, assets form the key representation of your
project’s codebase, alongside your code.</p><p>Your built-and-bundled game will include <em>most</em><sup id="fnref-3"><a href="#fn-3">3</a></sup> of your assets. These assets
will be saved on disk on the device where the game is installed.</p><h2 id="prefab">Prefabs</h2><figure><p><span>
      <a href="https://blog.eyas.sh/static/c795152ffc6beb8afcfe8b85fbb6886a/af8d6/container-homes.jpg" target="_blank" rel="noopener">
    <span></span>
  <picture>
        <source srcset="https://blog.eyas.sh/static/c795152ffc6beb8afcfe8b85fbb6886a/28a80/container-homes.webp 400w,https://blog.eyas.sh/static/c795152ffc6beb8afcfe8b85fbb6886a/8d2ea/container-homes.webp 800w,https://blog.eyas.sh/static/c795152ffc6beb8afcfe8b85fbb6886a/43d96/container-homes.webp 1600w,https://blog.eyas.sh/static/c795152ffc6beb8afcfe8b85fbb6886a/f3ff0/container-homes.webp 1920w" sizes="(max-width: 1600px) 100vw, 1600px" type="image/webp">
        <source srcset="https://blog.eyas.sh/static/c795152ffc6beb8afcfe8b85fbb6886a/4cda9/container-homes.jpg 400w,https://blog.eyas.sh/static/c795152ffc6beb8afcfe8b85fbb6886a/c60e9/container-homes.jpg 800w,https://blog.eyas.sh/static/c795152ffc6beb8afcfe8b85fbb6886a/56dca/container-homes.jpg 1600w,https://blog.eyas.sh/static/c795152ffc6beb8afcfe8b85fbb6886a/af8d6/container-homes.jpg 1920w" sizes="(max-width: 1600px) 100vw, 1600px" type="image/jpeg">
        <img src="https://blog.eyas.sh/static/c795152ffc6beb8afcfe8b85fbb6886a/56dca/container-homes.jpg" alt="Photo of rows of container homes" title="Photo of rows of container homes" loading="lazy">
      </picture>
  </a>
    </span></p></figure><p>Game Objects, their Components, and their input parameters exist as individual
<em>instances</em> in a scene. But what if a particular class of objects is commonly
repeated? Such objects can be made into a <strong>Prefab</strong>, which is effectively the
object in asset form.</p><p>Instances of a prefab in a scene can have local modifications that distinguish
it (e.g., if a <em>tree</em> object is a prefab, you can have tree instances of
different heights). Instances of a prefab all inherit and override data from
their prefab.</p><h3>Nested Prefabs</h3><p>Starting with Unity 2018.3, Prefabs can be nested just as you expect:</p><ol><li>A parent object with prefab child objects can be a prefab itself. In the
parent prefab, the child prefab instance can have its own modifications. In
the scene, the entire prefab hierarchy is instantiated, and scene-specific
modifications can layer on top.</li><li>A prefab instance in a scene with its own local modifications can be saved as
its own “Prefab Variant” asset. A variant is a prefab asset that inherits
from another prefab, applying additional modifications on top.</li></ol><p>These concepts compose; a prefab variant of a nested prefab, or a prefab variant
of a prefab variant, for instance.</p><h2 id="serialization">Serialization &amp; Deserialization</h2><p>Your project’s assets, scenes, and objects are all persisted on-disk. When
editing your game, these objects are loaded in memory and saved back to disk
using
<a href="https://blogs.unity3d.com/2014/06/24/serialization-in-unity/">Unity’s serialization system</a>.
When playtesting your game, the objects and scenes in-memory are loaded through
the same serialization system. This system also maps between assets in your
compiled bundle and the loaded/unloaded scene objects in-memory.</p><p>The Unity Engine’s Serialization/Deserialization flow loads on-disk assets into
memory (in your project: for editing/playtesting; in-game, when loading a scene)
and is responsible for saving the state of your edited objects &amp; components back
into their scenes and prefabs.</p><p>Therefore, the serialization system is also at the core of the Unity Editor
experience itself. For a <code>MonoBehavior</code> to take an input on construction when
instantiated in a scene, those fields must be <em>serialized</em>.</p><p>Most core Unity types such as <code>GameObject</code>s, <code>MonoBehavior</code>s, and asset
resources are
<a href="https://docs.microsoft.com/en-us/dotnet/api/system.serializableattribute">Serializable</a>
and can receive initial values on creation from within the Unity Editor. Public
fields on your <code>MonoBehavior</code> are serialized by default (if they’re of a
serializable type), and private fields need to be marked with Unity’s
<a href="https://docs.unity3d.com/ScriptReference/SerializeField.html"><code>[SerializeField]</code></a>
attribute to be serialized as well.</p><figure><p><span>
      <a href="https://blog.eyas.sh/static/d0cfe39b333b7b70ede27e286ad3be48/7d442/chaos-reborn-screenshot.png" target="_blank" rel="noopener">
    <span></span>
  <picture>
   …</picture></a></span></p></figure></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://blog.eyas.sh/2020/10/unity-for-engineers-pt1-basic-concepts/">https://blog.eyas.sh/2020/10/unity-for-engineers-pt1-basic-concepts/</a></em></p>]]>
            </description>
            <link>https://blog.eyas.sh/2020/10/unity-for-engineers-pt1-basic-concepts/</link>
            <guid isPermaLink="false">hacker-news-small-sites-24750263</guid>
            <pubDate>Mon, 12 Oct 2020 00:14:45 GMT</pubDate>
        </item>
    </channel>
</rss>
