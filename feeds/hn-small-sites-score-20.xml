<rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>
<![CDATA[Hacker News - Small Sites - Score >= 20]]>
        </title>
        <description>
<![CDATA[Hacker News stories from domains that aren't in the top 1M and that have a score of at least 20. Updated nightly via https://github.com/awendland/hacker-news-small-sites]]>
        </description>
        <link>https://news.ycombinator.com</link>
        <generator>RSS for Node</generator>
        <lastBuildDate>Wed, 01 Jul 2020 12:20:02 GMT</lastBuildDate>
        <atom:link href="https://raw.githubusercontent.com/awendland/hacker-news-small-sites/generated/feeds/hn-small-sites-score-20.xml" rel="self" type="application/rss+xml"></atom:link>
        <pubDate>Wed, 01 Jul 2020 12:20:02 GMT</pubDate>
        <language>
<![CDATA[en-US]]>
        </language>
        <managingEditor>
<![CDATA[me@alexwendland.com (Alex Wendland)]]>
        </managingEditor>
        <ttl>240</ttl>
        <item>
            <title>
<![CDATA[Use Unix Pipes to Improve Chromecast Playback]]>
            </title>
            <description>
<![CDATA[
Score 84 | Comments 15 (<a href="https://news.ycombinator.com/item?id=23673825">thread link</a>) | @lowmemcpu
<br/>
June 28, 2020 | https://alexdelorenzo.dev/linux/2020/03/14/pipes | <a href="https://web.archive.org/web/*/https://alexdelorenzo.dev/linux/2020/03/14/pipes">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div itemprop="articleBody">  <p>When casting from YouTube to a Chromecast, sometimes the audio playback will <a href="https://support.google.com/chromecast/thread/13807879?hl=en">skip</a> and <a href="https://support.google.com/youtube/thread/17251626?hl=en">stutter</a>. This issue is independent of the quality of the video, the FPS, or the internet connection. Trying to watch certain videos will reliably cause playback issues on the Chromecast.</p> <p>According to <a href="https://support.google.com/chromecast/thread/13807879">this thread</a>, the playback issue only appeared in the latest and final firmware update for the Chromecast. Successful playback of the videos was possible in the past, and casting the downloaded YouTube videos eliminates the problem entirely. The problem exists solely when casting certain videos using the YouTube app.</p>  <p>Given that the problem only occurs with the YouTube app, you can download a video and cast it via <a href="https://github.com/xat/castnow"><code>castnow</code></a> or <a href="https://github.com/skorokithakis/catt"><code>catt</code></a>, skipping the YouTube app entirely.</p> <p>You could do something like:</p> <div><div><pre><code><span>#!/usr/bin/env bash</span>

<span>export </span><span>url</span><span>=</span><span>"https://youtu.be/Kas0tIxDvrg"</span>

<span>function </span>cast<span>()</span> <span>{</span>
    <span>url</span><span>=</span><span>"</span><span>$1</span><span>"</span>
    
    <span>filename</span><span>=</span><span>$(</span>youtube-dl <span>--get-filename</span> <span>"</span><span>$url</span><span>"</span><span>)</span>
    youtube-dl <span>"</span><span>$url</span><span>"</span>
    
    <span># wait a bit to download the file</span>
    castnow <span>"</span><span>$filename</span><span>"</span>
    <span>rm</span> <span>"</span><span>$filename</span><span>"</span>
<span>}</span>

cast <span>"</span><span>$url</span><span>"</span>
</code></pre></div></div> <p>But having to skip using the YouTube app to cast is already a clunky solution, and downloading every video before playing them is an even worse user experience. Instant playback and ephemeral streams are what make for a pleasant video streaming experience in 2020, and this solution implements neither of them</p>  <p><a href="https://github.com/ytdl-org/youtube-dl/blob/master/README.md">Since <code>youtube-dl</code> allows us to output to <code>stdout</code></a>, if we can hook its <code>stdout</code> to a casting app, we could emulate the instant playback and ephemeral videos we expect because we don’t have to wait for an entire file to download.</p> <p>Unfortunately, <code>castnow</code> and <code>catt</code> won’t cast from <code>stdin</code>. You’re expected to pass it file locations to cast from.</p> <p>This is where one of my favorite shell features really shines: <a href="https://tldp.org/LDP/abs/html/process-sub.html">process substitution</a>.</p> <p>With process substitution, Bash gives us a convenient way to make ephemeral <a href="https://en.wikipedia.org/wiki/Anonymous_pipe">anonymous pipes</a>. This method is both efficient and concurrent, making this primitive an apt choice to build a solution to the problem at hand. A process reading the <a href="https://en.wikipedia.org/wiki/Pipeline_(Unix)">pipe</a> blocks until the pipe is opened by another process for writing. A process writing to the pipe will suspend until the pipe’s buffer is read by another process. The anonymous pipe will automatically remove itself, and when it is manually removed, its dependent processes will be terminated.</p> <p>When using process substitution, a process’ <code>stdout</code> is hooked up to an anonymous pipe. That pipe can be accessed from a file descriptor, and the location of the pipe is given to the calling process.</p> <div><div><pre><code><span>$ </span><span>echo</span> &lt;<span>(</span><span>echo</span> <span>"Content sent to pipe"</span><span>)</span>
/dev/fd/63

<span>$ </span><span>cat</span> &lt;<span>(</span><span>echo</span> <span>"Content sent to pipe"</span><span>)</span>
Content sent to pipe
</code></pre></div></div> <p>In the example above, the <code>&lt;(command)</code> syntax is how we invoke process substitution in Bash. The output of <code>command</code> is written to an anonymous pipe, and the calling process is given the location of the file descriptor to access that pipe.</p> <p>Using that example, we can take advantage of process substitution:</p> <div><div><pre><code>vlc &lt;<span>(</span>youtube-dl <span>-q</span> <span>-o</span> - <span>"</span><span>$url</span><span>"</span><span>)</span>
</code></pre></div></div> <p>The command above will play the YouTube video locally with <a href="https://www.videolan.org/vlc/index.html">VLC</a>, and illustrates that process substitution can work for our use case.</p> <p>However, when we try to use <code>castnow</code>, we can’t cast from the pipe:</p> <div><div><pre><code><span>$ </span>castnow &lt;<span>(</span>youtube-dl <span>-q</span> <span>-o</span> - <span>"</span><span>$url</span><span>"</span><span>)</span>
Error: Load failed
</code></pre></div></div> <p>Nor can we cast with <code>catt</code>:</p> <div><div><pre><code><span>$ </span>catt cast &lt;<span>(</span>youtube-dl <span>-q</span> <span>-o</span> - <span>"</span><span>$url</span><span>"</span><span>)</span>
Error: The chosen file does not exist.
</code></pre></div></div> <p>We know we can use VLC locally, and VLC also lets you cast to a Chromecast using its IP address.</p> <p>Let’s try that again using VLC:</p> <div><div><pre><code><span>function </span>cast_vlc<span>()</span> <span>{</span>
    <span>path</span><span>=</span><span>"</span><span>$1</span><span>"</span>

    <span># get the ip address for chromecast.lan host</span>
    <span>ip</span><span>=</span><span>$(</span>dig +short chromecast.lan | <span>tail</span> <span>-n</span> 1<span>)</span>

    vlc <span>-I</span> ncurses <span>\</span>
      <span>--sout</span> <span>'#chromecast'</span> <span>\</span>
      <span>--sout-chromecast-ip</span><span>=</span><span>"</span><span>$ip</span><span>"</span> <span>\</span>
      <span>--demux-filter</span><span>=</span>demux_chromecast <span>\</span>
      <span>"</span><span>$path</span><span>"</span> &lt; /dev/tty
<span>}</span>

cast_vlc &lt;<span>(</span>youtube-dl <span>-q</span> <span>-o</span> - <span>"</span><span>$url</span><span>"</span><span>)</span>
</code></pre></div></div> <p>That works.</p> <p>As an aside, we hook VLC’s <code>stdin</code> to <code>/dev/tty</code> so that we can use the ncurses interface even if we invoke the function from a script.</p> <p>Let’s look at the <a href="https://wiki.videolan.org/Documentation:Modules/ncurses/">ncurses interface</a>.</p> <div> <p><img src="https://d33wubrfki0l68.cloudfront.net/d0822203c304db88f3cbec618e94a3d9f55cd269/c5939/assets/imgs/converted/vlc-fs8.webp" loading="lazy"> </p> </div> <p>It only displays the file descriptor, and very little about the video itself. I’m not a fan of that.</p>  <p>Instead of using anonymous pipes, we can use <a href="https://en.wikipedia.org/wiki/Named_pipe">named pipes</a>. Named pipes are like anonymous pipes, except they are not anonymous (they have a name) nor are they ephemeral. Named pipes still give us the efficiency and concurrency benefits that anonymous pipes give us, but Bash lacks the syntactic sugar it has for process substitution when it comes to named pipes.</p> <p>This is how we create named pipes, write to them, read from them and remove them.</p> <div><div><pre><code><span>$ </span><span>mkfifo </span>ourpipe
<span>$ </span><span>echo</span> <span>"Content in pipe"</span> <span>&gt;</span> ourpipe &amp;
<span>$ </span><span>cat </span>ourpipe
Content <span>in </span>pipe
<span>$ </span><span>rm </span>ourpipe
</code></pre></div></div> <p>Not as pretty as <code>&lt;(command)</code>, but it gets the job done.</p> <p>We can give a named pipe the same name as our YouTube video, and that way, the VLC interface will show the name of what we’re watching.</p> <div><div><pre><code><span>function </span>cast_ytdl<span>()</span> <span>{</span>
  <span>url</span><span>=</span><span>"</span><span>$1</span><span>"</span>

  <span># create a temporary named pipe</span>
  <span># why? because vlc will show the file descriptor path if we just use process substitution</span>
  <span>filename</span><span>=</span><span>$(</span>youtube-dl <span>--get-filename</span> <span>"</span><span>$url</span><span>"</span><span>)</span>
  <span>path</span><span>=</span><span>"/tmp/</span><span>$filename</span><span>"</span>
  <span>mkfifo</span> <span>"</span><span>$path</span><span>"</span>

  <span># download in background, push to named pipe</span>
  youtube-dl <span>-q</span> <span>-o</span> - <span>"</span><span>$url</span><span>"</span> <span>&gt;</span> <span>"</span><span>$path</span><span>"</span> &amp;
  <span>pid</span><span>=</span><span>"</span><span>$!</span><span>"</span>
  <span>disown</span> <span>$pid</span>

  <span># cast from named pipe</span>
  cast_vlc <span>"</span><span>$path</span><span>"</span>

  <span># cleanup process and named pipe</span>
  <span>kill</span> <span>-9</span> <span>"</span><span>$pid</span><span>"</span> &amp;&gt; /dev/null
<span>}</span>

cast_ytdl <span>"</span><span>$url</span><span>"</span>
</code></pre></div></div> <p>This works, too.</p> <p>We need to manually create a named pipe with <a href="https://linux.die.net/man/1/mkfifo"><code>mkfifo</code></a>, redirect <code>youtube-dl</code>’s <code>stdout</code> to the named pipe while running the process in the background, and then cleanup the process after casting from it via VLC, otherwise it might linger in the background. Each of those tasks would have been handled for us automatically using process substitution.</p> <p>But it does look a bit better:</p> <div> <p><img src="https://d33wubrfki0l68.cloudfront.net/25d68fb2085191adb26bb931e9bb31c638e5a634/f664c/assets/imgs/converted/vlc3-fs8.webp" loading="lazy"> </p> </div>  <p>Pipes, anonymous pipes and named pipes are also known by another name because of the way they behave: <a href="https://en.wikipedia.org/wiki/FIFO_(computing_and_electronics)#Pipes">FIFOs</a>, or <strong>f</strong>irst <strong>i</strong>n, <strong>f</strong>irst <strong>o</strong>ut. What’s written to the pipe is read from the pipe in first in, first out order. This behavior maps well to video streaming.</p> <p>While you can interact with anonymous and named pipes like you would a file, the interface isn’t 1:1 with a <a href="https://en.wikipedia.org/wiki/Unix_file_types#Regular_file">standard file</a>. You cannot <code>seek()</code> forward or backward in pipe, you can just read the next forward values. For our use case, that means we cannot skip forward or backward in our streaming videos. We can only play, pause or stop the video.</p> <p>That’s not a problem for me, however it’s something that can be mitigated if it’s a problem for you. The first solution I can think of would be to write to a temporary file via <code>youtube-dl</code> and read from it. Or <a href="https://alexdelorenzo.dev/programming/2019/04/14/buffer">perhaps a temporary spooled file can act as a buffer for the pipe</a>, such that you can <code>seek()</code> through the buffer, but the buffer itself is ephemeral unlike a normal file.</p> </div></div>]]>
            </description>
            <link>https://alexdelorenzo.dev/linux/2020/03/14/pipes</link>
            <guid isPermaLink="false">hacker-news-small-sites-23673825</guid>
            <pubDate>Mon, 29 Jun 2020 02:27:39 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Yelp: Local Economic Impact Report]]>
            </title>
            <description>
<![CDATA[
Score 41 | Comments 21 (<a href="https://news.ycombinator.com/item?id=23673286">thread link</a>) | @yasp
<br/>
June 28, 2020 | https://www.yelpeconomicaverage.com/yelp-coronavirus-economic-impact-report.html | <a href="https://web.archive.org/web/*/https://www.yelpeconomicaverage.com/yelp-coronavirus-economic-impact-report.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
    
      
    
    
    <section>
        <p>Local economies around the U.S. have continued to change quickly and dramatically – states and cities are slowly reopening, unemployment rates are starting to decline from the recent all-time high, COVID-19 cases are increasing in some states while decreasing in others, and communities are responding to the social unrest and George Floyd protests with city-wide curfews having impacted many businesses that were just able to reopen.</p>
        <p>Yelp last reported on the state of the local economy in <a target="_blank" href="https://www.yelpeconomicaverage.com/yea-q1-2020.html">our quarterly Yelp Economic Average report on April 28</a>, showing how much consumer activity in major swathes of Main Street had dropped off in just a couple of weeks in March. Now as states start to reopen and the nation responds to anti-Black racism and police brutality, a new set of challenges lay ahead for local economies.</p>
    </section>
    
    <section>
      <h2>Some Businesses Slowly Reopen, While Many Permanently Close</h2>
        <p>As of June 15, there were nearly 140,000 total business closures on Yelp since March 1. In April we reported more than 175,000 business closures, indicating that more than 20% of businesses closed in April have reopened. Las Vegas, NV, endured the highest number of closures relative to the number of businesses in the city (1,921 total closures), while Los Angeles, CA, had the largest total number of closures (11,774 total closures).</p>
    </section>
    
    <section>
    	<h3>Some Businesses are Slowly Reopening, Many Remain Closed</h3>
      <h4>Number of businesses marked closed on Yelp that were open March 1</h4>
    
    	<p><img src="https://www.yelpeconomicaverage.com/assets/img/coronavirus/Closures_Desktop.png">
    		<img src="https://www.yelpeconomicaverage.com/assets/img/coronavirus/Closures_Desktop.png">
    		<img src="https://www.yelpeconomicaverage.com/assets/img/coronavirus/Closures_Mobile.png">
    	</p>
    </section>
    
    <section>
        <p>Of all business closures on Yelp since March 1, 41% are permanent closures. Our data shows the largest spikes of permanent closures occurred in March, followed by May and June, indicating that the businesses that were already struggling had to permanently close right away and the businesses that were trying to hold on, but unable to weather the COVID-19 storm, were forced to shutter in recent months.</p>
    </section>
    
    <section>
      <h2>Retail and Restaurant Businesses Continue Innovating Amid High Closure Rates</h2>
        <p>While many business sectors have struggled during COVID-19 there are a few industries that have endured especially high closure rates. Among those with the highest rate of business closures are shopping and retail (27,663 closed businesses), restaurants (23,981 closed businesses), beauty (15,348 closed businesses) and fitness (5,589 closed businesses).</p>
        <p>Retail was by far the hardest hit, experiencing the highest number of total closures, with the average daily rate continuing to increase since March. Of all closures on Yelp since March 1, 20% are for retail businesses and 35% of closed retail businesses are indicated as permanent on Yelp.</p>
        <p>In March, Restaurants had the highest number of business closures, compared to other industries, and have continued to close at high rates. Of the businesses that closed, 17% are restaurants, and 53% of those restaurant closures are indicated as permanent on Yelp. Restaurants run on thin margins and can sometimes take months or even years to break even, resulting in this higher rate of permanent closures.</p>
    </section>
    
    <section>
    	<h3>Restaurants and Retail have been Hit Hardest</h3>
    	<h4>Number of businesses marked temporarily or permanently closed on Yelp that were open on March 1</h4>
    
    	<p><img src="https://www.yelpeconomicaverage.com/assets/img/coronavirus/Category_Closures_Desktop.png">
    		<img src="https://www.yelpeconomicaverage.com/assets/img/coronavirus/Category_Closures_Desktop.png">
    		<img src="https://www.yelpeconomicaverage.com/assets/img/coronavirus/Category_Closures_Mobile.png">
    	</p>
    </section>
    
    <section>
        <p>Though some businesses have shut down permanently, many have found <a target="_blank" href="https://blog.yelp.com/2020/04/businesses-creatively-adapt-coronavirus-response?utm_source=biz_blog&amp;utm_medium=yelp_blog&amp;utm_content=blog_text_link">innovative ways</a> to weather the storm and continue serving consumers. Many restaurants pivoted to offering takeout and delivery, while some experimented with take home meal and drink kits, and even virtual cooking classes. Some are finding new ways to use existing technology, like <a target="_blank" href="https://blog.yelp.com/2020/04/use-waitlist-online-takeout-restaurants?utm_source=biz_blog&amp;utm_medium=yelp_blog&amp;utm_content=blog_text_link">Yelp Waitlist to manage curbside pickup</a>. Servicing food to-go produces high margins for restaurants, and we’ve seen a 10X increase in searches for takeout since March 10.</p>
        <p>With many retail businesses shifting to curbside pickup, we’ve seen consumer interest spike in obtaining their goods in this way with a 20% increase in searches for curbside pickup. In the beauty industry we’ve seen hair stylists offering video hair cutting tutorials, estheticians offering virtual consultations, and small shops shifting their focus to ecommerce. Fitness in particular has seen a significant shift in their business model with gyms and studios offering virtual classes and personal trainers offering one-on-one virtual training sessions. If nothing else, local businesses owners have proven themselves to be resilient and creative during these trying times.</p>
    </section>
    
    <section>
      <h2>The Desire to Support Black-Owned Businesses Continues to Grow</h2>
        <p>As acknowledgement of anti-Black racism and police brutality become more wide-spread across the nation people are continuing to look for ways to support the Black community. Since May 25, we’ve seen a 1785% relative increase in searches for Black-owned businesses, compared to the three weeks prior. Review mentions of “Black-owned” (and related terms) also skyrocketed, up 426%, as people look to support and surface these businesses to the community.</p>
        <p>D.C. had the highest number of Black-owned searches, accounting for nearly 1% of all searches on Yelp, followed by Minnesota, Maryland, Michigan and Georgia. In fact, every state has shown an increase in searches for Black-owned businesses. Looking at metros, Ann Arbor, MI has the highest increase in searches for Black-owned, up 105X (accounting for 3% of all searches), followed by Denver (up 27X), Minneapolis (up 23X) and Baltimore (up 19X).</p>
    </section>
    
    <section>
    	<h3>Interest Increased in Supporting Black-Owned Businesses</h3>
    	<h4>Percent of Yelp searches for Black-owned businesses by state</h4>
    
    	<p><img src="https://www.yelpeconomicaverage.com/assets/img/coronavirus/Searches_Desktop.png">
    		<img src="https://www.yelpeconomicaverage.com/assets/img/coronavirus/Searches_Desktop.png">
    		<img src="https://www.yelpeconomicaverage.com/assets/img/coronavirus/Searches_Mobile.png">
    	</p>
    </section>
    
    <section>
        <p>While searches for Black-owned businesses have increased across all categories, there has been a particular increase in review content for Black-owned restaurants and food businesses (up 9X), beauty businesses (up 3X), nightlife (up 13X) and shopping (up 3X).</p>
    </section>
    
    <section>
      <h2>The Recovering Economy May Look Different Than the Old Economy</h2>
        <p>While some normal activity is starting to bounce back, due to the many changes impacting local economies — state rules, consumer behavior, and social unrest — many of the consumer interest shifts we saw in March and April started to rebound in May, with dramatic shifts in June.</p>
        <p>Outdoor activities that became popular at the height of the pandemic as people were finding ways to stay active while social distancing – such as mountain biking (down 40%), lakes (down 34%), golf (down 33%) and hiking (down 28%) – have dropped in consumer interest since May 1 relative to other active activities. People are starting to feel more comfortable participating in indoor activities, with increased consumer interest for escape games (up 182%), Go Karts (up 147%), axe throwing (up 113%), gyms (up 81%), bowling (up 63%) and yoga (42%). That said, in some instances people are still finding ways to stay outdoors while social distancing with an increased interest in mini golf (up 132%), amusement parks (up 28%) and horseback riding (up 21%).</p>
        <p>The previous spike in community supported agriculture and grocery has started to dip (down 54% and 26%, respectively) as people start heading back into restaurants. In fact, Yelp’s diners seated data shows significantly more people are dining-in at restaurants. During the peak of the pandemic, the number of diners seated across Yelp Reservations and Waitlist dropped essentially to zero. In early June, we've seen diners seated come back substantially – now down 57% compared to pre-pandemic levels. Restaurants that cater to group dining are among those making a comeback – fondue (up 123%), tapas bars (up 98%), hot pot (up 49%) and surprisingly, even buffets (up 17%) – as foods that gained increased interest through takeout and delivery have started to fall – pizza (down 28%), chinese (down 26%), fast food (down 18%). That said, takeout and delivery has continued to sustain interest on Yelp, still up 148% based on consumer interest relative to pre-pandemic levels, indicating this could be a trend that’s here to stay.</p>
        <p>People are also headed back into malls with outlet stores, shopping centers and thrift stores all up (up 84%, 81%, 72%, respectively), as well as hosting or attending formal events with increased interest in bridal (up 70%) and formal wear (up 102%). The previous increase in cannabis dispensaries, head shops and tobacco shops has declined (down 40%, 35% and 32%, respectively). There have also been significant shifts in consumer interest for health and wellness businesses with an increased interest in saunas (up 75%), reflexology (up 69%) and dentists (up 28%), while skilled nursing (down 46%) and hospitals (down 37%) decline.</p>
    </section>
    
    <section>
      
    </section>
    
    <section>
      <h3>How Business Categories are Faring</h3>
      <h4>Change in share of relative consumer interest on Yelp for select business types</h4>
    	
      <!--<p class='q12020-footer'>Read about the methodology <a href='./yea-q1-2020.html#methodology' class=underline>here</a></p>-->
    </section>
    
    <section>
        <p>As economies reopen, warm summer months arrive and consumers start spending more time out of their homes, we expect these shifts to continue changing at a dramatic rate. We'll continue to measure and report on these changes in local economies in our upcoming Q2 Yelp Economic Average.</p>
        <p>—Daniel Gole and Amy Shapiro contributed to this report</p>
    </section>
    
    <section>
        <p><em>If you'd like additional detail on how the economy is shifting, please contact us at <a href="https://www.yelpeconomicaverage.com/cdn-cgi/l/email-protection#542426312727142d3138247a373b39"><span data-cfemail="b4c4c6d1c7c7f4cdd1d8c49ad7dbd9">[email&nbsp;protected]</span></a> or <a href="http://eepurl.com/cMFvGL" target="_blank">join our mailing list</a> to receive an email when new reports are released.</em></p>
        <p><em>Interested in learning how Yelp data can assist you in developing market insights for your business? Yelp Knowledge can help, learn more <a href="https://www.yelp.com/knowledge" target="_blank">here</a>.</em></p>
        <p><em>Want to work with Yelp data yourself? We make a sample of our data available for academic use, and we’ve just added a <a href="https://engineeringblog.yelp.com/2020/06/how-businesses-have-reacted-to-covid-19-using-yelp-features.html" target="_blank">new batch of data</a> that reflects how businesses have reacted to the pandemic. Read more …</em></p></section></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://www.yelpeconomicaverage.com/yelp-coronavirus-economic-impact-report.html">https://www.yelpeconomicaverage.com/yelp-coronavirus-economic-impact-report.html</a></em></p>]]>
            </description>
            <link>https://www.yelpeconomicaverage.com/yelp-coronavirus-economic-impact-report.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-23673286</guid>
            <pubDate>Mon, 29 Jun 2020 00:46:51 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Finishing a side project]]>
            </title>
            <description>
<![CDATA[
Score 298 | Comments 118 (<a href="https://news.ycombinator.com/item?id=23672686">thread link</a>) | @hugozap
<br/>
June 28, 2020 | https://hugozap.com/posts/how-to-finish-your-side-project/ | <a href="https://web.archive.org/web/*/https://hugozap.com/posts/how-to-finish-your-side-project/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
      

      

<p><img src="https://hugozap.com/img/hands.jpg" alt="Illustration by Angélica Delvalle IG: ylikdelvalle"></p>
<p>It's no secret that finishing a side project is hard.</p>
<p>I've struggled with some side projects and had success with others. In this post, I'll focus on the actions and adjustments that have worked for me.</p>
<p>It's possible to work on and finish side projects even with a busy schedule, the key is to optimize for interruptability. You will be interrupted so instead of counting on having hours of deep work available, it's better to be realistic and make some adjustments to use available time in a better way and reducing the cost of interruptions by having tricks to switch context fast.</p>
<h2 id="a-failed-side-project-story">A failed side project story <a href="#a-failed-side-project-story">#</a></h2>
<p>Maybe you are familiar with a similar situation</p>
<p>At the beginning:</p>
<ul>
<li>High motivation.</li>
<li>Priority over other tasks.</li>
<li>Working long hours because it's fun.</li>
<li>Desire to work with a new technology</li>
<li>No problem working on weekends.</li>
</ul>
<p>After some time:</p>
<ul>
<li>Motivation decreases.</li>
<li>Feels overwheelming.</li>
<li>Harder to justify working on the project when there are other responsibilities.</li>
<li>Other stuff seems more interesting now.</li>
<li>Forgot how to set things up to continue working on the project.</li>
<li>Not sure what I was working on.</li>
<li>Forgetting about the project and archiving it.</li>
</ul>
<h2 id="the-challenges-with-side-projects">The challenges with side projects <a href="#the-challenges-with-side-projects">#</a></h2>
<ul>
<li>Context switching and high cognitive load is exhausting.</li>
<li><strong>Losing interest/ motivation</strong>.</li>
<li>Perfectionism - never ending projects.</li>
<li>Impostor syndrome.</li>
<li>Lack of focus.</li>
<li>Lack of time.</li>
<li>Unexpected life events.</li>
</ul>
<h2 id="re-framing-the-goal">Re framing the goal <a href="#re-framing-the-goal">#</a></h2>
<p>I believe you can set yourself for failure from the start if the goal is not clear.</p>
<p>I've been excited about ideas but later found that I was not really invested in the idea and just wanted to explore a cool feature/tool. It's good to go deeper to your true motivation.</p>
<p>Feeling overwhelmed can also contribute to abandoning the project, I'll talk about <strong>small steps</strong> and why it's key.</p>
<p>If your track record includes lots of ambitious projects and none of them finished, then starting with something smaller seems like the logical approach.</p>
<p>Pick a small battle, maybe just the key feature first, maybe support for just one platform. Cut off features for the first version, remember that there's a lot of forces against you completing your project so reducing load is important.</p>
<h2 id="the-approach">The approach <a href="#the-approach">#</a></h2>
<p>Now that you have a clear idea of what you want to finish, there's some actions and adjustments to your process that will increase the chance of winning the battle (shipping).</p>
<ul>
<li>Preparing your environment (painless context switch)</li>
<li>Work in <strong>Small steps</strong></li>
<li>Mental warm-up before each session.</li>
<li>Anticipate and expect interruptions.</li>
<li>Changing your physical location.</li>
<li>Writting down the ideas on your mind at the end of the session.</li>
</ul>
<h2 id="small-steps-are-key">Small steps are key <a href="#small-steps-are-key">#</a></h2>
<p>I like the idea of not having too many open boxes at the same time, where each box is a task/feature or something that you  started but haven't finished yet.</p>
<p>It's demoralizing to wait weeks or months for a win. Small steps give you small wins, it keeps the journey fun. There's less change of feeling stuck.</p>
<p><a href="https://www.geepawhill.org/2020/06/26/more-on-small-steps/">Geepaw Hill</a> shares excellent resources on the topic of small steps in software.</p>
<h2 id="warming-up-before-each-session-to-reduce-cognitive-exhaustion">Warming up before each session to reduce cognitive exhaustion <a href="#warming-up-before-each-session-to-reduce-cognitive-exhaustion">#</a></h2>
<p>Before starting actual work, write about what would be good to achieve in the session. I find this ritual valuable as it helps me figure out the next small step. Writing the project goal (high level) every session is also a good way to switch context and reminding yourself what's it all about.</p>
<p>I'll talk about having a "context" log, where you write the current progress, and what to do next. If you have this file, reading the previous session log let's you resume your work faster.</p>
<h2 id="immediate-context-switching">Immediate context switching <a href="#immediate-context-switching">#</a></h2>
<p>With the limited amount of mental energy, is crucial to reduce the number of setup tasks required to do a working session on your project. The goal here is reducing the number of small decisions you have to make to have a working environment.</p>
<p>This is one of the most important things for me, and the way I approach it is:</p>
<ul>
<li>Creating a separated system User on my laptop.</li>
<li>Having an email address only for my project.</li>
<li>Having a "context" file where I log what's currently happening with my project, usually at the end of a work session.</li>
</ul>
<p>These have been valuable tools for me, let me explain why:</p>
<h3 id="a-separate-system-user-for-your-side-project">A separate system user for your side project <a href="#a-separate-system-user-for-your-side-project">#</a></h3>
<p>By creating a separate user, you automatically have all the operative system tools (calendar/notes/reminders , etc.) available ONLY for your project.</p>
<p>All the files on your desktop will have a relation to your project. This may not seem impressive but think about all the small distractions you find if you use the same user for your personal/work tasks:</p>
<ul>
<li>Time to find a file (filtering unrelated stuff will bring memories of other things)</li>
<li>Reminders/calendar notifications not related to your project</li>
<li>Dealing with other project setups can be stressful.</li>
</ul>
<p>I think it was Seth Godin who recommended having a separate laptop for a side project like writing a book. This is an alternative too.</p>
<p>You can add more extreme measures like redirecting distracting sites like news or reddit. If you need to login to one of those sites, it's better to switch user accounts. Try to keep your project user clean.</p>
<h3 id="having-an-separate-email-for-your-project">Having an separate email for your project <a href="#having-an-separate-email-for-your-project">#</a></h3>
<p><a href="https://hugozap.com/posts/ultimate-info-capturing-tool/">I'm a fan of email</a> as a note taking tool, it's available everywhere, the UI is simple. Having a separate email account lets you capture related notes/ideas/links from any device. This has been useful for me when I'm doing something else and have an idea, or find a resource that can be used to do something I want to incorporate into the project.</p>
<p>Later, when I log in to my project environment I'll get the emails with relevant information, no chance of getting distracted with other stuff.</p>
<h3 id="the-context-file%2C-(brain-dump).">The context file, (brain dump). <a href="#the-context-file%2C-(brain-dump).">#</a></h3>
<p>A context file is just a text file where you add a short summary of the current project status and what's on your mind at the time.</p>
<p>This has been valuable to me, because the act of writing it down helps me have a clear idea of things I could do next and next time I have time to work on my project I'll have a starting point and it reduces the cognitive load which maximizes the session efficiency.</p>
<h2 id="location">Location <a href="#location">#</a></h2>
<p>Going to a library or café (when possible) or event to another room and have a dedicated space for your current side project will make a difference.</p>
<p>Not sure about why, but using the same desk for different work and side projects is not ideal for me. If you can I recommend having a different place that helps you switch context quickly.</p>
<h2 id="abandoned-projects-may-not-be-a-failure-after-all.">Abandoned projects may not be a failure after all. <a href="#abandoned-projects-may-not-be-a-failure-after-all.">#</a></h2>
<p>Some abandoned projects end up being an inspiration to create something else years later. Maybe you learned something new, explored an idea, or found a problem not possible to solve with the knowledge and resources you had at the time.</p>
<p>It's good to have an open mind and be ok with finding dead-ends, they are powerful teachers.</p>
<p>However, shipping projects <strong>is awesome</strong> and by reducing scope and anticipating interruptions you will be able to complete your project and release it to the world.</p>
<h2 id="resources">Resources <a href="#resources">#</a></h2>
<p>For more information about the benefits of a "small step" approach to software development check the excellent resources from <a href="https://www.geepawhill.org/2020/06/26/more-on-small-steps/">Geepaw Hill</a></p>
<h2 id="credits">Credits <a href="#credits">#</a></h2>
<p>Illustration by <a href="https://www.instagram.com/ylikdelvalle/">Angelica Delvalle</a> (In case you need art for your company products contact her, she does awesome stuff!)</p>


<p><a href="https://hugozap.com/">← Home</a></p>

    </div></div>]]>
            </description>
            <link>https://hugozap.com/posts/how-to-finish-your-side-project/</link>
            <guid isPermaLink="false">hacker-news-small-sites-23672686</guid>
            <pubDate>Sun, 28 Jun 2020 22:48:37 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Life is 90% of my use cases for org-mode]]>
            </title>
            <description>
<![CDATA[
Score 243 | Comments 155 (<a href="https://news.ycombinator.com/item?id=23672473">thread link</a>) | @billwear
<br/>
June 28, 2020 | http://stormrider.io/ninety-pct.html | <a href="https://web.archive.org/web/*/http://stormrider.io/ninety-pct.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page">
    <h2>
      life is 90% of my use cases for org-mode
      <br>
      <small>
	<em>so what's the other 10%?</em><br>
      </small>
    </h2>
    <hr>
    <a href="http://stormrider.io/index.html">blog index</a><br>
    <hr>
    <p>
      To really explain why I use org-mode for <bold>everything</bold>, I probably first have to explain my rules, which also requires a backstory.  I'll keep it short, no problem.
    </p>
    <p>
      I jacked into Unix the first time at Calhoun Community College, in Decatur, Alabama, during the summer of 1974.  I was 15, and my dad was a part-time programming instructor.  Having been an avid reader since the age of 6 (I read the entire elementary school library before the middle of second grade), text and text-processing was much on my mind.
    </p>
    <p>So when I encountered a system where plain text is the raw material flowing through the pipes, I was hooked.
    </p>
    <blockquote>
      <br>
      ...what I really learned was that the rules of Unix could be adapted to life.
      </blockquote>
    
    <p>
      This led me to undertake an informal study of Unix, all the way back to the Tech Model Railroad Club and all the hackers that came from there.  Yeah, I read the story about Margaret and the groceries and the Volkswagen; I understand his pain.
    </p>
    <p>
      But what I really learned was that the rules of Unix could be adapted to life.
    </p>
    <p>
      After about 30 years as a tech writer and frequent programmer, I finally settled on a set that works for me.  Little did I know that these very principles would lead me to org-mode, which would later lead me to find my people.
    </p>
    <hr>
    <h3>
      <center>
	Unix rules for life
      </center>
    </h3>
    <ul>
      <li>Keep it simple: It's cheaper and easier to carry around.</li>
      <li>Do one thing at a time: Multitasking is a lie.</li>
      <li>Network: You were born to connect.</li>
      <li>Say what you mean; nothing is truer than the truth.</li>
      <li>Hack: Trial and error is the only way we learn anything</li>
      <li>Be who you are: Even a bent wire can carry a great light.</li>
      <li>Use leverage; a bigger hammer isn't always the answer.</li>
      <li>Use what you have: never dig diamonds with a brick of gold.</li>
      <li>Have faith; all's possible, except maybe skiing through a revolving door.</li>
      <li>Think ahead, but don't worship your plans; remember today is the first day of the rest of your learning experience.</li>
    </ul>
    <hr>

<h3>
  a vi convert
</h3>
<p>
  I didn't start with org-mode, actually, but with plain journal files labeled YYYYMMDD, in a special directory in <code>/var/log</code>.  I still have those going back to sometime in the 90's.  The format was simple, but using the files soon became complex:
  </p><pre>	  
    *** personal journal of stormrider
    tue, aug 04, 1992 / 712904400
    sweetmorn, confusion 70, 3158 YOLD
    
    *** fortune -s
    Cold hands, no gloves.
    
    *** appts
    09:00  staff meeting, conf rm
    18:30  dinner with amit &amp; bonnie
    
    *** to do
    finish revisions on x-windows book
    do syllabus for advanced C class
    read some in Stevens &amp; Rago
    shower
    shave
    dress
    take out the trash otw to work
    .
    .
    .
    
    *** daily journal
    06:43 - man, didn't sleep well
    last night; i think i'm overdoing
    it on the coffee at work; maybe i
    should cut back some?
    .
    .
    .
  </pre>
  The unwieldy part came with all the repeated tasks, and tasks that got carried over from one day to the next (or didn't get finished). I had to copy yesterday's file, change all the key info, sort out the todo list, erase yesterday's journal, and generally do far too much work to keep my journal up.

<blockquote>
  <br>
  I got turned onto emacs sometime in the mid-nineties, when I moved to Atlanta to work for HP.  A fellow writer there used it, and suggested it might help me write and code up examples more effectively.  He was right, and it stuck....
  </blockquote>
<p>
  I did it, but intermittently, supplanting it with post-it notes, pads, planners galore, palm pilots, palmtop computers, etc.  It seemed like every day I was badly copying tasks from one day to the next. Meanwhile, my unwillingness to use Windows didn't give the the luxury of Outlook, when it came along.
</p>
<p>
  I got turned onto emacs sometime in the mid-nineties, when I moved to Atlanta to work for HP.  A fellow writer there used it, and suggested it might help me write and code up examples more effectively.  He was right, and it stuck as my editing platform of choice.
</p>
<p>
But I hadn't discovered org-mode yet. Either he didn't use it, or it hadn't been invented yet.  And to be honest, I kinda went back and forth between vi and emacs, depending on my "mood of the month."
</p>
<h3>
  a modem in the woods
</h3>
<p>
  Eventually, my HP job became a telecommuting-type arrangment, and I moved home to the farm, about an hour outside New Orleans, in the woods.  At that time, Internet was still modem-driven out here, so having command-line Linux with emacs on my laptop was a real lifesaver.
</p>
<p>
  Sometime not long before Katrina hit, I stumbled across org-mode.  I'd already used outline mode for some period of time (can't remember how long), and org-mode seemed like a logical follow-on from there.
      </p>
      <p>
	From there, org-mode just grew, and I grew with it.  All the features made it easy for me to both do what seemed natural for me, and do things in a way that felt like they supported my principles.  Gradually, my other methods of keeping track of things faded away, except for my alarm clock.  </p>
<p>
  Even when smart-phones took off, I was always trying to find some way to send org files over to my phone and use them there.  I think I even wrote some lua code in an iPhone wiki app to emulate org-mode with my files, though it was not fully satisfactory.
</p>
<h3>
  an org-mode resume
</h3>
      <p>
	Fast-forward to last May.  I'd been wanting to get on with Canonical for a long time, but hadn't found the right position, one that really matched my skills.  Then one Saturday, while I was waiting for my wife to meet me for some community event we were hosting, I saw a position that virtually described me.  I started to write a resume, but then decided that I would just take the job description elements, one-by-one, put them in an org file, and send them to the hiring manager.
      </p>
<p>
  Long-story short, almost everyone on this team used emacs, and org-mode, and lots of other .el packages that I also used every day.  I got the job, and so far, I'm very happy and feel like I fit in very well.
      </p>
      <h3>
	org-mode and my principles
      </h3>
      <p>
	Here's how I feel about using org-mode for everything: email, git, irc, web-browsing, organization, time-keeping, and so on.  And yes, I do use org-mode to connect with my email and the web, even though I use other packages (rmail, eww, magit, erc) to do the heavy lifing.  Let me walk it down, principle by principle:
	</p><ul>
	  <li><strong>Keep it simple:</strong> Granted, emacs isn't the simplest user interface, that is, until it becomes second nature.  After that, you'll find yourself accidentally erasing cells in your Google spreadsheet when you hit "C-x C-s" to try to save (good thing there's an undo). But the fact that you can use the same text for multiple functions: appointments, task states, task notes, clocking time, building an agenda, sending email, project planning, percentage completion, ....  The list is too long to quote, but just a simple statement, like "Get the discourse publishing tool working," can become the nucleus for a whole cycle's work and all the actions that go with it.</li><br>
	  <li><strong>Do one thing at a time:</strong> The window-driven nature of emacs makes it easy to switch tasks when you have to (just open another buffer) and then switch back later, and more quickly link back to where you were; not to mention that, if you become adept at using the agenda, you can keep yourself on track and move other things around with ease, and without any fear that they'll get lost.</li><br>
	  <li><strong>Network:</strong> Since I'm set up to send email, IRC, Mattermost, etc., directly from my org-mode tasks, it's easy to track where I am.  But even if I used another app, it's still really easy to just cut and paste a note next to a task and then set a follow-up time to prod, all without breaking your train of thought.  You're literally still looking at the work you're doing while you're messaging about it, so there's that.</li><br>
	  <li><strong>Say what you mean:</strong> You have the entire outline in front of you for whatever you're working on, so presentations, show-and-tell sessions, and status reports are really simple to give, whether verbally or in writing.</li><br>
	  <li><strong>Hack...:</strong> If it doesn't do what you want, you've got customizable variables, a huge library of packages, strong macro capability, and push-come-to-shove, emacs lisp, though I rarely have to go there, TBH.</li><br>
	  <li><strong>Be who you are:</strong> Org-mode matches my thinking style. Not true for everyone, but I tend to outline or mindmap (which you can do with org-mode, with the right .el package).</li><br>
	  <li><strong>Use leverage:</strong> Org-mode seriously leverages the power of plain text, in that you can either use the shortcuts to add an appointment, add tags, search tags -- or you can just do it by hand, because all of the special notation is plain text.  Leveraging human language in this way is helpful to me.</li><br>
	  <li><strong>Use what you have:</strong> Org-mode and emacs give me a stable platform that works everywhere, even on a printout.  I don't need license fees, special extensions, subscriptions, add-on tools, or constant updates to keep my life humming.</li><br>
	  <li><strong>Have faith:</strong> Org-mode has justified my faith, as has emacs.  Lots of tools I've used break, crash, or get killed by absorption (I once liked Astrid, e.g., but it suddenly got sold and went away).  Org-mode and emacs are pretty much here to stay, especially since there is no license fee, and I can keep a self-contained version backed up at home, should it ever stop being distributed.</li><br>
	  <li><strong>Think ahead:</strong> This is where org-mode, and especially the agenda, shine.  If I'm busy, I don't have to worry about keeping my outline clean.  I can stop in the middle of notes for another project, hit return, enter a to do for later (and tag it and schedule it to pop up later), and then move that to someplace more suitable later.  The agenda will clean it up and put it in perspective for me.  Or I can search for it, or pull up all open to-do items …</li></ul></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="http://stormrider.io/ninety-pct.html">http://stormrider.io/ninety-pct.html</a></em></p>]]>
            </description>
            <link>http://stormrider.io/ninety-pct.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-23672473</guid>
            <pubDate>Sun, 28 Jun 2020 22:07:39 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[The Hardest Part of Working at a Growth Startup]]>
            </title>
            <description>
<![CDATA[
Score 49 | Comments 33 (<a href="https://news.ycombinator.com/item?id=23671824">thread link</a>) | @svmanager
<br/>
June 28, 2020 | https://staysaasy.com/scaling/2020/06/27/hardest-part-of-startup-scale-yourself.html | <a href="https://web.archive.org/web/*/https://staysaasy.com/scaling/2020/06/27/hardest-part-of-startup-scale-yourself.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
    <p><img src="https://staysaasy.com/assets/hardest_part_of_startup/office-space.jpeg" alt="The hardest part of working at a growth startup is having to re-interview for your job every year">
Growth startups require both personal and business scaling.</p>

<p>The hardest part of working at a growth startup is having to re-interview for your job every year.</p>

<h3 id="the-challenge-of-scaling">The challenge of scaling</h3>

<p>You’re heading a key function at your 25-person startup. Maybe you’re head of engineering; maybe you run marketing. Hell, maybe you’re the CEO. You kick ass and your startup grows fast – and with that growth, the needs of the company evolve. Things in the new world are now going okay, but perhaps not optimally. Eventually, the CEO and board of directors get in a room to discuss what to do.</p>

<p>I can tell you what will happen in this room. The board will discuss your performance, and compare it to the performance of other, hypothetical executives – just as if you were interviewing for your own job. In your favor: you are a known quantity, presumably viewed as talented, and perhaps even a close friend. Against you: you haven’t done this before, and we need results now.</p>

<p>In many cases this conversation will lead to you being demoted or asked to leave. In extra cruel circumstances, you can literally get fired for having done a great job. This is normal, semi-expected, and sucks. And this happens to everyone – even founding CEOs are not immune.</p>

<p>The hardest part of this situation? These hard truths often go unspoken. Sometimes it’s just too awkward to tell someone who’s been there through thick and thin that they’re expected to be a stand-in for a future big league exec. And if you have a first-time management team, they might not even realize what’s going on – they may also be in the process of not scaling fast enough, either. At least when you’re interviewing, you’re explicitly given the chance to shine; such opportunities may not be spoon-fed to you during hectic growth.</p>

<h3 id="how-to-scale-yourself">How to scale yourself</h3>

<p>To avoid this situation you need to become a self-scaling machine. Read voraciously, and find opportunities to put new skills into practice – during growth mode there’s always too much to do, so take advantage and gain actual battlefield experience. You should constantly have an image in your mind of where you expect your team to be in 6 months and steer towards that future world. Learning to see around corners allows you to scale independently, and independence is a key leadership trait since <a href="https://staysaasy.com/scaling/2020/05/07/startup-is-this-normal.html">startups are constantly on fire</a>. Finding mentors who are at least 2-3 years ahead of you in terms of their own careers is another great way to build these instincts.</p>

<p>And most importantly, <em>ask questions</em>. Ask your manager how they expect your job will be different in 6 months (if you’re the CEO, this advice will be slightly different –&nbsp;a trusted advisor and/or executive coach can help). Ask them what they see as your current trajectory in the role. In my experience people are way too shy about asking direct questions in general, especially to their managers – it is literally your manager’s job to provide high-quality answers to your career questions. If you nail this, it’s a fast track towards increasing responsibility and growth.</p>

<h3 id="this-isnt-a-bad-thing">This isn’t a bad thing!</h3>

<p>From the other perspective, well-run growth startups give you the regular opportunity to interview for roles that are a level higher (or two!). <a href="https://www.linkedin.com/in/marissamayer/">This</a> is a <a href="https://www.linkedin.com/in/marcbenioff/">proven way</a> to <a href="https://www.linkedin.com/in/ericsyuan/">accelerate</a> your <a href="https://en.wikipedia.org/wiki/Sundar_Pichai#Career">career</a>. If you scale with a growing organization, you can pack decades of experience into years.</p>

    




  </div></div>]]>
            </description>
            <link>https://staysaasy.com/scaling/2020/06/27/hardest-part-of-startup-scale-yourself.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-23671824</guid>
            <pubDate>Sun, 28 Jun 2020 20:34:49 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Implementing the Exponential Function]]>
            </title>
            <description>
<![CDATA[
Score 195 | Comments 50 (<a href="https://news.ycombinator.com/item?id=23671262">thread link</a>) | @hackernewsn00b
<br/>
June 28, 2020 | https://www.pseudorandom.com/implementing-exp | <a href="https://web.archive.org/web/*/https://www.pseudorandom.com/implementing-exp">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article><p><em>I explore several sophisticated approximation techniques for implementing the exponential function, $f(x) = e^x$, including Taylor series approximation, Lagrange interpolation, Chebyshev interpolation, Carathéodory-Fejer approximation and MiniMax approximation. This also serves as a more general introduction to the use of these methods for approximating other functions. In the process I walk through the relevant theory for each method and apply numerical analysis to navigate various forms of error. I also include my own Python and C++ implementations of each algorithm in double precision<label for="cb-1"><sup id="footnote-1"><span>1</span></sup></label><span><p>1:  Note that the implementations included here will both output <strong>and</strong> calculate in double precision. We can still apply sophisticated methods in this setting, but as a general rule you’ll need higher intermediate precision to obtain an approximation which is indistinguishable from the true value in double precision. This is one (but not the only) reason why it’s generally advisable to use an optimized <code>exp(x)</code> function provided by your platform rather than write one from scratch.</p></span> with heavy commentary. Finally, I analyze each implementation’s performance and accuracy characteristics using the hyper-optimized, platform-provided <code>exp(x)</code> function as a benchmark.<label for="cb-2"><sup id="footnote-2"><span>2</span></sup></label><span><p>2:  In most cases, whichever numerical library you’re using will map to the platform-provided <code>exp(x)</code> function. For example, this is what <code>numpy.exp</code> does <a href="https://github.com/numpy/numpy/blob/master/numpy/core/src/npymath/npy_math_internal.h.src#L451-L471">under the hood</a>.</p></span> The Background section opens with the motivating properties of $e^x$ and the basics of floating point systems. The code for each technique is included under the corresponding Implementation heading.</em></p>

<h2 id="section-0"><a href="#section-0">Background</a></h2>

<h3 id="section-1"><a href="#section-1">Taylor series</a></h3>

<p>To motivate the definition of $e$, we will recall some calculus. Let $f$ be a <a href="https://mathworld.wolfram.com/SmoothFunction.html">smooth</a> function at $a$. This is to say that $f$ is infinitely <a href="https://mathworld.wolfram.com/Differentiable.html">differentiable</a> at some real value $a$: for every $k^{\text{th}}$ derivative $f^{(k)}$, we can differentiate $f^{(k)}$ again to obtain the $(k + 1)^{\text{th}}$ derivative $f^{(k + 1)}$. By definition, any function with this property which can also be uniquely represented as a <a href="https://mathworld.wolfram.com/TaylorSeries.html">Taylor series</a> expansion “centered” at $a$ is called <a href="https://mathworld.wolfram.com/RealAnalyticFunction.html">analytic</a>. The Taylor series of $f$ centered at $a$ and evaluated at $x$ is defined to be</p>

<p>$$
f(x) = \frac{f(a)}{0!}(x - a)^0 + \frac{f’(a)}{1!}(x - a)^1 + \ldots + \frac{f^{(k)}(a)}{k!}(x - a)^k + \ldots
$$</p>

<p>This is a <a href="https://mathworld.wolfram.com/PowerSeries.html">power series</a>, or infinite polynomial with one variable. The center of expansion determines a neighborhood of values returned by the Taylor series, and the coefficient of each <em>Taylor term</em> is determined by repeatedly differentiating the function $f$ and evaluating it at $a$. A common center of expansion is $a$ = 0, in which case the Taylor series is also called a <a href="https://mathworld.wolfram.com/MaclaurinSeries.html">Maclaurin series</a> and the series is centered around the origin. This can be considered the “default” setting. If you cut off all terms of the Taylor expansion after some term $k$, you obtain a polynomial with degree $k$. The coefficient of the $k^{\text{th}}$ term of the series (or polynomial, if truncated) is given by</p>

<p>$$
a_{k} = \frac{f^{(k)}(a)}{k!}
$$</p>

<p>where 0! = 1.</p>

<p>For a concrete example, consider the Taylor series expansion of the <a href="https://mathworld.wolfram.com/Sine.html">sine</a> function. The sine function is not only infinitely differentiable, but cyclic.</p>

<p>$$
\begin{aligned}
\sin^{(1)}(x) &amp;= \cos(x), \\
\sin^{(2)}(x) &amp;= \cos^{(1)}(x) = -\sin(x), \\
\sin^{(3)}(x) &amp;= -\sin^{(1)}(x) = -\cos(x), \\
\sin^{(4)}(x) &amp;= -\cos^{(1)}(x) = \sin(x)
\end{aligned}
$$</p>

<p>We determine each $k^{\text{th}}$ coefficient of the Taylor series by evaluating $f^{(k)}$ at $a$ and dividing it by the factorial of $k$. If we want to expand the sine function around the origin ($a$ = 0), we obtain the cyclic coefficients</p>

<p>$$
\begin{aligned}
\sin(0) &amp;= 0, \\
\sin^{(1)}(0) &amp;= \cos(0) = 1, \\
\sin^{(2)}(0) &amp;= \cos^{(1)}(0) = -\sin(0) = 0, \\
\sin^{(3)}(0) &amp;= -\sin^{(1)}(0) = -\cos(0) = -1, \\
\sin^{(4)}(0) &amp;= -\cos^{(1)}(0) = \sin(0) = 0
\end{aligned}
$$</p>

<p>Since $(x - 0)^{k} = x^{k}$, we have the Taylor series expansion</p>

<p>$$
\sin(x) = x - \frac{x^3}{3!} + \frac{x^5}{5!} - \frac{x^7}{7!} + \frac{x^9}{9!} - \ldots
$$</p>

<p>Truncating the Taylor expansion of a function $f$ at any term $k$ gives a finite approximation of $f$ using the $k$ degree <em>Taylor polynomial</em>. A Taylor polynomial of $f$ centered at $a$ produces very accurate approximations of $f(x)$ when $x$ is relatively close to $a$. As the absolute value of $x$ increases away from $a$, the accuracy of the Taylor polynomial rapidly decreases, which means it requires more terms of the Taylor series (i.e. a higher degree polynomial) for accurate approximation. Consider the following plot, which shows the values of $\sin(x)$ over the interval $[-20, 20]$ compared to its Taylor polynomials of degree 1, 3, 5, 7 and 9 centered at $a$ = 0.</p>

<figure>
  <p><a href="https://www.pseudorandom.com/assets/images/articles/implementing-exp/sin_taylor_series.svg"><img src="https://www.pseudorandom.com/assets/images/articles/implementing-exp/sin_taylor_series.svg"></a></p>
  <figcaption>$T_{n}$ denotes the degree $n$ Taylor polynomial of $\sin$</figcaption>
</figure>

<p>Observe that the Taylor approximation of $\sin(x)$ is more accurate when $x$ is near $a$ = 0, but quickly flies away from the true value of $\sin(x)$ further away from 0. The degree 1 Taylor polynomial is only an accurate approximation for $\sin(x)$ for a very small interval near the origin, whereas the degree 9 Taylor polynomial is very accurate within $[-5, 5]$. How long the approximation holds until it becomes extremely inaccurate depends on the number of terms of the Taylor polynomial. A higher degree polynomial will maintain a better approximation of $\sin(x)$ for longer, but any finite polynomial will eventually become extremely inaccurate.</p>

<h3 id="section-2"><a href="#section-2">Defining $e$</a></h3>

<p>The <a href="https://mathworld.wolfram.com/e.html">mathematical constant</a> $e$ is (almost) entirely motivated by the very nice properties it exhibits under exponentiation. In particular, the definition of $e$ was born out of the desire to find a continuous function which is its own derivative and which maps the additive identity 0 to the multiplicative identity 1. This is because solving difficult integration and differentiation problems is vastly more expedient with such a function. By extension a significant fraction of problems in applied mathematics and physics reduce to solving differential equations, for which such a function is fundamental.</p>

<p>As it happens, $f(x) = e^x$ uniquely satisfies this property. We can show this, and define $e$ directly in the process, by starting from the Taylor series representation of an arbitrary function $f$ infinitely differentiable at $a$ = 0. Suppose $a_0, a_1, \ldots$ are the coefficients of the Taylor series of $f$ centered at $a$. Then we have the Taylor series</p>

<p>$$
f(x) = a_0 + a_1 x + a_2 x^2 + a_3 x^3 + \ldots
$$</p>

<p>It follows from the linearity of differentiation that the Taylor series expansion of the first derivative $f’$ is</p>

<p>$$
f’(x) = a_1 + 2a_2 x + 3a_3 x^2 + \ldots
$$</p>

<p>To determine a function which is its own derivative, we solve for the coefficients $a_0, a_1, \ldots$ which satisfy $f = f’$:</p>

<p>$$
a_0 + a_1 x + a_2 x^2 + \ldots = a_1 + 2a_2 x + 3a_3 x^2 + \ldots
$$</p>

<p>From here we can see the pattern</p>

<p>$$
\begin{aligned}
a_0 &amp;= a_1, \\
a_1 &amp;= 2a_2, \\
a_2 &amp;= 3a_3
\end{aligned}
$$</p>

<p>and so on, which is equivalent to</p>

<p>$$
\begin{aligned}
a_1 &amp;= a_0, \\
a_2 &amp;= \frac{a_1}{2}, \\
a_3 &amp;= \frac{a_2}{3}
\end{aligned}
$$</p>

<p>By induction we have a <a href="https://mathworld.wolfram.com/RecurrenceEquation.html">recurrence relation</a> which defines the $k^{\text{th}}$ coefficient $a_k$</p>

<p>$$
a_k = \frac{a_{k - 1}}{k}
$$</p>

<p>Given $a_0$ = 1, we find that the Taylor series of a function which is its own derivative is</p>

<p>$$
f(x) = 1 + x + \frac{x^2}{2!} + \frac{x^3}{3!} + \ldots.
$$</p>

<p>We denote this function with $e^x$, where $e$ is defined to be the value of this function at $x$ = 1.</p>

<p>$$
e = f(1) = \sum_{k = 0}^{\infty}\frac{1}{k!} = 2.7183\ldots
$$</p>

<p>A more intuitive illustration of why $e^x$ is special is given by the following graph, in which exponential functions with various bases are plotted alongside their derivatives. An exponential function with a base less than $e$, like $b$ = 2, grows more quickly than its derivative. But when the base is greater than $e$, like $b$ = 4, it grows less quickly than its derivative.</p>

<figure>
  <p><a href="https://www.pseudorandom.com/assets/images/articles/implementing-exp/exp_comp.svg"><img src="https://www.pseudorandom.com/assets/images/articles/implementing-exp/exp_comp.svg"></a></p>
  <figcaption>When $b &lt; e$, we have $f'(x) &lt; f(x)$. When $b &gt; e$, we have $f'(x) &gt; f(x)$. But $b = e$ is the "goldilocks" base at which $f'(x) = f(x)$.</figcaption>
</figure>

<h3 id="section-3"><a href="#section-3">Floating point</a></h3>

<p>There is an intrinsic tension in that we want to determine accurate values of $e^x$ without doing too much work. Before we can consider the efficiency of an algorithm, we need to consider its accuracy. This leads us to define a variety of types of error, the most important of which comes from the way we approximate real numbers. It’s often impossible to calculate the exact value of $f(x)$ for an arbitrary function $f$, because computers can’t work with arbitrary real numbers.<label for="cb-3"><sup id="footnote-3"><span>3</span></sup></label><span><p>3:  <a href="https://en.wikipedia.org/wiki/Almost_all">Almost all</a> real numbers are not <a href="https://mathworld.wolfram.com/ComputableNumber.html">computable</a>. The reals which are computable are frequently not exactly representable to a desirable level of accuracy because they’re either irrational (and therefore have infinite decimal expansions) or rational with very long decimal expansions.</p></span> The best we can do is approximate the value to some acceptable accuracy.</p>

<p>The <a href="https://en.wikipedia.org/wiki/IEEE_754">IEEE 754</a> <em>floating point</em> standard discretizes real intervals into a computable form by mapping all nearby real values in given neighborhoods to a single rounded value. Internally, an IEEE 754 binary floating point number $N$ is represented using the normalized form</p>

<p>$$
N = \pm b_1.b_2b_3 \ldots b_p \times 2^{E_{k}}
$$</p>

<p>where the first bit is allocated for the sign (the <em>sign bit</em>), the $p$ bits $b_1.b_2b_3 \ldots b_p$ comprise the <em>mantissa</em>, or <em>significand</em>, and $E_{k}$ is an integer exponent consisting of $k$ bits. Note that since this form is normalized, $b_1 = 1$, while each of $b_2, \ldots b_p$ may equal 0 or 1. IEEE 754 single precision binary floating point numbers have a total size of $32$ bits: $8$ are allocated for the exponent $E \in [-126, 127]$ and $23$ are allocated for the mantissa (with $p$ = 24 accounting for the normalized bit). Thus you can represent $2^{32}$ different values in single precision floating point, with underflow and overflow limits of $2^{127} \approx 3.4 \times 10^{38}$ and $2^{-126} …</p></article></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://www.pseudorandom.com/implementing-exp">https://www.pseudorandom.com/implementing-exp</a></em></p>]]>
            </description>
            <link>https://www.pseudorandom.com/implementing-exp</link>
            <guid isPermaLink="false">hacker-news-small-sites-23671262</guid>
            <pubDate>Sun, 28 Jun 2020 19:14:07 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Better Geometry Through Graph Theory (2018)]]>
            </title>
            <description>
<![CDATA[
Score 69 | Comments 11 (<a href="https://news.ycombinator.com/item?id=23671130">thread link</a>) | @prospero
<br/>
June 28, 2020 | http://ideolalia.com/2018/08/28/artifex.html | <a href="https://web.archive.org/web/*/http://ideolalia.com/2018/08/28/artifex.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>

	

	<div>
		<article>
			<p><img src="http://ideolalia.com/images/artifex-set-operations.png" alt=""></p>

<h3 id="how-i-spent-my-summer">how I spent my summer</h3>

<p>A few months ago, I decided to implement set operations on curved regions.  I had the <a href="https://www.springer.com/us/book/9783540779735">the canonical textbook on computational geometry</a>, which described approaches for polygons comprised of straight lines, and it seemed like <a href="http://paperjs.org/">other projects</a> had extended these techniques to <a href="https://en.wikipedia.org/wiki/B%C3%A9zier_curve">parametric curves</a>.  I figured it would take a couple of weeks.</p>

<p>Unfortunately, the field of computational geometry embodies a fundamental contradiction.  In geometry, the angles of a triangle add up to exactly π radians, and if <em>u</em> is clockwise from <em>v</em> then <em>v</em> must be counter-clockwise from <em>u</em>.  Computers, on the other hand, use floating point representations which make a mockery of these simple Euclidean truths.</p>

<p>The academic literature largely ignores this.  Algorithms are proven to be geometrically sound, and robust implementations are left as an exercise for the reader.  This is akin to a world in which hash collisions caused unavoidable data loss, and the academic response was to implicitly assume the existence of a perfect hash function.  If a paper is predicated on unrealistic assumptions, we cannot evaluate it on its own terms; we must understand, empirically, how well it functions when these assumptions are broken.</p>

<p>With this in mind, we can now look at the existing algorithms for <a href="https://en.wikipedia.org/wiki/Clipping_(computer_graphics)">polygon clipping</a>, which is the term of art for polygon set operations.  Every technique is a variation on a common theme:</p>

<p><img src="http://ideolalia.com/images/artifex-clipping.png" alt=""></p>

<ul>
  <li>Given two or more rings, find every point of intersection</li>
  <li>Segment the rings at the points of intersection</li>
  <li>Decide whether each segment should be included, based on the operation being performed</li>
</ul>

<p>The dozen or so papers on this subject differ only in the third step.  Since our decision to include a segment typically inverts at an intersection point, they describe a variety of approaches for using our decision to about one segment to inform our decision about adjacent segments.</p>

<p>My textbook described a method using <a href="https://en.wikipedia.org/wiki/Doubly_connected_edge_list">doubly-connected edge lists</a>, which is a generic geometric data structure.  I assumed that meant it could be reused for other problems, so I started my implementation.</p>

<p>A month went by.</p>

<p>I had finished the implementation my first week, but it wasn’t reliable.  A DCEL is a collection of linked loops, which can be incrementally updated.  When performing a set operation, we incrementally bisect the original set of loops, and then determine which should and shouldn’t be included.  Despite my best efforts, I kept finding new shapes that caused adjacent faces to get tangled together, creating a Möbius strip that is simultaneously inside and outside the expected result.</p>

<p>Slowly, I realized the problem wasn’t the data structure, it was the first step that every paper glossed over: finding all the intersections.  The DCEL assumes the edges at a vertex have a total ordering: the previous edge is directly clockwise, and the next one is directly counter-clockwise.  If we miss an intersection, we might conclude two curves are both clockwise relative to the other, causing everything to fall apart.</p>

<p>I began to look for better ways to find intersections, hoping that if I found an approach that was sufficiently accurate, my work on the DCEL could be salvaged.  Unfortunately, the approaches I found in the literature and implemented in the wild were no better than what I had been using.  My data structure demanded precise inputs, without internal contradictions, and I couldn’t deliver.</p>

<p>At that point, I began to wonder if I had missed something fundamental.  I thought maybe if I dissected how other, more mature, libraries handled my pathological shapes, I could work backwards to see where I had gone wrong.  But when I began to feed these shapes into well-established projects like paper.js, I found they failed just as badly.</p>

<p>To find my pathological inputs, I had been using property-based testing.  Given a random combination of shapes, I would perform a point-in-region test and compare it to a reference result, generated by querying each shape individually and combining the results according to the operation.  Most inputs worked fine, but after a few hundred thousand inputs it would inevitably find some failure.</p>

<p>Other projects, it turned out, had been a little less eager to find their own failure modes.  Some only had a handful of example-based tests, others had a static suite of a few thousand inputs they used to validate their changes.  If I had missed something, it appeared to be that no one else expected these operations to be particularly robust.</p>

<hr>

<h3 id="why-is-this-so-hard">why is this so hard?</h3>

<p>Floating point arithmetic is best understood through a simple, maddening fact: <code>a + (b - a)</code> does not necessarily equal <code>b</code>.  It might be equal, or it might be off by just a little, where “little” is relative to the larger of the two numbers.  This means that when we compare two floating point numbers, we cannot do a precise comparison, we have to ask whether they differ by less than some <em>epsilon</em> value.</p>

<p>This epsilon represents the level of numerical uncertainty to which we’ve resigned ourselves.  There is vast folk wisdom around how to minimize this uncertainty, but the fact remains that every arithmetic operation injects a bit of uncertainty, and it grows cumulatively with each successive operation.  When dealing with small numbers, this uncertainty may dwarf the values themselves.</p>

<p>An intersection, in a precise mathematical sense, occurs wherever the distance between the curves is exactly zero:</p>

<p><img src="http://ideolalia.com/images/artifex-precise-intersection.png" alt=""></p>

<p>But in a practical sense, it is wherever the distance between the curves is close enough to zero:</p>

<p><img src="http://ideolalia.com/images/artifex-fuzzy-intersection.png" alt=""></p>

<p>This has at least one intersection, but we could just as easily return three or ten within that overlapping range.  This uncertainty is anathema to the published techniques, which rely on counting these intersections to determine whether we’re inside or outside the other shape.  A single spurious intersection may cause the entire result to vanish.  If two objects with similar curvature move across each other, the result will tend to flicker in and out of existence.</p>

<p>These techniques may suffice for straight lines, which require smaller epsilons, but they are wholly unsuited to the relative imprecision of parametric curves.</p>

<hr>

<h3 id="embracing-the-uncertainty">embracing the uncertainty</h3>

<p>As the weeks passed, the errors uncovered by my tests went from feeling random to feeling malicious.  Floating point arithmetic may be deterministic, but as I watched my screen, waiting for the tests to fail, I imagined a demon in the FPU nudging the values as they flowed past, trying to move them beyond the threshold of self-consistency.</p>

<p>One day, I realized this was exactly the narrative behind <a href="https://en.wikipedia.org/wiki/Error_detection_and_correction">error-correcting codes</a>; we assume our data has been randomly altered en route, and we want to return it to a consistent state.  It didn’t seem like I could get it right the first time, so why not just fix it afterwards?</p>

<p>Consider the union of two ellipses:</p>

<p><img src="http://ideolalia.com/images/artifex-two-ellipses.png" alt=""></p>

<p>Ostensibly, there should only be three points of intersection, one on the left and two on the right.  But for the reasons described above, any intersection routine will likely find multiple points of intersection on the left as the curves converge on each other:</p>

<p><img src="http://ideolalia.com/images/artifex-ellipses-intersections.png" alt=""></p>

<p>The segments on the left are small enough, and thus imprecise enough, that our spatial intuition for the problem will just mislead us.  For this reason, it’s better to think of it as a graph:</p>

<p><img src="http://ideolalia.com/images/artifex-ellipses-graph.png" alt=""></p>

<p>Now we have to decide which edges to include, and which to exclude.  Since we’re trying to find the union, we want to keep any segments that are outside the other shape:</p>

<p><img src="http://ideolalia.com/images/artifex-ellipses-valid-result.png" alt=""></p>

<p>This is a well-formed result; there is a single cycle, and once we remove that cycle there are no leftover edges.  But we can’t rely on getting this lucky; the edges on the left might have succumbed to floating point error and believed they were both inside the other:</p>

<p><img src="http://ideolalia.com/images/artifex-ellipses-incomplete.png" alt=""></p>

<p>This is not a well-formed result; there are no cycles, and a bunch of leftover edges.  To make this consistent, we need to either close the loop, or remove the leftovers.  The cost of these changes is measured by the aggregate length of the edges we are adding or removing.</p>

<p>The minimal set of changes is equivalent to the shortest path between the dangling vertices.  Having found the path, we then invert the inclusion of every edge it passes through.  In this case, it passes through one of the edges we originally excluded, so we add that edge back in, and return the cycle we just created.</p>

<p>Alternately, both edges might think they are outside the other:</p>

<p><img src="http://ideolalia.com/images/artifex-ellipses-redundant.png" alt=""></p>

<p>In this case, we have a complete cycle, but once we’ve extracted it there’s a single leftover edge:</p>

<p><img src="http://ideolalia.com/images/artifex-ellipses-leftover.png" alt=""></p>

<p>Here again, we search through all the remaining edges for the shortest path between the two dangling vertices.  Since it passes through our leftover edge, we remove it.</p>

<p>Every floating point inconsistency will surface as one of these two cases, or some combination thereof.  By searching for the shortest path between the dangling edges, we find the smallest possible edit that will yield a consistent result.  Of course, a consistent result is not necessarily the <em>correct</em> one, but the fact that floating point errors tend to cluster around the smallest edges makes this a reasonable heuristic.  More importantly, it has weathered tens of millions of generative test cases without any issues.</p>

<p>A complete implementation of this algorithm can be found <a href="https://github.com/lacuna/artifex/blob/master/src/io/lacuna/artifex/utils/regions/Clip.java">here</a>.</p>

<hr>

<p>I’m not sure if this is a novel approach, but at the very least it represents a meaningful improvement on the state of the art in open source.  Intuitively, it feels like this might be a means to avoid epsilon hell in a wide range of geometric and numerical algorithms.  If anyone is aware of prior art in this vein, I’d be very interested to see it.</p>

<p>My work on the <a href="https://github.com/lacuna/artifex">Artifex</a> library is ongoing, but I hope it proves useful to others, and look forward to sharing my own projects that it will enable in the near future.</p>

<hr>

<p><em>Thanks to Alex Engelberg, Elana Hashman, Angus Fletcher, Reid McKenzie, and Zack Maril for feedback on early drafts of this post.</em></p>

		</article>
	</div>

</div></div>]]>
            </description>
            <link>http://ideolalia.com/2018/08/28/artifex.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-23671130</guid>
            <pubDate>Sun, 28 Jun 2020 18:56:07 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Why Does DARPA Work?]]>
            </title>
            <description>
<![CDATA[
Score 321 | Comments 82 (<a href="https://news.ycombinator.com/item?id=23670246">thread link</a>) | @MKais
<br/>
June 28, 2020 | https://benjaminreinhardt.com/wddw | <a href="https://web.archive.org/web/*/https://benjaminreinhardt.com/wddw">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="EssayContents">
<div id="EssayContentsInner">
<div>
  <div id="abstract-ish">
  <p>How can we enable more science fiction to become reality?</p>
  <p><span>If you want to do something, it usually pays to study those who have done that thing successfully in the past. Asking </span><span>‘what is this outlier’s production function?’
    </span><span>can provide a starting point. </span></p>
  <p><span>DARPA is an outlier organization in the world of turning science fiction into reality. Since 1958, it has been a driving force in the creation of weather satellites, GPS, personal computers, modern robotics, the
      Internet, autonomous cars, and voice interfaces, to name a few. However, it is primarily limited to the domain of defense technology – there are DARPA-style ideas that are out of its scope. &nbsp;Which emulatable attributes contributed to
      DARPA’s outlier results? </span><span>What does a</span>&nbsp;domain-independent&nbsp;“ARPA Model” look like? <span>Is it possible to
      build other organizations that generate equally huge results in other domains by riffing on that model?</span></p>
  <p>Gallons of ink have been spilled describing <span>how</span><span>&nbsp;DARPA works</span><a id="footnote_source_1" href="#footnote_1"><sup>1</sup></a><span>,
      but </span><span>in a nutshell here is</span><span>&nbsp;</span><span>how DARPA works.</span><span>&nbsp;Around 100 </span><span>program managers (PMs)</span><span>&nbsp;with ~5 year appointments create and run <span>programs</span> to pursue high-level visions like “actualize the idea of man-comp</span><span>uter symbiosis.” In these programs they fund researchers at universities and both
      big and small companies to do research </span><span>projects</span><span>&nbsp;of different sizes. Collectively, groups working on projects are called </span><span>performers</span>.&nbsp;Top-level
      authority lies with a <span>Director </span>who ultimately reports to the Secretary of Defense. </p>
  <p><span>DARPA has an incredibly powerful model for innovation in defense research, and I believe an abstract ‘<span>ARPA Model</span>’ could yield similar results in other domains. In this piece I’ll explain in detail why
      DARPA works. I’ll use that description to feel out and describe to the best of my ability a platonic ARPA Model. &nbsp;I’ll also distill some of the model’s implications for potential riffs on the model. Incidentally,
      I’m working on just such an imitator, and in future essays, I’ll explain why this model could be incredibly powerful when executed in a privately-funded context.</span></p>
  <h4>How to use this document</h4>
  
  <p>This document acts more like a collection of atomic notes than a tight essay – a DARPA-themed tapas if you will. The order of the sections is more of a guideline than a law so feel free to skip around. Throughout you will come across internal links that <a id="self-link" href="#self-link">look like this</a>.
    These links are an attempt to illustrate the interconnectedness of the ARPA Model.</p>
  <p><span>There are two stand-alone pieces to accomodate your time and interest:</span><span> a
    </span><span><a href="#distillation">distillation</a></span><span>, and the </span><span><a href="#h.nbyw8g2b67uk">full work</a></span><span>. </span><span>The
      distillation is meant to capture and compress the main points of the full work. Each section of the distillation internally links to the corresponding section one level deeper so if you want more info and nuance you can get it. </span></p>
      <p><span>I would rather this be read by a few people motivated to take action than by a broad audience who will find it merely interesting. In that vein, if you find yourself wanting to share this on Twitter or Hacker News, consider instead sharing it with one or two friends who will take action on it. Thank you for indulging me!</span></p>
      </div>
  
  <h2 id="program_managers_mini"><span>Program Managers</span></h2><p><span><a href="#at_the_end_of_the_day_the_arpa_model_depends_on_badass_program_managers_which_mirrors_the_obsession_with_“talent”_in_other_disciplines">At the end of the day the ARPA Model depends on badass program managers.</a></span><span>&nbsp;</span><span>Why is this the case? PMs need to
      think for themselves and go up and down the ladder of abstraction in an unstructured environment. On top of that they need to be effective communicators and coordinators because so much of their jobs is building networks. There’s a
      pattern that the abstract qualities that make “great talent” in different high-variance industries boils down to the ability to successfully make things happen under a lot of uncertainty. Given that pattern, the people who would
      make good DARPA PMs would <span>also</span> make good hedge fund analysts, first employees at startups, etc. so digging into </span><span><a href="#why_do_people_become_darpa_program_managers?">people’s motivations for becoming a PM</a></span><span>&nbsp;is important. More precise details about what makes a PM good prevent you from going after the exact same people as every other high-variance industry. When ‘talent’ isn’t code for ‘specialized
      training’ it means the role or industry has not been systematized. Therefore, despite all the talk here and elsewhere about ‘the ARPA Model’ we must keep in mind that we may be attributing more structure to the process than
      actually exists.</span></p><p><span><a href="#darpa_program_managers_pull_control_and_risk_away_from_both_researchers_and_directors">DARPA program managers pull control and risk away from both researchers and directors</a></span><span>.</span><span>&nbsp;PMs pull control away
      from directors by having only one official checkpoint before launching programs and pull control away from performers through their ability to move money around quickly. PMs design programs to be high-risk aggregations of lower-risk projects.
      Only 5–10 out of every 100 programs successfully produce transformative research, while only 10% of projects are terminated early. Shifting the risk from the performers to the program managers enables DARPA to tackle </span><span>systemic </span><span>problems where other models cannot.</span></p><p><span><a href="#the_best_darpa_program_managers_notice_systemic_biases">The best program managers notice systemic biases and attack them. </a></span><span>For example, noticing that all of the finite element modeling literature
      assumes a locally static situation and asking ‘what if it was dynamic?’ </span><span>“The best program managers can get into the trees and still see the forest.”</span><span> Obviously, this
      quality is rather fuzzy but leads to two precise questions:</span></p>
  <ol ="1"="">
    <li><span>How do you find people who can uncover systemic biases in a discipline? </span></li>
    <li><span>How could you systematize finding systemic biases in a discipline?</span></li>
  </ol>
  <p><span>The first question suggests that you should seek out heretics and people with expertise who are not experts. The second question suggests building structured frameworks for mapping a discipline and its assumptions.
    </span></p><p><span><a href="#a_large_part_of_a_darpa_program_manager’s_job_is_focused_network_building">A large part of a DARPA program manager’s job is focused network building</a></span><span>. </span><span>DARPA PMs network in the literal
      sense of creating networks, not just plugging into them. PMs meet disparate people working on ideas adjacent to the area in which they want to have an impact and bring them together in small workshops to dig into which possibilities are not
      impossible and what it would take to make them possible. The PMs host </span><span>performer days</span><span>&nbsp;— small private conferences for all the people working on different pieces of the program where
      performers can exchange ideas on what is working, what isn’t working, and build connections that don’t depend on the PM. </span><span><a href="https://en.wikipedia.org/wiki/J._C._R._Licklider">J.C.R. Licklider</a></span><a id="footnote_source_2" href="#footnote_2"><sup>2</sup></a><span>&nbsp;is a
      paragon here. He brought together all the crazy people interested in human-focused computing. On top of that, &nbsp;he also helped create the first computer science lab groups. PMs also build networks of people in different classes of organizations –
      government, academia, startups, and large companies. These connections smooth the path for technologies to go from the lab to the shelf. </span></p><p><span><a href="#darpa_pms_need_to_think_for_themselves,_be_curious,_and_have_low_ego">DARPA PMs need to think for themselves, be curious, and have low ego.</a></span><span>&nbsp;</span><span>Why does this matter? When you are
      surrounded by smart, opinionated people the easy option is to either 100% accept what they’re saying because it’s eloquent and well-thought through or reject it outright because it sounds crazy or goes against your priors. Thinking
      for yourself allows you to avoid these traps. PMs need to be curious because building a complete picture of a discipline requires genuine curiosity to ask questions nobody else is asking. A large ego would lead to a program manager imposing
      their will on every piece of the program, killing curiosity and the benefits of top down problems and bottom up solutions.</span></p><p><span><a href="#darpa_is_incredibly_flexible_with_who_it_hires_to_be_program_managers">DARPA is incredibly flexible with who it hires to be program managers.</a></span><span>&nbsp;</span><span>There are legal provisions in place that
      let DARPA bypass normal government hiring rules and procedures. Hiring flexibility is important because PMs are the sort of people who are in high demand, so they may be unwilling to jump through hoops. Bureaucracies ensure consistency through
      rules – minimal bureaucracy means there are no safeguards against hiring a terrible program manager so the principle that ‘A players hire A players and B players hire C players’ is incredibly important. &nbsp;</span></p><p><span><a href="#darpa_program_managers_have_a_tenure_of_four_to_five_years">DARPA Program managers have a tenure of four to five years.</a></span><span>&nbsp;</span><span>This transience is important for many reasons.
      Transience can inculcate PMs against the temptation to play it safe or play power games because there’s only one clear objective – make the program work. You’re out regardless of success or failure. Explicitly temporary roles can
      incentivize people with many options to join because they can have a huge impact, and then do something else. There’s no implicit tension between the knowledge that most people will leave eventually and the uncertainty about when that
      will be. Regular program manager turnover means that there is also turnover in ideas.</span></p><p><span><a href="#why_do_people_become_darpa_program_managers?">Why do people become DARPA Program managers? </a></span>From a career and money standpoint, being a program manager seems pretty rough.<span>&nbsp;There are unique benefits though. It offers an outlet for people frustrated with the conservative nature of academia. The prospect of getting to control a lot of money without a ton of oversight appeals to some people.
      Patriotism is definitely a factor, and hard to replicate outside of a government. Being a PM can gain you the respect of a small, elite group of peers who will know what you did. Finally, there may be a particular technological vision they want
      to see out in the world and DARPA gives them the agency to make it happen in unique ways.</span></p>
  <h2 id="incentives_and_structure_mini"><span>Incentives and Structure</span></h2><p><span><a href="#opacity_is_important_to_darpa’s_outlier_success">Opacity is important to DARPA’s outlier success.</a></span><span>&nbsp;</span><span>Congress and the DoD have little default oversight
      into how a PM is spending money and running a program. </span><span>Opacity removes incentives to go for easy wins or to avoid being criticized by external forces. Of course, opacity can also be abused in too many ways to list,
      so it’s important to ask: How does DARPA incentivize people not to abuse opacity? DARPA’s small size and flat structure enable peer pressure to work in …</span></p></div></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://benjaminreinhardt.com/wddw">https://benjaminreinhardt.com/wddw</a></em></p>]]>
            </description>
            <link>https://benjaminreinhardt.com/wddw</link>
            <guid isPermaLink="false">hacker-news-small-sites-23670246</guid>
            <pubDate>Sun, 28 Jun 2020 17:07:34 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Show HN: Hacker News front page in the style of a print newspaper]]>
            </title>
            <description>
<![CDATA[
Score 579 | Comments 127 (<a href="https://news.ycombinator.com/item?id=23669650">thread link</a>) | @wolfgang42
<br/>
June 28, 2020 | https://www.wolfgangfaust.com/project/paper-hn/ | <a href="https://web.archive.org/web/*/https://www.wolfgangfaust.com/project/paper-hn/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><p>This looks much nicer if you enable JavaScript.</p><div><section><img src="https://exploringjs.com/impatient-js/img-homepage/cover-homepage.jpg"><h2><a href="https://exploringjs.com/impatient-js/index.html">JavaScript for Impatient Programmers</a></h2><p><code>exploringjs.com</code> — This book makes JavaScript less challenging to learn for newcomers, by offering a modern view that is as consistent as possible. <strong><a href="https://news.ycombinator.com/item?id=23689280">IMPATIENT</a>,&nbsp;1</strong></p></section><section><img src="https://discourse-prod-uploads-81679984178418.s3.dualstack.us-west-2.amazonaws.com/original/3X/1/e/1e9bf330a7eb757e98e400cdc695a6037f2ce9a0.png"><h2><a href="https://discourse.mozilla.org/t/common-voice-dataset-release-mid-year-2020/62938">Mozilla Common Voice Dataset: More data, more languages</a></h2><p><code>mozilla.org</code> — Powered by Discourse, best viewed with JavaScript enabled <strong><a href="https://news.ycombinator.com/item?id=23695377">DATASET</a>,&nbsp;2</strong></p></section><section><img src="https://blog.malwarebytes.com/wp-content/uploads/2016/08/pexels-photo-30210-600x400.jpg"><h2><a href="https://blog.malwarebytes.com/mac/2020/06/new-mac-ransomware-spreading-through-piracy/">New Mac ransomware spreading through piracy</a></h2><p><code>malwarebytes.com</code> — Posted: June 30, 2020 by Thomas Reed   <strong><a href="https://news.ycombinator.com/item?id=23695270">RANSOMWARE</a>,&nbsp;3</strong></p></section><section><img src="https://cdn.vox-cdn.com/thumbor/S5g-vzLXziLfXREg4aazZSIl1Nw=/0x146:2040x1214/fit-in/1200x630/cdn.vox-cdn.com/uploads/chorus_asset/file/13250977/akrales_181010_2991_0038.jpg"><h2><a href="https://www.theverge.com/2020/6/30/21308449/youtube-tv-price-increase-64-99-viacom-hbo-new-channels">YouTube TV sharply increases monthly subscription to $64.99</a></h2><p><code>theverge.com</code> — Prices are going up as YouTube TV adds new ViacomCBS channels <strong><a href="https://news.ycombinator.com/item?id=23693407">SHARPLY</a>,&nbsp;4</strong></p></section><section><img src="https://www.economist.com/sites/default/files/images/print-edition/20200627_FBD001_0.jpg"><h2><a href="https://www.economist.com/briefing/2020/06/25/the-world-should-think-better-about-catastrophic-and-existential-risks">The world should think better about catastrophic and existential risks</a></h2><p><code>economist.com</code> — Plans and early-warning systems are always a good idea <strong><a href="https://news.ycombinator.com/item?id=23685886">CATASTROPHIC</a>,&nbsp;5</strong></p></section><section><img src="https://pragmaticpineapple.com/static/a61b0458abb2430b8852000f8cb7332c/og-image.jpg"><h2><a href="https://pragmaticpineapple.com/how-did-vim-become-so-popular/">How Did Vim Become So Popular?</a></h2><p><code>pragmaticpineapple.com</code> — June 29, 2020 | about 6 minutes to read  <strong><a href="https://news.ycombinator.com/item?id=23689091">VIM</a>,&nbsp;6</strong></p></section><section><h2><a href="https://jvns.ca/blog/2020/06/28/entr/">Entr: Rerun your build when files change</a></h2><p><code>jvns.ca</code> — This is going to be a pretty quick post – I found out about entr relatively recently and I felt like WHY DID NOBODY TELL ME ABOUT THIS BEFORE?!?! So I’m telling you about it in case you’re in the same boat as I was. <strong><a href="https://news.ycombinator.com/item?id=23698305">ENTR</a>,&nbsp;7</strong></p></section><section><img src="https://d2r55xnwy6nx47.cloudfront.net/uploads/2020/06/Chirality_1200_Social.jpg"><h2><a href="https://www.quantamagazine.org/cosmic-rays-may-explain-lifes-bias-for-right-handed-dna-20200629/">Cosmic Rays May Explain Life’s Bias for Right-Handed DNA</a></h2><p><code>quantamagazine.org</code> — If you could shrink small enough to descend the genetic helix of any animal, plant, fungus, bacterium or virus on Earth as though it were a spiral staircase, you would always find yourself turning right — never left. It’s a universal trait in want of an explanation. <strong><a href="https://news.ycombinator.com/item?id=23688535">EXPLAIN</a>,&nbsp;8</strong></p></section><section><img src="https://linear.app/static/metaImage4.jpg"><h2><a href="http://linear.app/">Linear – A fast issue tracker</a></h2><p><code>linear.app</code> — Linear helps streamline software projects, sprints, tasks, and bug tracking. It's built for high-performance teams. <strong><a href="https://news.ycombinator.com/item?id=23693029">TRACKER</a>,&nbsp;9</strong></p></section><section><h2><a href="http://antirez.com/news/133">The End of the Redis Adventure</a></h2><p><code>antirez.com</code> —  The end of the Redis adventureantirez 22 hours ago. 228076 views. When I started the Redis project more than ten years ago I was in one of the most exciting moments of my career. My co-founder and I had successfully launched two of the major web 2.0 services of the Italian web. In order to make them scalable we had to invent many new concepts, that were already known in the field most of the times, but we didn’t know, nor we cared to check. Problem? Let’s figure out a solution. We wanted to solve problems but we wanted, even more, to have fun. This was the playful environment where Redis was born. But now Redis is, incredibly, one of the main parts of so many things. And year after year my work changed from building this thing to making sure that it was also as useful as possible, as reli... <strong><a href="https://news.ycombinator.com/item?id=23689549">ADVENTURE</a>,&nbsp;10</strong></p></section><section><img src="https://oup.silverchair-cdn.com/UI/app/svg/pdf.svg"><h2><a href="https://academic.oup.com/mnras/article/496/2/1902/5863970">The possible disappearance of a massive star in the galaxy PHL 293B</a></h2><p><code>oup.com</code> — Andrew P Allan, Jose H Groh, Andrea Mehner, Nathan Smith, Ioana Boian, Eoin J Farrell, Jennifer E Andrews, The possible disappearance of a massive star in the low-metallicity galaxy PHL 293B, Monthly Notices of the Royal Astronomical Society, Volume 496, Issue 2, August 2020, Pages 1902–1908, https://doi.org/10.1093/mnras/staa1629 <strong><a href="https://news.ycombinator.com/item?id=23688850">DISAPPEARANCE</a>,&nbsp;11</strong></p></section><section><h2><a href="http://tylerneylon.com/a/learn-lua/">Learn Lua in 15 Minutes (2013)</a></h2><p><code>tylerneylon.com</code> —   Learn Lua in 15 Minutes       -- Two dashes start a one-line comment. --[[ Adding two ['s and ]'s makes it a multi-line comment. --]] ---------------------------------------------------- -- 1. Variables and flow control. ---------------------------------------------------- num = 42 -- All numbers are doubles. -- Don't freak out, 64-bit doubles have 52 bits for -- storing exact int values; machine precision is -- not a problem for ints that need &lt; 52 bits. s = 'walternate' -- Immutable strings like Python. t = "double-quotes are also fine" u = [[ Double brackets start and end multi-line strings.]] t = nil -- Undefines t; Lua has garbage collection. -- Blocks are denoted with keywords like do/end: while num &lt; 50 do num = num + 1 -- No ++ or += type operators. end -- If clauses: if num &gt; 40... <strong><a href="https://news.ycombinator.com/item?id=23694667">LUA</a>,&nbsp;12</strong></p></section><section><img src="https://research.fb.com/wp-content/uploads/2020/06/Holographic-optics_1.jpg"><h2><a href="https://research.fb.com/blog/2020/06/holographic-optics-for-thin-and-lightweight-virtual-reality/">Holographic optics for thin and lightweight virtual reality</a></h2><p><code>fb.com</code> — Facebook Reality Labs (FRL) is always exploring new optical architectures to improve form factor, comfort, and optical performance. Last fall, at Oculus Connect 6, FRL Chief Scientist Michael Abrash introduced new miniaturization progress in VR with Half Dome 2 and 3, two prototypes that examine how varifocal displays can improve visual and physical comfort. This year, at the virtual SIGGRAPH conference, we’re presenting another research milestone on this path: a new optical architecture that is significantly more compact and offers the potential for better visual performance. <strong><a href="https://news.ycombinator.com/item?id=23692442">HOLOGRAPHIC</a>,&nbsp;13</strong></p></section><section><img src="https://dl.acm.org/pb-assets/icons/ACM-DL-Logo-white-1519079037293.png"><h2><a href="https://dl.acm.org/doi/10.1145/357353.357355">Implementing atomic actions on decentralized data (1983)</a></h2><p><code>acm.org</code> — We use cookies to ensure that we give you the best experience on our website. <strong><a href="https://news.ycombinator.com/item?id=23688023">ATOMIC</a>,&nbsp;14</strong></p></section><section><img src="https://cdn.substack.com/image/fetch/w_256,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc21d3e2d-bc9d-401f-bbe8-225d0d0643d9_256x256.png"><h2><a href="https://codefaster.substack.com/p/mastering-jq-part-1-59c">Mastering Jq: Part 1</a></h2><p><code>substack.com</code> — This is the first part of an ongoing series on mastering jq. This series does not assume prior experience with jq, but it does assume basic fluency in shell programming. <strong><a href="https://news.ycombinator.com/item?id=23694908">MASTERING</a>,&nbsp;15</strong></p></section><section><img src="http://dgn0b0vubo9qr.cloudfront.net/wp-content/uploads/2013/01/math.png"><h2><a href="https://skibinsky.com/godel-incompleteness-for-startups/">Gödel Incompleteness for Startups (2013)</a></h2><p><code>skibinsky.com</code> — Every year a few thousand startups are incubated in Silicon Valley. Few of them will succeed; the rest will decay or outright fail. Yet there always seems to be room for one more billion-dollar company. Besides appearing seemingly out of nowhere, the most radically successful startups are also the most unpredictable ones. What force seems to create these massive sources of wealth that initially look like “bad ideas” to everybody beside their founders? <strong><a href="https://news.ycombinator.com/item?id=23687846">GÖDEL</a>,&nbsp;16</strong></p></section><section><img src="https://yoga.dev/images/greppy1tlb_300px.jpg"><h2><a href="https://yoga.dev/timeshared-robots/">Show HN: Program “Greppy”, a 2-wheeled robot, using a new robotics language</a></h2><p><code>yoga.dev</code> — I’ve been wanting to do a Show HN for my robotics developer tool Yoga Studio for a while. But given that: <strong><a href="https://news.ycombinator.com/item?id=23696193">GREPPY</a>,&nbsp;17</strong></p></section><section><img src="https://corte.si/posts/code/genzoo/representative_image_512x256.png"><h2><a href="https://corte.si/posts/code/genzoo/">Generative Zoology with Neural Networks</a></h2><p><code>corte.si</code> — A couple of years ago a paper titled Progressive Growing of GANs for Improved Quality, Stability, and Variation cropped up on my reading list. It describes growing generative adversarial networks progressively, starting with low-resolution images, and then building up more detail as training goes on. It got quite a bit of press at the time because the authors used their idea to generate realistic, unique images of human faces. <strong><a href="https://news.ycombinator.com/item?id=23688785">ZOOLOGY</a>,&nbsp;18</strong></p></section><section><img src="https://images.unsplash.com/photo-1534196355937-f3d8b0cae922?ixlib=rb-1.2.1&amp;ixid=eyJhcHBfaWQiOjEyMDd9&amp;auto=format&amp;fit=crop&amp;w=1568&amp;q=80"><h2><a href="https://blog.phuaxueyong.com/post/2020-06-27-how-did-this-start/">What can you learn by writing as a developer</a></h2><p><code>phuaxueyong.com</code> — What is your story? How did you start writing your blog? Was it something that you decided to try since the start of covid? Over the months I’ve started to post some of the learning and technology I’ve came across at work. Over the months of writing, I found myself gaining so much more than what I started out to do. Everything starts with a single step. Before we take our first step, we often have a vision of how that finishing line may look like. We may also have some perspective of how the journey itself may look like. What do you know? As you take a step forward, and then another. You decide to take a pause and look back. You find your perspective of the world has changed just so much! <strong><a href="https://news.ycombinator.com/item?id=23689273">WRITING</a>,&nbsp;19</strong></p></section><section><img src="https://marcobonvini.com/images/posts/hybrid-car-scheme.png"><h2><a href="https://marcobonvini.com/modelica/2020/06/29/all-about-modelica.html">All about Modelica: An equation-based language for modeling physical systems</a></h2><p><code>marcobonvini.com</code> —  by Marco Bonvini on Monday June 29, 2020  <strong><a href="https://news.ycombinator.com/item?id=23690788">MODELICA</a>,&nbsp;20</strong></p></section><section><img src="http://s0.wp.com/latex.php?latex=+%5Cnabla+%5Ccdot+E+%3D+%5Cfrac%7B%5Crho%7D%7B%5Cepsilon_0%7D+%5Chspace%7B2cm%7D+%5Cnabla+%5Ctimes+E%2B%5Cfrac%7B%5Cpartial+B%7D%7B%5Cpartial+t%7D+%3D+0++&amp;bg=ffffff&amp;fg=000000&amp;s=0"><h2><a href="http://www.michaelnielsen.org/ddi/lisp-as-the-maxwells-equations-of-software/">Lisp as the Maxwell’s Equations of Software (2012)</a></h2><p><code>michaelnielsen.org</code> — On my first day of physics graduate school, the professor in my class on electromagnetism began by stepping to the board, and wordlessly writing four equations: <strong><a href="https://news.ycombinator.com/item?id=23687904">MAXWELL</a>,&nbsp;21</strong></p></section><section><img src="http://2.bp.blogspot.com/-7bZ5EziliZQ/VynIS9F7OAI/AAAAAAAASQ0/BJFntXCAntstZe6hQuo5KTrhi5Dyz9yHgCK4B/s1600/googlelogo_color_200x200.png"><h2><a href="https://security.googleblog.com/2020/06/system-hardening-in-android-11.html">System Hardening in Android 11</a></h2><p><code>googleblog.com</code> — In Android 11 we continue to increase the security of the Android platform. We have moved to safer default settings, migrated to a hardened memory allocator, and expanded the use of compiler mitigations that defend against classes of vulnerabilities and frustrate exploitation techniques.  <strong><a href="https://news.ycombinator.com/item?id=23692257">HARDENING</a>,&nbsp;22</strong></p></section><section><img src="https://www.sapiens.org/wp-content/uploads/2020/05/01_10826711853_3fb64cfd08_k-1200x628.jpg"><h2><a href="https://www.sapiens.org/archaeology/easter-island-collapse/">Rethinking Easter Island’s Historic “Collapse”</a></h2><p><code>sapiens.org</code> — Controversial new archaeological research casts doubt on a classic theory of this famous island's societal collapse. <strong><a href="https://news.ycombinator.com/item?id=23682706">EASTER</a>,&nbsp;23</strong></p></section><section><img src="https://www.deepsouthventures.com/wp-content/uploads/yellowstone-roughriders-3.jpg"><h2><a href="https://www.deepsouthventures.com/must-ride-mule-to-from-work-location/">Must ride mule to and from work location</a></h2><p><code>deepsouthventures.com</code> — “David, this one, tell me about it …” <strong><a href="https://news.ycombinator.com/item?id=23690922">MULE</a>,&nbsp;24</strong></p></section><section><h2><a href="https://www.reuters.com/article/us-cisco-lawsuit/california-accuses-cisco-of-job-discrimination-based-on-indian-employees-caste-idUSKBN2423YE">California accuses Cisco of job discrimination based on Indian employee's caste</a></h2><p><code>reuters.com</code> — OAKLAND, Calif. (Reuters) - California regulators sued Cisco Systems Inc (CSCO.O) on Tuesday, accusing it of discriminating against an Indian-American employee and allowing him to be harassed by two managers because he was from a lower Indian caste than them.  <strong><a href="https://news.ycombinator.com/item?id=23697083">ACCUSES</a>,&nbsp;25</strong></p></section><section><img src="https://dev.solita.fi/img/solita-logomark-white-on-red-400px.png"><h2><a href="https://dev.solita.fi/2020/06/25/taming-cljs-advanced-compilation.html">Taming Advanced Compilation bugs in ClojureScript projects</a></h2><p><code>solita.fi</code> — Imagine this: You have a large multi-module ClojureScript project, and you are planning to make a new deployment in the production. Your project is using CLJS Compiler’s Advanced Optimizations mode. Everything seems to be working smoothly. You are performing some last E2E tests before making a release. Then, a faulty module loads. BAM! You are slapped in the face with an error something like this: <strong><a href="https://news.ycombinator.com/item?id=23688721">TAMING</a>,&nbsp;26</strong></p></section><section><img src="https://www.rd.com/wp-content/uploads/2020/06/Rachael-Antarctica-3-Courtesy-Rachael-Robertson.jpg"><h2><a href="https://www.rd.com/article/isolated-for-a-year-in-antarctica/">Returning from a Year of Isolation in Antarctica</a></h2><p><code>rd.com</code> — My journey to isolation in Antarctica was somewhat accidental. I saw an advertisement in a print publication for a job as a station leader for an expedition to Davis Station, Antarctica—and I have to confess, it was the penguin in the ad that caught my attention. The ad noted that they could “teach Antarctica” but were looking for someone with resilience, empathy, and integrity to lead a diverse team of multiskilled expeditioners on a wide range of science, infrastructure, and logistics programs in one of the most remote, isolated, and beautiful places on the planet. I went to the job interview mostly interested in discovering the questions they would ask to find empathy. I was then sent to boot camp with 13 men competing for a job that I didn’t even really want but knew I would regret if I didn’t go for it. <strong><a href="https://news.ycombinator.com/item?id=23675364">ISOLATION</a>,&nbsp;27</strong></p></section><section><h2><a href="https://news.ycombinator.com/item?id=23675370">Ask HN: How to improve my abstract thinking?</a></h2><p><code>news.ycombinator.com</code> — A few days ago I got into Mathematical Logic[0] and learned how to reason about problems through using various branches of mathematical ideas like proof theory, model theory e.t.c. <strong><a href="https://news.ycombinator.com/item?id=23675370">ABSTRACT</a>,&nbsp;28</strong></p></section><section><img src="https://images.anandtech.com/doci/15888/12_678x452.jpg"><h2><a href="https://www.anandtech.com/show/15888/400-tb-storage-drives-in-our-future-fujifilm">400 TB Storage Drives in Our Future: Fujifilm</a></h2><p><code>anandt…</code></p></section></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://www.wolfgangfaust.com/project/paper-hn/">https://www.wolfgangfaust.com/project/paper-hn/</a></em></p>]]>
            </description>
            <link>https://www.wolfgangfaust.com/project/paper-hn/</link>
            <guid isPermaLink="false">hacker-news-small-sites-23669650</guid>
            <pubDate>Sun, 28 Jun 2020 16:00:49 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Speeding up function calls with lru_cache in Python]]>
            </title>
            <description>
<![CDATA[
Score 122 | Comments 79 (<a href="https://news.ycombinator.com/item?id=23668914">thread link</a>) | @Immortal333
<br/>
June 28, 2020 | https://hackeregg.github.io/2020/06/03/Speeding-up-function-calls-with-just-one-line-in-Python.html | <a href="https://web.archive.org/web/*/https://hackeregg.github.io/2020/06/03/Speeding-up-function-calls-with-just-one-line-in-Python.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
      

      <section itemprop="text">
        
          
        
        <p>One line summary: Use <a href="https://docs.python.org/3/library/functools.html#functools.lru_cache">lru_cache decorator</a></p>

<h3 id="caching">Caching</h3>

<p>If we’re calling expensive functions in the program very frequently, It’s best to save the result of a function call and use it for future purposes rather than calling function every time. This will generally speed up the execution of the program.</p>
<blockquote>
  <p>The expensiveness of function can be in terms of computational (CPU usage) or latency (disk read, fetching a resource from the network).</p>
</blockquote>

<p>The saving result of function calls is generally referred to as caching. The naive way to do caching is to store every function calls. But, this doesn’t scale very well with the number of parameters of function and range of each parameter.</p>

<p>So, we need a smart way to do caching with a fixed amount of memory. And, there are plenty of <a href="https://en.wikipedia.org/wiki/Cache_replacement_policies">caching strategies available</a> depending upon what type of information is available to us.</p>

<blockquote>
  <p>Caching is heavily used in plenty of areas from low-level (hardware/CPU) to high level (network/CDNs).</p>
</blockquote>

<p>In most of the languages, We will choose caching strategies of our choice and implement them using a few data structures (hashmap, priority queue). Depending upon the language, It might take as little as few minutes to few hours to implement the generic solution of our need.</p>

<p>But, Python’s standard library <a href="https://docs.python.org/3/library/functools.html">functools</a> already comes with one strategy of caching called <a href="https://docs.python.org/3/library/functools.html#functools.lru_cache">LRU(Least Recently Used)</a>. Thanks to <a href="https://wiki.python.org/moin/PythonDecorators">decorators</a> in python, It only takes one line to integrate into the existing codebase</p>

<h3 id="basic-recursive-implementation-of-fibonacci-numbers">Basic Recursive Implementation of <a href="https://en.wikipedia.org/wiki/Fibonacci_number">Fibonacci numbers</a></h3>

<div><div><pre><code><span>import</span> <span>time</span> <span>as</span> <span>tt</span>

<span>def</span> <span>fib</span><span>(</span><span>n</span><span>):</span>
  <span>if</span> <span>n</span> <span>&lt;=</span> <span>1</span><span>:</span>
    <span>return</span> <span>n</span>
  <span>return</span> <span>fib</span><span>(</span><span>n</span><span>-</span><span>1</span><span>)</span> <span>+</span> <span>fib</span><span>(</span><span>n</span><span>-</span><span>2</span><span>)</span>

<span>t1</span> <span>=</span> <span>tt</span><span>.</span><span>time</span><span>()</span>
<span>fib</span><span>(</span><span>30</span><span>)</span>
<span>print</span> <span>(</span><span>f"Time taken: </span><span>{</span><span>tt</span><span>.</span><span>time</span><span>()</span> <span>-</span> <span>t1</span><span>}</span><span>"</span><span>)</span>

<span># Output : 
# Time taken: 0.3209421634674072
</span></code></pre></div></div>

<h3 id="speeding-up-recursive-implementation-with-lru">Speeding Up Recursive Implementation with LRU</h3>
<div><div><pre><code><span>import</span> <span>time</span> <span>as</span> <span>tt</span>
<span>import</span> <span>functools</span>

<span># saving all function calls
</span><span>@</span><span>functools</span><span>.</span><span>lru_cache</span><span>(</span><span>maxsize</span><span>=</span><span>31</span><span>)</span>
<span>def</span> <span>fib</span><span>(</span><span>n</span><span>):</span>
  <span>if</span> <span>n</span> <span>&lt;=</span> <span>1</span><span>:</span>
    <span>return</span> <span>n</span>
  <span>return</span> <span>fib</span><span>(</span><span>n</span><span>-</span><span>1</span><span>)</span> <span>+</span> <span>fib</span><span>(</span><span>n</span><span>-</span><span>2</span><span>)</span>

<span>t1</span> <span>=</span> <span>tt</span><span>.</span><span>time</span><span>()</span>
<span>fib</span><span>(</span><span>30</span><span>)</span>
<span>print</span> <span>(</span><span>f"Time taken: </span><span>{</span><span>tt</span><span>.</span><span>time</span><span>()</span> <span>-</span> <span>t1</span><span>}</span><span>"</span><span>)</span>
<span>print</span> <span>(</span><span>fib</span><span>.</span><span>cache_info</span><span>())</span>


<span># Output :
# Time taken: 1.7881393432617188e-05
# CacheInfo(hits=28, misses=31, maxsize=31, currsize=31)
</span></code></pre></div></div>

<p>In this example, we have saved all function calls. But, We know that Fibonacci can be implemented using <a href="https://en.wikipedia.org/wiki/Dynamic_programming">DP</a>.</p>

<h3 id="iterative-implementation-of-fibonacci">Iterative implementation of Fibonacci</h3>

<div><div><pre><code><span>import</span> <span>time</span> <span>as</span> <span>tt</span>

<span>def</span> <span>fib_iterative</span><span>(</span><span>n</span><span>):</span>
  <span>if</span> <span>n</span> <span>&lt;=</span> <span>1</span><span>:</span>
    <span>return</span> <span>n</span>
  <span>f</span><span>,</span> <span>s</span> <span>=</span> <span>0</span><span>,</span> <span>1</span>
  <span>for</span> <span>i</span> <span>in</span> <span>range</span><span>(</span><span>n</span><span>-</span><span>1</span><span>):</span>
    <span>t</span> <span>=</span> <span>f</span> <span>+</span> <span>s</span>
    <span>f</span><span>,</span> <span>s</span> <span>=</span> <span>s</span><span>,</span> <span>t</span>
  <span>return</span> <span>t</span>

<span>t1</span> <span>=</span> <span>tt</span><span>.</span><span>time</span><span>()</span>
<span>fib_iterative</span><span>(</span><span>30</span><span>)</span>
<span>print</span> <span>(</span><span>f"Time taken: </span><span>{</span><span>tt</span><span>.</span><span>time</span><span>()</span> <span>-</span> <span>t1</span><span>}</span><span>"</span><span>)</span>

<span># Output:
# Time taken: 5.0067901611328125e-06
</span></code></pre></div></div>

<h3 id="different-cache-size">Different Cache size</h3>

<div><div><pre><code><span>import</span> <span>time</span> <span>as</span> <span>tt</span>
<span>import</span> <span>functools</span>

<span>def</span> <span>lru_size</span><span>(</span><span>max_lru</span><span>):</span>
    <span>@</span><span>functools</span><span>.</span><span>lru_cache</span><span>(</span><span>maxsize</span><span>=</span><span>max_lru</span><span>,</span> <span>typed</span><span>=</span><span>False</span><span>)</span>
    <span>def</span> <span>fib_lru</span><span>(</span><span>n</span><span>):</span>
        <span>if</span> <span>n</span> <span>&lt;=</span> <span>1</span><span>:</span>
            <span>return</span> <span>n</span>
        <span>return</span> <span>fib_lru</span><span>(</span><span>n</span><span>-</span><span>1</span><span>)</span> <span>+</span> <span>fib_lru</span><span>(</span><span>n</span><span>-</span><span>2</span><span>)</span>
    <span>return</span> <span>fib_lru</span>

<span>for</span> <span>i</span> <span>in</span> <span>[</span><span>1</span><span>,</span> <span>2</span><span>,</span> <span>5</span><span>,</span> <span>10</span><span>,</span> <span>31</span><span>]:</span>
    <span>t1</span> <span>=</span> <span>tt</span><span>.</span><span>time</span><span>()</span>
    <span>fib</span> <span>=</span> <span>lru_size</span><span>(</span><span>i</span><span>)</span>
    <span>fib</span><span>(</span><span>10</span><span>)</span>
    <span>print</span> <span>(</span><span>f"LRU size: </span><span>{</span><span>i</span><span>}</span><span> Time taken: </span><span>{</span><span>tt</span><span>.</span><span>time</span><span>()</span> <span>-</span> <span>t1</span><span>}</span><span>"</span><span>)</span>
    <span>print</span> <span>(</span><span>fib</span><span>.</span><span>cache_info</span><span>())</span>

<span># Output:
# LRU size: 1 Time taken: 0.6930997371673584
# CacheInfo(hits=0, misses=2692537, maxsize=1, currsize=1)
# LRU size: 2 Time taken: 0.012731075286865234
# CacheInfo(hits=8656, misses=41641, maxsize=2, currsize=2)
# LRU size: 5 Time taken: 5.817413330078125e-05
# CacheInfo(hits=28, misses=31, maxsize=5, currsize=5)
# LRU size: 10 Time taken: 3.9577484130859375e-05
# CacheInfo(hits=28, misses=31, maxsize=10, currsize=10)
# LRU size: 31 Time taken: 3.504753112792969e-05
# CacheInfo(hits=28, misses=31, maxsize=31, currsize=31)
</span></code></pre></div></div>

<p>As, <strong>we can see the optimal cache size of fib function is 5</strong>. Increasing cache size will not result in much gain in terms of speedup.</p>

<h3 id="important-note">Important Note</h3>

<p>I strictly suggest to use lru decorator in only deterministic functions.</p>

<h4 id="deterministic-functions">Deterministic Functions</h4>
<blockquote>
  <p>In computer science, a deterministic algorithm is an algorithm which, given a particular input, will always produce the same output, with the underlying machine always passing through the same sequence of states. Deterministic algorithms are by far the most studied and familiar kind of algorithm, as well as one of the most practical, since they can be run on real machines efficiently.</p>

  <p>– Wikipedia</p>
</blockquote>

<p>Because,</p>

<blockquote>
  <p>There are only two hard things in Computer Science: cache invalidation and naming things.</p>

  <p>– Phil Karlton</p>
</blockquote>

        
      </section>

      

      


      
  

    </div></div>]]>
            </description>
            <link>https://hackeregg.github.io/2020/06/03/Speeding-up-function-calls-with-just-one-line-in-Python.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-23668914</guid>
            <pubDate>Sun, 28 Jun 2020 14:29:26 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Show HN: Promnesia – an attempt to fix broken web history]]>
            </title>
            <description>
<![CDATA[
Score 212 | Comments 52 (<a href="https://news.ycombinator.com/item?id=23668507">thread link</a>) | @karlicoss
<br/>
June 28, 2020 | https://beepb00p.xyz/promnesia.html | <a href="https://web.archive.org/web/*/https://beepb00p.xyz/promnesia.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article>
    
    <section>
    
    <p>A journey in fixing browser history
    </p></section>
    <!-- are sections appropriate for that? -->

    <section>
    <p>
Promnesia is a browser extension (Chrome/Firefox/Firefox mobile) that serves as a web surfing copilot
by enhancing your browsing history, improving your web exploration experience, and integrating with your knowledge base.
</p>
<p>
<a href="https://github.com/karlicoss/promnesia#readme">The repository</a> contains more information about the project and the setup guide, this post is more about the motivation and the story of what led me to work on it.
</p>
<p>
Also, you can quickly skim through the <a href="https://github.com/karlicoss/promnesia#demos">demos</a> first before reading, if you prefer!
</p>

<div>
<h2 id="singularity_when"><a href="#singularity_when">¶</a><span>1</span> I want my singularity!</h2>
<div id="text-singularity_when">
<p>
I was raised on science fiction and grew up dreaming about technology drastically changing our lives.
Artificial intelligence, augmenting the brain with a math co-processor, head-up displays, neural interfaces, having perfect reaction and memory – many of you are on the same page and know the drill.
</p>
<p>
Years passed, I became a software engineer, and realized just how far we are from all these fancy technologies I wanted.
So my aspirations have become more modest, and I've chosen a more realistic and plausible target:
using my digital trace (such as browser history, webpage annotations and my <a href="https://beepb00p.xyz/tags.html#exobrain">personal wiki</a>) to make up for my limited memory.
</p>
<p>
I'm exploring lots of information on the Internet, and it feels wasteful to use my <a href="https://beepb00p.xyz/tags.html#meatsack">meat resources</a> to keep track of it.
Meanwhile, web browsers keep a record automatically, without any manual and conscious effort.
Surely we can benefit from the immense computing power and memory capabilities of computers?
</p>
<p>
So I figured that I wanted:
</p>
</div>
</div>
<div>
<h2 id="what_i_want"><a href="#what_i_want">¶</a><span>2</span> Ok, maybe a web assistant at least?</h2>
<div id="text-what_i_want">
<p>
A web surfing companion. A copilot.
A <a href="https://en.wikipedia.org/wiki/Memex">Memex</a>.
A <a href="http://alumni.media.mit.edu/~rhodes/Papers/remembrance.html">Remembrance Agent</a>?
</p>
<p>
Call it whatever you like, I <i>wish</i> it were a concept with a widely accepted name. Something that will sit in my browser and:
</p>
<ul>
<li><p>
aid me with <b>information processing</b>
</p>
<p>
Keep track of what I've read, when, on which device, and for how long.
</p></li>
<li><p>
show me my <b>annotations and highlights</b>, within the original page
</p>
<p>
I don't want to keep wondering whether I have my notes and thoughts stashed in some app, I want the computer to let me know instead.
</p></li>
<li><p>
unify my <b>scattered and siloed bookmarks</b>
</p>
<p>
Firefox bookmarks; Reddit/Hackernews saves; "Watch later" on Youtube, saved links in my instant messenger.
</p>
<p>
These are the same damn thing, yet there is no way to oversee and process them through a single interface.
</p>
<p>
<a href="https://jborichevskiy.com/posts/digital-tools/#queue-management-for-inbound-digital-content">"Queue management for inbound digital content"</a>:
a post expanding further on this idea.
</p></li>
<li><p>
connect with my online presence: chats and social networks
</p>
<p>
If I tweeted about a page, surely this should be somehow recorded in the browsing history?
</p>
<p>
In fact, the page that I bothered to tweet about is <b>much</b> more important than a page I merely visited in the browser.
</p></li>
<li><p>
help me explore new information and <b>prioritize</b> it
</p>
<p>
There is so much awesome stuff on the Internet! The biggest problem I have is picking the next cool link to dig into.
</p>
<p>
Imagine if in one click, I could see which of my friends, or the people I follow have read a certain link.
What did they think? Have they posted about it, annotated, or something else? Do they follow the author, perhaps I should too?
</p></li>
<li><p>
bridge the gap between the browser and my <a href="https://beepb00p.xyz/tags.html#exobrain">personal wiki</a>
</p>
<p>
Whatever product I choose for managing my notes: Google Keep, Evernote, Roam Research, or even org-mode files on my disk,
they always end up <b>isolated and disconnected</b> from my web browsing.
</p></li>
</ul>
<p>
I searched for a system like this <a href="https://twitter.com/karlicoss/status/767412935316611072">for</a> several <a href="https://twitter.com/karlicoss/status/896313846159298560">years</a>.
</p>
<p>
After enough failed attempts at finding an <a href="#prior_art">existing solution</a>, I figured it was going to be yet another thing I'd have to implement myself.
</p>
<p>
The journey of building it took longer than I expected, led me through a rabbit hole of <a href="https://beepb00p.xyz/tags.html#dataliberation">data liberation</a>, lots of <a href="https://en.wiktionary.org/wiki/yak_shaving">yak shaving</a>,
and made me realize: <b>browser history is very, very broken</b>.
</p>
<p>
Note: the next two sections are (somewhat technical) rants. If you prefer a more positive/less boring agenda, feel free to skip them straight to <a href="#prior_art">"Existing solutions"</a>
, and you can return back later if you feel like it.
</p>
</div>
</div>
<div>
<h2 id="history_broken"><a href="#history_broken">¶</a><span>3</span> Browser history is broken</h2>
<div id="text-history_broken">
<p>
To a large extent, URLs express <b>relationships and hierarchy</b> between the bits of information. For example:  <code>blog &lt;-&gt; post &lt;-&gt; comment</code>, <code>person &lt;-&gt; tweet</code>, <code>playlist &lt;-&gt; video</code>.
</p>
<p>
With this information you should be easily able to find everything relevant to the current page and trace your jumps through past websites.
Merely by looking at URLs, without "AI" or some dubious machine learning algorithm!
Seems like a low hanging fruit to harvest, right?
</p>
<p>
Web browser history is a rich source of potentially useful information.
Just think about it: it's zero effort <a href="https://beepb00p.xyz/tags.html#lifelogging">lifelogging</a>.
It contains exact timestamps and links which <i>basically</i> address information.
</p>
<p>
Now think about the experience you actually have. What was the last time you used the browser history in any nontrivial way, for something other than reopening an accidentally closed tab?
</p>
<p>
Besides:
</p>
</div>
<div>
<h3 id="not_just_browser"><a href="#not_just_browser">¶</a>it's not just about web browsers</h3>
<div id="text-not_just_browser">
<div><p><span>
When you're using a native phone app (say, for Reddit or Twitter), your history either isn't logged anywhere or if it is, it's only stored locally on your phone.

</span></p></div>
<div><p><span>
On Android, it's likely to be in an Sqlite database in <code>/data/data/app.name</code>.
This directory is not accessible to normal users <b>unless your phone is rooted</b>.
Just think about how ridiculous this is. It's <b>your own data</b>, yet your OS babysits you, preventing access to it.

And yes, I know sandboxing and security are important, but locking my data inside the app is hardly an acceptable tradeoff.
</span></p></div>
<p>
As a specific example, the <a href="https://github.com/ccrama/Slide">Reddit Slide</a> app keeps your view history in <code>/data/data/me.ccrama.redditslide/SEEN</code>.
Okay, say you root your phone and access the database. Turns out the the app isn't persisting the data forever, it's merely keeping a few weeks' cache.
And I can hardly blame the developer for this: because of the data model, no one expects regular users to access this database.
</p>
<p>
So if you want your complete history, you have to backup this database regularly, keep the snapshots and <a href="https://beepb00p.xyz/exports.html#synthetic">somehow</a>
reconstruct it.
</p>
<p>
You may dismiss this as nitpicking and obsession over every last bit of my data.
But when <b>all</b> of your phone apps are doing this you're missing out on quite a lot of useful information.
</p>
</div>
</div>
<div>
<h3 id="siloed"><a href="#siloed">¶</a>it's scattered and siloed</h3>
<div id="text-siloed">
<p>
Building on the previous point:
</p>
<ul>
<li>for the most part, you can't access history in your phone apps</li>
<li>lots of data which <i>ought</i> to be counted as web history is scattered across silos

<ul>
<li><div><p><span>in the cloud: behind APIs (best case), GDPR and manual exports (worst case)

It is never easy to get hands on, <i>even</i> if you're an experienced software engineer.</span></p></div></li>
<li><p>
on the filesystem, for example in markdown/org-mode files
</p>
<p>
A slightly better scenario, but as far as the web browser is concerned, it doesn't make any difference.
</p></li>
</ul></li>
</ul>
<p>
Even <i>regular</i> browser history is not easy to get:
</p>
<ul>
<li>Firefox <a href="https://support.mozilla.org/en-US/questions/1080942">used to</a> silently 'expire' your browser history</li>
<li><p>
Chrome deletes history older than <a href="https://superuser.com/a/364475/300795">90 days</a>
</p>
<p>
The only way to access older history I'm aware of is <a href="https://myactivity.google.com/">Google Activity</a> and Takeout.
</p></li>
<li>Google Takeout <a href="https://beepb00p.xyz/takeout-data-gone.html">quietly recycles your history</a></li>
<li><p>
Migration is limited to the most popular browsers
</p>
<p>
The retention limits the migration as well.
E.g. if you migrate from Chrome to Firefox, history older than 90 days is locked and siloed in your Google Account.
</p></li>
<li><p>
You're going to have a hard time if you're not using Google/Mozilla sync
</p>
<p>
Your history will be scattered across devices and lost on OS reinstalls.
</p>
<p>
There are ways of self-hosting Firefox sync, and (<a href="https://superuser.com/questions/614744/how-to-set-up-a-own-chrome-sync-server">allegedly</a>) even Chrome sync,
but as you can imagine, is quite tedious.
</p></li>
</ul>
</div>
</div>
<div>
<h3 id="significance"><a href="#significance">¶</a>it's got varying significance</h3>
<div id="text-significance">
<p>
Not all links in your history are equally important:
</p>
<ul>
<li>some are clicked on by accident</li>
<li>some you've just skimmed</li>
<li>some are on your reading list</li>
<li>some you've been reading for hours and are full of your highlights and annotations</li>
<li>some you reference in your knowledge base/personal wiki</li>
<li>some of them you've shared with others on social media</li>
</ul>
<p>
The current browser history experience makes no distinction between these scenarios.
</p>
</div>
</div>
</div>
<div>
<h2 id="urls_broken"><a href="#urls_broken">¶</a><span>4</span> URLs are broken</h2>
<div id="text-urls_broken">
<p>
This topic probably deserves a separate post, but I'll keep it section-sized for now.
</p>
<p>
URLs might seem great because they mostly address content and are semi-descriptive: people <i>try</i> to keep URLs somewhat reasonable, tidy and working.
But in the real world:
</p>
<ul>
<li><p>
links <b>rot</b>
</p>
<p>
Many URLs are <a href="https://www.gwern.net/Archiving-URLs#link-rot"><b>literally</b> broken</a>.
We're lucky to have <a href="https://web.archive.org/">archive.org</a>, so you can at least access dead pages.
</p>
<p>
But there is no way to migrate your browser history, e.g. point old URLs to their respective archive.org entries or a new domain.
Similarly if you had the page annotated, your annotations become orphans without an easy way to relink them.
</p></li>
<li><p>
links are <b>obfuscated</b> by shortening and redirects
</p>
<div><p><span>
What happens to all the <code>t.co</code> links when Twitter as a service dies?

</span></p></div></li>
<li><p>
links are <b>obscured</b>
</p>
<p>
There is no easy way to know what's behind <code>https://www.instapaper.com/read/1265139707</code> without querying the Instapaper API.
</p>
<p>
Relations between data are often obscured as well. For example:
</p>
<ul>
<li><code>https://news.ycombinator.com/item?id=22918980</code> is a submission link</li>
<li><code>https://news.ycombinator.com/item?id=22919718</code> is a comment to that submission</li>
</ul>
<p>
These links are clearly related, but there is no way to tell it just from <samp>id</samp>.
</p>
<p>
Compare this to Reddit links:
</p>
<ul>
<li><code>https://reddit.com/r/orgmode/comments/g6ejwe/is_there_an_orgmode_workbook_tutorial_that_is</code> is a post link</li>
<li><code>https://reddit.com/r/orgmode/comments/g6ejwe/is_there_an_orgmode_workbook_tutorial_that_is/fo9qnen</code> is a comment to that post</li>
</ul>
<p>
The ids are obscure, but at least we can clearly see the <code>post &lt;-&gt; comment</code> relation merely by looking at the URLs.
Alas, browsers are just ignoring this useful information.
</p></li>
<li><p>
links are <b>unstandardized</b>
</p>
<p>
For example, <a href="https://en.wikipedia.org/wiki/Query_string">queries</a>
</p>
<ul>
<li>typically don't point to anything persistent and are used for querying (duh)</li>
<li>but other times they are used to address information: <code>http://wiki.c2.com/?LispLanguage</code> or <code>https://www.scottaaronson.com/blog/?p=2694</code></li>
<li>and in many cases are utter garbage used for <a href="https://en.wikipedia.org/wiki/Query_string#Tracking">tracking</a></li>
</ul>
<p>
The worst part is that these use cases overlap. For example, take a look at <code>youtube.com/watch?v=wHrCkyoe72U&amp;feature=share&amp;t…</code></p></li></ul></div></div></section></article></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://beepb00p.xyz/promnesia.html">https://beepb00p.xyz/promnesia.html</a></em></p>]]>
            </description>
            <link>https://beepb00p.xyz/promnesia.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-23668507</guid>
            <pubDate>Sun, 28 Jun 2020 13:18:14 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Controversies and Challenges in fMRI (2018)]]>
            </title>
            <description>
<![CDATA[
Score 35 | Comments 10 (<a href="https://news.ycombinator.com/item?id=23668279">thread link</a>) | @saadalem
<br/>
June 28, 2020 | http://www.thebrainblog.org/2018/12/23/twenty-six-controversies-and-challenges-in-fmri/ | <a href="https://web.archive.org/web/*/http://www.thebrainblog.org/2018/12/23/twenty-six-controversies-and-challenges-in-fmri/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article id="post-294">
	<!-- .entry-header -->

	
	
	<div>
		<h2><em><strong>•Neurovascular Coupling</strong></em><em><strong>•Draining Veins</strong></em><em><strong>•Linearity</strong></em><em><strong>•Pre-undershoot</strong></em><em><strong>•Post-undershoot</strong></em><em><strong>•Long duration</strong></em><em><strong>•Mental Chronometry</strong></em><em><strong>•Negative Signal Changes</strong></em><em><strong>•Resting state source</strong></em><em><strong>•Dead fish activation</strong></em><em><strong>•Voodoo correlations</strong></em><em><strong>•Global signal regression</strong></em><em><strong>•Motion artifacts</strong></em><em><strong>•The decoding signal</strong></em><em><strong>•non-neuronal BOLD</strong></em><em><strong>•relationship to other measures</strong></em><em><strong>•contrast: spin-echo vs gradient-echo</strong></em><em><strong>•contrast: SEEP contrast</strong></em><em><strong>•contrast: diffusion changes</strong></em><em><strong>•contrast: neuronal currents</strong></em><em><strong>•contrast: NMR phase imaging</strong></em><em><strong>•lie detection</strong></em><em><strong>•correlation ≠ connection</strong></em><em><strong>•clustering conundrum</strong></em><em><strong>•reproducibility</strong></em><em><strong>•dynamic connectivity changes</strong></em></h2>
<hr>
<h4><em><strong>This will be a chapter in my upcoming book “Functional MRI” </strong><strong>in the MIT Press Essential Knowledge Series&nbsp;</strong></em></h4>
<hr>
<p>Functional MRI is unique in that, in spite of being almost 30 years old as a method, it continues to progress in terms of sophistication of acquisition, hardware, processing, in our understanding of the signal itself. There has been no plateau in any of these areas. In fact, by looking at the literature, one gets the impression that this advancement is accelerating. Every new advance opens the potential range where it might have an impact, allowing new questions about the brain to be addressed.</p>
<p>In spite of its success – perhaps as a result of its success – it has had its share of controversies coincident with methods advancements, new observations, and novel applications. Some controversies have been more contentious than others. Over the years, I’ve been following these controversies and have at times performed research to resolve them or at least better understand them. A good controversy can help to move the field forward as it can focus and motivate groups of people to work on the issue itself, shedding a broader light on the field as these are overcome.</p>
<p>While a few of the controversies or issues of contention have been fully resolved, most remain to some degree unresolved. Understanding fMRI through its controversies allows a deeper appreciation for how the field advances as a whole – and how science really works – the false starts, the corrections, and the various claims made by those with potentially useful pulse sequences, processing methods, or applications. Below is the list of twenty-six major controversies in fMRI – in approximately chronological order.</p>
<h2>#1: The Neurovascular coupling debate.</h2>
<p>Since the late 1800’s, the general consensus, hypothesized by Roy and Sherrington in 1890 (1), was that activation-induced cerebral flow changes were driven by local changes in metabolic demand. In 1986, a publication by Fox et al. (2)challenged that view, demonstrating that with activation, localized blood flow seemingly increased beyond oxidative metabolic demand, suggesting an “uncoupling” of the hemodynamic response from metabolic demand during activation. Many, including Louis Sokolof, a well-established neurophysiologist at the National Institutes of Health, strongly debated the results. Fox nicely describes this period in history from his perspective in “The coupling controversy” (3).</p>
<p>I remember well, in the early days of fMRI, Dr. Sokolof standing up from the audience to debate Fox on several circumstances, arguing that the flow response should match the metabolic need and there should be no change in oxygenation. He argued that what we are seeing in fMRI is something other than an oxygenation change.</p>
<p>In the pre-fMRI days, I recall not knowing what direction the signal should go – as when I first laid eyes on the impactful video presented by Tom Brady during his plenary lecture on the future of MRI at the Society for Magnetic Resonance (SMR) Meeting in August of 1991, it was not clear from these time series movies of subtracted images the direction he performed the subtraction operation. Was it task minus rest or rest minus task? Did the signal go up or down with activation? I also remember very well, analyzing my first fMRI experiments, expecting to see a decrease in BOLD signal – as Ogawa, in an earlier paper(4), hypothesized that metabolic rate increases would lead to a decrease blood oxygenation thus a darkening of the BOLD signal during brain activation. Instead, all I saw were signal increases. It was Fox’s work that helped me to understand why the BOLD signal should <em>increase</em>with activation. Flow goes up and oxygen delivery exceeds metabolic need, leading to an increase in blood oxygenation.</p>
<p>While models of neurovascular coupling have improved, we still do not understand the precise need for flow increases. First, we had the “watering the whole garden to feed one thirsty flower” hypothesis which suggested that flow increases matched metabolic need for one area but since vascular control was coarse, the abundant oxygenation was delivered to a wider area than was needed, causing the increase in oxygenation. We also had the “diffusion limited” model, where it was hypothesized that in order to deliver enough oxygen to the furthest neurons from the oxygen supplying vessels, an overabundance of oxygen was needed at the vessel itself since the decrease of oxygen as it diffused from the vessel to the furthest cell was described as an exponential. &nbsp;This theory has fallen a bit from favor as the increases in CMRO<sub>2</sub>or the degree to which the diffusion of oxygen to tissue from blood is limited tend to be higher than physiologic measures. The alternative to the metabolic need hypothesis involves neurogenic “feed-forward” hypotheses – which still doesn’t get at the “why” of the flow response.</p>
<p>Currently, this is where the field stands. We know that the flow response is robust and consistent. We know that in active areas, oxygenation in healthy brains always increases, however we just don’t understand specifically why it’s necessary. Is it a neurogenic, metabolic, or some other mechanism to satisfy some evolutionary critical need that extends beyond simple need for more oxygen? We are still figuring that out. Nevertheless, it can be said that whatever the reason for this increase in flow, it is fundamentally important, as the BOLD response is stunningly consistent.</p>
<h2>#2: The Draining Vein Effect</h2>
<p>The question: “what about the draining veins?” I think was first posited at an early fMRI conference by Kamil Ugurbil of the University of Minnesota. Here and for the next several years he alerted the community to the observation that, especially at low field, draining veins are a problem as they smear and distort the fMRI signal change such that it’s hard to know specifically where the underlying neuronal activation is with a high degree of certainty. In the “20 years of fMRI: the science and the stories” special issue of NeuroImage, Ravi Menon writes a thorough narrative of the “Great brain vs vein” debate (5). &nbsp;When the first fMRI papers were published, only one, by Ogawa et al. (6), was at high field – 4 Tesla – and relatively high resolution. In Ogawa’s paper, it was shown that there was a differentiation between veins (very hot spots) and capillaries (more diffuse weaker activation in grey matter). Ravi followed this up with another paper (7)using multi-echo imaging, to show that blood in veins had an intrinsically shorter T2* decay than gray matter at 4T and appeared as dark dots in T2* weighted structural images yet appeared as bright functional hot spots in the 4T functional images. Because of the low SNR and CNR at 1.5T, allowing only the strongest BOLD effects to be seen, and because models suggested that at low field strengths, large vessels contributed the most to the signal, the field worried that all fMRI was looking at was veins – at least at 1.5T.</p>
<p>The problem of large vein effects is prevalent using standard gradient-echo EPI – even at high fields. Simply put, the BOLD signal is directly proportional to the venous blood volume contribution in each voxel. If the venous blood volume is high – as with the case of a vein filling a voxel – then the potential for high BOLD changes is high if there is a blood oxygenation change in the area. At high field, indeed, there is not much intravascular signal left in T2* weighted Gradient-echo sequences, however, the extravascular effect of large vessels still exists.&nbsp; Spin-echo sequences (sensitive to small compartments) still are sensitive to the susceptibility effects around intravascular red blood cells within large vessels – even at 7T where intravascular contribution is reduced. Even with some vein sensitivity, promising high resolution orientation column results have been produced at 7T using gradient-echo and spin-echo sequences (8). The use of arterial spin labeling has potential as a method insensitive to large veins, although the temporal efficiency, intrinsic sensitivity, and brain coverage limitations blunt its utility. Vascular Space Occupancy (VASO), a method sensitive to blood volume changes, has been shown to be exquisitely sensitive to blood volume changes in small vessels and capillaries. Preliminary results have shown clear layer dependent activation using VASO where other approaches have provided less clear delineation(9).</p>
<p>Methods have arisen to identify and mask large vein effects – including thresholding based on percent signal change (large veins tend to fill voxels and thus exhibit a larger fractional signal change), as well as temporal fluctuations (large veins are pulsatile thus exhibit more magnitude and phase noise). While these seem to be workable solutions, they have not been picked up and used extensively. With regard to using the phase variations as a regressor to eliminate pulsatile blood and tissue, perhaps the primary reason for this not being adopted is because standard scanners do not produce these images readily, thus users do not have easy access to this information.</p>
<p>The draining vein issue is least problematic at voxel sizes larger than 2mm, as at these resolutions, mostly the region of activation- as defined as &gt;1 cm “blob” is used and interpreted. Other than enhancing the magnitude of activation, vein effects do not distort these “blobs” thus are typically of no …</p></div></article></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="http://www.thebrainblog.org/2018/12/23/twenty-six-controversies-and-challenges-in-fmri/">http://www.thebrainblog.org/2018/12/23/twenty-six-controversies-and-challenges-in-fmri/</a></em></p>]]>
            </description>
            <link>http://www.thebrainblog.org/2018/12/23/twenty-six-controversies-and-challenges-in-fmri/</link>
            <guid isPermaLink="false">hacker-news-small-sites-23668279</guid>
            <pubDate>Sun, 28 Jun 2020 12:27:45 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Guide to Linux System Calls (2016)]]>
            </title>
            <description>
<![CDATA[
Score 139 | Comments 30 (<a href="https://news.ycombinator.com/item?id=23668186">thread link</a>) | @crunchbang123
<br/>
June 28, 2020 | https://blog.packagecloud.io/eng/2016/04/05/the-definitive-guide-to-linux-system-calls/ | <a href="https://web.archive.org/web/*/https://blog.packagecloud.io/eng/2016/04/05/the-definitive-guide-to-linux-system-calls/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article><p>This blog post explains how Linux programs call functions in the Linux kernel.</p><p>It will outline several different methods of making systems calls, how to handcraft your own assembly to make system calls (examples included), kernel entry points into system calls, kernel exit points from system calls, glibc wrappers, bugs, and much, much more. </p><div><p>Create a package repository in less than 10 seconds, free.</p></div><ul id="markdown-toc"><li><a href="#tldr" id="markdown-toc-tldr">TL;DR</a></li><li><a href="#what-is-a-system-call" id="markdown-toc-what-is-a-system-call">What is a system call?</a></li><li><a href="#prerequisite-information" id="markdown-toc-prerequisite-information">Prerequisite information</a><ul><li><a href="#hardware-and-software" id="markdown-toc-hardware-and-software">Hardware and software</a></li><li><a href="#user-programs-the-kernel-and-cpu-privilege-levels" id="markdown-toc-user-programs-the-kernel-and-cpu-privilege-levels">User programs, the kernel, and CPU privilege levels</a></li><li><a href="#interrupts" id="markdown-toc-interrupts">Interrupts</a></li><li><a href="#model-specific-registers-msrs" id="markdown-toc-model-specific-registers-msrs">Model Specific Registers (MSRs)</a></li><li><a href="#calling-system-calls-with-assembly-is-a-bad-idea" id="markdown-toc-calling-system-calls-with-assembly-is-a-bad-idea">Calling system calls with assembly is a bad idea</a></li></ul></li><li><a href="#legacy-system-calls" id="markdown-toc-legacy-system-calls">Legacy system calls</a><ul><li><a href="#using-legacy-system-calls-with-your-own-assembly" id="markdown-toc-using-legacy-system-calls-with-your-own-assembly">Using legacy system calls with your own assembly</a></li><li><a href="#kernel-side-int-0x80-entry-point" id="markdown-toc-kernel-side-int-0x80-entry-point">Kernel-side: <code>int $0x80</code> entry point</a></li><li><a href="#returning-from-a-legacy-system-call-with-iret" id="markdown-toc-returning-from-a-legacy-system-call-with-iret">Returning from a legacy system call with <code>iret</code></a></li></ul></li><li><a href="#fast-system-calls" id="markdown-toc-fast-system-calls">Fast system calls</a><ul><li><a href="#32-bit-fast-system-calls" id="markdown-toc-32-bit-fast-system-calls">32-bit fast system calls</a><ul><li><a href="#sysentersysexit" id="markdown-toc-sysentersysexit"><code>sysenter</code>/<code>sysexit</code></a></li><li><a href="#__kernel_vsyscall-internals" id="markdown-toc-__kernel_vsyscall-internals"><code>__kernel_vsyscall</code> internals</a></li><li><a href="#using-sysenter-system-calls-with-your-own-assembly" id="markdown-toc-using-sysenter-system-calls-with-your-own-assembly">Using <code>sysenter</code> system calls with your own assembly</a></li><li><a href="#kernel-side-sysenter-entry-point" id="markdown-toc-kernel-side-sysenter-entry-point">Kernel-side: <code>sysenter</code> entry point</a></li><li><a href="#returning-from-a-sysenter-system-call-with-sysexit" id="markdown-toc-returning-from-a-sysenter-system-call-with-sysexit">Returning from a <code>sysenter</code> system call with <code>sysexit</code></a></li></ul></li><li><a href="#64-bit-fast-system-calls" id="markdown-toc-64-bit-fast-system-calls">64-bit fast system calls</a><ul><li><a href="#syscallsysret" id="markdown-toc-syscallsysret"><code>syscall</code>/<code>sysret</code></a></li><li><a href="#using-syscall-system-calls-with-your-own-assembly" id="markdown-toc-using-syscall-system-calls-with-your-own-assembly">Using <code>syscall</code> system calls with your own assembly</a></li><li><a href="#kernel-side-syscall-entry-point" id="markdown-toc-kernel-side-syscall-entry-point">Kernel-side: syscall entry point</a></li><li><a href="#returning-from-a-syscall-system-call-with-sysret" id="markdown-toc-returning-from-a-syscall-system-call-with-sysret">Returning from a <code>syscall</code> system call with <code>sysret</code></a></li></ul></li></ul></li><li><a href="#calling-a-syscall-semi-manually-with-syscall2" id="markdown-toc-calling-a-syscall-semi-manually-with-syscall2">Calling a syscall semi-manually with syscall(2)</a><ul><li><a href="#glibc-syscall-wrapper-internals" id="markdown-toc-glibc-syscall-wrapper-internals">glibc <code>syscall</code> wrapper internals</a></li></ul></li><li><a href="#virtual-system-calls" id="markdown-toc-virtual-system-calls">Virtual system calls</a><ul><li><a href="#vdso-in-the-kernel" id="markdown-toc-vdso-in-the-kernel">vDSO in the kernel</a></li><li><a href="#locating-the-vdso-in-memory" id="markdown-toc-locating-the-vdso-in-memory">Locating the vDSO in memory</a></li><li><a href="#vdso-in-glibc" id="markdown-toc-vdso-in-glibc">vDSO in glibc</a></li></ul></li><li><a href="#glibc-system-call-wrappers" id="markdown-toc-glibc-system-call-wrappers"><code>glibc</code> system call wrappers</a></li><li><a href="#interesting-syscall-related-bugs" id="markdown-toc-interesting-syscall-related-bugs">Interesting syscall related bugs</a><ul><li><a href="#cve-2010-3301" id="markdown-toc-cve-2010-3301">CVE-2010-3301</a></li><li><a href="#android-sysenter-abi-breakage" id="markdown-toc-android-sysenter-abi-breakage">Android <code>sysenter</code> ABI breakage</a></li></ul></li><li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li><li><a href="#related-posts" id="markdown-toc-related-posts">Related Posts</a></li></ul><p>When you run a program which calls <code>open</code>, <code>fork</code>, <code>read</code>, <code>write</code> (and many others) you are making a system call.</p><p>System calls are how a program enters the kernel to perform some task. Programs use system calls to perform a variety of operations such as: creating processes, doing network and file IO, and much more.</p><p>You can find a list of system calls by checking the <a href="http://man7.org/linux/man-pages/man2/syscalls.2.html">man page for syscalls(2)</a>.</p><p>There are several different ways for user programs to make system calls and the low-level instructions for making a system call vary among CPU architectures.</p><p>As an application developer, you don’t typically need to think about how exactly a system call is made. You simply include the appropriate header file and make the call as if it were a normal function.</p><p><code>glibc</code> provides wrapper code which abstracts you away from the underlying code which arranges the arguments you’ve passed and enters the kernel.</p><p>Before we can dive into the details of how system calls are made, we’ll need to define some terms and examine some core ideas that will appear later.</p><h2 id="hardware-and-software">Hardware and software</h2><p>This blog post makes the following assumptions that:</p><ul><li>You are using a 32-bit or 64-bit Intel or AMD CPU. The discussion about the methods may be useful for people using other systems, but the code samples below contain CPU-specific code.</li><li>You are interested in the Linux kernel, version 3.13.0. Other kernel versions will be similar, but the exact line numbers, organization of code, and file paths will vary. Links to the 3.13.0 kernel source tree on GitHub are provided.</li><li>You are interested in <code>glibc</code> or <code>glibc</code> derived libc implementations (e.g., <code>eglibc</code>).</li></ul><p>x86-64 in this blog post will refer to 64bit Intel and AMD CPUs that are based on the x86 architecture.</p><h2 id="user-programs-the-kernel-and-cpu-privilege-levels">User programs, the kernel, and CPU privilege levels</h2><p>User programs (like your editor, terminal, ssh daemon, etc) need to interact with the Linux kernel so that the kernel can perform a set of operations on behalf of your user programs that they can’t perform themselves.</p><p>For example, if a user program needs to do some sort of IO (<code>open</code>, <code>read</code>, <code>write</code>, etc) or modify its address space (<code>mmap</code>, <code>sbrk</code>, etc) it must trigger the kernel to run to complete those actions on its behalf.</p><p>What prevents user programs from performing these actions themselves?</p><p>It turns out that the x86-64 CPUs have a concept called <a href="https://en.wikipedia.org/wiki/Privilege_level">privilege levels</a>. Privilege levels are a complex topic suitable for their own blog post. For the purposes of this post, we can (greatly) simplify the concept of privilege levels by saying:</p><ol><li>Privilege levels are a means of access control. The current privilege level determines which CPU instructions and IO may be performed.</li><li>The kernel runs at the most privileged level, called “Ring 0”. User programs run at a lesser level, typically “Ring 3”.</li></ol><p>In order for a user program to perform some privileged operation, it must cause a privilege level change (from “Ring 3” to “Ring 0”) so that the kernel can execute.</p><p>There are several ways to cause a privilege level change and trigger the kernel to perform some action.</p><p>Let’s start with a common way to cause the kernel to execute: interrupts.</p><h2 id="interrupts">Interrupts</h2><p>You can think of an interrupt as an event that is generated (or “raised”) by hardware or software.</p><p>A hardware interrupt is raised by a hardware device to notify the kernel that a particular event has occurred. A common example of this type of interrupt is an interrupt generated when a NIC receives a packet.</p><p>A software interrupt is raised by executing a piece of code. On x86-64 systems, a software interrupt can be raised by executing the <code>int</code> instruction.</p><p>Interrupts usually have numbers assigned to them. Some of these interrupt numbers have a special meaning.</p><p>You can imagine an array that lives in memory on the CPU. Each entry in this array maps to an interrupt number. Each entry contains the address of a function that the CPU will begin executing when that interrupt is received along with some options, like what privilege level the interrupt handler function should be executed in.</p><p>Here’s a photo from the Intel CPU manual showing the layout of an entry in this array:</p><p><img src="https://blog.packagecloud.io/images/idt.png" alt="Screenshot of Interrupt Descriptor Table entry diagram for x86_64 CPUs"></p><p>If you look closely at the diagram, you can see a 2-bit field labeled DPL (Descriptor Privilege Level). The value in this field determines the minimum privilege level the CPU will be in when the handler function is executed.</p><p>This is how the CPU knows which address it should execute when a particular type of event is received and what privilege level the handler for that event should execute in.</p><p>In practice, there are lots of different ways to deal with interrupts on x86-64 systems. If you are interested in learning more read about the <a href="http://wiki.osdev.org/8259_PIC">8259 Programmable Interrupt Controller</a>, <a href="http://wiki.osdev.org/APIC">Advanced Interrupt Controllers</a>, and <a href="http://wiki.osdev.org/IOAPIC">IO Advanced Interrupt Controllers</a>.</p><p>There are other complexities involved with dealing with both hardware and software interrupts, such as interrupt number collisions and remapping.</p><p>We don’t need to concern ourselves with these details for this discussion about system calls.</p><h2 id="model-specific-registers-msrs">Model Specific Registers (MSRs)</h2><p>Model Specific Registers (also known as MSRs) are control registers that have a specific purpose to control certain features of the CPU. The CPU documentation lists the addresses of each of the MSRs.</p><p>You can use the CPU instructions <code>rdmsr</code> to <code>wrmsr</code> to read and write MSRs, respectively.</p><p>There are also command line tools which allow you to read and write MSRs, but doing this is <em>not recommended</em> as changing these values (especially while a system is running) is dangerous unless you are really careful.</p><p>If you don’t mind potentially destabilizing your system or irreversibly corrupting your data, you can read and write MSRs by installing <code>msr-tools</code> and loading the <code>msr</code> kernel module:</p><figure><pre><code data-lang="sh">% <span>sudo </span>apt-get install msr-tools
% <span>sudo </span>modprobe msr
% <span>sudo </span>rdmsr</code></pre></figure><p>Some of the system call methods we’ll see later make use of MSRs, as we’ll see soon.</p><h2 id="calling-system-calls-with-assembly-is-a-bad-idea">Calling system calls with assembly is a bad idea</h2><p>It’s not a great idea to call system calls by writing your own assembly code.</p><p>One big reason for this is that some system calls have additional code that runs in glibc before or after the system call runs.</p><p>In the examples below, we’ll be using the <code>exit</code> system call. It turns out that you can register functions to run when <code>exit</code> is called by a program by using <a href="http://man7.org/linux/man-pages/man3/atexit.3.html"><code>atexit</code></a>.</p><p>Those functions are called from glibc, not the kernel. So, if you write your own assembly to call <code>exit</code> as we show below, your registered handler functions won’t be executed since you are bypassing glibc.</p><p>Nevertheless, manually making system calls with assembly is a good learning experience.</p><div><p>Create a package repository in less than 10 seconds, free.</p></div><p>Using our prerequisite knowledge we know two things:</p><ol><li>We know that we can trigger the kernel to execute by generating a software interrupt.</li><li>We can generate a software interrupt with the <code>int</code> assembly instruction.</li></ol><p>Combining these two concepts leads us to the legacy system call interface on Linux.</p><p>The Linux kernel sets aside a specific software interrupt number that can be used by user space programs to enter the kernel and execute a system call.</p><p>The Linux kernel registers an interrupt handler named <code>ia32_syscall</code> for the interrupt number: 128 (0x80). Let’s take a look at the code that actually does this.</p><p>From the <code>trap_init</code> function in the kernel 3.13.0 source in <a href="https://github.com/torvalds/linux/blob/v3.13/arch/x86/kernel/traps.c#L770"><code>arch/x86/kernel/traps.c</code></a>:</p><figure><pre><code data-lang="c"><span>void</span> <span>__init</span> <span>trap_init</span><span>(</span><span>void</span><span>)</span>
<span>{</span>
        <span>/* ..... other code ... */</span>

        <span>set_system_intr_gate</span><span>(</span><span>IA32_SYSCALL_VECTOR</span><span>,</span> <span>ia32_syscall</span><span>);</span></code></pre></figure><p>Where <code>IA32_SYSCALL_VECTOR</code> is a defined as <code>0x80</code> in <a href="https://github.com/torvalds/linux/blob/v3.13/arch/x86/kernel/traps.c#L770"><code>arch/x86/include/asm/irq_vectors.h</code></a>.</p><p>But, if the kernel reserves a single software interrupt that userland programs can raise to trigger the kernel, how does the kernel know which of the many system calls it should execute?</p><p>The userland program is expected to put the system call number in the <code>eax</code> register. The arguments for the syscall itself are to be placed in the remaining general purpose registers.</p><p>One place this is documented is in a comment in <a href="https://github.com/torvalds/linux/blob/v3.13/arch/x86/ia32/ia32entry.S#L378-L397"><code>arch/x86/ia32/ia32entry.S</code></a>:</p><figure><pre><code data-lang="c"> <span>*</span> <span>Emulated</span> <span>IA32</span> <span>system</span> <span>calls</span> <span>via</span> <span>int</span> <span>0x80</span><span>.</span>
 <span>*</span>
 <span>*</span> <span>Arguments</span><span>:</span>
 <span>*</span> <span>%</span><span>eax</span> <span>System</span> <span>call</span> <span>number</span><span>.</span>
 <span>*</span> <span>%</span><span>ebx</span> <span>Arg1</span>
 <span>*</span> <span>%</span><span>ecx</span> <span>Arg2</span>
 <span>*</span> <span>%</span><span>edx</span> <span>Arg3</span>
 <span>*</span> <span>%</span><span>esi</span> <span>Arg4</span>
 <span>*</span> <span>%</span><span>edi</span> <span>Arg5</span>
 <span>*</span> <span>%</span><span>ebp</span> <span>Arg6</span>    <span>[</span><span>note</span><span>:</span> <span>not</span> <span>saved</span> <span>in</span> <span>the</span> <span>stack</span> <span>frame</span><span>,</span> <span>should</span> <span>not</span> <span>be</span> <span>touched</span><span>]</span>
 <span>*</span></code></pre></figure><p>Now that we know how to make a system call and where the arguments should live, let’s try to make one by writing some inline assembly.</p><h2 id="using-legacy-system-calls-with-your-own-assembly">Using legacy system calls with your own assembly</h2><p>To make a legacy system call, you can write a small bit of inline assembly. While this is interesting from a learning perspective, I encourage readers to never make system calls by crafting their own assembly.</p><p>In this example, we’ll try calling …</p></article></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://blog.packagecloud.io/eng/2016/04/05/the-definitive-guide-to-linux-system-calls/">https://blog.packagecloud.io/eng/2016/04/05/the-definitive-guide-to-linux-system-calls/</a></em></p>]]>
            </description>
            <link>https://blog.packagecloud.io/eng/2016/04/05/the-definitive-guide-to-linux-system-calls/</link>
            <guid isPermaLink="false">hacker-news-small-sites-23668186</guid>
            <pubDate>Sun, 28 Jun 2020 11:56:51 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[A primer on the cruel, tacit laws of type-level programming in Haskell]]>
            </title>
            <description>
<![CDATA[
Score 115 | Comments 62 (<a href="https://news.ycombinator.com/item?id=23667675">thread link</a>) | @tenslisi
<br/>
June 28, 2020 | https://www.aymannadeem.com/haskell/2020/05/15/Kindness-for-Mean-Girls.html | <a href="https://web.archive.org/web/*/https://www.aymannadeem.com/haskell/2020/05/15/Kindness-for-Mean-Girls.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    
<h4 id="a-primer-on-the-cruel-tacit-laws-of-type-level-programming-in-haskell"><em>A primer on the cruel, tacit laws of type-level programming in Haskell</em></h4>

<p>Haskell programs are constructed at the junction of two worlds: one of types, and the other of values. Values are operational run-time entities that are denoted syntactically by <em>terms</em> in the code. To this end, types classify terms. They provide a powerful abstraction to organize data, determine how it should be stored in memory, passed through various operations, and more. On a superficial level, the difference between these worlds is simple: <em>types</em> refer to datatypes, which are either built-in (such as <code>Integer</code> and <code>String</code>), or user-declared, for example:</p>

<pre><code>data SpringFlingQueen = Cady | Regina
</code></pre>

<p>By comparison, <em>values</em> are denoted by <em>terms</em> those types categorize (such as <code>1</code> and <code>"abc"</code> described by the standard library’s <code>Integer</code> and <code>String</code> types, or <code>Cady</code> and <code>Regina</code> in the case of our user-declared type, <code>SpringFlingQueen</code>). Thus, the term <code>1</code> denotes a value that exists in memory only when the program is run.</p>

<p>In addition to these two worlds, a third, darker, and more elusive underworld of <em>kinds</em> also lurks in the shadows of Haskell programs. Haskell kinds can be as unpredictable and insidious as the soulless alpha-female of an elite high school clique. While daunting, understanding the coaction between these three worlds lays the foundation for type-level programming, a topic worth learning as it strengthens overall Haskell intuition.</p>

<p><img src="https://user-images.githubusercontent.com/875834/81239044-afe24580-8fd1-11ea-96b0-274cf839e834.png" alt="the haskell type system: a machine of constant, unforgiving judgement and rigid classification"></p>

<h3 id="kindness-is-a-virtue">Kindness is a virtue</h3>

<p>Much like counter-intuitive adolescent social dynamics, mastery of Haskell bears a steep learning curve because of its underlying complexity. It is difficult to wrap one’s head around the language’s typeclass hierarchies, category-theoretic roots, or the intricacies of compiler behavior. However, an intimate understanding of the type system lets programmers look beyond the chaos of code and apply a recognizable template by which to understand it.</p>

<h3 id="kindness-takes-patience">Kindness takes patience</h3>

<p>This topic is also difficult to master because it is both vast and subtle. Ideas underlying type-level programming are scattered across many disconnected resources focused on several corners of the Haskell ecosystem. Authoritative references on the topic (such as relevant library documentation) tend to assume familiarity with domain-specific terminology that may be unknown to non-experts. Due to the paucity of approachable materials on the subject, I’ve attempted to break down type-level programming into explanations of its constituent parts. While I don’t go into extensive depth on any individual section below, I hope to provide a valuable starting point with which readers can explore ideas in greater detail.</p>

<table>
  <thead>
    <tr>
      <th>Table of contents</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="#Types-vs-Values">Types vs. Values</a></td>
    </tr>
    <tr>
      <td><a href="#Kinds">Kinds</a></td>
    </tr>
    <tr>
      <td><a href="#higher-kinded-types">Higher-kinded types</a></td>
    </tr>
    <tr>
      <td><a href="#constraint-kinds">Constraint kinds</a></td>
    </tr>
    <tr>
      <td><a href="#PolyKinds">Kind polymorphism</a></td>
    </tr>
    <tr>
      <td><a href="#DataKinds">DataKinds and type-level literals</a></td>
    </tr>
    <tr>
      <td><a href="#Datatype-promotion">Datatype promotion</a></td>
    </tr>
    <tr>
      <td><a href="#Relationship-between-values-terms-types-and-kinds">Relationship between values, terms, types, and kinds</a></td>
    </tr>
    <tr>
      <td><a href="#The-difference-between-type-and-type-level">The difference between “type” and “type-level”</a></td>
    </tr>
    <tr>
      <td><a href="#type-families">Type families</a></td>
    </tr>
    <tr>
      <td><a href="#associated-types">Associated types</a></td>
    </tr>
    <tr>
      <td><a href="#TypeLits">GHC.TypeLits</a></td>
    </tr>
    <tr>
      <td><a href="#Distinguishing-between-DataKinds-and-TypeLits">Distinguishing between DataKinds and GHC.TypeLits</a></td>
    </tr>
    <tr>
      <td><a href="#use-case-Marshaling-ASTs">Use-case: Marshaling ASTs</a></td>
    </tr>
    <tr>
      <td><a href="#The-hype-of-dependently-typed-langs">The hype of dependently-typed languages</a></td>
    </tr>
  </tbody>
</table>

<hr>

<h3 id="types-vs-values">Types vs. Values</h3>

<p>As mentioned above, Haskell programs are divided into two worlds: the <em>type-level</em> and the <em>value-level</em>. The <em>type-level</em> refers to the part of a program analyzed by the static type-checking phase during compilation. Since every expression is assigned a type, code is checked against Haskell’s type system to ensure it fits <a href="https://www.haskell.org/ghc/">GHC</a>’s specified correctness criteria.</p>

<p><img src="https://user-images.githubusercontent.com/875834/84704534-fce9fd80-af27-11ea-9544-13961a56c444.png" alt="types classify terms, just like hostile teens with identity crises classify one another"></p>

<p>If the program is well-typed, the program will compile. However, this type-information evaporates once the compilation process terminates, leaving only <em>values</em> behind at run-time. In this way, types and values can be better distinguished by the phasing distinction, with types being compile-time entities and values being run-time entities.</p>

<p>For example, if a function takes a <code>String</code>, the type-checker doesn’t care if the <code>String</code> has a value denoted by <code>"abc"</code> or <code>"123"</code> or <code>"get in loser"</code>—so long as it’s a <code>String</code>. Type information gets discarded at run-time, leaving only the string’s value (ex.,<code>"get in loser"</code>). In some cases, however, we want the type system to care about what those values are and distinguish between them. The <code>DataKinds</code> extension, which we’ll explore below, lets us do that by allowing us to shove more information about our program into the type system. This lets us add meaning to the value of a <code>String</code> at the type-level, moving them from their usual, strictly run-time existence, into the compile-time phase. The technique allows us to use more information statically in the logical development and abstraction of the program’s behavior. We’re also able to add consequences that can halt compilation if the specific value of <code>String</code> doesn’t conform to the rules we’ve specified, or define classes over them.</p>

<h4 id="distinguishing-types-and-values-in-ghci">Distinguishing types and values in GHCi</h4>

<p>Let’s examine our aforementioned <code>SpringFlingQueen</code> datatype in GHCi. When we query the type of one of its constructors using <code>:t</code> (a handy shorthand for <code>:type</code>), we see that it is indeed of type <code>SpringFlingQueen</code>:</p>

<div><div><pre><code>λ data SpringFlingQueen = Cady | Regina
λ :t Cady
Cady :: SpringFlingQueen
</code></pre></div></div>

<p>Now consider literals <code>1</code>, <code>2</code>, <code>3</code>. These are <em>values</em> of a type that parameterizes the <code>Num</code> class:</p>



<p>Typing <code>:t 1</code> into GHCi gives us <code>Num p =&gt; p</code>, indicating that a literal such as <code>1</code> can be of any polymorphic type <code>p</code> as long as the <code>Num</code> type class has instances for that type (for example, <code>Integer</code> and <code>Float</code> both have <code>Num</code> instances and therefore are valid types that <code>p</code> could be instantiated with). This is possible due to <a href="https://wiki.haskell.org/Type_inference">type inference</a>.</p>

<p><img src="https://user-images.githubusercontent.com/875834/84704346-ae3c6380-af27-11ea-8078-6f1ddfc7b238.png" alt="type inference can be used to deduce concrete types wherever they're obvious. If a type looks like a mouse, it's a mouse—duh!"></p>

<h3 id="kinds">Kinds</h3>

<p>Just like types classify terms, <a href="https://www.haskell.org/onlinereport/decls.html#sect4.1.1">kinds</a> classify types, and therefore are frequently described as “types of types”, or referred to be “one level up.” The “star” syntax (i.e., <code>*</code>) denotes kinds. It is defiantly used in this post despite <a href="https://github.com/ghc-proposals/ghc-proposals/blob/master/proposals/0143-remove-star-kind.rst">recent syntactic changes</a>. A prerequisite for understanding the kind system necessitates comprehending the differences between three pairs of ideas:</p>

<ol>
  <li>
    <p><strong>Data constructors vs. type constructors:</strong> data constructors create values, whereas type constructors create types. Type constructors take one or more type arguments and produce a datatype when enough arguments are provided. This means that through <a href="https://wiki.haskell.org/Currying">currying</a>, a type constructor can be <a href="https://wiki.haskell.org/Partial_application">partially applied</a>. For example, the list type constructor <code>[]</code> may take a single type argument (ex. <code>String</code>) to denote the elements of the list (i.e., <code>[String]</code>). <code>[String]</code> is simply syntactic sugar for <code>[] String</code>, where the type <code>[]</code> is applied to <code>String</code>.</p>
  </li>
  <li>
    <p><strong>Full vs. partial application</strong> A partially-applied type, like a <a href="https://wiki.haskell.org/Partial_application">partially-applied function</a>, is one that is missing some of its data constructors. For instance, consider the list type <code>[]</code>. The kind of <code>[]</code> is <code>* -&gt; *</code>. A fully-applied list has data constructors, such as <code>[Int]</code>, and its kind is <code>*</code>.</p>
  </li>
  <li>
    <p><strong>Inhabited types vs. uninhabited types:</strong> An inhabitant of a type is precisely a value of that type. This means that <em>inhabited</em> types refer to the types that contain concrete values, such as the value denoted by the term <code>1 :: Int</code>. This suggests that the type <code>Int</code> is inhabited by value denoted by <code>1</code>. By contrast, <em>uninhabited</em> types refer to type constructors to which no values are abstracted. For instance, <code>Void</code> is uninhabited because it has no data constructors, and thus can not be used to construct a valid term. While <code>Void</code> may seem pointless at first, it can be a useful way to represent that a container is empty (ex., <code>[Void]</code>, which <em>is</em> inhabited by the term <code>[]</code> and the value this term denotes).</p>
  </li>
</ol>

<p>How do these ideas relate to the kind system? Well, all fully-applied runtime values are of kind <code>*</code> <em>and</em> they are inhabited. You can confirm this by typing <code>:k Int</code> and <code>:k String</code> in GHCi. However, this doesn’t work the other way around—just because a type is inhabited, doesn’t necessarily mean it’s fully-applied (ex., <code>[]</code> is not fully-applied but it <em>is</em> inhabited, and its kind signature is <code>* -&gt; *</code>). Conversely, all partially-applied types are uninhabited (since they don’t correspond to a value), but not all uninhabited types are partially applied. <code>Void</code> for instance is not partially-applied, but it is uninhabited.</p>

<p>To get the hang of this idea, consider the following examples:</p>

<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Inhabited?</th>
      <th>Fully-applied?</th>
      <th>Kind</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Int</code></td>
      <td>Yes</td>
      <td>Yes</td>
      <td><code>*</code></td>
    </tr>
    <tr>
      <td><code>String</code></td>
      <td>Yes</td>
      <td>Yes</td>
      <td><code>*</code></td>
    </tr>
    <tr>
      <td><code>[]</code></td>
      <td>Yes</td>
      <td>No</td>
      <td><code>* -&gt; *</code></td>
    </tr>
    <tr>
      <td><code>[Int]</code></td>
      <td>Yes</td>
      <td>Yes</td>
      <td><code>*</code></td>
    </tr>
    <tr>
      <td><code>(,)</code></td>
      <td>Yes</td>
      <td>No</td>
      <td><code>* -&gt; * -&gt; *</code></td>
    </tr>
    <tr>
      <td><code>Either</code></td>
      <td>Yes</td>
      <td>No</td>
      <td><code>* -&gt; * -&gt; *</code></td>
    </tr>
    <tr>
      <td><code>Void</code></td>
      <td>No</td>
      <td>N/A</td>
      <td><code>*</code></td>
    </tr>
    <tr>
      <td><code>Either Void Void</code></td>
      <td>Yes</td>
      <td>Yes</td>
      <td><code>*</code></td>
    </tr>
  </tbody>
</table>

<p>Kind signatures can be specified manually in GHCi using the <a href="https://downloads.haskell.org/~ghc/8.0.1/docs/html/users_guide/glasgow_exts.html#ghc-flag--XKindSignatures"><code>XKindSignatures</code></a> extension. Try extending the above table by investigating the kind signatures of various types.</p>

<h3 id="higher-kinded-types">Higher-kinded types</h3>

<p>Just like there are higher-order functions (functions that take other functions as arguments), there are higher-kinded types (types constructors that take other type constructors as arguments). Type constructors such as <code>[]</code> are a first-class type, but also a higher-kinded type, given they take another type constructor to be reified:</p>



<p>Let’s consider <code>Functor</code>:</p>

<div><div><pre><code>λ :k Functor
Functor :: (* -&gt; *) -&gt; Constraint
</code></pre></div></div>

<p>We see that <code>Functor</code> takes a type constructor <code>* -&gt; *</code> and returns a <code>Constraint</code>. Let’s use <code>:info</code> to examine <code>Functor</code> a bit more closely:</p>

<div><div><pre><code>λ :info Functor
class Functor (f :: * -&gt; *) where
  fmap :: (a -&gt; b) -&gt; f a -&gt; f b
  (&lt;$) :: a -&gt; f b -&gt; f a
  {-# MINIMAL fmap #-}
  	-- Defined in ‘GHC.Base’
instance Functor (Either a) -- Defined in ‘Data.Either’
instance Functor ((,,,) a b c) -- Defined in ‘Data.Orphans’
instance Functor ((,,) a b) -- Defined in ‘Data.Orphans’
instance Functor [] -- Defined in ‘GHC.Base’
instance Functor Maybe -- Defined in ‘GHC.Base’
instance Functor IO -- Defined in ‘GHC.Base’
instance Functor ((-&gt;) r) -- Defined in ‘GHC.Base’
instance Functor ((,) a) -- Defined in ‘GHC.Base’
</code></pre></div></div>

<p>We see that <code>Functor</code> allows type constructors like <code>Maybe</code> and <code>[]</code> to have <code>Functor</code> instances, but not <code>Int</code> or <code>String</code>. This is because <code>Maybe</code> and <code>[]</code> are <code>* -&gt; *</code>, while <code>Int</code> has kind <code>*</code>. Similarly, <code>Either</code> has <code>* -&gt; * -&gt; *</code>, which is why its instance above is parameterized with a type parameter denoting something of kind <code>* -&gt; *</code>: <code>Either a</code>.</p>

<h3 id="constraint-kinds">Constraint kinds</h3>

<p>We got a glimpse of constraint kinds …</p></div></article></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://www.aymannadeem.com/haskell/2020/05/15/Kindness-for-Mean-Girls.html">https://www.aymannadeem.com/haskell/2020/05/15/Kindness-for-Mean-Girls.html</a></em></p>]]>
            </description>
            <link>https://www.aymannadeem.com/haskell/2020/05/15/Kindness-for-Mean-Girls.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-23667675</guid>
            <pubDate>Sun, 28 Jun 2020 09:34:41 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[ELF: Better Symbol Lookup via Dt_gnu_hash (2017)]]>
            </title>
            <description>
<![CDATA[
Score 40 | Comments 5 (<a href="https://news.ycombinator.com/item?id=23667520">thread link</a>) | @fanf2
<br/>
June 28, 2020 | https://flapenguin.me/elf-dt-gnu-hash | <a href="https://web.archive.org/web/*/https://flapenguin.me/elf-dt-gnu-hash">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article><time datetime="2017-05-10">2017-05-10</time> |<p><code>DT_GNU_HASH</code> is a better hash table for the <a href="https://refspecs.linuxfoundation.org/elf/gabi4+/contents.html">ELF</a> used by GNU systems in GNU-compatible software, i.e. in almost every program compiled with gcc or clang for almost any Linux distribution.</p><p>The problem with it is that <code>DT_GNU_HASH</code> is not documented anywhere other than in <a href="https://www.gnu.org/software/binutils/">GNU binutils</a> and <a href="https://www.gnu.org/software/libc/">glibc</a> source code. You can either read source code to get some intel, or read emails with patches in mail list archives (<a href="https://sourceware.org/ml/binutils/2006-10/msg00377.html">Re: GNU_HASH section format</a> is a pretty good one). Those are the only places you can try to find the truth on the matter.</p><p>Of course, there're some articles on the web where people try to break it down. Like this one.</p><p>This article does not aspire to be the ultimate truth either. But I'll try to cover everything about GNU Hash Table and explain all aspects of its work.</p><p>Before reading any further please ensure that you understand what <a href="https://refspecs.linuxfoundation.org/elf/gabi4+/ch4.symtab.html">Symbol Table</a> and <a href="https://refspecs.linuxfoundation.org/elf/gabi4+/ch4.strtab.html">String Table</a> are in the <a href="https://refspecs.linuxfoundation.org/elf/gabi4+/contents.html">ELF</a>. Also you may want to read my previous article <a href="https://flapenguin.me/2017/04/24/elf-lookup-dt-hash">ELF: symbol lookup via DT_HASH</a> to know the standard (90s-ish) way of doing symbol lookup.</p><p><code>DT_GNU_HASH</code> has nothing in common with standard <code>DT_HASH</code>, apart from serving the same purpose. It has its own hashing function, its own layout, it adds restrictions for the symbol table and contains an additional <a href="https://en.wikipedia.org/wiki/Bloom_filter">bloom filter</a> to stop lookup for missing symbols early.</p><h2>Hashing function</h2><p>Let's start with the hashing function. It can be found in <a href="https://sourceware.org/git/gitweb.cgi?p=binutils-gdb.git;a=blob;f=bfd/elf.c;h=a08e0f8ea6197f103908364665ec6e5f6c89927d;hb=HEAD#l222">bfd_elf_gnu_hash</a> or in <a href="https://sourceware.org/git/?p=glibc.git;a=blob;f=elf/dl-lookup.c;h=3d2369dbf2b7ca219eaf80a820e2a8e1329fbf50;hb=HEAD#l569">dl_new_hash</a>.</p><pre><span>#<span>include</span> <span>&lt;stdint.h&gt;</span></span>

<span><span>uint32_t</span> <span>gnu_hash</span><span>(<span>const</span> <span>uint8_t</span>* name)</span> </span>{
    <span>uint32_t</span> h = <span>5381</span>;

    <span>for</span> (; *name; name++) {
        h = (h &lt;&lt; <span>5</span>) + h + *name;
    }

    <span>return</span> h;
}

gnu_hash(<span>""</span>)                == <span>0x00001505</span>
gnu_hash(<span>"printf"</span>)          == <span>0x156b2bb8</span>
gnu_hash(<span>"exit"</span>)            == <span>0x7c967e3f</span>
gnu_hash(<span>"syscall"</span>)         == <span>0xbac212a0</span>
gnu_hash(<span>"flapenguin.me"</span>)   == <span>0x8ae9f18e</span>
</pre><h2>Layout</h2><p>Not a valid C code, but gives an idea:</p><pre><span><span>struct</span> <span>gnu_hash_table</span> {</span>
    <span>uint32_t</span> nbuckets;
    <span>uint32_t</span> symoffset;
    <span>uint32_t</span> bloom_size;
    <span>uint32_t</span> bloom_shift;
    <span>uint64_t</span> bloom[bloom_size]; 
    <span>uint32_t</span> buckets[nbuckets];
    <span>uint32_t</span> chain[];
};
</pre><h2>Bloom filter</h2><p><a href="https://en.wikipedia.org/wiki/Bloom_filter">Bloom filter</a> is used to stop the lookup for missing symbols early. <code>bloom_size</code>, <code>bloom_shift</code>, and <code>bloom</code> are parts of the structure, as their names suggest.</p><p>Bloom filter behaves slightly differently for various <code>ELFCLASS</code> binaries (defined by <code>EI_CLASS</code> field in <a href="https://refspecs.linuxfoundation.org/elf/gabi4+/ch4.eheader.html#elfid">ELF Identification</a>). Let's define <code>ELFCLASS_BITS</code> to be <code>64</code> for 64-bit binaries (<code>ELFCLASS64</code>) and <code>32</code> for 32-bit binaries (<code>ELFCLASS32</code>).</p><p>Before doing symbol lookup, take <code>bloom[(hash / ELFCLASS_BITS) % bloom_size]</code>. If bits <code>hash % ELFCLASS_BITS</code> and <code>(hash &gt;&gt; bloom_shift) % ELFCLASS_BITS</code> are set then a symbol <strong>may or may not</strong> be in the hash table, and you should proceed with a regular lookup through buckets and chains. But if at least one bit is not set then a symbol is <strong>certainly</strong> absent from the hash table.</p><h2>Buckets and chains</h2><p><code>DT_HASH</code> contains an element per symbol table's element. This leads to a waste of space because <code>STN_UNDEF</code> and some other symbols are in the hash table but are never looked up. GNU hash table allows to skip first <code>symoffset</code> symbols at the beginning of the symbol table.</p><p>Same as in <code>DT_HASH</code>, symbols are put in one of <code>nbuckets</code> buckets depending on their hashes. To be specific, each symbol should be placed into <code>hash % nbuckets</code> bucket.</p><p>Chains in the GNU hash table are nothing like strange linked lists in <code>DT_HASH</code>, they are contiguous sequences of hashes for symbols with the same index (remember that chains' indexes are shifted by <code>symoffset</code> relatively to the symbol table). The last bit in chains' element is discarded and instead used for indicating the chain's end. If it is set then the element is the last one in the chain.</p><p><code>bucket</code> array holds indexes of the first symbols in the chains. Note that those are not indexes for the <code>chain</code> array. Indexes for it will be <code>bucket[foobar] - symoffset</code>.</p><p>Chains being contiguous sequences imply that symbols within the same bucket must be stored contiguously. Order of buckets in the symbol table does not really matter but usually they're stored in an ascending order.</p><p>While looking extraneous, creating such restriction over the symbol table gives great advantage: a hash table now can store almost full hash (without the lowest bit) of a symbol within the same 32 bits. This allows linkers to compare hashes before comparing strings. Also, because <code>DT_GNU_HASH</code> requires symbol table ordering and <code>DT_HASH</code> doesn't, you can fit both into a single binary. This way both standard and GNU linkers can look up symbols in it.</p><h2>Example</h2><p>Nothing is better than a visual representation of the rules. So, let's create one.</p><p>I took the same symbols as in <a href="https://flapenguin.me/2017/04/24/elf-lookup-dt-hash">ELF: symbol lookup via DT_HASH</a> and created <code>DT_GNU_HASH</code> table from them. The example is for 64-bit ELF binaries, for 32-bit you'll need to recalculate bloom word and bits.</p><pre>nbuckets = 4      (because I decided that there will be four buckets)
symoffset = 1    (STN_UNDEF is not a part of the hash table)
bloom_size = 2   (because I decided that 16 byte bloom filter is sufficient)
bloom_shift = 5  (again, just because I can)

ix  bucket[ix]  name of first symbol in chain
--  ----------  -----------------------------
 0  1           cfsetispeed
 1  5           uselib
 2  8           freelocal
 3  13          getspen

Note that:
- symbol table is sorted by bucket
- chain[ix] is the same as hash but with set/cleared lowest bit

       SYMBOL TABLE              |              GNU HASH TABLE
                                 |
    name =                       |    hash %              bloom  bloom bits
ix  symtab[ix].st_name    hash   | ix nbuckets chain[ix]  word   #0    #1
--  ------------------  -------- | -- -------  ---------- -----  ---   ---
 0  &lt;STN_UNDEF&gt;                  |
 1  cfsetispeed         830acc54 |  0    0      830acc54    1    20    34
 2  strsigna            90f1e4b0 |  1    0      90f1e4b0    0    48    37
 3  hcreate_            4c7e3240 |  2    0      4c7e3240    1     0    18
 4  endrpcen            b6c44714 |  3    0      b6c44715    0    20    56
 5  uselib              2124d3e9 |  4    1      2124d3e8    1    41    31
 6  getttyen            fff51839 |  5    1      fff51838    0    57     1
 7  umoun               1081e019 |  6    1      1081e019    0    25     0
 8  freelocal           e3364372 |  7    2      e3364372    1    50    27
 9  listxatt            ced3d862 |  8    2      ced3d862    1    34     3
10  isnan               0fabfd7e |  9    2      0fabfd7e    1    62    43
11  isinf               0fabe9de | 10    2      0fabe9de    1    30    14
12  setrlimi            12e23bae | 11    2      12e23baf    0    46    29
13  getspen             f07b2a7b | 12    3      f07b2a7a    1    59    19
14  pthread_mutex_lock  4f152227 | 13    3      4f152226    0    39    17
15  getopt_long_onl     57b1584f | 14    3      57b1584f    1    15     2

Bloom filter:
   bit #      56       48       40       32       24       16        8        0
        xx..x.xx ...xxx.x xx...... x.x.xx.x ..x...x. ...x..x. ........ ......xx
        .x..x... .....x.. ....x.x. .....x.. xx..x.xx ...xxx.x xx...... x.x.xx.x

Or as two `uint64_t` values:
    cb1dc0ad22120003
    48040a04cb1dc0ad
</pre><p>Knowing the rules and having a built table, let's try to find some symbols by hand.</p><p>Note that when comparing hashes the lowest bit is set on both left and right hand sides.</p><ol><li><p>Existing symbol. <code>strsigna</code>:</p><pre>looking for "strsigna" (hash = 0x90f1e4b0)
checking word 0 in bloom filter for bits 48 and 37
        hash table may contain symbol
starting at ix = 1

compare hashes: (chain) 0x830acc55 == 0x90f1e4b1
wrong hash definitely not "strsigna"
moving to the next symbol

compare hashes: (chain) 0x90f1e4b1 == 0x90f1e4b1
hash matches. compare strings: "strsigna" == "strsigna"
found at index 2
</pre></li><li><p>Missing symbol. <code>foobar</code>:</p><pre>looking for "foobar" (hash = 0xfde460be)
checking word 0 in bloom filter for bits 62 and 5
        not in bloom filter
not found
</pre></li><li><p>Missing symbol with hash collision. <code>vLoun</code>:</p><pre>looking for "vLoun" (hash = 0x1081e019)
checking word 0 in bloom filter for bits 25 and 0
        hash table may contain symbol
starting at ix = 5

compare hashes: (chain) 0x2124d3e9 == 0x1081e019
wrong hash definitely not "vLoun"
moving to the next symbol

compare hashes: (chain) 0xfff51839 == 0x1081e019
wrong hash definitely not "vLoun"
moving to the next symbol

compare hashes: (chain) 0x1081e019 == 0x1081e019
hash matches. compare strings: "umoun" == "vLoun"
just hash collision
that was last symbol in this bucket
not found
</pre></li></ol><h2>Code</h2><p>Original algorithm is implemented in <a href="https://sourceware.org/git/?p=glibc.git;a=blob;f=elf/dl-lookup.c;h=3d2369dbf2b7ca219eaf80a820e2a8e1329fbf50;hb=HEAD#l350">do_lookup_x</a> in <code>ld.so</code> source code.</p><p>Implementation is a little trickier than <code>DT_HASH</code>'s one, but with the example above it should be self-explanatory.</p><pre>
<span>typedef</span> Elf64_Sym Elf_Sym;
<span>typedef</span> <span>bloom_el_t</span> <span>uint64_t</span>;
<span>#<span>define</span> ELFCLASS_BITS 64</span>


<span><span>const</span> Elf_Sym* <span>gnu_lookup</span><span>(
    <span>const</span> <span>char</span>* strtab,      
    <span>const</span> Elf_Sym* symtab,   
    <span>const</span> <span>uint32_t</span>* hashtab, 
    <span>const</span> <span>char</span>* name         
)</span> </span>{
    <span>const</span> <span>uint32_t</span> namehash = gnu_hash(name);

    <span>const</span> <span>uint32_t</span> nbuckets = hashtab[<span>0</span>];
    <span>const</span> <span>uint32_t</span> symoffset = hashtab[<span>1</span>];
    <span>const</span> <span>uint32_t</span> bloom_size = hashtab[<span>2</span>];
    <span>const</span> <span>uint32_t</span> bloom_shift = hashtab[<span>3</span>];
    <span>const</span> <span>bloom_el_t</span>* bloom = (<span>void</span>*)&amp;hashtab[<span>4</span>];
    <span>const</span> <span>uint32_t</span>* buckets = (<span>void</span>*)&amp;bloom[bloom_size];
    <span>const</span> <span>uint32_t</span>* chain = &amp;buckets[nbuckets];

    <span>bloom_el_t</span> <span>word</span> = bloom[(namehash / ELFCLASS_BITS) % bloom_size];
    <span>bloom_el_t</span> mask = <span>0</span>
        | (<span>bloom_el_t</span>)<span>1</span> &lt;&lt; (namehash % ELFCLASS_BITS)
        | (<span>bloom_el_t</span>)<span>1</span> &lt;&lt; ((namehash &gt;&gt; bloom_shift) % ELFCLASS_BITS);

    
    <span>if</span> ((<span>word</span> &amp; mask) != mask) {
        <span>return</span> <span>NULL</span>;
    }

    <span>uint32_t</span> symix = buckets[namehash % nbuckets];
    <span>if</span> (symix &lt; symoffset) {
        <span>return</span> <span>NULL</span>;
    }

    
    <span>while</span> (<span>true</span>) {
        <span>const</span> <span>char</span>* symname = strtab + symtab[symix].st_name;
        <span>const</span> <span>uint32_t</span> hash = chain[symix - symoffset];

        <span>if</span> ((namehash|<span>1</span>) == (hash|<span>1</span>) &amp;&amp; <span>strcmp</span>(name, symname) == <span>0</span>) {
            <span>return</span> &amp;symtab[symix];
        }

        
        <span>if</span> (hash &amp; <span>1</span>) {
            <span>break</span>;
        }

        symix++;
    }

    <span>return</span> <span>NULL</span>;
}
</pre><h2>Total …</h2></article></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://flapenguin.me/elf-dt-gnu-hash">https://flapenguin.me/elf-dt-gnu-hash</a></em></p>]]>
            </description>
            <link>https://flapenguin.me/elf-dt-gnu-hash</link>
            <guid isPermaLink="false">hacker-news-small-sites-23667520</guid>
            <pubDate>Sun, 28 Jun 2020 08:43:06 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Taking Up Animation as a Hobby]]>
            </title>
            <description>
<![CDATA[
Score 105 | Comments 15 (<a href="https://news.ycombinator.com/item?id=23667083">thread link</a>) | @luu
<br/>
June 27, 2020 | http://yosefk.com/blog/a-better-future-animated-post.html | <a href="https://web.archive.org/web/*/http://yosefk.com/blog/a-better-future-animated-post.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
				<p><em>Whatever else happens, you made a movie… Nobody can take that away. A hundred years from now, when we're all dead and gone, people will be watching this fucking thing.</em></p>
<p><em>– <a href="http://en.wikipedia.org/wiki/Tony_Soprano">Tony Soprano</a> to his nephew (whom he murders over this movie in a few episodes)</em></p>
<p>So I made a 90-second animated, um, I guess it's a blog post. I don't know about a hundred years from now, but I proudly invite you to watch the fucking thing right now:</p>
<p><iframe src="//www.youtube.com/embed/xTOHyWphzFc" width="480" height="270" frameborder="0" allowfullscreen="allowfullscreen"></iframe></p>
<p>I hear that it's considered classy for animators, filmmakers and such to let their work stand on its own, either refraining from commentary or making it vague. However, anxious to secure my spot in eternity, I decided to rush my immortal masterpiece out the door, so I cut everything I could.</p>
<p>I then realized that I left out a delicate point which, despite my embarrassment, I must mention. Luckily, typing is much easier than animating, so the following afterthought was quick to put down [1]. Here goes.</p>
<p>The short isn't exactly a documentary, but real-life me did switch to a part-time job to free some time for animating, drawing, etc. I figured this mundane little step was a good topic for a starting filmmaker because it turned out to be surprisingly controversial. Here are some of the reactions I received:</p>
<ul>
<li>"So you finally got fed up with the job?"</li>
<li>"Part-time? But everyone here <em>needs</em> you!"</li>
<li>"Wow, I'm jealous! I want to work less, too. They pay you the same, right?" No, they pay less, I said. "Oh. Ha-ha. Work less, get less. Interesting!"</li>
<li>"You should really work more, not less, while you're young. Futurists predict a huge global pension crisis, so save for your retirement!"</li>
<li>"I doubt this will fly with the big deadline coming. Who's gonna do all the work? Not me!" (This guy works part-time himself – very productively.)</li>
<li>"Doesn't your wife object?" (Actually, my light table is Rachel's gift. I don't know when/if I'd ever get one on my own.)</li>
</ul>
<p>These comments suggest that many people want to work less, but something is keeping them from doing it. I can certainly relate to that. It took me 10 years to decide to work part-time – and then <em>5 more years to actually do it</em>.</p>
<p>Why is it so hard?</p>
<p>My own reasons mostly revolve around money. Where I live, money is much easier to make programming than animating (good luck even finding a half-stable job working on animated features.)</p>
<p>Hence "I went into programming for the money", as I said in the short – as I always say. And initially I figured I'd work all I can and retire early – the opposite of working part-time and animating in my spare time ("settling for a fraction of the dream"). And you've just seen how I changed my mind.</p>
<p>But there's another thing, which I usually<em> don't </em>say and which I must reluctantly admit. You see, I came for the money, and then I started liking the <em>getting paid</em> part.</p>
<p>What's the difference between money and getting paid? There's a world of difference!</p>
<p>Winning a lottery is a way to obtain money without getting paid for a service. And spending your wage on designer clothes is a way to get paid without having any money left. The difference is this:</p>
<ul>
<li><strong>Money</strong> lets you buy things – food, living space, spare time, etc. It's about <strong>options</strong>.</li>
<li><strong>Getting paid</strong> tells you the value of your service to whoever paid you. It's about <strong>achievement</strong>.</li>
</ul>
<p>I like getting paid, I must admit despite the embarrassment.</p>
<p>Note that I'm not ashamed in the slightest to like money (options) and to have chosen a profession with the sole purpose of maximizing income.</p>
<p>Some people believe that you can't be happy doing something you don't love – and that you can't be any good at it, hence you won't make that much money, either. I disagree.</p>
<p>I'll tell you who my role model is, as a computer programmer. It's neither Bill Gates nor <a href="http://en.wikipedia.org/wiki/Richard_stallman">Richard Stallman</a>. My role model is <a href="http://en.wikipedia.org/wiki/Alec_Guinness">Alec Guinness</a>, whom you probably remember as Obi-Wan Kenobi from Star Wars. Wikipedia says:</p>
<blockquote><p>In letters to his friends, Guinness described the film as "fairy tale rubbish" &lt;…&gt;</p>
<p>He was one of the few cast members who believed that the film would be a box office hit;&nbsp; he negotiated a deal for 2% of the gross royalties &lt;…&gt;</p>
<p>Lucas and fellow cast members … have spoken highly of his courtesy and professionalism, both on and off the set. Lucas &lt;said&gt; that Guinness contributed significantly to achieving completion of the filming.</p></blockquote>
<p>Here's a man working on something he disliked because it paid – and delighting his target audience and colleagues alike. To me it shows that "extrinsic motivation" – money – is a perfectly good primary motivation, contrary to <a href="http://lemire.me/blog/archives/2014/07/09/extrinsic-motivations-are-harmful/">some researchers' conclusions</a>.</p>
<p>I'm in it for the money – hence, I'll never get bored and lose interest, as long as there's money to be made. I'll dutifully work on the unpleasant parts necessary to get things actually done (and get paid). Not liking programming that much, I try to keep my programs short and easy to maintain and extend – so I can program less.</p>
<p>These are all desirable traits – and not everyone genuinely loving programming has them. Think about it. Who's the better henchman – the psychopath murdering for the thrill, or the coldblooded killer who's in it for an early retirement? Same thing here.</p>
<p>I'm your perfect henchman. Pay me, give me some time alone with your computers, and when you come back, you'll find them doing your bidding. Of this I am not ashamed.</p>
<p>Recently, however, I noticed that I'm no longer the coldblooded henchman I used to be, that I started to enjoy the thrill of the kill for its own sake. And this I cannot admit without blushing.</p>
<p>That's what getting paid does to the weak-minded. It warped my value system. The phases of my transition – or should I say my moral decay – went something like this:</p>
<ol>
<li>I program because they pay me.</li>
<li>Programming is good because they pay me.</li>
<li>Programming is good.</li>
<li>Programming is good! I think I'll go program right now. Or read about it. Or write something about it. All in my spare time.</li>
</ol>
<p>And there you have it. <strong>"Achievement" has been redefined to mean "that thing you get paid for".</strong></p>
<p>This is how I ended up with a website dedicated largely to programming. Then a programming blog on the site and&nbsp;<a href="http://www.embeddedrelated.com/blogs-1/nf/Yossi_Kreinin.php">a similar blog elsewhere</a>. Then came the ultimate downfall: <a href="https://github.com/yosefk">open-source programs on GitHub</a>, written during evenings and weekends.</p>
<p>And I don't regret the writing. Keeping readers' attention on my very dry programming-related subjects is a worthy challenge for any starting storyteller.</p>
<p>But <em>programming for free? Me?</em> <a href="http://www.imdb.com/title/tt0468569/quotes">If you're good at something, never do it for free!</a> Oh, how the weak-minded have fallen.</p>
<p>Sometimes you need to hit rock bottom to begin rising. So it was with me. Realizing that I've just programmed for free for several weekends in a row made me think. Hard.</p>
<p>"I can't believe you," I said to myself. "All this money-chasing at least made some sense. But programming for free? Why not <em>draw</em> in your spare time instead? What's <em>wrong </em>with you?"</p>
<p>"Not so fast," said self. "For free or not, at least here you are doing something you're good at. You know you're good – you get paid for it! Would they pay you for drawing? Not so soon. Maybe never. Even if you're any good. <strong>In fact you'll never know if you're any good. </strong>Not if you're never paid. Nor if you're paid badly, which happens all the time in those arty parts of the world, even to the best. Why not stick to things you're <em>good</em> at – that you <em>know </em>you're good at?"</p>
<p>Could you believe this guy? Well, I wouldn't have any of that.</p>
<p>"You shameless, hypocritical, baiting-and-switching COWARD," I screamed at self at the top of my lungs. "You always said programming was for the money – to buy time, to buy that bloody creative freedom you kept chattering about! And now you say I should keep programming because I got good at it? But of course I got good – I've been doing it all this time! I could have gotten just as good at drawing – <strong>I still can</strong> – if I have the time!"</p>
<p>"And you say that now when I can afford some spare time," I went on, "I should regardless stick to what I'm good at, which by now is programming? Are you hinting that I won't ever draw very well? Is <em>that </em>why you suggested a career in programming in the first place – because you didn't believe I could draw? Was that chanting about needing money one big lie all along? Tell me, you lying bastard! I'm gonna -"</p>
<p>"OK, OK, chill, man, CHILL!" Self looked scared and unsettled. He clearly didn't see it coming. Now he was looking for some way to appease me. "You know," said self, "maybe you're right. Remember how you're always proud of taking a long-term view? Of how you care today about things 5, even 10 years ahead?"</p>
<p>I smiled smugly. Indeed I was proud of my long-term-centered, strategic thinking. <a href="http://en.wikipedia.org/wiki/Bob_Colwell">Bob Colwell</a> – the legendary computer architect – once said that it's the architect's duty to think about the long term, because nobody else will. I <em>so</em> identified with that. (Colwell and I are both computer architects, you see – just, um, of different calibers.)</p>
<p>"Well," said self, "you <em>should</em> be proud. Too many lose sight of the future because of today's small but pressing worries!"</p>
<p>"Yeah, yeah, yeah." I was losing my patience. "Thanks but no thanks for your brown-nosing. Listen, are you playing bait and switch on me again? What does this have to do with drawing?"</p>
<p>"But that's the point – it's the same thing," self exclaimed, "it's about long-term thinking! Sure, in the short term, maybe you're better at programming than drawing. But keep practicing and yes, of course you'll get good at drawing! Use your favorite superpower – your ability to imagine the future vividly, to practically live there – to overcome the temptation to stick to your comfort zone! Secure a better future today! Be the shrewd guy investing in a little unknown startup – yourself the would-be animator – to reap great benefits down the road! Be -"</p>
<p>"I get it. That's what I said though, isn't it? Let's practice – let's draw in the spare time."</p>
<p>"Sure. Sure! You're right," said self submissively. "I'm actually helping you, see? I'm telling you how to use your strengths to take the plunge!"</p>
<p>"Thaaaanks. You know what? We'll …</p></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="http://yosefk.com/blog/a-better-future-animated-post.html">http://yosefk.com/blog/a-better-future-animated-post.html</a></em></p>]]>
            </description>
            <link>http://yosefk.com/blog/a-better-future-animated-post.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-23667083</guid>
            <pubDate>Sun, 28 Jun 2020 06:26:01 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[How we got our AWS bill to around 2% of revenue]]>
            </title>
            <description>
<![CDATA[
Score 292 | Comments 219 (<a href="https://news.ycombinator.com/item?id=23666999">thread link</a>) | @grwthckrmstr
<br/>
June 27, 2020 | https://www.sankalpjonna.com/posts/our-aws-bill-is-2-of-revenue-heres-how-we-did-it | <a href="https://web.archive.org/web/*/https://www.sankalpjonna.com/posts/our-aws-bill-is-2-of-revenue-heres-how-we-did-it">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><p>Server cost is usually not a concern for most funded startups, but for a boot strapped SaaS product like ours,&nbsp; it was important to have an AWS bill that is easy on the pocket and a little more proportional to the MRR.</p><p>‍</p><p>To that end when we started<a href="http://superlemon.xyz/" target="_blank"> superlemon.xyz</a> one of the first things I did was to find ways to consume the least amount of resources on the cloud. We currently serve a traffic of ~ 250 requests per second with our AWS setup.</p><p>‍<br></p><p>Most applications require certain common cloud resources and these include</p><p>‍<br></p><ul role="list"><li>Compute instances</li><li>Database instances</li><li>Caching instances</li><li>CDN&nbsp;</li><li>A web server that acts as a reverse proxy and load balancer</li></ul><p>‍<br></p><div><p>I will now go through each of these resources and talk about both the expensive way and the cheap way to implement them</p></div><p><strong>Compute instances</strong></p><p><strong>‍</strong><br></p><p>When it comes to compute instances, most people go with AWS EC2 instances. EC2 instances are the safest choice to make for running server applications as they are highly configurable, scalable and you can change the configuration on demand according to your needs. However, sometimes you do not really need this level of control on your compute instances and that brings us to <a href="https://aws.amazon.com/free/compute/lightsail/" target="_blank">AWS Lightsail</a>.</p><p>‍<br></p><p>Lightsail as the name suggests is a lightweight version of EC2. Under the hood Lightsail instances are actually EC2 instances, but this is not apparent to the user and unlike the highly configurable EC2, Lightsail comes with a fixed configuration that once you provision cannot be changed. The billing is also a fixed amount per month as opposed to EC2 which is billed by the hour.&nbsp;</p><p>‍<br></p><p>To give you a sense of how much less complicated Lightsail is, please take a look at these screenshots of the EC2 dashboard and Lightsail dashboard.</p><figure id="w-node-7afe1c2bdee3-87eecd11"><p><img src="https://uploads-ssl.webflow.com/5e0b01877436086c8beecd1a/5ef82a451ea3cd05dfd4c146_x93boOZlEeQGL9kcVSXPZyGOX3SNQJfDNyRC0qG3jNDCYeySdZpIgBzYgkVDZqq3DhR92f_Eqdp8sG-vIgkwltIW9ExWhshfDSsb-gd2qCah6E5VjydVhGxO4QFRA5qCR2KXqhP5.png" alt=""></p></figure><p>‍</p><p>‍</p><p>‍</p><figure id="w-node-2074947a61a8-87eecd11"><p><img src="https://uploads-ssl.webflow.com/5e0b01877436086c8beecd1a/5ef737f4a33047deb1c0a4a6_ZMr0t2QqxGgPZ-Grg-TIHjpok_ujhoYzyHLQnsGzlSfLJj0wRrKWFMKNnVDwCoOorYJHs6j4aqKz_NgztOFGNSNc9Fw4nKGrwSRVK7E4hQtDkzE7OXIVaQp0lDjXxwjiKkHN1e3c.png" alt=""></p><figcaption>EC2 dashboard</figcaption></figure><p>‍</p><p>‍</p><p>But we are not here to debate the complexity of EC2 vs Lightsail, so let’s let us talk about the cost.</p><p>An EC2 instance with 2 virtual cores, 4GB RAM and a storage of 80GB costs roughly 37$ a month and a Lightsail instance with the exact same configuration costs 20$ a month which is almost half the cost!</p><p>‍<br></p><p>The only drawback here as previously mentioned is that the instance is fixed and neither the storage nor the compute power can be tweaked later according to spikes in traffic and usage.&nbsp;</p><p>‍<br></p><p>In our case we do not have a need for too much storage on the compute instance, and as for the computing power it was easy for us to simply provision another Lightsail instance when there is an increase in traffic and set it up behind a load balancer. This way our system is still scalable.</p><p><strong>Database instances</strong></p><p><strong>‍</strong><br></p><p>Choosing a database provider for your application can be a tricky decision, but on a high level there is just one thing that is absolutely required for any database provider - the ability to take regular backups of the DB automatically and the ability to restore the database from one of the backups.</p><p>‍<br></p><p>All of this functionality is provided by AWS RDS along with an array of other capabilities like autoscaling of storage, multiple availability zones, etc. However we did not not really need this level of control over the DB for our simple SaaS product, not to mention the fact that RDS would cost us a minimum of 200$ a month with the lowest acceptable configuration.&nbsp;</p><p>‍<br></p><p>Once again our saviour was Lightsail which provides managed Databases with a fixed storage at very cheap prices. Only MySQL and PostgreSQL are available though which was fine with us since I am quite comfortable with MySQL. We have currently provisioned one MySQL DB with 2 vCPUS, 4GB RAM and 120GB SSD and it costs us 60$ a month.</p><p>‍<br></p><p>And as mentioned before Lightsail provides the basic capabilities of backups and restoration.</p><figure id="w-node-e1f43dee380f-87eecd11"><p><img src="https://uploads-ssl.webflow.com/5e0b01877436086c8beecd1a/5ef731c812136072299e133c_Q2n6wprxbcqgh5vI97YqjWYkOYV52HGzRtHXIQFfpgxwlHkGaO8YDv3aO3V-PwM2SI4qxPty6ZMlK0siv1-lAizSl9hf_6RASDqzNrSfEmIeMdu8UeSTsRhu4Sk1Ofg6Uw8CPPuK.png" alt=""></p><figcaption>Database restoration from recent backup</figcaption></figure><p>‍</p><div><p>The drawback here is that the DB will not scale automatically so your will have to make sure that your application does not use storage beyond what is available in the instance you select. We do this by regularly purging our Database of data that is older than X days and data that belongs to users who churned from our app more than X days ago and haven’t come back since.&nbsp;</p></div><p><strong>Caching instances</strong></p><p><strong>‍</strong><br></p><p>For our application we needed a Caching layer as well as the ability to queue up jobs that can be executed asynchronously. The seasoned folks here might have realised that the best tool to use for this is Redis and AWS has a service called ElastiCache which is Redis under the hood.&nbsp;</p><p>‍<br></p><p>Once again this would be a very safe choice to make because it is completely managed and scalable. Our need was a Redis instance with at least 6GB of memory and 2vCPUs and if we went with ElastiCache our cost would roughly come out to be 112$ a month, not to mention the additional cost of running our async workers somewhere else.</p><p>‍<br></p><p>I might sound like a broken record at this point but what we ended up doing was to provision a Lightsail instance with 2vCPUs and 8GB of memory for the cost of 40$ a month and installed an open source version of Redis on this instance. We also use the same instance to run our asynchronous workers which read from the Redis queue and execute jobs.&nbsp;</p><p>‍<br></p><p>So what is the drawback? Well since it is not a managed service, you would have to monitor the Redis server yourself. There are many tools out there that help you do this and the one I would recommend is<a href="http://prometheus.io/" target="_blank"> prometheus.io</a>.</p><p>‍<br></p><p>This means that you have to do a little bit of extra work to setup metrics collection from your Redis instance and use a grafana dashboard where you can view these metrics, but this extra work saves a lot of money in the long run and you get to look at a super cool dashboard like this one</p><figure id="w-node-ed9ef23d383f-87eecd11"><p><img src="https://uploads-ssl.webflow.com/5e0b01877436086c8beecd1a/5ef71b6832df460f9189c1ef_8fAYGJqB0CXvglSTkg-wXPXqpKi2e3fusNyMcOaiepfnZ-dC1kjn2Do44sILw5lbKOSISB1CMTEdCzyqBcyggDwK4tJcDEA17xkWXb2J1tUjLHBJgtMa_t3ekfIUfOiImx5IaZd6.png" alt=""></p><figcaption>Grafana dashboard for monitoring redis instance</figcaption></figure><p><strong>CDN</strong></p><p><strong>‍</strong><br></p><p>Our application requires a javascript file to be loaded into the websites of our customers. This JS file gets a ton of traffic because this traffic scales according to how many visitors our customers get. Now this can be scary because it means we really had no idea how many requests the JS file might actually end up receiving so we hesitated to go with CloudFront which is the goto solution for a CDN on AWS.&nbsp;</p><p>‍<br></p><p>So we ended up taking an entirely different approach for this. Our application is a Shopify app and during the process of building the application we created a Shopify store. Every Shopify store gets its own personal CDN where you can manually upload anything and it will be served over the Shopify CDN. So we minified and uploaded our JS file to the CDN of our Shopify store and now we serve 20000 Shopify stores using this method at zero cost.</p><figure id="w-node-78b80f124ebd-87eecd11"><p><img src="https://uploads-ssl.webflow.com/5e0b01877436086c8beecd1a/5ef71b68374cfd3932d127f5_z2vfALB6_5FJXMp4al-65PIczwKOE-wUb0TubqBXAFMiu0rnqPEKGAOl12Saf0Xn-Ay1DjWL7wIj7Vby1sNPfLHkpuXzHf17ytoJ5gQvql13DZl1BsIV2rJPeHgfnCnIdezWiddG.png" alt=""></p><figcaption>Shopify CDN&nbsp;that is free of cost</figcaption></figure><p>There is a glaring drawback to this approach. The Shopify store CDN does not provide an API that you can use to programmatically upload files and it has to be done manually. Also unlike CloudFront, there is no option of invalidating a file once it is uploaded. So If you have to make updates to your file you would have to upload a new file and migrate all of your existing users to this new file.&nbsp;<br></p><p>‍</p><p>This might sound like a big drawback, but it actually took me an hour to whip up a script that updates the JS file for all our existing 20000 stores to the updated JS file that I provide. So whenever I make a new release to this JS file, I simply upload a new file manually to the CDN, then take that file as the input and run this script and we re live! This approach works for us because we do not make too many releases to the JS&nbsp;file to begin with.</p><p><strong>Web server + load balancer</strong></p><p><strong>‍</strong><br></p><p>Every application requires the ability to route requests coming to their domain or subdomain to various applications running under the hood. The best way to do this is to use AWS ELB which can be used to automatically distribute incoming application traffic across multiple targets, such as Amazon EC2 instances, containers, IP addresses, and Lambda functions.&nbsp;</p><p>‍<br></p><p>This sounds quite fancy, but all we needed for our product was 4 things</p><p>‍</p><ul role="list"><li>Serving static files for our application dashboard</li><li>Distribute traffic among different Lightsail instances based on the path of the incoming URL</li><li>Load balance traffic that comes from our Merchants Shopify stores amongst N identical Lightsail instances.</li><li>Rate limiting of requests to prevent DDOS attacks.</li></ul><p>‍<br></p><p>All of this can be done using NGINX which is a great piece of software and is quite robust even with the default settings that it comes with.&nbsp;<br></p><p>So we simply installed a stable version of NGINX on one of our existing Lightsail instances which was already being used to host one of our server applications. We also use<a href="http://amplify.nginx.com/" target="_blank"> amplify.nginx.com</a> for monitoring it. This setup is pretty much equivalent to using a managed service at zero cost.</p><p>‍</p><figure id="w-node-26b2c44e15ee-87eecd11"><p><img src="https://uploads-ssl.webflow.com/5e0b01877436086c8beecd1a/5ef730c34b26677e785fa7ea_w67-tKkFsy_LekSEhO_PXqnHGxDiREqENBgMBaEAOqotyjEDJoKXRk6Wpd5K86OOv2z_S-ejGOnL37l6lj6MWqE_x2ZvrIZ4FCQraAC1uDWMne7yi0Fme4Jap2sp2uH2zrKdvpTz.png" alt=""></p><figcaption>Amplify dashboard for monitoring health of the NGINX server</figcaption></figure><p>‍</p><p><strong>Summary</strong></p><p>‍</p><ul role="list"><li>Use lightsail instances (20$ per instance) instead of EC2 instances (37$ per instance)</li><li>Use a lightsail database (60$ per DB) instead of RDS (200$ per DB)</li><li>Use a self hosted redis server on a compute instance (40$) instead of ElastiCache (112$)&nbsp;</li><li>If feasible, use a free CDN (cost savings depends on traffic size)</li><li>Use a self hosted NGINX server (20$ fixed cost) instead of ELB (cost depends on traffic and usage)</li></ul><p><strong>Closing notes</strong></p><p><strong>‍</strong><br></p><p>I would like to put emphasis on the fact that we are a micro-SaaS product that solves a small and specific use case and therefore this kind of AWS setup worked for us. This may not work for big organisations or products where the traffic is erratic.&nbsp;</p><p>This setup will also not work for folks who have a ton of stuff to do already and would prefer to use managed services and not take the additional headache of monitoring, maintaining and provisioning hardware resources on a regular basis because this has a time cost to it.</p><p>We are a team of 2 people with a product that is not computation heavy and has cloud requirements that are quite straightforward. We have been running this product for a little over 1 year with this AWS setup and so far we have not encountered any problems.</p></div></div>]]>
            </description>
            <link>https://www.sankalpjonna.com/posts/our-aws-bill-is-2-of-revenue-heres-how-we-did-it</link>
            <guid isPermaLink="false">hacker-news-small-sites-23666999</guid>
            <pubDate>Sun, 28 Jun 2020 05:58:10 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Adventures in booting Linux on Raspberry Pi 4]]>
            </title>
            <description>
<![CDATA[
Score 81 | Comments 39 (<a href="https://news.ycombinator.com/item?id=23666564">thread link</a>) | @todsacerdoti
<br/>
June 27, 2020 | https://blog.mostlypointless.dev/posts/net-boot-rpi/ | <a href="https://web.archive.org/web/*/https://blog.mostlypointless.dev/posts/net-boot-rpi/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
    <article>
        
        
            <span> Jun 26, 2020</span>
            
                <a href="https://blog.mostlypointless.dev/tags/linux">linux</a>
            
                <a href="https://blog.mostlypointless.dev/tags/raspberry-pi">raspberry pi</a>
            
        
        <p>Almost two months ago, I started building a four node Raspberry Pi 4 cluster for a project I’m working on. Figuring out the best way to get Linux on each node lead me down a rabbit hole and I spent the next four weeks <a href="http://www.catb.org/~esr/jargon/html/Y/yak-shaving.html">yak shaving</a>.</p>
<p>The most common way to boot a Pi is from an SD card. But they are slow and unreliable - I don’t like them. Certain models of Pi 2 and Pi 3 support <a href="https://www.raspberrypi.org/documentation/hardware/raspberrypi/bootmodes/msd.md">booting from USB storage</a>, but Pi 4 cannot do that yet. So, I’m stuck with using an SD card for each Pi. Or so I thought.</p>
<h3 id="enter-pxe-boot">Enter PXE boot</h3>
<p>Turns out, Raspberry Pi 2 and 3 also <a href="https://www.raspberrypi.org/documentation/hardware/raspberrypi/bootmodes/net.md">support network booting</a>. A beta firmware was released late last year that enables <a href="https://en.wikipedia.org/wiki/Preboot_Execution_Environment">PXE</a> for Pi 4. I found <a href="https://linuxhit.com/raspberry-pi-pxe-boot-netbooting-a-pi-4-without-an-sd-card">an article on LinuxHit</a> detailing the process of installing the firmware and setting up network boot.</p>
<p>Just to test this out, I updated the firmware and configured PXE server on one of the Pis. I tried booting another Pi over the network and…it worked!
Here is the gist of PXE server setup process:</p>
<ol>
<li>Copy the contents of <code>/boot</code> and the rest of <code>/</code> into separate folders on your local filesystem. I copied mine to <code>/tftp/raspbian-boot</code> and <code>/nfs/raspbian-root</code> respectively.</li>
<li>Install and configure <code>dnsmasq</code> to enable TFTP and use <code>/tftp</code> as <code>tftp-root</code></li>
<li>Install and configure NFS server to share <code>/tftp/raspbian-boot</code> and <code>/nfs/raspbian-root</code></li>
<li>Edit the contents of <code>/nfs/raspbian-root/fstab</code> to mount the boot partition.</li>
<li>Edit <code>/nfs/raspbian-boot/cmdline.txt</code> to</li>
</ol>
<div><pre><code data-lang="bash">console<span>=</span>serial0,115200 console<span>=</span>tty1 root<span>=</span>/dev/nfs nfsroot<span>=</span>&lt;IP addr&gt;:/nfs/raspbian-root,vers<span>=</span>4.1,proto<span>=</span>tcp rw ip<span>=</span>dhcp rootwait elevator<span>=</span>deadline
</code></pre></div><h3 id="pxe-booting-3-nodes-using-overlayfs">PXE booting 3 nodes using OverlayFS</h3>
<p>I cannot just boot all three nodes from the same boot and root filesystems since they are not read-only. And I don’t want to maintain a copy of these for each node. But this is a solved problem - Docker already lets you spin up multiple containers from a single base image. So I’ll just do <a href="https://docs.docker.com/storage/storagedriver/overlayfs-driver/#how-the-overlay2-driver-works">what Docker does</a> - create <a href="https://www.kernel.org/doc/html/latest/filesystems/overlayfs.html">OverlayFS</a> for each node using raspbian-root and raspbian-boot as my lower directories. I’ll share them over NFS like before.</p>
<p>Configuration for one of the nodes is below. Other two nodes follow the same pattern. Note that I moved raspbian-root and raspbian-boot to a USB hard drive (mounted at <code>/mnt</code>) to get better r/w performance. dc-a6-32-XX-XX-XX is the MAC address of the node. I’m using <code>tftp-unique-root=mac</code> option in <code>dnsmasq</code> to maintain a separate boot environment for each node based on its MAC address.</p>
<div><pre><code data-lang="bash">$ mount -t overlay nog-boot -o lowerdir<span>=</span>/mnt/raspbian-boot,upperdir<span>=</span>/mnt/upper/nog-boot,workdir<span>=</span>/mnt/work/nog-boot -o nfs_export<span>=</span>on -o index<span>=</span>on -o redirect_dir<span>=</span>nofollow /tftpboot/dc-a6-32-XX-XX-XX

$ mount -t overlay nog-root -o lowerdir<span>=</span>/mnt/raspbian-root,upperdir<span>=</span>/mnt/work/nog-root,workdir<span>=</span>/mnt/work/nog-root -o nfs_export<span>=</span>on -o index<span>=</span>on -o redirect_dir<span>=</span>nofollow /nfs/nog

$ cat /tftpboot/dc-a6-32-XX-XX-XX/cmdline.txt
console<span>=</span>serial0,115200 console<span>=</span>tty1 root<span>=</span>/dev/nfs nfsroot<span>=</span>&lt;IP addr&gt;:/nfs/nog,vers<span>=</span>4.1,proto<span>=</span>tcp rw ip<span>=</span>dhcp rootwait elevator<span>=</span>deadline
</code></pre></div><p>(In case you are wondering what <code>nog</code> is: I name my servers after planets from the Star Wars universe. Following this tradition, I’ve named the Pis Mandalore (PXE server), Nog, Ordo and Werda)</p>
<p>You are probably thinking that this worked. It did not.</p>
<p>NFS and OverlayFS did not play nice with each other. After a weekend trying to work around some weird issues, I gave up.</p>
<p>But OverlayFS is not the only copy-on-write filesystem in existence, is it? ZFS and BTRFS offer <a href="https://btrfs.wiki.kernel.org/index.php/Manpage/btrfs-subvolume">subvolumes and snapshots</a> that I can use instead. But not before I <del>procrastinate</del> spend 2 weeks deciding which one to use.</p>
<h3 id="moving-to-btrfs">Moving to BTRFS</h3>
<p>The plan is simple: I’ll create a subvolume each for raspbian-root and raspbian-boot. I’ll then create three snapshots of each subvolume - one for every node. I created a <a href="https://en.wikipedia.org/wiki/RAS_syndrome">btrfs file system</a> on my external drive and ran the following commands</p>
<div><pre><code data-lang="bash">$ btrfs subvolume create raspbian-root
$ btrfs subvolume create raspbian-boot

<span># Repeat the following for each node changing folder names as necessary</span>
$ btrfs subvolume snapshot raspbian-boot nog-boot
$ btrfs subvolume snapshot raspbian-root nog-root
$ mount --bind /mnt/nog-boot /tftpboot/dc-a6-32-XX-XX-XX
$ mount --bind /mnt/nog-root /nfs/nog

<span># Don’t forget to edit cmdline.txt for each node</span>
$ cat /tftpboot/dc-a6-32-XX-XX-XX/cmdline.txt
console<span>=</span>serial0,115200 console<span>=</span>tty1 root<span>=</span>/dev/nfs nfsroot<span>=</span>&lt;IP addr&gt;:/nfs/nog,vers<span>=</span>4.1,proto<span>=</span>tcp rw ip<span>=</span>dhcp rootwait elevator<span>=</span>deadline
</code></pre></div><p>Well, this worked! I have a Pi running without an SD card!! Now all I have to do is create systemd unit files to start all required services and mount snapshots. I can finally start working on my project.</p>
<p>Wait a minute. Take a closer look at the output of <code>cat /tftpboot/dc-a6-32-XX-XX-XX/cmdline.txt</code>.
If you are like me, you will realize for the first time that <code>root=</code> in this file defines where the root filesystem will be mounted from. Right now, we are telling it to mount from <code>/dev/nfs</code>. What if I attach an external drive and set <code>root=</code> to point to the external drive?</p>
<h3 id="network-booting-into-a-usb-hard-drive">Network booting into a USB hard drive</h3>
<p>RPi 4 cannot directly boot from a USB drive. As in - it cannot find <code>/boot</code> on a USB drive when powering on. But what if we provide <code>/boot</code> with network boot and mount <code>/</code> from a USB drive using <code>cmdline.txt</code>? Time to test.</p>
<p>I copied raspbian-root to a USB drive, edited <code>fstab</code> to mount <code>/</code> using the partition’s PARTUUID and connected it to Nog. I then updated the contents of <code>/tftpboot/dc-a6-32-XX-XX-XX/cmdline.txt</code>.</p>
<div><pre><code data-lang="bash">$ cat /tftpboot/dc-a6-32-XX-XX-XX/cmdline.txt
 console<span>=</span>serial0,115200 console<span>=</span>tty1 root<span>=</span>PARTUUID<span>=</span>c1f95d14-01 rootfstype<span>=</span>ext4 elevator<span>=</span>deadline fsck.repair<span>=</span>yes rootwait
</code></pre></div><p>After a couple of reboots, it worked! I now have a RPi 4 running off a USB hard drive!</p>
<h3 id="what-did-i-gain">What did I gain?</h3>
<p>Let’s start with what I was looking for. All I wanted was to not deal with SD cards because they are slow and unreliable. Reliability is relative - everything fails at some point. But a decent quality USB hard drive will likely outlive an SD card. So let’s just look at some read/write performance numbers and see how they compare.</p>
<div><pre><code data-lang="bash">$ sync; dd <span>if</span><span>=</span>/dev/zero of<span>=</span>twogeefile bs<span>=</span>1M count<span>=</span>2048; sync  <span># Write performance</span>
$ sudo sh -c <span>"sync &amp;&amp; echo 3 &gt; /proc/sys/vm/drop_caches"</span>
$ dd <span>if</span><span>=</span>twogeefile of<span>=</span>/dev/null bs<span>=</span>1M count<span>=</span><span>2048</span>              <span># Read performance</span>
</code></pre></div><table>
<thead>
<tr>
<th>Storage</th>
<th>Read (MB/s)</th>
<th>Write (MB/s)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sandisk Ultra MicroSDXC Class 10</td>
<td>45.7</td>
<td>20.2</td>
</tr>
<tr>
<td>Network Boot with BTRFS</td>
<td>63.3</td>
<td>18.8</td>
</tr>
<tr>
<td>/ mounted from USB hard drive</td>
<td>113.0</td>
<td>92.7</td>
</tr>
</tbody>
</table>
<p>With network boot, I was able to get read and write speeds similar to a class 10 SD card. Note that the boot images are hosted on a USB hard drive connected to Mandalore (PXE server). NFS seems to be the bottleneck here - raw r/w speeds of the hard drive are much better than this. All Pis are connected to Netgear’s 8 port gigabit ethernet switch.</p>
<p>To no one’s surprise, things improve considerably when Pis are running off a USB hard disk. Note that the external drives I used are 5400RPM hard disks repurposed from very old MacBooks. I bought them on eBay for $10 a pop. YMMV.</p>
<h3 id="current-setup">Current setup</h3>
<p>Right now, I have Mandalore booting from an SD card and <code>/</code> mounted from a USB hard disk. Nog, Ordo and Werda fetch <code>/boot</code> from Mandalore over the network and <code>/</code> mounted from a USB hard disk.</p>
<p><img src="https://blog.mostlypointless.dev/img/pi-cluster.jpg" alt="from top to bottom - Mandalore, Nog, Ordo, Werda"></p>
<p>I can finally start working on my proj… wait, what?</p>
<p><a href="https://www.tomshardware.com/how-to/boot-raspberry-pi-4-usb">A new beta firmware is out for RPi 4 that lets you boot from USB drives directly.</a></p>
<p>Oh well…</p>
<p>¯\_(ツ)_/¯</p>
<p><em><strong>Update:</strong> This post was discussed on <a href="https://news.ycombinator.com/item?id=23666564">Hacker News</a>. As jordybg <a href="https://news.ycombinator.com/item?id=23667247">points out</a>, USB boot is no longer “beta” and is available in the latest (2020-06-15) “stable” firmware release.</em></p>

        
    </article>
</div></div>]]>
            </description>
            <link>https://blog.mostlypointless.dev/posts/net-boot-rpi/</link>
            <guid isPermaLink="false">hacker-news-small-sites-23666564</guid>
            <pubDate>Sun, 28 Jun 2020 03:28:48 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[WebTransport API]]>
            </title>
            <description>
<![CDATA[
Score 111 | Comments 62 (<a href="https://news.ycombinator.com/item?id=23666364">thread link</a>) | @Jarred
<br/>
June 27, 2020 | https://wicg.github.io/web-transport/ | <a href="https://web.archive.org/web/*/https://wicg.github.io/web-transport/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
   <h2 data-level="1" id="introduction"><span>1. </span><span>Introduction</span><a href="#introduction"></a></h2>
   <p><em>This section is non-normative.</em></p>
   <p>This specification uses pluggable protocols, with QUIC <a data-link-type="biblio" href="#biblio-quic-transport">[QUIC-TRANSPORT]</a> as
one such protocol, to send data to and receive data from servers. It can be
used like WebSockets but with support for multiple streams, unidirectional
streams, out-of-order delivery, and reliable as well as unreliable transport.</p>
   <p role="note"><span>Note:</span> The API presented in this specification represents a preliminary proposal
based on work-in-progress within the IETF QUIC WG. Since the QUIC transport
specification is a work-in-progress, both the protocol and API are likely to
change significantly going forward.</p>
   <h2 data-level="2" id="conformance"><span>2. </span><span>Conformance</span><a href="#conformance"></a></h2>
   <p>As well as sections marked as non-normative, all authoring guidelines,
diagrams, examples, and notes in this specification are non-normative.
Everything else in this specification is normative.</p>
   <p>The key words <em>MUST</em> and <em>SHOULD</em> are to be interpreted as described in <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a>.</p>
   <p>This specification defines conformance criteria that apply to a single product:
the user agent that implements the interfaces that it contains.</p>
   <p>Conformance requirements phrased as algorithms or specific steps may be
implemented in any manner, so long as the end result is equivalent. (In
particular, the algorithms defined in this specification are intended to be
easy to follow, and not intended to be performant.)</p>
   <p>Implementations that use ECMAScript to implement the APIs defined in this
specification MUST implement them in a manner consistent with the ECMAScript
Bindings defined in the Web IDL specification <a data-link-type="biblio" href="#biblio-webidl">[WEBIDL]</a>, as this
specification uses that specification and terminology.</p>
   <h2 data-level="3" id="terminology"><span>3. </span><span>Terminology</span><a href="#terminology"></a></h2>
   <p>The <code><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webappapis.html#eventhandler" id="ref-for-eventhandler">EventHandler</a></code> interface, representing a callback used for event
handlers, and the <code><a data-link-type="idl" href="https://html.spec.whatwg.org/multipage/webappapis.html#errorevent" id="ref-for-errorevent">ErrorEvent</a></code> interface are defined in <a data-link-type="biblio" href="#biblio-html">[HTML]</a>.</p>
   <p>The concepts <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#queue-a-task" id="ref-for-queue-a-task">queue a task</a> and <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#networking-task-source" id="ref-for-networking-task-source">networking task source</a> are defined in <a data-link-type="biblio" href="#biblio-html">[HTML]</a>.</p>
   <p>The terms <a data-link-type="dfn" href="https://dom.spec.whatwg.org/#concept-event" id="ref-for-concept-event">event</a>, <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handlers" id="ref-for-event-handlers">event handlers</a> and <a data-link-type="dfn" href="https://html.spec.whatwg.org/multipage/webappapis.html#event-handler-event-type" id="ref-for-event-handler-event-type">event handler event types</a> are
defined in <a data-link-type="biblio" href="#biblio-html">[HTML]</a>.</p>
   <p>When referring to exceptions, the terms <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-throw" id="ref-for-dfn-throw">throw</a> and <a data-link-type="dfn" href="https://heycam.github.io/webidl/#dfn-create-exception" id="ref-for-dfn-create-exception">create</a> are defined in <a data-link-type="biblio" href="#biblio-webidl">[WEBIDL]</a>.</p>
   <p>The terms <a data-link-type="dfn" href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-promise-objects" id="ref-for-sec-promise-objects">fulfilled</a>, <a data-link-type="dfn" href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-promise-objects" id="ref-for-sec-promise-objects①">rejected</a>, <a data-link-type="dfn" href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-promise-objects" id="ref-for-sec-promise-objects②">resolved</a>, <a data-link-type="dfn" href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-promise-objects" id="ref-for-sec-promise-objects③">pending</a> and <a data-link-type="dfn" href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-promise-objects" id="ref-for-sec-promise-objects④">settled</a> used in the context of Promises are defined in <a data-link-type="biblio" href="#biblio-ecmascript-60">[ECMASCRIPT-6.0]</a>.</p>
   <p>The terms <code><a data-link-type="idl" href="https://streams.spec.whatwg.org/#readablestream" id="ref-for-readablestream">ReadableStream</a></code> and <code><a data-link-type="idl" href="https://streams.spec.whatwg.org/#writablestream" id="ref-for-writablestream">WritableStream</a></code> are defined in <a data-link-type="biblio" href="#biblio-whatwg-streams">[WHATWG-STREAMS]</a>.  Note that despite sharing the name "stream", these are
distinct from the IncomingStream, OutgoingStream, and BidirectionalStream
defined here. The IncomingStream, OutgoingStream, and BidirectionalStream
defined here correspend to a higher level of abstraction that contain and
depend on the lower-level concepts of "streams" defined in <a data-link-type="biblio" href="#biblio-whatwg-streams">[WHATWG-STREAMS]</a>.</p>
   <h2 data-level="4" id="unidirectional-streams-transport"><span>4. </span><span><code>UnidirectionalStreamsTransport</code> Mixin</span><a href="#unidirectional-streams-transport"></a></h2>
   <p>A <dfn data-dfn-type="interface" data-export="" id="unidirectionalstreamstransport"><code>UnidirectionalStreamsTransport</code></dfn> can send and receive
unidirectional streams.  Data within a stream is delivered in order, but data
between streams may be delivered out of order.  Data is generally sent
reliably, but retransmissions may be disabled or the stream may aborted to
produce a form of unreliability.  All stream data is encrypted and
congestion-controlled.</p>
<pre><c- b="">interface</c-> <c- b="">mixin</c-> <a data-link-type="interface" href="#unidirectionalstreamstransport" id="ref-for-unidirectionalstreamstransport"><c- g="">UnidirectionalStreamsTransport</c-></a> {
  <c- b="">Promise</c->&lt;<a data-link-type="idl-name" href="#sendstream" id="ref-for-sendstream"><c- n="">SendStream</c-></a>&gt; <a data-link-type="method" href="#dom-unidirectionalstreamstransport-createsendstream" id="ref-for-dom-unidirectionalstreamstransport-createsendstream"><c- g="">createSendStream</c-></a>(<c- b="">optional</c-> <a data-link-type="idl-name" href="#dictdef-sendstreamparameters" id="ref-for-dictdef-sendstreamparameters"><c- n="">SendStreamParameters</c-></a> <dfn data-dfn-for="UnidirectionalStreamsTransport/createSendStream(parameters), UnidirectionalStreamsTransport/createSendStream()" data-dfn-type="argument" data-export="" id="dom-unidirectionalstreamstransport-createsendstream-parameters-parameters"><code><c- g="">parameters</c-></code><a href="#dom-unidirectionalstreamstransport-createsendstream-parameters-parameters"></a></dfn> = {});
  <a data-link-type="idl-name" href="https://streams.spec.whatwg.org/#readablestream" id="ref-for-readablestream①"><c- n="">ReadableStream</c-></a> <a data-link-type="method" href="#dom-unidirectionalstreamstransport-receivestreams" id="ref-for-dom-unidirectionalstreamstransport-receivestreams"><c- g="">receiveStreams</c-></a>();
};
</pre>
   <h3 data-level="4.1" id="#unidirectional-streams-transport-methods"><span>4.1. </span><span>Methods</span><a href="#%23unidirectional-streams-transport-methods"></a></h3>
   <dl>
    <dt data-md=""><dfn data-dfn-for="UnidirectionalStreamsTransport" data-dfn-type="method" data-export="" data-lt="createSendStream(parameters)|createSendStream()" id="dom-unidirectionalstreamstransport-createsendstream"><code>createSendStream()</code></dfn>
    </dt><dd data-md="">
     <p>Creates a <code><a data-link-type="idl" href="#sendstream" id="ref-for-sendstream①">SendStream</a></code> object.</p>
     <p>When <code>createSendStream()</code> method is called, the user agent MUST run the
 following steps:</p>
     <ol>
      <li data-md="">
       <p>Let <var>transport</var> be the <code>UnidirectionalStreamsTransport</code> on which <code>createSendStream</code> is invoked.</p>
      </li><li data-md="">
       <p>If <var>transport</var>’s <code><a data-link-type="idl" href="#dom-webtransport-state" id="ref-for-dom-webtransport-state">state</a></code> is <code>"closed"</code> or <code>"failed"</code>,
  immediately return a new <a data-link-type="dfn" href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-promise-objects" id="ref-for-sec-promise-objects⑤">rejected</a> promise with a newly created <code><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror">InvalidStateError</a></code> and abort these steps.</p>
      </li><li data-md="">
       <p>Let <var>p</var> be a new promise.</p>
      </li><li data-md="">
       <p>Return <var>p</var> and continue the following steps in background.</p>
      </li><li data-md="">
       <p><a data-link-type="dfn" href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-promise-objects" id="ref-for-sec-promise-objects⑥">Resolve</a> <var>p</var> with a newly created <code><a data-link-type="idl" href="#sendstream" id="ref-for-sendstream②">SendStream</a></code> object and <a data-link-type="dfn" href="#add-the-sendstream" id="ref-for-add-the-sendstream">add the
  SendStream</a> to <var>transport</var> when all of the following conditions are met:</p>
       <ol>
        <li data-md="">
         <p>The <var>transport</var>’s <code><a data-link-type="idl" href="#dom-webtransport-state" id="ref-for-dom-webtransport-state①">state</a></code> has transitioned to <code>"connected"</code>.</p>
        </li><li data-md="">
         <p>Stream creation flow control is not being violated by exceeding the
  max stream limit set by the remote endpoint.  For QUIC, this is
  specified in <a data-link-type="biblio" href="#biblio-quic-transport">[QUIC-TRANSPORT]</a>.</p>
        </li><li data-md="">
         <p><var>p</var> has not been <a data-link-type="dfn" href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-promise-objects" id="ref-for-sec-promise-objects⑦">settled</a>.</p>
       </li></ol>
      </li><li data-md="">
       <p><a data-link-type="dfn" href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-promise-objects" id="ref-for-sec-promise-objects⑧">Reject</a> <var>p</var> with a newly created <code><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror①">InvalidStateError</a></code> when all of
  the following conditions are met:</p>
       <ol>
        <li data-md="">
         <p>The <var>transport</var>’s state transitions to <code>"closed"</code> or <code>"failed"</code>.</p>
        </li><li data-md="">
         <p><var>p</var> has not been <a data-link-type="dfn" href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-promise-objects" id="ref-for-sec-promise-objects⑨">settled</a>.</p>
       </li></ol>
     </li></ol>
    </dd><dt data-md=""><dfn data-dfn-for="UnidirectionalStreamsTransport" data-dfn-type="method" data-export="" id="dom-unidirectionalstreamstransport-receivestreams"><code>receiveStreams()</code></dfn>
    </dt><dd data-md="">
     <p>Returns a <code><a data-link-type="idl" href="https://streams.spec.whatwg.org/#readablestream" id="ref-for-readablestream②">ReadableStream</a></code> of <code><a data-link-type="idl" href="#receivestream" id="ref-for-receivestream">ReceiveStream</a></code>s that have been received
 from the remote host.</p>
     <p>When <code>receiveStreams</code> is called, the user agent MUST run the following
 steps:</p>
     <ol>
      <li data-md="">
       <p>Let <var>transport</var> be the <code>UnidirectionalStreamsTransport</code> on which <code>receiveStreams</code> is invoked.</p>
      </li><li data-md="">
       <p>Return the value of the <code><a data-link-type="idl" href="#dom-quictransport-receivedstreams-slot" id="ref-for-dom-quictransport-receivedstreams-slot">[[ReceivedStreams]]</a></code> internal slot.</p>
      </li><li data-md="">
       <p>For each unidirectional stream received, create a corresponding <code><a data-link-type="idl" href="#incomingstream" id="ref-for-incomingstream">IncomingStream</a></code> and insert it into <code><a data-link-type="idl" href="#dom-quictransport-receivedstreams-slot" id="ref-for-dom-quictransport-receivedstreams-slot①">[[ReceivedStreams]]</a></code>. As data
  is received over the unidirectional stream, insert that data into the
  corresponding <code>IncomingStream</code>.  When the remote side closes or aborts
  the stream, close or abort the corresponding <code>IncomingStream</code>.</p>
     </li></ol>
   </dd></dl>
   <h3 data-level="4.2" id="#unidirectional-streams-transport-procedures"><span>4.2. </span><span>Procedures</span><a href="#%23unidirectional-streams-transport-procedures"></a></h3>
   <h4 data-level="4.2.1" id="add-sendstream"><span>4.2.1. </span><span>Add SendStream to UnidirectionalStreamsTransport</span><a href="#add-sendstream"></a></h4>
   
   <h3 data-level="4.3" id="send-stream-parameters"><span>4.3. </span><span>SendStreamParameters Dictionary</span><a href="#send-stream-parameters"></a></h3>
   <p>The <dfn data-dfn-type="dictionary" data-export="" id="dictdef-sendstreamparameters"><code>SendStreamParameters</code></dfn> dictionary includes information
relating to stream configuration.</p>
<pre><c- b="">dictionary</c-> <a data-link-type="dictionary" href="#dictdef-sendstreamparameters" id="ref-for-dictdef-sendstreamparameters①"><c- g="">SendStreamParameters</c-></a> {
};
</pre>
   <h2 data-level="5" id="bidirectional-streams-transport"><span>5. </span><span><code>BidirectionalStreamsTransport</code> Mixin</span><a href="#bidirectional-streams-transport"></a></h2>
   <p>A <dfn data-dfn-type="interface" data-export="" id="bidirectionalstreamstransport"><code>BidirectionalStreamsTransport</code></dfn> can send and receive
bidirectional streams.  Data within a stream is delivered in order, but data
between streams may be delivered out of order. Data is generally sent reliably,
but retransmissions may be disabled or the stream may aborted to produce a form
of unreliability.  All stream data is encrypted and congestion-controlled.</p>
<pre><c- b="">interface</c-> <c- b="">mixin</c-> <a data-link-type="interface" href="#bidirectionalstreamstransport" id="ref-for-bidirectionalstreamstransport"><c- g="">BidirectionalStreamsTransport</c-></a> {
    <c- b="">Promise</c->&lt;<a data-link-type="idl-name" href="#bidirectionalstream" id="ref-for-bidirectionalstream"><c- n="">BidirectionalStream</c-></a>&gt; <a data-link-type="method" href="#dom-bidirectionalstreamstransport-createbidirectionalstream" id="ref-for-dom-bidirectionalstreamstransport-createbidirectionalstream"><c- g="">createBidirectionalStream</c-></a>();
    <a data-link-type="idl-name" href="https://streams.spec.whatwg.org/#readablestream" id="ref-for-readablestream③"><c- n="">ReadableStream</c-></a> <a data-link-type="method" href="#dom-bidirectionalstreamstransport-receivebidirectionalstreams" id="ref-for-dom-bidirectionalstreamstransport-receivebidirectionalstreams"><c- g="">receiveBidirectionalStreams</c-></a>();
};
</pre>
   <h3 data-level="5.1" id="#bidirectional-streams-transport-methods"><span>5.1. </span><span>Methods</span><a href="#%23bidirectional-streams-transport-methods"></a></h3>
   <dl>
    <dt data-md=""><dfn data-dfn-for="BidirectionalStreamsTransport" data-dfn-type="method" data-export="" id="dom-bidirectionalstreamstransport-createbidirectionalstream"><code>createBidirectionalStream()</code></dfn>
    </dt><dd data-md="">
     <p>Creates a <code><a data-link-type="idl" href="#bidirectionalstream" id="ref-for-bidirectionalstream①">BidirectionalStream</a></code> object.</p>
     <p>When <code>createBidirectionalStream</code> is called, the user agent MUST run the
 following steps:</p>
     <ol>
      <li data-md="">
       <p>Let <var>transport</var> be the <code><a data-link-type="idl" href="#bidirectionalstreamstransport" id="ref-for-bidirectionalstreamstransport①">BidirectionalStreamsTransport</a></code> on which <code><a data-link-type="idl" href="#dom-bidirectionalstreamstransport-createbidirectionalstream" id="ref-for-dom-bidirectionalstreamstransport-createbidirectionalstream①">createBidirectionalStream</a></code> is invoked.</p>
      </li><li data-md="">
       <p>If <var>transport</var>’s <code><a data-link-type="idl" href="#dom-webtransport-state" id="ref-for-dom-webtransport-state②">state</a></code> is <code>"closed"</code> or <code>"failed"</code>,
  immediately return a new <a data-link-type="dfn" href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-promise-objects" id="ref-for-sec-promise-objects①⓪">rejected</a> promise with a newly created <code><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror②">InvalidStateError</a></code> and abort these steps.</p>
      </li><li data-md="">
       <p>If <var>transport</var>’s <code><a data-link-type="idl" href="#dom-webtransport-state" id="ref-for-dom-webtransport-state③">state</a></code> is <code>"connected"</code>, immediately
  return a new <a data-link-type="dfn" href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-promise-objects" id="ref-for-sec-promise-objects①①">fulfilled</a> promise with a newly created <code><a data-link-type="idl" href="#bidirectionalstream" id="ref-for-bidirectionalstream②">BidirectionalStream</a></code> object, <a data-link-type="dfn" href="#add-the-bidirectionalstream" id="ref-for-add-the-bidirectionalstream">add the BidirectionalStream</a> to the
  transport and abort these steps.</p>
      </li><li data-md="">
       <p>Let <var>p</var> be a new promise.</p>
      </li><li data-md="">
       <p>Return <var>p</var> and continue the following steps in background.</p>
      </li><li data-md="">
       <p><a data-link-type="dfn" href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-promise-objects" id="ref-for-sec-promise-objects①②">Resolve</a> <var>p</var> with a newly created <code><a data-link-type="idl" href="#bidirectionalstream" id="ref-for-bidirectionalstream③">BidirectionalStream</a></code> object and <a data-link-type="dfn" href="#add-the-bidirectionalstream" id="ref-for-add-the-bidirectionalstream①">add the BidirectionalStream</a> to <var>transport</var> when all of the following
  conditions are met:</p>
       <ol>
        <li data-md="">
         <p>The <var>transport</var>’s <code><a data-link-type="idl" href="#dom-webtransport-state" id="ref-for-dom-webtransport-state④">state</a></code> has transitioned to <code>"connected"</code>.</p>
        </li><li data-md="">
         <p>Stream creation flow control is not being violated by exceeding the
  max stream limit set by the remote endpoint. For QUIC, this is
  specified in <a data-link-type="biblio" href="#biblio-quic-transport">[QUIC-TRANSPORT]</a>.</p>
        </li><li data-md="">
         <p><var>p</var> has not been <a data-link-type="dfn" href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-promise-objects" id="ref-for-sec-promise-objects①③">settled</a>.</p>
       </li></ol>
      </li><li data-md="">
       <p><a data-link-type="dfn" href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-promise-objects" id="ref-for-sec-promise-objects①④">Reject</a> <var>p</var> with a newly created <code><a data-link-type="idl" href="https://heycam.github.io/webidl/#invalidstateerror" id="ref-for-invalidstateerror③">InvalidStateError</a></code> when all of
  the following conditions are met:</p>
       <ol>
        <li data-md="">
         <p>The <var>transport</var>’s state transitions to <code>"closed"</code> or <code>"failed"</code>.</p>
        </li><li data-md="">
         <p><var>p</var> has not been <a data-link-type="dfn" href="http://www.ecma-international.org/ecma-262/6.0/index.html#sec-promise-objects" id="ref-for-sec-promise-objects①⑤">settled</a>.</p>
       </li></ol>
     </li></ol>
    </dd><dt data-md=""><dfn data-dfn-for="BidirectionalStreamsTransport" data-dfn-type="method" data-export="" id="dom-bidirectionalstreamstransport-receivebidirectionalstreams"><code>receiveBidirectionalStreams()</code></dfn>
    </dt><dd data-md="">
     <p>Returns a <code><a data-link-type="idl" href="https://streams.spec.whatwg.org/#readablestream" id="ref-for-readablestream④">ReadableStream</a></code> of <code><a data-link-type="idl" href="#bidirectionalstream" id="ref-for-bidirectionalstream④">BidirectionalStream</a></code>s that have been
 received from the remote host.</p>
     <p>When <code>receiveBidirectionalStreams</code> method is called, the user agent MUST run
 the following steps:</p>
     <ol>
      <li data-md="">
       <p>Let <var>transport</var> be the <code>BidirectionalStreamsTransport</code> on which <code>receiveBidirectionalStreams</code> is invoked.</p>
      </li><li data-md="">
       <p>Return the value of the <code><a data-link-type="idl" href="#dom-quictransport-receivedbidirectionalstreams-slot" id="ref-for-dom-quictransport-receivedbidirectionalstreams-slot">[[ReceivedBidirectionalStreams]]</a></code> internal slot.</p>
      </li><li data-md="">
       <p>For each bidirectional stream received, create a corresponding <code><a data-link-type="idl" href="#bidirectionalstream" id="ref-for-bidirectionalstream⑤">BidirectionalStream</a></code> and insert it into <code><a data-link-type="idl" href="#dom-quictransport-receivedbidirectionalstreams-slot" id="ref-for-dom-quictransport-receivedbidirectionalstreams-slot①">[[ReceivedBidirectionalStreams]]</a></code>.
  As data is received over the bidirectional stream, insert that data into the
  corresponding <code><a data-link-type="idl" href="#bidirectionalstream" id="ref-for-bidirectionalstream⑥">BidirectionalStream</a></code>.  When the remote side closes or aborts
  the stream, close or abort the corresponding <code><a data-link-type="idl" href="#bidirectionalstream" id="ref-for-bidirectionalstream⑦">BidirectionalStream</a></code>.</p>
     </li></ol>
   </dd></dl>
   <h3 data-level="5.2" id="#bidirectional-streams-transport-procedures"><span>5.2. </span><span>Procedures</span><a href="#%23bidirectional-streams-transport-procedures"></a></h3>
   <h4 data-level="5.2.1" id="add-bidirectionalstream"><span>5.2.1. </span><span>Add BidirectionalStream to BidirectionalStreamsTransport</span><a href="#add-bidirectionalstream"></a></h4>
   
   <h2 data-level="6" id="datagram-transport"><span>6. </span><span><code>DatagramTransport</code> Mixin</span><a href="#datagram-transport"></a></h2>
   <p>A <dfn data-dfn-type="interface" data-export="" id="datagramtransport"><code>DatagramTransport</code></dfn> can send and receive datagrams.
Datagrams are sent out of order, unreliably, and have a limited maximum size.
Datagrams are encrypted and congestion controlled.</p>
<pre><c- b="">interface</c-> <c- b="">mixin</c-> <a data-link-type="interface" href="#datagramtransport" id="ref-for-datagramtransport"><c- g="">DatagramTransport</c-></a> {
    <c- b="">readonly</c-> <c- b="">attribute</c-> <a data-link-type="interface" href="https://heycam.github.io/webidl/#idl-unsigned-short" id="ref-for-idl-unsigned-short"><c- b="">unsigned</c-> <c- b="">short</c-></a> <a data-link-type="attribute" data-readonly="" data-type="unsigned short" href="#dom-datagramtransport-maxdatagramsize" id="ref-for-dom-datagramtransport-maxdatagramsize"><c- g="">maxDatagramSize</c-></a>;
    <a data-link-type="idl-name" href="https://streams.spec.whatwg.org/#writablestream" id="ref-for-writablestream①"><c- n="">WritableStream</c-></a> <a data-link-type="method" href="#dom-datagramtransport-senddatagrams" id="ref-for-dom-datagramtransport-senddatagrams"><c- g="">sendDatagrams</c-></a>();
    <a data-link-type="idl-name" href="https://streams.spec.whatwg.org/#readablestream" id="ref-for-readablestream⑤"><c- n="">ReadableStream</c-></a> <a data-link-type="method" href="#dom-datagramtransport-receivedatagrams" id="ref-for-dom-datagramtransport-receivedatagrams"><c- g="">receiveDatagrams</c-></a>();
};
</pre>
   <h3 data-level="6.1" id="datagram-transport-attributes"><span>6.1. </span><span>Attributes</span><a href="#datagram-transport-attributes"></a></h3>
   <dl>
    <dt data-md=""><dfn data-dfn-for="DatagramTransport" data-dfn-type="attribute" data-export="" id="dom-datagramtransport-maxdatagramsize"><code>maxDatagramSize</code></dfn>, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-unsigned-short" id="ref-for-idl-unsigned-short①">unsigned short</a>, readonly</span>
    </dt><dd data-md="">
     <p>The maximum size data that may be passed to <code><a data-link-type="idl" href="#dom-datagramtransport-senddatagrams" id="ref-for-dom-datagramtransport-senddatagrams①">sendDatagrams</a></code>.</p>
   </dd></dl>
   <h3 data-level="6.2" id="datagram-transport-methods"><span>6.2. </span><span>Methods</span><a href="#datagram-transport-methods"></a></h3>
   <dl>
    <dt data-md=""><dfn data-dfn-for="DatagramTransport" data-dfn-type="method" data-export="" id="dom-datagramtransport-senddatagrams"><code>sendDatagrams()</code></dfn>
    </dt><dd data-md="">
     <p>Sends datagrams that are written to the returned <code><a data-link-type="idl" href="https://streams.spec.whatwg.org/#writablestream" id="ref-for-writablestream②">WritableStream</a></code>.</p>
     <p>When <code>sendDatagrams</code> is called, the user agent MUST run the following steps:</p>
     <ol>
      <li data-md="">
       <p>Let <var>transport</var> be the <code><a data-link-type="idl" href="#datagramtransport" id="ref-for-datagramtransport①">DatagramTransport</a></code> on which <code>sendDatagram</code> is
  invoked.</p>
      </li><li data-md="">
       <p>Return the value of the <code><a data-link-type="idl" href="#dom-quictransport-sentdatagrams-slot" id="ref-for-dom-quictransport-sentdatagrams-slot">[[SentDatagrams]]</a></code> internal slot.</p>
     </li></ol>
    </dd><dt data-md=""><dfn data-dfn-for="DatagramTransport" data-dfn-type="method" data-export="" id="dom-datagramtransport-receivedatagrams"><code>receiveDatagrams()</code></dfn>
    </dt><dd data-md="">
     <p>Return the value of the <code><a data-link-type="idl" href="#dom-quictransport-receiveddatagrams-slot" id="ref-for-dom-quictransport-receiveddatagrams-slot">[[ReceivedDatagrams]]</a></code> internal slot.</p>
     <p>For each datagram received, insert it into <code><a data-link-type="idl" href="#dom-quictransport-receiveddatagrams-slot" id="ref-for-dom-quictransport-receiveddatagrams-slot①">[[ReceivedDatagrams]]</a></code>. If too
 many datagrams are queued because the stream is not being read quickly
 enough, drop datagrams to avoid queueing. Implementations should drop older
 datagrams in favor of newer datagrams. The number of datagrams to queue
 should be kept small enough to avoid adding significant latency to packet
 delivery when the stream is being read slowly (due to the reader being slow)
 but large enough to avoid dropping packets when for the stream is not read
 for short periods of time (due to the reader being paused).</p>
   </dd></dl>
   <h2 data-level="7" id="web-transport"><span>7…</span></h2></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://wicg.github.io/web-transport/">https://wicg.github.io/web-transport/</a></em></p>]]>
            </description>
            <link>https://wicg.github.io/web-transport/</link>
            <guid isPermaLink="false">hacker-news-small-sites-23666364</guid>
            <pubDate>Sun, 28 Jun 2020 02:26:47 GMT</pubDate>
        </item>
    </channel>
</rss>
