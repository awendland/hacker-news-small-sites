<rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>
<![CDATA[Hacker News - Small Sites - Score >= 5]]>
        </title>
        <description>
<![CDATA[Hacker News stories from domains that aren't in the top 1M and that have a score of at least 5. Updated nightly via https://github.com/awendland/hacker-news-small-sites]]>
        </description>
        <link>https://news.ycombinator.com</link>
        <generator>RSS for Node</generator>
        <lastBuildDate>Mon, 28 Dec 2020 04:48:01 GMT</lastBuildDate>
        <atom:link href="https://raw.githubusercontent.com/awendland/hacker-news-small-sites/generated/feeds/hn-small-sites-score-5.xml" rel="self" type="application/rss+xml"></atom:link>
        <pubDate>Mon, 28 Dec 2020 04:48:01 GMT</pubDate>
        <language>
<![CDATA[en-US]]>
        </language>
        <managingEditor>
<![CDATA[me@alexwendland.com (Alex Wendland)]]>
        </managingEditor>
        <ttl>240</ttl>
        <item>
            <title>
<![CDATA[Show HN: System for Private Data Management]]>
            </title>
            <description>
<![CDATA[
Score 14 | Comments 1 (<a href="https://news.ycombinator.com/item?id=25542456">thread link</a>) | @dariuszW
<br/>
December 26, 2020 | http://personal-management-system.pl/login | <a href="https://web.archive.org/web/*/http://personal-management-system.pl/login">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
        <div>

            <div>

                <h3>Personal Management System</h3>
                <p><img src="http://personal-management-system.pl/assets/images/logo/smaller.png">
                </p>
                <h4>Login</h4>
                                <form method="post">
                    <p><label>Username:</label>

                                                
                    </p>
                    <p><label>Password:</label>

                                                
                    </p>

                    

                    <div>
                        <div>
                            <div>
                                <p>
                                    <label for="inputCall1">
                                        <span>Remember Me</span>
                                    </label>
                                </p>
                            </div>
                            
                        </div>
                    </div>

                                                                                <div>
                        <p>
                            
                            <a href="https://github.com/Volmarg/personal-management-system" target="_blank"> Github project </a>
                        </p>
                    </div>
                    <div>
                        <p>
                            
                            <a href="https://volmarg.github.io/" target="_blank">Documentation</a>
                        </p>
                    </div>

                </form>

            </div>
        </div>
    </div></div>]]>
            </description>
            <link>http://personal-management-system.pl/login</link>
            <guid isPermaLink="false">hacker-news-small-sites-25542456</guid>
            <pubDate>Sat, 26 Dec 2020 10:03:48 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Manga Guide to Lisp]]>
            </title>
            <description>
<![CDATA[
Score 20 | Comments 1 (<a href="https://news.ycombinator.com/item?id=25541919">thread link</a>) | @joubert
<br/>
December 25, 2020 | http://lambda.bugyo.tk/cdr/mwl/ | <a href="https://web.archive.org/web/*/http://lambda.bugyo.tk/cdr/mwl/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/>Unable to extract article]]>
            </description>
            <link>http://lambda.bugyo.tk/cdr/mwl/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25541919</guid>
            <pubDate>Sat, 26 Dec 2020 06:57:48 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Backdoor in Zyxel Products]]>
            </title>
            <description>
<![CDATA[
Score 121 | Comments 27 (<a href="https://news.ycombinator.com/item?id=25539876">thread link</a>) | @ta988
<br/>
December 25, 2020 | https://www.eyecontrol.nl/blog/undocumented-user-account-in-zyxel-products.html | <a href="https://web.archive.org/web/*/https://www.eyecontrol.nl/blog/undocumented-user-account-in-zyxel-products.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
					<div>
						<div>
							<p>TL;DR: If you have a Zyxel USG, ATP, VPN, ZyWALL or USG FLEX you should update to the latest firmware version today. You can find the full list of affected devices <a href="https://businessforum.zyxel.com/discussion/5252/zld-v4-60-revoke-and-wk48-firmware-release">here</a> and the Zyxel advisory <a href="https://www.zyxel.com/support/CVE-2020-29583.shtml">here</a>.</p>
                            <p>Zyxel is a popular brand for firewalls that are marketed towards small and medium businesses. Their Unified Security Gateway (USG) product line is often used as a firewall or VPN gateway. As a lot of us are working from home, VPN-capable devices have been quite selling well lately.</p>
                            <p>When doing some research (rooting) on my Zyxel USG40, I was surprised to find a user account 'zyfwp' with a password hash in the latest firmware version (4.60 patch 0). The plaintext password was visible in one of the binaries on the system. I was even more surprised that this account seemed to work on both the SSH and web interface.</p>
                            <pre>$ ssh <a href="https://www.eyecontrol.nl/cdn-cgi/l/email-protection" data-cfemail="344e4d52434474050d061a05020c1a051a060106">[email&nbsp;protected]</a>
Password: Pr*******Xp
Router&gt; show users current
No: 1
  Name: zyfwp
  Type: admin
(...)
Router&gt;</pre>
                            <p>The user is not visible in the interface and its password cannot be changed. I checked the previous firmware version (4.39) and although the user was present, it did not have a password. It seemed the vulnerability had been introduced in the latest firmware version. Even though older versions do not have this vulnerability, they do have others (such as this <a href="https://www.zyxel.com/us/en/support/Zyxel-security-advisory-for-buffer-overflow-vulnerability.shtml">buffer overflow</a>) so you should still update.</p>
                            <p>As SSL VPN on these devices operates on the same port as the web interface, a lot of users have exposed port 443 of these devices to the internet. Using publicly available data from Project Sonar, I was able to identify about 3.000 Zyxel USG/ATP/VPN devices in the Netherlands. Globally, more than 100.000 devices have exposed their web interface to the internet.</p>
                            <p>In our experience, most users of these devices will not update the firmware very often. Zyxel devices do not expose their firmware version to unauthenticated users, so determining if a device is vulnerable is a bit more difficult. We wanted to get an idea of the amount of affected devices, but simply trying the password is not really an option (ethically and legally). Luckily, some javascript and css files can be requested from the web interface of these devices without authentication. These files seem to change with every firmware release. Using this information, we can obtain a unique fingerprint of the vulnerable firmware version. We used this information to identify the firmware version of 1.000 devices in The Netherlands and found that around 10% of devices are running the affected firmware version. Zyxel does offer automatic updates, but these are not enabled by default. Luckily, we were able to find this vulnerability just a few weeks after it had been introduced, or the number of affected devices could have been much larger.</p>
                            <p>As the zyfwp user has admin privileges, this is a serious vulnerability. An attacker could completely compromise the confidentiality, integrity and availability of the device. Someone could for example change firewall settings to allow or block certain traffic. They could also intercept traffic or create VPN accounts to gain access to the network behind the device.  Combined with a vulnerability like Zerologon this could be devastating to small and medium businesses.</p>
                            <p>Because of the seriousness of the vulnerability and it being so easy to exploit, we have decided not to release the password for this account at this time. We do expect others to find and release it, which is why we suggest you install the updated firmware as soon as possible.</p>
                            <p>I quickly sent out a mail to Zyxel to report the undocumented user account. According to Zyxel, the account was designed to deliver automatic firmware updates for access points via FTP. They released a fixed firmware version less than two weeks later. You can find the release notes for the USG40 <a href="ftp://ftp.zyxel.com/USG40/firmware/USG40_4.60(AALA.1)C0_2.pdf">here</a>.</p>
                            <p>This is the entry in the release notes that describes this vulnerability:</p>
                            <pre>[BUG FIX][CVE-2020-29583]
a. Vulnerability fix for undocumented user account.</pre>
                            <p>We would like to thank the Zyxel Security Team for their quick response and patch.</p>
                            <p><b>Disclosure timeline</b></p>
                            <p>2020-11-29: EYE reports vulnerability to Zyxel security</p>
                            <p>2020-11-30: Zyxel acknowledges receipt</p>
                            <p>2020-12-02: Zyxel requests more information about how the vulnerability was discovered</p>
                            <p>2020-12-03: EYE sends more details</p>
                            <p>2020-12-08: Zyxel releases beta firmware 4.60-WK48 and removes the vulnerable firmware version from their site</p>
                            <p>2020-12-15: Zyxel releases firmware 4.60 patch 1 for most devices</p>
                            <p>2020-12-18: Zyxel releases firmware 4.60 patch 1 for all remaining devices</p>
                            <p>2020-12-23: Zyxel publishes <a href="https://www.zyxel.com/support/CVE-2020-29583.shtml">advisory</a></p>

						</div>
						
					</div>
                </div></div>]]>
            </description>
            <link>https://www.eyecontrol.nl/blog/undocumented-user-account-in-zyxel-products.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-25539876</guid>
            <pubDate>Fri, 25 Dec 2020 23:15:18 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[A Complete Guide to LLVM for Programming Language Creators]]>
            </title>
            <description>
<![CDATA[
Score 284 | Comments 29 (<a href="https://news.ycombinator.com/item?id=25539797">thread link</a>) | @mseri
<br/>
December 25, 2020 | https://mukulrathi.co.uk/create-your-own-programming-language/llvm-ir-cpp-api-tutorial/ | <a href="https://web.archive.org/web/*/https://mukulrathi.co.uk/create-your-own-programming-language/llvm-ir-cpp-api-tutorial/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article><h3>Creating the Bolt Compiler: Part 8</h3><p><h3>December 24, 2020</h3><h3>12 min read</h3></p><nav><h2>Series: Creating the Bolt Compiler</h2><ul><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li><strong>Part 8: A Complete Guide to LLVM for Programming Language Creators</strong></li><li><em>Part 9: Concurrency is a Runtime Feature, Not a Compiler Feature*</em></li><li><em>Part 10: Inheritance and method overriding in Bolt*</em></li><li><em>Part 11: Generics - adding polymorphism to Bolt*</em></li><p>*coming soon! </p></ul></nav><hr><p><strong>Update</strong>: this post has now taken off on <a href="https://news.ycombinator.com/item?id=25539797">Hacker News</a> and <a href="https://www.reddit.com/r/programming/comments/kjjijf/a_complete_guide_to_llvm_for_programming_language/">Reddit</a>. Thank you all!</p><p>I have a small request:</p><div><div><div> <h3>Share This On Twitter</h3><p>If you find this useful, please share on Twitter, thank you!</p></div></div></div><h2 id="whos-this-tutorial-for"><a href="#whos-this-tutorial-for" aria-label="whos this tutorial for permalink"></a>Who’s this tutorial for?</h2><p>This series of compiler tutorials is for people who don’t just want to create a <em>toy</em> language.
You want objects. You want polymorphism. You want concurrency. You want garbage collection. Wait you don’t want GC? Okay, no worries, we won’t do that :P</p><p>If you’ve just joined the series at this stage, here’s a quick recap. We’re designing a Java-esque concurrent object-oriented programming language <em>Bolt</em>. We’ve gone through the compiler frontend, where we’ve done the parsing, type-checking and dataflow analysis. We’ve <a href="https://mukulrathi.co.uk/create-your-own-programming-language/lower-language-constructs-to-llvm/">desugared our language to get it ready for LLVM</a> - the main takeaway is that objects have been desugared to structs, and their methods desugared to functions.</p><p>Learn about LLVM and you’ll be the envy of your friends. Rust uses LLVM for its backend, so it must be cool. You’ll beat them on all those performance benchmarks, without having to hand-optimise your code or write machine assembly code. Shhhh, I won’t tell them.</p><h2 id="just-give-me-the-code"><a href="#just-give-me-the-code" aria-label="just give me the code permalink"></a>Just give me the code!</h2><p>All the code can be found in the <a href="https://github.com/mukul-rathi/bolt">Bolt compiler repository</a>.</p><p>The C++ class definitions for our desugared representation (we call this <em>Bolt IR</em>) can be found in <a href="https://github.com/mukul-rathi/bolt/tree/master/src/llvm-backend/deserialise_ir">deserialise_ir</a> folder. The code for this post (the LLVM IR generation) can be found in the <a href="https://github.com/mukul-rathi/bolt/tree/master/src/llvm-backend/llvm_ir_codegen">llvm_ir_codegen</a> folder. The repo uses the Visitor design pattern and ample use of <code>std::unique_ptr</code> to make memory management easier.</p><p>To cut through the boilerplate, to find out how to generate LLVM IR for a particular language expression, search for the <code>IRCodegenVisitor::codegen</code> method that takes in the corresponding <code>ExprIR</code> object. e.g. for if-else statements:</p><div><div><pre><p><span>Value </span><span>*</span><span>IRCodegenVisitor</span><span>::</span><span>codegen</span><span>(</span><span>const</span><span> ExprIfElseIR </span><span>&amp;</span><span>expr</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>      </span><span>.</span><span>.</span><span>.</span><span> </span><span></span></p><p><span></span><span>}</span></p></pre></div></div><h2 id="understanding-llvm-ir"><a href="#understanding-llvm-ir" aria-label="understanding llvm ir permalink"></a>Understanding LLVM IR</h2><p>LLVM sits in the <strong>middle-end</strong> of our compiler, <em>after</em> we’ve desugared our language features, but <em>before</em> the backends that target specific machine architectures (x86, ARM etc.)</p><p>LLVM’s IR is pretty low-level, it can’t contain language features present in some languages but not others (e.g. classes are present in C++ but not C). If you’ve come across instruction sets before, LLVM IR is a <a href="https://en.wikipedia.org/wiki/Reduced_instruction_set_computer#:~:text=A%20reduced%20instruction%20set%20computer,instruction%20set%20computer%20(CISC).">RISC</a> instruction set.</p><p>The upshot of it is that LLVM IR looks like a more <em>readable</em> form of assembly. As LLVM IR is <strong>machine independent</strong>, we don’t need to worry about the number of registers, size of datatypes, calling conventions or other machine-specific details.</p><p>So instead of a fixed number of physical registers, in LLVM IR we have an unlimited set of <em>virtual</em> registers (labelled <code>%0</code>, <code>%1</code>, <code>%2</code>, <code>%3</code>… we can write and read from. It’s the backend’s job to map from virtual to physical registers.</p><p>And rather than allocating specific sizes of datatypes, we retain <strong>types</strong> in LLVM IR. Again, the backend will take this type information and map it to the size of the datatype. LLVM has types for different sizes of <code>int</code>s and floats, e.g. <code>int32</code>, <code>int8</code>, <code>int1</code> etc. It also has derived types: like <strong>pointer</strong> types, <strong>array</strong> types, <strong>struct</strong> types, <strong>function</strong> types. To find out more, check out the <a href="https://llvm.org/doxygen/classllvm_1_1Type.html">Type</a> documentation.</p><p>Now, built into LLVM are a set of optimisations we can run over the LLVM IR e.g. <a href="https://en.wikipedia.org/wiki/Dead_code_elimination">dead-code elimination</a>, <a href="https://en.wikipedia.org/wiki/Inline_expansion">function inlining</a>, <a href="https://cran.r-project.org/web/packages/rco/vignettes/opt-common-subexpr.html">common subexpression elimination</a> etc. The details of these algorithms are irrelevant: LLVM implements them for us.</p><p>Our side of the bargain is that we write LLVM IR in <a href="https://en.wikipedia.org/wiki/Static_single_assignment_form">Static Single Assignment (SSA) form</a>, as SSA form makes life easier for optimisation writers. SSA form sounds fancy, but it just means we define variables before use and assign to variables <strong>only once</strong>. In SSA form, we cannot reassign to a variable, e.g. <code>x = x+1</code>; instead we assign to a fresh variable each time (<code>x2 = x1 + 1</code>).</p><p>So in short: LLVM IR looks like assembly with <strong>types</strong>, minus the messy machine-specific details. LLVM IR must be in SSA form, which makes it easier to optimise. Let’s look at an example!</p><h3 id="an-example-factorial"><a href="#an-example-factorial" aria-label="an example factorial permalink"></a>An example: Factorial</h3><p>Let’s look at a simple factorial function in our language Bolt:</p><div><p><span>factorial.bolt</span></p><div><pre><p><span>function </span><span>int</span><span> </span><span>factorial</span><span>(</span><span>int</span><span> n</span><span>)</span><span>{</span><span></span></p><p><span>  </span><span>if</span><span> </span><span>(</span><span>n</span><span>==</span><span>0</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>    </span><span>1</span><span></span></p><p><span>  </span><span>}</span><span></span></p><p><span>  </span><span>else</span><span>{</span><span></span></p><p><span>    n </span><span>*</span><span> </span><span>factorial</span><span>(</span><span>n </span><span>-</span><span> </span><span>1</span><span>)</span><span></span></p><p><span>  </span><span>}</span><span></span></p><p><span></span><span>}</span></p></pre></div></div><p>The corresponding LLVM IR is as follows:</p><div><p><span>factorial.ll</span></p><div><pre><p><span>define i32 @</span><span>factorial</span><span>(</span><span>i32</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>entry</span><span>:</span><span></span></p><p><span>  </span><span>%</span><span>eq </span><span>=</span><span> icmp eq i32 </span><span>%</span><span>0</span><span>,</span><span> </span><span>0</span><span>   </span><span></span></p><p><span>  br i1 </span><span>%</span><span>eq</span><span>,</span><span> label </span><span>%</span><span>then</span><span>,</span><span> label </span><span>%</span><span>else</span><span></span></p><p><span>then</span><span>:</span><span>                                             </span><span>;</span><span> preds </span><span>=</span><span> </span><span>%</span><span>entry</span></p><p><span>  br label </span><span>%</span><span>ifcont</span></p><p><span></span><span>else</span><span>:</span><span>                                             </span><span>;</span><span> preds </span><span>=</span><span> </span><span>%</span><span>entry</span></p><p><span>  </span><span>%</span><span>sub </span><span>=</span><span> sub i32 </span><span>%</span><span>0</span><span>,</span><span> </span><span>1</span><span>   </span><span></span></p><p><span>  </span><span>%</span><span>2</span><span> </span><span>=</span><span> call i32 @</span><span>factorial</span><span>(</span><span>i32 </span><span>%</span><span>sub</span><span>)</span><span> </span><span></span></p><p><span>  </span><span>%</span><span>mult </span><span>=</span><span> mul i32 </span><span>%</span><span>0</span><span>,</span><span> </span><span>%</span><span>2</span><span>  </span><span></span></p><p><span>  br label </span><span>%</span><span>ifcont</span></p><p><span>ifcont</span><span>:</span><span>                                           </span><span>;</span><span> preds </span><span>=</span><span> </span><span>%</span><span>else</span><span>,</span><span> </span><span>%</span><span>then</span></p><p><span>  </span><span>%</span><span>iftmp </span><span>=</span><span> phi i32 </span><span>[</span><span> </span><span>1</span><span>,</span><span> </span><span>%</span><span>then </span><span>]</span><span>,</span><span> </span><span>[</span><span> </span><span>%</span><span>mult</span><span>,</span><span> </span><span>%</span><span>else</span><span> </span><span>]</span><span></span></p><p><span>  ret i32 </span><span>%</span><span>iftmp</span></p><p><span></span><span>}</span></p></pre></div></div><p>Note the <code>.ll</code> extension is for <strong>human-readable</strong> LLVM IR output. There’s also <code>.bc</code> for bit-code, a more compact machine representation of LLVM IR.</p><p>We can walk through this IR in 4 levels of detail:</p><h4 id="at-the-instruction-level"><a href="#at-the-instruction-level" aria-label="at the instruction level permalink"></a>At the Instruction Level:</h4><p>Notice how LLVM IR contains assembly instructions like <code>br</code> and <code>icmp</code>, but abstracts the machine-specific messy details of function calling conventions with a single <code>call</code> instruction.</p><p><span>
      <a href="https://mukulrathi.co.uk/static/f987ee45552570ad7aa513f6d3fc19a7/565cc/factorial-instructions.png" target="_blank" rel="noopener">
    <span></span>
  <img alt="Factorial instructions" title="Factorial instructions" src="https://mukulrathi.co.uk/static/f987ee45552570ad7aa513f6d3fc19a7/a6d36/factorial-instructions.png" srcset="https://mukulrathi.co.uk/static/f987ee45552570ad7aa513f6d3fc19a7/222b7/factorial-instructions.png 163w,https://mukulrathi.co.uk/static/f987ee45552570ad7aa513f6d3fc19a7/ff46a/factorial-instructions.png 325w,https://mukulrathi.co.uk/static/f987ee45552570ad7aa513f6d3fc19a7/a6d36/factorial-instructions.png 650w,https://mukulrathi.co.uk/static/f987ee45552570ad7aa513f6d3fc19a7/e548f/factorial-instructions.png 975w,https://mukulrathi.co.uk/static/f987ee45552570ad7aa513f6d3fc19a7/3c492/factorial-instructions.png 1300w,https://mukulrathi.co.uk/static/f987ee45552570ad7aa513f6d3fc19a7/565cc/factorial-instructions.png 1806w" sizes="(max-width: 650px) 100vw, 650px" loading="lazy">
  </a>
    </span></p><h4 id="at-the-control-flow-graph-level"><a href="#at-the-control-flow-graph-level" aria-label="at the control flow graph level permalink"></a>At the Control Flow Graph Level:</h4><p>If we take a step back, you can see the IR defines the <strong>control flow graph</strong> of the program. IR instructions are grouped into labeled <strong>basic blocks</strong>, and the <code>preds</code> labels for each block represent incoming edges to that block. e.g. the <code>ifcont</code> basic block has predecessors <code>then</code> and <code>else</code>:</p><p>At this point, I’m going to assume you have come across Control Flow Graphs and basic blocks. We introduced Control Flow Graphs in a previous post in the series, where we used them to perform different dataflow analyses on the program. I’d recommend you go and check the <a href="http://mukulrathi.co.uk/create-your-own-programming-language/data-race-dataflow-analysis/#control-flow-graph">CFG section of that dataflow analysis post</a> now. I’ll wait here :)</p><p><span>
      <a href="https://mukulrathi.co.uk/static/6a6edf6d916150ea4de92c0fc1a68e1a/11864/factorial-cfg.png" target="_blank" rel="noopener">
    <span></span>
  <img alt="Factorial control flow graph" title="Factorial control flow graph" src="https://mukulrathi.co.uk/static/6a6edf6d916150ea4de92c0fc1a68e1a/a6d36/factorial-cfg.png" srcset="https://mukulrathi.co.uk/static/6a6edf6d916150ea4de92c0fc1a68e1a/222b7/factorial-cfg.png 163w,https://mukulrathi.co.uk/static/6a6edf6d916150ea4de92c0fc1a68e1a/ff46a/factorial-cfg.png 325w,https://mukulrathi.co.uk/static/6a6edf6d916150ea4de92c0fc1a68e1a/a6d36/factorial-cfg.png 650w,https://mukulrathi.co.uk/static/6a6edf6d916150ea4de92c0fc1a68e1a/e548f/factorial-cfg.png 975w,https://mukulrathi.co.uk/static/6a6edf6d916150ea4de92c0fc1a68e1a/3c492/factorial-cfg.png 1300w,https://mukulrathi.co.uk/static/6a6edf6d916150ea4de92c0fc1a68e1a/11864/factorial-cfg.png 2034w" sizes="(max-width: 650px) 100vw, 650px" loading="lazy">
  </a>
    </span></p><p>The <code>phi</code> instruction represents <strong>conditional assignment</strong>: assigning different values depending on which preceding basic block we’ve just come from. It is of the form <code>phi type [val1, predecessor1], [val2, predecessor2], ...</code> In the example above, we set <code>%iftmp</code> to 1 if we’ve come from the <code>then</code> block, and <code>%mult</code> if we’ve come from the <code>else</code> block. Phi nodes must be at the <strong>start</strong> of a block, and include one entry for each predecessor.</p><h4 id="at-the-function-level"><a href="#at-the-function-level" aria-label="at the function level permalink"></a>At the Function Level:</h4><p>Taking another step back, the overall structure of a function in LLVM IR is as follows:</p><p><span>
      <a href="https://mukulrathi.co.uk/static/c80bbba94459a0ac84429c53299823b2/b2b2c/factorial-fn.png" target="_blank" rel="noopener">
    <span></span>
  <img alt="Factorial fn" title="Factorial fn" src="https://mukulrathi.co.uk/static/c80bbba94459a0ac84429c53299823b2/a6d36/factorial-fn.png" srcset="https://mukulrathi.co.uk/static/c80bbba94459a0ac84429c53299823b2/222b7/factorial-fn.png 163w,https://mukulrathi.co.uk/static/c80bbba94459a0ac84429c53299823b2/ff46a/factorial-fn.png 325w,https://mukulrathi.co.uk/static/c80bbba94459a0ac84429c53299823b2/a6d36/factorial-fn.png 650w,https://mukulrathi.co.uk/static/c80bbba94459a0ac84429c53299823b2/e548f/factorial-fn.png 975w,https://mukulrathi.co.uk/static/c80bbba94459a0ac84429c53299823b2/3c492/factorial-fn.png 1300w,https://mukulrathi.co.uk/static/c80bbba94459a0ac84429c53299823b2/b2b2c/factorial-fn.png 1708w" sizes="(max-width: 650px) 100vw, 650px" loading="lazy">
  </a>
    </span></p><h4 id="at-the-module-level"><a href="#at-the-module-level" aria-label="at the module level permalink"></a>At the Module Level:</h4><p>An LLVM <strong>module</strong> contains all the information associated with a program file. (For multi-file programs, we’d link together their corresponding modules.)</p><p><span>
      <a href="https://mukulrathi.co.uk/static/e21edb9623d8fb7bc23f57db23b93cf8/cad61/module.png" target="_blank" rel="noopener">
    <span></span>
  <img alt="LLVM Module" title="LLVM Module" src="https://mukulrathi.co.uk/static/e21edb9623d8fb7bc23f57db23b93cf8/a6d36/module.png" srcset="https://mukulrathi.co.uk/static/e21edb9623d8fb7bc23f57db23b93cf8/222b7/module.png 163w,https://mukulrathi.co.uk/static/e21edb9623d8fb7bc23f57db23b93cf8/ff46a/module.png 325w,https://mukulrathi.co.uk/static/e21edb9623d8fb7bc23f57db23b93cf8/a6d36/module.png 650w,https://mukulrathi.co.uk/static/e21edb9623d8fb7bc23f57db23b93cf8/e548f/module.png 975w,https://mukulrathi.co.uk/static/e21edb9623d8fb7bc23f57db23b93cf8/3c492/module.png 1300w,https://mukulrathi.co.uk/static/e21edb9623d8fb7bc23f57db23b93cf8/cad61/module.png 1988w" sizes="(max-width: 650px) 100vw, 650px" loading="lazy">
  </a>
    </span></p><p>Our <code>factorial</code> function is just one function definition in our module. If we want to execute the program, e.g. to compute <code>factorial(10)</code> we need to define a
<code>main</code> function, which will be the entrypoint for our program’s execution. The <code>main</code> function’s signature is a hangover from C (we return 0 to indicate successful execution):</p><div><p><span>example_program.c</span></p><div><pre><p><span></span><span>int</span><span> </span><span>main</span><span>(</span><span>)</span><span>{</span><span></span></p><p><span>  </span><span>factorial</span><span>(</span><span>10</span><span>)</span><span>;</span><span></span></p><p><span>  </span><span>return</span><span> </span><span>0</span><span>;</span><span></span></p><p><span></span><span>}</span></p></pre></div></div><p>We specify that we want to compile for an Intel Macbook Pro in the module target info:</p><div><p><span>example_module.ll</span></p><div><pre><p><span>source_filename </span><span>=</span><span> </span><span>"Module"</span><span></span></p><p><span>target triple </span><span>=</span><span> </span><span>"x86_64-apple-darwin18.7.0"</span><span></span></p><p><span></span><span>.</span><span>.</span><span>.</span><span></span></p><p><span>define i32 @</span><span>factorial</span><span>(</span><span>i32</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>  </span><span>.</span><span>.</span><span>.</span><span></span></p><p><span></span><span>}</span><span></span></p><p><span>define i32 @</span><span>main</span><span>(</span><span>)</span><span> </span><span>{</span><span></span></p><p><span>entry</span><span>:</span><span></span></p><p><span>  </span><span>%</span><span>0</span><span> </span><span>=</span><span> call i32 @</span><span>factorial</span><span>(</span><span>i32 </span><span>10</span><span>)</span><span></span></p><p><span>  ret i32 </span><span>0</span><span></span></p><p><span></span><span>}</span></p></pre></div></div><h2 id="the-llvm-api-key-concepts"><a href="#the-llvm-api-key-concepts" aria-label="the llvm api key concepts permalink"></a>The LLVM API: Key Concepts</h2><p>Now we’ve got the basics of LLVM IR down, let’s introduce the LLVM API. We’ll go through the key concepts, then introduce more of the API as we explore LLVM IR further.</p><p>LLVM defines a whole host of classes that map to the concepts we’ve talked about.</p><ul><li><code>Value</code></li><li><code>Module</code></li><li><code>Type</code></li><li><code>Function</code></li><li><code>BasicBlock</code></li><li><code>BranchInst</code>
…</li></ul><p>These are all in the namespace <code>llvm</code>. In the Bolt repo, I chose to make this namespacing explicit by referring to them as <code>llvm::Value</code>, <code>llvm::Module</code> etc.)</p><p>Most of the LLVM API is quite mechanical. Now you’ve seen the diagrams that define modules, functions and basic blocks, the relationship between their corresponding classes in the API falls out nicely. You can query a <code>Module</code> object to get a list of its <code>Function</code> objects, and query a <code>Function</code> to get the list of its <code>BasicBlock</code>s, and the other way round: you can query a <code>BasicBlock</code> to get its parent <code>Function</code> object.</p><p><code>Value</code> is the base class for any value computed by the program. This could be a function (<code>Function</code> subclasses <code>Value</code>), a basic block (<code>BasicBlock</code> also subclasses <code>Value</code>), an instruction, or the result of an intermediate computation.</p><p>Each of the expression <code>codegen</code> methods returns a <code>Value *</code>: the result of executing that expression. You can think of these <code>codegen</code> methods as generating the IR for that expression and the <code>Value *</code> representing the virtual register containing the expression’s result.</p><div><p><span><a href="https://github.com/mukul-rathi/bolt/blob/master/src/llvm-backend/llvm_ir_codegen/ir_codegen_visitor.h#L64-L84"> <!-- -->ir_codegen_visitor.h</a></span></p><div><pre><p><span>virtual</span><span> Value </span><span>*</span><span>codegen</span><span>(</span><span>const</span><span> ExprIntegerIR </span><span>&amp;</span><span>expr</span><span>)</span><span> override</span><span>;</span><span></span></p><p><span></span><span>virtual</span><span> Value </span><span>*</span><span>codegen</span><span>(</span><span>const</span><span> ExprBooleanIR </span><span>&amp;</span><span>expr</span><span>)</span><span> override</span><span>;</span><span></span></p><p><span></span><span>virtual</span><span> Value </span><span>*</span><span>codegen</span><span>(</span><span>const</span><span> ExprIdentifierIR </span><span>&amp;</span><span>expr</span><span>)</span><span> override</span><span>;</span><span></span></p><p><span></span><span>virtual</span><span> Value </span><span>*</span><span>codegen</span><span>(</span><span>const</span><span> ExprConstructorIR </span><span>&amp;</span><span>expr</span><span>)</span><span> override</span><span>;</span><span></span></p><p><span></span><span>virtual</span><span> Value </span><span>*</span><span>codegen</span><span>(</span><span>const</span><span> ExprLetIR </span><span>&amp;</span><span>expr</span><span>)</span><span> override</span><span>;</span><span></span></p><p><span></span><span>virtual</span><span> Value </span><span>*</span><span>codegen</span><span>(</span><span>const</span><span> ExprAssignIR </span><span>&amp;</span><span>expr</span><span>)</span><span> override</span><span>;</span></p></pre></div></div><p>How do we generate the IR for these expressions? We create a <strong>unique</strong> <code>Context</code> object to tie our whole code generation together. We use this <code>Context</code> to get access to core LLVM data structures e.g LLVM modules and <code>IRBuilder</code> objects.</p><p>We’ll use the context to create just one module, which we’ll imaginatively name <code>"Module"</code>.</p><div><p><span><a href="https://github.com/mukul-rathi/bolt/blob/master/src/llvm-backend/llvm_ir_codegen/ir_codegen_visitor.cc#L17-L19"> <!-- -->ir_codegen_visitor.cc</a></span></p><div><pre><p><span>context </span><span>=</span><span> make_unique</span><span>&lt;</span><span>LLVMContext</span><span>&gt;</span><span>(</span><span>)</span><span>;</span><span></span></p><p><span>builder </span><span>=</span><span> std</span><span>::</span><span>unique_ptr</span><span>&lt;</span><span>IRBuilder</span><span>&lt;</span><span>&gt;&gt;</span><span>(</span><span>new</span><span> IRBuilder</span><span>&lt;</span><span>&gt;</span><span>(</span><span>*</span><span>context</span><span>)</span><span>)</span><span>;</span><span></span></p><p><span>module </span><span>=</span><span> make_unique</span><span>&lt;</span><span>Module</span><span>&gt;</span><span>(</span><span>"Module"</span><span>,</span><span> </span><span>*</span><span>context</span><span>)</span><span>;</span></p></pre></div></div><h3 id="irbuilder"><a href="#irbuilder" aria-label="irbuilder permalink"></a>IRBuilder</h3><p>We use the <code>IRBuilder</code> object to incrementally build up our IR. It is intuitively the equivalent of a file pointer when reading/writing a file - it carries around <em>implicit</em> state, e.g. the last instruction added, the basic block of that …</p></article></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://mukulrathi.co.uk/create-your-own-programming-language/llvm-ir-cpp-api-tutorial/">https://mukulrathi.co.uk/create-your-own-programming-language/llvm-ir-cpp-api-tutorial/</a></em></p>]]>
            </description>
            <link>https://mukulrathi.co.uk/create-your-own-programming-language/llvm-ir-cpp-api-tutorial/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25539797</guid>
            <pubDate>Fri, 25 Dec 2020 23:03:50 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[NixOS on ARM/Raspberry Pi]]>
            </title>
            <description>
<![CDATA[
Score 103 | Comments 15 (<a href="https://news.ycombinator.com/item?id=25538764">thread link</a>) | @botayhard
<br/>
December 25, 2020 | https://nixos.wiki/wiki/NixOS_on_ARM/Raspberry_Pi | <a href="https://web.archive.org/web/*/https://nixos.wiki/wiki/NixOS_on_ARM/Raspberry_Pi">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="mw-content-text" lang="en" dir="ltr">
<div>
<table>
<tbody><tr>
<th colspan="2">Raspberry Pi Family
</th></tr>
<tr>
<td colspan="2"><a href="https://nixos.wiki/wiki/File:Raspberry_pi_3_glamour.jpg" title="A Raspberry Pi 3 with enclosure."><img alt="A Raspberry Pi 3 with enclosure." src="https://nixos.wiki/images/thumb/4/40/Raspberry_pi_3_glamour.jpg/x256px-Raspberry_pi_3_glamour.jpg.pagespeed.ic.oggU_vQtmX.jpg" width="256" height="204" srcset="https://nixos.wiki/images/thumb/4/40/Raspberry_pi_3_glamour.jpg/x384px-Raspberry_pi_3_glamour.jpg.pagespeed.ic.Jh6nwVCkVn.jpg 1.5x, https://nixos.wiki/images/thumb/4/40/Raspberry_pi_3_glamour.jpg/x512px-Raspberry_pi_3_glamour.jpg.pagespeed.ic.oXV576JEG6.jpg 2x"></a>
</td></tr>
<tr>
<th colspan="2">Raspberry Pi
</th></tr>
<tr>
<th>Architecture
</th>
<td>ARMv6
</td></tr>
<tr>
<th colspan="2">Raspberry Pi 2
</th></tr>
<tr>
<th>Architecture
</th>
<td>ARMv7
</td></tr>
<tr>
<th colspan="2">Raspberry Pi 3
</th></tr>
<tr>
<th>Architecture
</th>
<td>AArch64 + ARMv7
</td></tr>
<tr>
<th colspan="2">Raspberry Pi 4
</th></tr>
<tr>
<th>Architecture
</th>
<td>AArch64 + ARMv7
</td></tr></tbody></table>
</div>
<p>The Raspberry Pi family of devices is a series of single-board computers made by the Raspberry Pi Foundation. They are all based on Broadcom System-on-a-chip (SOCs). 
</p>


<h2><span id="Status"></span>Status</h2>
<p>Only the <i>Raspberry Pi 3 Family</i> is supported upstream, with the AArch64 effort.
</p><p>The Raspberry Pi 4B is not <em>supported</em> by NixOS, though a beta-quality disk image specific for it is produced. It will be supported the same as the Pi 3 family once the mainline kernel and mainline U-Boot boot fine through the generic mainline image.
</p><p>Other Raspberry Pis (0, 1, and 2) are part of diverse community porting efforts to ARMv6 and ARMv7.
</p><p>The Linux kernel in use, except for the Raspberry Pi 1 family, is the mainline Linux kernel, and not the Raspberry Pi Foundation's fork. This could reduce compatibility with some add-on boards or third-party libraries<sup>[expanded explanation needed]</sup>.
</p><p>The following table is intended to be updated by the NixOS contributors with the current status of the boards. For a list of products, <a rel="nofollow" href="https://www.raspberrypi.org/products/">see the <i>Products Archive</i></a>.
</p>
<table>

<tbody><tr>
<th> Board name
</th>
<th> Architecture
</th>
<th> Support
</th></tr>
<tr>
<th colspan="3">Raspberry&nbsp;Pi&nbsp;1
</th></tr>
<tr>
<td> Raspberry Pi 1 Model B
</td>
<td rowspan="5"> armv6
</td>
<td> C
</td></tr>
<tr>
<td> Raspberry Pi 1 Model A+
</td>
<td> C*
</td></tr>
<tr>
<td> Raspberry Pi 1 Model B+
</td>
<td> C
</td></tr>
<tr>
<td> Raspberry Pi Zero
</td>
<td> C*
</td></tr>
<tr>
<td> Raspberry Pi Zero W
</td>
<td> C
</td></tr>
<tr>
<th colspan="3">Raspberry&nbsp;Pi&nbsp;2
</th></tr>
<tr>
<td> Raspberry Pi 2 Model B
</td>
<td> armv7
</td>
<td> C
</td></tr>
<tr>
<th colspan="3">Raspberry&nbsp;Pi&nbsp;3
</th></tr>
<tr>
<td> <a href="https://nixos.wiki/wiki/NixOS_on_ARM/Raspberry_Pi_3" title="NixOS on ARM/Raspberry Pi 3">Raspberry Pi 3 Model B</a>
</td>
<td rowspan="3"> AArch64<br> <i>+&nbsp;armv7</i>
</td>
<td> YES
</td></tr>
<tr>
<td> <a href="https://nixos.wiki/wiki/NixOS_on_ARM/Raspberry_Pi_3" title="NixOS on ARM/Raspberry Pi 3">Raspberry Pi 3 Model B+</a>
</td>
<td> YES
</td></tr>
<tr>
<td> <a href="https://nixos.wiki/wiki/NixOS_on_ARM/Raspberry_Pi_3" title="NixOS on ARM/Raspberry Pi 3">Raspberry Pi 3 Model A+</a>
</td>
<td>&nbsp;?
</td></tr>
<tr>
<th colspan="3">Raspberry Pi 4
</th></tr>
<tr>
<td> <a href="https://nixos.wiki/wiki/NixOS_on_ARM/Raspberry_Pi_4" title="NixOS on ARM/Raspberry Pi 4">Raspberry Pi 4 Model B</a>
</td>
<td> AArch64<br> <i>+ armv7</i>
</td>
<td> YES* (<a rel="nofollow" href="https://github.com/NixOS/nixpkgs/issues/63720">GitHub issue</a>)
</td></tr></tbody></table>
<p><i>Support</i>
</p>
<ul><li> YES: Supported architecture by Nixpkgs downstream and tested to be working.</li>
<li> YES*: Available in Nixpkgs downstream but experimental.</li>
<li> C: Community supported, and tested to be working.</li>
<li> C*: Community supported, unverified but should be working.</li>
<li>&nbsp;?&nbsp;: Unverified, unknown if it will work.</li></ul>
<p>The Raspberry Pi 3 Family is only supported as <b>AArch64</b>. Use as armv7 is community supported.
</p>
<h2><span id="Board-specific_installation_notes"></span>Board-specific installation notes</h2>
<p>First follow the <a href="https://nixos.wiki/wiki/NixOS_on_ARM#Installation" title="NixOS on ARM">generic installation steps</a> to get the installer image and install using the <a href="https://nixos.wiki/wiki/NixOS_on_ARM#NixOS_installation_.26_configuration" title="NixOS on ARM">installation and configuration steps</a>.
</p>
<h3><span id="Raspberry_Pi_.281.29"></span>Raspberry Pi (1)</h3>
<p>The ARMv6 image boots out-of-the-box.
</p>
<h3><span id="Raspberry_Pi_2"></span>Raspberry Pi 2</h3>
<p>The ARMv7 image should boot out-of-the-box, though the author hasn't personally tested this.
</p>
<h3><span id="Raspberry_Pi_3_.2F_3B.2B"></span>Raspberry Pi 3 / 3B+</h3>
<p><a href="https://nixos.wiki/wiki/NixOS_on_ARM/Raspberry_Pi_3#Board-specific_installation_notes" title="NixOS on ARM/Raspberry Pi 3">Raspberry Pi 3#Board-specific installation notes</a>
</p>
<h3><span id="Raspberry_Pi_4B"></span>Raspberry Pi 4B</h3>
<p><a href="https://nixos.wiki/wiki/NixOS_on_ARM/Raspberry_Pi_4#Board-specific_installation_notes" title="NixOS on ARM/Raspberry Pi 4">Raspberry Pi 4#Board-specific installation notes</a>
</p>
<h2><span id="Serial_console"></span>Serial console</h2>
<p>Your <code>configuration.nix</code> will need to add <code>console=ttyS1,115200n8</code> to the <code>boot.kernelParams</code> configuration to use the serial console.
</p>
<p><img alt="Breeze-text-x-plain.png" src="https://nixos.wiki/images/e/ef/xBreeze-text-x-plain.png.pagespeed.ic.CzagNXRrGf.png" width="16" height="16"></p><pre>/etc/nixos/configuration.nix
</pre><div dir="ltr"><pre><span>{</span> config<span>,</span> pkgs<span>,</span> lib<span>,</span> <span>...</span> <span>}:</span>
<span>{</span>
  boot<span>.</span><span>kernelParams =</span> <span>[</span>
    <span>"console=ttyS1,115200n8"</span>
  <span>];</span>
<span>}</span>
</pre></div>
<p>If the Raspberry Pi downstream kernel is used the serial interface is named <code>serial0</code> instead.
</p>
<h2><span id="Binary_Cache"></span>Binary Cache</h2>
<p>Depending on the architecture used, binary caches availability varies. Binary caches instructions are on the main <a href="https://nixos.wiki/wiki/NixOS_on_ARM#Binary_cache" title="NixOS on ARM">NixOS on ARM</a>&nbsp;page. The following table describes the architectures supported by each board. 
</p>
<table>

<tbody><tr>
<th> Raspberry Pi 1
</th>
<td> armv6
</td></tr>
<tr>
<th> Raspberry Pi 2
</th>
<td> armv7
</td></tr>
<tr>
<th rowspan="2">Raspberry Pi 3
</th>
<td> armv7
</td></tr>
<tr>
<td> AArch64
</td></tr>
<tr>
<th rowspan="2">Raspberry Pi 4
</th>
<td> armv7
</td></tr>
<tr>
<td> AArch64
</td></tr></tbody></table>
<h2><span id="Notes_about_the_boot_process"></span>Notes about the boot process</h2>
<p>The custom bootloader, part of the Raspberry Pi firmware, is abstracted away for NixOS by making it boot U-Boot instead.
</p><p>U-Boot gives us the ability to provide a generation selection menu during the boot process, in addition to storing the boot files on the main partition, rather than on the firmware partition.
</p>
<h3><span id="Raspberry_Pi_.28all_versions.29"></span>Raspberry Pi (all versions)</h3>
<p>USB keyboards and HDMI displays should work, though some issues have been reported (see Troubleshooting below).
</p><p>Using the 3.3v serial port via the pin headers (exact location depends on hardware version) will get u-boot output and, when configured, a Linux kernel console.
</p>
<h2><span id="Troubleshooting"></span>Troubleshooting</h2>
<h3><span id="Power_issues"></span>Power issues</h3>
<p>Especially with the newer power-hungry Raspberry Pi families (3, 4), it is important to have a <a rel="nofollow" href="https://www.raspberrypi.org/documentation/hardware/raspberrypi/power/README.md">sufficient enough power supply</a> or <i>weirdness</i> may happen. Weirdness may include:
</p>
<ul><li> Lightning bolt on HDMI output "breaking" the display.</li>
<li> Screen switching back to u-boot text
<ul><li> Fixable temporarily when power is sufficient by switching VT (alt+F2 / alt+F1)</li></ul></li>
<li> Random hangs</li></ul>
<p>This problem is a hard problem. It is caused by the Raspberry Pi warning about power issues, but the current drivers (as of 
Linux 4.14) have a hard time dealing with it properly. If the power supply is rated properly AND the cable is not incurring too much power losses, it may be required to disable the lightning bolt indicator so the display driver isn't messed up.<sup id="cite_ref-1"><a href="#cite_note-1">[1]</a></sup> The lightning bolt indicator can be disabled by adding the line <code>avoid_warnings=1</code> in config.txt<sup id="cite_ref-2"><a href="#cite_note-2">[2]</a></sup>
</p>
<p><strong> Note: </strong>A <i>properly rated</i> USB power supply, AND a good cable are necessary. The cable has to be short enough to not incur power losses through the length. Do note that thin and cheap cables usually have thinner copper wires, which in turn accentuates power losses.</p>
<h3><span id="Additional_Troubleshooting"></span>Additional Troubleshooting</h3>
<p>Additional troubleshooting information may be found <a rel="nofollow" href="https://elinux.org/R-Pi_Troubleshooting">at elinux.org</a>.
</p>
<hr><ol>
<li id="cite_note-1"><span><a href="#cite_ref-1">↑</a></span> <span><a rel="nofollow" href="https://logs.nix.samueldr.com/nixos/2017-12-20#1513784657-1513784714">https://logs.nix.samueldr.com/nixos/2017-12-20#1513784657-1513784714</a>;</span>
</li>
<li id="cite_note-2"><span><a href="#cite_ref-2">↑</a></span> <span><a rel="nofollow" href="https://www.raspberrypi.org/documentation/configuration/config-txt/README.md">https://www.raspberrypi.org/documentation/configuration/config-txt/README.md</a></span>
</li>
</ol>

<!-- 
NewPP limit report
Cached time: 20201118204625
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.016 seconds
Real time usage: 0.019 seconds
Preprocessor visited node count: 144/1000000
Preprocessor generated node count: 456/1000000
Post‐expand include size: 1767/2097152 bytes
Template argument size: 866/2097152 bytes
Highest expansion depth: 6/40
Expensive parser function count: 0/100
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    6.785      1 -total
 26.47%    1.796      1 Template:Note
 17.97%    1.219      1 Template:File
 17.95%    1.218      1 Template:META_Box_Blue
 10.17%    0.690      1 Template:META_Box
  8.31%    0.564      1 Template:ARM/breadcrumb
-->

<!-- Saved in parser cache with key nixoswiki-nixos:pcache:idhash:290-0!*!0!!en!5!* and timestamp 20201118204625 and revision id 4737
 -->
</div></div>]]>
            </description>
            <link>https://nixos.wiki/wiki/NixOS_on_ARM/Raspberry_Pi</link>
            <guid isPermaLink="false">hacker-news-small-sites-25538764</guid>
            <pubDate>Fri, 25 Dec 2020 20:22:54 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Show HN: Mountain Peaks in WebGL]]>
            </title>
            <description>
<![CDATA[
Score 259 | Comments 37 (<a href="https://news.ycombinator.com/item?id=25537377">thread link</a>) | @pheelicks
<br/>
December 25, 2020 | https://felixpalmer.github.io/peaks-of-austria/ | <a href="https://web.archive.org/web/*/https://felixpalmer.github.io/peaks-of-austria/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/>Unable to extract article]]>
            </description>
            <link>https://felixpalmer.github.io/peaks-of-austria/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25537377</guid>
            <pubDate>Fri, 25 Dec 2020 16:37:30 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Aliens Likely Annihilated Themselves Through Progress]]>
            </title>
            <description>
<![CDATA[
Score 39 | Comments 43 (<a href="https://news.ycombinator.com/item?id=25537049">thread link</a>) | @elorant
<br/>
December 25, 2020 | https://www.ibtimes.sg/aliens-likely-annihilated-themselves-through-progress-suggests-new-extraterrestrial-research-54416 | <a href="https://web.archive.org/web/*/https://www.ibtimes.sg/aliens-likely-annihilated-themselves-through-progress-suggests-new-extraterrestrial-research-54416">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div itemprop="articleBody" id="v_main"><p>There are many people who strongly believe that aliens are real and they are living somewhere far from the blue planet, Earth. But a new scientific study suggested that such civilizations destroyed themselves through progress.</p><p>NASA Jet Propulsion Laboratory and California Institute of Technology researchers have surmised in a study that the galaxy might be home to alien civilizations that destroyed themselves through technological advancements that eventually lead to destruction and biological degeneration.</p><p>According to <a href="https://arxiv.org/ftp/arxiv/papers/2012/2012.07902.pdf" rel="nofollow" target="_blank">the paper</a>, "A Statistical Estimation of the Occurrence of Extraterrestrial Intelligence in the Milky Way Galaxy", any intelligent alien life that lived in the Milky Way before humans did likely already killed itself off.</p>
<figure itemscope="" itemprop="associatedMedia image" itemtype="https://schema.org/ImageObject"><div>
<picture>
<!--[if IE 9]><video
style="display: none;"><![endif]--><source media="(min-width: 1280px)" sizes="736px" srcset="https://data.ibtimes.sg/en/full/44626/milky-way-galaxy.jpg?w=736 736w"><source media="(min-width: 1024px)" sizes="800px" srcset="https://data.ibtimes.sg/en/full/44626/milky-way-galaxy.jpg?w=800 800w"><source media="(min-width: 768px)" sizes="736px" srcset="https://data.ibtimes.sg/en/full/44626/milky-way-galaxy.jpg?w=736 736w"><source media="(min-width: 480px)" sizes="480px" srcset="https://data.ibtimes.sg/en/full/44626/milky-way-galaxy.jpg?w=480 480w"><source media="(min-width: 0px)" sizes="400px" srcset="https://data.ibtimes.sg/en/full/44626/milky-way-galaxy.jpg?w=400 400w"><!--[if IE 9]></video><![endif]-->                    <img id="i44626" src="https://data.ibtimes.sg/en/full/44626/milky-way-galaxy.jpg?w=736" alt="Milky Way Galaxy" title="Milky Way Galaxy" width="736" itemprop="contentUrl">
</picture><meta itemprop="url" content="https://data.ibtimes.sg/en/full/44626/milky-way-galaxy.jpg"><meta itemprop="width" content="800"><meta itemprop="height" content="450">
<figcaption>
<span itemprop="caption">Alien life in Milky Way</span>
<span itemprop="copyrightHolder">Pikrepo</span>
</figcaption></div>
</figure><h3><strong>Dead Alien Civilization </strong></h3><p>The researchers behind this study, Xiang Cai, Jonathan H. Jiang, Kristen A. Fahy, and Yuk L. Yung, explained in the paper that "if intelligent life is likely to destroy themselves, it is not surprising that there is little or no intelligent life elsewhere".</p><p>If people are wondering why humans, the most intelligent living being on planet Earth and on the solar system, might still be alive, it is because the species are billions of years behind these now-extinct alien civilizations. The intelligent species or aliens probably noticed life form around eight billion years after the formation of the Milky Way, whereas humans did not reach until 13.5 billion years after the creation. This means the humans are almost over five billion years behind.</p><p>According to Jiang, the NASA Jet Propulsion Laboratory astrophysicist, since Carl Sagan's time, there has been lots of research on alien life, especially when the Hubble Space Telescope and Kepler Space Telescope were created. "We have lots of knowledge about the densities in the Milky Way galaxy and star formation rates and exoplanet formation...and the occurrence rate of supernova explosions. We actually know some of the numbers," he <a href="https://www.livescience.com/milky-way-alien-life-map.html" rel="nofollow">added</a>.</p>
<figure itemscope="" itemprop="associatedMedia image" itemtype="https://schema.org/ImageObject"><div>
<picture>
<!--[if IE 9]><video
style="display: none;"><![endif]--><source media="(min-width: 1280px)" sizes="736px" srcset="https://data.ibtimes.sg/en/full/28417/center-of-the-milky-way-galaxy.jpg?w=736 736w"><source media="(min-width: 1024px)" sizes="980px" srcset="https://data.ibtimes.sg/en/full/28417/center-of-the-milky-way-galaxy.jpg?w=980 980w"><source media="(min-width: 768px)" sizes="736px" srcset="https://data.ibtimes.sg/en/full/28417/center-of-the-milky-way-galaxy.jpg?w=736 736w"><source media="(min-width: 480px)" sizes="480px" srcset="https://data.ibtimes.sg/en/full/28417/center-of-the-milky-way-galaxy.jpg?w=480 480w"><source media="(min-width: 0px)" sizes="400px" srcset="https://data.ibtimes.sg/en/full/28417/center-of-the-milky-way-galaxy.jpg?w=400 400w"><!--[if IE 9]></video><![endif]-->                    <img id="i28417" src="https://data.ibtimes.sg/en/full/28417/center-of-the-milky-way-galaxy.jpg?w=736" alt="Center of the Milky Way Galaxy" title="Center of the Milky Way Galaxy" width="736" itemprop="contentUrl">
</picture><meta itemprop="url" content="https://data.ibtimes.sg/en/full/28417/center-of-the-milky-way-galaxy.jpg"><meta itemprop="width" content="1041"><meta itemprop="height" content="738">
<figcaption>
<span itemprop="caption">Photo of the Milky Way's center taken by the Spitzer Space Telescope</span>
<span itemprop="copyrightHolder">NASA, JPL-Caltech, Susan Stolovy SSC/Caltech et al.</span>
</figcaption></div>
</figure><p>The numbers are actually related to the mystery variables that the American astronomer and the planetary scientist Segan referred to in his Cosmos miniseries in which he discussed the Drake equation. This formula proposed by American astrophysicist Frank Drake estimates N, the number of transmitting societies in the Milky Way galaxy. It is actually the equation that may give the scientists an idea about how many alien societies exist and are detectable.</p><p>Because of the scientific limitations at that time, Drake and Sagan included variables that could not be identified more precisely. But now Jiang and the team of scientists have learned about some of those numbers which Drake and Segan failed to identify. The paper says when and where life is most likely to flourish in the Milky Way and it identifies the most important factor affecting its prevalence that is intelligent creatures' tendency toward self-annihilation.</p><p>Understanding the factors helped the team of scientists believe that advanced alien civilizations did exist at one point in the galaxy, but they likely destroyed themselves by way of progress. However, according to some scientific theories, there might be <a href="https://www.syfy.com/syfywire/there-might-be-36-alien-races-in-the-milky-way" rel="nofollow">36</a> extraterrestrial races among the stars.</p><p>Earlier in 2018, scientists claimed that the galaxy used to be the home to aliens but it was the effect of climate change that vanished all the life forms, as per a <a href="https://www.forbes.com/sites/brucedorminey/2018/12/31/galaxy-may-be-littered-with-dead-aliens-blindsided-by-natural-climate-change/?sh=497bde101955" rel="nofollow" target="_blank">report</a> from Forbes. In the recently released paper, the researchers said, "The simulated age distributions also suggest that most of the intelligent life in our galaxy are young, thus making observation or detection difficult."</p><p>They also found that even if the galaxy reached its civilizational peak over five billion years ago, most of the civilizations that were around that time have likely self-annihilated. However, the paper has been submitted to a journal for publication and it is currently awaiting peer review.</p></div></div>]]>
            </description>
            <link>https://www.ibtimes.sg/aliens-likely-annihilated-themselves-through-progress-suggests-new-extraterrestrial-research-54416</link>
            <guid isPermaLink="false">hacker-news-small-sites-25537049</guid>
            <pubDate>Fri, 25 Dec 2020 15:42:25 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Switching from Apple to Lenovo]]>
            </title>
            <description>
<![CDATA[
Score 84 | Comments 73 (<a href="https://news.ycombinator.com/item?id=25536216">thread link</a>) | @ynv
<br/>
December 25, 2020 | https://ayedo.github.io/hardware/2020/12/25/switching-from-apple-to-lenovo.html | <a href="https://web.archive.org/web/*/https://ayedo.github.io/hardware/2020/12/25/switching-from-apple-to-lenovo.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
<p>Some of my friends have been telling me that Windows machines got a lot better. I decided to give it a try, and bought a top of the line Lenovo X1 Carbon Gen 8. For all of you thinking about doing the same switch, you might want to read this first.</p>

<p>Even though Apple is known for overpricing, and taking advantage of their customer base, they do it in a larger scheme of things, and do not engage in business practices which have a low customer experience. Unfortunately, you can’t say the same about the Lenovo universe.</p>

<p>Just go to their <a href="https://www.lenovo.com/">website</a> for a minute. Try to figure out which Laptop to buy, without getting the feeling you are being scammed. Everything seems to be on sale all the time, there are laptops of different generations of the same product line being advertised to you. They lie to your face about the battery life-times. People who are buying these machines got used to this experience, and are proud of being able to navigate such websites. You really need to do your homework before buying anything.</p>

<p>For example: I bought the X1 with their standard FHD screen, and it feels older than my 7 years old MBP. When trying to figure out why, I found out that Lenovo has a “<a href="https://www.notebookcheck.net/Lenovo-s-Panel-Lottery-continues-with-3-different-14-inch-LowPower-displays.426538.0.html">panel lottery</a>”: They use different suppliers with remarkable quality differences for their displays. Which one you get is just based on luck. Turns out the panel I got is the same they use for their cheapest product line. This means I have a ghosting mouse pointer on a $2000 brand new machine. Nice.</p>

<p>Even if you are lucky with the screen: it does not come color calibrated out of the box! Good luck trying to find the correct color profile, unless you want to spend money on a calibration tool you’re only going to use once.
Then comes Windows:</p>

<p>Yeah, it got better, but wow, do they carry a lot of baggage around. When trying to calibrate the display I found out that Windows has no less than three different system configuration UIs, which are also intertwined in unexpected ways. On top of that Lenovo installed their own buggy configuration tool. Configuring Windows feels like walking on ice. Even with all this configuration might, it still was not possible to get the exact serial number of my display panel without installing a third party tool.</p>

<p>Microsoft is also constantly nagging you about something that marginally helps their bottom line, but costs you a lot of your user experience. Like their constant push to trick people into giving them their data, or the fact that they try to force you to use their browser whenever they can.</p>

<p>I’m still not sure if I ticked the right boxes so that Microsoft does not get my browsing behaviour. I feel stressed every time Microsoft wants something from me. How are they trying to scam me this time?</p>

<p>For me this reinforces my belief that people who like Windows are simply used to it, because they need it for work or playing games. There is no point arguing with this, as their added value is their own experience, and the fact they know the tools and tricks to make the system usable to them.</p>

<p>One friend even told me that one of his favourite improvements in newer Windows versions is that they made it a lot easier to completely reset the operation system. My Apple machine has never been reset since I bought it almost a decade ago, and works flawlessly.  His statement seems like a subtle warning as to what is expecting me in the near future using my new  machine.</p>

</div></div>]]>
            </description>
            <link>https://ayedo.github.io/hardware/2020/12/25/switching-from-apple-to-lenovo.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-25536216</guid>
            <pubDate>Fri, 25 Dec 2020 13:01:37 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Using Types to Guarantee Domain Invariants]]>
            </title>
            <description>
<![CDATA[
Score 10 | Comments 0 (<a href="https://news.ycombinator.com/item?id=25536010">thread link</a>) | @lukastyrychtr
<br/>
December 25, 2020 | https://www.lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/ | <a href="https://web.archive.org/web/*/https://www.lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><section>
  <article>
    
      
      
<ul id="frontmatter">
    <li>
        <time datetime="2020-12-11T15:00:10.47Z">December 11, 2020</time>
    </li>
    <span></span>
    <li> 6504 words </li>
    <span></span>
    <li> 33 min </li>
</ul>

      <p><em><a href="https://zero2prod.com/"><strong>Zero To Production In Rust</strong></a> is an opinionated introduction to backend development in Rust.<br>
You can pre-order the book on <a href="https://zero2prod.com/">zero2prod.com</a>.<br>
<a href="https://www.lpalmieri.com/subscribe">Subscribe to the newsletter</a> to be notified when a new episode is published.</em></p>

<ol>
<li><a href="https://lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/#1-requirements">Requirements</a>
<ul>
<li><a href="https://lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/#11-domain-constraints">1.1. Domain Constraints</a></li>
<li><a href="https://lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/#12-security-constraints">1.2. Security Constraints</a></li>
</ul>
</li>
<li><a href="https://lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/#2-first-implementation">First Implementation</a></li>
<li><a href="https://lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/#3-validation-is-a-leaky-cauldron">Validation Is A Leaky Cauldron</a></li>
<li><a href="https://lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/#4-type-driven-development">Type-Driven Development</a></li>
<li><a href="https://lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/#5-ownership-meets-invariants">Ownership Meets Invariants</a>
<ul>
<li><a href="https://lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/#51-asref">5.1. <code>AsRef</code></a></li>
</ul>
</li>
<li><a href="https://lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/#6-panics">Panics</a></li>
<li><a href="https://lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/#7-error-as-values---result">Errors As Values - <code>Result</code></a>
<ul>
<li><a href="https://lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/#71-converting-parse-to-return-result">7.1. Converting <code>parse</code> To Return <code>Result</code></a></li>
</ul>
</li>
<li><a href="https://lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/#8-insightful-assertion-errors-claim">Insightful Assertion Errors: <code>claim</code></a></li>
<li><a href="https://lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/#9-unit-tests">Unit Tests</a></li>
<li><a href="https://lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/#10-handling-a-result">Handling A <code>Result</code></a>
<ul>
<li><a href="https://lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/#101-map_err">10.1. <code>map_err</code></a></li>
<li><a href="https://lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/#102-the--operator">10.2. The <code>?</code> Operator</a></li>
<li><a href="https://lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/#103-400-bad-request">10.3. 400 Bad Request</a></li>
</ul>
</li>
<li><a href="https://lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/#11-summary">Summary</a></li>
</ol>
<p>Our newsletter API is live, hosted on a Cloud provider.<br>
We have a basic set of instrumentation to troubleshoot issues that might arise.<br>
There is an exposed endpoint (<code>POST /subscriptions</code>) to subscribe to our content.</p>
<p>We have come a long way!</p>
<p>But we have cut a few corners along the way: <code>POST /subscriptions</code> is fairly... permissive.<br>
Our input validation is extremely limited: we just ensure that both the name and the email fields are provided, nothing else.</p>
<p>We can add a new integration test to probe our API with some "troublesome" inputs:</p>
<pre><code><span>//! tests/health_check.rs
// [...]

</span><span>#[</span><span>actix_rt</span><span>::</span><span>test</span><span>]
async </span><span>fn </span><span>subscribe_returns_a_200_when_fields_are_present_but_empty</span><span>() {
    </span><span>// Arrange
    </span><span>let</span><span> app = </span><span>spawn_app</span><span>().await;
    </span><span>let</span><span> client = reqwest::Client::new();
    </span><span>let</span><span> test_cases = vec![
        ("</span><span>name=&amp;email=ursula_le_guin%40gmail.com</span><span>", "</span><span>empty name</span><span>"),
        ("</span><span>name=Ursula&amp;email=</span><span>", "</span><span>empty email</span><span>"),
        ("</span><span>name=Ursula&amp;email=definitely-not-an-email</span><span>", "</span><span>invalid email</span><span>"),
    ];

    </span><span>for </span><span>(body, description) in test_cases {
        </span><span>// Act
        </span><span>let</span><span> response = client
            .</span><span>post</span><span>(&amp;format!("</span><span>{}</span><span>/subscriptions</span><span>", &amp;app.address))
            .</span><span>header</span><span>("</span><span>Content-Type</span><span>", "</span><span>application/x-www-form-urlencoded</span><span>")
            .</span><span>body</span><span>(body)
            .</span><span>send</span><span>()
            .await
            .</span><span>expect</span><span>("</span><span>Failed to execute request.</span><span>");

        </span><span>// Assert
        </span><span>assert_eq!(
            </span><span>200</span><span>,
            response.</span><span>status</span><span>().</span><span>as_u16</span><span>(),
            "</span><span>The API did not return a 200 OK when the payload was {}.</span><span>",
            description 
        );
    }
}
</span></code></pre>
<p>The new test, unfortunately, passes.<br>
Although all those payloads are clearly invalid, our API is gladly accepting them, returning a <code>200 OK</code>.<br>
Those troublesome subscriber details end up straight in our database, ready to give us problems down the line when it is time to deliver a newsletter issue.</p>
<p>We are asking for two pieces of information when subscribing to our newsletter: a name and an email.<br>
This chapter will focus on name validation: what should we look out for?</p>
<blockquote>
<p><em>Discuss the article on HackerNews or <a href="https://www.reddit.com/r/rust/comments/kbddrq/zero_to_production_in_rust_part_six_using_types/">r/rust</a></em>.</p>
</blockquote>

<h2 id="1-1-domain-constraints">1.1. Domain Constraints</h2>
<p>It turns out that names are complicated<sup><a href="#patio-names">1</a></sup>.<br>
Trying to nail down what makes a name <em>valid</em> is a fool's errand. Remember that we chose to collect a name to use it in the opening line of our emails - we do not need it to match the real identity of a person, whatever that means in their geography. It would be totally unnecessary to inflict the pain of incorrect or overly prescriptive validation on our users.</p>
<p>We could thus settle on simply requiring the name field to be non-empty (as in, it must contain at least a non-whitespace character).</p>
<h2 id="1-2-security-constraints">1.2. Security Constraints</h2>
<p>Unfortunately, not all people on the Internet are good people.<br>
Given enough time, especially if our newsletter picks up traction and becomes successful, we are bound to capture the attention of malicious visitors.<br>
Forms and user inputs are a primary attack target - if they are not properly sanitised, they might allow an attacker to mess with our database (<a href="https://en.wikipedia.org/wiki/SQL_injection">SQL injection</a>), execute code on our servers, crash our service and other nasty stuff.<br>
Thanks, but no thanks.</p>
<p>What is likely to happen in our case? What should we brace for in the wild range of possible attacks?<sup><a href="#threat-modelling">2</a></sup><br>
We are building an email newsletter, which leads us to focus on:</p>
<ul>
<li>denial of service - e.g. trying to take our service down to prevent other people from signing up. A common threat for basically any online service;</li>
<li>data theft - e.g. steal a huge list of email addresses;</li>
<li>phishing - e.g. use our service to send what looks like a legitimate email to a victim to trick them into clicking on some links or perform other actions.</li>
</ul>
<p>Should we try to tackle all these threats in our validation logic?<br>
Absolutely not!<br>
But it is good practice to have a layered security approach<sup><a href="#defense-in-depth">3</a></sup>: by having mitigations to reduce the risk for those threats at multiple levels in our stack (e.g. input validation, parametrised queries to avoid SQL injection, escaping parametrised input in emails, etc.) we are less likely to be vulnerable should any of those checks fail us or be removed later down the line.</p>
<p>We should always keep in mind that software is a living artifact: holistic understanding of a system is the first victim of the passage of time.<br>
You have the whole system in your head when writing it down for the first time, but the next developer touching it will not - at least not from the get-go. It is therefore possible for a load-bearing check in an obscure corner of the application to disappear (e.g. HTML escaping) leaving you exposed to a class of attacks (e.g. phishing).<br>
Redundancy reduces risk.</p>
<p>Let's get to the point - what validation should we perform on names to improve our security posture given the class of threats we identified?<br>
I suggest:</p>
<ul>
<li>Enforcing a maximum length. We are using <code>TEXT</code> as type for our email in Postgres, which is virtually unbounded - well, until disk storage starts to run out. Names come in all shapes and forms, but 256 characters should be enough for the greatest majority of our users<sup><a href="#longest-name">4</a></sup> - if not, we will politely ask them to enter a nickname.</li>
<li>Reject names containing troublesome characters. <code>/()"&lt;&gt;\{}</code> are fairly common in URLs, SQL queries and HTML fragments - not as much in names<sup><a href="#xkcd">5</a></sup>. Forbidding them raises the complexity bar for SQL injection and phishing attempts.</li>
</ul>

<p>Let's have a look at our request handler, as it stands right now:</p>
<pre><code><span>//! src/routes/subscriptions.rs
</span><span>use </span><span>actix_web::{web, HttpResponse};
</span><span>use </span><span>chrono::Utc;
</span><span>use </span><span>sqlx::PgPool;
</span><span>use </span><span>uuid::Uuid;

#[</span><span>derive</span><span>(serde::Deserialize)]
</span><span>pub struct </span><span>FormData {
    </span><span>email</span><span>: String,
    </span><span>name</span><span>: String,
}

#[</span><span>tracing</span><span>::</span><span>instrument</span><span>(
    name = "</span><span>Adding a new subscriber</span><span>",
    </span><span>skip</span><span>(form, pool),
    </span><span>fields</span><span>(
        email = %form.email,
        name = %form.name
    )
)]
</span><span>pub</span><span> async </span><span>fn </span><span>subscribe</span><span>(
    </span><span>form</span><span>: web::Form&lt;FormData&gt;,
    </span><span>pool</span><span>: web::Data&lt;PgPool&gt;,
) -&gt; Result&lt;HttpResponse, HttpResponse&gt; {
    </span><span>insert_subscriber</span><span>(&amp;pool, &amp;form)
        .await
        .</span><span>map_err</span><span>(|_| HttpResponse::InternalServerError().</span><span>finish</span><span>())?;
    Ok(HttpResponse::Ok().</span><span>finish</span><span>())
}

</span><span>// [...]
</span></code></pre>
<p>Where should our new validation live?</p>
<p>A first sketch could look somewhat like this:</p>
<pre><code><span>//! src/routes/subscriptions.rs
 
// An extension trait to provide the `graphemes` method 
// on`String` and `&amp;str`
</span><span>use </span><span>unicode_segmentation::UnicodeSegmentation;
</span><span>// [...]

</span><span>pub</span><span> async </span><span>fn </span><span>subscribe</span><span>(
    </span><span>form</span><span>: web::Form&lt;FormData&gt;,
    </span><span>pool</span><span>: web::Data&lt;PgPool&gt;,
) -&gt; Result&lt;HttpResponse, HttpResponse&gt; {
    </span><span>if </span><span>!</span><span>is_valid_name</span><span>(&amp;form.name) {
        </span><span>return </span><span>Err(HttpResponse::BadRequest().</span><span>finish</span><span>());
    }
    </span><span>insert_subscriber</span><span>(&amp;pool, &amp;form)
        .await
        .</span><span>map_err</span><span>(|_| HttpResponse::InternalServerError().</span><span>finish</span><span>())?;
    Ok(HttpResponse::Ok().</span><span>finish</span><span>())
}

</span><span>/// Returns `true` if the input satisfies all our validation constraints 
/// on subscriber names, `false` otherwise.
</span><span>pub fn </span><span>is_valid_name</span><span>(</span><span>s</span><span>: &amp;</span><span>str</span><span>) -&gt; </span><span>bool </span><span>{
    </span><span>// `.trim()` returns a view over the input `s` without trailing 
    // whitespace-like characters.
    // `.is_empty` checks if the view contains any character.
    </span><span>let</span><span> is_empty_or_whitespace = s.</span><span>trim</span><span>().</span><span>is_empty</span><span>();

    </span><span>// A grapheme is defined by the Unicode standard as a "user-perceived" 
    // character: `å` is a single grapheme, but it is composed of two characters 
    // (`a` and `̊`).
    //
    // `graphemes` returns an iterator over the graphemes in the input `s`.
    // `true` specifies that we want to use the extended grapheme definition set,
    // the recommended one.
    </span><span>let</span><span> is_too_long = s.</span><span>graphemes</span><span>(</span><span>true</span><span>).</span><span>count</span><span>() &gt; </span><span>256</span><span>;

    </span><span>// Iterate over all characters in the input `s` to check if any of them matches 
    // one of the characters in the forbidden array.
    </span><span>let</span><span> forbidden_characters = ['</span><span>/</span><span>', '</span><span>(</span><span>', '</span><span>)</span><span>', '</span><span>"</span><span>', '</span><span>&lt;</span><span>', '</span><span>&gt;</span><span>', '</span><span>\\</span><span>', '</span><span>{</span><span>', '</span><span>}</span><span>'];
    </span><span>let</span><span> contains_forbidden_characters = s.</span><span>chars</span><span>().</span><span>any</span><span>(|</span><span>g</span><span>| forbidden_characters.</span><span>contains</span><span>(&amp;g));

    </span><span>// Return `false` if any of our conditions has been violated 
    </span><span>!(is_empty_or_whitespace || is_too_long || contains_forbidden_characters)
}
</span></code></pre>
<p>To compile the new function successfully we will have to add the <code>unicode-segmentation</code> crate to our dependencies:</p>
<pre><code><span>cargo</span><span> add unicode-segmentation
</span></code></pre>
<p>While it <em>looks like</em> a perfectly fine solution (assuming we add a bunch of tests), functions like <code>is_valid_name</code> give us a false sense of safety.</p>

<p>Let's shift our attention to <code>insert_subscriber</code>.<br>
Let's imagine, for a second, that it requires <code>form.name</code> to be non-empty otherwise something horrible is going to happen (e.g. a panic!).</p>
<p>Can <code>insert_subscriber</code> safely assume that <code>form.name</code> will be non-empty?<br>
Just by looking at its <em>type</em>, it cannot: <code>form.name</code> is a <code>String</code>. There is no guarantee about its content.<br>
If you were to look at our program in its entirety you might say: we are checking that it is non-empty at the edge, in the request handler, therefore we can safely assume that <code>form.name</code> will be non-empty every time <code>insert_subscriber</code> is invoked.</p>
<p>But we had to shift from a <em>local</em> approach (let's look at this function's parameters) to a <em>global</em> approach (let's scan the whole codebase) to make such a claim.<br>
And while it might be feasible for a small project such as ours, examining all the calling sites of a function (<code>insert_subscriber</code>) to ensure that a certain validation step has been performed beforehand quickly becomes unfeasible on larger projects.</p>
<p>If we are to stick with <code>is_valid_name</code>, the only viable approach is validating <em>again</em> <code>form.name</code> inside <code>i…</code></p></article></section></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://www.lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/">https://www.lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/</a></em></p>]]>
            </description>
            <link>https://www.lpalmieri.com/posts/2020-12-11-zero-to-production-6-domain-modelling/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25536010</guid>
            <pubDate>Fri, 25 Dec 2020 12:09:57 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[A Minimum Complete Tutorial of CPU Power Management, C-states and P-states]]>
            </title>
            <description>
<![CDATA[
Score 6 | Comments 0 (<a href="https://news.ycombinator.com/item?id=25536006">thread link</a>) | @usr1106
<br/>
December 25, 2020 | https://metebalci.com/blog/a-minimum-complete-tutorial-of-cpu-power-management-c-states-and-p-states/ | <a href="https://web.archive.org/web/*/https://metebalci.com/blog/a-minimum-complete-tutorial-of-cpu-power-management-c-states-and-p-states/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><div><nav id="TableOfContents"></nav><p>How does CPU save powerÂ&nbsp;? You will learn all the basics about the CPU power management in this post.</p><p>The processor/CPU is designed to operate forever under a specific load. As almost none of us are doing a <code>24x7</code> calculation employing all the resources of the CPU continuously, it is most of the time not operating in its designed maximum. So what is the point of keeping the whole CPU powered on at its full capacityÂ&nbsp;? This is the point of CPU power management. The power management topic covers much more than this, including the RAM, GPU etc., but I am going to tell you only about the CPU side of the story in this post.</p><p>If you know about C-states and P-states and how CPU enters to and exits from these states, probably there is nothing new in this post for you. If not, continue reading.</p><p>I was planning to include a few real-world examples from Linux, but the post was getting longer and taking even more time to finish, so I will do that in another post.</p><p>The general information in this post is applicable to all modern CPUs but the details can be very specific to the individual CPU (esp. to the processor family) and I am using an IntelÂ® XeonÂ® E3-1245 v5 @ 3.50GHz, this is a Xeon E3â€“1200 v5 series (formerly Skylake) processor (model number 0x5e).</p><p>The main references used in this post are:</p><ul><li><a href="https://www.intel.com/content/www/us/en/processors/xeon/xeon-technical-resources.html">Intel(R) Xeon Processor E3â€“1200 v5 Product Family Datasheets</a></li><li><a href="https://ark.intel.com/products/88173/Intel-Xeon-Processor-E3-1245-v5-8M-Cache-3_50-GHz">Intel(R) Xeon Processor E3â€“1245 v5 Product Specification</a></li><li><a href="https://www.intel.com/content/dam/doc/white-paper/energy-efficient-platforms-2011-white-paper.pdf">Sofware Impact to Platform Energy-Efficiency (Intel White Paper)</a></li><li><a href="https://software.intel.com/sites/default/files/managed/39/c5/325462-sdm-vol-1-2abcd-3abcd.pdf">Intel(R) 64 and IA-32 Architectures Software Developer’s Manual</a></li><li><a href="http://www.uefi.org/sites/default/files/resources/ACPI_6_2.pdf">ACPI Specification v6.2</a></li><li><a href="https://en.wikipedia.org/wiki/Advanced_Configuration_and_Power_Interface">ACPI page on Wikipedia</a></li><li>Linux Kernel Sources version 4.13.0</li></ul><p>Unless otherwise noted, all original figures and tables are from the datasheet.</p><ul><li>2019/03/01: Added CoreFreq output to last section.</li></ul><p>On its <a href="https://ark.intel.com/products/52274/Intel-Xeon-Processor-E3-1245-8M-Cache-3_30-GHz">official product page</a>, my CPU has the following features listed:</p><ul><li>Idle States</li><li>Enhanced Intel SpeedStepÂ® Technology</li></ul><p>You can see on the page that “Idle States (C-states) are used to save power when the processor is idle.” and “Intel SpeedStepÂ® Technology switches both voltage and frequency in tandem between high and low levels in response to processor load.”</p><p>You will learn what both of these descriptions mean throughout this post.</p><p>On a production CPU (so not considering the things that can be done while designing the CPU), to save power, you can do two things. You can:</p><ul><li>eliminate the power consumption of a subsystem (a core or other resources like clock or cache) by completely powering it down (so cutting down the voltage, reducing it to zero)</li></ul><p>or</p><ul><li>decrease the power consumption by decreasing the voltage and/or the frequency of the subsystem and/or the whole processor</li></ul><p>The first one is simple to understand, if you shut down the power, you do not consume any power.</p><p>The second requires a bit more explanation. The power consumption of an integrated circuit (such as a processor) is proportional linearly to frequency and quadratically to voltage.</p><p>P ~ f VÂ²</p><blockquote><p>Note for those of you knowing more about digital electronics:</p></blockquote><blockquote><p>Pcpu is actually = Pdynamic + Psc + Pleak</p></blockquote><blockquote><p>On an active CPU, Pdynamic is the most important part, it is the part I mention here, being proportional to the frequency and quadratically to the voltage.</p></blockquote><blockquote><p>Psc=Pshort-circuit is proportional to the frequency.</p></blockquote><blockquote><p>Pleak is proportional to the voltage.</p></blockquote><p>Also, the voltage and frequency is not independent, and seems to have a linear relationship. (<a href="http://async.org.uk/tech-reports/NCL-EEE-MICRO-TR-2015-197.pdf">http://async.org.uk/tech-reports/NCL-EEE-MICRO-TR-2015-197.pdf</a>)</p><p>Higher (serial) performance requires both higher frequency and higher voltage, thus having even a larger effect on the power consumption.</p><p>This depends a lot on the processor but E3â€“1245 v5 @ 3.50 Ghz has Thermal Design Power (TDP) of 80 Watts. This is an average value the CPU can sustain forever (Power Limit/PL1 in the figure below) and it is usually the value that the cooling solutions should be designed at for reliability. Actual power CPU consumes can temporarily go higher (as shown as PL2, PL3 and PL4 in the figure below). TDP is measured under a high-complexity (~worst case) load with all cores active at the base frequency (of 3.50 Ghz).</p><figure><img data-src="https://metebalci.com/img/blog/cpu-package-power-control-figure-5-1.png" alt="CPU Package Power Control" src="https://metebalci.com/img/blog/cpu-package-power-control-figure-5-1.png"><figcaption><p>CPU Package Power Control</p></figcaption></figure><p>You can see in the figure above that the CPU can consume more power than TDP at PL2 for up to 100 seconds, that is actually quite a long duration.</p><p>The two ways to decrease the power consumption of a processor:</p><ul><li>powering down subsystems</li><li>voltage/frequency reduction</li></ul><p>is accomplished by using:</p><ul><li>C-states</li><li>P-states</li></ul><p>respectively.</p><p>C-states describe the first case, so they are the idle (power saving) states. In order to power down a subsystem, that subsystem should not be running anything, so it should be at idle, doing nothing, executing nothing. So C-state x, Cx, means one or more subsystems of the CPU is at idle, powered down.</p><p>On the other hand, P-states describe the second case, so they are the executing (power saving) states. The subsystem is actually running but it does not require full performance so the voltage and/or frequency it operates is decreased. So P-state x, Px, means the subsystem it refers to (e.g. a CPU core) is operating at a specific (frequency, voltage) pair.</p><p>Because most modern CPUs have multiple cores in a single package, C-states are further divided into core C-states (CC-states) and package C-states (PC-states). The reason for PC-states is there are other (shared) components in the processor that can also be powered down after all cores using them are powered down (e.g. the shared cache). However, as a user or programmer, we cannot control these, since we do not interact with the package directly, but we interact with the individual cores. So we can only affect the CC-states directly, PC-states are indirectly affected based on the CC-states of the cores.</p><p>The states are numbered starting from zero like C0, C1â€¦ and P0, P1… The higher the number is the more power is saved. C0 means no power saving by shutting down something, so everything is powered on. P0 means maximum performance, thus maximum frequency, voltage and power used.</p><p>The basic C-states (defined by ACPI) are:</p><ul><li>C0: Active, CPU/Core is executing instructions. P-states are relevant here, CPU/Core may be operating at its maximum performance (thus at P0) or at a lower performance/power (thus at anything other than P0).</li><li>C1: Halt, nothing is being executed, but it can return to C0 instantenously. Since it is not working (but halted), P-states are not relevant for C1 or any Cx other than C0.</li><li>C2: Stop-Clock, similar to C1 but it takes longer time to go back to C0.</li><li>C3: Sleep. It can go back to C0, but it will take considerably longer time.</li></ul><p>Many modern CPUs have plenty more C-states and according to its datasheet IntelÂ® XeonÂ® E3-1200 v5 Family has C0, C1, C1E (C1 Enhanced), C2, C3, C6, C7 and C8. C1 and C1E are CC-states only, and C2 is only a PC-state. All others are both a CC-state and a PC-state.</p><blockquote><p>Note: There are also thread level C-states because of Intel Hyper-Threading. However, the individual threads can only request C-states but power saving action only takes place when the core enters to that C-state. I will in general omit talking about Thread C-states and Hyper-Threading in this post.</p></blockquote><p>The descriptions of these states from the datasheet are:</p><figure><img data-src="https://metebalci.com/img/blog/processor-ia-core-package-state-support-table-4-2.png" alt="Processor IA Core / Package State Support Table" src="https://metebalci.com/img/blog/processor-ia-core-package-state-support-table-4-2.png"><figcaption><p>Processor IA Core / Package State Support Table</p></figcaption></figure><blockquote><p>Note: LLC above refers to Last Level Cache, meaning the shared L3 cache in the processor.</p></blockquote><p>and here there is a visual description:</p><figure><img data-src="https://metebalci.com/img/blog/flexible-c-states-to-select-idle-power-level-vs-responsiveness-figure-4.png" alt="Flexible C-states to select Idle Power Level vs. Responsiveness (from Software Impact to Platform Energy-Efficiency White Paper)" src="https://metebalci.com/img/blog/flexible-c-states-to-select-idle-power-level-vs-responsiveness-figure-4.png"><figcaption><p>Flexible C-states to select Idle Power Level vs. Responsiveness (from Software Impact to Platform Energy-Efficiency White Paper)</p></figcaption></figure><p>A very basic timeline of power saving using C-states is:</p><ul><li>The normal operation is at C0.</li><li>First, the clocks of idle core is stopped. (C1)</li><li>Then, the local caches (L1/L2) of the core is flushed and the core is powered down. (C3)</li><li>Then, when all the cores are powered down, the shared cache (L3/LLC) of the package is flushed and at the end the package/whole CPU can be (almost) powered down. I said almost because I guess there has to be something powered on to return back to C0.</li></ul><p>As you might guess, CC-states and PC-states are not independent, so some combinations are impossible. Figure below summarizes this:</p><figure><img data-src="https://metebalci.com/img/blog/processor-package-and-ia-core-c-states-figure-4-2.png" alt="Processor Package and IA Core C-States of Intel Xeon E3â€“1200 v5 Product Family" src="https://metebalci.com/img/blog/processor-package-and-ia-core-c-states-figure-4-2.png"><figcaption><p>Processor Package and IA Core C-States of Intel Xeon E3â€“1200 v5 Product Family</p></figcaption></figure><p>Obviously, if a core is running (C0), the package cannot be in a state other than C0. On the other hand, if a core is completely powered down (C8), the package can still be at C0 if any other core is still running.</p><blockquote><p>Note: Intel Software Developer’s Manual mentions sub C-states, or substates, meaning a C-state (type) actually contains one or more sub C-states. After checking the intel_idle driver code in the Linux kernel, I understand for example C1 and C1E has the same state type C1, but they are subtypes 0 and 1.</p><p>The number of subtypes of the eight C-state types (0..7) for C1..C8 is discovered by CPUID instruction. Looking at my CPU, cpuid program output returns:</p></blockquote><pre><code>MONITOR/MWAIT (5):
      smallest monitor-line size (bytes)       = 0x40 (64)
      largest monitor-line size (bytes)        = 0x40 (64)
      enum of Monitor-MWAIT exts supported     = true
      supports intrs as break-event for MWAIT  = true
      number of C0 sub C-states using MWAIT    = 0x0 (0)
      number of C1 sub C-states using MWAIT    = 0x2 (2)
      number of C2 sub C-states using MWAIT    = 0x1 (1)
      number of C3 sub C-states using MWAIT    = 0x2 (2)
      number of C4 sub C-states using MWAIT    = 0x4 (4)
      number of C5 sub C-states using MWAIT    = 0x1 (1)
      number of C6 sub C-states using MWAIT    = 0x0 (0)
      number of C7 sub C-states using MWAIT    = 0x0 (0)
</code></pre><blockquote><p>Also note from the Intel manual: “The definition of C0 through C7 states for MWAIT extension are processor-specific C-states, not ACPI Cstates”. So do not confuse these with the ACPI C-states I mentioned before, they are obviously related and there is a mapping between but they are not exactly same.</p></blockquote><p>I have created the chart below from the <code>intel_idle</code> driver source code for my cpu (model 0x5e). The horizontal axis labels indicate the C-state name:processor specific state:processor …</p></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://metebalci.com/blog/a-minimum-complete-tutorial-of-cpu-power-management-c-states-and-p-states/">https://metebalci.com/blog/a-minimum-complete-tutorial-of-cpu-power-management-c-states-and-p-states/</a></em></p>]]>
            </description>
            <link>https://metebalci.com/blog/a-minimum-complete-tutorial-of-cpu-power-management-c-states-and-p-states/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25536006</guid>
            <pubDate>Fri, 25 Dec 2020 12:08:04 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Some Differences Between macOS and Common Unix Systems]]>
            </title>
            <description>
<![CDATA[
Score 160 | Comments 65 (<a href="https://news.ycombinator.com/item?id=25535971">thread link</a>) | @dongyx
<br/>
December 25, 2020 | https://www.dyx.name/posts/macunix.html | <a href="https://web.archive.org/web/*/https://www.dyx.name/posts/macunix.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><p>Discuss some differences between macOS and common Unix systems to help Unix users get familiar with macOS sooner.</p><div>
				
<h2 id="users-and-groups">Users and Groups</h2>

<p>macOS manages users and groups by directory services instead of <code>/etc/passwd</code> and  <code>/etc/group</code>.  Consider a local network, for example, the one in your office, there’re many computers in the network and each has its own files, accounts, etc. A directory service organizes these distributed resources into one single index and makes them look like a directory hierarchy.</p>

<p>For example, <code>/Hosts/PC1</code> represents a host in the network and <code>/Users/Smith</code> represents a user in the network.<sup id="fnref:1" role="doc-noteref"><a href="#fn:1">1</a></sup></p>

<p>macOS uses the <code>dscl</code> command to interact with directory services.</p>

<p>To list all users on the system, we could run the following.</p>



<p>The first argument sets which datasource we want to retrieve from. A dot means the local datasource.</p>

<div><div><pre><code># List groups
dscl . -list /Groups
</code></pre></div></div>

<p>The <code>-list</code> option lets <code>dscl</code> print subitems of a resource.  Subitems of <code>/Users</code> are all users. Subitems of <code>/Groups</code> are all groups.</p>

<p>If we want to check the information about the resource instead of listing subitems we should use <code>-read</code>. For example, we could check the information of the user <code>Smith</code> like
the following.</p>

<div><div><pre><code># Retrieve the information of Smith
dscl . -read /Users/Smith
</code></pre></div></div>

<p><code>-read</code> prints keys and values of the specified resource. We could also specify the keys we want.</p>

<div><div><pre><code># Get the primary group ID and default shell of Smith
dscl . -read /Users/Smith PrimaryGroupID UserShell
</code></pre></div></div>

<p>To add a resource, we use <code>dscl . -create</code>. The following command adds a new user <code>belson</code>.</p>

<div><div><pre><code>sudo dscl . -create /Users/belson
</code></pre></div></div>

<p>It seems ok but it’s actually not. If we try to set a password for <code>belson</code> using <code>sudo passwd belson</code>, <code>passwd</code> will tell us the user doesn’t exist. Because <code>dscl</code> just adds a record to the data source but is doesn’t check the integrity. It doesn’t even assign a UID for <code>belson</code>. We must assign a UID and a primary group for <code>belson</code> after adding it to the datasource by ourselves.</p>

<div><div><pre><code>sudo dscl . -create /Users/belson UniqueID 511	# UID 511 for example
sudo dscl . -create /Users/belson PrimaryGroupID 20	# The staff group
</code></pre></div></div>

<p>Now, <code>belson</code> is a Unix user and you can set a password for him using <code>passwd</code>. However, you still can’t login as <code>belson</code> for we don’t assign him a shell.</p>

<div><div><pre><code>sudo dscl . -create /Users/belson UserShell /bin/bash
</code></pre></div></div>

<p>Well we can login as <code>belson</code> now but he doesn’t have a home directory. We must create the directory and specify it with <code>dscl</code>.</p>

<div><div><pre><code>sudo dscl . -create /Users/belson NFSHomeDirectory /Users/belson
sudo mkdir /User/belson
sudo chmod -R belson:staff /User/belson
</code></pre></div></div>

<p>Sounds hell right? But it’s not over. Run <code>dscl . -read /Groups/staff</code> and you will find that
neither the <code>GroupMembers</code> nor the <code>GroupMembership</code> attribute has any information about <code>belson</code>.  We have specified his primary group to <code>staff</code>. But as mentioned above, <code>dscl</code> doesn’t check the integrity. Bidirectional relationships must be maintained manually. This is the real hell.</p>

<p>To solve the user-group relationship problem, we could use <code>dseditgroup</code>. The following command adds <code>belson</code> to the <code>staff</code> group and it takes care of the integrity.<sup id="fnref:2" role="doc-noteref"><a href="#fn:2">2</a></sup></p>

<div><div><pre><code>sudo dseditgroup -o edit -a belson -t user staff
</code></pre></div></div>

<p>We should make a summary here. To create a user <code>belson</code> in the group <code>staff</code>, we need:</p>

<div><div><pre><code>sudo dscl . -create /Users/belson
sudo dscl . -create /Users/belson UniqueID 511	# UID 511 for example
sudo dscl . -create /Users/belson PrimaryGroupID 20	# The staff group
sudo dscl . -create /Users/belson UserShell /bin/bash
sudo dscl . -create /Users/belson NFSHomeDirectory /Users/belson
sudo dseditgroup -o edit -a belson -t user staff
sudo mkdir /User/belson
sudo chmod -R belson:staff /User/belson
</code></pre></div></div>

<p>It is painful for a system administrator to type so many commands just to create a new user. You must miss <code>adduser</code> and <code>addgroup</code> in Debian so much.</p>

<p>Luckily, since Mac OS X 10.10, the <code>sysadminctl</code> command is provided. It’s a high-level interface of <code>dscl</code>. Type <code>sysadminctl</code> in the terminal to see its usage<sup id="fnref:3" role="doc-noteref"><a href="#fn:3">3</a></sup>.</p>

<div><div><pre><code>Usage: sysadminctl
	-deleteUser &lt;user name&gt; [-secure || -keepHome] (interactive || -adminUser &lt;administrator user name&gt; -adminPassword &lt;administrator password&gt;)
	-newPassword &lt;new password&gt; -oldPassword &lt;old password&gt; [-passwordHint &lt;password hint&gt;]
	-resetPasswordFor &lt;local user name&gt; -newPassword &lt;new password&gt; [-passwordHint &lt;password hint&gt;] (interactive] || -adminUser &lt;administrator user name&gt; -adminPassword &lt;administrator password&gt;)
	-addUser &lt;user name&gt; [-fullName &lt;full name&gt;] [-UID &lt;user ID&gt;] [-shell &lt;path to shell&gt;] [-password &lt;user password&gt;] [-hint &lt;user hint&gt;] [-home &lt;full path to home&gt;] [-admin] [-picture &lt;full path to user image&gt;] (interactive] || -adminUser &lt;administrator user name&gt; -adminPassword &lt;administrator password&gt;)
	-secureTokenStatus &lt;user name&gt;
	-secureTokenOn &lt;user name&gt; -password &lt;password&gt; (interactive || -adminUser &lt;administrator user name&gt; -adminPassword &lt;administrator password&gt;)
	-secureTokenOff &lt;user name&gt; -password &lt;password&gt; (interactive || -adminUser &lt;administrator user name&gt; -adminPassword &lt;administrator password&gt;)
	-guestAccount &lt;on || off || status&gt;
	-afpGuestAccess &lt;on || off || status&gt;
	-smbGuestAccess &lt;on || off || status&gt;
	-automaticTime &lt;on || off || status&gt;
	-filesystem status
	-screenLock &lt;immediate || off&gt; -password &lt;password&gt;

Pass '-' instead of password in commands above to request prompt.
'-adminPassword' used mostly for scripted operation. Use '-' or 'interactive' to get the authentication string interactivly. This preferred for security reasons
</code></pre></div></div>

<p>We use <code>sysadminctl</code> to delete <code>belson</code> first.</p>

<div><div><pre><code>sudo sysadminctl -deleteUser belson -secure
</code></pre></div></div>

<p>Using <code>dscl</code> to check the directory service, we could find that everything we did is removed.</p>

<p>Now, we add <code>belson</code> again with <code>sysadminctl</code>:</p>

<div><div><pre><code>sudo sysadminctl -addUser belson
sudo dseditgroup -o edit -a belson -t user staff
</code></pre></div></div>

<p>Two commands finish the job.</p>

<h2 id="filesystem-hierarchy">Filesystem Hierarchy</h2>

<p>If you check the root directory, you will see some traditional Unix things like <code>/usr</code>, <code>/var</code>, and <code>/etc</code>. You may also find mac-specified things like <code>/Library</code> <code>/Applications</code>, and <code>/cores</code>.</p>

<p>A list of mac-specified directories with their purposes in the root directory is here<sup id="fnref:4" role="doc-noteref"><a href="#fn:4">4</a></sup>.</p>

<table>
  <thead>
    <tr>
      <th>Directory</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>/private</td>
      <td>Contains the tmp, var, etc, directories. <code>/tmp</code>, <code>/var</code>, <code>/etc</code> are symbolic links to these subdirectories</td>
    </tr>
    <tr>
      <td>/Library</td>
      <td>Contains support files for locally installed applications, among other things.</td>
    </tr>
    <tr>
      <td>/System</td>
      <td>Contains a subdirectory, Library, that holds support files for the system and system applications, among other things.</td>
    </tr>
    <tr>
      <td>/Network</td>
      <td>Contains network-mounted Application, Library, and Users directories, as well as a Servers directory that contains directories mounted by the auto mount daemon.</td>
    </tr>
    <tr>
      <td>/Users</td>
      <td>Contains home directories for the users on the system. The root user’s home directory is /var/root (actually /private/var/root).</td>
    </tr>
    <tr>
      <td>/Volumes</td>
      <td>Contains all visible mounted filesystems, including removable media and mounted disk images.</td>
    </tr>
  </tbody>
</table>

<p>We could make a list to compare some of them with Linux.</p>

<table>
  <thead>
    <tr>
      <th>macOS</th>
      <th>Linux</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>/System/Library</td>
      <td>/lib</td>
    </tr>
    <tr>
      <td>/Library</td>
      <td>/usr/lib, /usr/local/lib</td>
    </tr>
    <tr>
      <td>/Users</td>
      <td>/home</td>
    </tr>
    <tr>
      <td>/Volumes</td>
      <td>/mnt, /media</td>
    </tr>
  </tbody>
</table>

<p>You may be confused here for the difference between <code>/Library</code> and <code>/usr/lib</code>. Which directory should we put libraries into?</p>

<p><code>/Library</code> is for macOS-specified softwares, like the data of things you download from the App Store, and BSD programs shipped with macOS, like modules of pre-installed Perl and of pre-installed Python.</p>

<p><code>/usr/lib</code> and <code>/usr/local/lib</code> are for Unix programs installed by yourself.</p>

<h2 id="booting">Booting</h2>

<p>In modern Linux, the first program launched by the kernel is <code>systemd</code>. In macOS it’s <code>launchd</code><sup id="fnref:5" role="doc-noteref"><a href="#fn:5">5</a></sup>.</p>

<p><code>launchd</code> manages two types of services, <code>LaunchDaemon</code> and <code>LaunchAgent</code>. <code>LaunchDaemon</code> will be launched after the system is booted. <code>LaunchAgent</code> will be launched after a user is logged-in.</p>

<p>If a program needs to be launched after the system is booted, a <code>.plist</code> file is required to be placed into <code>/Library/LaunchDaemons</code> or <code>/System/LaunchDaemons</code>.</p>

<p>If a program needs to be launched after a user logged-in, a <code>.plist</code> file is required to be placed into <code>/Library/LaunchAgents</code> or <code>/System/LaunchAgents</code>, or <code>~/Library/LaunchAgents</code> of the user.</p>

<p>The <code>launchctl</code> command is used to control services of <code>launchd</code>.</p>

<div><div><pre><code># to enable sshd
sudo launchctl load -w /System/Library/LaunchDaemons/ssh.plist

# to disable sshd
sudo launchctl unload -w /System/Library/LaunchDaemons/ssh.plist
</code></pre></div></div>

<h2 id="development">Development</h2>

<p>You bought a Mac for development. People told you that you need to do the following two things:</p>

<ul>
  <li>
    <p>Install Xcode from the app store</p>
  </li>
  <li>
    <p>Install command line tools using <code>xcode-select --install</code></p>
  </li>
</ul>

<p>You finished them, opened the terminal and found everything is familiar. You decided to write a classic Hello World with C to celebrate.</p>

<div><div><pre><code>#include &lt;stdio.h&gt;

int main(void)
{
	printf("%s\n", "hello, world");
	return 0;
}
</code></pre></div></div>

<p>If you’re using a 3rd party compiler, the compiler may tell you that <code>stdio.h</code> can’t be found.</p>

<p>No such fundamental file? You want to check <code>/usr/include</code> and you will find that even <code>/usr/include</code> doesn’t exist.</p>

<p>The reason is that header files are put into the package of Xcode in newer Xcode like Xcode 10. You can run <code>xcrun --show-sdk-path</code> to print the path<sup id="fnref:6" role="doc-noteref"><a href="#fn:6">6</a></sup>.</p>

<div><div><pre><code>$ xcrun --show-sdk-path
/Library/Developer/CommandLineTools/SDKs/MacOSX.sdk
</code></pre></div></div>

<p>Then you can use <code>-isysroot</code> to specify the path for the compiler, for example:</p>

<div><div><pre><code>gcc -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX.sdk hello.c
</code></pre></div></div>

<h2 id="package-manager">Package Manager</h2>

<p>The first package installed to the system is usually a package manager. However, macOS has no default package manager. If you search online, you will find that <a href="https://brew.sh/">Homebrew</a> is the most popular package manager for macOS.</p>

<p>Homebrew is good for many people but not for one who wants things to go more like common Unix systems.</p>

<p>Homebrew can’t run as root. If you want to install python, you run <code>brew install python</code> instead of <code>sudo brew install python</code>. Homebrew installs packages to <code>/usr/local</code>. To achieve its goal about sudo-free, Homebrew changes the owner of all files and subdirectories under <code>/usr/local</code> to the user who installed Homebrew.</p>

<p>This brings security issues. Considering a malware …</p></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://www.dyx.name/posts/macunix.html">https://www.dyx.name/posts/macunix.html</a></em></p>]]>
            </description>
            <link>https://www.dyx.name/posts/macunix.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-25535971</guid>
            <pubDate>Fri, 25 Dec 2020 12:00:20 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Planner 2.6 – An open-source Todoist alternative for Linux]]>
            </title>
            <description>
<![CDATA[
Score 230 | Comments 42 (<a href="https://news.ycombinator.com/item?id=25535822">thread link</a>) | @rayrag
<br/>
December 25, 2020 | https://useplanner.com/release/2020/12/24/merry-christmas-everyone-planner-2-6-is-here/ | <a href="https://web.archive.org/web/*/https://useplanner.com/release/2020/12/24/merry-christmas-everyone-planner-2-6-is-here/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
		<h2 id="board-view-is-here">Board View is here</h2>

<p>For Todoist users, the Board View was introduced in this new update, a more visual way to organize your Planner projects. This new layout makes it easy to see the big picture of your projects and make progress from start to finish.</p>

<p><img src="https://useplanner.com/images/blogs/2020-12-24-merry-christmas-everyone-planner-2-6-is-here/board.png" alt="Planner 2.6 Planner Board"></p>

<p>To see your projects in the <b>Board View</b>, press the three dots icon in the top right, and select <b>View as board</b>. You’ll be able to rearrange your sections, create new ones, and drag your tasks to anywhere on your board.</p>

<p><img src="https://useplanner.com/images/blogs/2020-12-24-merry-christmas-everyone-planner-2-6-is-here/board-settings.png" alt="Planner 2.6 Planner Board 2"></p>

<h2 id="sub-project">Sub-project</h2>
<p>One of the most requested features comes to Planner 2.6, keep your ever-growing project list neat and organized with sub-projects.</p>

<p>You can collapse sub-projects under their “parent” projects to temporarily hide them from view. This helps to focus on the right projects at the right time, without getting distracted by everything else.</p>

<p><img src="https://useplanner.com/images/blogs/2020-12-24-merry-christmas-everyone-planner-2-6-is-here/sub-project.png" alt="Planner 2.6 Planner Board 2"></p>

<h3 id="how-to-turn-a-project-into-a-sub-project">How to turn a project into a sub-project</h3>

<ol>
  <li>Right click on a project.</li>
  <li>Select the <b>Move</b> option.</li>
  <li>Select a project.</li>
</ol>

<h2 id="new-features">New Features</h2>
<h3 id="quick-search">Quick Search</h3>

<p>A big update for the Quick Find feature is here, with new views and feactures.</p>

<p><img src="https://useplanner.com/images/blogs/2020-12-24-merry-christmas-everyone-planner-2-6-is-here/Quick%20Search.png" alt="Planner 2.6 Planner Board 2"></p>

<ul>
  <li>Quick Search now saves your last searches, so you can hop around without even typing.</li>
  <li>Added new <b>Tomorrow</b> view.</li>
  <li>Now it is possible to search between <b>Sections</b></li>
</ul>

<h3 id="task-defaults">Task defaults</h3>

<p>Added a new view in <b>Preferences</b> to edit task defaults.</p>

<p><img src="https://useplanner.com/images/blogs/2020-12-24-merry-christmas-everyone-planner-2-6-is-here/tasks-defaults.png" alt="Planner 2.6 Planner Board 2"></p>

<ul>
  <li>New tasks on top: Indicate the position where the new tasks were created.</li>
  <li>Underline completed tasks.</li>
  <li>Default priority: Select the default priority when creating a task.</li>
</ul>

<h3 id="add-tasks-projects-sections-asynchronously">Add tasks, projects, sections asynchronously</h3>

<p>Adding a task, project or section is a quick process but sometimes this process stops or does not respond mainly to problems with the internet connection. Planner 2.6 creates the tasks asynchronously with the possibility of being able to cancel the process at any time.</p>

<p><img src="https://useplanner.com/images/blogs/2020-12-24-merry-christmas-everyone-planner-2-6-is-here/AsyncTask.gif" alt="Planner 2.6 Planner Board 2"></p>

<h3 id="filter-your-projects-by-labels">Filter your projects by labels</h3>
<p>It is now possible to filter the tasks within a project by labels.</p>

<p><img src="https://useplanner.com/images/blogs/2020-12-24-merry-christmas-everyone-planner-2-6-is-here/filter-labels.gif" alt="Planner 2.6 Planner Board 2"></p>


<p>Labels have been added in the sidebar to make the use of filter by labels much faster.</p>

<p><img src="https://useplanner.com/images/blogs/2020-12-24-merry-christmas-everyone-planner-2-6-is-here/label-sidebar.png" alt="Planner 2.6 Planner Board 2"></p>

<h3 id="more-customization">More customization</h3>

<p>It is now possible to sort the position <b>Inbox</b>, <b>Today</b> and <b>Upcoming</b> by 
Drag &amp; Drop.</p>

<p><img src="https://useplanner.com/images/blogs/2020-12-24-merry-christmas-everyone-planner-2-6-is-here/ActionMoved.png" alt="Planner 2.6 Planner Board 2"></p>

<h3 id="code-cleanup--performance-improvement">Code cleanup &amp; performance improvement</h3>
<p>A giant code cleanup was done and resource usage was improved. Now Planner is faster and works much better.</p>

<p>Planner 2.6 is available for download now on <a href="https://appcenter.elementary.io/com.github.alainm23.planner/">AppCenter</a> and <a href="https://flathub.org/apps/details/com.github.alainm23.planner">Flathub</a>. We hope you’ll enjoy these improvements.</p>

<p>Planner is being developed with ❤️ and passion for Open Source. However, if you like Planner and want to support its development, consider donating to via:</p>
<ul>
  <li><a href="https://www.patreon.com/alainm23">Patreon</a></li>
  <li><a href="https://www.paypal.me/alainm23">PayPal</a></li>
</ul>



		<!-- <div class="author">
			
			
			<div class="square-image"><img src="https://avatars0.githubusercontent.com/u/33765137?v=4
" alt="Alain"/></div>
			<p class="blurb">Alain likes to discover and create new things.</p>
		</div> -->

		

		
			
			
			
		
	</div></div>]]>
            </description>
            <link>https://useplanner.com/release/2020/12/24/merry-christmas-everyone-planner-2-6-is-here/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25535822</guid>
            <pubDate>Fri, 25 Dec 2020 11:19:22 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Outer Orbit – old school Spacewar-for-one game]]>
            </title>
            <description>
<![CDATA[
Score 49 | Comments 13 (<a href="https://news.ycombinator.com/item?id=25535626">thread link</a>) | @masswerk
<br/>
December 25, 2020 | https://www.masswerk.at/outerorbit/ | <a href="https://web.archive.org/web/*/https://www.masswerk.at/outerorbit/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="about">
		<p><strong>About Outer Orbit</strong><br>
		<em>Outer Orbit</em> is an attempt to create a “Spacewar!-for-one” as a tribute to the line of heritage of digital video games. It combines elements of the most classic shooter games, <em>Spacewar!</em> (1961/62) <a href="https://www.masswerk.at/spacewar/">[1]</a>, the first known video game on a digital computer, <em>Computer Space</em> (1971) <a href="https://www.masswerk.at/rc2017/04/02.html" target="_blank">[2]</a> <a href="https://www.masswerk.at/icss/" target="_blank">[3]</a> <a href="https://en.wikipedia.org/wiki/Computer_Space" target="_blank" rel="noopener">[4]</a>, the first coin-operated digital video game, and <em>Asteroids</em> (1979) <a href="https://en.wikipedia.org/wiki/Asteroids_(video_game)" target="_blank" rel="noopener">[5]</a>:</p>
		<ul>
			<li>From <em>“<a href="https://www.masswerk.at/spacewar/" target="_blank">Spacewar!</a>”</em> it borrows the comic book spaceship, the central star, gravity and orbital mechanics,</li>
			<li>from <em>“<a href="https://www.masswerk.at/icss/" target="_blank">Computer Space</a>”</em> the game mechanics of the saucer opponents and the time-based gameplay,</li>
			<li>from <em>“<a href="https://en.wikipedia.org/wiki/Asteroids_(video_game)" target="_blank" rel="noopener">Asteroids</a>”,</em> well, the asteroids, which serve here just as additional obstacles to make the game a bit trickier.</li>
		</ul>
		<p>Enjoy!</p>
		<p><strong>Note:</strong> A wave has a fixed duration of 80 seconds. You may progress to the next wave/level, if you manage to outscore the saucers in a given level, i.e. shoot the saucers more often than your ship crashes, by this maintaining a positive balance. Mind that the balance is reset to zero at the start of each level.</p>
		<p><strong>Tip:</strong> Like in <em>Spacewar!</em> enter an orbit around the gravitational star by aligning your spaceship perpendicular to its center and firing your thruster for two or three seconds. — Do not attempt to destroy asteroids, dodge them.</p>
		<p><strong>Implementation Notes:</strong> The sound-scape is for the most a homage to <em>Computer Space,</em> less the background hum. The display font is based on definitions for a PDP-1 font renderer (early 1960s) and implemented in software. In order to bring the iterative machanics of a gravity based game to the modern age of asynchronous rendering, the game is computed internally in fixed time slices of an 1/100<sup>th</sup> of a second and the display rendered on demand.</p>
		<p><strong>Setting an Initial Level:</strong> Experienced players may want to select the initial level by specifying a wave as an URL-parameter, as in <a href="https://www.masswerk.at/outerorbit/?wave=30">https://www.masswerk.at/outerorbit/?wave=30</a> for a game starting at wave #30.</p>
		<p>© 2017–2020 Norbert Landsteiner, <a href="https://www.masswerk.at/">www.masswerk.at</a>.</p>
	</div></div>]]>
            </description>
            <link>https://www.masswerk.at/outerorbit/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25535626</guid>
            <pubDate>Fri, 25 Dec 2020 10:33:18 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Linux Hardening Guide]]>
            </title>
            <description>
<![CDATA[
Score 7 | Comments 0 (<a href="https://news.ycombinator.com/item?id=25535489">thread link</a>) | @ignoramous
<br/>
December 25, 2020 | https://madaidans-insecurities.github.io/guides/linux-hardening.html | <a href="https://web.archive.org/web/*/https://madaidans-insecurities.github.io/guides/linux-hardening.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page">
    

    <p><i><time datetime="2020-12-25">Last edited: December 25, 2020</time></i></p>

    <div>
      <p><a href="https://madaidans-insecurities.github.io/linux.html">Linux is not a secure operating system</a>. However, there are steps you can take to improve it. This guide aims to explain
      how to harden Linux as much as possible for security and privacy. This guide attempts to be distribution-agnostic and is not tied to any specific one. </p><p>
      
      DISCLAIMER: Do not attempt to apply anything in this article if you do not know exactly what you are doing. This guide is focused purely on security and privacy,
      not performance, usability, or anything else. </p><p>
      
      All commands listed in this guide will require root privileges. Words beginning with "$" sign indicate a variable that may differ between users as to suit their
      setup.
    </p></div>

    <h2>Contents</h2>

    

    <h2 id="choosing-the-right-distro"><a href="#choosing-the-right-distro">1. Choosing the right Linux distribution</a></h2>

    <p>
      There are many factors that go into choosing a good Linux distribution.
    </p>

    <ul>
      <li>
        Avoid distributions that freeze packages as <a href="https://madaidans-insecurities.github.io/linux.html#debian">they are often quite behind on security updates</a>.
      </li>

      <li>
        Use a distribution with an init system other than <a href="https://systemd.io/">systemd</a>. systemd contains a lot of unnecessary
        attack surface; <a href="https://ewontfix.com/14/">it attempts to do far more things than necessary</a> and goes beyond what an
        init system should do. An init system should not need many lines of code to function properly.
      </li>

      <li>
        Use <a href="https://musl.libc.org/">musl</a> as the default C library. musl is heavily focused on minimality which <a href="https://github.com/NixOS/nixpkgs/issues/90147#issuecomment-643473182">results in very small attack surface</a> whereas other C libraries
        such as glibc are overly complex and prone to vulnerabilities. For example, <a href="https://www.cvedetails.com/vulnerability-list/vendor_id-72/product_id-767/GNU-Glibc.html">
        over a hundred vulnerabilities in glibc have been publicly disclosed</a> compared to the <a href="https://www.cvedetails.com/vulnerability-list/vendor_id-16859/product_id-39652/Musl-libc-Musl.html">
        very few in musl</a>. While counting CVEs by itself is often an inaccurate statistic, it can sometimes be used to represent an overaching issue such as
        in this case. musl also has <a href="https://www.dustri.org/b/security-features-of-musl.html"> decent exploit mitigations</a>, particularly its
        <a href="https://www.openwall.com/lists/musl/2020/05/13/1">new hardened memory allocator</a>.
      </li>

      <li>
        Preferably use a distribution that utilizes <a href="https://www.libressl.org/">LibreSSL</a> by default rather than <a href="https://www.openssl.org/">
        OpenSSL</a>. <a href="https://arstechnica.com/information-technology/2014/04/openssl-code-beyond-repair-claims-creator-of-libressl-fork/">OpenSSL contains
        tremendous amounts of totally unnecessary attack surface and follows poor security practices</a>. For example, it still maintains OS/2 and VMS support —
        ancient operating systems that are multiple decades old. These abhorrent security practices are what led to the dreaded <a href="https://en.wikipedia.org/wiki/Heartbleed">Heartbleed vulnerability</a>. LibreSSL is a fork of OpenSSL by the OpenBSD team that applies
        <a href="https://en.wikipedia.org/wiki/LibreSSL#Changes">superior programming practices</a> and <a href="https://opensslrampage.org/">eradicates
        a lot of attack surface</a>. Within LibreSSL's first year, <a href="https://www.openbsd.org/papers/libtls-fsec-2015/mgp00005.html">it mitigated a
        large number of vulnerabilities, including a few high severity ones</a>.
      </li>
    </ul>

    <div><p>
      The best distribution to use as a base for your hardened operating system would be <a href="https://www.gentoo.org/">Gentoo Linux</a> as it allows you to configure
      your system exactly how you want it to be which will be extremely useful, especially when we come to <a href="#hardened-compilation-flags">more secure compilation
      flags</a> later in the guide. </p><p>
      
      However, Gentoo may not be feasible for many people due to its significant usability pitfalls. In this case, <a href="https://voidlinux.org/">Void Linux</a>'s musl
      build is a good compromise.
    </p></div>

    <h2 id="kernel"><a href="#kernel">2. Kernels</a></h2>

    <p>
      The kernel is the core of the operating system and is unfortunately very prone to attacks. As Brad Spengler has once said, <a href="https://grsecurity.net/huawei_hksp_introduces_trivially_exploitable_vulnerability">it can be thought of as the largest,
      most vulnerable setuid root binary on the system</a>. Thus, it is very important for the kernel to be hardened as much as possible.
    </p>

    <h3 id="stable-vs-lts"><a href="#stable-vs-lts">2.1 Stable vs. LTS kernels</a></h3>

    <div><p>
      The Linux kernel is released under two main forms: stable and long-term support (LTS). Stable releases are more recent whereas LTS
      releases are an older stable release that is being supported for a long time. <a href="https://www.grsecurity.net/the_truth_about_linux_4_6">
      There are many consequences to choosing either of the aforementioned releases</a>. </p><p>
      
      The Linux kernel <a href="https://grsecurity.net/reports_of_cves_death_greatly_exaggerated">does not use CVEs to identify security
      vulnerabilities properly</a>. This means that fixes for most security vulnerabilities are not able to be backported to LTS kernels;
      but stable releases contain all security fixes made so far. </p><p>
      
      With those fixes however, a stable kernel includes a lot more new features, therefore vastly increasing the attack surface of the
      kernel and introducing a large amount of new bugs. On the contrary, LTS kernels have less attack surface because these features are
      not being constantly added. </p><p>
      
      Additionally, stable kernels include newer hardening features to mitigate certain exploits which LTS kernels do not. A few examples
      of such features are the <a href="https://mjg59.dreamwidth.org/55105.html">Lockdown LSM</a> and <a href="https://a13xp0p0v.github.io/2018/11/04/stackleak.html">STACKLEAK GCC plugin</a>. </p><p>
      
      To conclude, there is a trade-off when choosing a stable or LTS kernel. LTS kernels have less hardening features and not all public bug fixes
      at that point have been backported, but it generally has less attack surface and potentially a smaller chance of introducing unknown bugs.
      Stable kernels have more hardening features and all known bug fixes are included but it also has more attack surface and greater chances of
      introducing more unknown bugs. In the end though, a more recent LTS branch such as the 4.19 kernel would be preferred due to the much smaller
      attack surface.
    </p></div>

    <h3 id="sysctl"><a href="#sysctl">2.2 Sysctl</a></h3>

    <p>
      Sysctl is a tool that allows the user to configure certain kernel settings and enable various security features or disable dangerous
      features to reduce attack surface. To change settings temporarily you can execute:
    </p>

    <pre><code>sysctl -w $tunable = $value</code></pre>

    <div><p>
      To change sysctls permanently you can add the one you want to change to <code>/etc/sysctl.conf</code> or the corresponding files within
      <code>/etc/sysctl.d</code>, depending on your Linux distribution. </p><p>
      
      The following are the recommended sysctl settings that you should change.
    </p></div>

    <h4 id="sysctl-kernel"><a href="#sysctl-kernel">2.2.1 Kernel self-protection</a></h4>

    <pre><code>kernel.kptr_restrict=2</code></pre>

    <p>
      A kernel pointer points to a specific location in kernel memory. <a href="https://kernsec.org/wiki/index.php/Bug_Classes/Kernel_pointer_leak">
      These can be very useful in exploiting the kernel</a> but kernel pointers are not hidden by default — it is easy to uncover them by, for example,
      reading the contents of <code>/proc/kallsyms</code>. This setting aims to mitigate kernel pointer leaks. Alternatively, you can set
      <code>kernel.kptr_restrict=1</code> to only hide kernel pointers from processes without the <code>CAP_SYSLOG</code> <a href="#capabilities">capability</a>.
    </p>

    <pre><code>kernel.dmesg_restrict=1</code></pre>

    <p>
      <a href="https://en.wikipedia.org/wiki/Dmesg">dmesg</a> is the kernel log. It exposes a large amount of useful kernel debugging information but this
      can often leak sensitive information such as kernel pointers. Changing the above sysctl restricts the kernel log to the <code>CAP_SYSLOG</code>
      <a href="#capabilities">capability</a>.
    </p>

    <pre><code>kernel.printk=3 3 3 3</code></pre>

    <p>
      Despite the value of <code>dmesg_restrict</code>, the kernel log will still be displayed in the console during boot. Malware that is
      able to record the screen during boot may be able to abuse this to gain higher privileges. This option prevents those information
      leaks. This must be used in combination with certain boot parameters <a href="#boot-kernel">described below</a> to be fully effective.
    </p>

    <pre><code>kernel.unprivileged_bpf_disabled=1
net.core.bpf_jit_harden=2</code></pre>

    <p>
      <a href="https://madaidans-insecurities.github.io/linux.html#kernel">eBPF exposes quite large attack surface</a>. As such, it must be restricted. These sysctls restrict eBPF
      to the <code>CAP_BPF</code> <a href="#capabilities">capability</a> (<code>CAP_SYS_ADMIN</code> on kernel versions prior to 5.8) and enable
      JIT hardening techniques such as <a href="https://github.com/torvalds/linux/blob/9e4b0d55d84a66dbfede56890501dc96e696059c/include/linux/filter.h#L1039-L1070">constant blinding</a>.
    </p>

    <pre><code>dev.tty.ldisc_autoload=0</code></pre>

    <p>
      This <a href="https://lkml.org/lkml/2019/4/15/890">restricts loading TTY line disciplines</a> to the <code>CAP_SYS_MODULE</code>
      <a href="#capabilities">capability</a> to prevent unprivileged attackers from loading vulnerable line disciplines with the <code>TIOCSETD</code>
      ioctl which <a href="https://a13xp0p0v.github.io/2017/03/24/CVE-2017-2636.html">has been abused in a number of exploits before</a>.
    </p>

    <pre><code>vm.unprivileged_userfaultfd=0</code></pre>

    <p>
      The <code><a href="https://man7.org/linux/man-pages/man2/userfaultfd.2.html">userfaultfd()</a></code> syscall is <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=cefdca0a86be517bc390fc4541e3674b8e7803b0">often</a> <a href="https://duasynt.com/blog/linux-kernel-heap-spray">abused</a> to exploit use-after-free flaws. Due to this, this sysctl is used to restrict
      this syscall to the <code>CAP_SYS_PTRACE</code> <a href="#capabilities">capability</a>.
    </p>

    <pre><code>kernel.kexec_load_disabled=1</code></pre>

    <p>
      <a href="https://en.wikipedia.org/wiki/Kexec">kexec is a system call that is used to boot another kernel during runtime</a>. This functionality can
      be abused to load a malicious kernel and gain arbitrary code execution in kernel mode so this sysctl disables it.
    </p>

    <pre><code>kernel.sysrq=4</code></pre>

    <p>
      The <a href="https://www.kernel.org/doc/html/latest/admin-guide/sysrq.html">SysRq key</a> exposes a lot of potentially dangerous debugging functionality
      to unprivileged users. Contrary to common assumptions, SysRq is not only an issue for physical attacks as <a href="https://github.com/xairy/unlockdown">
      it can also be triggered remotely</a>. The value of this sysctl makes it so that a user can only use the <a href="https://www.kernel.org/doc/Documentation/SAK.txt">
      secure attention key</a> which will be necessary for <a href="#accessing-root-securely">accessing root securely</a>. Alternatively, you can simply set the
      value to <code>0</code> to disable SysRq completely.
    </p>

    <pre><code>kernel.unprivileged_userns_clone=0</code></pre>

    <div><p>
      User namespaces are a feature in the kernel which aim to improve sandboxing and make it easily accessible for unprivileged users however, <a href="https://madaidans-insecurities.github.io/linux.html#kernel">this feature exposes significant kernel attack surface for privilege escalation</a> so this sysctl restricts the
      usage of user namespaces to the <code>CAP_SYS_ADMIN</code> <a href="#capabilities">capability</a>. For unprivileged sandboxing,
      it is instead recommended to use a setuid binary with little attack surface to minimize the potential for privilege escalation. This topic is
      covered further in the <a href="#application-sandboxing">sandboxing section</a>. </p><p>
      
      Be aware though that this sysctl only exists on certain Linux distributions as it requires a kernel patch. If your kernel does not include
      this patch, you can alternatively disable user namespaces completely (including for root) by setting <code>user.max_user_namespaces=0</code>.
    </p></div>

    <pre><code>kernel.perf_event_paranoid=3</code></pre>

    

    <h4 id="sysctl-network"><a href="#sysctl-network">2.2.2 Network</a></h4>

    <pre><code>net.ipv4.tcp_syncookies=1</code></pre>

    <p>
      This helps protect against <a href="https://en.wikipedia.org/wiki/SYN_flood">SYN flood attacks</a> which are a form of denial of service attack
      in which an attacker sends a large amount of bogus SYN requests in an attempt to consume enough resources to make the system unresponsive to
      legitimate traffic.
    </p>

    <pre><code>net.ipv4.tcp_rfc1337=1</code></pre>

    <p>
      This protects against <a href="https://tools.ietf.org/html/rfc1337">time-wait assassination</a>…</p></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://madaidans-insecurities.github.io/guides/linux-hardening.html">https://madaidans-insecurities.github.io/guides/linux-hardening.html</a></em></p>]]>
            </description>
            <link>https://madaidans-insecurities.github.io/guides/linux-hardening.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-25535489</guid>
            <pubDate>Fri, 25 Dec 2020 09:59:44 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Trading Time for Money]]>
            </title>
            <description>
<![CDATA[
Score 102 | Comments 33 (<a href="https://news.ycombinator.com/item?id=25535366">thread link</a>) | @nicbou
<br/>
December 25, 2020 | https://nicolasbouliane.com/blog/trading-time-for-money | <a href="https://web.archive.org/web/*/https://nicolasbouliane.com/blog/trading-time-for-money">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
                            <div>
        <article>
            <p>
                Posted on <time datetime="2020-12-24 09:53:00">December 24, 2020</time>
            </p>
                        <p>According to conventional wisdom, if you earn 31€/hour, and a task costs less than that to outsource, then you should always pay someone else to do it. For example, if your cleaning person charges 15€/hour, you save 16€ for every hour you spend at work instead of cleaning your house.</p>
<p>I've encountered this advice quite often, particularly among the wealthier, productivity porn-loving, <em>4-Hour Work Week</em>-thumping entrepreneur crowd.<br></p>
<p>I don't think that advice is quite right.</p>
<h2>Your time is worth less than you think</h2>
<p>There is a hefty tax on converting time to money. In Germany, if you earned the average income (42 421€ per year)<sup><a href="https://www.statista.com/statistics/416207/average-annual-wages-germany-y-on-y-in-euros/">1</a></sup>, you'd lose roughly a quarter of it to income tax<sup><a href="http://www.parmentier.de/steuer/index.php?site=einkommensteuerrechnerjava">1</a></sup>. Your 31€/hour salary<sup><a href="https://www.statista.com/statistics/416207/average-annual-wages-germany-y-on-y-in-euros/">1</a>, <a href="https://clockify.me/working-hours">2</a></sup> is actually worth 24€/hour after taxes.</p>
<p>But there is more to account for: health insurance (7.3%), unemployment insurance (1.25%), public pension (9.3%) and nursing care insurance (1.775%)<sup><a href="http://www.parmentier.de/steuer/index.php?site=lohnsteuerrechnerjava">1</a></sup> are also deducted from your salary. When it's all said and done, you take home about 20€/hour. If you also pay church tax and get the most expensive health insurance, you keep 19€/hour.</p>
<p>So again, if you earn the average 31€/hour, and work the average 1386 hours per year, you save about 4€ per hour - not 16€ - by hiring a cleaning person who charges half your rate.</p>
<p>Taxes aren't the only thing that whittle away your disposable income. You also have some unavoidable expenses, namely rent, groceries and utilities. That's 550€, 150€ and 100€ per month for a single, thrifty Berliner. That's 35% of your take-home salary, so you're left with 12.50€/hour in disposable income. At this point, I'm including decimals, because they start to matter.</p>
<p>In other words, you must sell 72 minutes of your life to buy 60 minutes of your cleaning person's life, even though you earn twice as much.</p>
<p>Here's a recap for the mathematically inclined:</p>
<pre>hourly_disposable income = (
    (gross_income - income_tax)
    - health_insurance
    - unemployment_insurance
    - pension_insurance
    - nursing_care_insurance
    - (rent + groceries + utilities) * 12
) / hours_worked_per_year</pre>
<p>Keep in mind that this describes the reality in Germany, where people work much less, but pay higher taxes. You will get wildly different results in your own country.</p>
<h2>Outsourcing costs more than you think</h2>
<p>Eating out is often used as an example of trading money for time. It's faster than cooking your own food: no shopping, no cooking, no cleaning.<br></p>
<p>In Berlin, you can get a square meal for 10€. A croissant, a coffee and two square meals would set you back 20€ a day. By comparison, my grocery bill is 5€ a day. That's a 450€/month difference, or 37.5 hours of your time (see above), but you'd probably spend that much time between the supermarket and the kitchen anyway.<br></p>
<p>However, getting to&nbsp;the restaurant, ordering, waiting for your food, then waiting for the bill takes time too. Personally, I&nbsp;find cooking every other day more convenient  than eating out twice a day. Eating out only makes sense when I'm too tired to cook.<br></p>
<p>This also applies to hiring professionals. You still need time to find one and to work with their schedule. I can change the oil or the brakes on my motorcycle in about 30 minutes. It takes me about as long to drop my bike off at the dealership, but I&nbsp;have to do it during office hours, and wait a few days to get it back.<br></p>
<p>In short, outsourcing your work does not always make life easier. It can lighten your mental load, but so does working less by having lower expenses.<br> </p>
<h2>Time is not a liquid asset</h2>
<p>In practice, you don't get to choose how much of your time you sell.&nbsp;If your expenses are covered, you just can't stop going to work. If you need more money, you could work more, but rarely on your own terms, just when you need to. You couldn't sell an extra 2 hours of programming on a Thursday night, because you have nothing else going on.&nbsp; There's also a limit on how much time you can sustainably sell, regardless of demand - about 60 hours a week.<br></p>
<p>You can't choose which time you sell either. Most employers will only buy your office hours. You can't decide to work night shifts, or to work 80 hour weeks in the winter, then take the summer off. You can't even decide where to allocate the time you <em>didn't</em> sell. Your employer usually decides when you take your lunch breaks, and when you can use your holidays. If you're on call, even your free time isn't quite yours.</p>
<p>In other words, you don't really trade more time at the office for less time cleaning your house. You're stuck at the office for 40 hours a week regardless, so you're just using some of your fixed budget. However, if you <em>don't</em> hire a cleaning person, and you don't spend your money, then you can buy some&nbsp;of your time back later, either as a gap year, or as an early retirement.</p>
<p>As a freelancer, you have much more control over what time you sell, and in which amount. Nonetheless, you are still bound to standard contract lengths, to the limits of your body, and to cyclical demand in your industry. A freelance accountant likely won't take time off during tax season. A freelance developer will mostly find 3 to 6 month contracts.<br></p>
<p>Put shortly, time is not a liquid asset. You can't easily  sell more or less of it according to your needs.</p>
<h2>Time does not have a fixed value</h2>
<p>Let's pretend that your boss lets you work for as long as you need, whenever you need to. You could spend an extra hour at the office, and pay someone to save you an hour of cleaning.</p>
<p>I'd make that deal. Swearing at my computer brings me joy, but doing the dishes doesn't. I'd gladly trade a few hours of programming for a few hours of cleaning.</p>
<figure><img src="https://nicolasbouliane.com/images/_fullWidth2x/good-time.jpg" alt=""><figcaption>My definition of a good time</figcaption></figure>
<p>After 30 hours a week, I'd start to value my time at the office a bit more. I'd rather spend that time at home, sipping a beer on my balcony with a pie in the oven, so I&nbsp;wouldn't be so keen to sell it.</p>
<p>After 50 hours, I'd be selling my time at a much higher price. There's a point where work takes a toll on your body, and seeps into other aspects of your life.&nbsp;By then, menial work feels like a release, rather than a chore.</p>
<p>Unless you&nbsp;<em>really</em> like your job, there comes a point where you'd rather do something else, even if has a lower market value than your profession.<br></p>
<h2>The hidden benefits of doing it yourself</h2>
<p>The most understated benefit of doing things yourself is the skills and the tools you acquire along the way. Your cooking gets better and more diversified with every meal you cook. Bike repairs get cheaper and easier with every attempt. Those skills stay with you, and over time, the benefits compound. You can tackle bigger and bigger projects, and the results look better and better.</p>
<figure><img src="https://nicolasbouliane.com/images/_fullWidth2x/level-up.jpg" alt=""></figure>
<p>Outsourcing, on the other hand, doesn't get better and cheaper. It either gets better and more expensive, or cheaper and worse. This ties your quality of life to a single variable: your income. Your lifestyle is much more reliant on your ability to stay employed, because it's the only thing you can do.<br></p>
<p>Beyond that, doing things yourself is immensely rewarding. Wrenching on your own motorcycle feels good. Delighting your guests with a home-cooked meal feels good. Using shelves you built yourself feels good. These are direct products of your hard work, and symbols of the control you have over your environment.</p>
<p>I'd also argue that it gives you a greater appreciation for the world you live in. It allows you to see things beyond the surface. Musicians appreciate music on a different level,
 and the same can be said for gardeners, machinists, architects and 
every other kind of enthusiast. My fledgling interest in gardening quite literally made me see the forest for the trees.<br></p>
<p>Paying someone else to do it robs you of this joy. Climbing through the career ladder provides its own rewards, but those always felt too abstract to me. If I  indirectly make my company a little leaner, I&nbsp;get 4% more disposable income. Big whoop.</p>
<h2>Caveats</h2>
<p>Some tasks don't develop useful skills. They don't get easier, cheaper or more enjoyable with time. Chores are chores, and some work is just plain tedious. No matter how good I&nbsp;get at painting walls, I still hate it with a passion.&nbsp;My father fixed cars his entire life, and he won't change his oil in the winter, when the car is caked in&nbsp;slush.</p>
<p>Life is short, and the 40 hour work week isn't going anywhere, so it's okay to spare your free time for things you enjoy. That's worth paying a premium for.</p>
<p>Even if you enjoy doing something, the timing isn't always right.&nbsp;I found that my motorcycle's front rim was bent just before leaving for a 3 month trip. I already had a lot on my plate with work and trip preparations, so I paid a mechanic to do it. Outsourcing lets you solve multiple problems in parallel.</p>
<p>In some cases, the upfront cost of doing things yourself is just too high. I won't resurface my motorcycle's cylinder head at home, because the tools cost more than my net worth, and highly trained machinists will do it for 100€.&nbsp;Sometimes, it's better to let economies of scale do their thing.</p>
<p>In other cases, the running costs are too high. All those things you maintain will chip away at your free time. In aggregate, they can swallow your evenings. For example, think twice about running your own server to save a few euros per month. These needy buggers tend to require your attention at the most inopportune times. Outsourcing means someone else is taking care of it, and invoicing you once a month.</p>
<p>Sometimes, the risk isn't worth the potential savings. It's important to learn how to do things yourself, but don't bite off more than you can chew. Don't cause hundreds of euros worth of damage to save a few euros. Hire a professional, and let them do their job.&nbsp;If they cock up, <em>they</em> are liable to fix the mess, not you.</p>
<h2>Conclusion</h2>
<p>Yes, outsourcing has its time and place, but it's more expensive than it appears. Sometimes, it's better to do things yourself, and acquire useful skills …</p></article></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://nicolasbouliane.com/blog/trading-time-for-money">https://nicolasbouliane.com/blog/trading-time-for-money</a></em></p>]]>
            </description>
            <link>https://nicolasbouliane.com/blog/trading-time-for-money</link>
            <guid isPermaLink="false">hacker-news-small-sites-25535366</guid>
            <pubDate>Fri, 25 Dec 2020 09:30:04 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Improving Communication in Development Teams]]>
            </title>
            <description>
<![CDATA[
Score 11 | Comments 1 (<a href="https://news.ycombinator.com/item?id=25534925">thread link</a>) | @stebunovd
<br/>
December 24, 2020 | https://teamplify.com/blog/improving-communication/ | <a href="https://web.archive.org/web/*/https://teamplify.com/blog/improving-communication/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
    <div>
      
  

  <p>
    <span>December 7, 2020</span>
    <span>●</span>
    
  </p>

  <p>
    In software development, communicating productively is as important as
    writing quality code quickly. Maybe even more important - studies show that
    most problems in software projects are in fact communication problems.
  </p>

  
  <h2 id="why-focus-on-communication">
    <a href="#why-focus-on-communication">Why focus on communication?</a>
  </h2>


  <p>
    On the Internet, you can find many articles and studies about
    <a href="https://www.google.com/search?q=why+software+projects+fail" rel="noopener noreferrer" target="_blank">
      why software projects fail
    </a>. They cite different reasons, for example:
  </p>

  <ul>
    <li>Lack of understanding of business needs;</li>
    <li>Vague or poorly communicated requirements;</li>
    <li>Unrealistic timelines or expectations;</li>
    <li>False belief that scope can be defined upfront;</li>
    <li>Inadequate planning;</li>
    <li>Too many or too few people assigned to a project;</li>
    <li>Poor reporting of project status;</li>
    <li>Unmanaged risks;</li>
    <li>... and so on.</li>
  </ul>

  <p>
    If you look closer, you'll notice that these reasons point to one thing in
    common: a disconnect between management and developers. So removing this
    disconnect should yield great returns.
  </p>

  
  <h2 id="does-it-mean-we-should-talk-more">
    <a href="#does-it-mean-we-should-talk-more">Does it mean we should talk more?</a>
  </h2>


  <p>
    What would improve communication between developers and management? This is
    a broad topic, but one idea's obvious: they must communicate frequently
    enough to be on the same page about goals, requirements, priorities, work
    progress, project challenges, and risks.
  </p>

  <p>
    This creates another problem though: to be productive, developers need
    prolonged periods of quiet time. They need to do focused work, without
    distractions. Meetings distract developers from writing code. And waiting
    for the meeting can be even worse. If people know they'll be interrupted
    soon, they'll feel discouraged from starting anything big. Paul Graham
    wrote a great article about this -
    <a href="http://www.paulgraham.com/makersschedule.html" rel="noopener noreferrer" target="_blank">
      Maker's Schedule, Manager's Schedule
    </a>.
  </p>

  <p>
    Ok, so on one hand we need to talk to developers, but on the other we
    shouldn't distract them so much that they can't be productive. Finding this
    delicate balance may be hard, but we can make the job easier by removing
    trivial questions from the discussion. Below I'll give some examples of how
    well organized processes and technology can help us talk less, but do more.
  </p>

  
  <h2 id="stop-asking-whos-working-on-what">
    <a href="#stop-asking-whos-working-on-what">Stop asking who's working on what</a>
  </h2>


  <p>
    One such trivial question is “Who's working on what?” Isn't that what the
    task tracker's for? All task trackers incorporate concepts like Assignee
    and Status. When tasks are accurately assigned with up-to-date statuses,
    you'll have immediate visibility about who's working on what and how long
    they've been working on it. Besides that, you may occasionally need to
    return to old completed tasks. Having an accurate task history helps you
    return easily.
  </p>

  <p>
    Though task tracking sounds simple, in practice it requires a manager's
    effort to keep your task tracker in good shape. People may forget to switch
    task statuses, or assign tasks to themselves. Someone might not have a task
    in progress at all. Someone else might have multiple tasks in progress,
    which once again, doesn't tell us what exactly they're working on.
  </p>

  <p>
    That's why we created these "In progress"
    <a href="https://teamplify.com/notification-types/">notifications</a>
    in Teamplify:
  </p>

  <p>
    <picture>
      <source srcset="https://cdn.teamplify.com/blog/img/no-issues-in-progress.webp?3488 1x, https://cdn.teamplify.com/blog/img/no-issues-in-progress@2x.webp?3488 2x" type="image/webp">
      <img alt="No issues in progress" src="https://cdn.teamplify.com/blog/img/no-issues-in-progress.png?3488" srcset="https://cdn.teamplify.com/blog/img/no-issues-in-progress@2x.png?3488 2x" width="494" height="106">
    </picture>
  </p>

  <p>
    Teamplify connects to your task tracker, like Jira or Trello. If it's not
    clear what developers are working on, it will politely ask, in Slack or
    over email, to update their task status. These notifications are smart and
    unobtrusive. They also take all kinds of non-working days into
    consideration, so they won't disturb your teammates on their vacation.
    More on that later.
  </p>

  
  
  <h2 id="make-work-progress-visible">
    <a href="#make-work-progress-visible">Make work progress visible</a>
  </h2>


  <p>
    Today, almost every development team uses at least some version of these
    collaboration tools:
  </p>

  <ul>
    <li>code hosting - for example, GitHub or GitLab;</li>
    <li>task tracker - Jira, Trello, or similar;</li>
    <li>chat - many teams use Slack;</li>
    <li>video conferencing software, such as Zoom.</li>
  </ul>

  <p>
    These tools are usually shared with the whole team, so any team member can
    take a look and learn something about work progress. Unfortunately,
    looking over each tool is not a convenient way to learn what the team has
    been busy on. Because the information is fragmented, not everyone will be
    willing to dig through it. It's much easier to ask about the status in a
    meeting.
  </p>

  <p>
    That's why we created the Team Calendar view, which collects all the work
    activity from your team tools and puts it in one place. It also shows
    national holidays, vacations, sick days, and other
    <a href="https://teamplify.com/member-status/">member statuses</a>:
  </p>

  <p>
    <picture>
      <source srcset="https://cdn.teamplify.com/blog/img/team-calendar.webp?3488 1x, https://cdn.teamplify.com/blog/img/team-calendar@2x.webp?3488 2x" type="image/webp">
      <img alt="Team Calendar" src="https://cdn.teamplify.com/blog/img/team-calendar.png?3488" srcset="https://cdn.teamplify.com/blog/img/team-calendar@2x.png?3488 2x" width="704" height="458">
    </picture>
  </p>

  <p>
    The calendar displays the most important types of team work activity,
    including code commits, task updates, and communication over video and chat.
    It also automatically detects when someone mentions a task in chat messages
    and code commits. For example, if a task was discussed somewhere in Slack,
    you'll see it, and be able to click directly to that discussion.
  </p>

  <p>
    Better visibility into work progress means better informed managers, with
    less need for meetings and less developer distractions.
  </p>

  
  <h2 id="make-time-off-visible">
    <a href="#make-time-off-visible">Make time-off visible</a>
  </h2>


  <p>
    Time off plays an important role in short-term project planning. Even in
    small organizations, people don't always remember who's going on vacation
    next week. And if your team is distributed, it's quite easy to forget about
    other country's national holidays.
  </p>

  <p>
    When someone's absence is a surprise, it's not good for your project.
    Making time-off clearly visible helps people better plan around it.
  </p>

  <p>
    That's why we added time-off management to Teamplify. National holidays,
    vacations, sick days, and other
    <a href="https://teamplify.com/member-status/">member statuses</a> are visible on the
    <a href="#make-work-progress-visible">Team Calendar</a> mentioned above.
    You can also configure notifications for Slack or email:
  </p>

  <p>
    <picture>
      <source srcset="https://cdn.teamplify.com/blog/img/slack-sick-day.webp?3488 1x, https://cdn.teamplify.com/blog/img/slack-sick-day@2x.webp?3488 2x" type="image/webp">
      <img alt="Sick day notification in Slack" src="https://cdn.teamplify.com/blog/img/slack-sick-day.png?3488" srcset="https://cdn.teamplify.com/blog/img/slack-sick-day@2x.png?3488 2x" width="552" height="344">
    </picture>
  </p>

  <p>
    Even if people miss the notification and mention someone who is absent
    today, Teamplify will politely remind them:
  </p>

  <p>
    <picture>
      <source srcset="https://cdn.teamplify.com/blog/img/slack-friendly-reminder.webp?3488 1x, https://cdn.teamplify.com/blog/img/slack-friendly-reminder@2x.webp?3488 2x" type="image/webp">
      <img alt="Time off friendly reminder" src="https://cdn.teamplify.com/blog/img/slack-friendly-reminder.png?3488" srcset="https://cdn.teamplify.com/blog/img/slack-friendly-reminder@2x.png?3488 2x" width="537" height="212">
    </picture>
  </p>

  <p>
    You can also request a vacation or add another status via the Teamplify
    Slack bot, so you can manage off time without leaving Slack.
  </p>

  
  <h2 id="identify-stuck-progress">
    <a href="#identify-stuck-progress">Identify stuck progress</a>
  </h2>


  <p>
    Even the best and brightest developers get stuck sometimes. There may be an
    unexpected technical problem, or maybe the task turns out to be more
    difficult than previously thought. In such cases, brainstorming with
    colleagues may help find a solution or an alternative path and boost the
    progress significantly.
  </p>

  <p>
    If we haven't seen any code activity from a developer in a while, it
    doesn't necessarily mean that they're stuck, but it might signal a good
    time to check if everything's alright.
  </p>

  <p>
    <picture>
      <source srcset="https://cdn.teamplify.com/blog/img/slack-no-recent-commits.webp?3488 1x, https://cdn.teamplify.com/blog/img/slack-no-recent-commits@2x.webp?3488 2x" type="image/webp">
      <img alt="No recent commits notification in Slack" src="https://cdn.teamplify.com/blog/img/slack-no-recent-commits.png?3488" srcset="https://cdn.teamplify.com/blog/img/slack-no-recent-commits@2x.png?3488 2x" width="534" height="74">
    </picture>
  </p>

  <p>
    Stuck communication is just another form of stuck progress. This could be a
    lengthy discussion without any productive decision. More often, it's just a
    question that's been waiting too long for an answer:
  </p>

  <p>
    <picture>
      <source srcset="https://cdn.teamplify.com/blog/img/slack-pending-questions.webp?3488 1x, https://cdn.teamplify.com/blog/img/slack-pending-questions@2x.webp?3488 2x" type="image/webp">
      <img alt="Pending questions notification in Slack" src="https://cdn.teamplify.com/blog/img/slack-pending-questions.png?3488" srcset="https://cdn.teamplify.com/blog/img/slack-pending-questions@2x.png?3488 2x" width="666" height="154">
    </picture>
  </p>

  <p>
    If a bot can politely remind your correspondent about your pending
    question, it means you don't have to. Besides that, bot notifications are
    sometimes better perceived. If a person reminds you every day about pending
    questions, it might be annoying. But if a bot does the same - it's probably
    okay, because, you know, it's just a bot.
  </p>

  
  <h2 id="bottom-line">
    <a href="#bottom-line">Bottom line</a>
  </h2>


  <p>
    When communication improvements add up, the result is a more productive
    work environment, where people are better informed and spend less time on
    discussing trivial questions. We have a lot of complex problems to solve,
    let's focus on them instead.
  </p>

    </div>
  </div></div>]]>
            </description>
            <link>https://teamplify.com/blog/improving-communication/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25534925</guid>
            <pubDate>Fri, 25 Dec 2020 07:32:55 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[The impact of Apple Silicon Macs on Broadway]]>
            </title>
            <description>
<![CDATA[
Score 234 | Comments 271 (<a href="https://news.ycombinator.com/item?id=25534863">thread link</a>) | @da02
<br/>
December 24, 2020 | https://brianli.com/2020/12/the-impact-of-apple-silicon-macs-on-broadway/ | <a href="https://web.archive.org/web/*/https://brianli.com/2020/12/the-impact-of-apple-silicon-macs-on-broadway/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="container"><main><article role="article"><div><p>In a previous life, I was an electronic music designer working on Broadway shows in New York City. Broadway shows look glamorous and expensive on the outside, but it’s often quite the opposite on the inside –&nbsp;at least for the music department. One of the toughest parts of my job as an electronic music designer was to find the best performance-to-cost ratio for computer rigs powering keyboards, guitars, playback tracks, and more.</p><p>Over the past decade, Broadway has replaced large sections of traditional orchestras with synthesizers, playback systems, and electronic drum pads. I’m not in support of that, but that’s a story for another day. The point here is that Broadway’s reliance on computer-driven rigs has increased, while the typical budget required to build high-end stable rigs hasn’t increased at the same rate.</p><p>Some shows I’ve worked at set aside a $10,000-$12,000 budget for two keyboard rigs. That sounds like a lot of money at first, but it’s not. For live shows, it’s usually best to have a 1:1 backup in case the main rig fails. That fact alone means you have to design a rig that fits within 50% of the proposed budget. Furthermore, a high-quality keyboard controller alone is $1,500-2,000 –&nbsp;so that means there’s $3,000 left for a computer and everything else.</p><p>Due to budget constraints, many shows end up using Mac minis. Historically speaking, the Mac mini’s computing power has been a bottleneck for electronic music designers on Broadway. In a perfect world, we’d all like to use the best-sounding sample libraries for our work, but that was never feasible with the Mac mini. Thus, the compromise was always to reduce sound quality to fit within the Mac mini’s compute constraints.</p><p>Apple Silicon changes everything for Broadway electronic music designers. The new M1 Mac mini is capable of running high-end sample libraries and virtual instruments in a stable manner, and it’s only going to get better with M2, M3, and M4-series chips in the future. The performance per dollar characteristics of Apple Silicon machines are going to have a huge impact on Broadway’s sound, and I’m very excited to see, or hear, what happens.</p></div></article></main></div></div>]]>
            </description>
            <link>https://brianli.com/2020/12/the-impact-of-apple-silicon-macs-on-broadway/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25534863</guid>
            <pubDate>Fri, 25 Dec 2020 07:14:23 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Learning to Play the Chaos Game]]>
            </title>
            <description>
<![CDATA[
Score 20 | Comments 2 (<a href="https://news.ycombinator.com/item?id=25534794">thread link</a>) | @hardmath123
<br/>
December 24, 2020 | https://hardmath123.github.io/chaos-game-fractal-foliage.html | <a href="https://web.archive.org/web/*/https://hardmath123.github.io/chaos-game-fractal-foliage.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article id="postcontent">
            <section>
                
                <center><em><p>I, Thomasina Coverly, have found a truly wonderful method whereby all the forms of nature must give up their numerical secrets and draw themselves through number alone…</p>
</em></center>
                <h4>Friday, December 25, 2020 · 7 min read</h4>
<p>It’s Christmastime again! Shall we talk about trees? This post is about my new
holiday hobby: hallucinating tree-shaped fractals using our old friend,
gradient descent.</p>
<p><img src="https://hardmath123.github.io/static/chaos-game/tree-building.gif" alt="Christmas tree"></p>
<hr>
<p>But — let me start at the beginning. For a variety of reasons, the cover
image of Douglas Hofstadter’s <a href="https://en.wikipedia.org/wiki/I_Am_a_Strange_Loop"><em>I am a Strange
Loop</em></a> has been on my mind
this month. I have been thinking a lot about this wonderful image created by
pointing a camera at a projector that displays what the camera is seeing. In
modern terms: what happens if you screen-share the screen sharing window? This
happens:</p>
<p><img src="https://hardmath123.github.io/static/chaos-game/strange-loop.png" alt="from the cover of the book"></p>
<p>Such “feedback loop” recursions often rapidly converge to breathtaking
fixed-points. The NYC MoMath even has an <a href="https://momath.org/25-feedback-fractals-1/">art
installation</a> that lets you play
with a camera-and-projector setup to make <a href="https://twitter.com/momath1/status/824740594564075520">wonderful
patterns</a>.</p>
<p>As you can imagine, there is a mathematical theory here. At risk of ruining the
mystery, I will tell you about it, though without writing any equations. :-)
The theory is the theory of <a href="https://en.wikipedia.org/wiki/Iterated_function_system">Iterated Function
Systems</a>, which is
almost exactly what it sounds like. Start with a set of affine functions
(affine because that’s what camera-projector-systems do) and repeatedly apply
them to a set of points, taking the union at each step. Regardless of where you
start, you will soon end up with a fractal structure which is the fixed point
of the system. Why fractal? —because the self-similarity comes from the
infinitely-nested composition of the affine functions.</p>
<p><img src="https://hardmath123.github.io/static/chaos-game/Ifs-construction.png" alt="from Wikipedia"></p>
<p>There are theorems that ensure convergence towards and uniqueness of this fixed
point in the limit, but… it’s believable enough, don’t you think? Following
your intuition, you can build Sierpinski Triangles and <a href="https://en.wikipedia.org/wiki/Barnsley_fern">Barnsley
Ferns</a> and all sorts of other
beautiful structures using an IFS. I refer you to Section 8.2 of <a href="http://algorithmicbotany.org/papers/#abop"><em>The
Algorithmic Beauty of Plants</em> by Prusinkiewicz and Lindenmayer (yes, <em>that</em>
Lindenmayer)</a> for more botanical
connections.</p>
<p><img src="https://hardmath123.github.io/static/chaos-game/Fractal_fern_explained.png" alt="from Wikipedia"></p>
<hr>
<p>Now here is the question that has been on my mind: if I give you a picture of a
fractal-fern, can you give me a set of affine functions whose fixed point is
that fern? This is the <a href="https://en.wikipedia.org/wiki/Iterated_function_system#The_inverse_problem"><em>inverse
problem</em></a>
for IFSes. According to Wikipedia, this problem has real-world applications in
image compression, but it is <em>hard</em> to do in general.</p>
<p>Hmm. Interesting. Can our favorite tool, gradient descent, come to the rescue?
At least in an approximate sense? Recall that a two-dimensional affine function
is really just a 3x3 matrix (with 6 free parameters) that encodes the details
of the transformation. If we could easily compute images of IFS fixed points
from a set of matrices, then perhaps we could try to optimize the parameters of
these matrices to make the fixed point look the way we want it to.</p>
<p>The challenge, of course, is efficiently <em>finding</em> the fixed point —
repeatedly rasterizing and compositing affine transformations on images sounds
expensive — and doing so differentiably sounds like a scalability nightmare!
But there is a wonderful solution to this problem, which is to play the
so-called “<a href="https://en.wikipedia.org/wiki/Chaos_game">chaos game</a>.” Instead of
<em>densely</em> applying all the functions to all the points on the plane, you can
<em>sparsely</em> approximate the fixed point as follows: Start with a point — any
point! — and <em>randomly</em> select one of the affine functions of the IFS and
apply it to the point. Repeat this process with the new point. It turns out
that in the limit, the “trail” left behind by this wandering point converges to
the fixed point of the IFS. (This, too, is a theorem, but again I think it is
believable enough that I will not demand a proof.) This is what the “chaos
game” looks like for the Sierpinski triangle; notice how the salt-and-pepper
spattering of points soon converges boldly into the fractal we know and love
(it’s an animation — stare for a few seconds).</p>
<p><img src="https://hardmath123.github.io/static/chaos-game/Sierpinski_chaos_animated.gif" alt="from Wikipedia"></p>
<p>So here is the plan: we start with a point, and play the chaos game with our
current IFS matrices to obtain a <em>point cloud</em> that stochastically approximates
the fixed-point. Then, we compare this <em>point cloud</em> to our target fern-image
to obtain a “loss.” Finally, we update our IFS matrix parameters to minimize
this loss, until at last the fixed-point converges to the target image. It’s
just “machine learning,” really: we’re learning to play the chaos game!</p>
<p>Here is an outline of the algorithm (with some details elided):</p>
<pre><code># initialize IFS
F = [random_3x3_affine() for _ in range(4)]
o = torch.optim.Adam(F, lr=0.0001)

for step in range(100_000):
    o.zero_grad()
    # start at origin
    v = torch.tensor([0., 0., 1.])

    # play the chaos game once
    trace = []
    for _ in range(200):
          # applying an affine function is just
        # a matrix multiplication!
        v = torch.matmul(random.choice(F), v)
        trace.append(v)

    # treat the trace as a point cloud
    loss = compare(target_image, trace)

    # update parameters
    loss.backward()
    o.step()
</code></pre>
<p>Ah! Actually, there is <em>one</em> detail that I <em>should</em> explain: how do you compare
a point cloud and an image? My idea is to convert the target image to a
<em>second</em> point cloud by uniformly sampling points from it, for example by
rejection-sampling. Then you can compare the two point clouds by the so-called
“chamfer distance,” which is the mean distance from each point to its nearest
neighbor in the opposite point cloud. This is quadratic-time to compute, and
the most expensive part of the whole operation, but with ~100 points in each
set it is quite doable.</p>
<blockquote>
<p>A pedagogical aside: notice that the “trick” here is really a <em>change in
representation.</em> This optimization problem is easier to solve on point clouds
than on raster images! An important lesson, that applies across the
ML-for-graphics domain… and more broadly to all differentiable programming
enterprises.</p>
</blockquote>
<hr>
<p>Remarkably, this zany scheme works quite well! Let’s try it with a heart. (A
heart, because it’s an easy low-entropy shape, but also because it felt
symbolically appropriate in relation to Hofstadter’s broader philosophical
project of souls-within-souls-within-souls.)</p>
<p>When we initialize the system with 4 random affine transformations, the trail
left behind by the chaos game is very unimpressive. The sparsity is because I
simulate only 200 steps of the chaos game for each step of gradient descent —
there’s a tradeoff between noise and computation time, of course, as there is
with any form of SGD.</p>
<p><img src="https://hardmath123.github.io/static/chaos-game/heart-samples-early.png" alt="chaos game on a heart"></p>
<p>Okay. Time to optimize! Here is what it looks like after 100K steps of
optimization with an Adam optimizer (that’s about 40 minutes of wall-time
computation on my old MacBook). It looks pretty good, don’t you think? The
chamfer distance scheme works!</p>
<p><img src="https://hardmath123.github.io/static/chaos-game/heart-samples.png" alt="chaos game on a heart"></p>
<p>Now we can export the four affine matrices out from PyTorch and work out the
“true” fixed point with a more expensive offline computation (for example, by
simulating a few <em>million</em> steps of the chaos game). It looks like this — not
perfect, and indeed quite crayon-scribble-ey, but clearly <em>something</em>
interesting has happened, and the result is convincingly heartlike.</p>
<p><img src="https://hardmath123.github.io/static/chaos-game/heart-fractal.png" alt="extended chaos game on a heart"></p>
<p>Where is the fractal structure hidden in this heart? This needs some
vizualization tooling to see clearly. After a bit of JS-canvas-hacking: here is
a GIF of the heart that reveals its fixed-point structure.
Hearts-in-hearts-in-hearts!</p>
<p><img src="https://hardmath123.github.io/static/chaos-game/heart.gif" alt="Heart"></p>
<p>I will admit to blinking a few times when I first saw this animation play out
in full — I did <em>not</em> expect it to work, and even now I find myself marveling
at this creation? discovery? of a heart encoded in 24 numbers.</p>
<hr>
<p>But it still doesn’t look <em>quite right</em> — the fractalness isn’t <em>obvious</em>.
How come? It’s because our affine transformations stretch and squash the heart
into almost unrecognizable blobs. A final, natural improvement is to force our
affine transformations to be <em>rigid</em>, so that there isn’t any squishing or
skewing in the fractal. This is actually not too bad to implement: the solution
to problems of constraint are typically reparametrizations, and indeed in this
case we can simply reparametrize the matrices in terms of a rotation, an
(isotropic) scale, and a translation. Now we’re down from 6 parameters per
matrix to just 4 — even more magical! The result is a much more “obviously”
fractal-ey fixed point, simply because your eye can more easily pick out the
structural recursion when it is made of rigid motions.</p>
<p>Let’s take it for a — pardon — <em>spin!</em></p>
<p>Since I promised you trees, here is some fractal foliage. The target image was
a picture of a maple leaf! I’d never thought about this before, but indeed a
maple leaf contains within it an echo of the whole tree. (Full disclosure: it
takes a couple of randomized restarts to get a really impressive result — the
low dimensionality of the fractal’s parametrization leads to the same
stuck-in-a-local-optimum woes that differentiable rendering folks face all the
time…)</p>
<p><img src="https://hardmath123.github.io/static/chaos-game/foliage.gif" alt="Leaf"></p>
<p>This one uses just three matrices — experimentally, three matrices tend to be
enough to get really good results, and more just lead to very busy and crowded
fractals. (I don’t know if there is a word for number-of-maps–in-an-IFS, but
let’s call it the IFS’s <em>arity</em>. In this terminology, I like <em>ternary</em> IFSes.)</p>
<p>And finally, since I promised you Christmas trees…</p>
<p><img src="https://hardmath123.github.io/static/chaos-game/christmas-tree.gif" alt="Christmas tree"></p>
<p>This last animation is actually absolutely <em>baffling</em> to me. In part, this is
because of how <em>treelike</em> the fractal turned out — here it is overlayed
against the silhouette I optimized against. Can you imagine this is encoded by
just 12 parameters? Odd.</p>
<p><img src="https://hardmath123.github.io/static/chaos-game/christmas-tree-match.png" alt="Tree vs. silhouette"></p>
<p>But even more bafflingly: the actual geometry of the recursion is <em>nothing</em>
like the tree recursion geometry you and I are used to from CS106! Compare the
GIF above to Barnsley’s Fern: while Barnsley turns each full leaf into two
smaller leaves with “semantic” affine maps, this Christmas tree does all sorts
of <em>bizarre</em> uninterpretable cartwheels and somehow almost magically works
itself out in the end. It is mesmerizing to me, …</p></section></article></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://hardmath123.github.io/chaos-game-fractal-foliage.html">https://hardmath123.github.io/chaos-game-fractal-foliage.html</a></em></p>]]>
            </description>
            <link>https://hardmath123.github.io/chaos-game-fractal-foliage.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-25534794</guid>
            <pubDate>Fri, 25 Dec 2020 06:55:23 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[The aftermath of “No, 'Open Source' does not mean 'Includes Free Support'”]]>
            </title>
            <description>
<![CDATA[
Score 32 | Comments 16 (<a href="https://news.ycombinator.com/item?id=25534492">thread link</a>) | @EMIRELADERO
<br/>
December 24, 2020 | https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/ | <a href="https://web.archive.org/web/*/https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><p>
      Got some hilarious reactions. Gotta share.
    </p><div>

<p>Well, <a href="https://raccoon.onyxbits.de/blog/bugreport-free-support">my last post hit it big</a>. Poor blog had a couple social media death hugs on that day. Gosh, people were fuming about me (supposedly) stating that I would not accept their hand-laced, gold-edged, rose scented bug reports without prior payment. How dare I?! Well, I simply do. </p><figure>
  <a href="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/problem.png">
    <img src="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/problem.png">
  </a>
  
</figure>
                             
                             

<p>The statement was actually that I ignore support requests from non-customers, <strong>especially</strong> when they come <u>disguised</u> as bugreports in order to avoid my fee. I don’t deliberately delete bug reports from my inbox, I simply risk loosing genuine ones because they are drowned out.</p>

<p>But hey, social media. Fast paced universe. Gotta comment while it’s hot, no time to (properly) read the original article. Some people hold some hilarious opinions, though!</p>

<h2 id="what-people-wrote">What people wrote</h2>

<blockquote>
<p>Bugs must be fixed!</p>
</blockquote>

<p>No, they don’t. Have you read the license agreement? Search for the phrase “AS IS”. Every <a href="https://opensource.org/licenses">OSI approved license</a> contains it (usually in caps). It means, I am under no obligation to provide any further work and you are not entitled to it.</p>

<p>Of course, there’s a simple way to make me owe you a service (and I’m even offering it): put money in my bank account.</p>

<figure>
  <a href="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/spacer.svg">
    <img src="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/spacer.svg" alt="spacer">
  </a>
  
</figure>
                             
                             

<blockquote>
<p>The bug was your fault in the first place!</p>
</blockquote>

<p>So? Oh wait. Is this going to be one of those conspiracy theories where I deliberately put bugs into my code in order to make you pay for removing them? Nice idea, but…</p>

<ul>
<li>That plan does not scale. There are only so many bugs I could plant.</li>
<li>Fixing bugs is the most time consuming form of support. I’m making a loss on that (in particular when considering the time required to design a good bug that some<u>one</u> might pay for getting removed).</li>
<li>I gave you the source, that takes the leverage out of my hands.</li>
</ul>

<p>The choice to use my software was yours. The disclaimer that it might not work is in the license agreement. I did not put myself in the position of being your only option to solve the issue.</p>

<figure>
  <a href="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/spacer.svg">
    <img src="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/spacer.svg" alt="spacer">
  </a>
  
</figure>
                             
                             

<blockquote>
<p>My bug reports are a work of art, you prick! I spent MY TIME on helping YOU to improve YOUR software!</p>
</blockquote>

<p>Your bug doesn’t bother me. If it did, I’d have fixed it myself. When submitting a bug report, you are not working for me, you are working for yourself and the user community. The same way I was, when making the original software available free of charge (whether or not you want to do it is entirely your choice, I’m not asking you to). Does your bug report include a patch? If yes, then the problem’s solved for you, if not, then you are expecting me to come up with a fix. That’s a work order, here’s my bill.</p>

<figure>
  <a href="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/spacer.svg">
    <img src="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/spacer.svg" alt="spacer">
  </a>
  
</figure>
                             
                             

<blockquote>
<p>Ignoring bug reports is stupid!</p>
</blockquote>

<p>Why? If I look at the mail, I’ll be tempted to act on it, giving someone a free ride. That’s unfair to those who paid for it.</p>

<figure>
  <a href="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/spacer.svg">
    <img src="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/spacer.svg" alt="spacer">
  </a>
  
</figure>
                             
                             

<blockquote>
<p>But I’ll have to pay and get no guarantee that my bug will be fixed.</p>
</blockquote>

<p>No, but you are guaranteed, that I will be listening to you and give you a definitive answer in a timely manner. That’s something you don’t get from public bugtrackers. See the problem here? You base your risk assessment on your experience with developers you don’t pay and who therefore have no incentive to help you. When I take your money, you are a customer.</p>

<figure>
  <a href="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/spacer.svg">
    <img src="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/spacer.svg" alt="spacer">
  </a>
  
</figure>
                             
                             

<blockquote>
<p>Every other open source project accepts free bug reports</p>
</blockquote>

<p>I don’t care.</p>

<ul>
<li>If some other developer wants to self exploit and thinks his time is only worth cheers, that’s their choice.</li>
<li>If the project(s) you are talking about are mission critical (and are otherwise funded), then yes, running a community support forum is a sensible choice.</li>
</ul>

<p>Whatever the reason, I don’t tend to jump off bridges, just because someone else does it.</p>

<figure>
  <a href="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/spacer.svg">
    <img src="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/spacer.svg" alt="spacer">
  </a>
  
</figure>
                             
                             

<blockquote>
<p>You hypocrite! You advertise your software as a solution to MY problem on your website</p>
</blockquote>

<p>Part of letting you use my solution is letting you know what problem I solve (by the way, that’s a service, saving you from reading the code in order to figure out what it does - you’re welcome). The conclusion that we both have the same problem was yours to draw. And yes, my software has long since grown beyond my own needs. But guess what, that still doesn’t compel me to work for you for free.</p>

<figure>
  <a href="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/spacer.svg">
    <img src="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/spacer.svg" alt="spacer">
  </a>
  
</figure>
                             
                             

<blockquote>
<p>You can avoid hosting costs by publishing on platform X</p>
</blockquote>

<p>Hey, remember SourceForge? Used to be <strong>the</strong> hosting platform for open source projects. Got sold. New owners added shady <a href="https://en.wikipedia.org/wiki/SourceForge#Controversies">monetization practices</a>. Developers had a choice: leave and lose your backlinks or stay and have your reputation tarnished.</p>

<p>Hey, remember Github? Used to be <strong>the</strong> hosting platform for open source projects. Got sold. New owner is Microsoft! The queen of vendor lock-in and shady monetization practices. Developers had a choice: leave and lose your backlinks or stay and see what Microsoft will pull out of their hat in the coming years.</p>

<p>Hey, do you know Gitlab? It is <strong>the</strong> hosting platform for open source projects! <small>Until it will get sold!</small>
</p>

<p>Do you <a href="https://raccoon.onyxbits.de/blog/why-not-use-github/">see the pattern here</a>?</p>

<figure>
  <a href="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/spacer.svg">
    <img src="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/spacer.svg" alt="spacer">
  </a>
  
</figure>
                             
                             

<blockquote>
<p>You made yourself the sole address for support. At least provide a community support forum!</p>
</blockquote>

<p>Outsource self-exploitation while eating up the infrastructure cost? Sounds like a plan. <strong>NOT!</strong> Get your ass out of your echo chamber. The idea of community support is one of the big criticisms <strong>against</strong> open source. When people have a problem, they want someone to talk to and they want their problem fixed in a timely manner. They don’t want to sign up for forum accounts and they don’t want to monitor them for weeks in the hopes that some community member might eventually come up with an answer.</p>

<p>When it comes to my software, I’m the most competent person to talk to. So whether I like to or not, people will (try to) contact me. As a developer, that puts a choice on your table:</p>

<ul>
<li>Stop your spare time being eaten up with tech support by pulling the software.</li>
<li>Start accepting payment and realize that you are now running a business that creates additional overhead cost.</li>
</ul>

<p>Yes, I made myself the sole address for support. That is the only logical conclusion. If I’m running a business, why should I let it be cannibalized by running a public support forum / bug tracker? That’s just adding infrastructure cost to choke profit.</p>

<figure>
  <a href="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/spacer.svg">
    <img src="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/spacer.svg" alt="spacer">
  </a>
  
</figure>
                             
                             

<blockquote>
<p>Offering free support helps your project to grow!</p>
</blockquote>

<p>Math wiz ey? Ever tried applying a scaling factor to a project where the expenses exceed the revenue?</p>

<figure>
  <a href="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/spacer.svg">
    <img src="https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/spacer.svg" alt="spacer">
  </a>
  
</figure>
                             
                             

<blockquote>
<p>You should have a donation button instead!</p>
</blockquote>

<p>Great idea! How often do you click those?</p>

<p>Seriously, I’m not a registered charity and only those may accept donations. For everyone else it’s just mislabelled, but still taxable income. The moment you put up a “donation” button, you are running a business, which automatically generates overhead costs. Getting five bucks once every blue moon with the implication of having to kiss the generous donor’s feet is simply not sustainable.</p>

<p>I’m not running a charity and I don’t want your “support”. I want, same as you, being paid for the work I do. I find it utterly dishonest to put my work under an open source license, then spend a ridiculous amount of extra work on guilt tripping my users in order to collect alms.</p>

<p>If the license says, “the software is free to use”, then that’s the deal. You get exactly that. Nothing more, nothing less. Everything else is extra and billable.</p>
</div></div>]]>
            </description>
            <link>https://raccoon.onyxbits.de/blog/reactions-bugreport-free-support/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25534492</guid>
            <pubDate>Fri, 25 Dec 2020 05:41:27 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[The Curl Year 2020]]>
            </title>
            <description>
<![CDATA[
Score 6 | Comments 0 (<a href="https://news.ycombinator.com/item?id=25534338">thread link</a>) | @pabs3
<br/>
December 24, 2020 | https://daniel.haxx.se/blog/2020/12/24/the-curl-year-2020/ | <a href="https://web.archive.org/web/*/https://daniel.haxx.se/blog/2020/12/24/the-curl-year-2020/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="page">
		
	
	<!-- #masthead -->

	<div id="main">

	<div id="primary">
		<div id="content" role="main">
			
<article id="post-15375">
	
		<p><img width="672" height="372" src="https://daniel.haxx.se/blog/wp-content/uploads/2017/12/fireworks-180553_1920-672x372.jpg" alt="" loading="lazy" srcset="https://daniel.haxx.se/blog/wp-content/uploads/2017/12/fireworks-180553_1920-672x372.jpg 672w, https://daniel.haxx.se/blog/wp-content/uploads/2017/12/fireworks-180553_1920-1038x576.jpg 1038w" sizes="(max-width: 672px) 100vw, 672px">		</p>

		
	<!-- .entry-header -->

		<div>
		
<p>As we’re approaching the end of the year, I just want to sum up the curl year with a few words.</p>



<p>2020 has been another glorious year in the curl project. We’ve seen a series of accomplishments and introductions of new things during this the year of the plague.</p>



<h2>Accomplishments</h2>



<p>I personally have done more commits in the git repository since any year after 2004 (890 so far).</p>



<p>The total number of commits done in git is the largest since 2014 (1445 plus some).</p>



<p>The number of published curl related CVEs is the lowest since 2013 (6). For the ones we announced, we could reward record amounts in our bug bounty program!</p>



<p>139 authors wrote commits that were merged (so far).</p>



<p>We did nine curl releases, out of which two unfortunately were quicker “panic releases” that patched up problems in the previous release.</p>



<h2>Seven changes to remember</h2>



<p>We’ve logged no less than <strong>905 bug-fixes</strong> and <strong>30 changes</strong> in the releases of this year, but the seven perhaps most memorable things we’ve introduced in 2020 are…</p>



<ul><li><a href="https://daniel.haxx.se/blog/2019/07/22/curl-goez-parallel/" data-type="post" data-id="12568">Parallel transfers</a> with curl</li><li><a href="https://daniel.haxx.se/blog/2020/04/14/curl-mqtt-true/" data-type="post" data-id="13836">MQTT</a>://</li><li><a href="https://daniel.haxx.se/blog/2020/11/03/hsts-your-curl/" data-type="post" data-id="11415">HSTS</a></li><li><a href="https://daniel.haxx.se/blog/2020/09/04/curl-help-remodeled/" data-type="post" data-id="14601"><code>--help</code> refined</a></li><li><a href="https://daniel.haxx.se/blog/2020/08/19/curl-7-72-0-more-compression/" data-type="post" data-id="14463">Zstd</a></li><li><a href="https://daniel.haxx.se/blog/2020/03/17/curl-write-out-json/" data-type="post" data-id="13740">JSON output</a> in -w</li><li><a href="https://daniel.haxx.se/blog/2020/01/12/curl-even-more-wolfed/" data-type="post" data-id="13130">wolfSSH backend</a></li></ul>



<h2>Videos</h2>



<p>This year I’ve introduced the concept of doing a “release presentation” for every release. Those are videos where I go through and discuss the changes, the security releases and some interesting bug-fixes. Each release links to those from <a href="https://curl.se/changes.html">the changelog page</a> on the website.</p>



<h2>New home</h2>



<p>This is the year when we finally got ourselves a curl domain. <a href="https://daniel.haxx.se/blog/2020/11/04/the-journey-to-a-curl-domain/" data-type="post" data-id="14930">curl.se is our new home</a>.</p>



<h2>What didn’t happen</h2>



<p>We cancelled curl up 2020 due to Covid-19. It was planned to happen in Berlin. We did it purely online instead. We’re not planning any new physical curl up for 2021 either. Let’s just wait and see what happens with the pandemic next year and hope that we might be able to go back and have a physical meetup in 2022…</p>



<h2>It is a curl world</h2>



<figure><a href="https://daniel.haxx.se/blog/wp-content/uploads/2020/12/slide-a-curl-world-2020.jpg"><img loading="lazy" width="2000" height="1125" src="https://daniel.haxx.se/blog/wp-content/uploads/2020/12/slide-a-curl-world-2020.jpg" alt=""></a></figure>




	</div><!-- .entry-content -->
	
	</article><!-- #post-15375 -->
		<nav role="navigation">
		
		<!-- .nav-links -->
		</nav><!-- .navigation -->
		
<!-- #comments -->
		</div><!-- #content -->
	</div><!-- #primary -->

<!-- #content-sidebar -->
<div id="secondary">
		<h2>tech, open source and networking</h2>
	
	
		<!-- #primary-sidebar -->
	</div><!-- #secondary -->

		</div><!-- #main -->

		<!-- #colophon -->
	</div></div>]]>
            </description>
            <link>https://daniel.haxx.se/blog/2020/12/24/the-curl-year-2020/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25534338</guid>
            <pubDate>Fri, 25 Dec 2020 05:05:22 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Programming Languages as Objects in Nature]]>
            </title>
            <description>
<![CDATA[
Score 24 | Comments 5 (<a href="https://news.ycombinator.com/item?id=25533846">thread link</a>) | @alokrai
<br/>
December 24, 2020 | https://parentheticallyspeaking.org/articles/pls-nature/ | <a href="https://web.archive.org/web/*/https://parentheticallyspeaking.org/articles/pls-nature/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><div><p>In the early 1990s, the programming languages research community was in an
optimistic mood. In the recent past, two of its paradigmatic languages—<wbr>Scheme
and ML—<wbr>had formalized their semantics. For ML, it took the form of a whole
book by Milner, et al. Scheme provided a denotational semantics in its
standard. Surely, it seemed, it was only a matter of time before all languages
went in this direction.</p><p>What went wrong?</p><blockquote><p>If you’re a working programmer without a theoretical background, you might
wonder why a formal semantics matters at all. It’s actually for reasons you can
understand easily. When you write programs against code that someone else
wrote, you like having an interface, or <span>API</span>, to program against. It mediates
your conversation with the remote code, and anchors conversations about whom to
blame if something doesn’t work as expected.</p><p>The formal semantics of a language does exactly the same thing. The language
itself is the “remote code” you’re programming against. What it does should
be pinned down as precisely as possible—<wbr>but also as understandably as
possible!—<wbr>for you to work with.</p><p>The semantics isn’t just an interface for the user of a language. It’s also a
crucial interface for tool authors, who must (also) otherwise guess at the
behavior of the language. If you want an example of how even the relatively
simple act of a variable rename refactoring can go wrong, see Appendix 2 of
our <a href="https://cs.brown.edu/~sk/Publications/Papers/Published/pmmwplck-python-full-monty/">Python semantics</a>. A semantics
doesn’t guarantee those kinds of errors won’t occur, but its absence makes them
far more likely to.</p></blockquote><p>For many researchers, it’s a given that programming languages are
<span>mathematical</span> objects. This is a natural and attractive view. Languages
are formal objects, after all; they are therefore amenable to codification by
everything from logic to topology and more. (Formal) Specification is a natural
consequence of this worldview.</p><p>The world, however, is full of programming languages that do not fit this
model.<span><span><span>Some may even have been created by programming language
semanticists, which is worth pondering.</span></span></span> Created by the ostensibly unwashed,
they rudely announce their arrival with nothing more than an
implementation. People pick them up, find them useful, do worthwhile things
with them, and a million lines later, the next big “scripting language” is
born. Let’s call these <span>informal</span> languages.</p><p>Informal languages are, of course, also amenable to formal specification. However,
a crucial difference governs these two types of languages. Suppose we observe a
difference between what the specification says and what the implementation
does. In the case of Standard ML, for instance, one can approach the
implementor, walk through the reasoning in the specification, and explain why
the implementation is wrong. If the implementor agrees with your reasoning, no
matter how unhappy this makes them, they must admit to and eventually fix their
implementation.</p><p>The implementor of an informal language faces no such constraint. Faced with a
mismatch between an ostensible specification and their implementation, they are
free to simply laugh, question the specification’s parentage, and exit stage
right. The specification can <span>at best</span> track what “the language is
doing”, not really dictate its behavior.</p><p>Specification still serves a role. It can:
</p><div><ul><li><p>Shed light on what is happening inside a large and otherwise opaque
implementation.</p></li><li><p>Point out complex designs that would warrant being simplified.</p></li><li><p>Highlight design aspects that are prone to cause programmer error,
security violations, and so on.</p></li><li><p>Serve all the other uses of a specification, such as serving as a basis
for building tools.</p></li></ul></div><p>To do all these things <span>usefully</span>, however, the specification must take
significant steps to show its conformance to the reality of the informal
language, such as by running the same test suites as the implementations.</p><p>An informal language, then, is much more like an object found in nature:</p><p><img src="https://parentheticallyspeaking.org/articles/pls-nature/rock.jpg" alt="A rock."></p><p>We can push at it, poke it, and prod it, and hope that it will yield its
secrets. But we can never be certain—<wbr>without the help of the
implementors—<wbr>that we have properly characterized all of it.</p><p>That doesn’t mean we can’t approach the problem systematically. Geologists,
confronted with a rock, don’t flail helplessly. In high-school chemistry, I was
taught to approach unknown substances with the <span>SCODS</span> test: check for its
state, color, odor, density, and solubility.<span><span><span>They never included a letter
for “taste”, a reflection perhaps more of their aspiration than of the
reality in a high school chemistry lab.</span></span></span> That is, we identify some of
dimensions of classification, and proceed along the principal axes.</p><p>We have these axes for programming languages, too. We can talk about their
scope rules, their evaluation semantics, their type system, and so on. Indeed,
because so much of a programmer’s career will be spent confronting informal
languages and having to rapidly make sense out of them, I’ve long felt that how
we <span>teach</span> programming languages should
<a href="https://cs.brown.edu/~sk/Publications/Papers/Published/sk-teach-pl-post-linnaean/">also be divided along these
dimensions</a>.</p><p>The problem of informal languages will not go away, so long as a dedicated
amateur can scare up a new language’s implementation. Indeed, the size of our
informal language space grows ever-bigger, and vastly so, than that of
mathematical languages. In 2015, I made this slide:</p><p><img src="https://parentheticallyspeaking.org/articles/pls-nature/stack.png" alt="Our programming stack." width="560" height="420"></p><p>It shows the stack atop which a typical client-side Web program of the day
resided. What it actually shows is something much more subtle and important:</p><p><span>Programmers do not program in “languages”.</span></p><p>Rather, they program in some complex combination of languages, libraries,
frameworks (which can impose their own operational behavior—<wbr>e.g., seemingly
turn a call-by-value language into a reactive one), and more. What a programmer
needs is a semantics not just for the language sitting near the bottom, but
rather for the mountain on top of which their program resides.</p><p>For illustrative examples of what such semantics might look like, see our work
on the <a href="https://cs.brown.edu/~sk/Publications/Papers/Published/lckqk-model-reason-dom-events/">operational semantics of
the <span>DOM</span></a> (it’s a giant control operator, y’all!), and
<a href="https://cs.brown.edu/~sk/Publications/Papers/Published/lelk-types-jquery-programs/">the type structure of jQuery</a>. But
these are just a tiny sliver of a tiny sliver. How do we make real progress up
the mountain and keep our position there as it keeps thrusting further out of
the ground?</p><p>We can’t expect the date-picker library’s author to also be a semanticist. But
we shouldn’t therefore resignedly conclude that we can never get there. Rather,
we should acknowledge that there are useful divisions of labor. Instead of
scolding informal language designers for their practices, semanticists need to
find methods to bridge that gap, keeping in mind:</p><blockquote><p><span>One can’t proceed from the informal to the formal by formal means.Alan Perlis</span></p></blockquote><p>Whatever we propose needs to be:
</p><div><ul><li><p>Reasonable (in terms of skill) for the implementor to produce.</p></li><li><p>Useful for them to produce.</p></li><li><p>Useful for us to consume and work with.</p></li></ul></div><p>One especially good intermediate proxy is a test suite of some sort. Tests
don’t always get the respect they deserve, but they too are a form of
specification. I like to call them “specifications from below”, precisely
defining what should happen in individual cases, whereas the typical formal
specification is “specification from above”, defining what happens across a
family of cases. Ultimately, of course, we need specifications “from above”,
but it’s worth noting that specifications “from below” are both useful to
developers and something they are skilled at producing. The recent trend in
languages of producing “confirmance suites” or “litmus tests” is especially
promising in this regard. (Our work on formalizing the
<a href="https://cs.brown.edu/~sk/Publications/Papers/Published/pclpk-s5-semantics/">strict mode of of ECMAScript 5.1</a>,
for instance, made use of the ECMAScript conformance suite.)</p><p>How we use them remains a little bit of an open question. The most obvious use
is to test our semantics: what <a href="https://ccs.neu.edu/~arjunguha/main/home/">Arjun Guha</a> and I, to perhaps the horror
of some, called a <span>tested semantics</span>. But we might also be able to
generalize these tests, from “below” to “above”, i.e., it’s a synthesis
problem. This requires some structure to produce a semantics that is also
meaningful. Our paper on <a href="https://cs.brown.edu/~sk/Publications/Papers/Published/kle-next-700-semantics//">The Next 700
Semantics</a> describes some of the contours for this line of work to consider.</p></div></div></div>]]>
            </description>
            <link>https://parentheticallyspeaking.org/articles/pls-nature/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25533846</guid>
            <pubDate>Fri, 25 Dec 2020 03:06:02 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Creating a MIDI pass-through recorder]]>
            </title>
            <description>
<![CDATA[
Score 12 | Comments 5 (<a href="https://news.ycombinator.com/item?id=25532601">thread link</a>) | @TheRealPomax
<br/>
December 24, 2020 | https://pomax.github.io/arduino-midi-recorder/ | <a href="https://web.archive.org/web/*/https://pomax.github.io/arduino-midi-recorder/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
      
      
      

      

<p>If you’ve ever used audio software on the computer, you probably know that MIDI exists: a signalling protocol that allows controllers to control virtual instruments like synths. It’s also the protocol used by real audio hardware to talk to each, and you can think of it as the language in which, rathar than communicating a fluctuating voltage signal or series of discrete sample values, devices talk about what is being done on them (“A4 got pressed”, “F4 got released”,  “the mod wheel moved down”, etc).</p>

<p>As such, there are two ways to record digital instruments (real or virtual): you can record the sound they’re making, or you can record the MIDI events that cause them to make those sounds, and that’s where things get interesting.</p>

<p>There are many, <em>many</em> ways to record audio, from microphones to line monitors to audio interfaces, on dedicated hardware, computers, phones, etc. etc., but there aren’t all that many ways to record MIDI events. Essentially: unless you’re running software that monitors MIDI events, there just isn’t really any way to record MIDI. So I set out to change that: in the same way that you can just hook up an audio field recorder (like a Tascam DR-05) to sit between an audio-out on something that generates audio and an audio-in on something that should be listening to that audio, writing that to an SD card as <code>.wav</code> or <code>.mp3</code> or the like,  I built a MIDI “field recorder” that you plug in between your MIDI-out and some MIDI-in, indiscriminately recording every MIDI event that gets sent over the wire to an SD card as a <code>.mid</code> file.</p>

<p>You’d think this would be something that already exists as a product you can just buy (even if at probably quite the markup because it’s made of “powder-coated extruded aluminium” with “audiophile quality” components, but still). Amazingly, it is not. There’s just nothing.</p>

<p>So: if you want a MIDI recorder, you’ll have to build one… and if you want to build one, this post might be useful to you!</p>

<h2 id="table-of-contents">Table of contents</h2>

<ol>
  <li><a href="#the-circuitry">The circuitry</a>
    <ol>
      <li><a href="#the-midi-part-of-our-recorder">MIDI</a></li>
      <li><a href="#the-sd-part-of-our-recorder">SD card</a></li>
      <li><a href="#adding-a-midi-marker-button">MIDI marker button</a></li>
      <li><a href="#adding-a-beep-for-debugging">All the beep beeps</a></li>
    </ol>
  </li>
  <li><a href="#the-software">The software</a>
    <ol>
      <li><a href="#program-basics">Basics</a></li>
      <li><a href="#midi-handling">MIDI handling</a></li>
      <li><a href="#file-management">File management</a></li>
      <li><a href="#saving-midi-markers">Saving MIDI markers</a></li>
      <li><a href="#making-some-beeps">Making some beeps</a></li>
      <li><a href="#creating-a-new-file-when-idling">idle handling</a></li>
      <li><a href="#a-final-helper-script">A final helper script</a></li>
    </ol>
  </li>
  <li><a href="#importing-midi-data-into-your-daw">Importing MIDI data into your DAW</a></li>
  <li><a href="#comments-and-or-questions">Comments/questions</a></li>
</ol>

<h2 id="the-circuitry">The circuitry</h2>

<p><a href="https://raw.githubusercontent.com/Pomax/arduino-midi-recorder/master/banner.jpg" target="_blank"><img src="https://pomax.github.io/arduino-midi-recorder/banner-small.jpg" width="100%"></a></p>

<p>To build this, we’re going to basically build a standard “MIDI-In + MIDI-Thru” circuit using an Arduino, with an SD card module hooked up so we can save the data that comes flying by. To build everything, we’ll need some special components:</p>

<ol>
  <li>An Arduino SD card module (~$10 for a pack of five)</li>
  <li>Two female 5-pin DIN connectors (~$5 for a pack of ten)</li>
  <li>A 6N138 optocoupler (~$10 for a pack of ten)</li>
</ol>

<p>And of course, the bits that you’ll get with pretty much any Arduino starter kit:</p>

<ol>
  <li>An Arduino UNO R3 or equivalent board</li>
  <li>4x 220 ohm resistors</li>
  <li>1x 4.7k ohm resistor</li>
  <li>A diode</li>
  <li>A piezo buzzer</li>
  <li>Two clicky pushy buttons</li>
</ol>

<h3 id="the-midi-part-of-our-recorder">The MIDI part of our recorder</h3>

<p>We set up MIDI-In on the Arduino <code>RX&lt;-0</code> pin, with MIDI-Thru tapping straight into signal that’s getting sent to <code>RX&lt;-0</code>, too. The only tricky bit about this is that MIDI signals are isolated from the rest of the circuitry via an optocoupler (which gets around ground loop problems by literally transmitting signals by running them through a LED, which emits the electrical signal as light, which then gets picked up by a phototransistor that turns the light back into an electrical signal). When placing and connecting the optocoupler, it is very important to make sure you know which pin is pin 1: it’ll have a little mark next to it (typically a dot on the chip casing) to tell you that that side has pins 1 through 4 running top to bottom, and pins 5 through 8 on the other side <em>running bottom to top</em>. Also note that we’re not using pins 1 and 4 for this circuit: only pins 2 and 3 are connected to the MIDI-In connector, and pins 5 through 8 are connected to the various arduino pins.</p>

<p><a href="https://raw.githubusercontent.com/Pomax/arduino-midi-recorder/master/MIDI.jpg" target="_blank"><img alt="MIDI circuit diagram" src="https://pomax.github.io/arduino-midi-recorder/MIDI.png" width="75%"></a></p>

<p>(I know, “Thru isn’t a word!”, but that’s what <a href="http://www.shclemen.com/download/The%20Complete%20MIDI1.0%20Detailed%20Spec.pdf#page=7&amp;zoom=auto,-206,478">the MIDI spec</a> calls it, so English gets to take a back seat here…)</p>

<h3 id="the-sd-part-of-our-recorder">The SD part of our recorder</h3>

<p>The SD card circuitry is literally just a matter of “connect the pins to the pins”, with the only oddity being that the pins don’t <em>quite</em> line up well enough to literally just stick the SD card module directly into the Arduino.</p>

<p>However, note that your SD card module <strong>may have a different pin layout</strong> so be sure to double-check before wiring things up!</p>

<p><a href="https://raw.githubusercontent.com/Pomax/arduino-midi-recorder/master/sd%20card.jpg" target="_blank"><img alt="SD module diagram" src="https://pomax.github.io/arduino-midi-recorder/sd%20card.png" width="50%"></a></p>

<h3 id="adding-a-midi-marker-button">Adding a MIDI marker button</h3>

<p>In order to make it easier to find particularly “worth revisiting” parts of what got recorded, we add a button that connects to pin 4, that we can use to write MIDI markers into our file. There is barely anything to this circuit:</p>

<p><a href="https://raw.githubusercontent.com/Pomax/arduino-midi-recorder/master/button.jpg" target="_blank"><img alt="simple button diagram" src="https://pomax.github.io/arduino-midi-recorder/button.png" width="50%"></a></p>

<h3 id="adding-a-beep-for-debugging">Adding a beep, for debugging</h3>

<p>And finally, we’re going to add a little piezo speaker and a button that we can press to turn on (or off) playing a note corresponding to a MIDI note getting played, mostly as the audio equivalent of visual debugging. There’s barely any work here: we hook up the “speaker” between pin 8 and ground, and the button to pin 2. Beep, beep!</p>

<p><a href="https://raw.githubusercontent.com/Pomax/arduino-midi-recorder/master/beep.jpg" target="_blank"><img alt="beep beep button diagram" src="https://pomax.github.io/arduino-midi-recorder/beep.png" width="50%"></a></p>

<h2 id="the-software">The Software</h2>

<p>With the circuitry set up, let’s start writing our program, focussing on dealing with each circuit in its own section</p>

<ol>
  <li><a href="#program-basics">Program basics</a></li>
  <li><a href="#midi-handling">Basic signal handling (MIDI library)</a></li>
  <li><a href="#file-management">Basic file writing (SD library)</a></li>
  <li><a href="#saving-midi-markers">Saving MIDI markers</a></li>
  <li><a href="#making-some-beeps">Audio debugging (beep beep)</a></li>
  <li><a href="#creating-a-new-file-when-idling">Usability bonus: “clean restart” on idle</a></li>
  <li><a href="#a-final-helper-script">Usability bonus 2: “fix the track length” script</a></li>
</ol>

<h3 id="program-basics">Program basics</h3>

<p>Our basic program will need to import the standard <a href="https://www.arduino.cc/en/reference/SD">SD</a> library, as well as the <a href="https://github.com/FortySevenEffects/arduino_midi_library">MIDI</a> library (which you’ll probably need to <a href="https://github.com/FortySevenEffects/arduino_midi_library#getting-started">install first</a>).</p>

<p>Note that if you don’t want to “follow along” and instead you just want the code, you can copy-paste the code found over in <a href="https://raw.githubusercontent.com/Pomax/arduino-midi-recorder/master/midi-recorder.ino">midi-recorder.ino</a> into the Arduino IDE.</p>

<div><div><pre><code><span>#include &lt;SD.h&gt;
#include &lt;MIDI.h&gt;
</span>
<span>MIDI_CREATE_DEFAULT_INSTANCE</span><span>();</span>

<span>void</span> <span>setup</span><span>()</span> <span>{</span>
  <span>// we'll put some more code here in the next sections</span>
<span>}</span>

<span>void</span> <span>loop</span><span>()</span> <span>{</span>
  <span>// we'll put some more code here in the next sections</span>
<span>}</span>
</code></pre></div></div>

<p>And we’re done!</p>

<p>Of course this doesn’t <em>do</em> anything yet, so let’s add the rest of the code, too.</p>

<h3 id="midi-handling">MIDI handling</h3>

<p>For our MIDI handling, we’ll need to set up listeners for MIDI events, and make sure to poll for that data during the program loop:</p>

<div><div><pre><code><span>void</span> <span>setup</span><span>()</span> <span>{</span>
  <span>MIDI</span><span>.</span><span>begin</span><span>(</span><span>MIDI_CHANNEL_OMNI</span><span>);</span>
  <span>MIDI</span><span>.</span><span>setHandleNoteOn</span><span>(</span><span>handleNoteOn</span><span>);</span>
  <span>MIDI</span><span>.</span><span>setHandleNoteOff</span><span>(</span><span>handleNoteOff</span><span>);</span>
  <span>MIDI</span><span>.</span><span>setHandlePitchBend</span><span>(</span><span>handlePitchBend</span><span>);</span>
  <span>MIDI</span><span>.</span><span>setHandleControlChange</span><span>(</span><span>handleControlChange</span><span>);</span>
<span>}</span>

<span>void</span> <span>loop</span><span>()</span> <span>{</span>
  <span>checkForMarker</span><span>();</span>
  <span>setPlayState</span><span>();</span>
  <span>updateFile</span><span>();</span>
  <span>MIDI</span><span>.</span><span>read</span><span>();</span>
<span>}</span>
</code></pre></div></div>

<p>This sets up MIDI listening on all MIDI channels (there are sixteen of them, and we don’t want to guess which channels are active), and reads out the MIDI data from <code>RX&lt;-0</code> - you may have noticed we don’t explicitly set a baud rate: the MIDI spec only allows for 31,250 bits per second, so the Arduino MIDI library automatically makes sure to set the correct polling rate for us.</p>

<p>You’ll notice that <code>loop()</code> does four things: we’ll only be looking at the MIDI reading in this section, with the next sections covering the other three steps.</p>

<p>For now, assuming that the first three function calls work (because they will, later =), that leaves implementing our MIDI event handling:</p>

<div><div><pre><code><span>#define NOTE_OFF_EVENT 0x80
#define NOTE_ON_EVENT 0x90
#define CONTROL_CHANGE_EVENT 0xB0
#define PITCH_BEND_EVENT 0xE0
</span>
<span>void</span> <span>handleNoteOff</span><span>(</span><span>byte</span> <span>channel</span><span>,</span> <span>byte</span> <span>pitch</span><span>,</span> <span>byte</span> <span>velocity</span><span>)</span> <span>{</span>
  <span>writeToFile</span><span>(</span><span>NOTE_OFF_EVENT</span><span>,</span> <span>pitch</span><span>,</span> <span>velocity</span><span>);</span>
<span>}</span>

<span>void</span> <span>handleNoteOn</span><span>(</span><span>byte</span> <span>channel</span><span>,</span> <span>byte</span> <span>pitch</span><span>,</span> <span>byte</span> <span>velocity</span><span>)</span> <span>{</span>
  <span>writeToFile</span><span>(</span><span>NOTE_ON_EVENT</span><span>,</span> <span>pitch</span><span>,</span> <span>velocity</span><span>);</span>
<span>}</span>

<span>void</span> <span>handleControlChange</span><span>(</span><span>byte</span> <span>channel</span><span>,</span> <span>byte</span> <span>controller</span><span>,</span> <span>byte</span> <span>value</span><span>)</span> <span>{</span>
  <span>writeToFile</span><span>(</span><span>CONTROL_CHANGE_EVENT</span><span>,</span> <span>controller</span><span>,</span> <span>value</span><span>);</span>
<span>}</span>

<span>void</span> <span>handlePitchBend</span><span>(</span><span>byte</span> <span>channel</span><span>,</span> <span>int</span> <span>bend_value</span><span>)</span> <span>{</span>
  <span>// First off, we need to "re-center" the bend value,</span>
  <span>// because in MIDI, the bend value is a positive value</span>
  <span>// in the range 0x0000-0x3FFF with 0x2000 considered</span>
  <span>// the "neutral" mid point, whereas the MIDI library</span>
  <span>// gives us a signed integer value that uses 0 as its</span>
  <span>// midpoint and negative numbers to signify "down".</span>
  <span>bend_value</span> <span>+=</span> <span>0x2000</span><span>;</span>

  <span>// Then, per the MIDI spec, we need to encode the 14 bit</span>
  <span>// bend value as two 7-bit bytes, where the first byte</span>
  <span>// contains the lowest 7 bits of our bend value, and second</span>
  <span>// byte contains the highest 7 bits of our bend value:</span>
  <span>byte</span> <span>lowBits</span> <span>=</span> <span>(</span><span>byte</span><span>)</span> <span>(</span><span>bend_value</span> <span>&amp;</span> <span>0x7F</span><span>);</span>
  <span>byte</span> <span>highBits</span> <span>=</span> <span>(</span><span>byte</span><span>)</span> <span>((</span><span>bend_value</span> <span>&gt;&gt;</span> <span>7</span><span>)</span> <span>&amp;</span> <span>0x7F</span><span>);</span>

  <span>writeToFile</span><span>(</span><span>PITCH_BEND_EVENT</span><span>,</span> <span>lowBits</span><span>,</span> <span>highBits</span><span>);</span>
<span>}</span>
</code></pre></div></div>

<p>(note that we’re ignoring the <code>channel</code> byte: we’ll be creating a “simple” format 0 MIDI file, and for maximum usability in terms of importing our data in a DAW, we’re putting all the events on channel 1. We can see this in our event constants: events use two 4 bit “nibbles” with the first nibble being the event identifier, and the second nibble being the channel that the event happens in, so for example: <code>NOTE_OFF_EVENT</code> uses 0x80 for “note off on channel 1”, but 0x8F for “note off on channel 16”)</p>

<p>This is a good start, but MIDI events are just that: events, and events happen “at some specific time” which we’re still going to have to capture. Standard MIDI events don’t rely on absolute values from some real time clock (which is good for us, because Arduinos don’t have an RTC built in!) and instead rely on counting a “time delta”: it marks events with the number of “MIDI clock ticks” since the previous event, with the very first event in the event stream having an explicit time delta of zero.</p>

<p>So: let’s write a <code>getDelta()</code> function that we can use to get the number of MIDI ticks since the last event (=since the last time <code>getDelta()</code> got called) so that we have all the data we need ready to start writing MIDI to file:</p>

<div><div><pre><code><span>unsigned</span> <span>long</span> <span>startTime</span> <span>=</span> <span>0</span><span>;</span>
<span>unsigned</span> <span>long</span> <span>lastTime</span> <span>=</span> <span>0</span><span>;</span>

<span>int</span> <span>getDelta</span><span>()</span> <span>{</span>
  <span>if</span> <span>(</span><span>startTime</span> <span>==</span> <span>0</span><span>)</span> <span>{</span>
    <span>startTime</span> <span>=</span> <span>millis</span><span>();</span>
    <span>lastTime</span> <span>=</span> <span>startTime</span><span>;</span>
    <span>return</span> <span>0</span><span>;</span>
  <span>}</span>
  <span>unsigned</span> <span>long</span> <span>now</span> <span>=</span> <span>millis</span><span>();</span>
  <span>unsigned</span> <span>int</span> <span>delta</span> <span>=</span> <span>(</span><span>now</span> <span>-</span> <span>lastTime</span><span>);</span>
  <span>lastTime</span> <span>=</span> <span>now</span><span>;</span>
  <span>return</span> <span>delta</span><span>;</span>
<span>}</span>
</code></pre></div></div>

<p>This function seems bigger than it has to be: we <em>could</em>…</p></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://pomax.github.io/arduino-midi-recorder/">https://pomax.github.io/arduino-midi-recorder/</a></em></p>]]>
            </description>
            <link>https://pomax.github.io/arduino-midi-recorder/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25532601</guid>
            <pubDate>Thu, 24 Dec 2020 23:31:13 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Implementing Anonymous Posts on Gurlic]]>
            </title>
            <description>
<![CDATA[
Score 21 | Comments 10 (<a href="https://news.ycombinator.com/item?id=25531158">thread link</a>) | @SubGenius
<br/>
December 24, 2020 | https://gurlic.com/root/implementing-anonymous-posts-on-gurlic | <a href="https://web.archive.org/web/*/https://gurlic.com/root/implementing-anonymous-posts-on-gurlic">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
                

<section>
                <section>
                  <p>
                    Implementing Anonymous Posts On Gurlic
                  </p>
                  
                  
                </section>
  

</section>

          </div><article>
          
          <p><img src="https://static.gurlic.com/post-featured/16801023637385968737572668552444.webp">
          </p>
          
              <section>
              <p>Anonymous posts on Gurlic are quite straight-forward. There is an actual user with the username <code>anonymous</code>. Whenever a new anonymous post is created, the database query looks like this:</p><pre><code>INSERT into posts(content, user_id) 
VALUES($1, (SELECT id from users where username='anonymous'))</code></pre><p>Initially, I wanted a way for users to be able to edit their anonymous posts. That is a little tricky though, because there has to be some record that ties the user to the post itself - which defeats the purpose of anonymous posts. In the case of a database leak, that connection is out in the public. We don't want that.</p><p>So anonymous posts are pretty much a one-off action because once they're created, the user no longer has any control over them - whether it's editing the post, marking it as NSFW, deleting it and so on. </p><p>This also means that the <code>anonymous</code> user has a <a href="https://gurlic.com/anonymous" rel="noopener noreferrer nofollow">profile</a>, just like any other user, and can be followed, mentioned etc.</p><p>I'm sure someone has a much better way to implement anonymous posts that are tied to the users that created them, while being secure at the same time. It does seem like a lot of extra work though. </p><p>Why be not lazy when you can be lazy?</p>
              </section>
              <section>
                

                


              </section>
        </article></div>]]>
            </description>
            <link>https://gurlic.com/root/implementing-anonymous-posts-on-gurlic</link>
            <guid isPermaLink="false">hacker-news-small-sites-25531158</guid>
            <pubDate>Thu, 24 Dec 2020 20:33:47 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Processing RSS Feeds with Repl.it]]>
            </title>
            <description>
<![CDATA[
Score 14 | Comments 0 (<a href="https://news.ycombinator.com/item?id=25530346">thread link</a>) | @jacobobryant
<br/>
December 24, 2020 | https://findka.com/blog/replit-rss/ | <a href="https://web.archive.org/web/*/https://findka.com/blog/replit-rss/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><p>The other day I made <a href="https://rssstuff.jobryant.repl.co/" target="_blank">a small web service</a>
with Repl.it that does a simple transformation on an RSS feed (<a href="https://repl.it/@jobryant/RSSStuff" target="_blank">source
code</a>). I created it mainly because of
<a href="https://hnblogs.substack.com/" target="_blank">this excellent newsletter</a>, which is a daily
roundup of potentially interesting, non-commercial blog posts from Hacker News
that didn't hit the front page. I've found quite a few good articles from it.</p><p>I've been reading the newsletter via email, but after releasing <a href="https://findka.com/blog/new-take-on-rss/">Findka's
bandit-driven RSS aggregator</a>, I
wanted to switch to the RSS feed. Only one problem: Substack provides a feed,
but each entry goes to an edition of the newsletter, which contains a
collection of links. Findka needs each entry to go to one of the individual
links.</p><p><img src="https://findka.com/img/hnblogs.png" alt="Screenshot of the newsletter"></p><p><a href="https://repl.it/" target="_blank">Repl.it</a> is one of the easiest ways to deploy a simple web
service, so it was great for my little RSS <code>mapcat</code>-er. It's exposed via
<code>https://rssstuff.jobryant.repl.co/feed?url={some-url}&amp;exclude={some-regex}</code>.
You send it a source feed and you get back a sink feed that has an entry for
every link contained within the source feed's entries. You can also supply an
exclude regex to filter out links. <a href="https://rssstuff.jobryant.repl.co/" target="_blank">The root
page</a> has a form you can use to construct
the URL.</p><p><img src="https://findka.com/img/rssstuff.png" alt="Screenshot of the Repl.it service"></p><p>This does require one small hack. Repl.it services will shut down after a while
if they aren't getting any traffic. You can get around that with the help of
your favorite pinging service. Repl.it says they're going to include "always-on
repls" in their paid plan soon, after which this will no longer be necessary.</p><p>I'm excited to see what happens with Repl.it. As I've <a href="https://findka.com/blog/four-ideals/#extensibility">written
before</a>, I would love for
open-source, self-hosted web apps to become more common. <a href="https://www.jsalter.net/posts/what-if-users-brought-the-infrastructure" target="_blank">Here's
another</a>,
great post on the topic (which I discovered <a href="https://hnblogs.substack.com/p/hn-blogs-171020" target="_blank">thanks to that
newsletter</a>!). Lately I've been
thinking that Repl.it is probably the perfect platform for this. I've got a
handful of small web services I'd like to make, and I think it'd be fun to see
how far I can push Repl.it.</p><p>Now if only there was a good way to use my local editor instead of the web UI.
:)</p></div></div>]]>
            </description>
            <link>https://findka.com/blog/replit-rss/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25530346</guid>
            <pubDate>Thu, 24 Dec 2020 19:04:39 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Fictional Videogame Stills]]>
            </title>
            <description>
<![CDATA[
Score 154 | Comments 36 (<a href="https://news.ycombinator.com/item?id=25530307">thread link</a>) | @doener
<br/>
December 24, 2020 | https://www.suzannetreister.net/Ampages/Amenu.html | <a href="https://web.archive.org/web/*/https://www.suzannetreister.net/Ampages/Amenu.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div> 
      <td colspan="4"> 
        <p><span size="2" face="Verdana, Arial, Helvetica, sans-serif"><b><span size="1" color="#99CC33">Suzanne 
          Treister<br>
          </span></b><span size="1" face="Verdana, Arial, Helvetica, sans-serif" color="#99CC33">1991-1992</span><span size="1" color="#99CC33"> 
          </span></span> </p>
        <p><span size="1" face="Verdana, Arial, Helvetica, sans-serif" color="#99CC33"><i><strong>Fictional 
          Videogame Stills</strong></i> </span></p>
        <p><span size="1" face="Verdana, Arial, Helvetica, sans-serif" color="#99CC33">In 
          the late 1980s I was making paintings about computer games. In January 1991 I bought an Amiga computer and made a series of fictional 
          videogame stills using Deluxe Paint II. I photographed them straight 
          from the screen as there was no other way to output them that I knew 
          of apart from through a very primitive daisy wheel printer where they appeared as washed out dots. <p>
          
          The effect of the photographs perfectly reproduced the highly 
          pixellated, raised needlepoint effect of the Amiga screen image. Conceptually 
          this means of presentation was also appropriate in that it made it seem 
          like I had gone into a videogame arcade and photographed the games there, 
          lending authenticity to the fiction.</p></span><span color="#99cc33" face="Verdana, Arial, Helvetica, sans-serif" size="1">The first seven works on this page form a series titled, 'Q. Would you recognise a Virtual Paradise?'</span><span size="1" face="Verdana, Arial, Helvetica, sans-serif" color="#99CC33"><p>
          
          Many of these works were shown in London at the Edward Totah Gallery in March 
        1992 (<a href="https://www.suzannetreister.net/Ampics/Installations/Totah-Installation1992/EdwardTotah_1992.html" target="_self">view installation</a>) and later that year</p></span><span color="#99cc33" face="Verdana, Arial, Helvetica, sans-serif" size="1"> at the Exeter Hotel in Adelaide, Australia.<br> 
        In 1995 the 'Q. Would you recognise a Virtual Paradise?' series was shown in London at the Royal Festival Hall in the exhibition<em> It's a Pleasure</em>, curated by Leah Kharibian.</span><span size="1" face="Verdana, Arial, Helvetica, sans-serif" color="#99CC33"><br>
        Recent venues: Somerset House, London, 2018 <a href="https://www.suzannetreister.net/Ampics/Installations/SomersetHouse2018/SomersetHouse2018.html" target="_self">view installation</a> ; Akron Art Museum, Ohio, USA 2019 and tour; Moderna Museet, Stockholm, Sweden, 2019/20 <a href="https://www.suzannetreister.net/InstallationV/Moderna-Museet_2019.html" target="_self">view installation</a><p>
          
          The original Amiga floppy disks which stored the image files are  corrupt, but the  photographic art works remain.</p></span><span size="1" face="Verdana, Arial, Helvetica, sans-serif" color="#99CC33"><p>
          
          For 
          more information <a href="https://www.suzannetreister.net/Ampages/Treister_Essay.pdf">download my essay</a> 
          from '<a href="http://www.intellectbooks.co.uk/ppbooks.php?isbn=9781841501420" target="_blank">Videogames 
            and Art</a>', Ed. Andy Clarke, Grethe Mitchell, Publ. Intellect Books, 
        UK 2007</p></span></p>
<p><span color="#996633" size="1" face="Verdana, Arial, Helvetica, sans-serif"> <a href="https://www.suzannetreister.net/Videography/Videogames_Video.html" target="_self">view video version</a><p>
            
          click 
  titles below to view enlargements of photo works</p></span></p></td>
    </div></div>]]>
            </description>
            <link>https://www.suzannetreister.net/Ampages/Amenu.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-25530307</guid>
            <pubDate>Thu, 24 Dec 2020 19:01:14 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Making a digital clock in Google Sheets]]>
            </title>
            <description>
<![CDATA[
Score 60 | Comments 11 (<a href="https://news.ycombinator.com/item?id=25529618">thread link</a>) | @DamnInteresting
<br/>
December 24, 2020 | https://www.therobinlord.com/making-a-digital-clock-in-google-sheets/ | <a href="https://web.archive.org/web/*/https://www.therobinlord.com/making-a-digital-clock-in-google-sheets/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article id="post-920">

<div>
<p>“This is cool, really cool, but I feel like maybe you need an intervention” – Friend’s reaction when I showed them this.</p>

<h2>What have I done?</h2>
<p>Using only Google Sheets formulas I’ve made a digital clock. It updates every minute, it’s a clock, that’s pretty much it.</p>
<h2>Why have I done it?</h2>
<p><strong>I’m a very strong believer in getting the most out of the tools available to us and this kind of rubbish is a great way to learn things which are </strong><em><strong>way</strong></em><strong> more useful elsewhere</strong>!</p>
<p>Without doing anything like custom functions in JavaScript – Google Sheets is <em>amazingly </em>flexible. I’ve used it to automate things like <a href="https://moz.com/blog/visualising-time-using-google-sheets">project management tasks</a> and even <a href="https://www.distilled.net/resources/screaming-frog-and-google-sheets/">website change detection using Screaming Frog</a>. </p>
<p>Google Sheets is also <em>really</em> accessible – if you make something in Google Sheets you can share it with colleagues and clients without them needing to install anything, without them needing an account, and without them being made nervous by any mention of code.</p>
<p>Languages like Python and JavaScript are great ways to get things done but it is fun to see what we can achieve with little ole Sheets.</p>
<h2>The sheet</h2>
<p>Access the <a href="https://docs.google.com/spreadsheets/d/1_EjJsdfzLL6LaTtJnTZ26BzHRHBDJy1paHeeZ87toT0/copy">Google Sheets digital clock here</a> if you want to have a play with it. I’ve set the link to automatically copy so you have your own version where you can see the formulas at work.</p>

<h2>How have I done it? (The important bit!)</h2>
<p>As I say – the value of these things is what we are able to learn. So let’s see what we’ve learned.</p>
<h3>1. Getting the current time – now()</h3>
<p><em>=now()</em> returns current date and time in this format: <strong><em>24/10/2020 23:24:00</em></strong></p>
<figure><picture><source srcset="https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.24.12.png.webp" type="image/webp"><img src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.24.12.png" alt="" data-src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.24.12.png" data-old-src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></picture></figure>
<p>We’ll put that in cell A1.</p>
<h3>2. Getting minutes and hours – hour() and minute()</h3>
<p><em>=hour(A1)</em> will give us the hour contained in a specific time. If we used hour() on the timestamp above we would get <em><strong>23</strong></em></p>
<p><em>=minute(A1)</em> gives us the minute. If we used minute() on the timestamp above we’d get <strong><em>24</em></strong></p>
<figure><picture><source srcset="https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.24.06.png.webp" type="image/webp"><img src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.24.06.png" alt="" data-src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.24.06.png" data-old-src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></picture></figure>
<h3>3. Splitting minutes and hours into individual digits – regexextract()</h3>
<p>=regexextract() lets us get part of the value out of a cell, but only as long as it’s used on text (digits can be interpreted as either numbers or text in Sheets). So <span>first</span> we use =text(hour(A1),”##”) – that takes the hour from the timestamp and turn it into text.</p>
<p>You may notice below that the hour and minute values are left-aligned rather than right-aligned. That’s one way to spot whether Sheets might be treating digits as a number or as text.</p>
<figure><picture><source srcset="https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.27.16.png.webp" type="image/webp"><img src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.27.16.png" alt="" data-src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.27.16.png" data-old-src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></picture></figure>
<p>Then we use =regexextract() to get the first number of the hour like so <em>=regexextract(text(HOUR(A1),”##”),”^\d”)</em>. Don’t worry too much about that RegEx, all it means is “the first digit”. If you want to learn more about RegEx – check out my <a href="https://www.therobinlord.com/projects/slash-escape">RegEx learning game – Slash Escape</a>.</p>
<p>We’ll extract the last number of the hour like this; <em>=regexextract(text(HOUR(A1),”##”),”\d$”)</em></p>
<p>Then we do the same for both of the minute digits.</p>
<figure><picture><source srcset="https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.34.50.png.webp 329w, https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.34.50-300x158.png.webp 300w" sizes="(max-width: 329px) 100vw, 329px" type="image/webp"><img src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.34.50.png" alt="" srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.34.50.png 329w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.34.50-300x158.png 300w" sizes="(max-width: 329px) 100vw, 329px" data-srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.34.50.png 329w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.34.50-300x158.png 300w" data-src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-24-at-23.34.50.png" data-old-src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></picture></figure>
<h3>3. Changing colours – Sheets conditional formatting</h3>
<p>To create our digital clock, we need to tell sheets which cells to highlight at which time. To do that we’ll use Sheets’ amazingly flexible conditional formatting.</p>
<p>We’ll apply a different conditional format to each space in our clock. To make it clearer – here’s each of them highlighted in a different colour.</p>
<figure><picture><source srcset="https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45.png.webp 464w, https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45-300x184.png.webp 300w" sizes="(max-width: 464px) 100vw, 464px" type="image/webp"><img alt="" data-srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45.png 464w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45-300x184.png 300w" data-src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45.png" data-sizes="(max-width: 464px) 100vw, 464px" srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45.png 464w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45-300x184.png 300w" src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45.png"></picture></figure>
<p>We have four rules, one for each digit in our clock. Each splits out a portion of the time for our display. Our broad process is;</p>
<ul><li>The rule defining the green number above<ul><li>When the first digit of the hour is 1 – highlight all the cells in the first block which we’ve marked as “1 cells”</li><li>When the first digit of the hour is 8 – highlight all the cells in the first block which we’ve marked as “8 cells”<br></li></ul></li><li>The rule defining the blue number above<ul><li>When the first digit of the minute is 6 – highlight all the cells in the last block which we’ve marked as “6 cells”</li></ul></li></ul>
<p>etc. etc. etc.</p>
<div>
<div>
<figure><picture><source srcset="https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.14.05.png.webp 297w, https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.14.05-183x300.png.webp 183w" sizes="(max-width: 297px) 100vw, 297px" type="image/webp"><img src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.14.05.png" alt="" srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.14.05.png 297w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.14.05-183x300.png 183w" sizes="(max-width: 297px) 100vw, 297px" data-srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.14.05.png 297w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.14.05-183x300.png 183w" data-src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.14.05.png" data-old-src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></picture></figure>
</div>
<div>
<p>Our first, green digit, at maximum will occupy any of the cells between C3 and H14.</p>
<p>In each of the cells in that range, we’ve written out a RegEx which tells us if a digit will use that cell.</p>
<p>For example, cell C3 will be highlighted if we are creating the digits 4, 5 or 7. It won’t be highlighted if we’re creating the digits 0, 1, 2, 3, 6, 8, or 9. So in C3 we have written<em> ^(4|5|7)$</em> which means “match 4, 5, or 7, exactly – nothing else.</p>
<p>In this case – U1 is where we’ve put our first extracted digit of the hour. So the custom formula written there means “when the first digit of the hour matches 4, 5, or 7, highlight C3”. </p>
</div>
</div>
<p>One smart thing about custom formulas in Google Sheets is, if you apply it to a range of cells (like C3:H14) it will take relative and absolute cell references into account. In our formula we’ve used $U$1 – that’s an absolute cell reference – no matter where we are applying this custom formula – that part will always refer to U1. However – we haven’t written $C$3 – we’ve just written C3. So, in the first cell of our range, we’ll refer to C3 but if we apply this formula to a cell one row down it’ll refer to C4, if we then move one column across it’ll refer to D4.</p>
<p>This is how we create our clock without having to write out a different conditional formula for each one. When the conditional formatting is applied to C4, it’ll check whether the regex in C4 matches the first digit of the hour. The regex in C4 is <em>^(2|3|4|5|6|8|9|0)$</em> so if the first digit of the hour is 2 – C4 will be highlighted and C3 won’t be.</p>
<h3>4. Drawing all the numbers – join()</h3>
<p>It would be a massive pain to just try to write out all of these regex formulas one-by-one. Instead we’ll write out each of the possible digits we want to represent and then combine them into our regex.</p>
<figure><picture><source srcset="https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-1024x358.png.webp 1024w, https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-300x105.png.webp 300w, https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-768x269.png.webp 768w, https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38.png.webp 1440w" sizes="(max-width: 706px) 89vw, (max-width: 767px) 82vw, 740px" type="image/webp"><img src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-1024x358.png" alt="" srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-1024x358.png 1024w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-300x105.png 300w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-768x269.png 768w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38.png 1440w" sizes="(max-width: 706px) 89vw, (max-width: 767px) 82vw, 740px" data-srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-1024x358.png 1024w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-300x105.png 300w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-768x269.png 768w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38.png 1440w" data-src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.41.38-1024x358.png" data-old-src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="></picture></figure>
<p>Our Clock C3 cell in our is a combination of the numbers in our digits sheet <em>A3, G3, M3, S3, Y3, AE3, AK3, AQ3, AW3, BC3</em>. Clock C4 is <em>A4, G4, M4</em> etc. etc. etc.</p>
<p>The formula we use to do that is; <em>JOIN(“|”,Digits!A3,Digits!G3,Digits!M3,Digits!S3,Digits!Y3,Digits!AE3,Digits!AK3,Digits!AQ3,Digits!AW3,Digits!BC3)</em></p>
<p>Basically – take the value from each of these cells and join them together with a pipe | in between them (because pipe in regex means <strong>or</strong>).</p>
<h3>5. Removing errant pipes – regexreplace()</h3>
<p>The problem with this is we have some empty cells so we can end up with a regex that reads <em>|||4|5||7||| </em> – having those empty spaces means we won’t just match numbers – we’ll match a lack of number too, which could screw up our clock. To get rid of those problematic extra bits we’ll use regex <em>on</em> our regex. </p>
<figure><picture><source srcset="https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Yo-Dawg-Heard-You.jpg.webp 500w, https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Yo-Dawg-Heard-You-300x194.jpg.webp 300w" sizes="(max-width: 500px) 100vw, 500px" type="image/webp"><img alt="" data-srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Yo-Dawg-Heard-You.jpg 500w, https://www.therobinlord.com/wp-content/uploads/2020/10/Yo-Dawg-Heard-You-300x194.jpg 300w" data-src="https://www.therobinlord.com/wp-content/uploads/2020/10/Yo-Dawg-Heard-You.jpg" data-sizes="(max-width: 500px) 100vw, 500px" srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Yo-Dawg-Heard-You.jpg 500w, https://www.therobinlord.com/wp-content/uploads/2020/10/Yo-Dawg-Heard-You-300x194.jpg 300w" src="https://www.therobinlord.com/wp-content/uploads/2020/10/Yo-Dawg-Heard-You.jpg"></picture></figure>
<p><em>=regexreplace(JOIN(…),”\|{2,}”,”|”)</em></p>
<p>This formula will take the result of our join, identify anything that matches <strong>\|{2,}</strong> (basically two or more pipes in the row) and replaces them with | – one pipe.</p>
<p>We also don’t want to end up with pipes at the start or end like this; |4|5| so we’ll regexreplace on our regexreplace</p>

<p><em>=regexreplace(regexreplace(…),”(^\||\|$)”,””))</em></p>
<p>This formula will look at the result of our last regexreplace(), find anything that matches <strong>^\|</strong> (a pipe at the start of the text) or <strong>\|$</strong> (a pipe at the end of the text) and replace either with “” (nothing).</p>
<p>So now we have a regex like this; <strong>4|5</strong></p>
<h2>5. Complete our regex – &amp; concatenation</h2>
<p>To make sure we have a nice, specific, regex to match on we can add some text to the start and end. Google Sheets has a concatenate function but I find using &amp; easier to read</p>
<p>=”^(“&amp;regexreplace(…)&amp;”)$”</p>
<p>That formula will take our cleaned up regex, add brakcets and a “start’ and “end” symbol so we have something like this; <strong>^(</strong>4|5)$</p>
<p>We know that regex will only match either the digit 4 or the digit 5 and nothing else. Nice and specific.</p>
<h3>6. Create all the rest of our digits – arrayformula()</h3>
<p>At this point we’ve created the template for our first hour digit. We don’t want to go through all of that for each of the other templates and they can all be identical. So we use arrayformula to copy one block of cells to another place.</p>
<p><em>=arrayformula($C$3:$H$14) </em>duplicates our template, we can do that for each of our other digits.</p>
<h3>7. Highlighting the rest of our digits – Sheets conditional formatting</h3>
<figure><picture><source srcset="https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45.png.webp 464w, https://www.therobinlord.com/wp-content/webp-express/webp-images/doc-root/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45-300x184.png.webp 300w" sizes="(max-width: 464px) 100vw, 464px" type="image/webp"><img alt="" data-srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45.png 464w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45-300x184.png 300w" data-src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45.png" data-sizes="(max-width: 464px) 100vw, 464px" srcset="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45.png 464w, https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45-300x184.png 300w" src="https://www.therobinlord.com/wp-content/uploads/2020/10/Screenshot-2020-10-25-at-11.06.45.png"></picture></figure>
<p>Our first conditional formatting formula checked each cell in the green block against the first digit of the current hour. Our second formula checks the cells in the yellow block against the second digit of the hour, our third block checks the cells in the blue block against the first digit of the minute etc. etc.</p>

<h2>Any ideas?</h2>
<p>As above – feel free to play around with the Google Sheet and see how it works.</p>

<p>This is a bit of fun which hopefully helps you learn some Sheets tricks that’ll be valuable elsewhere. One thing I love about open platforms like sheets is there are <em>loads</em> of people creating this kind of thing. When I started to share this, a colleague pointed out that <a href="https://www.benlcollins.com/spreadsheets/google-sheets-formula-clock/">Ben Collins actually created a working </a><em><a href="https://www.benlcollins.com/spreadsheets/google-sheets-formula-clock/">analogue</a></em><a href="https://www.benlcollins.com/spreadsheets/google-sheets-formula-clock/"> clock using Sheets sparkline formulas, which is very impressive.</a></p>
<p>Have you seen any cool sheets projects recently? Anything you think I could have done better here? Tweet me @robinlord8 </p>
</div>
</article></div>]]>
            </description>
            <link>https://www.therobinlord.com/making-a-digital-clock-in-google-sheets/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25529618</guid>
            <pubDate>Thu, 24 Dec 2020 17:45:57 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[GoDaddy employees told they were getting a holiday bonus in a phishing test]]>
            </title>
            <description>
<![CDATA[
Score 194 | Comments 243 (<a href="https://news.ycombinator.com/item?id=25529584">thread link</a>) | @arkadiyt
<br/>
December 24, 2020 | https://coppercourier.com/story/godaddy-employees-holiday-bonus-secruity-test/ | <a href="https://web.archive.org/web/*/https://coppercourier.com/story/godaddy-employees-holiday-bonus-secruity-test/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
					
<h2>Roughly 500 employees failed the test, which claimed they would receive a $650 bonus.</h2>



<p>“2020 has been a record year for GoDaddy, thanks to you!” the email read.</p>



<p>Sent by Happyholiday@Godaddy.com, tucked underneath a glittering banner of a snowflake and stamped with the words “GoDaddy Holiday Party,” the Dec. 14 email to hundreds of GoDaddy employees promised some welcome financial relief during an <a href="https://coppercourier.com/story/tens-of-millions-of-americans-face-economic-ruin-unless-congress-gets-its-sht-together/">otherwise stressful year</a>.</p>



<p>“Though we cannot celebrate together during our annual Holiday Party, we want to show our appreciation and share a $650 one-time Holiday bonus!” the email read. “To ensure that you receive your one-time bonus in time for the Holidays, please select your location and fill in the details by Friday, December 18th.”</p>



<p>But, two days later, the company sent another email.</p>



<p>“You’re getting this email because you failed our recent phishing test,” the company’s chief security officer Demetrius Comes<strong> </strong>wrote. “You will need to retake the Security Awareness Social Engineering training.”</p>



<figure><picture>
	<source media="(max-width: 320px)" srcset="https://fwiw.imgix.net/wp-content/uploads/2020/12/GoDaddy-Email.png?w=284">
	<source media="(max-width: 768px)" srcset="https://fwiw.imgix.net/wp-content/uploads/2020/12/GoDaddy-Email.png?w=676">
	<source media="(max-width: 1280px)" srcset="https://fwiw.imgix.net/wp-content/uploads/2020/12/GoDaddy-Email.png?w=1400">
	<img src="https://fwiw.imgix.net/wp-content/uploads/2020/12/GoDaddy-Email.png?w=1400" width="1400" height="9999" alt="" title="">
	
	
</picture></figure>



<figure>
		<picture>
	<source media="(max-width: 320px)" srcset="https://fwiw.imgix.net/wp-content/uploads/2020/12/Use2.png?w=284">
	<source media="(max-width: 768px)" srcset="https://fwiw.imgix.net/wp-content/uploads/2020/12/Use2.png?w=676">
	<source media="(max-width: 1280px)" srcset="https://fwiw.imgix.net/wp-content/uploads/2020/12/Use2.png?w=1400">
	<img src="https://fwiw.imgix.net/wp-content/uploads/2020/12/Use2.png?w=1400" width="1400" height="9999" alt="" title="">
	
	
</picture><span>A Dec. 14 email sent to hundreds of GoDaddy employees offered a holiday bonus to employees. It turned out to be a phishing test.</span><figcaption>Screenshots of the email were sent to The Copper Courier by multiple GoDaddy employees.</figcaption>
	</figure>



<p>Phishing tests are sent by companies to gauge their employees’ susceptibility to phishing attacks, where people outside the company will attempt to disguise themselves as trusted sources to gain access to sensitive information, like usernames and passwords.</p>



<p>The follow-up email from Comes said that roughly 500 GoDaddy employees clicked on the holiday bonus email and “failed the test.”</p>



<p>Scottsdale-based GoDaddy, the world’s largest domain registrar and web-hosting company, did not respond to repeated requests for comment about the emails. The emails were forwarded to The Copper Courier by three GoDaddy employees.</p>



<p>Earlier this year, <a href="https://www.forbes.com/sites/daveywinder/2020/05/05/godaddy-confirms-data-breach-what-19-million-customers-need-to-know/?sh=235bf0a91daa">Forbes reported</a> that 28,000 GoDaddy customers were impacted after a data breach compromised their account usernames and passwords.&nbsp;</p>



<p>Despite the company <a href="https://investors.godaddy.net/newsroom/news-releases/press-release-details/2020/GoDaddy-Reports-Second-Quarter-2020-Earnings-Results/default.aspx">surpassing 20 million customers this year</a> and reporting “record customer growth,” the company <a href="https://aboutus.godaddy.net/newsroom/news-releases/press-release-details/2020/GoDaddy-Blog-Update/default.aspx">laid off or reassigned</a> hundreds of employees during the coronavirus pandemic, <a href="https://www.abc15.com/news/business/godaddy-to-lay-off-hundreds-close-texas-offices">including in Arizona</a>, Iowa, and Texas.</p>



<p>GoDaddy is not the first company this year to trick employees into falling for phishing scams by dangling the carrot of a potential bonus.</p>



<p>In September, Tribune Publishing, which owns <a href="https://www.tribpub.com/#">several major newspapers</a> around the country, sent a similar email to its employees.</p>



<p>The email, circulated by <a href="https://twitter.com/justin_fenton/status/1308851669397053440">several furious Tribune employees on Twitter</a>, said the company was giving out targeted bonuses of $5,000-$10,000, only to later reveal itself as a phishing test sent by the company.</p>



<figure><div>
<figure><blockquote data-width="500" data-dnt="true"><div lang="en" dir="ltr"><p>I've been able to confirm that this was in fact! an internal test from <a href="https://twitter.com/tribpub?ref_src=twsrc%5Etfw">@tribpub</a>. If you click the links, you get a message from the company's training contractor saying you clicked on a simulated phishing test.</p><p>The level of cruelty is actually stunning, even for this company.</p></div>— Danielle Ohl (@DTOhl) <a href="https://twitter.com/DTOhl/status/1308850196978298880?ref_src=twsrc%5Etfw">September 23, 2020</a></blockquote></figure>
</div></figure>



<p>“The level of cruelty is actually stunning,” Tribune reporter Danielle Ohl <a href="https://twitter.com/DTOhl/status/1308850196978298880?ref_src=twsrc%5Etfw%7Ctwcamp%5Etweetembed%7Ctwterm%5E1308850196978298880%7Ctwgr%5E%7Ctwcon%5Es1_&amp;ref_url=https%3A%2F%2Fwww.vice.com%2Fen%2Farticle%2Fy3z8g5%2Ftribune-publishing-out-evils-itself-with-phishing-email-promising-bonuses">wrote at the time</a>.</p>



<p>A Tribune spokesperson <a href="https://www.vice.com/en/article/y3z8g5/tribune-publishing-out-evils-itself-with-phishing-email-promising-bonuses">later told Vice News</a> that the exercise was part of a regular, internal test to assess phishing risks and said that it had no intention of offending its employees. “In retrospect, the topic of the email was misleading and insensitive, and the company apologizes for its use,” the statement read.</p>



<p><em>Want to talk about phishing tests you’ve received from your employer? Reach the reporter at <a href="mailto:lorraine@couriernewsroom.com">lorraine@couriernewsroom.com</a> or 480-243-4086.</em></p>
				</div><div>
	<hr>
	<div>
    <a href="https://coppercourier.com/author/lorrainelonghi/">
        <picture>
	<source media="(max-width: 90px)" srcset="https://fwiw.imgix.net/wp-content/uploads/2020/11/Lorraine-Longhi-.jpg?w=90">
	<img src="https://fwiw.imgix.net/wp-content/uploads/2020/11/Lorraine-Longhi-.jpg?w=90" width="90" height="9999" alt="Lorraine Longhi" title="Lorraine Longhi">
</picture>    </a>
    <div>
        <p>
            <a href="https://coppercourier.com/author/lorrainelonghi/">
                Lorraine Longhi            </a>
            is a reporter for The Copper Courier. She is a native of the Southwest and has lived in Phoenix since 2006. A graduate of ASU’s Walter Cronkite School of Journalism, she previously worked for The Arizona Republic, covering city government, education, and the impact of statewide decisions.        </p>
        
    </div>
</div>
</div></div>]]>
            </description>
            <link>https://coppercourier.com/story/godaddy-employees-holiday-bonus-secruity-test/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25529584</guid>
            <pubDate>Thu, 24 Dec 2020 17:42:26 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Building a React Native App for Your Christmas Lights]]>
            </title>
            <description>
<![CDATA[
Score 24 | Comments 1 (<a href="https://news.ycombinator.com/item?id=25528794">thread link</a>) | @burningion
<br/>
December 24, 2020 | https://www.makeartwithpython.com/blog/minimum-viable-christmas-lights/ | <a href="https://web.archive.org/web/*/https://www.makeartwithpython.com/blog/minimum-viable-christmas-lights/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
      

      <section itemprop="text">
        

<p><img src="https://makeartwithpython.s3-us-west-2.amazonaws.com/mcyds.png" alt="McDonalds!"></p>

<p>There is no shortage of questionable products to connect you and your home to the internet.</p>

<p>Each brings another sketchy WiFi device connected to your network, and another set of microphones, each listening in your home for their special trigger word.</p>

<p>Rather than invite more digital strangers into our home, it feels more appropriate to keep a personal garden of digital things we’ve made.</p>

<p>In today’s post, we’ll build a tiny web application (and iPhone / Android app!) to control Christmas lights that only works when you’re home, and connected to your home network.</p>



<p><img src="https://kpkaiser.s3-us-west-2.amazonaws.com/react-native-christmas1.png" alt="React Native Christmas Lights"></p>

<p>The <a href="https://amzn.to/3hezYGq">Jetson Nano</a> is my favorite platforms for building localized internet of things projects.</p>

<p>It’s an ARM64 device, with four built in USB ports, and was designed to do machine learning at the edge.</p>

<p>We’ll use it as a server for a <a href="https://amzn.to/3pmSe3c">Z-Wave USB Stick</a>. Z-Wave is a protocol that exists to do home automation. Importantly for us, it operates separately from your WiFi.</p>

<p>In my case, I’ve hooked it up to 2 <a href="https://amzn.to/3hgyxHt">outdoor light switches</a>, to turn on and off my Christmas lights.</p>

<p>The light switches come in a waterproof shielding, with a single manual button on them. You can press the button to enable pair mode, and also to manually turn the lights on and off.</p>

<p>Finally, there’s the React Native app running on my iPhone.</p>

<p>Normally, I wouldn’t attempt to build an iPhone app for such a small project.</p>

<p>But <a href="https://expo.io/">Expo</a> has made running code on your phone a great experience. They automatically build and push to your phone via an app and the command line.</p>

<h2 id="building-an-api-for-your-christmas-lights">Building an API for Your Christmas Lights</h2>

<p>The first thing we’ll want to do is check to make sure we’ve got the Z-Wave stick installed and running on our USB drive in the Jetson Nano.</p>

<p>Every time I work with Z-Wave, I forget details of how the Z-Wave network model works. Because of this, I like to open up an IPython session, and start playing around with the network:</p>

<div><div><pre><code><span>import</span> <span>openzwave</span>
<span>from</span> <span>openzwave.option</span> <span>import</span> <span>ZWaveOption</span>
<span>from</span> <span>openzwave.network</span> <span>import</span> <span>ZWaveNetwork</span>

<span># make sure these Z-wave commands get flushed with a time.sleep</span>
<span># also, /dev/ttyACM0 is the name of my USB port for the Z-Stick</span>

<span>options</span> <span>=</span> <span>ZWaveOption</span><span>(</span><span>'/dev/ttyACM0'</span><span>)</span>
<span>options</span><span>.</span><span>lock</span><span>()</span>

<span>network</span> <span>=</span> <span>ZWaveNetwork</span><span>(</span><span>options</span><span>)</span>

<span># the next two lines start an IPython session in line</span>
<span>import</span> <span>IPython</span>
<span>IPython</span><span>.</span><span>embed</span><span>()</span>
</code></pre></div></div>

<p>From here, I start to remember how things work, and see that <code>list(network.nodes.keys())</code> gives me a list of the <code>nodes</code> connected to the Z-Wave network. Because I’m in IPython, I can also tab through each object to see the functions available.</p>

<p>But how do you know what capabilities each Z-Wave node has?</p>

<p>Some Z-Wave devices have multiple switches built into them, each potentially with their own dimmer. To grab switches, we need to do a <code>list(network.nodes[node].get_switches.keys())</code>.</p>

<p>Putting it all together, we can then set state on each node with a <code>set_switch</code> function call:</p>

<div><div><pre><code><span>node_list</span> <span>=</span> <span>list</span><span>(</span><span>network</span><span>.</span><span>nodes</span><span>.</span><span>keys</span><span>())</span>
<span>for</span> <span>node</span> <span>in</span> <span>node_list</span><span>:</span>
    <span>switches</span> <span>=</span> <span>list</span><span>(</span><span>network</span><span>.</span><span>nodes</span><span>[</span><span>node</span><span>]</span><span>.</span><span>get_switches</span><span>()</span><span>.</span><span>keys</span><span>())</span>
    <span>if</span> <span>switches</span><span>:</span>
        <span>if</span> <span>change</span><span>[</span><span>'state'</span><span>]</span> <span>==</span> <span>'ON'</span><span>:</span>
            <span>network</span><span>.</span><span>nodes</span><span>[</span><span>node</span><span>]</span><span>.</span><span>set_switch</span><span>(</span><span>switches</span><span>[</span><span>0</span><span>],</span> <span>True</span><span>)</span>
        <span>else</span><span>:</span>
            <span>network</span><span>.</span><span>nodes</span><span>[</span><span>node</span><span>]</span><span>.</span><span>set_switch</span><span>(</span><span>switches</span><span>[</span><span>0</span><span>],</span> <span>False</span><span>)</span>
</code></pre></div></div>

<p>Now that I know how to effect change, I can build an API in Flask to serve up changes:</p>

<div><div><pre><code><span>@app.route</span><span>(</span><span>'/state'</span><span>,</span> <span>methods</span><span>=</span><span>[</span><span>'GET'</span><span>,</span> <span>'POST'</span><span>])</span>
<span>def</span> <span>get_state</span><span>():</span>
    <span>if</span> <span>request</span><span>.</span><span>method</span> <span>==</span> <span>'GET'</span><span>:</span>
        <span>node_list</span> <span>=</span> <span>list</span><span>(</span><span>network</span><span>.</span><span>nodes</span><span>.</span><span>keys</span><span>())</span>
        <span>ON</span> <span>=</span> <span>False</span>
        <span>for</span> <span>node</span> <span>in</span> <span>node_list</span><span>:</span>
            <span>switches</span> <span>=</span> <span>list</span><span>(</span><span>network</span><span>.</span><span>nodes</span><span>[</span><span>node</span><span>]</span><span>.</span><span>get_switches</span><span>()</span><span>.</span><span>keys</span><span>())</span>
            <span>if</span> <span>switches</span><span>:</span>
                <span>state</span> <span>=</span> <span>network</span><span>.</span><span>nodes</span><span>[</span><span>node</span><span>]</span><span>.</span><span>get_switch_state</span><span>(</span><span>switches</span><span>[</span><span>0</span><span>])</span>
                <span>if</span> <span>state</span><span>:</span>
                    <span>ON</span> <span>=</span> <span>True</span>
                    <span>continue</span>
        <span>if</span> <span>ON</span><span>:</span>
            <span>return</span> <span>jsonify</span><span>({</span><span>'state'</span><span>:</span> <span>'ON'</span><span>})</span>

        <span>return</span> <span>jsonify</span><span>({</span><span>'state'</span><span>:</span> <span>'OFF'</span><span>})</span>
    
    <span>change</span> <span>=</span> <span>request</span><span>.</span><span>json</span>

    <span>node_list</span> <span>=</span> <span>list</span><span>(</span><span>network</span><span>.</span><span>nodes</span><span>.</span><span>keys</span><span>())</span>
    <span>for</span> <span>node</span> <span>in</span> <span>node_list</span><span>:</span>
        <span>switches</span> <span>=</span> <span>list</span><span>(</span><span>network</span><span>.</span><span>nodes</span><span>[</span><span>node</span><span>]</span><span>.</span><span>get_switches</span><span>()</span><span>.</span><span>keys</span><span>())</span>
        <span>if</span> <span>switches</span><span>:</span>
            <span>if</span> <span>change</span><span>[</span><span>'state'</span><span>]</span> <span>==</span> <span>'ON'</span><span>:</span>
                <span>network</span><span>.</span><span>nodes</span><span>[</span><span>node</span><span>]</span><span>.</span><span>set_switch</span><span>(</span><span>switches</span><span>[</span><span>0</span><span>],</span> <span>True</span><span>)</span>
            <span>else</span><span>:</span>
                <span>network</span><span>.</span><span>nodes</span><span>[</span><span>node</span><span>]</span><span>.</span><span>set_switch</span><span>(</span><span>switches</span><span>[</span><span>0</span><span>],</span> <span>False</span><span>)</span>
    <span>time</span><span>.</span><span>sleep</span><span>(</span><span>2</span><span>)</span>
    <span>return</span> <span>jsonify</span><span>(</span><span>change</span><span>)</span>
</code></pre></div></div>

<p>I’ve added a <code>time.sleep</code>, because it can take a bit for the Z-Wave network to propagate state. Two seconds is probably too long to sleep for, but hey, it works, and I’m not in a hurry.</p>

<h2 id="building-a-react-native-app-with-expo">Building a React Native App with Expo</h2>

<p>Again, building an app is usually too much work for such a small project. But it had been a while since I’d built an app, and I kept hearing about React Native, so I decided to give it a go.</p>

<p>I was surprised to be able to have a built version of my app on my phone in under an hour. There’s a new platform called Expo, which handles all of the heavy lifting usually associated with deploying an iPhone app.</p>

<p>Indeed, because my “app” was so small (literally a single button and a single state of <code>ON</code> or <code>OFF</code>), I really didn’t have much to do beyond the basic, example app:</p>

<div><div><pre><code><span>import</span> <span>React</span><span>,</span> <span>{</span><span>useState</span><span>,</span> <span>useEffect</span> <span>}</span> <span>from</span> <span>'react'</span><span>;</span>
<span>import</span> <span>{</span> <span>StyleSheet</span><span>,</span> <span>Text</span><span>,</span> <span>View</span><span>,</span> <span>Button</span><span>,</span> <span>Alert</span> <span>}</span> <span>from</span> <span>'react-native'</span><span>;</span>

<span>export</span> <span>default</span> <span>function</span> <span>App</span><span>()</span> <span>{</span>
  <span>const</span> <span>[</span><span>currentState</span><span>,</span> <span>setCurrentState</span><span>]</span> <span>=</span> <span>useState</span><span>(</span><span>0</span><span>);</span>

  <span>const</span> <span>handlePress</span> <span>=</span> <span>e</span> <span>=&gt;</span> <span>{</span>
    <span>const</span> <span>newState</span> <span>=</span> <span>(</span><span>currentState</span> <span>==</span> <span>'ON'</span><span>)</span> <span>?</span> <span>'OFF'</span> <span>:</span> <span>'ON'</span>
    <span>const</span> <span>data</span> <span>=</span> <span>{</span><span>'state'</span><span>:</span> <span>newState</span><span>}</span>

    <span>const</span> <span>requestOptions</span> <span>=</span> <span>{</span>
      <span>method</span><span>:</span> <span>"POST"</span><span>,</span>
      <span>headers</span><span>:</span> <span>{</span> <span>"Content-Type"</span><span>:</span> <span>"application/json"</span> <span>},</span>
      <span>body</span><span>:</span> <span>JSON</span><span>.</span><span>stringify</span><span>(</span><span>data</span><span>)</span>
    <span>}</span>
    <span>fetch</span><span>(</span><span>'http://192.168.1.44:8050/state'</span><span>,</span> <span>requestOptions</span><span>)</span>
      <span>.</span><span>then</span><span>(</span><span>response</span> <span>=&gt;</span> <span>response</span><span>.</span><span>json</span><span>())</span>
      <span>.</span><span>then</span><span>(</span><span>res</span> <span>=&gt;</span> <span>setCurrentState</span><span>(</span><span>res</span><span>.</span><span>state</span><span>))</span>
  <span>}</span>

  <span>useEffect</span><span>(()</span> <span>=&gt;</span> <span>{</span>
    <span>fetch</span><span>(</span><span>'http://192.168.1.44:8050/state'</span><span>).</span><span>then</span><span>(</span><span>res</span> <span>=&gt;</span> <span>res</span><span>.</span><span>json</span><span>()).</span><span>then</span><span>(</span><span>data</span> <span>=&gt;</span> <span>{</span>
      <span>setCurrentState</span><span>(</span><span>data</span><span>.</span><span>state</span><span>);</span>
    <span>})</span>
  <span>},</span> <span>[]);</span>

  <span>return</span> <span>(</span>
    <span>&lt;</span><span>View</span> <span>style</span><span>=</span><span>{</span><span>styles</span><span>.</span><span>container</span><span>}</span><span>&gt;</span>
      <span>&lt;</span><span>Text</span><span>&gt;</span><span>Lights</span> <span>are</span> <span>currently</span> <span>{</span><span>currentState</span><span>}</span> <span>&lt;</span><span>/Text</span><span>&gt;
</span>      <span>&lt;</span><span>Button</span> <span>title</span><span>=</span><span>"Toggle Lights"</span> <span>onPress</span><span>=</span><span>{</span><span>handlePress</span><span>}</span> <span>/</span><span>&gt;
</span>    <span>&lt;</span><span>/View</span><span>&gt;
</span>  <span>);</span>
<span>}</span>

<span>const</span> <span>styles</span> <span>=</span> <span>StyleSheet</span><span>.</span><span>create</span><span>({</span>
  <span>container</span><span>:</span> <span>{</span>
    <span>flex</span><span>:</span> <span>1</span><span>,</span>
    <span>backgroundColor</span><span>:</span> <span>'#fff'</span><span>,</span>
    <span>alignItems</span><span>:</span> <span>'center'</span><span>,</span>
    <span>justifyContent</span><span>:</span> <span>'center'</span><span>,</span>
  <span>},</span>
<span>});</span>
</code></pre></div></div>

<p>Here, you can see the call to my Flask app’s API, on my local area network. I’ve set a static IP address for my Jetson Nano, and am running a Flask server on a non-standard port, <code>8050</code>. I did this because I have other Flask apps running on my Nano.</p>

<p>When the app is opened, a <code>GET</code> request is made to the <code>/state</code> resource. It returns a JSON object, with the current state of the Z-Wave switches. If one is on, the network is considered <code>ON</code>.</p>

<p>From here, we can press a single button, to flip the state. This makes a <code>POST</code> request to the <code>/state</code> resource, with the desired new state.</p>

<p>I can build the app from my terminal to the Expo App on my phone via an <code>expo build:ios</code>. Once that’s done, I can open up the Expo app and control my Christmas lights.</p>

<p>Mission Accomplished!</p>

<h2 id="alright-im-sold-wheres-the-code">Alright I’m sold, where’s the code?</h2>

<p><img src="https://makeartwithpython.s3-us-west-2.amazonaws.com/christmas-lights.gif" alt="Pressing the button"></p>

<p>All of the code is open source, and lives on <a href="https://github.com/burningion/minimum-viable-christmas-lights">Github</a>. I didn’t mention it, but there’s also a view in the Flask app you can visit in the browser to control the lights too. You can see it at the <code>/</code> url.</p>

<p>I encourage you to make your app look better than mine, and share the results.</p>

<p>Happy holidays!</p>

        
      </section>

      

      


      
  

    </div></div>]]>
            </description>
            <link>https://www.makeartwithpython.com/blog/minimum-viable-christmas-lights/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25528794</guid>
            <pubDate>Thu, 24 Dec 2020 16:19:39 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[In CPython, types implemented in C are part of the type tree]]>
            </title>
            <description>
<![CDATA[
Score 106 | Comments 96 (<a href="https://news.ycombinator.com/item?id=25528557">thread link</a>) | @todsacerdoti
<br/>
December 24, 2020 | https://utcc.utoronto.ca/~cks/space/blog/python/CPythonCTypesHaveTree | <a href="https://web.archive.org/web/*/https://utcc.utoronto.ca/~cks/space/blog/python/CPythonCTypesHaveTree">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><h2>In CPython, types implemented in C actually are part of the type tree</h2>

	<p><small>December 24, 2020</small></p>
</div><div><p>In Python, in theory all types descend from <code>object</code> (they are
direct or indirect subclasses of it). For years, I've believed (and
written) that this was not the case at the implementation level for
types written in native C code in CPython (the standard implementation
of Python and the one you're probably using). Types written in C
might behave as if they descended from <code>object</code>, but I thought their
behavior was actually entirely stand-alone, implemented by each
type separately in C. Courtesy of <a href="https://tenthousandmeters.com/blog/python-behind-the-scenes-6-how-python-object-system-works/">Python behind the scenes #6:
how Python object system works</a>,
I've discovered that I'm wrong.</p>

<p>In CPython, C level Python types are not literally subclasses of
the C level version of <code>object</code>, because of course C doesn't have
classes and subclasses in that sense. Instead, you usually describe
your type by defining a <a href="https://docs.python.org/3/c-api/typeobj.html"><code>PyTypeObject</code></a> struct for it, with
all sorts of fields that you fill in or don't fill in as you need
them, including a <a href="https://docs.python.org/3/c-api/typeobj.html#c.PyTypeObject.tp_base"><code>tp_base</code></a> field
for your base type (if you want more than one base type, you need
to take the alternate path of a <a href="https://docs.python.org/3/c-api/typeobj.html#heap-types">heap type</a>). When
CPython needs to execute special methods or other operations on
your type, it will directly use fields on your <code>PyTypeObject</code>
structure (and as far as I know, it only uses those fields, with
no fallbacks). On the surface, this looks like the <code>tp_base</code> field
is essentially decorative and is only used to report your claimed
<code>__base__</code> if people ask.</p>

<p>However, there is a bit of CPython magic hiding behind the scenes.
In order to actually use a <code>PyTypeObject</code> as a type, you must
register it and make it ready by calling <a href="https://docs.python.org/3/c-api/type.html#c.PyType_Ready"><code>PyType_Ready</code></a>. As part
of this, <code>PyType_Ready</code> will use your type's <code>tp_base</code> to fill
in various fields of your <code>PyTypeObject</code> if you didn't already do
that, which effectively means that your C level type will inherit
those fields from its base type (and so on all the way up to
<code>object</code>). This is outlined in <a href="https://docs.python.org/3/c-api/typeobj.html#cols">a section of the C API</a>, but of course
I never read the C API myself because I never needed to use it.
The <a href="https://tenthousandmeters.com/blog/python-behind-the-scenes-6-how-python-object-system-works/">how [the] Python object system works</a>
article has more details on how this works, if you're curious, along
with details on how special methods also work (which is more
interesting than I had any idea, and I've looked at this area
before).</p>

<p>(The distinction between what is considered a 'type' and what is
considered a 'class' by <code>repr()</code> is somewhat arbitrary; see the
sidebar <a href="https://utcc.utoronto.ca/~cks/space/blog/python/ClassesAndTypes">here</a>. C level things defined with
<code>PyTypeObject</code> will probably always be considered types instead of
classes.)</p>
</div></div>]]>
            </description>
            <link>https://utcc.utoronto.ca/~cks/space/blog/python/CPythonCTypesHaveTree</link>
            <guid isPermaLink="false">hacker-news-small-sites-25528557</guid>
            <pubDate>Thu, 24 Dec 2020 15:54:18 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Oklab: A perceptual color space for image processing]]>
            </title>
            <description>
<![CDATA[
Score 228 | Comments 82 (<a href="https://news.ycombinator.com/item?id=25525726">thread link</a>) | @ingve
<br/>
December 23, 2020 | https://bottosson.github.io/posts/oklab/ | <a href="https://web.archive.org/web/*/https://bottosson.github.io/posts/oklab/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><article><div><p>A perceptual color space is desirable when doing many kinds of image processing. It is useful for things like:</p><ul><li>Turning an image grayscale, while keeping the perceived lightness the same</li><li>Increasing the saturation of colors, while maintaining perceived hue and lightness</li><li>Creating smooth and uniform looking transitions between colors</li></ul><p>Unfortunately, as far as I am aware, while there are color spaces that aim to be perceptually uniform, none are without significant drawbacks when used for image processing.</p><p>For this reason I have designed a new perceptual color space, designed to be simple to use, while doing a good job at predicting perceived lightness, <a href="https://en.wikipedia.org/wiki/Colorfulness">chroma</a> and hue. It is called the <strong>Oklab color space</strong>, because it is an OK Lab color space.</p><p>Before diving into the details of why a new color space is needed and how it was derived, here is the everything needed to use the color space:</p><p>A color in Oklab is represented with three coordinates, similar to how <a href="https://en.wikipedia.org/wiki/CIELAB_color_space">CIELAB</a> works, but with better perceptual properties. Oklab uses a D65 whitepoint, since this is what sRGB and other common color spaces use. The three coordinates are:</p><ul><li><span><span><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span></span> – perceived lightness</li><li><span><span><math><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span></span> – how green/red the color is</li><li><span><span><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span></span> – how blue/yellow the color is</li></ul><p>For many operations, <span><span><math><semantics><mrow><mi>L</mi><mi>a</mi><mi>b</mi></mrow><annotation encoding="application/x-tex">Lab</annotation></semantics></math></span></span>-coordinates can be used directly, but they can also be transformed into polar form, with the coordinates lightness, chroma and hue, <span><span><math><semantics><mrow><mi>L</mi><mi>C</mi><mi>h</mi></mrow><annotation encoding="application/x-tex">LCh</annotation></semantics></math></span></span>:</p><p><span><span><span><math><semantics><mrow><mi>C</mi><mo>=</mo><mrow><msqrt><mrow><msup><mi>a</mi><mn>2</mn></msup><mo>+</mo><msup><mi>b</mi><mn>2</mn></msup></mrow></msqrt></mrow><mo separator="true">,</mo><mspace width="2em"></mspace><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>=</mo><mtext><mi mathvariant="normal">a</mi><mi mathvariant="normal">t</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">n</mi><mn>2</mn></mtext><mo>(</mo><mi>b</mi><mo separator="true">,</mo><mi>a</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">C={\sqrt {a^2+b^2}}, \qquad h^{\circ}=\text{atan2}(b,a)</annotation></semantics></math></span></span></span></p><p>From <span><span><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span></span> and <span><span><math><semantics><mrow><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup></mrow><annotation encoding="application/x-tex">h^{\circ}</annotation></semantics></math></span></span>, <span><span><math><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span></span> and <span><span><math><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span></span> can be computed like this:</p><p><span><span><span><math><semantics><mrow><mi>a</mi><mo>=</mo><mi>C</mi><mi>cos</mi><mo>(</mo><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>)</mo><mo separator="true">,</mo><mspace width="2em"></mspace><mi>b</mi><mo>=</mo><mi>C</mi><mi>sin</mi><mo>(</mo><msup><mi>h</mi><mrow><mo>∘</mo></mrow></msup><mo>)</mo></mrow><annotation encoding="application/x-tex">a=C\cos(h^{\circ}),\qquad b=C\sin(h^{\circ})</annotation></semantics></math></span></span></span></p><p>Lets look at a practical example to see how Oklab performs, before looking at how the <span><span><math><semantics><mrow><mi>L</mi><mi>a</mi><mi>b</mi></mrow><annotation encoding="application/x-tex">Lab</annotation></semantics></math></span></span> coordinates are computed.</p><blockquote><h4 id="comparing-oklab-to-hsv">Comparing Oklab to HSV <a href="#comparing-oklab-to-hsv"><span><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h4><p>Here’s an Oklab color gradient with varying hue and constant lightness and chroma.</p><p><img alt="Oklab varying hue plot" decoding="async" height="169" loading="lazy" src="https://bottosson.github.io/img/oklab/hue_oklab.png" width="1130"></p><p>Compare this to a similar plot of a HSV color gradient with varying hue and constant value and saturation (HSV using the sRGB color space).</p><p><img alt="HSV varying hue plot" decoding="async" height="169" loading="lazy" src="https://bottosson.github.io/img/oklab/hue_hsv.png" width="1130"></p><p>The gradient is quite uneven and there are clear differences in lightness for different hues. Yellow, magenta and cyan appear much lighter than red and blue.</p><p>Here is lightness of the HSV plot, as predicted by Oklab:</p><p><img alt="HSV varying hue plot lightness" decoding="async" height="169" loading="lazy" src="https://bottosson.github.io/img/oklab/hue_hsv_lightness.png" width="1130"></p></blockquote><h3 id="implementation">Implementation <a href="#implementation"><span><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h3><h4 id="converting-from-xyz-to-oklab">Converting from XYZ to Oklab <a href="#converting-from-xyz-to-oklab"><span><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h4><p>Given a color in <span><span><math><semantics><mrow><mi>X</mi><mi>Y</mi><mi>Z</mi></mrow><annotation encoding="application/x-tex">XYZ</annotation></semantics></math></span></span> coordinates, with a D65 whitepoint, Oklab coordinates can be computed like this:</p><p>First the <span><span><math><semantics><mrow><mi>X</mi><mi>Y</mi><mi>Z</mi></mrow><annotation encoding="application/x-tex">XYZ</annotation></semantics></math></span></span> coordinates are converted to an approximate cone responses:</p><p><span><span><span><math><semantics><mrow><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mi>l</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>m</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>s</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">1</mn></msub></mrow><mo>×</mo><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mi>X</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>Y</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>Z</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{pmatrix} l \\ m \\ s \end{pmatrix} = \mathbf{M_1} \times \begin{pmatrix} X \\ Y \\ Z \end{pmatrix}</annotation></semantics></math></span></span></span></p><p>A non-linearity is applied:</p><p><span><span><span><math><semantics><mrow><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><msup><mi>l</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>m</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>s</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><msup><mi>l</mi><mrow><mfrac><mn>1</mn><mn>3</mn></mfrac></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>m</mi><mrow><mfrac><mn>1</mn><mn>3</mn></mfrac></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>s</mi><mrow><mfrac><mn>1</mn><mn>3</mn></mfrac></mrow></msup></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{pmatrix} l' \\ m' \\ s' \end{pmatrix} = \begin{pmatrix} l^{\frac 1 3} \\ m^{\frac 1 3} \\ s^{\frac 1 3} \end{pmatrix}</annotation></semantics></math></span></span></span></p><p>Finally, this is transformed into the <span><span><math><semantics><mrow><mi>L</mi><mi>a</mi><mi>b</mi></mrow><annotation encoding="application/x-tex">Lab</annotation></semantics></math></span></span>-coordinates:</p><p><span><span><span><math><semantics><mrow><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mi>L</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>a</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>b</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">2</mn></msub></mrow><mo>×</mo><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><msup><mi>l</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>m</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>s</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{pmatrix} L \\ a \\ b \end{pmatrix} = \mathbf{M_2} \times \begin{pmatrix} l' \\ m' \\ s' \end{pmatrix}</annotation></semantics></math></span></span></span></p><p>with the following values for <span><span><math><semantics><mrow><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">1</mn></msub></mrow></mrow><annotation encoding="application/x-tex">\mathbf{M_1}</annotation></semantics></math></span></span> and <span><span><math><semantics><mrow><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">2</mn></msub></mrow></mrow><annotation encoding="application/x-tex">\mathbf{M_2}</annotation></semantics></math></span></span>:</p><p><span><span><span><math><semantics><mrow><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">1</mn></msub></mrow><mo>=</mo><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>8</mn><mn>1</mn><mn>8</mn><mn>9</mn><mn>3</mn><mn>3</mn><mn>0</mn><mn>1</mn><mn>0</mn><mn>1</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>3</mn><mn>6</mn><mn>1</mn><mn>8</mn><mn>6</mn><mn>6</mn><mn>7</mn><mn>4</mn><mn>2</mn><mn>4</mn></mrow></mtd><mtd><mrow><mo>−</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>1</mn><mn>2</mn><mn>8</mn><mn>8</mn><mn>5</mn><mn>9</mn><mn>7</mn><mn>1</mn><mn>3</mn><mn>7</mn></mrow></mtd></mtr><mtr><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>0</mn><mn>3</mn><mn>2</mn><mn>9</mn><mn>8</mn><mn>4</mn><mn>5</mn><mn>4</mn><mn>3</mn><mn>6</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>9</mn><mn>2</mn><mn>9</mn><mn>3</mn><mn>1</mn><mn>1</mn><mn>8</mn><mn>7</mn><mn>1</mn><mn>5</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>0</mn><mn>3</mn><mn>6</mn><mn>1</mn><mn>4</mn><mn>5</mn><mn>6</mn><mn>3</mn><mn>8</mn><mn>7</mn></mrow></mtd></mtr><mtr><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>0</mn><mn>4</mn><mn>8</mn><mn>2</mn><mn>0</mn><mn>0</mn><mn>3</mn><mn>0</mn><mn>1</mn><mn>8</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>2</mn><mn>6</mn><mn>4</mn><mn>3</mn><mn>6</mn><mn>6</mn><mn>2</mn><mn>6</mn><mn>9</mn><mn>1</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>6</mn><mn>3</mn><mn>3</mn><mn>8</mn><mn>5</mn><mn>1</mn><mn>7</mn><mn>0</mn><mn>7</mn><mn>0</mn></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{M_1} = \begin{pmatrix} +0.8189330101 &amp; +0.3618667424 &amp; -0.1288597137 \\ +0.0329845436 &amp; +0.9293118715 &amp; +0.0361456387 \\ +0.0482003018 &amp; +0.2643662691 &amp; +0.6338517070 \end{pmatrix}</annotation></semantics></math></span></span></span></p><p><span><span><span><math><semantics><mrow><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">2</mn></msub></mrow><mo>=</mo><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>2</mn><mn>1</mn><mn>0</mn><mn>4</mn><mn>5</mn><mn>4</mn><mn>2</mn><mn>5</mn><mn>5</mn><mn>3</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>7</mn><mn>9</mn><mn>3</mn><mn>6</mn><mn>1</mn><mn>7</mn><mn>7</mn><mn>8</mn><mn>5</mn><mn>0</mn></mrow></mtd><mtd><mrow><mo>−</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>0</mn><mn>0</mn><mn>4</mn><mn>0</mn><mn>7</mn><mn>2</mn><mn>0</mn><mn>4</mn><mn>6</mn><mn>8</mn></mrow></mtd></mtr><mtr><mtd><mrow><mo>+</mo><mn>1</mn><mi mathvariant="normal">.</mi><mn>9</mn><mn>7</mn><mn>7</mn><mn>9</mn><mn>9</mn><mn>8</mn><mn>4</mn><mn>9</mn><mn>5</mn><mn>1</mn></mrow></mtd><mtd><mrow><mo>−</mo><mn>2</mn><mi mathvariant="normal">.</mi><mn>4</mn><mn>2</mn><mn>8</mn><mn>5</mn><mn>9</mn><mn>2</mn><mn>2</mn><mn>0</mn><mn>5</mn><mn>0</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>4</mn><mn>5</mn><mn>0</mn><mn>5</mn><mn>9</mn><mn>3</mn><mn>7</mn><mn>0</mn><mn>9</mn><mn>9</mn></mrow></mtd></mtr><mtr><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>0</mn><mn>2</mn><mn>5</mn><mn>9</mn><mn>0</mn><mn>4</mn><mn>0</mn><mn>3</mn><mn>7</mn><mn>1</mn></mrow></mtd><mtd><mrow><mo>+</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>7</mn><mn>8</mn><mn>2</mn><mn>7</mn><mn>7</mn><mn>1</mn><mn>7</mn><mn>6</mn><mn>6</mn><mn>2</mn></mrow></mtd><mtd><mrow><mo>−</mo><mn>0</mn><mi mathvariant="normal">.</mi><mn>8</mn><mn>0</mn><mn>8</mn><mn>6</mn><mn>7</mn><mn>5</mn><mn>7</mn><mn>6</mn><mn>6</mn><mn>0</mn></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbf{M_2} = \begin{pmatrix} +0.2104542553 &amp; +0.7936177850 &amp; -0.0040720468 \\ +1.9779984951 &amp; -2.4285922050 &amp; +0.4505937099 \\ +0.0259040371 &amp; +0.7827717662 &amp; -0.8086757660 \end{pmatrix}</annotation></semantics></math></span></span></span></p><p>The inverse operation, going from Oklab to XYZ is done with the following steps:</p><p><span><span><span><math><semantics><mrow><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><msup><mi>l</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>m</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>s</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><msup><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">2</mn></msub></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>×</mo><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mi>L</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>a</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>b</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo separator="true">,</mo><mspace width="2em"></mspace><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mi>l</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>m</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>s</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><msup><mrow><mo>(</mo><msup><mi>l</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup><mo>)</mo></mrow><mrow><mn>3</mn></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mrow><mo>(</mo><msup><mi>m</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup><mo>)</mo></mrow><mrow><mn>3</mn></mrow></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mrow><mo>(</mo><msup><mi>s</mi><mrow><mi mathvariant="normal">′</mi></mrow></msup><mo>)</mo></mrow><mrow><mn>3</mn></mrow></msup></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo separator="true">,</mo><mspace width="2em"></mspace><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mi>X</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>Y</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>Z</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><msup><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">1</mn></msub></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>×</mo><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mi>l</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>m</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>s</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{pmatrix} l' \\ m' \\ s' \end{pmatrix} = \mathbf{M_2}^{-1} \times \begin{pmatrix} L \\ a \\ b \end{pmatrix},\qquad \begin{pmatrix} l \\ m \\ s \end{pmatrix} = \begin{pmatrix} {(l')}^{3} \\ {(m')}^{3} \\ {(s')}^{3} \end{pmatrix},\qquad \begin{pmatrix} X \\ Y \\ Z \end{pmatrix} = \mathbf{M_1}^{-1} \times \begin{pmatrix} l \\ m \\ s \end{pmatrix}</annotation></semantics></math></span></span></span></p><h4 id="converting-from-linear-srgb-to-oklab">Converting from linear sRGB to Oklab <a href="#converting-from-linear-srgb-to-oklab"><span><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h4><p>Since this will be a common use case, here is the code to convert linear sRGB values to Oklab and back. To compute linear sRGB values, see <a href="https://bottosson.github.io/posts/colorwrong/#what-can-we-do%3F">my previous post</a>.</p><p>The code is in C++, but without any fancy features so should be easy to translate. The code is available in public domain, feel free to use it any way you please.</p><pre><code>struct Lab {float L; float a; float b;};
struct RGB {float r; float g; float b;};

Lab linear_srgb_to_oklab(RGB c) 
{
    float l = 0.4121656120f * c.r + 0.5362752080f * c.g + 0.0514575653f * c.b;
    float m = 0.2118591070f * c.r + 0.6807189584f * c.g + 0.1074065790f * c.b;
    float s = 0.0883097947f * c.r + 0.2818474174f * c.g + 0.6302613616f * c.b;

    float l_ = cbrtf(l);
    float m_ = cbrtf(m);
    float s_ = cbrtf(s);

    return {
        0.2104542553f*l_ + 0.7936177850f*m_ - 0.0040720468f*s_,
        1.9779984951f*l_ - 2.4285922050f*m_ + 0.4505937099f*s_,
        0.0259040371f*l_ + 0.7827717662f*m_ - 0.8086757660f*s_,
    };
}

RGB oklab_to_linear_srgb(Lab c) 
{
    float l_ = c.L + 0.3963377774f * c.a + 0.2158037573f * c.b;
    float m_ = c.L - 0.1055613458f * c.a - 0.0638541728f * c.b;
    float s_ = c.L - 0.0894841775f * c.a - 1.2914855480f * c.b;

    float l = l_*l_*l_;
    float m = m_*m_*m_;
    float s = s_*s_*s_;

    return {
        + 4.0767245293f*l - 3.3072168827f*m + 0.2307590544f*s,
        - 1.2681437731f*l + 2.6093323231f*m - 0.3411344290f*s,
        - 0.0041119885f*l - 0.7034763098f*m + 1.7068625689f*s,
    };
}
</code></pre><p>This is everything you need to use the Oklab color space! If you need a simple perceptual color space, try it out.</p><p>The rest of the post will go into why a new color space was needed, how it has been constructed and how it compares with existing color spaces.</p><hr><p>What properties does a perceptual color space need to satisfy to be useful for image processing? The answer to this is always going to be a bit subjective, but based on my experience, these are a good set of requirements:</p><blockquote><ul><li><strong>Should be an opponent color space</strong>, similar to for example <a href="https://en.wikipedia.org/wiki/CIELAB_color_space">CIELAB</a>.</li><li><strong>Should predict lightness, chroma and hue well</strong>. <span><span><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span></span>, <span><span><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span></span> and <span><span><math><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span></span> should be perceived as orthogonal, so one can be altered without affecting the other two. This is useful for things like turning an image black and white and increasing colorfulness without introducing hue shifts etc.</li><li><strong>Blending two colors should result in even transitions</strong>. The transition colors should appear to be in between the blended colors (e.g. passing through a warmer color than either original color is not good).</li><li><strong>Should assume a D65 whitepoint</strong>. This is what common color spaces like sRGB, rec2020 and Display P3 uses.</li><li><strong>Should behave well numerically</strong>. The model should be easy to compute, numerically stable and differentiable.</li><li><strong>Should assume normal well lit viewing conditions</strong>. The complexity of supporting different viewing conditions is not practical in most applications. Other models could be used in conjunction if this is needed in some case.</li><li><strong>If the scale/exposure of colors are changed, the perceptual coordinates should just be scaled by a factor</strong>. More complex models that depend on absolute luminance should be avoided since the viewing conditions can not be accurately controlled and incorrect behavior would be confusing.</li></ul></blockquote><h3 id="what-about-existing-models%3F">What about existing models? <a href="#what-about-existing-models%3F"><span><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h3><p>Let’s look at existing models and how they stack up against these requirements. Further down there are graphs that illustrate some of these issues.</p><blockquote><ul><li><strong><a href="https://en.wikipedia.org/wiki/CIELAB_color_space">CIELAB</a> and <a href="https://en.wikipedia.org/wiki/CIELUV">CIELUV</a></strong> – Largest issue is their inability to predict hue. In particular blue hues are predicted badly. Other smaller issues exist as well</li><li><strong><a href="https://en.wikipedia.org/wiki/CIECAM02">CIECAM02-UCS</a> and the newer CAM16-UCS</strong> – Does a good job at being perceptually uniform overall, but doesn’t meet other requirements: Bad numerical behavior, it is not scale invariant and blending does not behave well because of its compression of chroma. Hue uniformity is decent, but other models predict it more accurately.</li><li><strong><a href="https://en.wikipedia.org/wiki/OSA-UCS">OSA-UCS</a></strong> – Overall does a good job. The transformation to OSA-UCS lacks an analytical inverse unfortunately which makes it impractical.</li><li><strong><a href="https://scholarworks.rit.edu/theses/2858/">IPT</a></strong> – Does a great job modelling hue uniformity. Doesn’t predict lightness and chroma well unfortunately, but meets all other requirements. Is simple computationally and does not depend on the scale/exposure.</li><li><strong><a href="https://www.osapublishing.org/oe/fulltext.cfm?uri=oe-25-13-15131&amp;id=368272">JzAzBz</a></strong> – Overall does a fairly good job. Designed to have uniform scaling of lightness for HDR data. While useful in some cases this introduces a dependence on the scale/exposure that makes it hard to use in general cases.</li><li><strong><a href="https://en.wikipedia.org/wiki/HSL_and_HSV">HSV</a> representation of sRGB</strong> – Only on this list because it is widely used. Does not meet any of the requirements except having a D65 whitepoint.</li></ul></blockquote><p>So, all in all, all these existing models have drawbacks.</p><p>Out of all of these, two models stand out: CAM16-UCS, for being the model with best properties of perceptual uniformity overall, and IPT for having a simple computational structure that meets all the requirements besides predicting lightness and chroma well.</p><p>For this reason it is reasonable to try to make a new color space, with the same computational structure as IPT, but that performs closer to CAM16-UCS in terms of predicting lightness and chroma. This exploration resulted in Oklab.</p><h3 id="how-oklab-was-derived">How Oklab was derived <a href="#how-oklab-was-derived"><span><svg viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 512 512" version="1.1" xml:space="preserve" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M459.654,233.373l-90.531,90.5c-49.969,50-131.031,50-181,0c-7.875-7.844-14.031-16.688-19.438-25.813  l42.063-42.063c2-2.016,4.469-3.172,6.828-4.531c2.906,9.938,7.984,19.344,15.797,27.156c24.953,24.969,65.563,24.938,90.5,0  l90.5-90.5c24.969-24.969,24.969-65.563,0-90.516c-24.938-24.953-65.531-24.953-90.5,0l-32.188,32.219  c-26.109-10.172-54.25-12.906-81.641-8.891l68.578-68.578c50-49.984,131.031-49.984,181.031,0  C509.623,102.342,509.623,183.389,459.654,233.373z M220.326,382.186l-32.203,32.219c-24.953,24.938-65.563,24.938-90.516,0  c-24.953-24.969-24.953-65.563,0-90.531l90.516-90.5c24.969-24.969,65.547-24.969,90.5,0c7.797,7.797,12.875,17.203,15.813,27.125  c2.375-1.375,4.813-2.5,6.813-4.5l42.063-42.047c-5.375-9.156-11.563-17.969-19.438-25.828c-49.969-49.984-131.031-49.984-181.016,0  l-90.5,90.5c-49.984,50-49.984,131.031,0,181.031c49.984,49.969,131.031,49.969,181.016,0l68.594-68.594  C274.561,395.092,246.42,392.342,220.326,382.186z"></path></svg><span></span></span></a></h3><p>To derive Oklab, three datasets were used:</p><ul><li>A generated data set of pairs of colors with the same lightness but random hue and chroma, generated using CAM16 and normal viewing conditions. Colors were limited to be within Pointer’s Gamut – the set of possible surface colors.</li><li>A generated data set of pairs of colors with the same chroma but random hue and lightness, generated using CAM16 and normal viewing conditions. Colors were limited to be within Pointer’s Gamut</li><li>The <a href="https://github.com/nschloe/colorio/blob/master/colorio/data/ebner_fairchild.yaml">uniform perceived hue</a> data used to derive IPT. From this data, colors were combined into pairs of colors with equal perceived hue.</li></ul><p>These datasets can be used to test prediction of lightness, chroma and hue respectively. If a color space accurately models <span><span><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span></span>, <span><span><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span></span> and <span><span><math><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span></span>, then all pairs in lightness dataset should have the same value for <span><span><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span></span>, all pairs in the chroma dataset the same value for <span><span><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span></span> and all pairs in the hue dataset the same values for <span><span><math><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span></span>.</p><p>To test a color space it is not possible to simply check the distance in predictions in the tested color space however, since that will depend on the scaling of the color space. It is also not desirable to exactly predict ground truth values for <span><span><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span></span>, <span><span><math><semantics><mrow><mi>C</mi></mrow><annotation encoding="application/x-tex">C</annotation></semantics></math></span></span> and <span><span><math><semantics><mrow><mi>h</mi></mrow><annotation encoding="application/x-tex">h</annotation></semantics></math></span></span>, since it is more important that our model has perceptually orthogonal coordinates, than that the model has the same spacing within each coordinate.</p><p>Instead the following approach was used to create an error metric independent of the color space:</p><ul><li>For each dataset all the pairs are converted to the tested color space.</li><li>Coordinates that are supposed to be the same within a pair are swapped to generate a new set of altered pairs:<ul><li>For the lightness dataset, the L coordinates are swapped between the pairs, and so on.</li><li>These altered pair would be equal to the original pair if the model predicts the datasets perfectly.</li></ul></li><li>The perceived distance between the original colors and the altered colors are are computed using <a href="https://en.wikipedia.org/wiki/Color_difference">CIEDE2000</a>.</li><li>The error for each pair is given as the minimum of the two color differences.</li><li>The error for the entire dataset is the root mean squared error of the color differences.</li></ul><p>Oklab was derived by optimizing the parameters of a color space with the same structure as IPT, to get a low error on all the datasets. For completeness, here is the structure of the color space – the parameters to optimize are the 3x3 matrices <span><span><math><semantics><mrow><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">1</mn></msub></mrow></mrow><annotation encoding="application/x-tex">\mathbf{M_1}</annotation></semantics></math></span></span> and <span><span><math><semantics><mrow><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">2</mn></msub></mrow></mrow><annotation encoding="application/x-tex">\mathbf{M_2}</annotation></semantics></math></span></span> and the positive number <span><span><math><semantics><mrow><mi>γ</mi></mrow><annotation encoding="application/x-tex">\gamma</annotation></semantics></math></span></span>.</p><p><span><span><span><math><semantics><mrow><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mi>l</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>m</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>s</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">1</mn></msub></mrow><mo>×</mo><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mi>X</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>Y</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>Z</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{pmatrix} l \\ m \\ s \end{pmatrix} = \mathbf{M_1} \times \begin{pmatrix} X \\ Y \\ Z \end{pmatrix}</annotation></semantics></math></span></span></span></p><p><span><span><span><math><semantics><mrow><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><mi>L</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>a</mi></mrow></mtd></mtr><mtr><mtd><mrow><mi>b</mi></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow><mo>=</mo><mrow><msub><mi mathvariant="bold">M</mi><mn mathvariant="bold">2</mn></msub></mrow><mo>×</mo><mrow><mo fence="true">(</mo><mtable><mtr><mtd><mrow><msup><mi>l</mi><mi>γ</mi></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>m</mi><mi>γ</mi></msup></mrow></mtd></mtr><mtr><mtd><mrow><msup><mi>s</mi><mi>γ</mi></msup></mrow></mtd></mtr></mtable><mo fence="true">)</mo></mrow></mrow><annotation encoding="application/x-tex">\begin{pmatrix} L \\ a \\ b \end{pmatrix} = \mathbf{M_2} \times \begin{pmatrix} l^\gamma \\ m^\gamma \\ s^\gamma \end{pmatrix}</annotation></semantics></math></span></span></span></p><p>A couple of extra constraints were …</p></div></article></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://bottosson.github.io/posts/oklab/">https://bottosson.github.io/posts/oklab/</a></em></p>]]>
            </description>
            <link>https://bottosson.github.io/posts/oklab/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25525726</guid>
            <pubDate>Thu, 24 Dec 2020 07:34:49 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[MeshCentral: Self-hosted web-based management of remote computers]]>
            </title>
            <description>
<![CDATA[
Score 10 | Comments 1 (<a href="https://news.ycombinator.com/item?id=25525535">thread link</a>) | @aiNohY6g
<br/>
December 23, 2020 | https://www.meshcommander.com/meshcentral2 | <a href="https://web.archive.org/web/*/https://www.meshcommander.com/meshcentral2">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><div><div jscontroller="sGwD4d" jsaction="zXBUYb:zTPCnb;zQF9Uc:Qxe3nd;" jsname="F57UId"><div><div id="h.772be894b56c9933_256"><div><div><p dir="ltr">Connect to your home or office devices from anywhere in the world using MeshCentral, the open source, remote monitoring and management server. Once installed, each enabled computer will show up in the "My Devices" section of the web site and will be able to perform remote desktop, remote terminal, file transfers and more. Get started by installing a MeshCentral server of your own or if you are not familiar with MeshCentral, you can try the public server at your own risk at <span><a href="https://www.google.com/url?q=https%3A%2F%2Fmeshcentral.com&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNF72XMOagiPwq0rSbmLUbf3ea9sZw" target="_blank">MeshCentral.com</a></span>. You can install your own server on Linux or Windows, it will run on anything from a large cloud instance to a Raspberry Pi. This is still beta code. <span><strong>Your privacy matters</strong></span>: When installing your own MeshCentral server, no usage data or telemetry is collected.</p><h3 id="h.p_I7Fa7qSzsHeJ" dir="ltr" tabindex="-1"></h3><ul><li dir="ltr"><p dir="ltr"><span><a href="https://www.google.com/url?q=https%3A%2F%2Fwww.npmjs.com%2Fpackage%2Fmeshcentral&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNGlxrm4X04dUy1SJBLzKJMhuITNkQ" target="_blank">Use NPM to download &amp; install</a></span> - NodeJS application, Apache 2.0 License.</p></li><li dir="ltr"><p dir="ltr"><span><a href="https://www.google.com/url?q=https%3A%2F%2Finfo.meshcentral.com%2Fdownloads%2FMeshCentral2%2FMeshCentralInstaller-2.9.exe&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNGSz1tqKwy-e65faDtHoEfv2V-pZA" target="_blank">Windows Installer v2.9</a></span> - Win32 executable, Apache 2.0 License.</p></li></ul><h3 id="h.p_NI8XlBIe3JF7" dir="ltr" tabindex="-1"></h3><ul><li dir="ltr"><p dir="ltr"><span><a href="https://www.google.com/url?q=https%3A%2F%2Finfo.meshcentral.com%2Fdownloads%2FMeshCentral2%2FMeshCentral2UserGuide-0.2.9.pdf&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNF6k7CRu8xhJ6UjuKqTKrGLJ1YPLg" target="_blank">User's Guide v0.2.9</a></span> - PDF document.</p></li><li dir="ltr"><p dir="ltr"><span><a href="https://www.google.com/url?q=https%3A%2F%2Finfo.meshcentral.com%2Fdownloads%2FMeshCentral2%2FMeshCentral2InstallGuide-0.1.0.pdf&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNENA3FWn6JCC3RU6xPn6JvBklkltw" target="_blank">Install Guide v0.1.0</a></span> - PDF document.</p></li><li dir="ltr"><p dir="ltr"><span><a href="https://www.google.com/url?q=https%3A%2F%2Finfo.meshcentral.com%2Fdownloads%2FMeshCentral2%2FMeshCentral2DesignArchitecture.pdf&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNEJWbeXE64eROflRUP2DbLMUKYXbA" target="_blank">Design &amp; Architecture Guide v0.0.4</a></span> - PDF document.</p></li><li dir="ltr"><p dir="ltr"><span><a href="http://www.google.com/url?q=http%3A%2F%2Finfo.meshcentral.com%2Fdownloads%2FMeshCentral2%2FMeshCentral2RouterUserGuide-0.0.2.pdf&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHYNX3jlmoBOwMEZkI22RMgrfYt4w" target="_blank">MeshCentral Router User Guide v0.0.2</a></span> - PDF document.</p></li><li dir="ltr"><p dir="ltr"><span><a href="https://www.google.com/url?q=https%3A%2F%2Finfo.meshcentral.com%2Fdownloads%2FMeshCentral2%2FMeshCtrlUsersGuide-0.0.1.pdf&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNEP_2gB0THJK7zOapJI_i3A1TGp8A" target="_blank">MeshCtrl User Guide v0.0.1</a></span> - PDF document.</p></li><li dir="ltr"><p dir="ltr"><span><a href="https://www.google.com/url?q=https%3A%2F%2Finfo.meshcentral.com%2Fdownloads%2FMeshCentral2%2FMeshCentral2ManagementFeaturesGuide.pdf&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNEsQ0B8LCeoaoOxx7YlOFBjgMUfgw" target="_blank">Manageability Features</a></span> - Single page PDF document.</p></li><li dir="ltr"><p dir="ltr"><span><a href="https://www.google.com/url?q=https%3A%2F%2Finfo.meshcentral.com%2Fdownloads%2FMeshCentral2%2FMeshCentral2SecurityFeaturesGuide.pdf&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNFFgy77nDwf9m2z5yPPTYqWsxiVMg" target="_blank">Security Features</a></span> - Single page PDF document.</p></li></ul><h3 id="h.p_FGUfZPmtZThQ" dir="ltr" tabindex="-1"></h3><ul><li dir="ltr"><p dir="ltr">Get the latest update: <span><a href="https://www.google.com/url?q=https%3A%2F%2Fmeshcentral2.blogspot.com%2F&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNEmr_JWg6uvu2brOrDffCRKXTTLLw" target="_blank">News Blog</a></span>.</p></li><li dir="ltr"><p dir="ltr">Comments and feedback: <span><a href="https://www.google.com/url?q=https%3A%2F%2Fwww.reddit.com%2Fr%2FMeshCentral%2F&amp;sa=D&amp;sntz=1&amp;usg=AFQjCNHE2mphqK_2uoHNaJq8inmk3COfBQ" target="_blank">Reddit Forum</a></span>.</p></li></ul><h3 id="h.p_nidQqr8rakPZ" dir="ltr" tabindex="-1"></h3><p dir="ltr">More Videos on the <span><a href="https://www.meshcommander.com/meshcentral2/tutorials">Tutorials page</a></span></p></div></div></div></div></div></div></div></div>]]>
            </description>
            <link>https://www.meshcommander.com/meshcentral2</link>
            <guid isPermaLink="false">hacker-news-small-sites-25525535</guid>
            <pubDate>Thu, 24 Dec 2020 06:49:49 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Cryptographic Wear-Out for Symmetric Encryption]]>
            </title>
            <description>
<![CDATA[
Score 7 | Comments 0 (<a href="https://news.ycombinator.com/item?id=25525450">thread link</a>) | @todsacerdoti
<br/>
December 23, 2020 | https://soatok.blog/2020/12/24/cryptographic-wear-out-for-symmetric-encryption/ | <a href="https://web.archive.org/web/*/https://soatok.blog/2020/12/24/cryptographic-wear-out-for-symmetric-encryption/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>

		<div>

			
<p>As we look upon the sunset of a remarkably tiresome year, I thought it would be appropriate to talk about <strong>cryptographic wear-out</strong>.</p>



<h3>What is cryptographic wear-out?</h3>



<p>It’s the threshold when you’ve used the same key to encrypt so much data that you should probably switch to a new key before you encrypt any more. Otherwise, you might let someone capable of observing all your encrypted data perform interesting attacks that compromise the security of the data you’ve encrypted.</p>



<div><figure><img data-attachment-id="126" data-permalink="https://soatok.blog/professor/" data-orig-file="https://soatok.files.wordpress.com/2020/04/professor.png" data-orig-size="224,224" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Professor Furry" data-image-description="" data-medium-file="https://soatok.files.wordpress.com/2020/04/professor.png?w=224" data-large-file="https://soatok.files.wordpress.com/2020/04/professor.png?w=224" src="https://soatok.files.wordpress.com/2020/04/professor.png?w=224" alt="Soatok Explains it All" srcset="https://soatok.files.wordpress.com/2020/04/professor.png 224w, https://soatok.files.wordpress.com/2020/04/professor.png?w=150 150w" sizes="(max-width: 224px) 100vw, 224px"><figcaption>My definitions always aim to be more understandable than pedantically correct.<br>(Art by <a href="https://twitter.com/Swizzlestixick">Swizz</a>)</figcaption></figure></div>



<p>The exact value of the threshold varies depending on how exactly you’re encrypting data (n.b. AEAD modes, block ciphers + cipher modes, etc. each have different wear-out thresholds due to their composition).</p>



<p>Let’s take a look at the wear-out limits of the more popular <a href="https://soatok.blog/2020/07/12/comparison-of-symmetric-encryption-methods/">symmetric encryption methods</a>, and calculate those limits ourselves.</p>



<h2>Specific Ciphers and Modes</h2>



<div><figure><img data-attachment-id="1615" data-permalink="https://soatok.blog/2020/10/16/commission-prices-for-furries-and-artists/soatok_stickerpackedit-math/" data-orig-file="https://soatok.files.wordpress.com/2020/10/soatok_stickerpackedit-math.png" data-orig-size="512,512" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Soatok_STICKERPACKEDIT-Math" data-image-description="" data-medium-file="https://soatok.files.wordpress.com/2020/10/soatok_stickerpackedit-math.png?w=300" data-large-file="https://soatok.files.wordpress.com/2020/10/soatok_stickerpackedit-math.png?w=512" src="https://soatok.files.wordpress.com/2020/10/soatok_stickerpackedit-math.png?w=512" alt="I did the math" srcset="https://soatok.files.wordpress.com/2020/10/soatok_stickerpackedit-math.png 512w, https://soatok.files.wordpress.com/2020/10/soatok_stickerpackedit-math.png?w=150 150w, https://soatok.files.wordpress.com/2020/10/soatok_stickerpackedit-math.png?w=300 300w" sizes="(max-width: 512px) 100vw, 512px"><figcaption>(Art by <a href="https://twitter.com/lynxvsjackalope">Khia</a>. Poorly edited by the author.)</figcaption></figure></div>



<h3 id="aes-gcm-limits">Cryptographic Limits for AES-GCM</h3>



<p>I’ve written about AES-GCM before (and <a href="https://soatok.blog/2020/05/13/why-aes-gcm-sucks/">why I think it sucks</a>).</p>



<p>AES-GCM is a construction that combines AES-CTR with an authenticator called GMAC, whose consumption of nonces looks something like this:</p>



<ul><li>Calculating H (used in GHASH for all messages encrypted under the same key, regardless of nonce):<ul><li><code>Encrypt(00000000 00000000 00000000 00000000)</code></li></ul></li><li>Calculating J<sub>0</sub> (the pre-counter block):<ul><li>If the nonce is 96 bits long:<ul><li><code>NNNNNNNN NNNNNNNN NNNNNNNN 00000001</code> where the <code>N</code> spaces represent the nonce hexits.</li></ul></li><li>Otherwise:<ul><li><code>s = 128 * ceil(len(nonce)/nonce) - len(nonce)</code></li></ul><ul><li><code>J0 = GHASH(H, nonce || zero(s+64) || int2bytes(len(nonce))</code></li></ul></li></ul></li><li>Each block of data encrypted uses J0 + block counter (starting at 1) as a CTR nonce.</li><li>J0 is additionally used as the nonce to calculate the final GMAC tag.</li></ul>



<p>AES-GCM is one of the algorithms where it’s easy to separately calculate the safety limits per message (i.e. for a given nonce and key), as well as for all messages under a key.</p>



<h4>AES-GCM Single Message Length Limits</h4>



<p>In the simplest case (nonce is 96 bits), you end up with the following nonces consumed:</p>



<ul><li>For each key: <code>00000000 00000000 00000000 00000000</code></li><li>For each (nonce, key) pair:<ul><li><code>NNNNNNNN NNNNNNNN NNNNNNNN 000000001</code> for J0</li><li><code>NNNNNNNN NNNNNNNN NNNNNNNN 000000002</code> for encrypting the first 16 bytes of plaintext</li><li><code>NNNNNNNN NNNNNNNN NNNNNNNN 000000003</code> for the next 16 bytes of plaintext…</li><li>…</li><li><code>NNNNNNNN NNNNNNNN NNNNNNNN FFFFFFFFF</code> for the final 16 bytes of plaintext.</li></ul></li></ul>



<p>From here, it’s pretty easy to see that you can encrypt the blocks from <code>00000002</code> to <code>FFFFFFFF</code> without overflowing and creating a nonce reuse. This means that each (key, nonce) can be used to encrypt a single message up to <img src="https://s0.wp.com/latex.php?latex=2%5E%7B32%7D+-+2&amp;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" alt="2^{32} - 2" title="2^{32} - 2"> blocks of the underlying ciphertext.</p>



<p>Since the block size of AES is 16 bytes, this means the maximum length of a single AES-GCM (key, nonce) pair is <img src="https://s0.wp.com/latex.php?latex=2%5E%7B36%7D+-+256&amp;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" alt="2^{36} - 256" title="2^{36} - 256"> <strong>bytes</strong> (or 68,719,476,480 bytes). This is approximately 68 GB or 64 GiB.</p>



<p>Things get a bit tricker to analyze when the nonce is not 96 bits, since it’s hashed.</p>



<p>The disadvantage of this hashing behavior is that it’s possible for two different nonces to produce overlapping ranges of AES-CTR output, which makes the security analysis very difficult.</p>



<p>However, this hashed output is also hidden from network observers since they do not know the value of H. Without some method of reliably detecting when you have an overlapping range of hidden block counters, you can’t exploit this.</p>



<p>(If you want to live dangerously and motivate cryptanalysis research, mix 96-bit and non-96-bit nonces with the same key in a system that does something valuable.)</p>



<h4>Multi-Message AES-GCM Key Wear-Out</h4>



<p>Now that we’ve established the maximum length for a single message,  how many messages you can safely encrypt under a given AES-GCM key depends entirely on how your nonce is selected.</p>



<p>If you have a reliable counter, which is guaranteed to never repeat, and start it at 0 you can theoretically encrypt <img src="https://s0.wp.com/latex.php?latex=2%5E%7B96%7D&amp;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" alt="2^{96}" title="2^{96}"> messages safely. Hooray!</p>







<p>You probably don’t have a reliable counter, especially in real-world settings (distributed systems, multi-threaded applications, virtual machines that might be snapshotted and restored, etc.).</p>



<div><figure><img data-attachment-id="130" data-permalink="https://soatok.blog/computeranger/" data-orig-file="https://soatok.files.wordpress.com/2020/04/computeranger.png" data-orig-size="224,224" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="This is outrageous!" data-image-description="" data-medium-file="https://soatok.files.wordpress.com/2020/04/computeranger.png?w=224" data-large-file="https://soatok.files.wordpress.com/2020/04/computeranger.png?w=224" src="https://soatok.files.wordpress.com/2020/04/computeranger.png?w=224" alt="Soatok angrily grasping computer monitor" srcset="https://soatok.files.wordpress.com/2020/04/computeranger.png 224w, https://soatok.files.wordpress.com/2020/04/computeranger.png?w=150 150w" sizes="(max-width: 224px) 100vw, 224px"><figcaption>Confound you, technical limitations!<br>(Art by <a href="https://twitter.com/Swizzlestixick">Swizz</a>)</figcaption></figure></div>



<p>Additionally (thanks to <a href="https://twitter.com/2adic">2adic</a> for the expedient correction), you cannot safely encrypt more than <img src="https://s0.wp.com/latex.php?latex=2%5E%7B64%7D&amp;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" alt="2^{64}" title="2^{64}"> blocks with AES because the keystream blocks–as the output of a block cipher–cannot repeat.</p>



<p>Most systems that cannot guarantee unique incrementing nonces simply generate nonces with a cryptographically secure random number generator. This is a good idea, but no matter how high quality your random number generator is, random functions will produce collisions with a discrete probability.</p>



<p>If you have <img src="https://s0.wp.com/latex.php?latex=2%5En&amp;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" alt="2^n" title="2^n"> possible values, you should expect a single collision(with 50% probability) after <img src="https://s0.wp.com/latex.php?latex=%5Csqrt%7B2%5E%7Bn%7D%7D&amp;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" alt="\sqrt{2^{n}}" title="\sqrt{2^{n}}"> (or <img src="https://s0.wp.com/latex.php?latex=2%5E%7Bn%2F2%7D&amp;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" alt="2^{n/2}" title="2^{n/2}">)samples. This is called the <strong>birthday bound</strong>.</p>



<p>However, 50% of a nonce reuse isn’t exactly a comfortable safety threshold for most systems (especially since nonce reuse will cause AES-GCM to become vulnerable to active attackers). 1 in 4 billion is a much more comfortable safety margin against nonce reuse via collisions than 1 in 2. Fortunately, you can <a href="https://en.wikipedia.org/wiki/Birthday_problem">calculate the discrete probability of a birthday collision</a> pretty easily.</p>



<p>If you want to rekey after your collision probability exceeds <img src="https://s0.wp.com/latex.php?latex=2%5E%7B-32%7D&amp;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" alt="2^{-32}" title="2^{-32}"> (for a random nonce between 0 and <img src="https://s0.wp.com/latex.php?latex=2%5E%7B96%7D&amp;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" alt="2^{96}" title="2^{96}">), you simply need to re-key after <img src="https://s0.wp.com/latex.php?latex=2%5E%7B32%7D&amp;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" alt="2^{32}" title="2^{32}"> messages.</p>



<h4>AES-GCM Safety Limits</h4>







<div><figure><img data-attachment-id="1388" data-permalink="https://soatok.blog/soatoktelegrams2020-12/" data-orig-file="https://soatok.files.wordpress.com/2020/09/soatoktelegrams2020-12.png" data-orig-size="512,512" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="SoatokTelegrams2020-12" data-image-description="" data-medium-file="https://soatok.files.wordpress.com/2020/09/soatoktelegrams2020-12.png?w=300" data-large-file="https://soatok.files.wordpress.com/2020/09/soatoktelegrams2020-12.png?w=512" src="https://soatok.files.wordpress.com/2020/09/soatoktelegrams2020-12.png?w=512" alt="" srcset="https://soatok.files.wordpress.com/2020/09/soatoktelegrams2020-12.png 512w, https://soatok.files.wordpress.com/2020/09/soatoktelegrams2020-12.png?w=150 150w, https://soatok.files.wordpress.com/2020/09/soatoktelegrams2020-12.png?w=300 300w" sizes="(max-width: 512px) 100vw, 512px"><figcaption>Not bad, but we can do better.<br>(Art by <a href="https://twitter.com/lynxvsjackalope">Khia</a>.)</figcaption></figure></div>



<h3 id="chacha20poly1305-limits">Cryptographic Limits for ChaCha20-Poly1305</h3>



<p>The IETF version of ChaCha20-Poly1305 uses 96-bit nonces and 32-bit internal counters. A similar analysis follows from AES-GCM’s, with a few notable exceptions.</p>



<p>For starters, the one-time Poly1305 key is derived from the first 32 bytes of the ChaCha20 keystream output (block 0) for a given (nonce, key) pair. There is no equivalent to AES-GCM’s H parameter which is static for each key. (The ChaCha20 encryption begins using block 1.)</p>



<p>Additionally, each block for ChaCha20 is 512 bits, unlike AES’s 128 bits. So the message limit here is a little more forgiving.</p>



<p>Since the block size is 512 bits (or 64 bytes), and only one block is consumed for Poly1305 key derivation, we can calculate a message length limit of <img src="https://s0.wp.com/latex.php?latex=2%5E%7B38%7D+-+64&amp;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" alt="2^{38} - 64" title="2^{38} - 64">, or 274,877,906,880 bytes–nearly 256 GiB for each (nonce, key) pair.</p>



<p>The same rules for handling 96-bit nonces applies as with AES-GCM, so we can carry that value forward.</p>



<h4>ChaCha20-Poly1305 Safety Limits</h4>







<div><figure><img data-attachment-id="120" data-permalink="https://soatok.blog/soatok_stickerpack-smile/" data-orig-file="https://soatok.files.wordpress.com/2020/04/soatok_stickerpack-smile.png" data-orig-size="512,512" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Soatok" data-image-description="" data-medium-file="https://soatok.files.wordpress.com/2020/04/soatok_stickerpack-smile.png?w=300" data-large-file="https://soatok.files.wordpress.com/2020/04/soatok_stickerpack-smile.png?w=512" src="https://soatok.files.wordpress.com/2020/04/soatok_stickerpack-smile.png?w=512" alt="Soatok" srcset="https://soatok.files.wordpress.com/2020/04/soatok_stickerpack-smile.png 512w, https://soatok.files.wordpress.com/2020/04/soatok_stickerpack-smile.png?w=150 150w, https://soatok.files.wordpress.com/2020/04/soatok_stickerpack-smile.png?w=300 300w" sizes="(max-width: 512px) 100vw, 512px"><figcaption>A significant improvement, but still practically limited.<br>(Art by <a href="https://twitter.com/lynxvsjackalope">Khia</a>.)</figcaption></figure></div>



<h3 id="chacha20poly1305-limits">Cryptographic Limits for XChaCha20-Poly1305</h3>



<p>XChaCha20-Poly1305 is a variant of XSalsa20-Poly1305 (as used in libsodium) and the IETF’s ChaCha20-Poly1305 construction. It features 192-bit nonces and 32-bit internal counters.</p>



<p>XChaCha20-Poly1305 is instantiated by using HChaCha20 of the key over the first 128 bits of the nonce to produce a subkey, which is used with the remaining nonce bits using the aforementioned ChaCha20-Poly1305.</p>



<p>This doesn’t change the maximum message length, but it <em>does</em> change the number of messages you can safely encrypt (since you’re actually using up to <img src="https://s0.wp.com/latex.php?latex=2%5E%7B128%7D&amp;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" alt="2^{128}" title="2^{128}"> distinct keys).</p>



<p>Thus, even if you manage to repeat the final ChaCha20-Poly1305 nonce, as long as the total nonce differs, each encryptions will be performed with a distinct key (thanks to the HChaCha20 key derivation; see the <a href="https://cr.yp.to/snuffle/xsalsa-20110204.pdf">XSalsa20 paper</a> and <a href="https://tools.ietf.org/html/draft-irtf-cfrg-xchacha-03">IETF RFC draft</a> for details).</p>



<h4>XChaCha20-Poly1305 Safety Limits</h4>







<div><figure><img loading="lazy" data-attachment-id="1201" data-permalink="https://soatok.blog/soatoktelegrams2020-01/" data-orig-file="https://soatok.files.wordpress.com/2020/08/soatoktelegrams2020-01.png" data-orig-size="512,512" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="SoatokTelegrams2020-01" data-image-description="" data-medium-file="https://soatok.files.wordpress.com/2020/08/soatoktelegrams2020-01.png?w=300" data-large-file="https://soatok.files.wordpress.com/2020/08/soatoktelegrams2020-01.png?w=512" src="https://soatok.files.wordpress.com/2020/08/soatoktelegrams2020-01.png?w=512" alt="Galaxy Brain meme, but a furry" width="512" height="512" srcset="https://soatok.files.wordpress.com/2020/08/soatoktelegrams2020-01.png 512w, https://soatok.files.wordpress.com/2020/08/soatoktelegrams2020-01.png?w=150 150w, https://soatok.files.wordpress.com/2020/08/soatoktelegrams2020-01.png?w=300 300w" sizes="(max-width: 512px) 100vw, 512px"><figcaption>I can <s>see</s> encrypt forever, man.<br>(Art by <a href="https://twitter.com/lynxvsjackalope">Khia</a>.)</figcaption></figure></div>



<h3>Cryptographic Limits for AES-CBC</h3>



<p>It’s tempting to compare non-AEAD constructions and block cipher modes such as CBC (Cipher Block Chaining), but they’re totally different monsters.</p>



<ul><li>AEAD ciphers have a clean delineation between message length limit and the message quantity limit</li><li>CBC and other cipher modes do not have this separation</li></ul>



<p>Every time you encrypt a block with AES-CBC, you are depleting from a <strong>universal</strong> bucket that affects the birthday bound security of encrypting more messages under that key. (And unlike AES-GCM with long nonces, AES-CBC’s IV is public.)</p>



<p>This is in addition to the operational requirements of AES-CBC (plaintext padding, initialization vectors that never repeat <em>and</em> must be unpredictable, separate message authentication since CBC doesn’t provide integrity and is vulnerable to chosen-ciphertext atacks, etc.).</p>



<div><figure><img data-attachment-id="1210" data-permalink="https://soatok.blog/soatok_stickerpack_ind_cca2/" data-orig-file="https://soatok.files.wordpress.com/2020/08/soatok_stickerpack_ind_cca2.png" data-orig-size="512,512" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Soatok_STICKERPACK_IND_CCA2" data-image-description="" data-medium-file="https://soatok.files.wordpress.com/2020/08/soatok_stickerpack_ind_cca2.png?w=300" data-large-file="https://soatok.files.wordpress.com/2020/08/soatok_stickerpack_ind_cca2.png?w=512" src="https://soatok.files.wordpress.com/2020/08/soatok_stickerpack_ind_cca2.png?w=512" alt="This isn't IND-CCA2 Secure!" srcset="https://soatok.files.wordpress.com/2020/08/soatok_stickerpack_ind_cca2.png 512w, https://soatok.files.wordpress.com/2020/08/soatok_stickerpack_ind_cca2.png?w=150 150w, https://soatok.files.wordpress.com/2020/08/soatok_stickerpack_ind_cca2.png?w=300 300w" sizes="(max-width: 512px) 100vw, 512px"><figcaption>My canned response to most queries about AES-CBC.<br>(Art by <a href="https://twitter.com/lynxvsjackalope">Khia</a>.)</figcaption></figure></div>



<p>For this reason, most cryptographers don’t even bother calculating the safety limit for AES-CBC in the same breath as discussing AES-GCM. And they’re right to do so!</p>



<p>If you find yourself using AES-CBC (or AES-CTR, for that matter), you’d best be performing a separate HMAC-SHA256 over the ciphertext (and verifying this HMAC with <a href="https://soatok.blog/2020/08/27/soatoks-guide-to-side-channel-attacks/#string-comparison">a secure comparison function</a> before decrypting). Additionally, you should consider using <a href="https://github.com/defuse/php-encryption/blob/master/docs/CryptoDetails.md">an extended nonce construction to split one-time encryption and authentication keys</a>.</p>







<p>However, for the sake of completeness, let’s figure out what our practical limits are.</p>



<p>CBC operates on entire blocks of plaintext, whether you need the entire block or not.</p>



<p>On encryption, the output of the previous block is mixed (using XOR) with the current block, then encrypted with the block cipher. For the first block, the IV is used in the place of a “previous” block. (Hence, its requirements to be non-repeating <em>and</em> unpredictable.)</p>



<p>This means you can informally model (IV xor PlaintextBlock) and (PB<sub>n</sub> xor PB<sub>n+1</sub>) as a pseudo-random function, before it’s encrypted with the block cipher.</p>



<p>If those words don’t mean anything to you, here’s the kicker: You can use the above discussion about birthday bounds to calculate the upper safety bounds for the <strong>total</strong> number of blocks encrypted under a single AES key (assuming IVs are generated from a secure random source).</p>



<p>If you’re okay with a 50% probability of a collision, you should re-key after <img src="https://s0.wp.com/latex.php?latex=2%5E%7B64%7D&amp;bg=0a0a0a&amp;fg=f0f0f0&amp;s=3&amp;c=20201002" alt="2^{64}" title="2^{64}"> blocks have been encrypted.</p>



<figure><p><span><iframe width="580" height="327" src="https://www.youtube.com/embed/v0IsYNDMV7A?version=3&amp;rel=1&amp;showsearch=0&amp;showinfo=1&amp;iv_load_policy=1&amp;fs=1&amp;hl=en&amp;autohide=2&amp;wmode=transparent" allowfullscreen="true" sandbox="allow-scripts allow-same-origin allow-popups allow-presentation"></iframe></span>
</p><figcaption>This video …</figcaption></figure></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://soatok.blog/2020/12/24/cryptographic-wear-out-for-symmetric-encryption/">https://soatok.blog/2020/12/24/cryptographic-wear-out-for-symmetric-encryption/</a></em></p>]]>
            </description>
            <link>https://soatok.blog/2020/12/24/cryptographic-wear-out-for-symmetric-encryption/</link>
            <guid isPermaLink="false">hacker-news-small-sites-25525450</guid>
            <pubDate>Thu, 24 Dec 2020 06:24:18 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Fitting all human knowledge in a box]]>
            </title>
            <description>
<![CDATA[
Score 39 | Comments 4 (<a href="https://news.ycombinator.com/item?id=25524460">thread link</a>) | @moj3
<br/>
December 23, 2020 | https://monadical.com/posts/knowledge-in-box.html | <a href="https://web.archive.org/web/*/https://monadical.com/posts/knowledge-in-box.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/>Unable to extract article]]>
            </description>
            <link>https://monadical.com/posts/knowledge-in-box.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-25524460</guid>
            <pubDate>Thu, 24 Dec 2020 02:11:08 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Rocky Linux December 2020 community update]]>
            </title>
            <description>
<![CDATA[
Score 19 | Comments 2 (<a href="https://news.ycombinator.com/item?id=25523895">thread link</a>) | @curt15
<br/>
December 23, 2020 | https://forums.rockylinux.org/t/community-update-december-2020/1157 | <a href="https://web.archive.org/web/*/https://forums.rockylinux.org/t/community-update-december-2020/1157">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="main-outlet">
        

  


      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          


          <p><span>
              <meta itemprop="datePublished" content="2020-12-23T03:10:41Z">
              <time itemprop="dateModified" datetime="2020-12-27T18:12:55Z">
                December 27, 2020,  6:12pm
              </time>
          <span itemprop="position">#1</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          
<h2>Summary</h2>
<p>Our teams are working to coordinate the many individuals and organizations that have offered to help advance The Rocky Linux Foundation, Inc. (Rocky Linux). The core team is working to lay the infrastructure that will support the legal entity and the engineering efforts required to deliver and support an initial release. Updates regarding project news, release dates, and more will be announced on our <a href="https://forums.rockylinux.org/">forums</a>, <a href="https://rockylinux.org/">website</a>, and <a href="https://forums.rockylinux.org/t/all-rocky-linux-links/833">other social media platforms</a>.</p>
<h3>Timeline</h3>
<p>Transparency with the community and for those that will be relying on Rocky Linux to supplant their CentOS 8 installations before support expiration is paramount. We will soon be communicating a timeline for the delivery of the following:</p>
<ul>
<li>Build systems and infrastructure readiness</li>
<li>Automatic package build infrastructures</li>
<li>When the testing package repository will be made public</li>
<li>Installer testing readiness</li>
<li>ETA for length of time needed for community testing</li>
<li>Release candidate availability</li>
</ul>
<p>We are targeting Q2 2021 to deliver our first release of Rocky Linux, made available not only in standard commercial regions, but also <a href="https://aws.amazon.com/govcloud-us">GovCloud</a>, and China.</p>
<hr>
<p>Over the past three weeks, here is some of the progress we’ve made:</p>
<h2>Infrastructure</h2>
<ul>
<li>We have selected and vetted auditing, logging, and user account management tooling.</li>
<li>Amazon Web Services (AWS):
<ul>
<li>The team selected AWS as the primary build platform for development of Rocky Linux. AWS was chosen primarily to protect the integrity of the software supply chain for Rocky Linux.</li>
<li>Unfortunately, donated hardware and rack space isn’t sufficient to meet our supply chain integrity needs.</li>
<li>Traditional physical hardware separate from our production build environment will still be necessary, and we expect a large portion of our infrastructure will exist outside of AWS for the purposes of business continuity, cost, and platform agnosticity.</li>
<li>We have outlined an infrastructure to best secure and facilitate our engineering efforts using multiple VPCs, subnets, and regions for high availability.</li>
</ul>
</li>
<li>Data Centers:
<ul>
<li>We are negotiating with several data center providers for the secure hosting of our physical infrastructure.</li>
<li>After we have our physical infrastructure provider solidified, we will reach back out to those that have offered to donate hardware .</li>
<li>Discussions with the Oregon State University Open Source Lab (<a href="https://osuosl.org/">OSUOSL</a>) regarding resources are in the works.</li>
</ul>
</li>
</ul>
<p>The core tenets of the Infrastructure Team are:</p>
<ul>
<li>To provide a platform for the automatic and secure builds of packages and components which will allow for community participation without sacrificing security or trust in the resulting packages</li>
<li>The integrity of the build pipeline and software supply chain are paramount.</li>
<li>Be as vendor and platform agnostic as possible. Avoid vendor lock-in.</li>
<li>Be transparent with the community, to the extent possible and practical.</li>
</ul>
<h2>Release Engineering and Packaging</h2>
<ul>
<li>The build process for Rocky Linux will use <a href="https://fedoraproject.org/wiki/Koji">Koji</a> and <a href="https://pagure.io/fm-orchestrator/tree/master">MBS</a>.</li>
<li>We are developing scripts and build tools to create a pipeline that allows pulling sources, debranding, and building through Koji and <a href="https://github.com/rpm-software-management/mock/wiki">Mock</a>.</li>
<li>The progress of proof of concepts and processes utilized by the Rocky Linux build process, including all errors and dependencies, is being documented in the <a href="https://wiki.rockylinux.org/en/Development">wiki</a>.</li>
</ul>
<h2>Security</h2>
<ul>
<li>The Security team has drafted a Data Classification Policy, which will be made available for public comment pending review.</li>
<li>Groups, members, and permissions structures for the build infrastructure have been laid out for review and evaluation.</li>
<li>In parallel with the infrastructure team, we have architected and designed AWS network and security topologies aligned with best practices and security standards.</li>
<li>Work has started on OpenSCAP documents for popular STIGs.</li>
<li>Plans are being made with the goal of Rocky Linux becoming FIPS compliant.</li>
</ul>
<h2>Web</h2>
<ul>
<li>In only 12 days, our <a href="https://forums.rockylinux.org/">forums</a> have received nearly 150K page views.</li>
<li>Bandwidth to GitHub resources has exceeded the current plan, requiring an upgrade.</li>
</ul>
<h2>Community</h2>
<ul>
<li>We have chosen <a href="https://rbcreative.team/">Red Barn Creative Team</a> (<em>formerly Hackerthreads</em> ) as the designated / authorized vendor to sell Rocky Linux branded merchandise. We are awaiting proofs from their designers to present to the community, and will as well be accepting submissions for designs.</li>
<li>Over 370 people have responded to our <a href="https://docs.google.com/forms/d/e/1FAIpQLSfEXnqD1sNHz9cslkMNOk6krUtDdSCYbxL68TTsn7uGZnoSFQ/viewform">form for registering volunteers</a> and supporters.</li>
<li>A blog and mailing list for future announcements and community updates is in development.</li>
<li>We have outgrown Slack due to the size of the community and required feature sets, and will therefore be migrating to <a href="https://mattermost.com/">Mattermost</a>. This open source platform has a number of features we’ll be taking advantage of, including: an IRC bridge, multi-factor authentication, advanced logging / auditing / security capabilities, and fidelity in channel and access permissions.</li>
<li>Social media following:
<ul>
<li>4.3K active members on Slack</li>
<li>169 followers on <a href="https://linkedin.com/company/rockylinux">LinkedIn</a> with 1.3K post impressions</li>
<li>4K followers on <a href="https://twitter.com/rocky_linux">Twitter</a> with an average of 22K impressions and 3575 interactions per tweet</li>
<li>3K members in <a href="https://www.reddit.com/r/RockyLinux">/r/RockyLinux on Reddit</a>.</li>
</ul>
</li>
</ul>
<h2>Special Interest Groups (SIG)</h2>
<ul>
<li>We have received a number of requests for SIGs on a variety of different topics:
<ul>
<li>Desktop / Laptop</li>
<li>Enhanced Security</li>
<li>Kubernetes / Cloud Native</li>
<li>Minimal Install / OS Bootstrap</li>
<li>Storage appliance</li>
<li>HPC and next generation HPC</li>
</ul>
</li>
<li>The evolution of a SIG should result in optional package repositories and/or custom installers.</li>
<li>We will need leaders for SIGs as well as proposals.</li>
<li>Timelines for these proposals will be coming soon.</li>
</ul>
<p><em>Note: Rocky Linux is first and foremost a freely available Enterprise Linux clone. SIGs will optionally enhance that base and provide extra packages and capabilities to that stable base. At no point will a SIG affect the default core of Rocky Linux.</em></p>
<h2>Sponsors</h2>
<ul>
<li>We have a number of companies who have stepped up to sponsor the Rocky Linux Foundation in the form of developers, hardware, cloud instances, and money.</li>
<li>Sponsorship will have different levels, and we are happy to speak with organizations interested in helping.</li>
<li>All contributors will be publicly thanked on our website.</li>
</ul>
<h2>Legal</h2>
<ul>
<li>The Rocky Linux Foundation, Inc. has been registered as a legal entity in the United States (Delaware).</li>
<li>An application for 501(​c)(3) non-profit status will be submitted as we mature and can afford the legal representation to do so.</li>
<li>We are considering licensing for our data that will enable the greatest flexibility for our community. At present, the team is leaning towards the 3 Clause BSD license, but community input is welcome on this decision.</li>
</ul>
<h2>Localization</h2>
<ul>
<li>A <a href="https://forums.rockylinux.org/c/localization/10">localization category</a> has been created on our forums, with many people interested in helping with translations to a number of languages including Spanish, French, Italian, German, Chinese, Afrikaans, Greek, Turkish, and many more.</li>
<li>We will be working to ensure future newsletters are translated to as many languages as possible.</li>
</ul>
<p>If you have an interest in assisting with translations, please reach out via the <a href="https://forums.rockylinux.org/c/localization/10">localization category of our forums</a>.</p>
<hr>
<p>Lastly, this wouldn’t at all be possible without <em>you</em>. We’re immensely grateful for the community’s enthusiasm, excitement, and help. Rocky Linux is, and will  remain a community-driven effort.</p>
<p>If you would like to contribute to Rocky Linux, please take a moment to fill out our <a href="https://forms.gle/F3crDYVkq79pDtr49">participation form</a> if you haven’t already done so. This form will allow us to expand and gauge interest in teams.</p>
<p>If you have any questions, comments, concerns, suggestions, or would like to help out, please reach out to us via email at:  <a href="mailto:hello@rockylinux.org">hello@rockylinux.org</a>.</p>
<p>Sincerely,<br>
The Rocky Linux Foundation<br>
<a href="https://rockylinux.org/">https://rockylinux.org</a></p>
        </div>

        <meta itemprop="headline" content="Community Update - December 2020">
          <meta itemprop="keywords" content="">

        

         

            
      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://forums.rockylinux.org/u/jorp"><span itemprop="name">jorp</span></a>
            
              pinned globally 
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2020-12-23T03:40:32Z">
                December 23, 2020,  3:40am
              </time>
              <meta itemprop="dateModified" content="2020-12-23T03:40:32Z">
          <span itemprop="position">#2</span>
          </span>
        </p></div>
        

        <meta itemprop="headline" content="Community Update - December 2020">

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        
        <div itemprop="articleBody">
          <p>Thanks for the update <a href="https://forums.rockylinux.org/u/jorp">@jorp</a>, great summary.</p>
<p>Minor nit, can we change the wording of ‘Spring 2021’ to something more internationally consistent? eg. a month or quarter in 2021.</p>
        </div>

        <meta itemprop="headline" content="Community Update - December 2020">

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://forums.rockylinux.org/u/jorp"><span itemprop="name">jorp</span></a>
            
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2020-12-23T06:02:44Z">
                December 23, 2020,  6:02am
              </time>
              <meta itemprop="dateModified" content="2020-12-23T06:02:44Z">
          <span itemprop="position">#5</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          
<p>That was a great suggestion and definitely not a nitpick in my book. I’ve edited accordingly, thank you for pointing that out.</p>
        </div>

        <meta itemprop="headline" content="Community Update - December 2020">

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://forums.rockylinux.org/u/defcon3"><span itemprop="name">defcon3</span></a>
            
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2020-12-23T08:45:14Z">
                December 23, 2020,  8:45am
              </time>
              <meta itemprop="dateModified" content="2020-12-23T08:45:14Z">
          <span itemprop="position">#6</span>
          </span>
        </p></div>
        <p>GREAT,<br>
thanks for the update.</p>

        <meta itemprop="headline" content="Community Update - December 2020">

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://forums.rockylinux.org/u/Faisal"><span itemprop="name">Faisal</span></a>
            
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2020-12-23T09:15:26Z">
                December 23, 2020,  9:15am
              </time>
              <meta itemprop="dateModified" content="2020-12-23T09:15:26Z">
          <span itemprop="position">#7</span>
          </span>
        </p></div>
        <p>I’m suggesting something that maybe seen as a huge undertake that I don’t know if it’s even possible or at least could prove stable.<br>
A migration script from CentOS 7/8 to our Rocky.</p>

        <meta itemprop="headline" content="Community Update - December 2020">

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://forums.rockylinux.org/u/muzilee"><span itemprop="name">muzilee</span></a>
            
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2020-12-23T09:35:52Z">
                December 23, 2020,  9:35am
              </time>
              <meta itemprop="dateModified" content="2020-12-23T09:35:52Z">
          <span itemprop="position">#8</span>
          </span>
        </p></div>
        

        <meta itemprop="headline" content="Community Update - December 2020">

        

         

      </div>
      <div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
        <div>
          
          <p><span itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            <a itemprop="url" href="https://forums.rockylinux.org/u/xtus"><span itemprop="name">xtus</span></a>
            
          </span></p>


          <p><span>
              <time itemprop="datePublished" datetime="2020-12-23T10:14:56Z">
                December 23, 2020, 10:14am
              </time>
              <meta itemprop="dateModified" content="2020-12-23T10:14:56Z">
          <span itemprop="position">#9</span>
          </span>
        </p></div>
        <div itemprop="articleBody">
          
<p>I’m not a US citizen, and the …</p></div></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://forums.rockylinux.org/t/community-update-december-2020/1157">https://forums.rockylinux.org/t/community-update-december-2020/1157</a></em></p>]]>
            </description>
            <link>https://forums.rockylinux.org/t/community-update-december-2020/1157</link>
            <guid isPermaLink="false">hacker-news-small-sites-25523895</guid>
            <pubDate>Thu, 24 Dec 2020 00:24:04 GMT</pubDate>
        </item>
    </channel>
</rss>
