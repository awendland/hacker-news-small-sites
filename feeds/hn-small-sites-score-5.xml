<rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>
<![CDATA[Hacker News - Small Sites - Score >= 5]]>
        </title>
        <description>
<![CDATA[Hacker News stories from domains that aren't in the top 1M and that have a score of at least 5. Updated nightly via https://github.com/awendland/hacker-news-small-sites]]>
        </description>
        <link>https://news.ycombinator.com</link>
        <generator>RSS for Node</generator>
        <lastBuildDate>Wed, 03 Mar 2021 01:09:22 GMT</lastBuildDate>
        <atom:link href="https://raw.githubusercontent.com/awendland/hacker-news-small-sites/generated/feeds/hn-small-sites-score-5.xml" rel="self" type="application/rss+xml"></atom:link>
        <pubDate>Wed, 03 Mar 2021 01:09:22 GMT</pubDate>
        <language>
<![CDATA[en-US]]>
        </language>
        <managingEditor>
<![CDATA[me@alexwendland.com (Alex Wendland)]]>
        </managingEditor>
        <ttl>240</ttl>
        <item>
            <title>
<![CDATA[The Last Message Sent on Aim]]>
            </title>
            <description>
<![CDATA[
Score 109 | Comments 27 (<a href="https://news.ycombinator.com/item?id=26300266">thread link</a>) | @luu
<br/>
February 28, 2021 | https://justanman.org/posts/the-last-message-sent-on-aim/ | <a href="https://web.archive.org/web/*/https://justanman.org/posts/the-last-message-sent-on-aim/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div itemprop="articleBody">
      <p><img src="https://justanman.org/images/aol-instant-messenger-shuts-down.png" alt="AOL Instant Messenger ‚ÄòRunning Man‚Äô waving goodbye"></p>
<p>In the early 2000s social media sites like Facebook and Twitter weren‚Äôt commonplace yet. Even text messages, at ten cents each, were something to be rationed. For many teenagers the primary means of communication outside school was AOL Instant Messenger (AIM). So when it was announced in October that they were shutting down AIM after 20 years, I felt a wave of nostalgia for the messaging app of my youth.</p>
<p>It wasn‚Äôt clear when they would be pulling the plug for good, but a high school friend and I planned to be online for the occasion. Their website indicated that AIM would continue to work until the morning of December 15, 2017. Assuming this meant UTC time, that put it going offline sometime after 7:00 PM EST on the 14th.</p>
<p>I wondered: Could I be the last person to sign off? The last person to send a message? Would I have anything profound to say?</p>
<p><strong>Research</strong></p>
<p>I decided to research famous last words. First stop: the Book of Revelation. Final chapter, final verse.</p>
<blockquote>
<p>‚ÄúThe grace of our Lord Jesus Christ be with you all. Amen.‚Äù</p>
</blockquote>
<p>Not quite what I was looking for.</p>
<blockquote>
<p>‚ÄúLast words are for fools who haven‚Äôt said enough!‚Äù</p>
</blockquote>
<p>Too cantankerous. And as a somewhat libertarian leaning person, I wasn‚Äôt going to let Karl Marx have the last word.</p>
<p>I‚Äôd figure out what to say later and in the meantime started reading about the technology behind AIM. I learned about OSCAR, the proprietary protocol used by AIM and ICQ. Parts of the protocol were documented by AOL in an official SDK. This is what made third-party AIM clients possible. I had used Gaim (now Pidgin) on Linux machines before and indeed, there was even BSFlite, an AIM client for the command line.</p>
<p>AOL‚Äôs desktop client no longer worked for me. They had already pulled the iOS app from the App Store. Ditto for Android. Fortunately browser sign on still worked. I was greeted by a familiar interface that supported new features like embedded media and SMS.</p>
<p>I sent a couple test messages from the browser to my phone. Monitoring outbound activity in the Chrome network panel revealed the structure of a request: a simple HTTP POST to a url, with what appeared to be a session ID in the query string and a message body. I tried to send a message using <code>curl</code> and it worked. As long as I was signed on in the browser the request was accepted.</p>
<p>There were several paths to automating this but given the time constraint, something quick and easy would probably suffice. All I had to do was keep sending messages until the server stopped responding.</p>
<p><strong>December 14, 2017: The final countdown</strong></p>
<p>It was almost midnight UTC time. It would be the 15th soon and I didn‚Äôt want to miss the shutdown, so I set up a Bash script to run the <code>curl</code> command at one second intervals. Every now and then I had to manually reauthenticate in the browser. It wasn‚Äôt elegant but it worked. Now I had to wait‚Ä¶</p>
<p>To pass time I searched Twitter for mentions of AIM‚Äôs last day. Plenty of people were reminiscing about their old screen names, but only a handful were actually signing on one last time. I added them to my buddy list and we talked for a bit. One lived in DC, one in Toledo. Another in somewhere Maryland. Two were engineers, one was a wrestling announcer! I made dinner and watched <em>The Office</em> while occasionally checking on the script.</p>
<p>It ran for another six hours until 1:21 AM EST. I witnessed the drama play out in HTTP status codes:</p>
<pre><code>200 OK
200 OK
200 OK
408 Request Timeout
408 Request Timeout
401 Unauthorized
</code></pre><p>And like that, AIM was gone. Requests to aim.com returned an Invalid URL status page. <code>curl</code> returned nothing but 401s.</p>
<p><strong>Epitaph</strong></p>
<p>I examined the script logs and found it ‚Äì the last message sent on AIM. [1] It was timestamped Fri Dec 15 01:21:42 EST 2017. From me, to me. (I didn‚Äôt want to spam anyone.)</p>
<p>I had borrowed the words from Leonard Nimoy‚Äôs final tweet:</p>
<blockquote>
<p>‚ÄúA life is like a garden. Perfect moments can be had, but not preserved, except in memory. LLAP‚Äù</p>
</blockquote>
<p>üññ</p>
<p><strong>Notes</strong></p>
<p>[1] At least in my server region.</p>
<p><strong>Thanks</strong> to behind2greeneyes, dalilmoo, croftonworldwide, nuklermuleburger, and sirmatthew84.</p>
<p>If you enjoyed reading this, please consider a donation to the <a href="https://archive.org/donate/">Internet Archive</a>.</p>
<p>You can also read Kat Timpf‚Äôs brilliant <a href="https://www.nationalreview.com/2017/10/aol-instant-messenger-eulogy-aim-social-media-millennials/">eulogy for AIM</a>.</p>

      <hr>
      <p>
        For more frequent updates, follow me on Twitter.
      </p>
      <p>
        <a href="https://twitter.com/jtangofx?ref_src=twsrc%5Etfw" data-show-count="false">Follow @jtangofx</a>
      </p>
    </div></div>]]>
            </description>
            <link>https://justanman.org/posts/the-last-message-sent-on-aim/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26300266</guid>
            <pubDate>Mon, 01 Mar 2021 06:40:44 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Show HN: Planck 6502, an open hardware extensible retro computer]]>
            </title>
            <description>
<![CDATA[
Score 9 | Comments 1 (<a href="https://news.ycombinator.com/item?id=26298278">thread link</a>) | @jfoucher
<br/>
February 28, 2021 | https://jfoucher.com/2021/02/planck-6502-open-hardware-computer.html | <a href="https://web.archive.org/web/*/https://jfoucher.com/2021/02/planck-6502-open-hardware-computer.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
  
  
  <p>February 28, 2021 | <span>7</span> Minute Read</p>
  
  <p><img src="https://jfoucher.com/uploads/2021/02/1.jpg" alt="">
    </p>

  <h3 id="retro-computing">Retro computing</h3>

<p>Going back to the roots of your field can provide new insights into your day to day experience. For me, the roots are located in the 70s / 80s a time when personal computers were much simpler and could be fully understood by a regular person. This is a time when the most popular computers were the Vic20, Apple II and later Commodore 64.</p>

<p><img src="https://jfoucher.com/uploads/2021/02/VIC-20.jpg" alt="Vic-20">
<img src="https://jfoucher.com/uploads/2021/02/Apple_II.jpg" alt="Apple II"></p>



<p>These computers booted in less than a second to a raw basic prompt. To be clear: you turn on your computer, and less than one second later you start programming. How wonderful would that be, in our land of a thousand node dependencies, failing composer upgrades and wrong vagrant configurations?</p>

<h3 id="what-to-build">What to build?</h3>

<p>I was increasingly interested in electronics since doing a project for a friend, so I thought to myself ‚ÄúHow hard can it be?‚Äù Well, as it turns out, quite, but that‚Äôs hardly the point right now. The point is: what should I build? I started by building a simple 6502 based computer on a breadboard. I soon realised that if I was to have anything half useful I was going to need the entire breadboard production of China to be delivered to my house. Also breadboard computers are buggy and you can‚Äôt move them around because then a cable will come loose and you will spend five hours troubleshooting your code instead.</p>

<p>So I decided I would convert it to PCBs. They are pretty cheap to get delivered from China, but since they take about a month to arrive the rate of iteration is not so great. Better to get it right the first time obviously.</p>

<p>Well I almost did. The first one was very simple, only having a 6502 processor and an 6522 parallel port interface. I interfaced with it from my computer via SPI through an arduino: the 6522 Versatile Interface Adapter can bit bang SPI easily enough. The Arduino Uno/Nano can be an SPI slave easily enough and receive that data. It can then transmit that data to my computer using serial over USB.</p>

<p>That worked fine (after a couple of bodge wires) but was a bit kludgy, having the Arduino sort of hanging there by a few cables.</p>

<p>I then tried to design a single board computer with everything I would ever want on it: serial communication, parrallel port, SPI port(s), i2c port(s), PS/2 port for a keyboard, sound chip, VGA output, etc‚Ä¶ The board to house all of this was very big and thus very expensive. Combining this with the previous point regarding getting it right the first time, a single board computer suddenly seemed like not that great of an idea.</p>

<h3 id="the-plan">The plan</h3>

<p>I then decided to build a board with basic circuitry into which other boards that provided actual functionality will be able to plug in. Turns out that already exists and is called a <a href="https://en.wikipedia.org/wiki/Backplane">backplane</a></p>

<p>So backplane it is then. The size limit for this board and all others will be 10cm x 10cm as that it the cheap price limit for most cheap board houses (yes I‚Äôm cheap and I like cheap, preferably cheap that works).</p>

<p>Here is the backplane design:</p>

<p><img src="https://jfoucher.com/uploads/2021/02/backplane.png" alt="backplane 3D view"></p>

<p>As you can see, it is mostly just slots to plug in the extension boards. The only active components are the clock generation circuit, and some decoding to activate the expansion slots when they are needed.</p>

<p>The rightmost slot is reserved for the CPU card. The CPU card includes some RAM and ROM, which means the computer is already functional with just this single board plugged in, although admittedly it won‚Äôt <em>do</em> much in that configuration.</p>

<p>To get the computer to do stuff it‚Äôs best to plug in some additional boards.</p>

<p>The initial design includes an IO board with PS/2 port, SPI ports and a parallel port (and LEDs, of course it has LEDs!) as well as a serial board to allow the user to communicate with the computer.</p>

<p>After waiting patiently forever for the boards to arrive, I put it all together and gave it a try. It did not work at all. Of course there were mistakes on the boards, which confirmed the soudness of my choice of not doing one huge board at once.
However not all the boards were defective, and the bad ones were quickly fixed with a few wires here and there.</p>

<p>After which, plugging a usb to serial adapter into the serial board, and into a usb port on my computer, I could see the Planck computer doing something!</p>

<p>Here it is running <a href="https://en.wikipedia.org/wiki/Forth_(programming_language)">Forth</a> over serial</p>

<p><img src="https://jfoucher.com/uploads/2021/02/running-forth.jpg" alt="Forth over serial on the Planck computer"></p>

<p>I am currently working on more expansion boards, such as an LCD board, a sound card, and a VGA card. <a href="https://jfoucher.com/feed.xml">Stay tuned</a> for more.</p>

<p>For more details about this project, please use the links below:</p>

<ul>
  <li><a href="https://planck6502.jfoucher.com/">Project website</a></li>
  <li><a href="https://gitlab.com/planck-6502/planck-6502">Hardware and source code</a></li>
</ul>



  </div></div>]]>
            </description>
            <link>https://jfoucher.com/2021/02/planck-6502-open-hardware-computer.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-26298278</guid>
            <pubDate>Sun, 28 Feb 2021 23:54:12 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Squeak: A Free Smalltalk System ‚Äì On RISC OS]]>
            </title>
            <description>
<![CDATA[
Score 48 | Comments 7 (<a href="https://news.ycombinator.com/item?id=26298075">thread link</a>) | @lproven
<br/>
February 28, 2021 | http://www.rowledge.org/tim/squeak/ | <a href="https://web.archive.org/web/*/http://www.rowledge.org/tim/squeak/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
			<!-- .sidebarContainer -->
			<div>
				<p><span>Squeak: A Free Smalltalk system</span></p><p><img alt="" src="http://www.rowledge.org/tim/squeak/files/page17_1.jpg" width="295" height="205"><br></p><p><span>What is Squeak?</span><br>Squeak is a free Smalltalk system originally released by a team including Alan Kay, Dan Ingalls, Ted Kaehler, John Maloney and Scott Wallace in 1996 when they were working at Apple. You might recognise the first three names from early Smalltalk papers from Xerox PARC. They produced a rather nice Smalltalk system with the unusual virtue that both the image and the Virtual Machine are open source - i.e. free, gratis and "no charge to you sir".<br><span>Finding Out More About Squeak</span><br>To find most of the web resources for Squeak, look at the <a href="http://www.squeak.org/" rel="self">Squeak.Org</a> site. There are lots of pointers to information about Smalltalk, instructions for downloading Squeak, tutorials, FAQs etc. I won't waste space by duplicating any of it here. I do most strongly recommend that you read many of them.<br><span>Squeak runs on...</span><br>Macs, iPhones, most UNIX &amp; Linux systems, Windows of various versions, <a href="http://www.riscos.org/" rel="external">RISC OS</a> and some obscure specialised systems. See the above mentioned master page for details on how to get the files.<br>I‚Äôve spent many years making Smalltalk available for RISC OS and other <a href="http://www.arm.com/" rel="self">ARM</a> based systems including the original Acorn Archimedes &amp; RPC desktops, the Active Book, an early prototype version of the Compaq ‚ÄòiPaq‚Äô handheld, the Interval Research ‚ÄòMediaPad‚Äô, an HP prototype pad-thing and other stuff still secret.<br><span>New News of a newsish nature</span><br>2013 - Squeak is back on RISC OS! Those nice people at the <a href="http://www.rowledge.org/tim/squeak/www.raspberrypi.org" rel="external">Raspberry Pi Foundation</a> sent me a Pi; it has RISC OS on it and I‚Äôve been getting things working on it. </p><p><img alt="IMG_0467" src="http://www.rowledge.org/tim/squeak/files/img_0467.jpg" width="519" height="388"><br></p><div><p>It runs quite nicely in general; the Pi‚Äôs RISC OS graphics kernel is a bit slow seeming right now but there is work being done that should improve that significantly. It supports <a href="http://scratch.mit.edu/" rel="external">Scratch</a> as well and runs it decently - though there is a lot of work being done to improve that, too. Somewhat perversely, MIT decided to rewrite Scratch in Flash (belch) ‚Äòfor better browser support‚Äô and seem to have abandoned the ‚Äòold‚Äô Squeak based system. Since Flash doesn‚Äôt run on RISC OS  nor indeed on ARM systems in general, we‚Äôll be supporting ‚Äòold‚Äô Scratch for a while.<br>You can download a copy of Squeak for RISC OS from the central <a href="http://www.squeakvm.org/riscos" rel="external">squeakvm.org </a>site.<br>Currently I‚Äôm working for the Pi foundation to improve Scratch under Raspbian (their linux version) by rewriting some of the more egregiously ugly code, improve algorithms, tweak vm configurations and so on. As of early-2014 it‚Äôs significantly faster than the original version with a fair bit more to come. A major project has been <a href="http://www.raspberrypi.org/test-tims-nuscratch-beta/" rel="external">porting the code forwar</a>d to the latest Squeak image so that it can run on the most modern VMs; right now it is using the ‚ÄòStackVM‚Äô. I hope to get the newer design dynamic translating VM working soon.<br>When and if possible all of this will get moved over to RISC OS but making a living comes first!</p><p> <span>Building the VM with VMMaker</span><br>I also developed and for many years maintained the VMMaker package, the lump of Squeak code that defines and generates the bulk of the VM. See the VMMaker page on the <a href="http://wiki.squeak.org/squeak" rel="self">Squeak Swiki</a> for more info. You can fetch the VMMaker package from <a href="http://map1.squeakfoundation.org/sm" rel="self">SqueakMap</a> or use the SqueakMap tool in the image and look for (guess what) VMMaker. You will also need a <a href="http://subversion.tigris.org/" rel="external">SubVersion</a> client so that you can fetch the handwritten parts of the VM source code from the repository.<br>Once you have mastered the complexities of the VMMaker and successfully built yourself a custom VM you should download<a href="http://www.rowledge.org/resources/tim's-Home-page/Squeak/SqueakVMBuilderCertificate.pdf" rel="self"> this certificat</a>e to attest to your mighty geekiness.<br><span>Stuff wot I wrot</span><br>	‚Ä¢	I contributed a chapter describing the structure, function, design and implementation of virtual machines and the lowest level of Smalltalk code to <a href="http://www.amazon.com/Squeak-Open-Personal-Computing-Multimedia/dp/0130280917" rel="external">"Squeak: Open Personal Computing and Multimedia"</a> edited by Mark Guzdial and Kim Rose, published by Prentiss-Hall. An online version of <a href="http://www.rowledge.org/resources/tim's-Home-page/Squeak/OE-Tour.pdf" rel="self">that chapter is here</a>.<br>	‚Ä¢	I worked on a <a href="http://www.rowledge.org/resources/tim's-Home-page/Squeak/RTOSinSmalltalk.html.pdf" rel="self">realtime OS in Squeak</a> whilst employed at Interval Research Corp<br>	‚Ä¢	A short paper on making <a href="http://www.rowledge.org/resources/tim's-Home-page/Squeak/LEBB.pdf" rel="self">BitBlt work for little-endian</a> machines without having an intermediate display-on-screen conversion<br><span>Squeak logo artwork</span><br>At the dawn of Squeak-time we needed a logo. Every project needs a logo. I designed one, it caught on and can be found all over the web, on T-shirts, sweatshirts, books, badges, underwear, hats and probably secret spy satellites in geosynchronous orbit. (No, seriously; there is now at least one satellite running Squeak code!)<br>Here are some files of the Squeak logo that you may like to use:-</p></div><p>Feel free to download them and use them for links etc. If you'd like any other size, I can easily generate them for you from vector artwork. If you want to use it for a project of some sort relating to Squeak you are most welcome to do so - if you are making a neat badge or shirt or publishing a book I‚Äôd love a copy if at all practical.</p>
				
			</div><!-- .content -->
		</div></div>]]>
            </description>
            <link>http://www.rowledge.org/tim/squeak/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26298075</guid>
            <pubDate>Sun, 28 Feb 2021 23:21:29 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[OMU ‚Äì ‚ÄúOne Man Unix‚Äù]]>
            </title>
            <description>
<![CDATA[
Score 125 | Comments 25 (<a href="https://news.ycombinator.com/item?id=26298022">thread link</a>) | @marcodiego
<br/>
February 28, 2021 | http://www.pix.net/mirrored/discordia.org.uk/~steve/omu.html | <a href="https://web.archive.org/web/*/http://www.pix.net/mirrored/discordia.org.uk/~steve/omu.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page">
<center>

</center>
<h2>
History:
</h2>
In the late 1970s and early 1980s (the good old days of "hobby computing") before
the IBM PC and its clones took over the world, various microprocessor based kits
appeared on the hobbyist market. You could build a Z80-based board with 8K of
RAM, and with its hexadecimal keypad and LED display you could run simple
programs laboriously keyed in hex.
<p>
The first generation commercial machines also appeared - usually based on
the 8080 or the Z80 or 6502. The Commodore PET was one of the early sucesses
and it, along with the Commodore 64, Sinclair's three machines (ZX80, ZX81 and
Spectrum) and the BBC Micro probably accounted for most of the infant home-computer
market in Britain.
</p><p>
I decided on a different approach. Unhappy with the concept of having to re-live
the glory-days of the
<a href="http://www.computer50.org/mark1/MM1.html">
Manchester MkI
</a>
with the hobby-boards fraternity (!), and unhappy with the straitjacketed
architectures and joke operating systems of the 1st generation home computers,
I yearned for more. Specifically, what I wanted was something
more like a Unix clone at home. I was used to V7 Unix on the PDP-11 at university
and wasn't keen to step backwards 10 years to the technology of CP/M and BASIC
programming.
<br>
<i>
I wasn't to know that eight years later a guy called Linus
Torvalds was going to think the same thoughts and do much the same things. The
big difference was that he was in the right place and the right time and 
had internet connectivity - I didn't have any of these advantages!
</i>
</p><p>
I went off and built myself a 6809 based computer with 64K of RAM, a 360K
floppy disk drive and an RS232 interface which could drive a glass-TTY.
Please remember that this was 1982. Hard disks, megabytes of RAM and other
familiar modern things were a long way off.
</p><p>
After going through the usual hard work of writing a BIOS complete with
an S-records downloader, I was in a position to write myself an operating
system. Preliminary work on OMU started in late 1983. My earliest surviving
printouts of the sources on yellowed, faded lineprinter paper show that the
bulk of the work on OMU dates from March/April/May 1984.
</p><p>
Work was not helped by the fact that I was having to write a 'C' compiler
in parallel, but certainly by mid 1984 I had a perfectly usable O/S with a
primitive shell, a port of Unix 'ed' for an editor, and with 'fsck' and other
such tools available to repair the filestore disks when they got damaged by
miswrites from the rather dodgy floppy-disk hardware. I remember taking
the machine home over Christmas 1984 and typing up several reports using it
on the kitchen table.
</p><p>
<table>
<tbody><tr>
<td>
I just found this photo of the 1984 machine amongst a box of slides taken
over that Christmas. It appears to be the only photo of the machine I ever
took at the time.
<p>
At this point in its evolution, the hardware was mostly on one double
eurocard, with a floppy-disk interface piggybacked onto it. The floppy-disk
drive is in the metal box at front, and the bigger metal box at the RHS
of the PCBs is the power-supply.
</p></td>
<td>
<a href="http://www.pix.net/mirrored/discordia.org.uk/~steve/omu-big.jpg">
<img src="http://www.pix.net/mirrored/discordia.org.uk/~steve/omu.jpg">
</a>
</td>
</tr>
</tbody></table>
</p><h2>
Features and misfeatures list:
</h2>
<ul>
<li>
Tiny (24K) Kernel.
</li><li>
V7 Unix-compatable filestore (doesn't support triple-indirection blocks).
Not exactly critical on a floppy-disk-only system!
</li><li>
Normal Unix-style use of /dev/* files to interface to devices.
</li><li>
Mountable/dismountable filestores as expected.
</li><li>
Shell is built-in to save space, rather than run as a process.
</li><li>
tty driver is exceedingly minimal, but functional.
</li><li>
No true multitasking (see below).
</li><li>
UIDs and GIDs not implemented. They're ignored on the filestore, and the
process table doesn't bother to hold them. Any files created would be given
UID = GID = 0.
</li></ul>
<p>
The lack of an MMU and the small amount of RAM available meant that I
decided against trying to implement true multitasking. Instead (like DOS
as it happens) I came up with a scheme whereby a process could launch another
process, but would have to wait for it to complete. Clunky, but it worked
OK.
</p><p>
For your entertainment (or possibly if you're interested in the possibility
of porting my old O/S to more modern hardware like that old XT that's
gathering dust under your table) here's a downloadable copy of my
final version of the 6809 OMU as it stood in 1987:
</p><center>

</center>
<p>
In order to make any use of OMU, I had compiled up a set of utilities like
'ed' and 'mount' and 'fsck'. Sadly I don't think I can make their sources
downloadable here as they were based on the Unix V7 sources for which we had
a Bell Labs "academic use" licence at the university.
</p><p>
<strong>
<span color="#FF0000">
NEW!
</span>
</strong>
The above packages now include some utilities which I did write from scratch:
</p><ul>
<li><strong>adb</strong>
An interactive disassembler. (Doesn't debug core-dumps though, just lets
you look at code in files).
</li><li><strong>aka</strong>
("Also Known As") - finds other files hardlinked to the one mentioned on the
command-line.
</li><li><strong>chbase</strong>
Prints the number(s) given on the command-line in octal, decimal &amp; hex.
</li><li><strong>hex</strong>
Makes Motorola S-record files for sending to the 6809. Usually runs on a
host machine (a PDP-11 originally).
</li><li><strong>ida</strong>
An intelligent disassembler - shares source-code with 'adb' above.
</li><li><strong>sh</strong>
The tiny shell needed by the OMU kernel. OMU runs this as if it was the
'init' process.
</li><li><strong>sirius</strong>
An interactive disk-examination program.
</li><li><strong>unhex</strong>
A program to convert Motorola S-records into an OMU-loadable file. Usually
runs on the 6809 itself of course.
</li></ul>
Sorry, no documentation, but the source-code should be documentation enough!
<p>
I
<strong>
don't
</strong>
suggest any modern user of OMU on a 6809 tries getting GNU utilities running
with it! Bear in mind that V7 sources would compile into a smaller executable
than any modern GNU equivalents. With the 64K memory-address limitation of my
6809, this was important! The BIOS and O/S accounted for about 24K of this, so
user-programs were limited to about 40K total. I never did complete my
page-switched 256K memory system.....
</p><p>
Mind you, if you're contemplating porting to a 68000 or IBM-PC, the size
constraints will be much less of a problem.
</p><hr>
<p>
My work on OMU was pretty much unnoticed by anyone else in the world (we didn't
have an internet connection in those days), but others in the Electrical
Engineering dept at Swansea University saw the potential to port OMU to one of
several 68000 single-board-computers which began to appear in the department
from about 1984/85 onwards.
</p><p>
My colleage Terry Barnaby and I were variously involved with porting OMU
to several of these 68000 based SBCs. Terry did most of the work!
The first stage was merely to take OMU and get it to run on the new
hardware much as my 6809 version was doing already. This was accomplishe
reasonably quickly, complete with the addition of the OMU's first driver
for a hard-disk.
The much greater memory-addressing ability of the 68000 coupled with the
fact that the SBCs typically had 256K of RAM on board meant that this version
of OMU soon featured some multi-tasking capabilities (though with no MMU
available the processes had to be well-behaved).
</p><p>
For convenience, the details of the filestore layout and the system-call
interface of 68000 OMU was designed to duplicate those of the commercial 68000
V7 Unix system made by "Codata" (we had just taken delivery of two of these
units to augment the aging PDP-11).
It is I think a credit to OMU's potential that
it soon became possible to compile programs on the Codata, and run them on
OMU with no problems. Indeed, it was also possible to take system binaries
shipped with the Codata and run them on OMU too - an easy way to get 'vi'
and other state-of-the-art (!) software on OMU without having to dig out the
sources and recompile!
</p><center>

</center>
<p>
Terry Barnaby and another of his colleages Tim Ingersoll then made some
fundamental changes to the message-handling abilities of the 68000 OMU port to
make it suitable for Real-Time signal processing and control applications.
This was after all what the two of them really
wanted as part of their Ph.D projects...! In 1988 they finished their
projects, wrote up and left. Part of their legacy was the RTOS version of OMU,
and I managed to salvage a set of sources for that too:
</p><center>

</center>
<p>
If any reader of these pages feels suitably daring they may be able to
beat me to the target of porting OMU (probably working from Terry's and my
initial 68000 version above) to the IBM PC. I consider that there really is no
point in aiming for the 386 processor machines onwards as Linux already does
everything you could hope for on that class of machines.
</p><p>
It does however seem that there is mileage in starting with the boot-loader
that comes with
<a href="http://metalab.unc.edu/pub/micro/pc-stuff/freedos/">
FreeDOS
</a>,
and getting OMU to run on 8086/80286 machines of which there must be
<strong>
loads
</strong>
lying around virtually unwanted these days.
</p><p>
If you do decide to try such a thing, then I wish you the best of luck and
I'll offer any email help I can. My email address is in the README file
included with the any of the sets of downloadable sources.
</p><h2>
Acknowledgements:
</h2>
My thanks go to Terry and Tim whose work in enhancing OMU is credited here
and really should have been reflected in a name-change from OMU back in the
Eighties! (I never did get it straight in my mind as to whether the "one man"
mentioned in the title were there to signify the number of authors or
the number of simultaneous users. Either way, neither was very relevant once
as the software started its modest spread in the department.)
<p>
My thanks also go to Alan Cox (he of Linux networking and kernel hacking fame)
without whose prodding this page might never have been written.
</p><center>
<a href="http://www.pix.net/mirrored/discordia.org.uk/~steve/steve.html">
Home
</a>
</center>
<hr>
<p>
Copyright (c) 1999, Steve Hosgood


</p></div>]]>
            </description>
            <link>http://www.pix.net/mirrored/discordia.org.uk/~steve/omu.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-26298022</guid>
            <pubDate>Sun, 28 Feb 2021 23:15:22 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Global Associative Arrays in PostgreSQL]]>
            </title>
            <description>
<![CDATA[
Score 16 | Comments 4 (<a href="https://news.ycombinator.com/item?id=26297204">thread link</a>) | @avivallssa
<br/>
February 28, 2021 | https://www.migops.com/blog/2021/02/28/handling-global-associative-arrays-in-postgresql/ | <a href="https://web.archive.org/web/*/https://www.migops.com/blog/2021/02/28/handling-global-associative-arrays-in-postgresql/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/>Unable to retrieve article]]>
            </description>
            <link>https://www.migops.com/blog/2021/02/28/handling-global-associative-arrays-in-postgresql/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26297204</guid>
            <pubDate>Sun, 28 Feb 2021 21:25:06 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Little League wants all your information]]>
            </title>
            <description>
<![CDATA[
Score 335 | Comments 160 (<a href="https://news.ycombinator.com/item?id=26296845">thread link</a>) | @ColinWright
<br/>
February 28, 2021 | https://honeypot.net/post/little-league-wants-all-your-information/ | <a href="https://web.archive.org/web/*/https://honeypot.net/post/little-league-wants-all-your-information/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
            
            <div>
                <h3>Little League wants all your information</h3>
                
                    <p><em></em>
                        <span> Sun, Feb 28, 2021 
                                           </span>
                        <em></em>
                        <span>2-minute read</span>
                    </p>
                
            </div>

            <p>To sign kids up for our city‚Äôs Little League baseball program, you have to prove that they‚Äôre residents, which is reasonable. What‚Äôs not reasonable is the amount of information you have to provide on the registration website. You have to upload scans of a document in each of 3 categories:</p>
<blockquote>
<p><strong>Proof of Residency 1</strong>
Choose one of the following: Driver‚Äôs license, School records, Vehicle records, Employment records, Insurance documents</p>
<p><strong>Proof of Residency 2</strong>
Choose one of the following: Welfare/child care records, Federal records, State records, Local records, Support payment records, Homeowner or tenant records, Military records</p>
<p><strong>Proof of Residency 3</strong>
Choose one of the following: Voter‚Äôs registration, Utility bills, Financial records, Medical records, Internet, cable, or satellite bills</p>
</blockquote>
<p>That alone is ripe for identity theft, but couple it with their privacy policy which includes this (emphasis mine):</p>
<blockquote>
<p>Without limitation, this typically requires the use of certain personal information, including registration data, event data, and other personal information, to provide program information, <strong>special offers or services through Little League and/or its trusted sponsors, partners, or licensees</strong>, to fulfill your requests for information or products/services, to maintain a list of verified and eligible participants, to maintain a list of volunteers and provide them with the operating tools to manage leagues, or to respond to your inquiries about our programs.</p>
</blockquote>
<p>In other words, you have to upload your most private information and agree to allow them to do as they like with it, including sharing it with whomever they like for any reason they choose.</p>
<p>This is unacceptable.</p>
</div></div>]]>
            </description>
            <link>https://honeypot.net/post/little-league-wants-all-your-information/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26296845</guid>
            <pubDate>Sun, 28 Feb 2021 20:38:48 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[The American-Dream-as-a-Service]]>
            </title>
            <description>
<![CDATA[
Score 21 | Comments 16 (<a href="https://news.ycombinator.com/item?id=26296397">thread link</a>) | @jger15
<br/>
February 28, 2021 | https://www.thepullrequest.com/p/the-american-dream-as-a-service | <a href="https://web.archive.org/web/*/https://www.thepullrequest.com/p/the-american-dream-as-a-service">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><h5>Austen Allred is the CEO and founder of Lambda School, a unique coding school that pioneered the ‚Äòincome-sharing agreement‚Äô (ISA) model, whereby students only pay if they‚Äôre hired in their field of study. Lambda came out of incubator Y Combinator, before which he lived in his two-door Honda Civic and scalped soccer tickets at Stanford Stadium to get by. Prior to Bay Area entrepreneurship, he did a two-year mission to the Ukraine where he learned Russian and knocked on lots of doors. The interview was conducted via Zoom with Austen in Southern Utah, from where he routinely tweets out enviable photography of Utah‚Äôs stunning landscape.</h5><p><strong>Your posts are some of the most uplifting things in my feed. They‚Äôre either screenshots from an internal Slack or a retweet, and it‚Äôs a Lambda student saying: I went from making $20,000 in some service job, and now I'm making $80,000/year doing something technical at (say) Cisco, and you've totally changed my life. </strong></p><p><strong>One thing you often post that I think isn‚Äôt obvious to people who don't run a socio-economic escalator is all the necessary polish and look-and-feel of being part of the bougie techie class. For example, how you have this email protocol to set up a meeting. Or that if you think you're underpaid, you go in and you say, </strong><em><strong>screw you, pay me more or I leave</strong></em><strong>. It's intriguing that you don‚Äôt only have to educate them to turn them into front end engineers, you also have to teach them the social skills around that to become that bougie techie person.</strong></p><p>That's one of the really weird things: The hiring process is not just a filter for skills, it's also a filter for class. And people don't talk about or acknowledge that. It's very clear in all these protocols that we have in tech that you and I understand, you have to learn them the hard way. I'll give you a couple of examples. When I was in sixth grade, I was selling stuff on eBay. I was just this kid trying to hustle, and I had this mentor/entrepreneur who came into high school every now and then and just talked with us. And I was like, okay, real talk! What do I need to do to be taken seriously, because nobody takes me seriously because I'm a 15-year-old kid? And he sat me down and he said: <em>We are going to start using this thing called Gmail</em>. <em>I'm going to send you an invite, and you're going to set up firstname.lastname@gmail.com, no numbers, no nonsense, nothing else, you're going to have no signature, and you're only ever going to send text emails for the rest of your life.</em> <em>That's step one</em>. He just walked me through all this really, really basic stuff. </p><p>There was this other time I was in college‚Ä¶I was hustling and trying to get into startups and there was this guy at a conference I wanted to work with, so I went up and talked to him. And I said <em>what can I do to be like you? </em>He gave me his business card and said <em>just ping me next week</em>. </p><p>I spent hours and hours and hours looking up what <em>ping me</em> meant. I couldn't find anything. So eventually I called somebody and said <em>hey, this guy said ping me. What does that mean?</em> <em>How do I ping? </em>And that person was like, <em>no, no, it‚Äôs a call or an email or anything really, just reach out to them. Doesn‚Äôt matter how.</em> <em>That's all that ping means</em>. <em>You know, like a cell tower. Ping!</em> I was like, <em>ohhhhhhhh!</em> There's so much little stuff like that. Another classic example is intros, right? Or using Google Calendar. I didn't know how to use Google Calendar until I showed up in my first job. Someone tells me, <em>I am gonna put some time on your calendar</em>. And I think: <em>Oh, I guess I have a calendar</em>. That's not obvious if you don't come from, frankly, a certain class. But all of those things are important; if you don't intro somebody the right way to a VC, they know you're a dunce, automatically. There‚Äôs nobody that sits you down and says <em>hey, you're gonna say thank you so-and-so, moving you to BCC</em>. It's not hard, but nobody ever tells you that anywhere.</p><h4>I've heard it described as ‚Äòthe bottom 1000 universities‚Äô: Assume there's some algorithm that spits out the combination of <em>is expensive</em> and <em>is ineffective</em>. There are at least 1000 universities in the US that should cease to exist. There are many universities that net do more harm than good.</h4><p><strong>There's no tech charm school that teaches you how to do all that stuff.</strong></p><p>Totally. And I'm sure there's more stuff. When one of our first students got hired at Uber, he showed up with his laptop. They tell him: <em>you're a mobile developer</em>. And he's like, <em>I can't be a mobile developer, I don't have a phone</em>. He didn't have a smartphone. So he called me freaking out: <em>What am I gonna do!? Uber wants to hire me. I don't have a smartphone.</em> I told him: <em>Uber does not care about that, Uber‚Äôs gonna have a thousand phones, that's the least of Uber‚Äôs worries. They're gonna give you a laptop too.</em> </p><p>Then he shows up to work on day one and they tell him: <em>Alright, you know, put in your bank account information here to get direct deposit.</em> He's like, <em>no just cut me a check and I‚Äôll run to the check-cashing store.</em> </p><p>The Uber people reached out to me and said: <em>We don‚Äôt know if this is going to work.</em> I was like, <em>he's a smart guy, it‚Äôs just that he doesn't have a bank account</em>. So now we set up bank accounts for every student that doesn't have a bank account. The best way I think to describe Lambda School is the American-Dream-as-a-service. </p><p><strong>Wow. That‚Äôs the corporate anthem right there.</strong></p><p>(Laughs.)</p><p><strong>There so much cultural encoding in an interview which, as you said, is just filtering for class. But‚Ä¶as these are technical people, there‚Äôs actually an objective standard of merit. </strong></p><p>There are a whole swath of white collar jobs that the interview process literally is like, <em>Hey, I'm gonna play a little verbal tennis with you and see if you can stand your ground and if you can, you get the job</em>. That's probably the average white collar job.</p><h4>That's one of the really weird things: The hiring process is not just a filter for skills, it's also a filter for class. And people don't talk about or acknowledge that. </h4><p><strong>Speaking of other jobs, do you see Lambda expanding to other fields? Is that even possible? </strong></p><p><strong>The thing that obviously aligns incentives is to look at education as a hard-nosed business proposition. I'm sure you personally care, but the reason why you care as a business owner is because you want them to get the job because otherwise you're not gonna get paid, right? You‚Äôve invested a year and a half in this person, and they can't blow it up because they don‚Äôt know about direct deposits, so you fix that. Which is good, and certainly a lot better than the business model universities have. But that model only works if there's some pretty predictable future stream of income along with pretty predictable employment demand. Can you imagine non-technical professions like trucking and nursing that have high demand and high wages? </strong></p><p>The cool thing about the incentive alignment is that we're not going to train you to be a sociologist, because it just doesn't work. A common critique of the ISA model is: <em>oh, now people aren't going to study poetry anymore.</em> And my response to that is: <em>yeah, we're not a university, we're a trade school</em>. The university has 18 million things that it does for you, and we cut cut off a tiny sliver of that, which is: we're going to help you get a better job, we're going to help you improve your state in life. That's all we do. </p><p>There are actually more high-paying jobs available than there are people to fill those roles. And that's true all over the place. I think about it as an optimization problem. You've got all this latent human potential, and it's just kind of bouncing around. Sometimes it goes to school, and it picks stuff at random to study, and you know what you know because of who you‚Äôre surrounded by.</p><p>One aspect of Lambda School that I think is underappreciated is a whole lot of people come in having no idea of what software is, having no idea that there's such a thing as a software engineer. We have people who join and think it's like, <em>I'm gonna fix printers</em>. They know that tech is a high-paying field, but they're not surrounded it. If you're in the inner city, or in a rural area, you don't know a computer programmer. </p><p>One way to think about Lambda is like fintech: You have all these transactions that are moving all over the place, but what makes it all work is a clearinghouse that moves all the money to where it needs to go. I think of Lambda as kind of an economic clearinghouse: Here's all of the untapped human potential, here's all the would-be labor, and over here‚Äôs all the jobs that need to be done. There's nothing connecting the two right now other than sheer happenstance and going to university, or maybe you hear that there's a good job over here somewhere.</p><p>But right now the situation is not: <em>I'm making $50k, here's my skill set and my interest, I want to make $90k</em>. Somebody should be able to tell you how to do that, and right now, nobody can. That‚Äôs crazy. More than half of GDP is just people working, and that's completely unoptimized. </p><p><strong>Right. Even I, who came from a middle-class background and went to the university track, it seemed like a recently poorly-managed process and I only ended up in science and technology by sheer happenstance‚Ä¶</strong></p><p>You stumbled in, yeah? I feel the same way, and the interesting thing now is, depending on which way you happen to stumble, you can end up fabulously rich or destitute based on your stumblings. </p><h4>The other broken piece is the notion that you go to school once for 10 years when you're 18, and you'll be able to ride that for the rest of your career. That‚Äôs probably false for a whole lot of people.</h4><p><strong>So this model you‚Äôre describing, where you basically connect people from one income level to another higher one via various different processes. I‚Äôm curious what other connections you can imagine existing. </strong></p><p>The way to answer that is to see where all the shortages are, where are people trying to hire and those people don‚Äôt exist? Tech is an obvious one, but it‚Äôs all over the place in ‚Ä¶</p></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://www.thepullrequest.com/p/the-american-dream-as-a-service">https://www.thepullrequest.com/p/the-american-dream-as-a-service</a></em></p>]]>
            </description>
            <link>https://www.thepullrequest.com/p/the-american-dream-as-a-service</link>
            <guid isPermaLink="false">hacker-news-small-sites-26296397</guid>
            <pubDate>Sun, 28 Feb 2021 19:46:14 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[How I cut GTA Online loading times by 70%]]>
            </title>
            <description>
<![CDATA[
Score 2818 | Comments 481 (<a href="https://news.ycombinator.com/item?id=26296339">thread link</a>) | @kuroguro
<br/>
February 28, 2021 | https://nee.lv/2021/02/28/How-I-cut-GTA-Online-loading-times-by-70/ | <a href="https://web.archive.org/web/*/https://nee.lv/2021/02/28/How-I-cut-GTA-Online-loading-times-by-70/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div itemprop="articleBody">
    <p>GTA Online. <a target="_blank" rel="noopener" href="https://www.reddit.com/r/gtaonline/comments/9vgo0g/how_the_fuck_are_20_minute_load_times_acceptable/">Infamous</a> for its slow loading times. Having picked up the game again to finish some of the newer heists I was <em>shocked</em> (/s) to discover that it still loads just as slow as the day it was released 7 years ago.</p>
<p>It was time. Time to get to the bottom of this.</p>
<h2 id="Recon"><a href="#Recon" title="Recon"></a>Recon</h2><p>First I wanted to check if someone had already solved this problem. Most of the results I found pointed towards anecdata about <a target="_blank" rel="noopener" href="https://metro.co.uk/2017/11/01/why-does-gta-v-take-so-long-to-load-7041927/">how the game is so sophisticated</a> that it needs to load so long, stories on how the <a target="_blank" rel="noopener" href="https://steamcommunity.com/app/271590/discussions/0/217690940938819317/">p2p network architecture</a> is rubbish (not saying that it isn‚Äôt), some elaborate ways of <a target="_blank" rel="noopener" href="https://gtaforums.com/topic/908000-fastest-way-to-load-into-gtao-single-player-first-or-straight-in/">loading into story mode and a solo session after that</a> and a couple of mods that allowed skipping the startup R* logo video. Some more reading told me we could save a whopping 10-30 seconds with these combined!</p>
<p>Meanwhile on my PC‚Ä¶</p>
<h2 id="Benchmark"><a href="#Benchmark" title="Benchmark"></a>Benchmark</h2><figure><table><tbody><tr><td><pre><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br></pre></td><td><pre><span>Story mode load time:  ~1m 10s</span><br><span>Online mode load time: ~6m flat</span><br><span>Startup menu disabled, time from R* logo until in-game (social club login time isn't counted).</span><br><span></span><br><span>Old but decent CPU:   AMD FX-8350</span><br><span>Cheap-o SSD:          KINGSTON SA400S37120G</span><br><span>We have to have RAM:  2x Kingston 8192 MB (DDR3-1337) 99U5471</span><br><span>Good-ish GPU:         NVIDIA GeForce GTX 1070</span><br></pre></td></tr></tbody></table></figure>

<p>I know my setup is dated but what on <em>earth</em> could take 6x longer to load into online mode? I couldn‚Äôt measure any difference using the story-to-online loading technique <a target="_blank" rel="noopener" href="https://www.reddit.com/r/gtaonline/comments/kycy7a/gtao_loading_times_using_different_methods/">as others have found before me</a>. Even if it did work the results would be down in the noise.</p>
<h2 id="I-Am-Not-Alone"><a href="#I-Am-Not-Alone" title="I Am (Not) Alone"></a>I Am (Not) Alone</h2><p>If <a target="_blank" rel="noopener" href="https://www.reddit.com/r/gtaonline/comments/ht4i56/your_average_online_loading_time/">this poll</a> is to be trusted then the issue is widespread enough to mildly annoy more than 80% of the player base. It‚Äôs been 7 years R*!</p>
<p><img src="https://nee.lv/images/pasted-0.png" alt="üéµWhat does the poll say?üéµ"></p>
<p>Looking around a bit to find who are the lucky ~20% that get sub 3 minute load times I came across <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=RdCqDdjp6iU">a</a> <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=pJzr3qfyCyg">few</a> <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=RK7BUFx_NGk">benchmarks</a> with high-end gaming PCs and an online mode load time of about 2 minutes. I would <del>kill</del> <em>hack</em> for a 2 minute load time! It does seem to be hardware-dependent but something doesn‚Äôt add up here‚Ä¶</p>
<p>How come their story mode still takes near a minute to load? (The M.2 one didn‚Äôt count the startup logos btw.) Also, loading story to online takes them only a minute more while I‚Äôm getting about five more. I know that their hardware specs are a lot better but surely not 5x better.</p>
<h2 id="Highly-accurate-measurements"><a href="#Highly-accurate-measurements" title="Highly accurate measurements"></a>Highly accurate measurements</h2><p>Armed with such powerful tools as <em>the Task Manager</em> I began to investigate what resources could be the bottleneck.</p>
<p><img src="https://nee.lv/images/pasted-1.png" alt="Can you smell it?"></p>
<p>After taking a minute to load the common resources used for both story and online modes (which is near on par with high-end PCs) GTA decides to max out a single core on my machine for four minutes and do nothing else.</p>
<p>Disk usage? None! Network usage? There‚Äôs a bit, but it drops basically to zero after a few seconds (apart from loading the rotating info banners). GPU usage? Zero. Memory usage? Completely flat‚Ä¶</p>
<p>What, is it mining crypto or something? I smell code. <em>Really bad code</em>.</p>
<h2 id="Single-thread-bound"><a href="#Single-thread-bound" title="Single thread-bound"></a>Single thread-bound</h2><p>While my old AMD CPU has 8 cores and it does pack a punch, it was made in the olden days. Back when AMD‚Äôs <a target="_blank" rel="noopener" href="https://valid.x86.fr/bench/6u7sdy/1">single-thread performance</a> was <em>way</em> behind Intel‚Äôs. This might not explain all of the load time differences but it should explain most of it.</p>
<p>What‚Äôs odd is that it‚Äôs using up <em>just</em> the CPU. I was expecting vast amounts of disk reads loading up resources or loads of network requests trying to negotiate a session in the p2p network. But this? This is probably a bug.</p>
<h2 id="Profiling"><a href="#Profiling" title="Profiling"></a>Profiling</h2><p>Profilers are a great way of finding CPU bottlenecks. There‚Äôs only one problem - most of them rely on instrumenting the source code to get a perfect picture of what‚Äôs happening in the process. And I don‚Äôt have the source code. Nor do I need microsecond-perfect readings - I have 4 minutes‚Äô worth of a bottleneck.</p>
<p>Enter stack sampling: for closed source applications there‚Äôs only one option. Dump the running process‚Äô stack and current instruction pointer‚Äôs location to build a calling tree in set intervals. Then add them up to get statistics on what‚Äôs going on. There‚Äôs only one profiler that I know of (might be ignorant here) that can do this on Windows. And it hasn‚Äôt been updated in over 10 years. It‚Äôs <a target="_blank" rel="noopener" href="http://lukestackwalker.sourceforge.net/">Luke Stackwalker</a>! Someone, please give this project some love :)</p>
<p><img src="https://nee.lv/images/pasted-2.png" alt="The power of statistics compels you!"></p>
<p>Normally Luke would group the same functions together but since I don‚Äôt have debugging symbols I had to eyeball nearby addresses to guess if it‚Äôs the same place. And what do we see? Not one bottleneck but two of them!</p>
<h2 id="Down-the-rabbit-hole"><a href="#Down-the-rabbit-hole" title="Down the rabbit hole"></a>Down the rabbit hole</h2><p>Having borrowed <em>my friend‚Äôs</em> completely legitimate copy of <em>the industry-standard disassembler</em> (no, I really can‚Äôt afford the thing‚Ä¶ gonna learn to <a target="_blank" rel="noopener" href="https://ghidra-sre.org/">ghidra</a> one of these days) I went to take GTA apart.</p>
<p><img src="https://nee.lv/images/pasted-3.png" alt="Gibberish Galore"></p>
<p>That doesn‚Äôt look right at all. Most high-profile games come with built-in protection against reverse engineering to keep away pirates, cheaters, and modders. Not that it has ever stopped them.</p>
<p>There seems to be some sort of an obfuscation/encryption at play here that has replaced most instructions with gibberish. Not to worry, we simply need to dump the game‚Äôs memory while it‚Äôs executing the part we want to look at. The instructions have to be de-obfuscated before running one way or another. I had <a target="_blank" rel="noopener" href="https://github.com/glmcdona/Process-Dump">Process Dump</a> lying around, so I used that, but there are plenty of other tools available to do this sort of thing.</p>
<h2 id="Problem-one-It‚Äôs‚Ä¶-strlen"><a href="#Problem-one-It‚Äôs‚Ä¶-strlen" title="Problem one: It‚Äôs‚Ä¶ strlen?!"></a>Problem one: It‚Äôs‚Ä¶ strlen?!</h2><p>Disassembling the now-less-obfuscated dump reveals that one of the addresses has a label pulled out of somewhere! It‚Äôs <code>strlen</code>? Going down the call stack the next one is labeled <code>vscan_fn</code> and after that the labels end, tho I‚Äôm fairly confident it‚Äôs <a target="_blank" rel="noopener" href="https://github.com/chakra-core/ChakraCore/blob/master/pal/src/safecrt/sscanf.c#L47"><code>sscanf</code></a>.</p>
<p><img src="https://nee.lv/images/pasted-4.png" alt="A graph a day keeps the skeptics away"></p>
<p>It‚Äôs parsing something. Parsing what? Untangling the disassembly would take forever so I decided to dump some samples from the running process using <a target="_blank" rel="noopener" href="https://x64dbg.com/">x64dbg</a>. Some debug-stepping later it turns out it‚Äôs‚Ä¶ JSON! They‚Äôre parsing JSON. A whopping <strong>10 megabytes</strong> worth of JSON with some <strong>63k item entries</strong>.</p>
<figure><table><tbody><tr><td><pre><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br></pre></td><td><pre><span>...,</span><br><span>{</span><br><span>    <span>"key"</span>: <span>"WP_WCT_TINT_21_t2_v9_n2"</span>,</span><br><span>    <span>"price"</span>: <span>45000</span>,</span><br><span>    <span>"statName"</span>: <span>"CHAR_KIT_FM_PURCHASE20"</span>,</span><br><span>    <span>"storageType"</span>: <span>"BITFIELD"</span>,</span><br><span>    <span>"bitShift"</span>: <span>7</span>,</span><br><span>    <span>"bitSize"</span>: <span>1</span>,</span><br><span>    <span>"category"</span>: [<span>"CATEGORY_WEAPON_MOD"</span>]</span><br><span>},</span><br><span>...</span><br></pre></td></tr></tbody></table></figure>

<p>What is it? It appears to be data for a ‚Äúnet shop catalog‚Äù according to some references. I assume it contains a list of all the possible items and upgrades you can buy in GTA Online.</p>
<p><strong>Clearing up some confusion: I beleive these are in-game money purchasable items, not directly linked with <a target="_blank" rel="noopener" href="https://gta.fandom.com/wiki/Cash_Cards">microtransactions</a>.</strong></p>
<p>But 10 megs? That‚Äôs nothing! And using <code>sscanf</code> may not be optimal but surely it‚Äôs not that bad? Well‚Ä¶</p>
<p><img src="https://nee.lv/images/pasted-5.png" alt="Ouch!"></p>
<p>Yeah, that‚Äôs gonna take a while‚Ä¶ To be fair I had no idea most <code>sscanf</code> implementations called <code>strlen</code> so I can‚Äôt blame the developer who wrote this. I would assume it just scanned byte by byte and could stop on a <code>NULL</code>.</p>
<h2 id="Problem-two-Let‚Äôs-use-a-Hash-‚Ä¶-Array"><a href="#Problem-two-Let‚Äôs-use-a-Hash-‚Ä¶-Array" title="Problem two: Let‚Äôs use a Hash- ‚Ä¶ Array?"></a>Problem two: Let‚Äôs use a Hash- ‚Ä¶ Array?</h2><p>Turns out the second offender is called right next to the first one. They‚Äôre both even called in the same <code>if</code> statement as seen in this ugly decompilation:</p>
<p><img src="https://nee.lv/images/pasted-6.png" alt="Beggar thy neighbour"></p>
<p>All labels are mine, no idea what the functions/parameters are actually called.</p>
<p>The second problem? Right after parsing an item, it‚Äôs stored in an array (or an inlined C++ list? not sure). Each entry looks something like this:</p>
<figure><table><tbody><tr><td><pre><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br></pre></td><td><pre><span><span><span>struct</span> {</span></span><br><span>    <span>uint64_t</span> *hash;</span><br><span>    <span>item_t</span>   *item;</span><br><span>} entry;</span><br></pre></td></tr></tbody></table></figure>

<p>But before it‚Äôs stored? It checks the <em>entire</em> array, one by one, comparing the hash of the item to see if it‚Äôs in the list or not. With ~63k entries that‚Äôs <code>(n^2+n)/2 = (63000^2+63000)/2 = 1984531500</code> checks if my math is right. Most of them useless. You have unique <em>hashes</em> why not use a <em>hash map</em>.</p>
<p><img src="https://nee.lv/images/pasted-7.png" alt="Oof!"></p>
<p>I named it <code>hashmap</code> while reversing but it‚Äôs clearly <code>not_a_hashmap</code>. And it gets even better. The hash-array-list-thing is empty before loading the JSON. And all of the items in the JSON are unique! They don‚Äôt even <em>need</em> to check if it‚Äôs in the list or not! They even have a function to directly insert the items! Just use that! Srsly, WAT!?</p>
<h2 id="PoC"><a href="#PoC" title="PoC"></a>PoC</h2><p>Now that‚Äôs nice and all, but no one is going to take me seriously unless I test this so I can write a clickbait title for the post.</p>
<p>The plan? Write a <code>.dll</code>, inject it in GTA, <a target="_blank" rel="noopener" href="https://github.com/TsudaKageyu/minhook">hook</a> some functions, ???, profit.</p>
<p>The JSON problem is hairy, I can‚Äôt realistically replace their parser. Replacing <code>sscanf</code> with one that doesn‚Äôt depend on <code>strlen</code> would be more realistic. But there‚Äôs an even easier way.</p>
<ul>
<li>hook strlen</li>
<li>wait for a long string</li>
<li>‚Äúcache‚Äù the start and length of it</li>
<li>if it‚Äôs called again within the string‚Äôs range, return cached value</li>
</ul>
<p>Something like:</p>
<figure><table><tbody><tr><td><pre><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br></pre></td><td><pre><span><span><span>size_t</span> <span>strlen_cacher</span><span>(<span>char</span>* str)</span></span></span><br><span><span></span>{</span><br><span>  <span>static</span> <span>char</span>* start;</span><br><span>  <span>static</span> <span>char</span>* end;</span><br><span>  <span>size_t</span> len;</span><br><span>  <span>const</span> <span>size_t</span> cap = <span>20000</span>;</span><br><span></span><br><span>  </span><br><span>  <span>if</span> (start &amp;&amp; str &gt;= start &amp;&amp; str &lt;= end) {</span><br><span>    </span><br><span>    len = end - str;</span><br><span></span><br><span>    </span><br><span>    </span><br><span>    <span>if</span> (len &lt; cap / <span>2</span>)</span><br><span>      MH_DisableHook((LPVOID)strlen_addr);</span><br><span></span><br><span>    </span><br><span>    <span>return</span> len;</span><br><span>  }</span><br><span></span><br><span>  </span><br><span>  </span><br><span>  </span><br><span>  len = builtin_strlen(str);</span><br><span></span><br><span>  </span><br><span>  </span><br><span>  <span>if</span> (len &gt; cap) {</span><br><span>    start = str;</span><br><span>    end = str + len;</span><br><span>  }</span><br><span></span><br><span>  </span><br><span>  <span>return</span> len;</span><br><span>}</span><br></pre></td></tr></tbody></table></figure>

<p>And as for the hash-array problem, it‚Äôs more straightforward - just skip the duplicate checks entirely and insert the items directly since we know the values are unique.</p>
<figure><table><tbody><tr><td><pre><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br></pre></td><td><pre><span><span><span>char</span> __fastcall <span>netcat_insert_dedupe_hooked</span><span>(<span>uint64_t</span> catalog, <span>uint64_t</span>* key, <span>uint64_t</span>* item)</span></span></span><br><span><span></span>{</span><br><span>  </span><br><span>  <span>uint64_t</span> not_a_hashmap = catalog + <span>88</span>;</span><br><span></span><br><span>  </span><br><span>  <span>if</span> (!(*(<span>uint8_t</span>(__fastcall**)(<span>uint64_t</span>*))(*item + <span>48</span>))(item))</span><br><span>    <span>return</span> <span>0</span>;</span><br><span></span><br><span>  </span><br><span>  netcat_insert_direct(not_a_hashmap, key, &amp;item);</span><br><span></span><br><span>  </span><br><span>  </span><br><span>  <span>if</span> (*key == <span>0x7FFFD6BE</span>) {</span><br><span>    MH_DisableHook((LPVOID)netcat_insert_dedupe_addr);</span><br><span>    unload();</span><br><span>  }</span><br><span></span><br><span>  <span>return</span> <span>1</span>;</span><br><span>}</span><br></pre></td></tr></tbody></table></figure>

<p>Full source of PoC <a target="_blank" rel="noopener" href="https://github.com/tostercx/GTAO_Booster_PoC">here</a>.</p>
<h2 id="Results"><a href="#Results" title="Results"></a>Results</h2><p>Well, did it work then?</p>
<figure><table><tbody><tr><td><pre><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br></pre></td><td><pre><span>Original online mode load time:        ~6m flat</span><br><span>Time with only duplication check patch: 4m 30s</span><br><span>Time with only JSON parser patch:       2m 50s</span><br><span>Time with both issues patched:          1m 50s</span><br><span></span><br><span>(6*60 - (1*60+50)) / (6*60) = 69.4% load time improvement (nice!)</span><br></pre></td></tr></tbody></table></figure>

<p>Hell yes, it did! :))</p>
<p>Most likely, this won‚Äôt solve everyone‚Äôs load times - there might be other bottlenecks on different systems, but it‚Äôs such a gaping hole that I have no idea how R* has missed it all these years.</p>
<h2 id="tl-dr"><a href="#tl-dr" title="tl;dr"></a>tl;dr</h2><ul>
<li>There‚Äôs a single thread CPU bottleneck while starting up GTA Online</li>
<li>It turns out GTA struggles to parse a 10MB JSON file</li>
<li>The JSON parser itself is poorly built / naive and</li>
<li>After parsing there‚Äôs a ‚Ä¶</li></ul></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://nee.lv/2021/02/28/How-I-cut-GTA-Online-loading-times-by-70/">https://nee.lv/2021/02/28/How-I-cut-GTA-Online-loading-times-by-70/</a></em></p>]]>
            </description>
            <link>https://nee.lv/2021/02/28/How-I-cut-GTA-Online-loading-times-by-70/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26296339</guid>
            <pubDate>Sun, 28 Feb 2021 19:38:26 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Create animated GIF and WebP from videos using FFmpeg]]>
            </title>
            <description>
<![CDATA[
Score 150 | Comments 47 (<a href="https://news.ycombinator.com/item?id=26296315">thread link</a>) | @Audiolite
<br/>
February 28, 2021 | https://mattj.io/posts/2021-02-27-create-animated-gif-and-webp-from-videos-using-ffmpeg/ | <a href="https://web.archive.org/web/*/https://mattj.io/posts/2021-02-27-create-animated-gif-and-webp-from-videos-using-ffmpeg/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><article class="page">
    <div>
      
      <div>

        

<p>Saturday, February 27, 2021</p>

<p><a href="https://mattj.io/posts/">Click here to go to all posts</a>. <em>Also published on <a href="https://mattjoseph.medium.com/create-animated-gif-and-webp-from-videos-using-ffmpeg-f1012267935a" target="_blank" rel="noopener">Medium</a></em></p>

<p><em>A guide to using FFmpeg to create all the animated content you want.</em></p>

<p>Whether it‚Äôs for a website, a presentation, or sharing a fun clip with a friend on chat, you might want to convert a video to an animated GIF or animated WebP. Unfortunately, the visual tools for doing this vary by your operating system. Additionally, most conversion tools don‚Äôt support <a href="https://en.wikipedia.org/wiki/WebP" target="_blank" rel="noopener">the WebP format</a>, even in 2021. WebP is based on VP8, a relatively recent video codec standard compared to the <a href="https://en.wikipedia.org/wiki/GIF" target="_blank" rel="noopener">GIF image format</a>.</p>

<p>So, this guide is for those who are willing to learn a bit of terminal in order to convert any video to the animated format of their choosing. The best part: this will work on all major operating systems and gives you all the control of the output you could want!</p>


<figcaption>Example GIF of typing "GIF" on a mechanical keyboard</figcaption>

<p>Let‚Äôs get started!</p>

<h2 id="prerequisites">Prerequisites</h2>

<p>To use this guide, you will need the following:</p>

<ul>
  <li>Basic knowledge of how to open and use the terminal on your operating system. If you need a cheat sheet or introductory guides, check out <a href="https://terminalcheatsheet.com/" target="_blank" rel="noopener">Terminal Cheat Sheet</a>.</li>
  <li>FFmpeg v4+ installed on your operating system and executable from your path. Here are some suggested places to learn down to do this:
    <ul>
      <li>macOS: <a href="https://superuser.com/a/624562" target="_blank" rel="noopener">https://superuser.com/a/624562</a></li>
      <li>Windows: <a href="https://video.stackexchange.com/a/20496" target="_blank" rel="noopener">https://video.stackexchange.com/a/20496</a></li>
      <li>Linux: Use your preferred package manager (e.g., <code>sudo apt install ffmpeg</code> on Ubuntu)</li>
    </ul>
  </li>
</ul>

<h2 id="what-isffmpeg">What is&nbsp;FFmpeg?</h2>

<p><a href="https://en.wikipedia.org/wiki/FFmpeg" target="_blank" rel="noopener">From Wikipedia</a>:</p>

<blockquote>
  <p>FFmpeg is a free and open-source software project consisting of a large suite of libraries and programs for handling video, audio, and other multimedia files and streams.</p>
</blockquote>

<p>For our purposes, we will use it to convert between formats, such as videos to GIFs or animated WebP. It has many uses, so I recommend checking it out for all your video processing needs!</p>

<h2 id="before-you-start-make-sure-you-can-run-ffmpeg-from-yourterminal">Before you start: make sure you can run FFmpeg from your&nbsp;terminal</h2>

<p>Since all of these commands require FFmpeg, we need to make sure it‚Äôs available.</p>

<p>Open your terminal, and run this:</p>



<p>If FFmpeg is available, you will note output similar to this:</p>

<div><div><pre><code>FFmpeg version 4.3.1 Copyright ¬© 2000‚Äì2020 the FFmpeg developers
...
</code></pre></div></div>


<figcaption>Checking the FFmpeg version on Linux</figcaption>

<p>Version 4 or higher of FFmpeg is recommended for this guide.</p>

<p>If you get an output that says something similar to <code>command not found: ffmpeg -version</code>, then check the <strong>Prerequisites</strong> section above and make sure you have FFmpeg installed on your system.</p>

<h2 id="convert-to-an-animated-gif-usingffmpeg">Convert to an animated GIF using&nbsp;FFmpeg</h2>

<h3 id="convert-a-whole-video-togif">Convert a whole video to&nbsp;GIF</h3>

<p><strong>Base command</strong></p>

<div><div><pre><code>ffmpeg -i $INPUT_FILENAME \
-vf "fps=$OUTPUT_FPS,scale=$OUTPUT_WIDTH:-1:flags=lanczos,split[s0][s1];[s0]palettegen[p];[s1][p]paletteuse" \
-loop $NUMBER_OF_LOOPS $OUTPUT_FILENAME

# Change these placeholders:
# * $INPUT_FILENAME - path to the input video.
# * $OUTPUT_FPS - ouput frames per second. Start with `10`.
# * $OUTPUT_WIDTH - output width in pixels. Aspect ratio is maintained.
# * $NUMBER_OF_LOOPS - use `0` to loop forever, or a specific number of loops.
# * $OUTPUT_FILENAME - the name of the output animated GIF.
</code></pre></div></div>

<p><strong>Example usage of this command</strong></p>

<p>Here is an example of this command with the input options filled out:</p>

<div><div><pre><code>ffmpeg -i "sample_recording.mp4" \
-vf "fps=10,scale=720:-1:flags=lanczos,split[s0][s1];[s0]palettegen[p];[s1][p]paletteuse" \
-loop 0 sample_recording.gif
</code></pre></div></div>

<h3 id="convert-part-of-a-video-togif">Convert part of a video to&nbsp;GIF</h3>

<p><strong>Base command</strong></p>

<p>This is the base command with various options for converting part of a video to an animated GIF:</p>

<div><div><pre><code>ffmpeg -ss $INPUT_START_TIME -t $LENGTH -i $INPUT_FILENAME \
-vf "fps=$OUTPUT_FPS,scale=$OUTPUT_WIDTH:-1:flags=lanczos,split[s0][s1];[s0]palettegen[p];[s1][p]paletteuse" \
-loop $NUMBER_OF_LOOPS $OUTPUT_FILENAME

# Change these placeholders:
# * $INPUT_START_TIME - number of seconds in the input video to start from.
# * $LENGTH - number of seconds to convert from the input video.
# * $INPUT_FILENAME - path to the input video.
# * $OUTPUT_FPS - ouput frames per second. Start with `10`.
# * $OUTPUT_WIDTH - output width in pixels. Aspect ratio is maintained.
# * $NUMBER_OF_LOOPS - use `0` to loop forever, or a specific number of loops.
# * $OUTPUT_FILENAME - the name of the output animated GIF.
</code></pre></div></div>

<p><strong>Example usage of this command</strong></p>

<p>Here is an example of this command with the input options filled out:</p>

<div><div><pre><code>ffmpeg -ss 32.5 -t 7 -i "sample_recording.mp4" \
-vf "fps=10,scale=720:-1:flags=lanczos,split[s0][s1];[s0]palettegen[p];[s1][p]paletteuse" \
-loop 0 sample_recording.gif
</code></pre></div></div>

<h2 id="convert-to-an-animated-webp-usingffmpeg">Convert to an animated WebP using&nbsp;FFmpeg</h2>

<h3 id="convert-a-whole-video-to-animatedwebp">Convert a whole video to animated&nbsp;WebP</h3>

<p><strong>Base command</strong></p>

<p>This is the base command with various options for converting an entire video to an animated WebP. You can use options like FPS, output width, and quality to determine the file size and quality of your output:</p>

<div><div><pre><code>ffmpeg -i $INPUT_FILENAME \
-vf "fps=$OUTPUT_FPS,scale=$OUTPUT_WIDTH:-1:flags=lanczos" \
-vcodec libwebp -lossless 0 -compression_level 6 \
-q:v $OUTPUT_QUALITY -loop $NUMER_OF_LOOPS \
-preset picture -an -vsync 0 $OUTPUT_FILENAME

# Change these placeholders:
# * $INPUT_FILENAME - path to the input video.
# * $OUTPUT_FPS - ouput frames per second. Start with `10`.
# * $OUTPUT_WIDTH - output width in pixels. Aspect ratio is maintained.
# * $OUTPUT_QUALITY - quality of the WebP output. Start with `50`.
# * $NUMBER_OF_LOOPS - use `0` to loop forever, or a specific number of loops.
# * $OUTPUT_FILENAME - the name of the output animated WebP.
</code></pre></div></div>

<p><strong>Example usage of this command</strong></p>

<p>Here is an example of this command with the input options filled out:</p>

<div><div><pre><code>ffmpeg -i "sample_recording.mp4" \
-vf "fps=10,scale=720:-1:flags=lanczos" \
-vcodec libwebp -lossless 0 -compression_level 6 \
-q:v 50 -loop 0 \
-preset picture -an -vsync 0 sample_recording.webp
</code></pre></div></div>

<h3 id="convert-part-of-a-video-to-animatedwebp">Convert part of a video to animated&nbsp;WebP</h3>

<p><strong>Base command</strong></p>

<p>This is the base command with various options for converting part of a video to an animated WebP:</p>

<div><div><pre><code>ffmpeg -ss $INPUT_START_TIME -t $LENGTH -i $INPUT_FILENAME \
-vf "fps=$OUTPUT_FPS,scale=$OUTPUT_WIDTH:-1:flags=lanczos" \
-vcodec libwebp -lossless 0 -compression_level 6 \
-q:v $OUTPUT_QUALITY -loop $NUMER_OF_LOOPS \
-preset picture -an -vsync 0 $OUTPUT_FILENAME

# Change these placeholders:
# * $INPUT_START_TIME - number of seconds in the input video to start from.
# * $LENGTH - number of seconds to convert from the input video.
# * $INPUT_FILENAME - path to the input video.
# * $OUTPUT_FPS - ouput frames per second. Start with `10`.
# * $OUTPUT_WIDTH - output width in pixels. Aspect ratio is maintained.
# * $OUTPUT_QUALITY - quality of the WebP output. Start with `50`.
# * $NUMBER_OF_LOOPS - use `0` to loop forever, or a specific number of loops.
# * $OUTPUT_FILENAME - the name of the output animated WebP.
</code></pre></div></div>

<p><strong>Example usage of this command</strong></p>

<p>Here is an example of this command with the input options filled out:</p>

<div><div><pre><code>ffmpeg -ss 32.5 -t 7 -i "sample_recording.mp4" \
-vf "fps=10,scale=720:-1:flags=lanczos" \
-vcodec libwebp -lossless 0 -compression_level 6 \
-q:v 50 -loop 0 \
-preset picture -an -vsync 0 sample_recording.webp
</code></pre></div></div>

<h2 id="when-should-i-use-an-animated-gif-versus-an-animatedwebp">When should I use an animated GIF versus an animated&nbsp;WebP?</h2>

<p>This depends on the quality, size, and support you want for your output. Modern browsers have support for animated WebP and the quality tends to be higher, but the processing power required is also higher.</p>

<h2 id="next-steps">Next steps</h2>

<p>This guide serves as a brief introduction to using FFmpeg to create an animated GIF or animated WebP from a video, but there is so much more you can do with the tool. There are also many options that FFmpeg supports for these formats that are not covered.</p>

<p>You can also get the code for all the commands and examples in one place by <a href="https://gist.github.com/devadvance/f2ad3cfe38afe3eeef64c72c46692158" target="_blank" rel="noopener">visiting the GitHub Gist here</a>.</p>


      </div>
    </div>
  </article></div>]]>
            </description>
            <link>https://mattj.io/posts/2021-02-27-create-animated-gif-and-webp-from-videos-using-ffmpeg/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26296315</guid>
            <pubDate>Sun, 28 Feb 2021 19:35:23 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[World Beer Index 2021: The Cost and Consumption of Beer Around the World]]>
            </title>
            <description>
<![CDATA[
Score 35 | Comments 77 (<a href="https://news.ycombinator.com/item?id=26295875">thread link</a>) | @giuliomagnifico
<br/>
February 28, 2021 | https://www.expensivity.com/beer-around-the-world/ | <a href="https://web.archive.org/web/*/https://www.expensivity.com/beer-around-the-world/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="entry-content">
<p>Beer. Everybody likes to drink it. Nobody likes to pay for it. Still, the cost of a beer stings more or less depending on where in the world you‚Äôre drinking.</p>
<p>Expensivity wondered just how much the cost of beer differs from country and the effect the price of beer has on national consumption. We researched the price of a beer around the world and used World Health Organization statistics to figure out who‚Äôs drinking it all.</p>
<p><em>All prices are in US dollars. All beers are 33cl (330ml) bottles.</em></p>
<h2><strong>Key Findings</strong></h2>
<ul><li><strong>Qatar</strong> has the <strong>most expensive beer in the world</strong>, with an average price of <strong>US$11.26</strong> per 33cl (330ml) bottle.</li><li>The <strong>cheapest beer</strong> is in <strong>South Africa</strong>, where the average price is <strong>$1.68</strong> per bottle.</li><li>The <strong>Czech Republic</strong> has the <strong>highest consumption rate</strong>, with <strong>468 beers</strong> per person per year.</li><li><strong>Germans</strong> spend an average <strong>$1,907.78 per year</strong> on beer, the <strong>top figure</strong> in our study.</li></ul>
<h2><strong>Qatar Wins World Cup for Expensive Beer</strong></h2>
<p>A beer in Qatar is expensive. The mostly Muslim country introduced a <a href="https://www.nytimes.com/2019/01/01/world/middleeast/qatar-tax-alcohol.html">100% tax</a> on alcohol imports ahead of the 2022 World Cup, and visitors need a special permit to drink alcohol. China looks pretty expensive too, but consider that we averaged the price of a hotel beer ($13.61) and a supermarket beer ($1.81). </p>
<figure><a href="https://www.expensivity.com/wp-content/uploads/2021/02/1-The-Price-of-A-Beer-Map-avg-price.jpg"><img width="1200" height="800" src="https://www.expensivity.com/wp-content/uploads/2021/02/1-The-Price-of-A-Beer-Map-avg-price.jpg" alt="The Price of Beer Around The World" srcset="https://www.expensivity.com/wp-content/uploads/2021/02/1-The-Price-of-A-Beer-Map-avg-price.jpg 1200w, https://www.expensivity.com/wp-content/uploads/2021/02/1-The-Price-of-A-Beer-Map-avg-price-300x200.jpg 300w, https://www.expensivity.com/wp-content/uploads/2021/02/1-The-Price-of-A-Beer-Map-avg-price-1024x683.jpg 1024w, https://www.expensivity.com/wp-content/uploads/2021/02/1-The-Price-of-A-Beer-Map-avg-price-768x512.jpg 768w, https://www.expensivity.com/wp-content/uploads/2021/02/1-The-Price-of-A-Beer-Map-avg-price-1090x726.jpg 1090w" sizes="(max-width: 1200px) 100vw, 1200px"></a></figure>
<p><a href="https://www.expensivity.com/wp-content/uploads/2021/02/1-The-Price-of-A-Beer-Map-avg-price.jpg"><strong>Tap on the map to see it full size</strong></a></p>
<p>It‚Äôs clear the steep prices are aimed at visitors. Beer is cheapest in South Africa, where a <a href="https://www.dailymaverick.co.za/article/2020-10-26-counting-the-cost-of-cheap-easily-available-alcohol-in-south-africa/">culture of buying in bulk</a> tends to keep prices down.</p>
<h2><strong>The International Beer Index in Full</strong></h2>
<p>Where there is beer, there are beer geeks. Here is Expensivity‚Äôs data in full so you can find out exactly what kind of beer culture to expect from country to country. Click the arrows to sort by price, consumption, or total spend.</p>

<p>The ten countries with the highest average annual beer bill each have beer that costs upwards of four bucks. However, second-placed Poland is notable for its 62¬¢ carry-out beer, suggesting that much of Poland‚Äôs $1,738 average beer bill is built up by hotel-faring bachelor parties.</p>
<p>Bosnia is an outlier among the big drinkers: the country is in eighth place for beer consumption by bottle (331/year) but 30<sup>th</sup> for overall spend ($647.21), thanks to an average price that comes in under two bucks.</p>
<h2><strong>Germany Spends the Most On Beer</strong></h2>
<p>Haitians just aren‚Äôt that into beer. Spirits account for a whopping<a href="https://www.statista.com/statistics/973941/alcohol-consumption-latin-america-country-drink-type/"> 97% of booze consumed</a> in Haiti, where people drink fewer than four beers per year on average, with an annual beer bill of $10.02. That‚Äôs the lowest beer consumption and spend in our study.</p>
<div><figure><img width="1200" height="800" src="https://www.expensivity.com/wp-content/uploads/2021/02/2-How-Much-Do-People-Spend-Map-avg-spend.jpg" alt="How Much Do People Spend on Beer Annually?" srcset="https://www.expensivity.com/wp-content/uploads/2021/02/2-How-Much-Do-People-Spend-Map-avg-spend.jpg 1200w, https://www.expensivity.com/wp-content/uploads/2021/02/2-How-Much-Do-People-Spend-Map-avg-spend-300x200.jpg 300w, https://www.expensivity.com/wp-content/uploads/2021/02/2-How-Much-Do-People-Spend-Map-avg-spend-1024x683.jpg 1024w, https://www.expensivity.com/wp-content/uploads/2021/02/2-How-Much-Do-People-Spend-Map-avg-spend-768x512.jpg 768w, https://www.expensivity.com/wp-content/uploads/2021/02/2-How-Much-Do-People-Spend-Map-avg-spend-1090x726.jpg 1090w" sizes="(max-width: 1200px) 100vw, 1200px"></figure></div>
<p><a rel="noreferrer noopener" href="https://www.expensivity.com/wp-content/uploads/2021/02/2-How-Much-Do-People-Spend-Map-avg-spend.jpg" target="_blank"><strong>Tap on the map to see it full size</strong></a></p>
<p>At the other end of the scale, Germans spend just shy of $2k/year on beer. We found 15 countries with more expensive beer than Germany, but the nation sinks 411 bottles per person annually, so it pays the most in total. Germany is known for its<a href="https://www.dw.com/en/beer-culture-this-is-how-germany-drinks/a-19201434"> beer culture</a> and a stringent (delicious) beer purity law that has stood for over 500 years.</p>
<h2><strong>Czechia and Spain Lead Drinking Contest</strong></h2>
<p>So, who‚Äôs drinking all the beer? The Czech Republic takes the title, with 468 beers per person per year. However, capital Prague is the fourth most-visited city in Europe and infamous for its bachelor parties (<a href="https://www.lonelyplanet.com/articles/prague-different-type-visitor-after-lockdown">for now at least</a>). Like sunny Spain, in second place, Czechia‚Äôs beer consumption may be significantly swelled by visiting merry-makers.</p>
<div><figure><a href="https://www.expensivity.com/wp-content/uploads/2021/02/3-How-Much-Beer-Do-People-Drink-Map-avg-consumed.jpg"><img width="1200" height="800" src="https://www.expensivity.com/wp-content/uploads/2021/02/3-How-Much-Beer-Do-People-Drink-Map-avg-consumed.jpg" alt="How Much Beer Do People Drink In Different Countries?" srcset="https://www.expensivity.com/wp-content/uploads/2021/02/3-How-Much-Beer-Do-People-Drink-Map-avg-consumed.jpg 1200w, https://www.expensivity.com/wp-content/uploads/2021/02/3-How-Much-Beer-Do-People-Drink-Map-avg-consumed-300x200.jpg 300w, https://www.expensivity.com/wp-content/uploads/2021/02/3-How-Much-Beer-Do-People-Drink-Map-avg-consumed-1024x683.jpg 1024w, https://www.expensivity.com/wp-content/uploads/2021/02/3-How-Much-Beer-Do-People-Drink-Map-avg-consumed-768x512.jpg 768w, https://www.expensivity.com/wp-content/uploads/2021/02/3-How-Much-Beer-Do-People-Drink-Map-avg-consumed-1090x726.jpg 1090w" sizes="(max-width: 1200px) 100vw, 1200px"></a></figure></div>
<p><a href="https://www.expensivity.com/wp-content/uploads/2021/02/3-How-Much-Beer-Do-People-Drink-Map-avg-consumed.jpg"><strong>Tap on the map to see it full size</strong></a></p>
<p>Haiti drinks the least beer, counted per bottle or per spend. Most of the countries with a low beer intake can credit their predominantly Muslim populations for the abstinence. Armenia is an exception. The west Asian country drinks just 40 beers per person annually, with locals favoring<a href="https://theculturetrip.com/europe/armenia/articles/alcoholic-drinks-you-should-try-in-armenia/"> brandy, vodka, and wine</a>.</p>
<p>Armenians might not drink much beer, but the beer they drink is delicious, cheap, and<a href="https://www.smithsonianmag.com/travel/armenia-might-be-one-oldest-and-youngest-beermaking-countries-world-180964860/"> finely crafted</a>. Wherever you‚Äôre drinking in the world, be sure to check out the tradition behind your beer, as well as the cost ‚Äì nothing adds<a href="https://www.expensivity.com/expensivity-by-the-ounce/"> value</a> to your experience like a beer with a story!</p>
<figure><img width="1024" height="690" src="https://www.expensivity.com/wp-content/uploads/2021/02/lager-beer-with-homemade-pretzels-5FDLUTP-1024x690.jpg" alt="" srcset="https://www.expensivity.com/wp-content/uploads/2021/02/lager-beer-with-homemade-pretzels-5FDLUTP-1024x690.jpg 1024w, https://www.expensivity.com/wp-content/uploads/2021/02/lager-beer-with-homemade-pretzels-5FDLUTP-300x202.jpg 300w, https://www.expensivity.com/wp-content/uploads/2021/02/lager-beer-with-homemade-pretzels-5FDLUTP-768x517.jpg 768w, https://www.expensivity.com/wp-content/uploads/2021/02/lager-beer-with-homemade-pretzels-5FDLUTP-1536x1034.jpg 1536w, https://www.expensivity.com/wp-content/uploads/2021/02/lager-beer-with-homemade-pretzels-5FDLUTP.jpg 2000w" sizes="(max-width: 1024px) 100vw, 1024px"></figure>
<h3><strong>METHODOLOGY &amp; SOURCES</strong></h3>
<p>We collated the prices of a 330ml bottle of beer in supermarkets around the world using online shops, focusing on well-known beer brands such as Corona and Heineken. When we couldn‚Äôt find the price via an online shop, we used <a href="https://www.numbeo.com/cost-of-living/">numbeo.com</a>.</p>
<p>To gain an average price, we called up hotels to find out the price of a beer from their lobby bar, and when this wasn‚Äôt available, we used menus from bars found online. Once all the data was collected, we calculated the average price in US dollars using <a href="http://xe.com/">xe.com</a>.</p>
<p>Using the <a href="https://www.who.int/data/gho/data/indicators/indicator-details/GHO/alcohol-total-per-capita-(15-)-consumption-(in-litres-of-pure-alcohol)-with-95-ci">World Health</a> <a href="https://www.who.int/data/gho/data/indicators/indicator-details/GHO/alcohol-consumption-of-pure-alcohol-by-type-of-beverage-(-)">Organisation statistics</a>, we found the amount of alcohol consumption per capita and the percentage of annual beer consumption.</p>
</div></div>]]>
            </description>
            <link>https://www.expensivity.com/beer-around-the-world/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26295875</guid>
            <pubDate>Sun, 28 Feb 2021 18:44:06 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Lean into Procrastination]]>
            </title>
            <description>
<![CDATA[
Score 32 | Comments 12 (<a href="https://news.ycombinator.com/item?id=26295774">thread link</a>) | @patapizza
<br/>
February 28, 2021 | https://jodent.io/posts/lean-into-procrastination | <a href="https://web.archive.org/web/*/https://jodent.io/posts/lean-into-procrastination">archive.org</a>
<br/><!-- hnss:readable-content --><hr/>Unable to extract article]]>
            </description>
            <link>https://jodent.io/posts/lean-into-procrastination</link>
            <guid isPermaLink="false">hacker-news-small-sites-26295774</guid>
            <pubDate>Sun, 28 Feb 2021 18:34:09 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Weird architectures weren't supported to begin with]]>
            </title>
            <description>
<![CDATA[
Score 327 | Comments 203 (<a href="https://news.ycombinator.com/item?id=26294397">thread link</a>) | @woodruffw
<br/>
February 28, 2021 | https://blog.yossarian.net/2021/02/28/Weird-architectures-werent-supported-to-begin-with | <a href="https://web.archive.org/web/*/https://blog.yossarian.net/2021/02/28/Weird-architectures-werent-supported-to-begin-with">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page">


<h2><em>Programming, philosophy, pedaling.</em></h2>

<ul>
    <li><a href="https://blog.yossarian.net/">Home</a></li>
    <li><a href="https://blog.yossarian.net/tags">Tags</a></li>
    <li><a href="https://blog.yossarian.net/favorites">Favorites</a></li>
    <li><a href="https://blog.yossarian.net/archive">Archive</a></li>
    
      <li><a href="https://yossarian.net/">Main Site</a></li>
    
</ul>

<hr>



<h2>
  <em>Feb 28, 2021</em>
</h2>

  <p>Tags:
  
    
    <a href="https://blog.yossarian.net/tags#rant">rant</a>,
    
  
    
    <a href="https://blog.yossarian.net/tags#programming">programming</a>
    
  
  </p>


<hr>

<h4 id="preword">Preword</h4>

<p>This post contains my own opinions, not the opinions of my employer or any open source groups I
belong or contribute to.</p>

<p>It‚Äôs also been rewritten 2¬Ω times, and (I think) reads confusingly in places. But I promised
myself that I‚Äôd get it out of the door instead of continuing to sit on it, so here we go.</p>

<hr>

<p>There‚Äôs been a decent amount of <del>drama</del> debate in the open source community about <em>support</em>
recently, originating primarily from
<a href="https://github.com/pyca/cryptography/issues/5771">pyca/cryptography‚Äôs decision to use Rust for some ASN.1 parsing routines</a><sup id="fnref:asn1" role="doc-noteref"><a href="#fn:asn1">1</a></sup>.</p>

<p>To summarize the situation: building the latest <code>pyca/cryptography</code> release from scratch now requires
a Rust toolchain. The only currently<sup id="fnref:gccrust" role="doc-noteref"><a href="#fn:gccrust">2</a></sup> Rust toolchain is built on <a href="https://llvm.org/">LLVM</a>, which
supports a (relatively) limited
<a href="https://llvm.org/docs/CompilerWriterInfo.html">set of architectures</a>. Rust further whittles this
set down into <a href="https://doc.rust-lang.org/nightly/rustc/platform-support.html">support tiers</a>, with
some targets not receiving automated testing (tier 2) or official builds (tier 3).</p>

<p>By contrast, upstream<sup id="fnref:gcchell" role="doc-noteref"><a href="#fn:gcchell">3</a></sup> GCC supports a <a href="https://gcc.gnu.org/backends.html">somewhat larger</a>
set of architectures. But C<sup id="fnref:c" role="doc-noteref"><a href="#fn:c">4</a></sup>, cancer that it is, finds its way onto every architecture with or
without GCC (or LLVM‚Äôs) help, and thereby bootstraps <a href="https://github.com/python/cpython">everything</a>
<a href="https://www.gnome.org/">else</a>.</p>

<p>Program packagers and distributors (frequently separate from project maintainers themselves)
are very used to C‚Äôs universal presence. They‚Äôre so used to it that they‚Äôve built generic
mechanisms for putting entire distributions onto new architectures with
only a single assumption: the presence of a serviceable C compiler.</p>

<p>This is the heart of the conflict: Rust (and many other modern, safe languages) use LLVM for its
relative simplicity<sup id="fnref:simple" role="doc-noteref"><a href="#fn:simple">5</a></sup>, but LLVM does not support either native or cross-compilation to many
less popular (read: niche) architectures. Package managers are increasingly finding that one of
their oldest assumptions can be easily violated, and they‚Äôre not happy about that.</p>

<p>But here‚Äôs the problem: <em>it‚Äôs a bad assumption</em>. The fact that it‚Äôs the default
represents an <strong>unmitigated</strong> security, reliability, and reproducibility <em>disaster</em>.</p>

<h2 id="a-little-thought-problem">A little thought problem</h2>

<p>Imagine, for a moment, that you‚Äôre a maintainer of a popular project.</p>

<p>Everything has gone right for you: you have happy users, an active development base, and maybe even
corporate sponsors. You‚Äôve also got a CI/CD pipeline that produces canonical releases of your
project on tested architectures; you treat any issues with uses of those releases as a bug in the
project itself, since you‚Äôve taken responsibility for packaging it.</p>

<p>Because your project is popular, <strong>others</strong> also distribute it: Linux distributions, third-party
package managers, and corporations seeking to deploy their own controlled builds. These others have
slightly different needs and setups and, to varying degrees, will:</p>

<ul>
  <li>Build your project with slightly (or completely) different versions of dependencies</li>
  <li>Build your project with slightly (or completely) different optimization flags and other potentially
ABI-breaking options</li>
  <li>Distribute your project with insecure or outright broken defaults</li>
  <li>Disable important security features because other parts of their ecosystem haven‚Äôt caught up</li>
  <li>Patch your project or its build to make it ‚Äúwork‚Äù (read: compile and not crash immediately) with
completely new dependencies, compilers, toolchains, architectures, and environmental constraints</li>
</ul>

<p>You don‚Äôt know about <em>any</em> of the above until the bug reports start rolling in: users will report
bugs that have already been fixed, bugs that you explicitly document as caused by unsupported
configurations, bugs that <em>don‚Äôt make any sense whatsoever</em>.</p>

<p>You struggle to debug your users‚Äô reports, since you don‚Äôt have access to the niche
hardware, environments, or corporate systems that they‚Äôre running on. You slowly burn out
as an unending torrent of already fixed bugs that never seem to make it to your users. Your
user base is unhappy, and you start to wonder why you‚Äôre putting all this effort into
project maintenance in the first place. Open source was supposed to be fun!</p>

<p>What‚Äôs the point of this spiel? It‚Äôs <em>precisely</em> what happened to <code>pyca/cryptography</code>:
nobody asked them whether it was a good idea to try to run their code on
<a href="https://en.wikipedia.org/wiki/PA-RISC">HPPA</a>, much less
<a href="https://en.wikipedia.org/wiki/IBM_System/390">System/390</a><sup id="fnref:s390" role="doc-noteref"><a href="#fn:s390">6</a></sup>; some packagers just went ahead
and did it, and are frustrated that it no longer works. People just <em>assumed</em> that it
would, because there is <em>still</em> a norm that everything flows from C, and that any
host with a halfway-functional C compiler should have the entire open source ecosystem
at its disposal.</p>

<h3 id="reflections-on-trusting-random-platforms">Reflections on trusting random platforms<sup id="fnref:rott" role="doc-noteref"><a href="#fn:rott">7</a></sup></h3>

<p>Security-sensitive software<sup id="fnref:security" role="doc-noteref"><a href="#fn:security">8</a></sup><sup>,</sup><sup id="fnref:reliability" role="doc-noteref"><a href="#fn:reliability">9</a></sup>, <em>particularly</em> software written
in unsafe languages, is <strong>never</strong> secure in its own right.</p>

<p>The security of a program is a function of its own design and testing,
<em>as well as</em> the design, testing, and basic correctness of its underlying platform: everything from
the userspace, to the kernel, to the compilers themselves. The latter
is an <strong>unsolved problem</strong> in the <em>very best of cases</em>: bugs are <em>regularly</em>
found in even the most mature compilers (Clang, GCC) and their most mature backends (x86, ARM). Tiny
changes to or differences in build systems can have profound effects at the binary level, like
<a href="https://insights.sei.cmu.edu/cert/2018/08/when-aslr-is-not-really-aslr---the-case-of-incorrect-assumptions-and-bad-defaults.html">accidentally removing security mitigations</a>.
Seemingly innocuous patches can make otherwise safe code
<a href="https://wiki.gentoo.org/wiki/Hardened/GNU_stack_quickstart">exploitable</a> in the context of
other vulnerabilities.</p>

<p>The problem gets worse as we move towards niche architectures and targets that are used
primarily by small hobbyist communities.
Consider <a href="https://en.wikipedia.org/wiki/Motorola_68000_series">m68k</a>
(one of the other architectures affected by <code>pyca/cryptography</code>‚Äôs move to Rust): even
GCC <a href="https://gcc.gnu.org/legacy-ml/gcc-patches/2019-10/msg02044.html">was considering</a> removing
support due to lack of maintenance, until hobbyists stepped in. That isn‚Äôt to say that any
<em>particular</em> niche target is full of bugs<sup id="fnref:although" role="doc-noteref"><a href="#fn:although">10</a></sup>; only to say that it‚Äôs a greater likelihood
for niche targets <em>in general</em>. <strong>Nobody</strong> is regularly testing the mountain of userspace
code that implicitly forms an operating contract with arbitrary programs on these platforms.</p>

<p>Project maintainers don‚Äôt want to chase down compiler bugs on ISAs or systems that they never
intended to support in the first place, and aren‚Äôt receiving any active support feedback about.
They <em>especially</em> don‚Äôt want to have vulnerabilities associated
with their projects because of buggy toolchains <em>or</em> tooling inertia when working on security
improvements.</p>

<h3 id="some-more-finger-pointing">Some more finger-pointing</h3>

<p>As someone who <em>likes</em> C: this is all C‚Äôs fault. Really.</p>

<p>Beyond language-level unsafety (plenty of people have
<a href="https://fishinabarrel.github.io/">covered that already</a>), C is <em>organizationally</em> unsafe:</p>

<ul>
  <li>
    <p>There‚Äôs no standard way to write tests for C.</p>

    <p>Functional and/or unit tests <em>alone</em> would go a long
way in assuring baseline correctness on weird architectures or platforms, but the cognitive
overhead of testing C <em>and</em> getting those tests running ensures that well-tested builds of C
programs will continue to be the exception, rather than the rule.</p>
  </li>
  <li>
    <p>There‚Äôs no standard way to build C programs.</p>

    <p><a href="https://blog.yossarian.net/2019/04/23/Make-is-probably-fine">Make is fine</a>, but it‚Äôs not standard.
Disturbingly large swathes of critical open source infrastructure are compiled using a hodgepodge
of Make, autogenerated rules from autotools, and the maintainer‚Äôs boutique shell scripts. One
consequence of this is that C builds tend to be flexible <em>to a fault</em>: prospective packagers
can inject all sorts of behavior-modifying flags that may not be attested directly
in the compiled binary or other build products. The result: it‚Äôs almost impossible to prove that
two separate builds on different machines are the same, which means more maintainer pain.</p>
  </li>
  <li>
    <p>There‚Äôs no standard way to distribute C programs.</p>

    <p>Yes, I know that package managers exist. Yes, I know how to statically link. Yes, I know how to
vendor libraries and distribute self-contained program ‚Äúbundles‚Äù. None of these are or amount to
a <em>complete</em> standard, and each introduces additional logistical or security problems.</p>
  </li>
  <li>
    <p>There‚Äôs no such thing as truly cross-platform C.</p>

    <p>The C abstract machine, despite looking a lot like a PDP-11, leaks the underlying memory
and ordering semantics of the architecture being targeted. The result is that even seasoned
C programmers regularly rely on architecture-specific assumptions when writing ostensibly
cross-platform code: assumptions about the atomicity of reads and writes, operation ordering,
coherence and visibility in self-modifying code, the safety and performance of unaligned accesses,
and so forth. Each of these, apart from being a potential source of unsafety, are <strong>impossible
to detect</strong> statically in the general case: they are, after all, perfectly correct
(and frequently intended!) on the programmer‚Äôs host architecture.</p>
  </li>
</ul>

<p>By contemporary programming language standards, these are conspicuous gaps in functionality:
we‚Äôve long since learned to bake testing, building, distribution, and sound abstract machine
semantics into the standard tooling for languages (and language design itself). But their absence
is <strong>doubly pernicious</strong>: they ensure that C remains a perpetually
unsafe development ecosystem, <em>and</em> an appealing target when bootstrapping a new platform.</p>

<h2 id="the-life-of-a-package-maintainer-is-hard">The life of a package maintainer is hard</h2>

<p>The project maintainer isn‚Äôt the only person hurting in the status quo.</p>

<p>Everything stated above <em>also</em> leads to a bum job for the lowly package maintainer<sup id="fnref:yt" role="doc-noteref"><a href="#fn:yt">11</a></sup>. They‚Äôre
(probably) also an unpaid open source hobbyist, and they‚Äôre operating with constraints that
the upstream isn‚Äôt likely to immediately understand:</p>

<ul>
  <li>The need to link against versions of dependencies that have already been packaged (and perhaps patched)</li>
  <li>ABI and ISA subset constraints, stemming from a need to distribute binaries that function with
relatively old versions of <code>glibc</code> or x86-64 CPUs without modern extensions</li>
  <li>Limited visibility into each project‚Äôs test suite and how to run it, much less what to do when
it fails</li>
</ul>

<p>They <em>also</em> have to deal with users who are unsympathetic to those reports, and who:</p>

<ul>
  <li>Rarely submit reports to the packager (they bug the project directly instead!), or ‚Ä¶</li></ul></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://blog.yossarian.net/2021/02/28/Weird-architectures-werent-supported-to-begin-with">https://blog.yossarian.net/2021/02/28/Weird-architectures-werent-supported-to-begin-with</a></em></p>]]>
            </description>
            <link>https://blog.yossarian.net/2021/02/28/Weird-architectures-werent-supported-to-begin-with</link>
            <guid isPermaLink="false">hacker-news-small-sites-26294397</guid>
            <pubDate>Sun, 28 Feb 2021 16:22:04 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Debugging K8s services: 3 tools for 3 scenarios]]>
            </title>
            <description>
<![CDATA[
Score 7 | Comments 1 (<a href="https://news.ycombinator.com/item?id=26294015">thread link</a>) | @erkanerol
<br/>
February 28, 2021 | https://erkanerol.github.io/post/debugging-k8s-services/ | <a href="https://web.archive.org/web/*/https://erkanerol.github.io/post/debugging-k8s-services/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><div><p><span>Feb 28, 2021 ¬∑ <a href="https://erkanerol.github.io/post/debugging-k8s-services/#disqus_thread">Comments</a><br><a href="https://erkanerol.github.io/categories/software">Software</a><a href="https://erkanerol.github.io/categories/k8s">k8s</a><a href="https://erkanerol.github.io/categories/en">EN</a></span></p><p>While developing/debugging applications that serve services on k8s in production, you need some tools/commands. This blog post explains three different scenarios+tools for you.</p><blockquote><p>Please ping me if there is something wrong. <a href="https://twitter.com/erkan_erol_">https://twitter.com/erkan_erol_</a></p></blockquote><h2 id="setup">Setup</h2><p>Here is our basic setup to explain the scenarios.</p><p><img src="https://erkanerol.github.io/img/k8s-services/Setup.png" title="Setup"></p><p>We have 3 services. <code>service-front</code> is exposed to the public via an ingress. <code>service-front</code> depends on <code>service-middle</code> and <code>service-middle</code> depends on <code>service-back</code>. The communications are done through k8s services.</p><p>To install this setup, here are the necessary commands:</p><pre><code>kubectl create ns service-debug
kubectl -n service-debug run service-back --image=erkanerol/service-back:v1 --port=8080 --expose=true --labels="app=back"
kubectl -n service-debug run service-middle --image=erkanerol/service-middle:v1 --port=8081 --expose=true --labels="app=middle"
kubectl -n service-debug run service-front --image=erkanerol/service-front:v1 --port=8082 --expose=true --labels="app=front"
</code></pre><p>Here is the source code of these services: <a href="https://github.com/erkanerol/service-examples-for-blog">https://github.com/erkanerol/service-examples-for-blog</a></p><h4 id="scenario">Scenario:</h4><p>As a developer, I want to send some requests to <code>service-back</code> directly and see the result without touching the other services.</p><h4 id="problem">Problem:</h4><p><code>service-back</code> is not exposed to the public and you cannot send requests to it directly.</p><h4 id="solution">Solution:</h4><p>With <code>kubectl port-forward</code>, it is possible to open a tunnel from your local machine to the <code>service-back</code> in the cluster. See <a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#port-forward">https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#port-forward</a></p><h4 id="steps">Steps:</h4><p>Run the command below in a terminal.</p><pre><code>$ kubectl -n service-debug port-forward service/service-back 8080:8080
Forwarding from 127.0.0.1:8080 -&gt; 8080
Forwarding from [::1]:8080 -&gt; 8080
</code></pre><p><br>Then run the curl command below in another terminal to see that you are able to access <code>service-back</code></p><pre><code>$ curl localhost:8080
Timestamp from back:1614508193
</code></pre><h4 id="how-does-it-work">How does it work?</h4><p><img src="https://erkanerol.github.io/img/k8s-services/Level1.png" title="Level1"></p><p><code>kubectl</code> starts a process which binds <code>localhost:8080</code>. It listens that port and establishes a connection to api-server, which forwards the requests to <code>service-back</code>.</p><h4 id="scenario-1">Scenario:</h4><p>As a developer, I want to run <code>service-front</code> in my local machine so that I can put breakpoints in my IDE to debug my application.</p><h4 id="problem-1">Problem:</h4><p><code>service-front</code> is designed to run in Kubernetes and it accesses <code>service-middle</code> via the k8s service. The service name is hardcoded or hard to be configurable or you are too lazy to mock the dependencies in your local machine.</p><h4 id="solution-1">Solution:</h4><p><code>kubefwd</code> is a useful tool for this problem. It does bulk port-forwarding and manages dns entries in your local machine. See <a href="https://github.com/txn2/kubefwd">https://github.com/txn2/kubefwd</a></p><h4 id="steps-1">Steps:</h4><p>Run the command below in a terminal</p><pre><code>$ sudo KUBECONFIG=$KUBECONFIG kubefwd svc -n service-debug -l app=middle
</code></pre><blockquote><p>Note that <code>kubefwd</code> requires root privileges and it has to be run with <code>sudo</code>. Set <code>KUBECONFIG</code> variable without any home folder reference beforehand.</p></blockquote><p>In another terminal, run <code>front</code> application in your local machine. Note that you can run it in debug mode as well and put breakpoints.</p><pre><code>$ cd /tmp
$ git clone https://github.com/erkanerol/service-examples-for-blog.git
$ cd service-examples-for-blog/front
$ go run main.go
</code></pre><p>In another terminal, Send a request to <code>front</code> app to see that your front app serves locally and it accesses <code>service-middle</code> in the cluster.</p><pre><code>$ curl localhost:8082
Response from service middle:'Response from service back:'Timestamp from back:1614513901''
</code></pre><h4 id="how-does-it-work-1">How does it work?</h4><p><img src="https://erkanerol.github.io/img/k8s-services/Level2.png" title="Level2"></p><p>As you can see from the logs of <code>kubefwd</code></p><pre><code>...
INFO[14:07:38] 'cat /etc/hosts' to see all host entries.    
INFO[14:07:38] Loaded hosts file /etc/hosts                 
INFO[14:07:38] HostFile management: Original hosts backup already exists at /root/hosts.original 
...
INFO[14:07:38] Port-Forward: 127.1.27.1 service-middle:8081 to pod service-middle:8081 
...
</code></pre><p>It starts a process that binds <code>127.1.27.1:8081</code> and manipulates the <code>/etc/hosts</code> for <code>service-middle</code></p><pre><code>$ cat /etc/hosts |grep service-middle
127.1.27.1       service-middle.default service-middle.default.svc service-middle.default.svc.cluster.local service-middle.default.minikube service-middle.default.svc.minikube service-middle.default.svc.cluster.minikube service-middle service-middle.service-debug service-middle.service-debug.svc service-middle.service-debug.svc.cluster.local service-middle.service-debug.minikube service-middle.service-debug.svc.minikube service-middle.service-debug.svc.cluster.minikube
</code></pre><div><p>Then your local <code>front</code> app can access the <code>service-middle</code> like in k8s cluster without any extra effort.</p></div><h4 id="scenario-2">Scenario:</h4><p>As a developer, I want to run <code>service-middle</code> in my local machine so that I can put breakpoints in my IDE to debug my application.</p><h4 id="problem-2">Problem:</h4><p><code>service-middle</code> is designed to run in Kubernetes. It accesses <code>service-back</code> via k8s services. Also, its consumer <code>service-front</code> is running on k8s. The services are not available in your local machine and it is hard to mock all these environments in your local machine.</p><h4 id="solution-2">Solution:</h4><p><code>telepresence</code> is a useful tool for this problem. See <a href="https://www.telepresence.io/">https://www.telepresence.io/</a></p><h4 id="steps-2">Steps:</h4><p>Delete <code>service-middle</code> from your k8s cluster at first. We will run it locally.</p><pre><code>kubectl -n service-debug delete service service-middle --ignore-not-found=true
kubectl -n service-debug delete pod service-middle --ignore-not-found=true
</code></pre><p><br>Run telepresence for <code>service-middle</code></p><pre><code>telepresence --namespace service-debug --new-deployment service-middle --expose 8081
</code></pre><p><br>In another terminal, run <code>middle</code> application in your local machine. Note that you can run it in debug mode as well and put breakpoints.</p><pre><code>$ cd /tmp
$ git clone https://github.com/erkanerol/service-examples-for-blog.git
$ cd service-examples-for-blog/middle
$ go run main.go
</code></pre><p><br>In another terminal, run the command below to send a request to <code>service-front</code> via a temporary pod in the cluster.</p><pre><code>$ kubectl -n service-debug run curl -it  --rm=true --image=curlimages/curl --restart=Never -- http://service-front:8082 
Response from service middle:'Response from service back:'Timestamp from back:1614517363''pod "curl" deleted
</code></pre><p>Note that your request goes to <code>service-front</code> in k8s, which sends a request to <code>service-middle</code> in your local machine, which sends a request to <code>service-back</code> in the cluster.</p><h4 id="how-does-it-work-2">How does it work?</h4><p><img src="https://erkanerol.github.io/img/k8s-services/Level3.png" title="Level3"></p><p>Basically, <code>telepresence</code> deploys a proxy/fake agent into cluster and opens a two-way tunnel between your local environment and the cluster via that agent. Then you are able to run the <code>middle</code> service in your local machine without adapting the consumers/dependent services.</p><p>A detailed explanation about how telepresence works is available here: <a href="https://www.telepresence.io/discussion/how-it-works">https://www.telepresence.io/discussion/how-it-works</a></p><h2 id="summary">Summary</h2><ul><li>If you need to access a service without exposing it to public, <code>kubectl port-forward</code> is enough.</li><li>If you need to run a service locally for debugging and your service needs to access other services on k8s, <code>kubefwd</code> is enough. It manages DNS entries in your local machine and opens a one-way tunnel from your machine to cluster for the dependencies of your service.</li><li>If you need to run a service locally for debugging and your application has some consumers in the cluster, <code>telepresence</code> is your tool. It opens two-way network channel and it forwards requests from cluster to your local instance as well.</li></ul><p>p.s. Admission webhooks in Kubernetes are similar to <code>service-middle</code>. They receive some requests from api-server and they may send some requests to other services in the cluster. Therefore, <code>telepresence</code> is a useful tool for debugging admission webhooks. In the next blog post, I am going to explain how to debug validating webhooks.</p></div></div></div>]]>
            </description>
            <link>https://erkanerol.github.io/post/debugging-k8s-services/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26294015</guid>
            <pubDate>Sun, 28 Feb 2021 15:28:53 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Show HN: Email Cleaner: Clean tracking links and pixels from email newsletters]]>
            </title>
            <description>
<![CDATA[
Score 16 | Comments 9 (<a href="https://news.ycombinator.com/item?id=26293424">thread link</a>) | @bengtan
<br/>
February 28, 2021 | https://bengtan.com/blog/email-cleaner-clean-tracking-links-and-pixels/ | <a href="https://web.archive.org/web/*/https://bengtan.com/blog/email-cleaner-clean-tracking-links-and-pixels/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
  
<div>
  <article>
    

    

    
    
    <h2>Overview</h2>
    <nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-it">What is it?</a></li>
    <li><a href="#email-cleaner">Email Cleaner</a></li>
    <li><a href="#getting-started">Getting started</a>
      <ul>
        <li><a href="#forwarding-loops">Forwarding loops</a></li>
      </ul>
    </li>
    <li><a href="#how-it-works">How it works</a></li>
    <li><a href="#benefits">Benefits</a></li>
    <li><a href="#plain-text-emails">Plain text emails</a></li>
    <li><a href="#caveats">Caveats</a></li>
    <li><a href="#privacy">Privacy</a></li>
    <li><a href="#feedback">Feedback</a></li>
  </ul>
</nav>
    <p>I‚Äôm supposed to be blogging instead of doing <a href="https://bengtan.com/blog/app-startup-vs-content-startup/">‚Äúapp startup‚Äù</a> things but I got sidetracked and built another side project (again).</p>
<p>I‚Äôve been getting into email newsletters. Over the last month, I‚Äôve gone from zero newsletters to eleven of them. My inbox is now overflowing with newsletters. Maybe I‚Äôll have to cut back but that‚Äôs a story for another time.</p>
<p>I have a new pet hate: Links in email newsletters.</p>
<p>They are user-hostile. Substack is the worst. Their URLs look like this:</p>
<p><a href="http://email.substack.com/c/ejXDKM2OhCAMgJ9muI3hT3QOHPayr2EKVIesgwbquL794njbhEIhNP36eSCclnzYdSnEzm2gY0WbcC8zEmFmW8E8xGBlb1pljGTBdsJpLVksw5gRXxBnS3lDtm5ujh4oLulTIVvJnjbgCKC51hxawbuuxzCCcwHAo0CprrawhYjJo8U35mNJyGb7JFrLTX3d5Hdd-743CWjL2PjlVR8gU_qZLpoGLdre3LkUd87Vw9wrnZX1ymUN3XbtoxENjIYbFKBVq3wrxlF47oLolZNKonrcNC-bKwT-RzT4u1aKRBHmd8S99mTZOkwTQRL153TOfZKcYw_1fG0p0jFgAjdjuIzQJfbjaJgwYa7CwwBkhRGq75Xu-4fpLgVVmZKdFNUzqxxhqVXJ_uP4AyNKkNQ">http://email.substack.com/c/ejXDKM2OhCAMgJ9muI3hT3QOHPayr2EKVIesgwbquL794njbhEIhNP36eSCclnzYdSnEzm2gY0WbcC8zEmFmW8E8xGBlb1pljGTBdsJpLVksw5gRXxBnS3lDtm5ujh4oLulTIVvJnjbgCKC51hxawbuuxzCCcwHAo0CprrawhYjJo8U35mNJyGb7JFrLTX3d5Hdd-743CWjL2PjlVR8gU_qZLpoGLdre3LkUd87Vw9wrnZX1ymUN3XbtoxENjIYbFKBVq3wrxlF47oLolZNKonrcNC-bKwT-RzT4u1aKRBHmd8S99mTZOkwTQRL153TOfZKcYw_1fG0p0jFgAjdjuIzQJfbjaJgwYa7CwwBkhRGq75Xu-4fpLgVVmZKdFNUzqxxhqVXJ_uP4AyNKkNQ</a></p>
<p>What is that, Substack?! Is that really a URL with 400+ characters?!</p>
<p>I have an ingrained habit of hovering over links. This allows me to see where it links to and decide whether to click on it.</p>
<p>It‚Äôs a good habit.</p>
<p>It‚Äôs also a security ‚Äúbest practice‚Äù. Hovering over a link helps to check whether it‚Äôs a phishing link.</p>
<p>Email newsletters have broken this. I have no idea where these user-hostile links go. For their own self interest, mailing list service providers have denied me a basic tenet of the web: Knowing what I‚Äôm clicking on before I click.</p>
<p>It‚Äôs also demeans the newsletter. A newsletter which purports to send me a ‚Äòlist of interesting links‚Äô is just sending me a list of crap because I‚Äôm not clicking on those I-have-no-idea-where-it‚Äôs-going links.</p>
<p>If the link was something like <a href="http://www.google.com/url?sa=t&amp;url=https://www.wikipedia.org/&amp;usg=AOvVaw3ay7vaEtH0yTTYdDmrvinX">http://www.google.com/url?sa=t&amp;url=https://www.wikipedia.org/&amp;usg=AOvVaw3ay7vaEtH0yTTYdDmrvinX</a> I wouldn‚Äôt be as peeved because I can see where it links to.</p>
<p>But no, I don‚Äôt think they‚Äôll compromise.</p>
<p>Not happy.</p>
<p>I set about trying to make the situation palatable. I asked <a href="https://news.ycombinator.com/item?id=26188976">here</a>, <a href="https://www.reddit.com/r/SomebodyMakeThis/comments/ln4dep/smt_hover_over_links_in_email_newsletters_and_see/">here</a>, and <a href="https://www.indiehackers.com/post/17a17962db">here</a> but I didn‚Äôt find anything satisfactory.</p>
<p>So I built my own solution.</p>
<h2 id="what-is-it">What is it?</h2>
<p>I hooked a script up to an email address. Upon receiving an email, the script will replace tracking links with their destination URL, remove tracking pixels, and send it back to the sender.</p>
<p>Then, I set up a gmail filter to forward my newsletters to the script.</p>
<p>Yay!</p>
<p>Now, when I receive an email newsletter, gmail forwards it to the script. The script sends it back to me with nice clean URLs. Once again, I can see where links lead to before I decide whether to click.</p>
<p>Tracking parameters (ie. <code>utm_*</code>) and tracking pixels are removed as well. (I don‚Äôt care strongly about this but it was easy to add so I did.)</p>
<h2 id="email-cleaner">Email Cleaner</h2>
<p>For lack of a better name, I‚Äôm calling it <strong>Email Cleaner</strong>. <strong>It cleans crap from email newsletters</strong>.</p>
<p>(Alternatively, I considered calling it ‚Äò<strong>UntrackMe: Remove tracking from email newsletters</strong>‚Äô. Which sounds better?)</p>
<p>I‚Äôm letting others try it. Maybe other people find it useful too. If there‚Äôs enough interest, I‚Äôll turn it into a proper side project.</p>
<h2 id="getting-started">Getting started</h2>
<p>To try Email Cleaner, forward an email newsletter to <code>email-cleaner@bengtan.com</code>.</p>
<p>In a minute or two, you should get the newsletter sent back to you (from <code>no-reply@bengtan.com</code>) with cleaned links and tracking pixels removed.</p>
<p>If you decide you like it, you can set up your email program to automatically forward email newsletters to <code>email-cleaner@bengtan.com</code>.</p>
<p>How you do this depends on your email program so you‚Äôll have to work it out youself.</p>
<p>Note: Please don‚Äôt set up your email program to automatically delete after forwarding. Since this is a new service, it‚Äôs a good idea to retain the original emails in case something goes wrong.</p>
<h3 id="forwarding-loops">Forwarding loops</h3>
<p>If your automatic forwarding configuration mistakenly forwards the cleaned email (from Email Cleaner) back to Email Cleaner, it will detect this and send you an email with the message ‚ÄúInfinite loop detected‚Äù. If you get such an email, please adjust your forwarding configuration so you don‚Äôt forward cleaned emails to Email Cleaner.</p>
<p>If you use gmail (like I do), this can be accomplished by adding the condition <code>-subject:[email-cleaner]</code> to your forwarding filter.</p>
<h2 id="how-it-works">How it works</h2>
<p>Email Cleaner works as follows:</p>
<ul>
<li>It scans the email for links which match the following regular expressions:</li>
</ul>
<div><pre><code data-lang="js">	<span>'\.list-manage\.com/track/click'</span>,
	<span>'//click\.convertkit-mail\.com/'</span>,
	<span>'//email\.substack.*/c/'</span>,
	<span>'//apple\.co/'</span>,
	<span>'//t\.co/'</span>,
</code></pre></div><ul>
<li>If a link matches, then it‚Äôs a tracking link. Email Cleaner crawls the link to see if it‚Äôs a 3xx redirect. If it is, then the link is replaced by the destination URL.
<ul>
<li>Any URL query parameters which are <code>mc_cid</code>, <code>mc_eid</code>, or start with <code>utm_</code> are also removed.</li>
</ul>
</li>
<li>Then, Email Cleaner scans the email for tracking pixels. If any are found, it removes them.</li>
<li>Finally, the email is sent back to the sender.</li>
</ul>
<p>Email Cleaner is quite safe and conservative. It will only crawl links which are obviously tracking links.</p>
<p>Email Cleaner currently handles three major mailing list service providers (MailChimp, ConvertKit, Substack). I‚Äôd happily add more. Just let me know.</p>
<p>Note that Email Cleaner doesn‚Äôt magically bypass the tracking links. Instead, it triggers all of them from a data centre somewhere. It‚Äôs privacy-by-obfuscation instead of privacy-by-abstention. But it does prevent your web browser/IP address/location from being leaked.</p>
<h2 id="benefits">Benefits</h2>
<ul>
<li>Email newsletters are more user friendly. (I‚Äôm more inclined to click on a link if I see it‚Äôs a reputable website.)</li>
<li>Helps detect phishing attacks.</li>
<li>Better user privacy.</li>
<li>Plain text emails are readable again.</li>
</ul>
<h2 id="plain-text-emails">Plain text emails</h2>
<p>The last benefit was an unexpected side effect.</p>
<p>Whilst writing Email Cleaner, I discovered that plain text versions of email newsletters are completely unreadable.</p>
<p>They look something like this:</p>
<blockquote>
<p>Most agree that the term Artificial Intelligence was codified at a Dartmouth workshop in 1956 [htt—Ä://email.substack.com/c/eJxdkc-OgyAQh5-m3Grkr3rgsJd9DQM4WlIFA2O7vv1O2-xlE2CSHzPhy0dwCEsup91zRfY6Rjx3sAmegAiF7BsUE71mvZJcKUa87qgTgpG4mVAAXjYuGssOZN3dEkeLMafPBpOMzFp1wluppHM9Z2FoQQQbnAqd8tx2A7_P2t1HSCNoeEM5cwKy6Blx3R7868F-qkFqjviMK_hom1ym2rrqmr5twVfecTZHLs9tziuJmrWMtqy6kJ0cGtrYoFoF1Aou-ShpCHRsnac9d4wz4MNDtNvuNrTjkzbwu1YNCaNd3hGOZsykaAdpQptonZyur2v3dT1tan7tKeJpIFm3gL954I31Q8hMkKBU3N5Y1FRR3vdc9P2guhtABcZZx2ilTKoOn-tW0v90_AEVdJLl]. At a conference five years earlier [htt—Ä://email.substack.com/c/eJxdkEtuhDAMhk8zWSLyBBZZVKp6jSghDkTDJCiYody-YdhV8kO2bPn3N1qEKZdTr3lDcgWD5wo6wbEtdQVEKOyoUMY4WdEbLY0RbLId90oJFus4F4DNxdViOYDth19jcBhzek8ILdjNDk5xrQxozWenoTNmkL2cvQoimFaZz7PumCKkABYeUM6cgK32hrjXi_y6iG9aIW_7QUS3WJGQm1wWSv2aXwVvMd1jWq7O5wOvmwsUQL26NF3_7qiNRStawVtBW-lODw1v3GxaA9wpqWUgxpmH1k-8l15IAXK4qLYevqILd97Az05sCaNbHxGeTcisWA9pQZc4dS4vG5RuLxkj1e1IEc8RkvMrTB9P-NH9NjcukKDQN0yjQ8sNl30vVd8PpvuIIZFSdIKTfUYcU6apZP9x_AIL9Jrk], however, the concepts were discussed in detail, just not named.&nbsp;</p>
</blockquote>
<p>Is that supposed to be readable?! (It‚Äôs not just Substack. The other providers are almost just as bad.)</p>
<p>Email Cleaner changes it to:</p>
<blockquote>
<p>Most agree that the term Artificial Intelligence was codified at a Dartmouth workshop in 1956 [htt—Äs://en.wikipedia.org/wiki/Dartmouth_workshop]. At a conference five years earlier [htt—Äs://computerhistory.org/blog/thinking-about-machines-and-thinking/], however, the concepts were discussed in detail, just not named.&nbsp;</p>
</blockquote>
<p>which is moderately readable.</p>
<p>It would be even better if it was:</p>
<blockquote>
<p>Most agree that the term Artificial Intelligence was codified at a Dartmouth workshop in 1956 [0]. At a conference five years earlier [1], however, the concepts were discussed in detail, just not named.&nbsp;</p>
<p>[0] htt—Äs://en.wikipedia.org/wiki/Dartmouth_workshop<br>
[1] htt—Äs://computerhistory.org/blog/thinking-about-machines-and-thinking/</p>
</blockquote>
<p>but that‚Äôs a story for another time. (I don‚Äôt know if it‚Äôs worth the effort to do this. Do many people still read emails in plain text?)</p>
<h2 id="caveats">Caveats</h2>
<p>Please note that Email Cleaner is only a proof of concept. It‚Äôs an experiment. I wouldn‚Äôt even call it an MVP.</p>
<p>It‚Äôs useful to me, but I don‚Äôt know if it‚Äôs useful for others. I‚Äôd like to find out.</p>
<p>I don‚Äôt know how long Email Cleaner will last since:</p>
<ul>
<li>It‚Äôs vulnerable to spam (There‚Äôs no authentication or access control), and</li>
<li>It‚Äôs not scalable (It‚Äôs running on a tiny server).</li>
</ul>
<p>Once the spam bots arrive, or too many people use it, it‚Äôll probably have to stop.</p>
<p>Or if there‚Äôs sufficient interest, I‚Äôll rewrite it into a proper side project.</p>
<h2 id="privacy">Privacy</h2>
<p>Please don‚Äôt forward any personal or private emails to Email Cleaner. Only forward publicly available email newsletters (Paid newsletters are okay).</p>
<p>All received emails go to Email Cleaner‚Äôs inbox. I hope to accumulate more test data with which to conduct further research on mailing list service providers and improve Email Cleaner.</p>
<p>There‚Äôs not really a privacy policy. This is an experiment.</p>
<p>If you forward emails to Email Cleaner, I consider that as your opt-in.</p>
<p>Anything you forward to Email Cleaner could be used to improve Email Cleaner.</p>
<p>OTOH, I don‚Äôt know anything about you anyway. All I have is an email address and what email newsletters you subscribe to (whatever can be inferred from that).</p>
<h2 id="feedback">Feedback</h2>
<p>Since this is a new and experimental service, please don‚Äôt expect it to be perfectly reliable nor correct. If you forward an email to Email Cleaner and don‚Äôt get a reply in a few minutes, maybe something broke. Please get in touch with me and I‚Äôd be happy to look into it.</p>
<p>If you have any questions, suggestions, criticisms, etc. ‚Äî please also let me know. I‚Äôd be happy to talk.</p>
<p>I hope you like Email Cleaner! Thanks for reading!</p>




  </article>


  
</div>
    </div></div>]]>
            </description>
            <link>https://bengtan.com/blog/email-cleaner-clean-tracking-links-and-pixels/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26293424</guid>
            <pubDate>Sun, 28 Feb 2021 13:55:10 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[You can do better than Redis as a data layer for your models]]>
            </title>
            <description>
<![CDATA[
Score 6 | Comments 0 (<a href="https://news.ycombinator.com/item?id=26293114">thread link</a>) | @jamesblonde
<br/>
February 28, 2021 | http://www.logicalclocks.com/blog/ai-ml-needs-a-key-value-store-and-redis-is-not-up-to-it | <a href="https://web.archive.org/web/*/http://www.logicalclocks.com/blog/ai-ml-needs-a-key-value-store-and-redis-is-not-up-to-it">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><div><div><div><div id="ron_db"><h2>‚Äç<strong>The rise of key-value stores as online feature stores.&nbsp;</strong></h2><p>Online feature stores are the data layer for operational machine learning models - the models that make online shopping recommendations for you and help identify financial fraud. When you train a machine learning model, you feed it with high signal-to-noise data called features. When the model is used in operation, it needs the same types of features that it was trained on (e.g., how many times you used your credit card during the previous week), but the online feature store should have low latency to keep the end-to-end latency of using a model low. Using a model requires both retrieving the features from the online feature store and then sending them to the model for prediction.&nbsp;</p><p>Hopsworks has been using NDB Cluster as our online feature store from its first release. It has the unique combination of low latency, high availability, high throughput, and scalable storage that we call LATS. However, we knew we could make it even better as an online feature store in the cloud, so we asked one of the world‚Äôs leading database developers to do it - the person who invented NDB, Mikael Ronstr√∂m. Together we have made RonDB, a key-value store with SQL capabilities, that is the world‚Äôs most advanced and performant online feature store. Although NDB Cluster is open-source, its adoption has been hampered by an undeserved reputation of being challenging to configure and operate. With <a href="https://www.rondb.com/?utm_source=rondb" target="_blank">RonDB</a>, we overcome this limitation by providing it as a managed service in the cloud on AWS and Azure.<strong>‚Äç</strong></p><h3><strong>Requirements for an Online Feature Store</strong>‚Äç</h3><figure><p><img src="https://uploads-ssl.webflow.com/5e6f7cd3ee7f51ec3ea4da0f/60364af8c8f5d47b1f1f70ce_graph_white.png" loading="lazy" alt=""></p></figure><p>The main requirements from a database used as an online feature store are: low latency, high throughput for mixed read/write operations, high availability and the ability to store large data sets (larger than fit on a single host). We unified these properties in a single muscular term <strong>LATS</strong>:</p><p><a href="https://www.rondb.com/?utm_source=rondb" target="_blank">‚Äç<strong>LATS</strong>: low <strong>L</strong>atency, high <strong>A</strong>vailability, high <strong>T</strong>hroughput, scalable <strong>S</strong>torage.&nbsp;</a></p><p>RonDB is not without competition as the premier choice as an online feature store. To quote Khan and Hassan from DoorDash, it should be a low latency database:&nbsp;</p><p><a href="https://doordash.engineering/2020/11/19/building-a-gigascale-ml-feature-store-with-redis/?utm_source=rondb" target="_blank">‚Äúlatency on feature stores is a part of model serving, and model serving latencies tend to be in the low milliseconds range. Thus, read latency has to be proportionately lower.‚Äù&nbsp;</a></p><p>To that end, Redis fits this requirement as it is an in-memory key-value store (without SQL capabilities). Redis is open source (BSD Licence), and it enjoys popularity as an online feature store. Doordash even invested significant resources in increasing Redis‚Äô storage capacity as an online feature store, by adding custom serialization and compression schemes. Significantly, similar to RonDB, it provides sub-millisecond latency for single key-value store operations. There are other databases that have been proposed as online feature stores, but they were not considered in this post as they have significantly higher latency (over one order-of-magnitude!), such as DynamoDB, BigTable, and SpliceMachine.</p><p>As such, we thought it would be informative to compare the performance of RonDB and Redis as an online feature store. <strong>The comparison was between Redis open-source and RonDB open-source</strong> (the commercial version of Redis does not allow any benchmarks). In addition to our benchmark, we compare the innards of RonDB‚Äôs multithreading architecture to the commercial Redis products (since our benchmark identifies CPU scalability bottlenecks in Redis that commercial products claim to overcome).<br></p><h2>Benchmark: RonDB vs Redis</h2><p>In this simple benchmark, I wanted to compare apples with apples, so I compared open-source RonDB to the open-source version of Redis, since the commercial versions disallow reporting any benchmarks. In the benchmark, I deliberately hobble the performance of RonDB by configuring it with only a single database thread, as Redis is <a href="https://redis.io/topics/benchmarks/utm_source=rondb" target="_blank">‚Äúa single-threaded server from the POV of command execution‚Äù</a>. I then proceed to describe the historical evolution of RonDB‚Äôs multithreaded architecture, consisting of three different generations, and how open-source Redis is still at the first generation, while commercial Redis products are now at generation two.</p><p>Firstly, for our single-threaded database benchmark, we performed our experiments on a 32-core Lenovo P620 workstation with 64 GB of RAM. We performed key-value lookups. Our experiments show that a single-threaded RonDB instance reached around 1.1M reads per second, while Redis reached more than 800k reads per second - both with a mean latency of around 25 microseconds. The throughput benchmark performed batch reads with 50 reads per batch and had 16 threads issuing batch requests in parallel. Batching reads/writes improves throughput at the cost of increased latency.<br></p><figure><p><img src="https://uploads-ssl.webflow.com/5e6f7cd3ee7f51ec3ea4da0f/6037dae7ff678a83e8eaf1a8_performance.jpg" loading="lazy" alt=""></p></figure><p>On the same 32-core server, both RonDB and Redis reached around 600k writes per second when performing SET for Redis and INSERT, UPDATE or DELETE operations for RonDB. For high availability, both of those tests were done with a setup using two replicas in both RonDB and in Redis.<br></p><h3><strong>Low latency</strong></h3><p>We expected that the read latency and throughput of RonDB and Redis would be similar since both require two network jumps to read data. In case of updates (and writes/deletes), Redis should have lower latency since an update is only performed on the main replica before returning. That is, Redis only supports asynchronous replication from the main replica to a backup replica, which can result in data loss on failure of the main node. In contrast, RonDB performs an update using a synchronous replication protocol that requires 6 messages (<a href="https://www.amazon.com/MySQL-Cluster-7-5-Inside-Out/dp/9176998142/utm_source=rondb" target="_blank">a non-blocking version of two-phase commit</a>). Thus, the expected latency is 3 times higher for RonDB for writes.&nbsp;<br></p><h3><strong>High Throughput</strong></h3><p>A comparison of latency and throughput shows that RonDB already has a slight advantage in a single-threaded architecture, but with its third-generation multithreaded architecture, described below, RonDB has an even bigger performance advantage compared to Redis commercial or open-source. RonDB can be scaled up by adding more CPUs and memory or scaled out, by automatically sharding the database.&nbsp; As early as 2013, we developed a benchmark with NDB Cluster (RonDB‚Äôs predecessor) that showed how <a href="http://mikaelronstrom.blogspot.com/2015/03/200m-reads-per-second-in-mysql-cluster.html?utm_source=rondb" target="_blank">NDB could handle 200M Reads per second</a> in a large cluster of 30 data nodes with 28 cores each.&nbsp;<br></p><h3><strong>High Availability</strong></h3><p>The story on high availability is different. A write in Redis is only written to one replica. The replication to other replicas is then done asynchronously, thus consistency can be seriously affected by failures and data can be lost. An online feature store must accept writes that change the online features constantly in parallel with all the batched key reads. Thus handling node failures in an online feature store must be very smooth.<br></p><p>Given that an online feature store may need to scale to millions of writes per second as part of a normal operation, this means that a failed node can cause millions of writes to be lost, affecting the correctness and quality of any models that it is feeding with data. RonDB has transactional capabilities that ensure that transactions can be retried in the event of such partial failures. Thus, as long as the database cluster is not fully down, no transactions will be lost.<br></p><p>In many cases the data comes from external data sources into the online Feature Store, so a replay of the data is possible, but an inconsistent state of the database can easily lead to extra unavailability in failure situations. Since an online feature store is often used in mission-critical services, this is clearly not desirable.<br></p><p>RonDB updates all replicas synchronously as part of writes. Thus, if a node running the transaction coordinator or a participant fails, the cluster will automatically fail over to the surviving nodes, a new transaction coordinator will be elected (non-blocking), and no committed transactions will be lost. This is a key feature of RonDB and has been tested in the most demanding applications for more than 15 years and tested thousands of times on a daily basis.<br></p><p>Additionally it can be mentioned that in a highly available setup, in a cloud environment RonDB can read any replica and still see the latest changes whereas Redis will have to read the main replica to get a consistent view of the data and this will, in this case, require communicating across availability zones which can easily add milliseconds to latency for reads. RonDB will automatically setup the cluster such that applications using the <a href="https://www.logicalclocks.com/research/distributed-hierarchical-file-systems-strike-back-in-the-cloud?utm_source=rondb" target="_blank">APIs will read replicas that are located in the same availability zone</a>. Thus in those setups RonDB will always be able to read the latest version of the data and still deliver data at the lowest possible latency. <strong>Redis setups will have to choose between delivering consistent data with higher latency or inconsistent data with low latency in this setup.</strong><br></p><h3><strong>Scalable Storage</strong></h3><p>Redis only supports in-memory data - this means that Redis will not be able to support online Feature Stores that store lots of data. In contrast, RonDB can store data both in-memory and on-disk, and with support for up to 144 database nodes in a cluster, it can scale to clusters of up to 1PB in size.<br></p><h3><strong>Analysis: Three Generations of Multithread Architectures</strong></h3><p>For our single-threaded benchmark, we did not expect there to be, nor were there, any major differences in throughput or latency for either read or write operations. The purpose of the benchmark was to show that both databases are similar in how efficiently they use a single CPU. RonDB and Redis are both in-memory databases, but the implementation details of their multithreaded architectures matters for scalability (how efficiently they handle increased resources), as we will see.&nbsp;<br></p><p>Firstly, <a href="https://redis.io/topics/benchmarks/utm_source=rondb" target="_blank">‚ÄúRedis is not designed to benefit from multiple CPU cores. People are supposed to launch several Redis instances to scale out on several cores if needed.‚Äù</a> For our use-case of online feature stores, it is decidedly non-trivial to partition a feature store across multiple redis instances. Therefore, commercial ‚Ä¶</p></div></div></div></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="http://www.logicalclocks.com/blog/ai-ml-needs-a-key-value-store-and-redis-is-not-up-to-it">http://www.logicalclocks.com/blog/ai-ml-needs-a-key-value-store-and-redis-is-not-up-to-it</a></em></p>]]>
            </description>
            <link>http://www.logicalclocks.com/blog/ai-ml-needs-a-key-value-store-and-redis-is-not-up-to-it</link>
            <guid isPermaLink="false">hacker-news-small-sites-26293114</guid>
            <pubDate>Sun, 28 Feb 2021 13:02:18 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Reasoning about Taxes]]>
            </title>
            <description>
<![CDATA[
Score 25 | Comments 74 (<a href="https://news.ycombinator.com/item?id=26292993">thread link</a>) | @acqbu
<br/>
February 28, 2021 | https://www.billdietrich.me/ReasonTaxes.html | <a href="https://web.archive.org/web/*/https://www.billdietrich.me/ReasonTaxes.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/>Unable to extract article]]>
            </description>
            <link>https://www.billdietrich.me/ReasonTaxes.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-26292993</guid>
            <pubDate>Sun, 28 Feb 2021 12:42:35 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Hunting two PDP-1 photos (which are not what they seem)]]>
            </title>
            <description>
<![CDATA[
Score 93 | Comments 30 (<a href="https://news.ycombinator.com/item?id=26292781">thread link</a>) | @masswerk
<br/>
February 28, 2021 | https://www.masswerk.at/nowgobang/2021/train-spotting-1 | <a href="https://web.archive.org/web/*/https://www.masswerk.at/nowgobang/2021/train-spotting-1">archive.org</a>
<br/><!-- hnss:readable-content --><hr/>Unable to retrieve article]]>
            </description>
            <link>https://www.masswerk.at/nowgobang/2021/train-spotting-1</link>
            <guid isPermaLink="false">hacker-news-small-sites-26292781</guid>
            <pubDate>Sun, 28 Feb 2021 12:02:03 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Indeed MPH: Fast and Compact Immutable Key-Value Stores]]>
            </title>
            <description>
<![CDATA[
Score 10 | Comments 0 (<a href="https://news.ycombinator.com/item?id=26292427">thread link</a>) | @gbrown_
<br/>
February 28, 2021 | https://engineering.indeedblog.com/blog/2018/02/indeed-mph/ | <a href="https://web.archive.org/web/*/https://engineering.indeedblog.com/blog/2018/02/indeed-mph/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
		

		<div>

			<p><img loading="lazy" src="http://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/MPH-Blog-Header.png" alt="" width="1024" height="250" srcset="https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/MPH-Blog-Header.png 1024w, https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/MPH-Blog-Header-300x73.png 300w, https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/MPH-Blog-Header-768x188.png 768w, https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/MPH-Blog-Header-747x182.png 747w" sizes="(max-width: 1024px) 100vw, 1024px"></p>
<p>When you need to scale an application with a lot of data, how do you decide on a storage solution? How can you both safely store and efficiently interact with large data sets? This often turns into a debate about whether to use SQL or NoSQL. Each comes with strengths and drawbacks.</p>
<p>But what if there was a third option that sidestepped database concerns altogether?</p>
<p>Consumers might need updates no more often than every few minutes. In this case, being able to load a data set into memory dramatically speeds access and allows for tremendous scale. This is why, for many projects at Indeed, we distribute a full copy of the needed data to each consumer and render the SQL or NoSQL debate unnecessary. To make this possible, we manage data size using a new key-value store based on minimal perfect hash functions. We‚Äôve implemented this store as a Java library called <a href="https://github.com/indeedeng/mph-table" rel="noopener noreferrer">Indeed MPH</a>.</p>
<h2>The problems with distributing data</h2>
<p>Usually, distributing a full copy of your data to consumers is impractical for two reasons. First, the data must be mostly read-only. Second, the data cannot be so large as to prevent distribution or processing.</p>
<p>You can overcome the first problem by implementing batch updates. Redistribute the data every day, every hour, or even more frequently, and you keep the data read-only while ensuring that it remains useful. However, how do you keep the size down? As it turns out, the same batch update strategy that addresses the first problem also addresses the second.</p>
<h2>Minimal perfect hash functions</h2>
<p>Generating read-only data sets means that we know all the keys for our data set in advance. This lets us apply optimizations to the data set to reduce its size. In the case of hash tables, this knowledge allows us to compute a <a href="https://en.wikipedia.org/wiki/Perfect_hash_function" rel="noopener noreferrer" data-href="https://en.wikipedia.org/wiki/Perfect_hash_function">perfect hash function</a>.</p>
<p>A perfect hash function maps every element to a distinct integer with no collisions‚Ää‚Äî‚Ääin mathematical terms it‚Äôs an injective function. A minimal perfect hash (mph) function maps <em>n</em> keys to the <em>n</em> consecutive integers [0, <em>n</em>-1]. With such a structure we can guarantee a single disk seek while maintaining 100% load in the table, but as we‚Äôll demonstrate later, there are even more advantages.</p>
<p>Finding such hash functions can be difficult. In fact the Birthday Paradox, described in this <a href="https://en.wikipedia.org/wiki/Birthday_problem" rel="noopener noreferrer" data-href="https://en.wikipedia.org/wiki/Birthday_problem">Wikipedia article</a>, tells us that zero collisions is unlikely even if <em>m</em> is several times larger than <em>n.</em> However, recent advances have yielded efficient techniques (such as described in <a href="http://staff.itee.uq.edu.au/havas/TR0242.pdf" rel="noopener noreferrer" data-href="http://staff.itee.uq.edu.au/havas/TR0242.pdf">this abstract</a>) and <a href="http://sux.di.unimi.it/" rel="noopener noreferrer" data-href="http://sux.di.unimi.it/">quality libraries</a> for generating minimal perfect hashes. These techniques allow our method to succeed with only a small downside: the resulting hash function itself requires a lookup table of ~2.2 bits per key, so it does not occupy a constant size. However, this lookup table is a fraction of the size of a bloom filter and only requires about 26MB for 100 million entries. In practice, the size of the lookup table is negligible compared to the size of the data being stored.</p>
<h2>Practicalities</h2>
<p>An mph function gives us a mapping from the keys to [0, <em>n</em>-1], but we still need to implement the table. In memory, we‚Äôd typically just store the data in an array. To translate this to offline storage we need to make something explicit that programming language arrays make implicit: memory offsets. Our representation is a directory with three files:</p>
<ul>
<li>data.bin: the raw serialized key/value pairs</li>
<li>offsets.bin: a fixed size array where the <em>i</em>th value is the byte offset in data.bin for the entry whose hash is <em>i</em></li>
<li>meta.bin: the serialized hash function itself, along with any other desired metadata</li>
</ul>
<p>The following figure shows this representation with an index mapping colors to animals:</p>
<p><a href="http://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph1.png"><img loading="lazy" src="https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph1.png" alt="A representation of explicitly mapping memory offsets using three files." width="506" height="195" srcset="https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph1.png 506w, https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph1-300x116.png 300w" sizes="(max-width: 506px) 100vw, 506px"></a></p>
<p>The file containing the serialized hash requires roughly 2 bits per key, while the file containing the offsets requires 4 bytes. The raw serialized key/value pairs require 46 bytes per key.</p>
<p>One convenience of this representation is that data.bin is raw data available for iterating, independent of the hash function. In addition, we might have multiple hash functions indexing the same data.bin by different keys as long as those keys are always unique.</p>
<p>The disadvantage of this representation is with many small entries. In this case, the size of the offsets could be on par with or even larger than the data itself. For an extreme example, if the data contains 750 million mappings from int to half-precision float, we require 7.5e8 * 6 = ~4.2G for data.bin, but 7.5e8 * 8 = ~5.6G for offsets.bin! In this example, we can take advantage of every entry having a fixed size. We don‚Äôt need to store the offsets‚Ää‚Äî‚Ääwe can index directly into data.bin. But we want to optimize the variable-sized case as well.</p>
<p>This high cost comes specifically when we‚Äôre dealing with small entries. If the entries are large, the size of the offsets are negligible by comparison. Because the total size is small, we can represent it with a <a href="https://en.wikipedia.org/wiki/Succinct_data_structure" rel="noopener noreferrer" data-href="https://en.wikipedia.org/wiki/Succinct_data_structure">rank (bitcount) data-structure</a>, on the order of bits per entry instead of bytes. For a little more overhead, we can compute the inverse of rank, called select, in constant time on this same data structure. Why is that useful? If the bits are set for the start byte of every entry in data.bin, then finding the offset of the <em>i</em>th entry is just computing select(<em>i</em>).</p>
<p>The structure becomes the following. In this case we now have to sort data.bin by hash value.</p>
<p><a href="http://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph6.png"><img loading="lazy" src="https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph6.png" alt="A representation of explicitly mapping memory offsets with optimization in the offsets file." width="534" height="324" srcset="https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph6.png 534w, https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph6-300x182.png 300w" sizes="(max-width: 534px) 100vw, 534px"></a></p>
<p>In the optimized structure, the file containing the offsets requires 1.x * 46 bits.</p>
<p>A further optimization comes from the often very regular structure in our data. For instance, to map from a long to list of longs (using a single byte for the count), the size of every individual entry <em>i</em> (including key and value) can be represented as 8<em>xi</em> + 9, assuming the length of the list is <em>xi</em>. The offset of the <em>k</em>th entry becomes ‚àë(8<em>xi</em> + 9) = 9<em>k</em> + ‚àë8<em>xi</em> = 9<em>k</em> + 8<em>x</em>. In other words, all we have to store is <em>x</em>, which is much smaller than the actual offset, and a big savings with the select approach. In this case, with 10 million entries averaging 2 elements in the list, the size of data.bin is 10000000 * (9 + 16) = ~250M, but the compressed select method uses only ~2.5M.</p>
<p>Our implementation computes what the size would be with both an array of offsets and the select approach and chooses accordingly.</p>
<h2>More optimizations</h2>
<h3>Throw away the keys!</h3>
<p>If we have no collisions and know that the key we are looking up is in the table, we don‚Äôt need to verify it. Alternately, we may be able to validate the key from the value, or from other sources given the value. Finally, if we can accept some small probability of false positive lookups, we can always probabilistically verify whether keys are in the table by using a bloom filter.</p>
<p>We have a better alternative. Since we‚Äôve already hashed to a value that has no collisions in the original key set, we can store a <em>k</em>-bit signature (the low bits of any universal hash will do) of the key. Any key not in the original set that hashes to the same value will only match the signature with probability 2-<em>k</em>. This is a much better error rate than with a bloom filter.</p>
<p>In all of these cases, we can omit the keys entirely from the table. When the values are small, the keys may be a significant fraction, or even the majority of the table.</p>
<h3>Link by hashes, not keys</h3>
<p>It‚Äôs common to want to link multiple tables together‚Ää‚Äî‚Ääthe values of one table either are, or contain foreign keys into, another table.</p>
<p>Another benefit of using an mph function is that it compresses keys to a compact integer range. We can store the hash value instead of the key, which for most practical purposes will fit in a 4-byte integer, as opposed to 8-byte longs or larger for many other foreign keys. Not only is this more compact, but it‚Äôs also faster to read because we don‚Äôt need to re-compute the hash for the second lookup.</p>
<h2>Code and benchmarks</h2>
<p>We‚Äôre excited to announce that we‚Äôve open-sourced our mph code. For benchmarks we compare with several open source alternatives:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/SQLite" rel="noopener noreferrer" data-href="https://en.wikipedia.org/wiki/SQLite">SQLite3</a>: a single-file RDBMS suitable for replication</li>
<li><a href="https://en.wikipedia.org/wiki/LevelDB" rel="noopener noreferrer" data-href="https://en.wikipedia.org/wiki/LevelDB">LevelDB</a>: Google‚Äôs LSM tree key-value store</li>
<li><a href="https://github.com/IndeedEng/lsmtree" rel="noopener noreferrer" data-href="https://github.com/IndeedEng/lsmtree">lsm</a>: our LSM tree key-value store</li>
<li><a href="http://discodb.readthedocs.io/en/latest/" rel="noopener noreferrer" data-href="http://discodb.readthedocs.io/en/latest/">discodb</a>: an immutable key-value store also based on minimal perfect hashing</li>
<li><a href="http://www.corpit.ru/mjt/tinycdb.html" rel="noopener noreferrer" data-href="http://www.corpit.ru/mjt/tinycdb.html">TinyCDB</a>: an immutable key-value store using non-perfect hashing</li>
</ul>
<p>Note these options do not have equivalent feature sets. SQLite provides full relational operations, lsm and LevelDB provide range queries, and all three of these are mutable. Here we are concerned only with the common functionality of these options.</p>
<p>We look at the results for two conceptually linked stores based on our production data. This allows us to demonstrate the link by hashing optimization described above, and also enables a more natural representation in SQLite. The first store is a mapping from 50 million 64-bit hashes to a small cluster of ‚Äúitems,‚Äù which are 80-bit integers represented as 16-digit base-32 strings. The second store is the reverse mapping from each item in the cluster to its associated hash.</p>
<p>An important aspect of our own key-value stores is their use of arbitrary serialization via a plugin infrastructure. So for a fair comparison, in the sizes for our LSM trees and MPH tables we include both the sizes for opaque string to string mappings, as well as two optimizations. We encode keys as fixed 8-byte long values, and encode the values as short lists of 80-bit integers. For SQLite we encode the keys as integers.</p>
<p><a href="http://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph4.png"><img loading="lazy" src="https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph4-1024x633.png" alt="A bar graph comparing data size in MB for string mappings between several storage methods." width="1024" height="633" srcset="https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph4-1024x633.png 1024w, https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph4-300x186.png 300w, https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph4-768x475.png 768w, https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph4-679x420.png 679w, https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph4.png 1200w" sizes="(max-width: 1024px) 100vw, 1024px"></a></p>
<p>In the general case of string mappings, LevelDB, lsm and mph are all of comparable size, and notably smaller than the alternative solutions. If we apply more efficient serialization lsm and mph become much smaller, and mph is increasingly able to take advantage of the regularity in size to become the smallest option.<a href="http://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph2.png"><img loading="lazy" src="https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph2-1024x633.png" alt="A bar graph comparing data size in MB for serializations between several storage methods." width="1024" height="633" srcset="https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph2-1024x633.png 1024w, https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph2-300x186.png 300w, https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph2-768x475.png 768w, https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph2-679x420.png 679w, https://rac4ou2q3g246tjk3rxqbt1c-wpengine.netdna-ssl.com/wp-content/uploads/2018/01/mph2.png 1200w" sizes="(max-width: 1024px) 100vw, 1024px"></a></p>
<p>Here we consider only the best serialization for lsm and mph. For mph we also show the size with the optimizations discussed above, first not storing the keys and then also linking to the above table via the perfect hash value. For SQLite we include the size when indexing on both columns, which allows us to remove the previous table altogether. In this ‚Ä¶</p></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://engineering.indeedblog.com/blog/2018/02/indeed-mph/">https://engineering.indeedblog.com/blog/2018/02/indeed-mph/</a></em></p>]]>
            </description>
            <link>https://engineering.indeedblog.com/blog/2018/02/indeed-mph/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26292427</guid>
            <pubDate>Sun, 28 Feb 2021 10:56:47 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[The KimKlone Microcomputer]]>
            </title>
            <description>
<![CDATA[
Score 13 | Comments 0 (<a href="https://news.ycombinator.com/item?id=26292235">thread link</a>) | @gbrown_
<br/>
February 28, 2021 | https://laughtonelectronics.com/Arcana/KimKlone/Kimklone_intro.html | <a href="https://web.archive.org/web/*/https://laughtonelectronics.com/Arcana/KimKlone/Kimklone_intro.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
      <td colspan="2">KimKlone
is a microcomputer I built in the 1980s, both as a radical redesign of
an
existing instruction set and
as a prosaic tool for use in my lab. The article explains the
machine's capabilities and also the intriguing manner of their
implementation. Despite intimate involvement of external logic (in the
form of 7400 series SSI), the machine
responds to the programmer just as aptly as a redesign carried out at
the silicon level.<p>
      
The KimKlone represents an architectural
extension of the 65C02. The most striking improvement is efficient
linear access to
a <span>16
Mbyte Address Space</span>.
Also on the short list is <span>hardware
acceleration</span> for the <span>Forth</span>
programming language, including a one-byte NEXT instruction and a new,
stack-savvy <strong>addressing
mode</strong>. To exploit these and
other capabilities,
the programmer has access to new instructions and new registers. (See
the programming model above.)
      </p><p>The
new instructions aren't interrupts or traps to emulation
routines. Nor are the new registers merely an over-glorified
MMU (Memory Management Unit), the sort of thing that's inoperable
except via peeking and poking with I/O accesses. <span>The
KimKlone actually has brand new instructions, to which the new
registers implicitly
respond. The novel instructions execute inline and at full speed.</span>
There are 44 new op-codes, all mapped into the
Undefined spaces in the Rockwell 65C02 op-code map.
This article is organized as shown in the Contents section above. </p>
The machine's nickname, "KimKlone," may be
misleading. <strong>The KimKlone
has little in common with a MOS Technology KIM-1</strong>.
The nickname arises simply because some of the concepts were first
explored on my
heavily reworked KIM-1. Also, the reference to "Cheap Video"
is a nod to author Don Lancaster. The Kimklone and
my KIM-1 both include mutations of the audacious Lancaster video
interface, and
his books helped foster my own outside-the-box design approach. See <a href="https://laughtonelectronics.com/Arcana/KimKlone/BrideOfSon%20KK%20Lancaster.html"><span>Cheap Video</span>
√† la Lancaster, and The Back Story re: KIM-1</a>
      <p>The KimKlone is a
fascinating device. If you find it a little "over the top," be
aware that
I too am amused by how it turned out. This lowly lab computer took on a
life of its own while it was still on the drawing board.<br>
      </p>
      </td>
    </div></div>]]>
            </description>
            <link>https://laughtonelectronics.com/Arcana/KimKlone/Kimklone_intro.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-26292235</guid>
            <pubDate>Sun, 28 Feb 2021 10:19:48 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Actually Portable Executables]]>
            </title>
            <description>
<![CDATA[
Score 649 | Comments 143 (<a href="https://news.ycombinator.com/item?id=26292166">thread link</a>) | @krab
<br/>
February 28, 2021 | https://ahgamut.github.io/c/2021/02/27/ape-cosmo/ | <a href="https://web.archive.org/web/*/https://ahgamut.github.io/c/2021/02/27/ape-cosmo/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div> <div>  <p><span>27 Feb 2021</span></p><p>I came across <a href="https://github.com/jart/cosmopolitan">Cosmopolitan</a> on Hacker News, and I was initially confused, due to a few memories of cross-compilation nightmares: while it should be possible to compile for the same architecture regardless of operating system, wouldn‚Äôt the OS get confused by the leading bytes of the executable? I read the <a href="https://justine.lol/ape.html">article</a> explaining how it works, but most of it went over my head.</p> <p>The example on the <a href="https://github.com/jart/cosmopolitan">Github README</a> used the following script for compilation:</p> <div><div><pre><code>gcc <span>-g</span> <span>-O</span> <span>-static</span> <span>-nostdlib</span> <span>-nostdinc</span> <span>-fno-pie</span> <span>-no-pie</span> <span>-mno-red-zone</span> <span>\</span>
  <span>-o</span> hello.com.dbg hello.c <span>-fuse-ld</span><span>=</span>bfd <span>-Wl</span>,-T,ape.lds <span>\</span>
  <span>-include</span> cosmopolitan.h crt.o ape.o cosmopolitan.a
objcopy <span>-S</span> <span>-O</span> binary hello.com.dbg hello.com
</code></pre></div></div> <p>I converted it into a simple Makefile to run the compilation commands. I tried a bunch of simple C programs (basic arithmetic, reading and writing to files) on Linux+Windows (compiled on Linux), and all of them worked.</p> <h2 id="compiling-lua-with-cosmopolitan">Compiling Lua with Cosmopolitan</h2> <p>I decided to try compiling a high-level language built on C. I originally picked Python, but the Makefile for Python seemed too complicated to mess with, so I then picked <a href="https://www.lua.org/download.html">Lua</a>, which looked much simpler in comparison.</p> <p>I started out by blindly copy-pasting the flags and includes used in the sample compilation on Github. Ah, it would have been wonderful for my laziness if it compiled out of the box. Following is a play-by-play commentary of trying to compile Lua.</p> <p>First problem I ran into was header clashes: if I didn‚Äôt put <code>-nostdlib -nostdinc</code> while compiling each object file, <code>-include cosmopolitan.h</code> would clash with the system headers. But blocking the system headers meant I would have to change every <code>#include</code> of a system header. I created a bunch of dummy headers with the same names as those in the <a href="https://en.cppreference.com/w/c/header">C stdlib</a> and and included to those instead.</p> <p>Naming clashes: some of the macros in <code>cosmopolitan.h</code> clashed with macro/function names in Lua: <code>reverse</code> and <code>isempty</code>. I changed the Lua source to avoid this.</p> <p>A macro <code>FIRST_RESERVED</code> was broken because <code>UCHAR_MAX</code> was missing. I thought <code>UCHAR_MAX</code> was supposed to be in <code>limits.h</code> ‚Äì the <code>limits.h</code> part of <code>cosmopolitan.h</code> did not have <code>UCHAR_MAX</code> (It had <code>SCHAR_MAX</code>, though.) I added in a <code>#define</code> stating <code>UCHAR_MAX</code> as <code>__UINT8_MAX__</code> (ie 255).</p> <p>The default Lua Makefile attempts to use <code>_setjmp</code>/<code>_longjmp</code> in <code>ldo.c</code> when on Linux. I disabled the <code>LUA_USE_LINUX</code> flag for compiling the object files, but this caused an issue with <code>tmpnam</code> in <code>loslib.c</code> (<code>mkstemp</code> is available in Cosmopolitan). I changed the Lua source to use <code>setjmp</code>/<code>longjmp</code>. A similar issue showed in <code>lauxlib.c</code> for <code>sys/wait.h</code> (which is a no-op in non-POSIX systems, as per the Lua source code), and in <code>liolib</code> for <code>sys/types.h</code> so disabled <code>LUA_USE_POSIX</code> over there as well.</p> <p>The <code>localeconv()</code> function (part of <code>locale.h</code>) was not implemented in <code>cosmopolitan.h</code>, and this caused an error while compiling <code>lobject.c</code> (macro <code>lua_getlocaledecpoint()</code> depended on <code>localeconv()</code>). Changed the macro to just return <code>'.'</code>.</p> <p>The <code>panic</code> function in Lua <code>static int panic (lua_state*)</code> clashed with that in Cosmopolitan <code>void panic(void)</code>. Renamed the lua function to <code>lua_panic</code>. This triggered an error where the <code>panic</code> function was being called in <code>luaL_newstate</code>, so I changed the name there as well.</p> <p><code>luaL_loadfilex</code> caused a <em>frame size error</em> ‚Äì I have never seen this before. A quick internet search shows that this is because a large buffer is allocated on stack when entering the function, and yes, <code>luaL_loadfilex</code> allocates a <code>loadF</code> object containing a <code>char</code> buffer of <code>BUFSIZ</code>. I reduced the size of the buffer to <code>BUFSIZ - 64</code>.</p> <p><code>loslib.c</code> reuiqres the <code>setlocale()</code> and <code>LC_*</code> from <code>locale.h</code>, which is defined as an extern value in <code>cosmopolitan.h</code>, but that definition is somehow not enough.. screw it, I just disabled <code>os_setlocale</code> in <code>loslib.c</code>, and then it compiles.</p> <h2 id="linking-the-object-files">Linking the object files</h2> <p>Ok, time for linking ‚Ä¶</p> <div><div><pre><code>gcc -std=gnu99 -o lua   lua.o liblua.a -lm -Wl,-E -ldl
/usr/bin/ld: errno: TLS definition in //lib/x86_64-linux-gnu/libc.so.6 section
.tbss mismatches non-TLS reference in liblua.a(lauxlib.o)
/usr/bin/ld: //lib/x86_64-linux-gnu/libc.so.6: error adding symbols: bad value
collect2: error: ld returned 1 exit status
</code></pre></div></div> <p>I forgot, I shouldn‚Äôt <code>-lm</code> or <code>-ldl</code>. Ok, let‚Äôs try with all the object files instead of <code>liblua.a</code>:</p> <div><div><pre><code>/usr/bin/ld.bfd: lvm.o: in function `l_strcmp':
lvm.c:(.text+0x59): undefined reference to `strcoll'
/usr/bin/ld.bfd: lmathlib.o: in function `math_tanh':
lmathlib.c:(.text+0x21f): undefined reference to `tanh'
/usr/bin/ld.bfd: lmathlib.o: in function `math_sinh':
lmathlib.c:(.text+0x24f): undefined reference to `sinh'
/usr/bin/ld.bfd: lmathlib.o: in function `math_cosh':
lmathlib.c:(.text+0x27f): undefined reference to `cosh'
collect2: error: ld returned 1 exit status
</code></pre></div></div> <p>Umm‚Ä¶ okay, it looks like some of the functions defined in the cosmopolitan header are yet to be implemented in the static library. That‚Äôs okay, I can just quickly fill in the math functions, and I‚Äôll comment out <code>strcoll</code> for now, just because I want to see it compile‚Ä¶. and it successfully compiles!! Let‚Äôs run <code>objcopy</code> before trying it out on a system though.</p> <div><div><pre><code>$ objcopy -S -O binary lua lua.exe
$ ls -al
-rwxr-xr-x 1 1953720 Feb 27 01:33 lua
-rwxr-xr-x 1 344064 Feb 27 01:39 lua.exe
</code></pre></div></div> <p>That size reduction seems a little too drastic, but let‚Äôs see if it runs on Linux:</p> <p><img src="https://ahgamut.github.io/assets/images/linux_screen.png" alt=""></p> <p>Awesome. How about Windows?</p> <p><img src="https://ahgamut.github.io/assets/images/windows_screen.png" alt=""></p> <h2 id="summary-it-is-actually-portable">Summary: it <em>is</em> actually portable</h2> <p>This is pretty incredible: I just had to modify a few lines in a Makefile and some C source files, and I got a Lua executable that works both on Linux and Windows (and possibly others as well). Granted, there are still some details to be filled out (floating point calculation above prints a <code>g</code>), but Cosmopolitan is currently at release 0.0.2, so there is a lot of time.</p> <p>Hopefully this means that other languages that have source code completely in C can also be compiled once and run anywhere. Actually Portable Python next, maybe?</p> </div> </div></div>]]>
            </description>
            <link>https://ahgamut.github.io/c/2021/02/27/ape-cosmo/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26292166</guid>
            <pubDate>Sun, 28 Feb 2021 10:06:42 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Take a look at Nomad before jumping on Kubernetes]]>
            </title>
            <description>
<![CDATA[
Score 158 | Comments 76 (<a href="https://news.ycombinator.com/item?id=26291975">thread link</a>) | @sofixa
<br/>
February 28, 2021 | https://atodorov.me/2021/02/27/why-you-should-take-a-look-at-nomad-before-jumping-on-kubernetes/ | <a href="https://web.archive.org/web/*/https://atodorov.me/2021/02/27/why-you-should-take-a-look-at-nomad-before-jumping-on-kubernetes/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
      
        
        <h2>Table of Contents</h2>
        
         
      
      <h2 id="pre-introduction">Pre-introduction</h2>
<p>Recently I stumbled upon and then stumbled upon again on <a href="https://blog.dave.tf/post/new-kubernetes/">David Anderson</a>‚Äôs interesting post about ‚Äúnew Kubernetes‚Äù, based on a discussion he had with <a href="https://timewitch.net/">Vallery Lancey</a> about what they would do differently if they were rewriting Kubernetes from scratch. Interestingly, a decent part of the proposals for a ‚Äúnew Kubernetes‚Äù are design choices made by Hashicorp for <a href="https://www.nomadproject.io/">Nomad</a>, which is a pretty underrated orchestrator, and drastically simpler ( one of the main goals of said ‚Äúnew Kubernetes‚Äù).</p>
<p>Some people are aware that Docker Swarm kinda exists but is abandonware/on life support, and isn‚Äôt really recommended anymore, but it still comes up in discussions due to how easy it is to use. For most, that leaves Kubernetes as the only ‚Äúserious‚Äù option, but it is a <em>very</em> complex piece of software, with a lot of moving parts, which isn‚Äôt actually required or need in most cases.</p>

  <figure>
    <img src="https://atodorov.me/img/nomad/kubernetes.jpg#center">
    
  </figure>


<p>This inspired me to write a series on Nomad, what it is, why it‚Äôs great, where it‚Äôs lacking and how to use it.</p>
<h2 id="introduction---what-is-nomad-and-why-its-great">Introduction - what is Nomad and why it‚Äôs great</h2>
<p>Hashicorp‚Äôs Nomad is a simple to run and maintain, yet very flexible task scheduler/orchestrator. It relies on plugins for execution, autoscaling and other features, and can run pretty much anything via its <code>task drivers</code> - Docker, contairnerd, LXC, rkt, podman, Java, fork/exec, QEMU, firecracker, FreeBSD jails.</p>
<p>It comes in the form of a single binary, run in two modes (<code>server</code>, in groups of 3 or 5, which make scheduling decisions and host the APIs and configuration, and an unlimited number of <code>worker</code>s which actually run whatever it is you want to run), and can be automatically clustered via <a href="https://consul.io/">Consul</a>. The configuration ( both for jobs and of Nomad itself) is in <a href="https://github.com/hashicorp/hcl">HCL</a> (I‚Äôll get into more detail about how great that is a bit later) or JSON (mainly for when the jobs are submitted by machines/scripts/tooling and not humans). Multiple clusters can be connected via <a href="https://learn.hashicorp.com/tutorials/nomad/federation?in=nomad/manage-clusters">multi-region federation</a> for sharing ACLs and for API forwarding ( you can submit a job or request logs to any server for any region and it will be forwarded to the appropriate server). Deployments can be complex out of the box ( rolling, canary, blue/green), and everything is version controlled and rollbackable.</p>
<p>Like most HashiCorp tools, it‚Äôs ‚Äúopen core‚Äù, meaning that the majority of features are available in an <a href="https://github.com/hashicorp/nomad">open source</a> version, and some more advanced/enterprise-y ones ( in Nomad‚Äôs case, <a href="https://www.hashicorp.com/blog/hashicorp-nomad-multi-cluster-deployment">multi-region/cluster deployments</a> - deploying something simultaneously to multiple separate clusters, policy as code with <a href="https://docs.hashicorp.com/sentinel/nomad">Sentinel</a> and similar ) require upgrading to Nomad Enterprise.</p>
<h2 id="primitives">Primitives</h2>
<ul>
<li><code>job</code> is a declarative file which contains groups of tasks, each task being a container/binary/anything run by an exec driver</li>
<li><code>system</code> jobs (run on all client nodes, equivalent to Kubernetes DaemonSets, for monitoring/logging agents/load balancers)</li>
<li><code>periodic</code> jobs (equivalent to cronjobs)</li>
<li><code>service</code>, which registers as a Consul service and is thus discoverable ( via API or DNS)</li>
<li><code>deployment</code>, each version of a job, they‚Äôre tracked and can be rollbacked to</li>
<li><code>allocation</code>, each instance of a task ( group ) on a node</li>
<li><code>namespace</code>, a logical unit to organise jobs in and ACLs around</li>
</ul>
<h3 id="jobs">Jobs</h3>
<p>Example of a very basic job that runs a Docker container (<code>jaegertracing/all-in-one:1.21</code>), with limits of 1000Mhz of CPU and 1024MB of RAM, and registers the service with Consul:</p>
<div><pre><code data-lang="hcl"><span>job</span> <span>"jaeger"</span> {
        type <span>=</span> <span>"service"</span>
        <span>group</span> <span>"api"</span> {
            <span>task</span> <span>"jaeger"</span> {
                driver <span>=</span> <span>"docker"</span>
                <span>config</span> { 
                  image <span>=</span> <span>"jaegertracing/all-in-one:1.21"</span>
                }
                <span>resources</span> {
                  cpu <span>=</span> <span>1000</span>
                  memory <span>=</span> <span>1024</span>
                }
                <span>service</span> {
                  name <span>=</span> <span>"jaeger-query"</span>
                }
            }
        }            
}
</code></pre></div><p>Note that this is a <em>very</em> basic job, there are no healthchecks, no persistent storage, no extra configuration, no update strategy, no autoscaling, no exposed ports.</p>
<h4 id="deployment-history-and-rollback">Deployment history and rollback</h4>
<p>Nomad tracks each job‚Äôs full definitions and deployment history, and allows you to easily rollback and compare them, via the UI, CLI or API, e.g.:</p>
<div><pre><code data-lang="bash"><span># List the versions of the job named "opentelemetry-collector"</span>
$ nomad job history opentelemetry-collector
Version     <span>=</span> <span>1</span>
Stable      <span>=</span> false
Submit Date <span>=</span> 2021-01-08T21:30:30+01:00

Version     <span>=</span> <span>0</span>
Stable      <span>=</span> true
Submit Date <span>=</span> 2021-01-08T21:29:48+01:00

<span># Check the difference between versions</span>
$ nomad job history -p opentelemetry-collector
Version     <span>=</span> <span>1</span>
Stable      <span>=</span> false
Submit Date <span>=</span> 2021-01-08T21:30:30+01:00
Diff        <span>=</span>
+/- Job: <span>"opentelemetry-collector"</span>
+/- Task Group: <span>"opentelemetry-collector"</span>
  +/- Task: <span>"opentelemetry-collector"</span>
    +/- Config <span>{</span>
          args<span>[</span>0<span>]</span>:  <span>"--config=local/otel/config.yaml"</span>
      +/- image:    <span>"otel/opentelemetry-collector-contrib:0.15.0"</span> <span>=</span>&gt; <span>"otel/opentelemetry-collector-contrib:0.16.0"</span>
          ports<span>[</span>0<span>]</span>: <span>"health"</span>
          ports<span>[</span>1<span>]</span>: <span>"jaeger_thrift_compact"</span>
        <span>}</span>

Version     <span>=</span> <span>0</span>
Stable      <span>=</span> true
Submit Date <span>=</span> 2021-01-08T21:29:48+01:00

<span># Revert job "opentelemetry-collector" to version 0</span>
$ nomad job revert opentelemetry-collector <span>0</span>

</code></pre></div><h4 id="state-tracking-and-job-planning">State tracking and job planning</h4>
<p>Nomad keeps the desired state and its history, and with <code>nomad job plan</code>, similar to <code>terraform plan</code>, allows us to preview what will change upon applying a new job file. There‚Äôs also a feature to verify nothing has changed between the <code>plan</code> and <code>run</code> (equivalent to <code>terraform apply</code> with a plan file) with the <code>-check-index</code> flag:</p>
<div><pre><code data-lang="bash">$ nomad job plan otel.nomad
+/- Job: <span>"otel"</span>
+/- Task Group: <span>"opentelemetry"</span> <span>(</span><span>1</span> create/destroy update<span>)</span>
  +/- Task: <span>"opentelemetry-collector"</span> <span>(</span>forces create/destroy update<span>)</span>
    +/- Config <span>{</span>
          args<span>[</span>0<span>]</span>:  <span>"--config=local/otel/config.yaml"</span>
      +/- image:    <span>"otel/opentelemetry-collector-contrib:0.15.0"</span> <span>=</span>&gt; <span>"otel/opentelemetry-collector-contrib:0.20.0"</span>
          ports<span>[</span>0<span>]</span>: <span>"health"</span>
          ports<span>[</span>1<span>]</span>: <span>"jaeger_thrift_compact"</span>
        <span>}</span>
Scheduler dry-run:
- All tasks successfully allocated.

Job Modify Index: <span>413</span>
To submit the job with version verification run:

nomad job run -check-index <span>413</span> otel.nomad

When running the job with the check-index flag, the job will only be run <span>if</span> the
job modify index given matches the server-side version. If the index has
changed, another user has modified the job and the plan<span>'</span>s results are
potentially invalid.
</code></pre></div><p>Overall, it‚Äôs a very useful feature, especially when collaborating, locally or via CI/CD.</p>
<h4 id="checking-the-status-and-logs">Checking the status and logs</h4>
<p>To check the status of a job, there are a few commands under <code>nomad job</code> and <code>nomad alloc</code></p>
<div><pre><code data-lang="bash">$ nomad job status otel
ID            <span>=</span> otel
Name          <span>=</span> otel
Submit Date   <span>=</span> 2021-02-27T20:41:29+01:00
Type          <span>=</span> service
Priority      <span>=</span> <span>50</span>
Datacenters   <span>=</span> dc1
Namespace     <span>=</span> default
Status        <span>=</span> running
Periodic      <span>=</span> false
Parameterized <span>=</span> false

Summary
Task Group  Queued  Starting  Running  Failed  Complete  Lost
otel      <span>0</span>       <span>0</span>         <span>1</span>        <span>0</span>       <span>0</span>         <span>0</span>

Latest Deployment
ID          <span>=</span> ea533b6f
Status      <span>=</span> successful
Description <span>=</span> Deployment completed successfully

Deployed
Task Group  Desired  Placed  Healthy  Unhealthy  Progress Deadline
otel      <span>1</span>        <span>1</span>       <span>1</span>        <span>0</span>          2021-02-27T20:51:45+01:00

Allocations
ID        Node ID   Task Group  Version  Desired  Status   Created  Modified
89031cfd  d3cbeb7e  otel      <span>0</span>        run      running  20s ago  4s ago

<span># logs are at the allocation level ( similar to Kubernetes, where they're at the container level), so we get them with the alloc id</span>
$ nomad alloc logs 89031cfd
<span>[</span>...<span>]</span>
</code></pre></div><h4 id="lifecycle-and-sidecars">lifecycle and sidecars</h4>
<p>Nomad allows defining the lifecycle of tasks in task groups, and their status, with the <code>lifecycle</code> stanza. We can have <code>prestart</code> ( for initialisation ), <code>poststart</code> ( companion, for proxying (aka ambassador and adapter pattern in Kubernetes )) or <code>poststop</code> for clean up, and via the <code>sidecar</code> bool we define whether or not it should run as long as the main task(s), e.g.:</p>
<div><pre><code data-lang="hcl">  <span>task</span> <span>"init"</span> {
    <span>lifecycle</span> {
      hook <span>=</span> <span>"prestart"</span>
      sidecar <span>=</span> <span>false</span>
    }
    driver <span>=</span> <span>"docker"</span>
    <span>config</span> {
      image <span>=</span> <span>"alpine/httpie"</span>
      command <span>=</span> <span>"http"</span>
      args <span>=</span> [
        <span>"POST"</span>,
        <span>"https://some-internal-service-for-provisioning-stuff.local/v1/new"</span>,
        "job_id<span>=</span><span>'</span><span>${</span><span>NOMAD_JOB_ID</span><span>}</span><span>!'"</span>
      ]
    }
  }

  <span>task</span> <span>"fluentd"</span> {
    <span>lifecycle</span> {
      hook <span>=</span> <span>"poststart"</span><span> # should start after the main task
</span><span></span>      sidecar <span>=</span> <span>true</span><span> # should run as long as the main task does, and be restarted if it fails
</span><span></span>    }
    driver <span>=</span> <span>"docker"</span>
    <span>config</span> {
      image <span>=</span> <span>"fluentd/fluentd"</span>
    }
    ...
  }

  <span>task</span> <span>"main-app"</span> {
    ...
  }

  <span>task</span> <span>"cleanup"</span> {
    <span>lifecycle</span> {
      hook <span>=</span> <span>"poststop"</span>
    }
    driver <span>=</span> <span>"docker"</span>
    <span>config</span> {
      image <span>=</span> <span>"alpine"</span>
      command <span>=</span> <span>"rm -rf"</span>
      args <span>=</span> [
        <span>"/var/lib/volume-with-super-secret-data"</span>
      
    }
  }
</code></pre></div><h3 id="aclrbac">ACL/RBAC</h3>
<p>ACL ( access-control list ), or RBAC ( role-based access control ) as it‚Äôs known in Kubernetes, allow defining who can do what, so that not everyone with network access can have full administrator privileges and run/stop whatever. Nomad‚Äôs ACL system is pretty similar to Consul and Vault‚Äôs, and uses JSON ( mostly for non-humans ) or HCL to define <code>policies</code> with <code>rules</code>, which describe what action is allowed on what object.</p>
<div><pre><code data-lang="hcl"><span># a basic policy which allows the predefined read policy with read-only access to list and read:
</span><span># job, volume and scaling details, and extra capabilities for job creation and log access within the default namespace
</span><span></span><span>namespace</span> <span>"default"</span> {
  policy <span>=</span> <span>"read"</span>
  capabilities <span>=</span> [<span>"submit-job","dispatch-job","read-logs"</span>]
}
</code></pre></div><p>Assignment of policies is done only via the CLI, unlike Kubernetes where that happens in YAML, as does policy management:</p>
<div><pre><code data-lang="bash"><span># create/update the policy within Nomad</span>
nomad acl policy apply -description <span>"Application Developer policy"</span> my-policy my-policy.hcl
nomad acl token create -name<span>=</span><span>"Test token"</span> -policy<span>=</span>my-policy -type<span>=</span>client
Accessor ID  <span>=</span> ‚Ä¶</code></pre></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://atodorov.me/2021/02/27/why-you-should-take-a-look-at-nomad-before-jumping-on-kubernetes/">https://atodorov.me/2021/02/27/why-you-should-take-a-look-at-nomad-before-jumping-on-kubernetes/</a></em></p>]]>
            </description>
            <link>https://atodorov.me/2021/02/27/why-you-should-take-a-look-at-nomad-before-jumping-on-kubernetes/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26291975</guid>
            <pubDate>Sun, 28 Feb 2021 09:30:31 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[ROG AI Overclocking on Linux]]>
            </title>
            <description>
<![CDATA[
Score 12 | Comments 5 (<a href="https://news.ycombinator.com/item?id=26291486">thread link</a>) | @dragon-rabbit
<br/>
February 27, 2021 | https://leimao.github.io/blog/ROG-Linux-AI-Overclocking/ | <a href="https://web.archive.org/web/*/https://leimao.github.io/blog/ROG-Linux-AI-Overclocking/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
      <h3 id="introduction">Introduction</h3>

<p>ASUS Republic of Gamers (ROG) has released an AI overclocking tool on BIOS, which allows the PC users who are not experienced in overclocking to overclock the CPU and boost the operating system performance.</p>



<p>I am using a ROG Z390 MAXIMUS XI HERO (WI-FI) motherboard and an Intel i9-9900K CPU. In this blog post, I would like to share my experience with the ROG AI overclocking on Linux.</p>

<h3 id="benchmark-tools">Benchmark Tools</h3>

<p>Here are some benchmark tools that are available on Linux.</p>

<h4 id="blender">Blender</h4>

<p>Blender has a benchmark tool called <a href="https://opendata.blender.org/">Blender Open Data</a>, which allows you to benchmark your CPU or GPU.</p>

<div><div><pre><code>$ wget https://opendata.blender.org/cdn/BlenderBenchmark2.0/launcher/benchmark-launcher-2.0.5-linux.tar.gz
$ tar xvf benchmark-launcher-2.0.5-linux.tar.gz 
$ ./benchmark-launcher 
</code></pre></div></div>

<!-- <div class = "titled-image">
<figure class = "titled-image">
    <img src = "https://leimao.github.io/images/blog/2021-03-29-ROG-Linux-AI-Overclocking/blender.png" style = "width: 70%; height: 70%">
    <figcaption>Causal Diagram</figcaption>
</figure>
</div> -->

<p>Blender is also a free and open source 3D creation suite. We could install it on Ubuntu using the following command.</p>

<div><div><pre><code>$ sudo apt-get update
$ sudo apt-get install blender
</code></pre></div></div>

<h4 id="prime95">Prime95</h4>

<p>Prime95 is used for √¢‚Ç¨≈ìburning√¢‚Ç¨ÔøΩ your CPU. It is also available on Linux.</p>

<div><div><pre><code>$ wget http://www.mersenne.org/ftp_root/gimps/p95v303b6.linux64.tar.gz
$ tar xvf p95v303b6.linux64.tar.gz
$ ./mprime
</code></pre></div></div>

<h4 id="openssl">OpenSSL</h4>

<p>OpenSSL comes with Linux by default. It can also be used for √¢‚Ç¨≈ìburning√¢‚Ç¨ÔøΩ your CPU.</p>

<div><div><pre><code>$ openssl speed -multi 16
</code></pre></div></div>

<h4 id="turbostat">TurboStat</h4>

<p>TurboStat is a tool to monitor Intel CPU usages. We will mainly use it to monitor the CPU clock speed.</p>

<div><div><pre><code>$ sudo apt-get install linux-tools-$(uname -r) linux-cloud-tools-$(uname -r)
$ sudo modprobe msr
$ sudo turbostat
</code></pre></div></div>

<h3 id="rog-ai-overclocking">ROG AI Overclocking</h3>

<p>ROG AI overclocking could be done at BIOS level.</p>

<ol>
  <li>Go into BIOS and set all the BIOS configurations to default, save and reboot.</li>
  <li>Go into OS and run one of the benchmark tools mentioned above, reboot.</li>
  <li>Go into BIOS and turn on AI overclock and XMP, save and reboot.</li>
</ol>

<div>
<figure>
    <img src="https://leimao.github.io/images/blog/2021-03-29-ROG-Linux-AI-Overclocking/bios.png">
    <figcaption>ROG BIOS AI Overclocking</figcaption>
</figure>
</div>

<p>Before ROG AI overclocking, the stabilized CPU clock speed for all 8 cores of my i9-9900K during OpenSSL benchmarking was around 4.1-4.2 GHz. After ROG AI overclocking, it became 4.6-4.7 GHz.</p>



<p>For i9-9900KS, I believe it is possible to overclock all 8 cores to 5.0 GHz.</p>

<h3 id="references">References</h3>

<ul>
  <li><a href="https://www.asus.com/Microsite/motherboard/Intelligent-motherboard/AI-Overclocking.html">ROG AI Overclocking</a></li>
</ul>

      <hr>
      
    </div></div>]]>
            </description>
            <link>https://leimao.github.io/blog/ROG-Linux-AI-Overclocking/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26291486</guid>
            <pubDate>Sun, 28 Feb 2021 07:44:06 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Rust, Zig, and the Futility of ‚ÄúReplacing‚Äù C]]>
            </title>
            <description>
<![CDATA[
Score 24 | Comments 119 (<a href="https://news.ycombinator.com/item?id=26291054">thread link</a>) | @ghoward
<br/>
February 27, 2021 | https://gavinhoward.com/2021/02/rust-zig-and-the-futility-of-replacing-c/ | <a href="https://web.archive.org/web/*/https://gavinhoward.com/2021/02/rust-zig-and-the-futility-of-replacing-c/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><div><p>This post has been discussed on <a href="https://news.ycombinator.com/item?id=26291054#26294846">Hacker News</a>, <a href="https://www.reddit.com/r/rust/comments/luawx6/rust_zig_and_the_futility_of_replacing_c/"><code>/r/rust</code></a>, and
<a href="https://lobste.rs/s/1iiifg"><code>lobste.rs</code></a>.</p><p>I should not have posted this to Hacker News on a Saturday night right before
going to bed, but in my defense, this post blew up in a way I didn‚Äôt expect.</p></div><h2 id="introduction">Introduction</h2><p>There was a recent <a href="https://github.com/pyca/cryptography/issues/5771">dust-up on GitHub</a> surrounding the decision by the
<a href="https://github.com/pyca/cryptography">Cryptography library</a> (which I will call <code>cryptography</code> for convenience) to
switch to <a href="https://www.rust-lang.org/">Rust</a>.</p><p>One of the distro maintainers of my distro of choice, <a href="https://www.gentoo.org/">Gentoo</a>, filed a bug
report with the <code>crytography</code> saying that the switch broke builds on several
platforms that Gentoo still supports. The <code>cryptography</code> authors replied that
those platforms are not really used anymore, and that they were going to stick
with Rust because it has better memory safety than C. They also argued that it
is better to force better programming languages on people because of better
security.</p><p>At first glance, it appears that the better argument is on the side of the
<code>cryptography</code> maintainers, but after thinking about it carefully, I think they
are wrong.</p><h2 id="reasons">Reasons</h2><p>There are a few reasons why I believe the <code>cryptography</code> maintainers are at
fault.</p><h3 id="due-diligence">Due Diligence</h3><p>First, their argument for Rust (and against C) because of memory safety implies
that they have not done due diligence in finding and fixing such bugs.</p><p>I can almost hear the rage of my readers against that paragraph above and
against the fact that I don‚Äôt have a commenting system on my blog. So let me
answer the comments preemptively.</p><p>‚ÄúThey are volunteers, giving their time away for free!‚Äù</p><p>Yes, but they also <em>intend</em> for their code to be used widely. They managed to
succeed in that, so they now have some obligation to their users.</p><p>‚ÄúThey don‚Äôt have any obligation!‚Äù</p><p>If a software project actively goes out and gets users, which just about any
project with a serious number of users has done, then yes, they have an
obligation to those users. The reason is that they sold users on the idea of
using their software. In other words, they were marketing their software, which
means making promises.</p><p>In fact, when people release <em>libraries</em> and try to get users for them, it‚Äôs
<em>because</em> they want them to be used by downstream programmers. A programmer
might write a program to scratch an itch and release it, but that reasoning
applies much less to libraries, in my opinion.</p><p>‚ÄúOkay, but they didn‚Äôt get anything in return, so there‚Äôs still no obligation.‚Äù</p><p>In return, the users gave them <strong>relevance</strong>.</p><p>One of the most vocal (in favor of Rust) developers of <code>cryptography</code> works for
Red Hat Security Engineering (if I read his GitHub profile right). I don‚Äôt know
if his work on <code>cryptography</code> helped him get that job, but it might have.</p><p>Another of the most vocal developers has a computer security company. I would
bet money that his work on <code>cryptography</code> gives his company relevance.</p><p>So they did <em>not</em> get ‚Äúnothing‚Äù from users. Quite the opposite, in fact.</p><p>By the way, this position comes from my own experience pushing my <a href="https://git.yzena.com/gavin/bc"><code>bc</code></a>. I
managed to convince the FreeBSD project to <a href="https://github.com/freebsd/freebsd-src/tree/main/contrib/bc">make it the default</a> in FreeBSD
13.</p><p>Once I did that, I shouldered, willingly, the need to keep FreeBSD happy. And
while I have made mistakes, I have done well so far.</p><p>And with my <code>bc</code>, <strong>I did my due diligence with memory safety</strong>. I fuzzed my
<code>bc</code> and eliminated all of the bugs. I even run the generated fuzzer test cases
through AddressSanitizer, and my entire test suite is run through Valgrind
<em>and</em> AddressSanitizer. I also add failing fuzzer cases to my test suite, which
means I run more and more test cases through both of those frightfully
effective tools.</p><p>For the record, those tools are only effective with effective test suites, which
I spent a lot of time building. But <em>building</em> such a test suite is part of due
diligence itself.</p><p>So it follows that if the developers have <em>not</em> done their due diligence, their
users should <strong>leave</strong>, either by forking the project or creating a new one.
The relevance they gave to the <code>cryptography</code> authors should disappear.</p><h3 id="battle-tested-c-code">Battle-Tested C Code</h3><p>In fact, I have done enough due diligence with my <code>bc</code> that I would consider it
a dereliction of duty to Rewrite It in Rust (RIIR).</p><p>Why would it be a dereliction of duty? Because rewriting it in Rust would cause
<em>more</em> bugs, not less. This is because of several reasons:</p><ol><li>I would need to <em>redesign</em> it to fit the language.</li><li>I would need to <em>reimplement</em> it, and new implementations always have bugs.</li><li>The C code is battle-tested, both by me (using fuzzing and other techniques)
and by users.</li></ol><p>That last point is the most crucial, especially in the case of <code>cryptography</code>.</p><p>If the developers of <code>cryptography</code> claim that they have, in fact, done their
due diligence with regards to memory safety in their C code, then they are
claiming that it‚Äôs battle-tested.</p><p>The saying that ‚Äúa bird in the hand is worth two in the bush,‚Äù and in this case,
<em><strong>if</strong></em> the <code>cryptography</code> developers are claiming that they have done their
due diligence, they are throwing away a bird in the hand for a single one in the
bush.</p><div><p><strong>Edit (28 Feb 2021)</strong>: This part of the post seems to be misunderstood widely,
so I am going to attempt to clarify.</p><p>People are arguing that having safe C code requires a frozen, small codebase
with a thorough test suite. And then they debate my position based on the belief
that the codebase needs to evolve.</p><p>For the record, I agree with them that in order to have safe C code, the
codebase must be small and frozen.</p><p>What I am arguing is that <strong>crypto</strong> code <em>should</em> be small and frozen, with a
thorough test suite. I wrote about that <a href="https://gavinhoward.com/2019/11/finishing-software/">here</a>.</p></div><p>And if that‚Äôs the case, their users should <strong>leave</strong> and take <code>cryptography</code>'s
relevance with them.</p><h3 id="desktops-and-smartphones-are-not-the-only-computers">Desktops and Smartphones Are Not the Only Computers</h3><p>The users of <code>cryptography</code> were claiming in the bug report discussion that Rust
is not portable to many platforms, and the authors said that they don‚Äôt have the
time or resources to target those platforms. Fair enough.</p><p>But then they claim that the <em>users</em> should put in the effort to port Rust to
their platforms. This is wrong.</p><p>The <code>cryptography</code> authors also claim that the platforms that Rust doesn‚Äôt
support do not matter. As we will see below, this is false.</p><p>While I agree that the <code>cryptography</code> authors are not responsible for porting
Rust to other platforms, the users of those platforms are not either.</p><p>That responsibility falls on the Rust developers.</p><p><em>They</em> were the ones who sold Rust to those who have used it, so as above,
<em>they</em> have the responsibility for supporting their users.</p><p>Granted, the Rust developers have made no claim about being portable to every
platform. But they <em>have</em> claimed that it is <a href="https://www.rust-lang.org/what/embedded">appropriate for embedded
software</a>.</p><p>If it were true, this would be great. After all, <a href="https://youtu.be/3HxPzutkNYw?t=257">IoT devices outnumber
desktops and smartphones by at least one order of magnitude</a>.</p><p>But there are a lot of them that LLVM, Rust‚Äôs backend, cannot generate code
for. In fact, there are a lot of them that <em>C++</em> cannot run on.</p><div><p><strong>Edit (28 Feb 2021)</strong>: Also, the Rust developers are the developers with the
most experience reading ISA manuals knowing how to make a compiler generate
code. So they are still the best placed to support those ‚Äúesoteric‚Äù
architectures.</p><p>And if they do not know how to read ISA manuals and generate code, it‚Äôs because
they lean too heavily on LLVM.</p></div><p>Make no mistake; embedded software is still running the majority of devices in
the world. And C is the king of embedded software.</p><p>I don‚Äôt know exact numbers, but I wouldn‚Äôt be surprised if the majority of
programmable devices in the world cannot run Rust.</p><p>Thus, because Rust uses LLVM, it is not portable.</p><p>And in my opinion, Rust is not appropriate for the embedded space.</p><p>So in this case, I would consider that the <code>cryptography</code> developers were
victims of the Rust developers.</p><h3 id="gcc-is-not-the-only-compiler"><code>gcc</code> Is Not the Only Compiler</h3><p>That isn‚Äôt the only problem.</p><p>There is a <a href="https://github.com/Rust-GCC/gccrs">project to make <code>gcc</code> able to compile Rust</a>. That‚Äôs commendable.</p><p>However, many people seem to believe that once it‚Äôs done, Rust will be portable.
That is not the case.</p><p>Why? Simple: <strong><code>gcc</code> is not the only compiler</strong>.</p><p>There is plenty of code out there that uses dead simple C compilers, like
<a href="https://bellard.org/tcc/">tcc</a>, <a href="http://sdcc.sourceforge.net/">sdcc</a>, and others. And often, they have <a href="https://embeddedgurus.com/stack-overflow/2012/06/optimizing-for-the-cpu-compiler/">good reason to do
so</a>.</p><p>Adding a <code>gcc</code> frontend, while it will improve the situation, will not make Rust
as portable as C. Period.</p><h3 id="pushing-for-progress-hinders-it">Pushing for Progress Hinders It</h3><p>The other thing that the <code>cryptography</code> authors claim is that their users who
refuse to adopt Rust are hindering progress.</p><p>That may be true, but it is also true that forcing ‚Äúprogress‚Äù on others hinders
<em>true</em> progress.</p><p>By forcing users to either adopt Rust or pin their dependency on <code>cryptography</code>
to the most recent version without it, they are forcing those users to use
stagnant code.</p><p>Isn‚Äôt that the very opposite of progress?</p><h2 id="cryptography-at-fault"><code>cryptography</code> at Fault</h2><p>Those reasons lay out why I think the <code>cryptography</code> authors should shoulder the
blame for this situation, and I think I can explain where they went wrong.</p><ol><li>They let ideology come before pragmatic engineering.</li><li>They sold <code>cryptography</code> to users.</li><li>They knew that switching to Rust would break existing users and did it
anyway.</li><li>They either did not do their due diligence for memory safety, or they did
and threw that battle-tested code out.</li></ol><h2 id="portability">Portability</h2><p>To be honest, I used to think that it was better to switch to a better language
than C.</p><p>I had several talks with Linux distro maintainers, as well as a talk with my
father-in-law, that convinced me that C‚Äôs portability is still important enough
that it should be used.</p><p>Unless, of course, you <em>explicitly</em> target only certain platforms. But you had
better be prepared to never target others.</p><p>In fact, after talking with the distro maintainers, who have had to build Rust,
I am also convinced that it‚Äôs not just about being portable, it‚Äôs also about how
<em>easy</em> it is to <em>build</em> software.</p><p>Rust‚Äôs bootstrap is <a href="https://doc.rust-lang.org/nightly/rustc/platform-support.html">complicated</a>, and it is one of the worst things about
it.</p><p>If building software in Rust means building Rust for a <a href="https://doc.rust-lang.org/nightly/rustc/platform-support.html">Tier 3</a> platform,
you can bet that <a href="https://drewdevault.com/2021/02/09/Rust-move-fast-and-break-things.html">people will stick with C</a>.</p><h3 id="zig">Zig</h3><p>I want to take a moment to talk about Zig.</p><p>Zig might be one of the most promising up-and-coming languages of recent memory.</p><p>But it will ultimately fail to reach its goal.</p><p>You see, Zig is meant to replace C. But ‚Ä¶</p></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://gavinhoward.com/2021/02/rust-zig-and-the-futility-of-replacing-c/">https://gavinhoward.com/2021/02/rust-zig-and-the-futility-of-replacing-c/</a></em></p>]]>
            </description>
            <link>https://gavinhoward.com/2021/02/rust-zig-and-the-futility-of-replacing-c/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26291054</guid>
            <pubDate>Sun, 28 Feb 2021 06:04:49 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Horizonator: Terrain renderer based on SRTM DEMs]]>
            </title>
            <description>
<![CDATA[
Score 10 | Comments 0 (<a href="https://news.ycombinator.com/item?id=26290718">thread link</a>) | @pabs3
<br/>
February 27, 2021 | http://notes.secretsauce.net/notes/2021/02/27_horizonator-terrain-renderer-based-on-srtm-dems.html | <a href="https://web.archive.org/web/*/http://notes.secretsauce.net/notes/2021/02/27_horizonator-terrain-renderer-based-on-srtm-dems.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
    <p>
Check this out:
</p>


<p><img src="https://github.com/dkogan/horizonator/raw/master/example-interactive.png" alt="example-interactive.png">
</p>

<p>
I just resurrected and cleaned up an old tool I had lying around. It's now nice
and usable by others. This tool loads terrain data, and renders it from the
ground, simulating what a human or a camera would see. This is useful for
armchair exploring or for identifying peaks. This was relatively novel when I
wrote it &gt;10 years ago, but there are a number of similar tools in existence
now. <i>This</i> implementation is still useful in that it's freely licensed and
contains APIs, so fancier processing can be performed on its output.
</p>

<p>
Sources and (barely-complete-enough) documentation live here:
</p>

<p>
<a href="https://github.com/dkogan/horizonator">https://github.com/dkogan/horizonator</a>
</p>

  </div></div>]]>
            </description>
            <link>http://notes.secretsauce.net/notes/2021/02/27_horizonator-terrain-renderer-based-on-srtm-dems.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-26290718</guid>
            <pubDate>Sun, 28 Feb 2021 04:38:17 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[How fighting games use delay-based and rollback netcode (2019)]]>
            </title>
            <description>
<![CDATA[
Score 284 | Comments 103 (<a href="https://news.ycombinator.com/item?id=26289933">thread link</a>) | @Kinrany
<br/>
February 27, 2021 | https://ki.infil.net/w02-netcode.html | <a href="https://web.archive.org/web/*/https://ki.infil.net/w02-netcode.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><section>
				<div>
					<div id="content">

						<!-- Content -->
					
							<article>

								<div>
								
								<div>
								<p><a href="https://ki.infil.net/words.html">
								<img src="https://ki.infil.net/images/words/header.gif"></a>
								
								</p></div>
								
								
								
								
								<hr>
								
								<div>
								
								<div>
								<p>Netcode</p>
								<p>Explaining how fighting games use delay-based and rollback netcode</p>
								<p>October 16, 2019</p>
								
								
								
								
								</div>
								
								</div>
							
								
								<!-- blog navigation -->
								
								
								

								<div>
								<div><p>
								<em>I would like to thank <a href="https://twitter.com/Krazhier">krazhier</a> and <a href="https://twitter.com/TheKeits">Keits</a> for taking hours out of their busy schedules to discuss technical aspects of netcode with me, and <a href="https://twitter.com/Sajam">Sajam</a> for taking time to answer interview questions and being supportive throughout the writing process. I would also like to especially thank <a href="https://twitter.com/MagicMoste">MagicMoste</a> for making all the wonderful videos you see in this article. All their help was offered for free and I am thankful for their friendship.
								</em></p><p><em>

								This article has been <a href="https://arstechnica.com/gaming/2019/10/explaining-how-fighting-games-use-delay-based-and-rollback-netcode/">cross-posted on Ars Technica</a>.
								</em></p><p><em>

								You may also enjoy <a href="https://www.youtube.com/watch?v=1RI5scXYhK0">watching a video feature</a> on the topics in this article.
								</em>							
								</p></div>
								</div>

								
															
								<!-- Infil -->
								<div><p><img src="https://ki.infil.net/images/words/infil_smiling_2.jpg"></p>
								<p>
								Welcome back to Fightin‚Äô Words! It‚Äôs been a while since we last discussed how the <a href="https://ki.infil.net/w01-bugs.html">most famous fighting game bugs</a> have impacted the community‚Äôs favorite games. Today‚Äôs topic is a bit more technical, but it‚Äôs an equally important factor in how our favorite modern games are played -- we‚Äôre going to be doing a <strong>deep dive into netcode</strong>.								
								</p>
								</div>

								<hr><!-- Infil -->
								<div><p><img src="https://ki.infil.net/images/words/infil_lecture.jpg"></p>
								<div><p>
								At its core, netcode is simply a method for two or more computers, each trying to play the same game, to talk to each other over the internet. While local play always ensures that all player inputs arrive and are processed at the same time, <strong>networks are constantly unstable</strong> in ways the game cannot control or predict. Information sent to your opponent may be delayed, arrive out of order, or become lost entirely depending on dozens of factors, including the physical distance to your opponent, if you‚Äôre on a WiFi connection, and whether your roommate is watching Netflix.
								</p><p>
								Online play in games is nothing new, but fighting games have their own set of unique challenges. They tend to involve direct connections to other players, unlike many other popular game genres, and <strong>low, consistent latency</strong> is extremely important because muscle memory and reactions are at the core of virtually every fighting game. As a result, two prominent strategies have emerged for playing fighting games online: <strong>delay-based netcode</strong> and <strong>rollback netcode</strong>. 
								</p></div>
								</div>

								<div><p><img src="https://ki.infil.net/images/words/infil_thoughtful.jpg"></p>
								<div><p>
								There‚Äôs been a renewed passion in the fighting game community that <strong>rollback is the best choice</strong>, and fighting game developers who <a href="https://www.youtube.com/watch?v=qW61xJNJ9m8">choose to use delay-based netcode</a> are <a href="https://www.youtube.com/watch?v=iTUtnclr2hs">preventing the growth of the genre</a>. While people have been passionate about this topic <a href="https://www.youtube.com/watch?v=Tu2kAdmUCaI&amp;t=42m34s">for many years</a>, frustrations continue to rise as new, otherwise excellent games repeatedly have bad online experiences.
								</p><p>

								There are relatively few easy-to-follow explanations for what exactly rollback netcode is, how it works, and why it is so good at hiding the effects of bad connections (though <a href="http://mauve.mizuumi.net/2012/07/05/understanding-fighting-game-networking.html">there are some</a>). Because I feel this topic is extremely important for the future health of the fighting game community, I want to help squash some misconceptions about netcode and explain both netcode strategies thoroughly so everyone can be informed as they discuss. If you stick around to the end, I‚Äôll even <strong>interview some industry experts and community leaders</strong> on the topic!
								</p><p>
								Before we dig into the details, though, let‚Äôs get one thing straight.
										
								</p></div>
								</div>

								<hr><!-- Infil -->
								<!-- header -->
								

								<div><p><img src="https://ki.infil.net/images/words/infil_smiling_3.jpg"></p>
								<div><p>
										Both companies and players should care about good netcode because <strong>playing online is no longer the future -- it's the present</strong>. 
								</p><p>
										While most other video game genres have been this way for a decade or longer, fighting game developers seem to be resistant to embracing online play, perhaps because of the genre‚Äôs roots in offline settings such as arcades and tournaments. Playing offline is great, and it will always have considerable value in fighting games, but it‚Äôs simply a reality that <strong>a large percentage of the player base will never play offline</strong>. For many fighting game fans, playing online <em>is</em> the game, and a bad online experience prevents them from getting better, playing or recommending the game to their friends, and ultimately causes them to <a href="https://youtu.be/iTUtnclr2hs?t=758">simply go do something else</a>.
								</p><p>
										Even if you think you have a good connection, or live in an area of the world with robust internet infrastructure, good netcode is still mandatory. Plus, lost or delayed information happens regularly even on the best networks, and poor netcode can <a href="https://twitter.com/john_takeuchi/status/1162562266027327488">actively hamper matches</a> no matter how smooth the conditions may be. Good netcode also has the benefit of connecting regions across greater distances, effectively uniting the global player base as much as possible.

										<!-- gif 1A -->
										</p><div><!-- image -->
											<figure>
												
											<figcaption>Bad netcode can ruin matches. This match, played online between two Japanese players, impacted who gets to attend the Capcom Pro Tour finals. <a href="https://twitter.com/john_takeuchi/status/1162562266027327488">(source)</a>
											</figcaption></figure></div>
										
								</div>
								</div>

								<div><p><img src="https://ki.infil.net/images/words/infil_content.jpg"></p>
								<div><p>
										What about those who never play online because they much prefer playing offline with their friends? The <strong>healthy ecosystem</strong> that good netcode creates around a game benefits everyone. There will be more active players, more chances to consume content for your favorite game -- from tech videos to spectating online tournaments to expanding the strategy of lesser-used characters -- and more excitement surrounding your game in the FGC. Despite <a href="http://ki.infil.net/">Killer Instinct</a>‚Äôs pedigree as an excellent game, there‚Äôs no doubt that its superb rollback netcode has played a huge part in the sustained growth of its community.
								</p><p>

										Good netcode matters, period. So let‚Äôs talk about it.
										
								</p></div>
								</div>
								
								
								<!-- blog navigation -->
								
								
								

								</div>
								
							</article>
				
					</div>
				</div>
			</section></div>]]>
            </description>
            <link>https://ki.infil.net/w02-netcode.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-26289933</guid>
            <pubDate>Sun, 28 Feb 2021 01:47:03 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[First vaccine to immunize against malaria builds on pandemic-driven RNA tech]]>
            </title>
            <description>
<![CDATA[
Score 62 | Comments 4 (<a href="https://news.ycombinator.com/item?id=26289245">thread link</a>) | @cpncrunch
<br/>
February 27, 2021 | https://academictimes.com/first-vaccine-to-fully-immunize-against-malaria-builds-on-pandemic-driven-rna-tech/ | <a href="https://web.archive.org/web/*/https://academictimes.com/first-vaccine-to-fully-immunize-against-malaria-builds-on-pandemic-driven-rna-tech/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><div id="articleBody"><p>Consistently ranked as one of the leading causes of death around the world, malaria doesn√¢‚Ç¨‚Ñ¢t have an effective vaccine yet. But researchers have invented a promising new blueprint for one √¢‚Ç¨‚Äù with properties akin to the novel RNA-based vaccine for COVID-19.</p><p>Making a vaccine for malaria is challenging because its associated parasite, <a href="https://www.britannica.com/science/Plasmodium-protozoan-genus"><em>Plasmodium</em></a><em>,</em> contains a protein that inhibits production of <a href="https://www.sciencedirect.com/topics/biochemistry-genetics-and-molecular-biology/memory-t-cell">memory T-cells</a>, which protect against previously encountered pathogens. If the body can√¢‚Ç¨‚Ñ¢t generate these cells, a vaccine is ineffective. But scientists recently tried a new approach using an RNA-based platform.√Ç&nbsp;</p><p>Their design circumvented the sneaky protein, allowed the body to produce the needed T-cells and completely immunized against malaria. The patent application for their novel vaccine, which hasn't yet been tested on humans, was <a href="http://appft1.uspto.gov/netacgi/nph-Parser?Sect1=PTO1&amp;Sect2=HITOFF&amp;d=PG01&amp;p=1&amp;u=/netahtml/PTO/srchnum.html&amp;r=1&amp;f=G&amp;l=50&amp;s1=20210030859.PGNR.&amp;OS=DN/20210030859&amp;RS=DN/20210030859">published</a> by the U.S. Patent &amp; Trademark Office on Feb. 4.</p><p>√¢‚Ç¨≈ìIt's probably the highest level of protection that has been seen in a mouse model,√¢‚Ç¨ÔøΩ said Richard Bucala, co-inventor of the new vaccine and a physician and professor at Yale School of Medicine.</p><p>The team√¢‚Ç¨‚Ñ¢s breakthrough could save hundreds of thousands of lives, particularly in developing nations. <a href="https://www.who.int/news-room/fact-sheets/detail/malaria">In 2019 alone</a>, there were an estimated 229 million cases of malaria and 409,000 deaths worldwide. Of those deaths, 94% were in Africa, with children being the most vulnerable.</p><p>√¢‚Ç¨≈ìIt affects societies and populations that have the least amount of resources and expertise to manage these infections well," Bucala told <em>The Academic Times</em>. "We need new vaccines, and we need more tools."</p><p>Novartis Pharmaceuticals and the National Institutes of Health funded the work. GlaxoSmithKline is an assignee on the patent, which if approved, will allow the company to produce the vaccine and make it available to the public.</p><p>At present, the only vaccine to prevent malaria is called <a href="https://www.malariavaccine.org/sites/www.malariavaccine.org/files/content/page/files/PATH_MVI_RTSS_Fact%20sheet_042019.pdf">RTS,S</a>. Approved two years ago, this vaccine is the result of nearly two decades of research, but is only about 30% effective. And after four years, that figure drops to 15%.</p><p>√¢‚Ç¨≈ìIt doesn't work very well,√¢‚Ç¨ÔøΩ Bucala said. √¢‚Ç¨≈ìAnd the research studies all have the conclusion that the people who fail to mount a vaccine response, or who get reinfected, have poor memory T-cell responses.√¢‚Ç¨ÔøΩ</p><p>Along with Andrew Geall, a pharmaceutical researcher who developed the RNA platform that the duo used, Bucala found a way to prevent the unwanted protein in <em>Plasmodium</em>, called <a href="https://pubmed.ncbi.nlm.nih.gov/17158894/">PMIF</a>, from inhibiting T-cell generation.√Ç&nbsp;</p><p>√¢‚Ç¨≈ìOur research studies indicate that it was this particular gene product, PMIF, that was responsible for this,√¢‚Ç¨ÔøΩ Bucala said. √¢‚Ç¨≈ìIt prevented memory T-cells from forming, and that's why one could not generate a memory response to <em>Plasmodium</em>.√¢‚Ç¨ÔøΩ</p><p>In a conventional vaccine, for instance the <a href="https://www.cdc.gov/flu/prevent/keyfacts.htm">standard flu vaccine</a>, an inactivated version of the virus is injected into a host. The body recognizes an intruder, fights against it, generates antibodies against the harmless virus, then returns back to normal.√Ç&nbsp;</p><p>However, once the virus has left the host, the body needs a way to remember how it fought back. Otherwise it will have to relearn the antibody generation √¢‚Ç¨‚Äù but perhaps next time with the actual, harmful virus infecting the host all the while. This is where memory T-cells come in: They remember how to generate the immune response and remind the body when the time comes. <em>Plasmodium√Ç&nbsp;</em>prevents the immune memory system from occurring by producing PMIF.</p><p>√¢‚Ç¨≈ìSuppressing the T-cell response and immune memory is so important to the parasite that the parasite brings its own gene, PMIF, to do that,√¢‚Ç¨ÔøΩ Bucala said. √¢‚Ç¨≈ìIf you eliminate that factor, the body naturally develops memory immunity.√¢‚Ç¨ÔøΩ</p><p>The concept of the novel malaria vaccine accounts for the PMIF problem. Instead of injecting the actual pathogen, the vaccine presents the body with instructions, via RNA, on how to create the protein unique to the pathogen by itself in order to fight it √¢‚Ç¨‚Äù which is precisely how Pfizer√¢‚Ç¨‚Ñ¢s COVID-19 vaccine works.</p><p>However, rather than an <a href="https://www.cdc.gov/coronavirus/2019-ncov/vaccines/different-vaccines/mrna.html">mRNA platform</a>, Bucala and Geall use a self-amplifying <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7474593/">saRNA</a> platform. The key benefit of the latter is that it is effective at much lower doses because it can rapidly produce copies of itself inside the cell.√Ç&nbsp;</p><p>√¢‚Ç¨≈ìFor saRNA, one can potentially make a million doses of vaccine with a couple liters of synthetic production,√¢‚Ç¨ÔøΩ Bucala said. √¢‚Ç¨≈ìIt's much more efficient than the base-protected mRNA vaccines.√¢‚Ç¨ÔøΩ</p><p>The proposed saRNA vaccine tells the body to create the troublesome PMIF protein, generates antibodies against it and naturally produces the necessary memory T-cells, as Bucala had hoped.</p><p>√¢‚Ç¨≈ìWe thought we could combine RTS,S with a PMIF vaccine, but the mouse studies seem to suggest that just immunizing with PMIF is sufficient,√¢‚Ç¨ÔøΩ Bucala highlighted.√Ç&nbsp;√¢‚Ç¨≈ìThat's how striking the results were.√¢‚Ç¨ÔøΩ</p><p>Bucala and Geall have placed their vaccine in the hands of the Oxford University institution that facilitated the <a href="https://www.bbc.com/news/health-55302595">AstraZeneca</a> COVID-19 vaccine. It is one of the only places in the world that is doing phase 1 studies in malaria, meaning researchers infect human volunteers with the disease after immunizing them.</p><p>√¢‚Ç¨≈ìThis is not in humans yet," Bucala noted, √¢‚Ç¨≈ìbut they are the group that can put it into humans, I think, best. We are doing those studies this year."</p><p>Beyond the saRNA technology's use for the malaria vaccine, Bucala believes it is an ideal method for immunization design in the future, including for COVID-19 prevention, because of its dual low cost and high yield. He says it could reach far and wide.√Ç&nbsp;</p><p>√¢‚Ç¨≈ìThe current mRNA approach is an important step in that direction,√¢‚Ç¨ÔøΩ he said. √¢‚Ç¨≈ìBut we are going to, I believe, need to do better. I hope that the saRNA opens that platform.√¢‚Ç¨ÔøΩ</p><p><em>The application for the patent, Uses Of Parasite Macrophage Migration Inhibitory Factors, was filed on Oct. 16, 2020 to the U.S. Patent Trademark Office with the application number 17/073006. The inventors of the pending patent are Richard Bucala, Yale School of Medicine and Andrew Geall, Novartis Pharmaceuticals. The assignees are Yale University and GlaxoSmithKline Biologicals SA.</em></p><p><em>Parola Analytics provided technical research for this story.</em></p></div></div></div>]]>
            </description>
            <link>https://academictimes.com/first-vaccine-to-fully-immunize-against-malaria-builds-on-pandemic-driven-rna-tech/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26289245</guid>
            <pubDate>Sat, 27 Feb 2021 23:44:41 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[In Defense of Myers Briggs (2020)]]>
            </title>
            <description>
<![CDATA[
Score 135 | Comments 315 (<a href="https://news.ycombinator.com/item?id=26288772">thread link</a>) | @souprock
<br/>
February 27, 2021 | https://dynomight.net/in-defense-of-myers-briggs.html | <a href="https://web.archive.org/web/*/https://dynomight.net/in-defense-of-myers-briggs.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
    <div>
        <div>
            <p>
            
            <strong>Jun 12, 2020</strong> &nbsp; (Updated Mar 1, 2021)
            
            </p>

            <p>The Myers-Briggs Personality Indicator (MBTI) gets a lot of scorn:</p>

<blockquote>
  <p>About 2 million people take it annually, at the behest of corporate HR departments, colleges, and even government agencies. The company that produces and markets the test makes around $20 million off it each year.</p>

  <p>The only problem? The test is completely meaningless.</p>

  <p><a href="https://www.vox.com/2014/7/15/5881947/myers-briggs-personality-test-meaningless">Why the Myers-Briggs test is totally meaningless (Vox)</a></p>
</blockquote>

<blockquote>
  <p>I began to read through the evidence, and I found that the MBTI is about as useful as a polygraph for detecting lies. One researcher even called it an ‚Äúact of irresponsible armchair philosophy.‚Äù When it comes to accuracy, if you put a horoscope on one end and a heart monitor on the other, the MBTI falls about halfway in between.</p>

  <p><a href="https://www.psychologytoday.com/us/blog/give-and-take/201309/goodbye-mbti-the-fad-won-t-die">Goodbye to MBTI, the Fad That Won‚Äôt Die (Psychology Today)</a></p>
</blockquote>

<blockquote>
  <p>Some psychologists believe that independent, peer-reviewed research in the decades since the MBTI was devised has provided something better than Myers-Briggs. They champion the notion of the ‚ÄúBig Five‚Äù personality traits ‚Äî openness, conscientiousness, extroversion, agreeableness and neuroticism.</p>

  <p><a href="https://www.ft.com/content/8790ef0a-d040-11e5-831d-09f7778e7377">Is Myers-Briggs up to the job? (Financial Times)</a></p>
</blockquote>

<blockquote>
  <p>the MBTI gives a ridiculously limited and simplified view of human personality, which is a very complex and tricky concept to pin down and study. The scientific study of personality is indeed a valid discipline, and there are many personality tests that seemingly hold up to scientific scrutiny (thus far). It just appears that MBTI isn‚Äôt one of them.</p>

  <p><a href="https://www.theguardian.com/science/brain-flapping/2013/mar/19/myers-briggs-test-unscientific">Nothing personal: The questionable Myers-Briggs test (The Guardian)</a></p>
</blockquote>

<p>It would seem that the the MBTI is nonsense, but the Big Five is a <em>real, scientifically valid</em> test. To be sure, there‚Äôs nothing wrong with the Big Five. But these haughty claims that it‚Äôs dramatically better than the MBTI have got to end.</p>

<h2 id="claims-against-the-mbti">Claims Against the MBTI</h2>

<p><strong>MYERS AND BRIGGS JUST, LIKE, MADE IT UP</strong></p>

<p>It‚Äôs true. Myers and Briggs were enthusiasts of Carl Jung‚Äôs theories who created the test during WWII. They hoped to aid the entry of women into the workforce. They weren‚Äôt professional scientists and didn‚Äôt base it on some large corpus of data. And Jung‚Äôs theories are‚Ä¶ controversial today.</p>

<p><strong>THERE AREN‚ÄôT 16 DISCRETE TYPES OF PEOPLE</strong></p>

<p>Also true!  There is no switch in your brain set to T or F. We will probably never find the ‚Äújudging‚Äù gene. These traits <em>are</em> probably heritable ‚Äî <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4739500/">everything is</a> ‚Äî but polygenic. So we should expect varying strengths even if we disregard ‚Äúnurture‚Äù influences.</p>

<p>This complaint is understandable. Some early MBTI proponents really did defend binary outcomes, claiming each attribute was ‚Äútheoretically dichotomous‚Äù. There was even some now-debunked research that claimed to prove that empirically. It‚Äôs now clear that the population has a standard bell-shaped distribution for each trait. For example, this is a histogram of the E-I axis (other axes look similar):</p>

<p><img src="https://dynomight.net/img/mbti/hist-ei.png" alt="histogram of extroversion / introversion scores" loading="lazy">
</p>

<p>This is from <a href="https://doi.org/10.1207/s15327752jpa7801_11">Bimodal Score Distributions and the Myers‚ÄìBriggs Type Indicator: Fact or Artifact?</a> (Answer: Artifact)</p>

<p><strong>THE MBTI HAS POOR REPEATABILITY</strong></p>

<p>Technically true. Suppose someone takes the test, then repeats it 4-5 weeks later. Something like 35-50% of people will fall into a different one of the 16 groups. Is that bad? We‚Äôll come back to this.</p>

<p><strong>THE MBTI DOESN‚ÄôT VARY BETWEEN PEOPLE</strong></p>

<p>Not true. This is claimed <a href="https://www.vox.com/2014/7/15/5881947/myers-briggs-personality-test-meaningless">strangely often</a> with no evidence. Remember that histogram above for introversion vs. extroversion? There‚Äôs plenty of variability. All the other axes are similar. Since no one really provides any evidence for this claim, there‚Äôs not much to rebut here.</p>

<p>If we‚Äôre being <em>very</em> generous, perhaps we could interpret this as a complaint that the population mean for each trait is around zero. That‚Äôs true, but again, it varies <em>plenty</em>.</p>

<p><strong>THE MBTI MAKES EVERYONE SEEM LIKE A BEAUTIFUL SPECIAL SNOWFLAKE</strong></p>

<p>I think this is true. It‚Äôs hard to read the Big Five and conclude that neuroticism is a positive thing. But every MBTI type seems wonderful in its own way.</p>

<p><strong>THE MBTI MEASURES THINGS THAT AREN‚ÄôT FUNDAMENTAL or THE MBTI ISN‚ÄôT USED BY REAL SCIENTISTS or MY IN-GROUP SAYS I MUST TREAT IT WITH CONTEMPT</strong></p>

<p>Well, maybe.</p>

<p>The Myers-Briggs foundation <a href="https://mbtitraininginstitute.myersbriggs.org/what-you-will-learn/the-mbti-assessment/">grasps at an image of scientific seriousness</a> in a way that‚Äôs a little ridiculous. It grates on me, and I‚Äôm not a psychologist. People should probably stop spending money on the official test. People should <em>definitely</em> stop paying <a href="https://mbtitraininginstitute.myersbriggs.org/mbti-training/schedule/">$2,500</a> to get certified to administer that test.</p>

<h2 id="in-defense-of-the-mbti">In defense of the MBTI</h2>

<p><strong>YOU DON‚ÄôT HAVE TO BINARIZE THE AXES</strong></p>

<p>90% of the complaints about MBTI come down to: <em>you can‚Äôt split people into two groups along these axes</em>! Yeah, OK, then how about we don‚Äôt do that?</p>

<p>Of course someone can be borderline. <em>Most</em> people are borderline along at least one axis.  Early versions of the MBTI actually gave an ‚Äúx‚Äù for someone near the middle. Let‚Äôs bring this back! In fact, let‚Äôs go further.</p>

<p>Behold: <strong>Dynomight‚Ñ¢ MBTI notation</strong>:</p>
<ul>
  <li>Strong preference: Capital letter</li>
  <li>Weak preference: Lower-case letter</li>
  <li>Borderline: x</li>
</ul>

<p>For example: eNxJ is:</p>
<ul>
  <li>weakly extroverted (e)</li>
  <li>strongly intuitive (N)</li>
  <li>borderline thinking / feeling (x)</li>
  <li>strongly judging (J)</li>
</ul>

<p>This gives five bins for each axis. You can still sort of say it out loud by making the strong preferences louder. This gives 5‚Å¥=625 possible results. Of course, there aren‚Äôt 625 discrete types of people either. Our goal isn‚Äôt to split people into groups, it‚Äôs to give a convenient summary of how they answered a bunch of questions.</p>

<p>To underline this point, I even created a <a href="https://dynomight.net/mbti">Myers-Briggs quiz you can take in 2 minutes</a> that gives results in this form.</p>

<p>To claim it‚Äôs never useful to discretize denies human nature. You might as well claim we shouldn‚Äôt say ‚Äúhot‚Äù or ‚Äúcold‚Äù but must always give a number of degrees.</p>

<p><strong>IF YOU DON‚ÄôT LIKE BINARIZATION THEN DON‚ÄôT</strong></p>

<p>If you‚Äôd like a test that gives the scores as continuous attributes, may I recommend‚Ä¶ any test? For example, here‚Äôs the results of me randomly clicking answers on two popular websites:</p>

<p><img src="https://dynomight.net/img/mbti/test3-psychcentral.png" alt="third test" loading="lazy">
</p>

<p><img src="https://dynomight.net/img/mbti/test2-16personalities.png" alt="second test" loading="lazy">
</p>

<p>Not convinced? You can even check the ‚Äúofficial‚Äù results that gullible people pay money for. They look like this:</p>

<p><img src="https://dynomight.net/img/mbti/test1-official.png" alt="first test" loading="lazy">
</p>


<p><strong>THE MBTI MIGHT AS WELL BE CALLED THE ‚ÄúBIG FOUR‚Äù</strong></p>

<p>And what happens if you don‚Äôt discretize the axes? If you take continuous measurements (like <em>every Myers-Briggs test ever</em> gives you) they correlate strongly with four of the five big five measurements.</p>

<p><img src="https://dynomight.net/img/mbti/correlations.jpg" alt="correlations between MBTI and big five" loading="lazy">
</p>


<p>The rows show the four MBTI axes, while the columns show the Big Five axes. This shows that:</p>

<ul>
  <li>The MBTI E-I axis is strongly correlated with the Big Five extraversion axis. (duh)</li>
  <li>The MBTI S-N axis is strongly correlated with the Big Five openness axis.</li>
  <li>The MBTI T-F axis is moderately correlated with the Big Five agreeableness axis and weakly correlated with the conscientiousness axis.</li>
  <li>The MBTI J-P axis is moderately correlated with the conscientiousness axis and weakly correlated with the openness axis.</li>
</ul>

<p>To interpret these numbers, note that 74/69 is what you get when the axis is <em>exactly the same thing with exactly the same name</em>. These correlations are strong.</p>

<p>But don‚Äôt blame all the journalists for not knowing about this. After all this groundbreaking research is hot off the presses having only been published in <a href="https://doi.org/10.1111/j.1467-6494.1989.tb00759.x">1989</a>. Other research supports the <a href="https://doi.org/10.1016/0191-8869(96)00033-5">same basic conclusion</a>.</p>

<p>What does this mean? If you believe the MBTI is meaningless, fine. But you must also therefore believe the Big Five is meaningless!</p>

<p><strong>THE MBTI‚ÄôS REPEATABILITY IS FINE</strong></p>

<p>If someone is near the middle, a small change can land them on the other side. This is why 35-50% of people fall into a different one of the 16 buckets when they re-test. The most common score for all axes is near the middle. There are 4 different axes. If some small measurement noise puts you over the middle on <em>any</em> axis, then you fall into a different bucket.</p>

<p>Since <em>we</em> aren‚Äôt binarizing the axes, this is not something to worry about. Instead, we should just ask: How repeatable are the continuous measurements? For reference, here‚Äôs <a href="https://en.wikipedia.org/wiki/Cronbach%27s_alpha">Cronbach‚Äôs alpha</a> for the Big Five, measured for an <a href="https://doi.org/10.1016/j.eurpsy.2016.01.500">Arabic version</a>. Higher numbers indicate better repeatability.</p>

<table>
  <thead>
    <tr>
      <th>Trait</th>
      <th>Men</th>
      <th>Women</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Neuroticism</td>
      <td>.83</td>
      <td>.74</td>
    </tr>
    <tr>
      <td>Extroversion</td>
      <td>.82</td>
      <td>.83</td>
    </tr>
    <tr>
      <td>Openness</td>
      <td>.79</td>
      <td>.85</td>
    </tr>
    <tr>
      <td>Agreeableness</td>
      <td>.82</td>
      <td>.81</td>
    </tr>
    <tr>
      <td>Conscientiousness</td>
      <td>.90</td>
      <td>.92</td>
    </tr>
  </tbody>
</table>

<p>And here‚Äôs the <a href="https://doi.org/10.1177/0013164402062004004">results</a> for Myers Briggs:</p>

<table>
  <thead>
    <tr>
      <th>Trait</th>
      <th>Men</th>
      <th>Women</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>EI</td>
      <td>.82</td>
      <td>.83</td>
    </tr>
    <tr>
      <td>SN</td>
      <td>.83</td>
      <td>.85</td>
    </tr>
    <tr>
      <td>TF</td>
      <td>.82</td>
      <td>.80</td>
    </tr>
    <tr>
      <td>JP</td>
      <td>.87</td>
      <td>.86</td>
    </tr>
  </tbody>
</table>

<p><strong>YOU CAN ADD AN AXIS IF YOU WANT</strong></p>

<p>The Big Five measures neuroticism, while the MBTI does not. This is, no doubt, a very important trait. Some MBTI variants add extra axes. For example, one can introduce an axis that measures <em>turbulence</em> vs. <em>assertiveness</em>. This is a measure of neuroticism in all but name.</p>

<h2 id="why-go-with-the-mbti">Why go with the MBTI?</h2>

<p>Everything above just says the MBTI isn‚Äôt much worse than the Big Five. So why not just use the Big Five? Well, you just try it.</p>

<p><strong>THE MBTI IS COMFORTABLE TO TALK ABOUT</strong></p>

<p>Say you‚Äôre on a first date. You discuss your favorite Italian films, the pets you had growing up. Then, you ask <em>How agreeable are you?</em> How does that go?</p>

<p>If that seems cherry-picked, let‚Äôs go through all the attributes:</p>

<ul>
  <li><em>How extroverted are you?</em> This is fine.</li>
  <li><em>How neurotic are you?</em> Uncomfortable.</li>
  <li><em>How agreeable are you?</em> Uncomfortable.</li>
  <li><em>How conscientious are you?</em> Somewhat uncomfortable.</li>
  <li><em>How open are you to experience?</em> This <em>seems</em> fine, but isn‚Äôt.</li>
</ul>

<p>Only one of the five is OK. And ‚Äî as you surely noticed‚Äî that same attribute exists in the MBTI.</p>

<p>Can I tell you a secret? The MBTI‚Äôs names for the S-I axes are <em>sensing</em> and <em>intuition</em>. These don‚Äôt make any sense. The Big Five <em>openness to experience</em> is much more descriptive. And yet, I claim, the MBTI names are often better <em>because</em> they are meaningless. Everyone claims to be open! But since no one has any idea what ‚Äúsensing‚Äù is, they‚Äôll happily admit to it. Deliberate or accidental, this subterfuge is extremely useful.</p>

<p>For similar reasons, the MBTI‚Äôs omission of neuroticism is sometimes good. The alternative to four axes is often zero, not five.</p>

<p>The advantage of the the MBTI is precisely that it <em>makes ‚Ä¶</em></p></div></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://dynomight.net/in-defense-of-myers-briggs.html">https://dynomight.net/in-defense-of-myers-briggs.html</a></em></p>]]>
            </description>
            <link>https://dynomight.net/in-defense-of-myers-briggs.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-26288772</guid>
            <pubDate>Sat, 27 Feb 2021 22:31:29 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Translating My Z3 Tutorial to Coq]]>
            </title>
            <description>
<![CDATA[
Score 104 | Comments 18 (<a href="https://news.ycombinator.com/item?id=26288749">thread link</a>) | @philzook
<br/>
February 27, 2021 | https://www.philipzucker.com/translating-z3-to-coq/ | <a href="https://web.archive.org/web/*/https://www.philipzucker.com/translating-z3-to-coq/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div aria-label="Content">
      <div>
        <article itemscope="" itemtype="http://schema.org/BlogPosting">

  

  <div itemprop="articleBody">
    









<p>I had a fun time giving a Z3 tutorial at Formal Methods for the Informal Engineer (FMIE) <a href="https://fmie2021.github.io/">https://fmie2021.github.io/</a> (videos coming soon hopefully!). I got to be kind of the "fun dad" with the Z3 tutorial <a href="https://github.com/philzook58/z3_tutorial">https://github.com/philzook58/z3_tutorial</a> , while at times it felt a bit like Cody's Coq tutorial <a href="https://github.com/codyroux/broad-coq-tutorial">https://github.com/codyroux/broad-coq-tutorial</a> was trying to feed the kids their vegetables. It was a fantastic tutorial (maybe the best I've seen?), but it was tough love. He knew it was going to be like this from the outset and had a fun little analogy of me downhill skiing while he was about to go on an uphill mountaineering slog.</p>
<p>There are a number of factors to lead to this:</p>
<ul>
  <li>I could use Z3‚Äôs python bindings giving an air of familiarity, whereas everything was incredibly foreign in Coq.</li>
  <li>Z3 can actually be used to declaratively state problems and pushbutton calculate solutions to them with very little user help, which gives it a lot more "Wow" factor.</li>
  <li>Coq is a tool that requires significantly more background to even comprehend what the hell it is. I still think many aspects of it are totally bizarre. But Coq users, this is just the water they swim in. For example, defining an inductive predicate as a datatype is still a bizarre notion to me, but it is Coq 101. I say this to Coq users and they look at me like I‚Äôm nuts. ‚ÄúWhat could even be the problem?‚Äù</li>
</ul>
<p>Anyway, a fun exercise for me was to take the examples from my tutorial and try to translate them into Coq. For the most part I think it isn't that hard and rather educational.</p>
<p>It's interesting the things that show up. Because the Z3 tutorial was designed for automation, the more automated tactics in MicroOmega and Ring are super useful. </p>
<p><a href="https://coq.inria.fr/refman/addendum/micromega.html">https://coq.inria.fr/refman/addendum/micromega.html</a></p>
<p>
The thing is that the sort of proofs that show up here are fine and all, but they aren't going to teach you to fish for yourself. When you step out of this super automatable fragment you're sunk if you don't know other techniques, like the ones Cody was teaching. There may be a better balance of fun and education to be found.</p>
<p>I think there is a hole in the educational content out there on Coq. Software Foundations focuses on the rudiments, CPDT and FRAP kind of takes it a little hardcore, and the Mathematical Components stuff makes you buy in on ssreflect style and some hardcore math topics, both of which are nuts I have not cracked. Also, all of them are really long and initimidating. Seems like there should be something a little more breezy, a little more automatic. It is demoralizing as a beginner to either not know how to prove obvious trivial facts, or even to struggle to do so at great length.</p>
<p>This was also a nice opportunity to take Alectryon by Cl√©ment Pit-Claudel out for a spin <a href="https://github.com/cpitclaudel/alectryon">https://github.com/cpitclaudel/alectryon</a> Alectryon allows you to see the proof state on hover over in your browser. It's a super important part of the Coq. It was pretty easy to put in my blog. Just copy and paste the gnarly html output into a Jekyll post and make sure to link in the CSS files in an assets folder, because they are where the magic happens.</p>
<p>The gist for this post is here <a href="https://gist.github.com/philzook58/acd204b4895c41f9e85618f0f6b30a58">https://gist.github.com/philzook58/acd204b4895c41f9e85618f0f6b30a58</a></p>
<div id="intro-stuff">

<p>The very first problem in the tutorial was</p>
<pre><!-- Generator: Alectryon --><span><span><span>(** python</span>
<span>x = Int('x')</span>
<span>y = Int('y')</span>
<span>solve(x &gt; 2, y &lt; 10, x + 2*y == 7)</span>
<span>*)</span></span></span></pre><p>which Z3 returns the solution [y = 0, x = 7].</p>
<p>It isn't so obvious how to get coq to find this solution in a low effort way. However, it is easy to get Coq to confirm the validity of this solution given that you know about the [lia] tactic. Otherwise it may be kind of annoying. In general, it may be a good approach to use external tools to produce solutions and just manually place the solutions into Coq. Validating a solution is often easier than producing it.</p>
<pre><!-- Generator: Alectryon --><span><span><span><span>Require Import</span> Lia.</span></span><span>
</span></span><span><label for="z3-tut-v-chk0"><span><span>Goal</span> <span>exists</span> <span>x</span> <span>y</span>, x &gt; <span>2</span> /\ y &lt; <span>10</span> /\ x + <span>2</span> * y = <span>7</span>.</span></label><small><div><div><blockquote><span><hr></span><p><span><span>exists</span> <span>x</span> <span>y</span> : nat, x &gt; <span>2</span> /\ y &lt; <span>10</span> /\ x + <span>2</span> * y = <span>7</span></span></p></blockquote></div></div></small><span>
</span></span><span>     </span><span><label for="z3-tut-v-chk1"><span><span>exists</span> <span>7</span>, <span>0</span>.</span></label><small><div><div><blockquote><span><hr></span><p><span><span>7</span> &gt; <span>2</span> /\ <span>0</span> &lt; <span>10</span> /\ <span>7</span> + <span>2</span> * <span>0</span> = <span>7</span></span></p></blockquote></div></div></small><span> </span></span><span><span><span><span>lia</span>.</span></span><span> </span></span><span><span><span><span>Qed</span>.</span></span></span></pre><p>A different automated version. Giving the appropriate hint database can matter a lot.
<a href="https://coq.inria.fr/refman/proofs/automatic-tactics/auto.html#hint-databases-defined-in-the-coq-standard-library">https://coq.inria.fr/refman/proofs/automatic-tactics/auto.html#hint-databases-defined-in-the-coq-standard-library</a></p>
<pre><!-- Generator: Alectryon --><span><label for="z3-tut-v-chk2"><span><span>Goal</span> <span>exists</span> <span>x</span> <span>y</span>, x &gt; <span>2</span> /\ y &lt; <span>10</span> /\ x + <span>2</span> * y = <span>7</span>.</span></label><small><div><div><blockquote><span><hr></span><p><span><span>exists</span> <span>x</span> <span>y</span> : nat, x &gt; <span>2</span> /\ y &lt; <span>10</span> /\ x + <span>2</span> * y = <span>7</span></span></p></blockquote></div></div></small><span>
</span></span><span>     </span><span><label for="z3-tut-v-chk3"><span><span>exists</span> <span>7</span>, <span>0</span>.</span></label><small><div><div><blockquote><span><hr></span><p><span><span>7</span> &gt; <span>2</span> /\ <span>0</span> &lt; <span>10</span> /\ <span>7</span> + <span>2</span> * <span>0</span> = <span>7</span></span></p></blockquote></div></div></small><span> </span></span><span><span><span><span>eauto with</span> arith.</span></span><span> </span></span><span><span><span><span>Qed</span>.</span></span></span></pre><p>It turns out, surprisingly to me, that stock eauto is sufficient to actually solve the problem without supplying the solutions. They are discovered via unification and a prolog like search. This found the different solution x = 3, y = 2</p>
<pre><!-- Generator: Alectryon --><span><label for="z3-tut-v-chk4"><span><span>Definition</span> <span>solution</span> : <span>exists</span> <span>x</span> <span>y</span>, x &gt; <span>2</span> /\ y &lt; <span>10</span> /\ x + <span>2</span> * y = <span>7</span>.</span></label><small><div><div><blockquote><span><hr></span><p><span><span>exists</span> <span>x</span> <span>y</span> : nat, x &gt; <span>2</span> /\ y &lt; <span>10</span> /\ x + <span>2</span> * y = <span>7</span></span></p></blockquote></div></div></small><span>
</span></span><span>   </span><span><span><span><span>do</span> <span>2</span> <span>eexists</span>.</span></span><span> </span></span><span><span><span><span>eauto with</span> arith.</span></span><span> </span></span><span><label for="z3-tut-v-chk5"><span><span>Show Proof</span>.</span></label><small><div><div><blockquote><span>(ex_intro
   (<span>fun</span> <span>x</span> : nat =&gt;
    <span>exists</span> <span>y</span> : nat, x &gt; <span>2</span> /\ y &lt; <span>10</span> /\ x + <span>2</span> * y = <span>7</span>)
   <span>3</span>
   (ex_intro
      (<span>fun</span> <span>y</span> : nat =&gt; <span>3</span> &gt; <span>2</span> /\ y &lt; <span>10</span> /\ <span>3</span> + <span>2</span> * y = <span>7</span>)
      <span>2</span>
      (conj (Gt.gt_Sn_n <span>2</span>)
         (conj
            (Lt.lt_n_S <span>1</span> <span>9</span>
               (Lt.lt_n_S <span>0</span> <span>8</span>
                  (PeanoNat.Nat.lt_0_succ <span>7</span>))) eq_refl))))</span></blockquote></div></div></small><span> </span></span><span><span><span><span>Defined</span>.</span></span><span>
</span></span><span><span>

<span>(* A fairly manual version for comparison. Could be even worse. *)</span>
</span></span><span><label for="z3-tut-v-chk6"><span><span>Goal</span> <span>exists</span> <span>x</span> <span>y</span>, x &gt; <span>2</span> /\ y &lt; <span>10</span> /\ x + <span>2</span> * y = <span>7</span>.</span></label><small><div><div><blockquote><span><hr></span><p><span><span>exists</span> <span>x</span> <span>y</span> : nat, x &gt; <span>2</span> /\ y &lt; <span>10</span> /\ x + <span>2</span> * y = <span>7</span></span></p></blockquote></div></div></small><span>
</span></span><span>   </span><span><label for="z3-tut-v-chk7"><span><span>exists</span> <span>7</span>, <span>0</span>.</span></label><small><div><div><blockquote><span><hr></span><p><span><span>7</span> &gt; <span>2</span> /\ <span>0</span> &lt; <span>10</span> /\ <span>7</span> + <span>2</span> * <span>0</span> = <span>7</span></span></p></blockquote></div></div></small><span> </span></span><span><label for="z3-tut-v-chk8"><span><span>split</span>.</span></label><small></small><span> 
</span></span><span>     </span><span><label for="z3-tut-v-chka"><span>-</span></label><small></small><span> </span></span><span><label for="z3-tut-v-chkb"><span><span>unfold</span> <span>"&gt;"</span>.</span></label><small></small><span> </span></span><span><label for="z3-tut-v-chkc"><span><span>Locate</span> <span>"&lt;"</span>.</span></label><small><div><div><blockquote><span><span>Notation</span>
<span>"x &lt;= y &lt; z"</span> := <span>and</span> (le x y) (lt y z) : nat_scope
(default interpretation)
<span>"x &lt; y &lt;= z"</span> := <span>and</span> (lt x y) (le y z) : nat_scope
(default interpretation)
<span>"x &lt; y &lt; z"</span> := <span>and</span> (lt x y) (lt y z) : nat_scope
(default interpretation)
<span>"x &lt; y"</span> := lt x y : nat_scope (default interpretation)</span></blockquote></div></div></small><span> </span></span><span><label for="z3-tut-v-chkd"><span><span>unfold</span> <span>"&lt;"</span>.</span></label><small></small><span> </span></span><span><label for="z3-tut-v-chke"><span><span>Print</span> le.</span></label><small><div><div><blockquote><span><span>Inductive</span> <span>le</span> (<span>n</span> : nat) : nat -&gt; <span>Prop</span> :=
    le_n : n &lt;= n
  | le_S : <span>forall</span> <span>m</span> : nat, n &lt;= m -&gt; n &lt;= S m

<span>Arguments</span> le (_ _)%nat_scope
<span>Arguments</span> le_n _%nat_scope
<span>Arguments</span> le_S (_ _)%nat_scope</span></blockquote></div></div></small><span> </span></span><span><label for="z3-tut-v-chkf"><span><span>do</span> <span>4</span> <span>apply</span> 
              le_S.</span></label><small></small><span> </span></span><span><span><span><span>apply</span> le_n.</span></span><span>
</span></span><span>     </span><span><label for="z3-tut-v-chk10"><span>-</span></label><small></small><span> </span></span><span><label for="z3-tut-v-chk11"><span><span>split</span>.</span></label><small></small><span>
</span></span><span>       </span><span><label for="z3-tut-v-chk13"><span>+</span></label><small></small><span> </span></span><span><label for="z3-tut-v-chk14"><span><span>do</span> <span>9</span> <span>apply</span> le_S.</span></label><small></small><span> </span></span><span><span><span><span>apply</span> le_n.</span></span><span>
</span></span><span>       </span><span><label for="z3-tut-v-chk15"><span>+</span></label><small></small><span> </span></span><span><label for="z3-tut-v-chk16"><span><span>simpl</span>.</span></label><small></small><span> </span></span><span><span><span><span>reflexivity</span>.</span></span><span>
</span></span><span><span><span><span>Qed</span>.</span></span><span> </span></span></pre><p>The next thing is the simplest possible tautology</p>
<pre><!-- Generator: Alectryon --><span><span><span>(**python</span>
<span>p = Bool("p")</span>
<span>my_true_thm = Implies(p, p)</span>
<span>prove(my_true_thm)</span>
<span>*)</span></span></span></pre><p>This is not a challenge in Coq.</p>
<pre><!-- Generator: Alectryon --><span><label for="z3-tut-v-chk17"><span><span>Goal</span> <span>forall</span> <span>P</span>, P -&gt; P.</span></label><small></small><span> </span></span><span><label for="z3-tut-v-chk18"><span><span>intros</span>.</span></label><small></small><span> </span></span><span><span><span><span>assumption</span>.</span></span><span> </span></span><span><span><span><span>Qed</span>.</span></span><span>
</span></span><span><span>
<span>(* Even shorter proof *)</span>
</span></span><span><label for="z3-tut-v-chk19"><span><span>Goal</span> <span>forall</span> <span>P</span>, P -&gt; P.</span></label><small></small><span> </span></span><span><span><span><span>auto</span>.</span></span><span> </span></span><span><span><span><span>Qed</span>.</span></span></span></pre><p>A valid counterexample found by Z3. Here we prove the counterexample.</p>
<pre><!-- Generator: Alectryon --><span><span><span>(**python</span>
<span>q = Bool("q")</span>
<span>my_false_thm = Implies(q, p)</span>
<span>prove(my_false_thm)</span>

<span># counterexample</span>
<span># [p = False, q = True]</span>

<span>*)</span>

</span></span><span><label for="z3-tut-v-chk1a"><span><span>Goal</span> not (<span>True</span> -&gt; <span>False</span>).</span></label><small></small><span> </span></span><span><label for="z3-tut-v-chk1b"><span><span>unfold</span> not.</span></label><small></small><span> </span></span><span><label for="z3-tut-v-chk1c"><span><span>intros</span>.</span></label><small></small><span> </span></span><span><label for="z3-tut-v-chk1d"><span><span>apply</span> H.</span></label><small></small><span> </span></span><span><span><span><span>exact</span> I.</span></span><span> </span></span><span><span><span><span>Qed</span>.</span></span></span></pre><p>The first exercise: 
Get a root of the polynomial x**3 + 3*x**2 + 4*x + 2 == 0 using z3. Can you use z3 to show this is the only solution?</p>
<p>Here we open up the reals.
It is easy enough to confirm that the solution of x=-1 is a zero using the [ring] tactic.</p>
<pre><!-- Generator: Alectryon --><span><span><span><span>Require Import</span> Reals.</span></span><span>
</span></span><span><span><span><span>Open Scope</span> R_scope.</span></span><span>
</span></span><span><label for="z3-tut-v-chk1e"><span><span>Print Scope</span> R_scope.</span></label><small><div><div><blockquote><span>Scope R_scope
Delimiting key <span>is</span> R
Bound to class R
<span>"r ¬≤"</span> := Rsqr r
<span>"x ^ y"</span> := pow x y
<span>"x &gt;= y"</span> := Rge x y
<span>"x &gt; y"</span> := Rgt x y
<span>"x &lt;= y &lt;= z"</span> := <span>and</span> (Rle x y) (Rle y z)
<span>"x &lt;= y &lt; z"</span> := <span>and</span> (Rle x y) (Rlt y z)
<span>"x &lt;= y"</span> := Rle x y
<span>"x &lt; y &lt;= z"</span> := <span>and</span> (Rlt x y) (Rle y z)
<span>"x &lt; y &lt; z"</span> := <span>and</span> (Rlt x y) (Rlt y z)
<span>"x &lt; y"</span> := Rlt x y
<span>"x / y"</span> := Rdiv x y
<span>"x - y"</span> := Rminus x y
<span>"x + y"</span> := Rplus x y
<span>"x * y"</span> := Rmult x y
<span>"/ x"</span> := RinvImpl.Rinv x
<span>"- x"</span> := Ropp x
</span></blockquote></div></div></small><span>
</span></span><span><span>
</span></span><span><label for="z3-tut-v-chk1f"><span><span>Goal</span> <span>exists</span> <span>x</span> : R, x^<span>3</span> + <span>3</span> * x^<span>2</span> + <span>4</span> * x + <span>2</span> = <span>0</span>.</span></label><small><div><div><blockquote><span><hr></span><p><span><span>exists</span> <span>x</span> : R, x ^ <span>3</span> + <span>3</span> * x ^ <span>2</span> + <span>4</span> * x + <span>2</span> = <span>0</span></span></p></blockquote></div></div></small><span>
</span></span><span>  </span><span><label for="z3-tut-v-chk20"><span><span>exists</span> (- <span>1</span>).</span></label><small><div><div><blockquote><span><hr></span><p><span>(-<span>1</span>) ^ <span>3</span> + <span>3</span> * (-<span>1</span>) ^ <span>2</span> + <span>4</span> * -<span>1</span> + <span>2</span> = <span>0</span></span></p></blockquote></div></div></small><span> </span></span><span><span><span><span>ring</span>.</span></span><span> </span></span><span><span><span><span>Qed</span>.</span></span></span></pre><p>Proving there is no other solution is a bit trickier. A important lemma about a polynomial factor of x^3 + 3 * x^2 + 4 * x + 2</p>
<pre><!-- Generator: Alectryon --><span><span><span><span>Require Import</span> Lra.</span></span><span>
</span></span><span><label for="z3-tut-v-chk21"><span><span>Lemma</span> <span>pos_poly</span> : <span>forall</span> <span>x</span>, x ^ <span>2</span> + <span>2</span> * x + <span>2</span> &gt; <span>0</span>.</span></label><small><div><div><blockquote><span><hr></span><p><span><span>forall</span> <span>x</span> : R, x ^ <span>2</span> + <span>2</span> * x + <span>2</span> &gt; <span>0</span></span></p></blockquote></div></div></small><span> </span></span><span><label for="z3-tut-v-chk22"><span><span>intros</span>.</span></label><small></small><span>
</span></span><span>   </span><span><span><span><span>nra</span>.</span></span><span> </span></span><span><span><span><span>Qed</span>.</span></span><span>
</span></span><span><span>
<span>(* A slightly more manual proof involving completing the square.*)</span>
</span></span><span><label for="z3-tut-v-chk23"><span><span>Goal</span> <span>forall</span> <span>x</span>, x ^ <span>2</span> + <span>2</span> * x + <span>2</span> &gt; <span>0</span>.</span></label><small><div><div><blockquote><span><hr></span><p><span><span>forall</span> <span>x</span> : R, x ^ <span>2</span> + <span>2</span> * x + <span>2</span> &gt; <span>0</span></span></p></blockquote></div></div></small><span> 
</span></span><span>   </span><span><label for="z3-tut-v-chk24"><span><span>intros</span>.</span></label><small></small><span>
</span></span><span>   </span><span><label for="z3-tut-v-chk25"><span><span>assert</span> (x ^ <span>2</span> + <span>2</span> * x + <span>2</span> = (x + <span>1</span>) ^ <span>2</span> + <span>1</span>) <span>as</span> H <span>by</span> <span>ring</span>.</span></label><small><div><div><blockquote><div><p><span>x</span><span><span><span>:</span><span><span>R</span></span></span></span></p><p><span>H</span><span><span><span>:</span><span><span>x ^ <span>2</span> + <span>2</span> * x + <span>2</span> = (x + <span>1</span>) ^ <span>2</span> + <span>1</span></span></span></span></span></p></div><span><hr></span><p><span>x ^ <span>2</span> + <span>2</span> * x + <span>2</span> &gt; <span>0</span></span></p></blockquote></div></div></small><span>
</span></span><span>   </span><span><label for="z3-tut-v-chk26"><span><span>rewrite</span> H.</span></label><small><div><div><blockquote><div><p><span>x</span><span><span><span>:</span><span><span>R</span></span></span></span></p><p><span>H</span><span><span><span>:</span><span><span>x ^ <span>2</span> + <span>2</span> * x + <span>2</span> = (x + <span>1</span>) ^ <span>2</span> + <span>1</span></span></span></span></span></p></div><span><hr></span><p><span>(x + <span>1</span>) ^ <span>2</span> + <span>1</span> &gt; <span>0</span></span></p></blockquote></div></div></small><span> </span></span><span><label for="z3-tut-v-chk27"><span><span>Search</span> (<span>0</span> &lt;= _ ^ <span>2</span>).</span></label><small><div><div><blockquote><span>pow2_ge_0: <span>forall</span> <span>x</span> : R, <span>0</span> &lt;= x ^ <span>2</span></span></blockquote></div><div><blockquote><div><p><span>x</span><span><span><span>:</span><span><span>R</span></span></span></span></p><p><span>H</span><span><span><span>:</span><span><span>x ^ <span>2</span> + <span>2</span> * x + <span>2</span> = (x + <span>1</span>) ^ <span>2</span> + <span>1</span></span></span></span></span></p></div><span><hr></span><p><span>(x + <span>1</span>) ^ <span>2</span> + <span>1</span> &gt; <span>0</span></span></p></blockquote></div></div></small><span>
</span></span><span>   </span><span><label for="z3-tut-v-chk28"><span><span>pose</span> (pow2_ge_0 (x + <span>1</span>)).</span></label><small><div><div><blockquote><div><p><span>x</span><span><span><span>:</span><span><span>R</span></span></span></span></p><p><span>H</span><span><span><span>:</span><span><span>x ^ <span>2</span> + <span>2</span> * x + <span>2</span> = (x + <span>1</span>) ^ <span>2</span> + <span>1</span></span></span></span></span></p><p><span>r</span><span><span><span>:=</span><span><span>pow2_ge_0 (x + <span>1</span>)</span></span></span><span><span>:</span><span><span><span>0</span> &lt;= (x + <span>1</span>) ^ <span>2</span></span></span></span></span></p></div><span><hr></span><p><span>(x + <span>1</span>) ^ <span>2</span> + <span>1</span> &gt; <span>0</span></span></p></blockquote></div></div></small><span>
</span></span><span>   </span><span><span><span><span>lra</span>.</span></span><span> </span></span><span><span><span><span>Qed</span>.</span></span><span>
</span></span><span><span>


<span>(* I'm actually a little suprised [nra] sufficed here and not psatz. *)</span>

</span></span><span><label for="z3-tut-v-chk29"><span><span>Goal</span> <span>forall</span> <span>x</span>, x + <span>1</span> &lt;&gt; <span>0</span> -&gt; (x^<span>3</span> + <span>3</span> * x^<span>2</span> + <span>4</span> * x + <span>2</span>) &lt;&gt; <span>0</span>.</span></label><small><div><div><blockquote><span><hr></span><p><span><span>forall</span> <span>x</span> : R,
x + <span>1</span> &lt;&gt; <span>0</span> -&gt; x ^ <span>3</span> + <span>3</span> * x ^ <span>2</span> + <span>4</span> * x + <span>2</span> &lt;&gt; <span>0</span></span></p></blockquote></div></div></small><span>
</span></span><span>  </span><span><label for="z3-tut-v-chk2a"><span><span>intros</span>.</span></label><small><div><div><blockquote><span><hr></span><p><span>x ^ <span>3</span> + <span>3</span> * x ^ <span>2</span> + <span>4</span> * x + <span>2</span> &lt;&gt; <span>0</span></span></p></blockquote></div></div></small><span>
</span></span><span>  </span><span><label for="z3-tut-v-chk2b"><span><span>assert</span> ((x^<span>3</span> + <span>3</span> * x^<span>2</span> + <span>4</span> * x + <span>2</span>) = 
         ((x + <span>1</span>) * (x ^ <span>2</span> + <span>2</span> * x + <span>2</span> ))) <span>as</span> H0 <span>by</span> <span>ring</span>.</span></label><small><div><div><blockquote><div><p><span>x</span><span><span><span>:</span><span><span>R</span></span></span></span></p><p><span>H</span><span><span><span>:</span><span><span>x + <span>1</span> &lt;&gt; <span>0</span></span></span></span></span></p><p><span>H0</span><span><span><span>:</span><span><span>x ^ <span>3</span> + <span>3</span> * x ^ <span>2</span> + <span>4</span> * x + <span>2</span> =
(x + <span>1</span>) * (x ^ <span>2</span> + <span>2</span> * x + <span>2</span>)</span></span></span></span></p></div><span><hr></span><p><span>x ^ <span>3</span> + <span>3</span> * x ^ <span>2</span> + <span>4</span> * x + <span>2</span> &lt;&gt; <span>0</span></span></p></blockquote></div></div></small><span>
</span></span><span>  </span><span><label for="z3-tut-v-chk2c"><span><span>rewrite</span> H0.</span></label><small><div><div><blockquote><div><p><span>x</span><span><span><span>:</span><span><span>R</span></span></span></span></p><p><span>H</span><span><span><span>:</span><span><span>x + <span>1</span> &lt;&gt; <span>0</span></span></span></span></span></p><p><span>H0</span><span><span><span>:</span><span><span>x ^ <span>3</span> + <span>3</span> * x ^ <span>2</span> + <span>4</span> * x + <span>2</span> =
(x + <span>1</span>) * (x ^ <span>2</span> + <span>2</span> * x + <span>2</span>)</span></span></span></span></p></div><span><hr></span><p><span>(x + <span>1</span>) * (x ^ <span>2</span> + <span>2</span> * x + <span>2</span>) &lt;&gt; <span>0</span></span></p></blockquote></div></div></small><span> </span></span><span><label for="z3-tut-v-chk2d"><span><span>pose</span> (pos_poly x).</span></label><small><div><div><blockquote><div><p><span>x</span><span><span><span>:</span><span><span>R</span></span></span></span></p><p><span>H</span><span><span><span>:</span><span><span>x + <span>1</span> &lt;&gt; <span>0</span></span></span></span></span></p><p><span>H0</span><span><span><span>:</span><span><span>x ^ <span>3</span> + <span>3</span> * x ^ <span>2</span> + <span>4</span> * x + <span>2</span> =
(x + <span>1</span>) * (x ^ <span>2</span> + <span>2</span> * x + <span>2</span>)</span></span></span></span></p><p><span>r</span><span><span><span>:=</span><span><span>pos_poly x</span></span></span><span><span>:</span><span><span>x ^ <span>2</span> + <span>2</span> * x + <span>2</span> &gt; <span>0</span></span></span></span></span></p></div><span><hr></span><p><span>(x + <span>1</span>) * (x ^ <span>2</span> + <span>2</span> * x + <span>2</span>) &lt;&gt; <span>0</span></span></p></blockquote></div></div></small><span> </span></span><span><span><span><span>nra</span>.</span></span><span> </span></span><span><span><span><span>Qed</span>.</span></span><span>
</span></span><span><span>
<span>(* A slightly more manual proof *)</span>
</span></span><span><label for="z3-tut-v-chk2e"><span><span>Goal</span> <span>forall</span> <span>x</span>, x + <span>1</span> &lt;&gt; <span>0</span> -&gt; (x^<span>3</span> + <span>3</span> * x^<span>2</span> + <span>4</span> * x + <span>2</span>) &lt;&gt; <span>0</span>.</span></label><small><div><div><blockquote><span><hr></span><p><span><span>forall</span> <span>x</span> : R,
x + <span>1</span> &lt;&gt; <span>0</span> -&gt; x ^ <span>3</span> + <span>3</span> * x ^ <span>2</span> + <span>4</span> * x + <span>2</span> &lt;&gt; <span>0</span></span></p></blockquote></div></div></small><span>
</span></span><span>  </span><span><label for="z3-tut-v-chk2f"><span><span>intros</span>.</span></label><small><div><div><blockquote><span><hr></span><p><span>x ^ <span>3</span> + <span>3</span> * x ^ <span>2</span> + <span>4</span> * x + <span>2</span> &lt;&gt; <span>0</span></span></p></blockquote></div></div></small><span>
</span></span><span>  </span><span><label for="z3-tut-v-chk30"><span><span>assert</span> ((x^<span>3</span> + <span>3</span> * x^<span>2</span> + <span>4</span> * x + <span>2</span>) = 
         ((x + <span>1</span>) * (x ^ <span>2</span> + <span>2</span> * x + <span>2</span> ))) <span>by</span> <span>ring</span>.</span></label><small><div><div><blockquote><div><p><span>x</span><span><span><span>:</span><span><span>R</span></span></span></span></p><p><span>H</span><span><span><span>:</span><span><span>x + <span>1</span> &lt;&gt; <span>0</span></span></span></span></span></p><p><span>H0</span><span><span><span>:</span><span><span>x ^ <span>3</span> + <span>3</span> * x ^ <span>2</span> + <span>4</span> * x + <span>2</span> =
(x + <span>1</span>) * (x ^ <span>2</span> + <span>2</span> * x + <span>2</span>)</span></span></span></span></p></div><span><hr></span><p><span>x ^ <span>3</span> + <span>3</span> * x ^ <span>2</span> + <span>4</span> * x + <span>2</span> &lt;&gt; <span>0</span></span></p></blockquote></div></div></small><span>
</span></span><span>  </span><span><label for="z3-tut-v-chk31"><span><span>rewrite</span> H0.</span></label><small><div><div><blockquote><div><p><span>x</span><span><span><span>:</span><span><span>R</span></span></span></span></p><p><span>H</span><span><span><span>:</span><span><span>x + <span>1</span> &lt;&gt; <span>0</span></span></span></span></span></p><p><span>H0</span><span><span><span>:</span><span><span>x ^ <span>3</span> + <span>3</span> * x ^ <span>2</span> + <span>4</span> * x + <span>2</span> =
(x + <span>1</span>) * (x ^ <span>2</span> + <span>2</span> * x + <span>2</span>)</span></span></span></span></p></div><span><hr></span><p><span>(x + <span>1</span>) * (x ^ <span>2</span> + <span>2</span> * x + <span>2</span>) &lt;&gt; <span>0</span></span></p></blockquote></div></div></small><span> </span></span><span><label for="z3-tut-v-chk32"><span><span>pose</span> (pos_poly x).</span></label><small><div><div><blockquote><div><p><span>x</span><span><span><span>:</span><span><span>R</span></span></span></span></p><p><span>H</span><span><span><span>:</span><span><span>x + <span>1</span> &lt;&gt; <span>0</span></span></span></span></span></p><p><span>H0</span><span><span><span>:</span><span><span>x ^ <span>3</span> + <span>3</span> * x ^ <span>2</span> + <span>4</span> * x + <span>2</span> =
(x + <span>1</span>) * (x ^ <span>2</span> + <span>2</span> * x + <span>2</span>)</span></span></span></span></p><p><span>r</span><span><span><span>:=</span><span><span>pos_poly x</span></span></span><span><span>:</span><span><span>x ^ <span>2</span> + <span>2</span> * x + <span>2</span> &gt; <span>0</span></span></span></span></span></p></div><span><hr></span><p><span>(x + <span>1</span>) * (x ^ <span>2</span> + <span>2</span> * x + <span>2</span>) &lt;&gt; <span>0</span></span></p></blockquote></div></div></small><span> </span></span><span><label for="z3-tut-v-chk33"><span><span>Search</span> (_ * _ = <span>0</span>).</span></label><small><div><div><blockquote><span>Rmult_0_l: <span>forall</span> <span>r</span> : R, <span>0</span> * r = <span>0</span></span></blockquote><blockquote><span>Rmult_0_r: <span>forall</span> <span>r</span> : R, r * <span>0</span> = <span>0</span></span></blockquote><blockquote><span>Rmult_eq_0_compat_l:
  <span>forall</span> <span>r1</span> <span>r2</span> : R, r2 = <span>0</span> -&gt; r1 * r2 = <span>0</span></span></blockquote><blockquote><span>Rmult_eq_0_compat_r:
  <span>forall</span> <span>r1</span> <span>r2</span> : R, r1 = <span>0</span> -&gt; r1 * ‚Ä¶</span></blockquote></div></div></small></span></pre></div></div></article></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://www.philipzucker.com/translating-z3-to-coq/">https://www.philipzucker.com/translating-z3-to-coq/</a></em></p>]]>
            </description>
            <link>https://www.philipzucker.com/translating-z3-to-coq/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26288749</guid>
            <pubDate>Sat, 27 Feb 2021 22:27:55 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Show HN: Rich Text Math Editing on the Web with Markdown and AsciiMath]]>
            </title>
            <description>
<![CDATA[
Score 44 | Comments 11 (<a href="https://news.ycombinator.com/item?id=26287948">thread link</a>) | @abhinav22
<br/>
February 27, 2021 | https://writer.math.dev/landing.html | <a href="https://web.archive.org/web/*/https://writer.math.dev/landing.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>

<p><a href="https://writer.math.dev/">https://writer.math.dev</a></p>
<p>Welcome to Math Writer and thank you for visiting this page. Math Writer is a rich text web editor for math, utilising the power of MathJax and the featureful TinyMCE text editor. It allows you to enter markdown and math together and aims to be a convenient way to write digital math, particularly for your own websites, with pdf and html export options. It will always be free to use and I welcome suggestions, pull requests and bug reports.</p>
<h2>The Power of MathJax</h2>
<p>All math is entered and rendered in accordance with <a href="https://www.mathjax.org/">MathJax</a>, the popular math rendering engine for the web. This means you can enter math either as AsciiMath or LaTex, however I prefer the former for most cases as it reads better in raw form (ultimately it is a personal preference). In addition, a set of handy keyboard shortcuts are included in this editor to aide with commonly used mathematical symbols.</p>
<h2>The Power of TinyMCE</h2>
<p><a href="https://www.tiny.cloud/">TinyMCE</a> is, by their own admission, the world's most customizable and flexible rich text editor. It provides powerful WYSIWYG functionality and ease of use. By combining TinyMCE with the power of MathJax, I was able to build (what I hope is) a high quality math editor.</p>
<h2>Markdown Works!</h2>
<p>Basic markdown commands like headers (#, ##, ...), italics (*), bold (**) and lists (*, -, 1., a., etc.) work in this editor. So you can think of it as a Markdown Editor with mathematical input.</p>
<h2>Who is the Audience?</h2>
<p>I built this editor for myself, but decided it might be worthwhile for others, hence hosting it online. It is most valuable to those who enter a lot of mathematical content for websites (using MathJax), as it exports nicely to HTML and provides a convenient workflow. It is also useful for those looking for a reasonable quality math editor, who are not yet tied in to LaTeX, MS Word or another option. I believe the editor hits the sweetpot of being able to write WYSIWYG formatted rich text, with the power of mathematical input from AsciiMath &amp; LaTeX, with one-click previews of rendered maths.</p>
<h2>Suggestions &amp; Pull Requests Welcome!</h2>
<p>I would be very happy for others to take this editor and customise it for themselves or morph it into something more. I would love to see AsciiMath become a standard for mathematical input (LaTeX is good too, but I am a big fan of AsciiMath being more readable in raw form), and perhaps this project will help push in that direction.</p>
<h2>Get started!</h2>
<p>To get started, simply navigate to <a href="https://writer.math.dev/">https://writer.math.dev</a>. There is a basic tutorial under the "Read Me" tab. If you like this editor, please do star it on <a href="https://github.com/ashok-khanna/math-writer">GitHub</a>.</p>
<h2>Contact Information</h2>
<p>You can e-mail me at <a href="https://writer.math.dev/cdn-cgi/l/email-protection" data-cfemail="a6c7d5cec9cd88cdcec7c8c8c7e6cec9d2cbc7cfca88c5c9cb">[email&nbsp;protected]</a> for any queries, suggestions or just a general chat. Thank you again for your time and I hope you enjoy this editor.</p>
</div></div>]]>
            </description>
            <link>https://writer.math.dev/landing.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-26287948</guid>
            <pubDate>Sat, 27 Feb 2021 20:41:08 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[SolarWind, enough with the password already]]>
            </title>
            <description>
<![CDATA[
Score 214 | Comments 127 (<a href="https://news.ycombinator.com/item?id=26286940">thread link</a>) | @troydavis
<br/>
February 27, 2021 | https://gru.gq/2021/02/28/solarwind-enough-with-the-password-already/ | <a href="https://web.archive.org/web/*/https://gru.gq/2021/02/28/solarwind-enough-with-the-password-already/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><div><div><main><article itemscope="" itemtype="https://schema.org/CreativeWork"><div itemprop="text"><p>This is a much delayed discussion on the complexity and nuance of the SolarWind hack. The simplistic and wrong messaging from some quarters of the infosec community has resulted in an atrocious misunderstanding of the hack in the public sphere. This has extended into the policy world as these bad takes are treated as cogent analysis.</p>
<p><a href="https://twitter.com/thegrugq/status/1341439709487087618?s=21">I wrote this back in December</a>, but months later this <a href="https://edition.cnn.com/2021/02/26/politics/solarwinds123-password-intern/index.html">bad analysis is still brought up in the policy space.</a></p>
<h2>Espionage is the second oldest profession</h2>
<p>It is a truth universally acknowledged, that with spying, the ends justify the means. This is true for all espionage organisations, the opposition‚Äôs and your own. Why is that relevant? Because any standard which is used to hamper the opposition will also apply to, and hamper, yours.</p>
<p>Sometimes laying down blanket rules about acceptable espionage behaviour is not a problem. Almost always this is when a certain type of operation is out of character with the society that produces the espionage agency. China makes extensive use of their diaspora community for espionage. The US has thousands of trained professionals and doesn‚Äôt use their diaspora community for organic bottom up collection. The US sometimes coopts civilians (and China has professionals) but generally speaking the diaspora method is one that only China uses extensively.</p>
<p>Extending this a bit further: if an espionage rule was proposed that banned the use of professionals but allowed the use of amateur civilians, China would be able to easily adapt to the new espionage environment. The US would be severely constrained. For this reason, the US wouldn‚Äôt sign up to, or abide by, such a requirement. (This is complicated further by the nature of targets for espionage, and national policy, but we can explore that another day.)</p>
<p>This brings me to targeting civilian companies and supply chain attacks. The US uses these methods just as, if not more, frequently than the Russians. FLAME, a strain of malware that targeted entities in the Middle East, exploited a cryptologic bug in the way Microsoft signed their updates. The NSA was then able to inject malicious code into the updates of Microsoft software. And just like SolarWinds, it was specifically targeted to ensure only legitimate espionage targets were infected and collected.</p>
<p><strong>There is no rule that would prohibit the SolarWinds espionage campaign which the US would be willing to abide by itself.</strong></p>
<h2>Russian Intelligence aren‚Äôt script kiddies</h2>
<p>Here‚Äôs the thing: the attackers are Russian foreign intelligence, the cream of the old KGB, and they will find a way to gain access to their target. Do they need to recruit a developer at the company and trick them into installing malware? They will do that.</p>
<p>They do not need to access the target via a weak password on the build servers. If that is what they use, then that is what they use, but it is not the make or break factor for the operation.</p>
<p>Part of the problem here might be that a superficial understanding of the cyber kill chain gives the impression that if you just stop <strong>The One Critical TTP</strong> in the chain then you will defeat the opposition. This is only true for an opposition that is inflexible and using just one technique. That description does not apply to the Russian intelligence services.</p>
<p>Intelligence agencies have targets and they will find the techniques to access them. The don‚Äôt start with a technique and look for targets that they can access.</p>
<p>The SolarWind backdoor was deeply integrated into the code, it was injected during their build process, and there is no way that the server having a weak password was the pivotal factor. As if Russian Intelligence would just give up if there were a strong password instead!</p>
<p>There is practically no chance that the server‚Äôs password was in anyway relevant to the hack overall. I can forgive the ignorance from the news media, but some infosec people are repeating this garbage as if it is important part of the SolarWind compromise.</p>
<blockquote><p>‚ÄúThe offense is routinely underestimated. When companies are hacked, they react as if they had only done this one thing or avoided this one mistake everything would have been okay. The adversary is treated as if they just got lucky.‚Äù ‚Äî Network Attacks and Exploitation <a href="https://twitter.com/networkattack">@networkattack</a></p>
</blockquote>
<p>People suggesting that the weak password example is relevant because it illustrates the poor security practices overall. I would agree with you if that was the argument presented. It was not. You have to work with the words ppl said, not what you wish they‚Äôd said.</p>
<blockquote><p>‚Äò‚ÄôSecurity researcher Vinoth Kumar told Reuters that, last year, he alerted the company that anyone could access SolarWinds‚Äô update server by using the password ‚Äúsolarwinds123‚Äù<br>
‚ÄúThis could have been done by any attacker, easily,‚Äù Kumar said.‚Äô‚Äô</p>
</blockquote>
<p>I absolutely agree with the ‚Äúit is illustrative of poor security practice‚Äù but‚Ä¶ that isn‚Äôt what was said. They literally said that the weak password means that the attacker could be anyone. Anyone could do it. That is the dumbest take.</p>
<h2>The KGB vs a software vendor? Bet KGB.</h2>
<p>Here‚Äôs the thing.</p>
<p>I‚Äôm perfectly willing to believe that their build servers were using ‚Äúadmin:admin‚Äù and that‚Äôs how the Russians gained access to inject their code‚Ä¶ but, this was a clandestine intelligence operation. They did not succeed merely because SolarWind had poor password hygiene.</p>
<p>The SVR was formed from the cream of the KGB ‚Äî the first chief directorate (FCD). The most prestigious directorate in the KGB. As the SVR they are still formidable.</p>
<h2>Was SolarWind picked due to its poor security?</h2>
<p>No.</p>
<p>I suspect the primary motivation was the access that would be enabled by the attack, not the vulnerable nature of the company. This is the SVR, the cream of the KGB (first chief directorate). They are not going to be bothered by password policy.</p>
<p>That‚Äôs what kinda annoys me‚Ä¶ however easy SolarWind may have been to hack, they were hacked by the fucking First Chief Directorate of the KGB. Quite possibly the people that are frying diplomats brains with microwaves in Havana. They‚Äôre pretty fucking metal.</p>
<p>Could SolarWind have been too difficult for the KGB to use them in an enablement operation? Yes, it is possible to achieve that level of security. Creating a strong fast detection capability with rapid remediation and incident response will make it hard for attackers to dwell for any length of time, or persist on the system after they gain access. It requires vigilance and some effort, but it can be done. Of course, SolarWind wasn‚Äôt close to reaching that level.</p>
<div><p>Liked it? Take a second to support grugq on Patreon!</p><p><a rel="nofollow" target="_blank" href="https://www.patreon.com/oauth2/become-patron?response_type=code&amp;min_cents=100&amp;client_id=XPz53m5BPTmu-cnihK1RXoEaRoNywCco8VIPCNbwnAexV5YWdi_YG5Asup2LeG9p&amp;scope=identity%20identity[email]&amp;redirect_uri=https://gru.gq/patreon-authorization/&amp;state=eyJmaW5hbF9yZWRpcmVjdF91cmkiOiJodHRwczpcL1wvZ3J1LmdxXC8yMDIxXC8wMlwvMjhcL3NvbGFyd2luZC1lbm91Z2gtd2l0aC10aGUtcGFzc3dvcmQtYWxyZWFkeVwvIn0%3D&amp;utm_source=https%3A%2F%2Fgru.gq%2F2021%2F02%2F28%2Fsolarwind-enough-with-the-password-already%2F&amp;utm_medium=patreon_wordpress_plugin&amp;utm_campaign=457796&amp;utm_term=&amp;utm_content=post_unlock_button"><img src="https://i2.wp.com/gru.gq/wp-content/plugins/patron-button-and-widgets-by-codebard/images/become_a_patron_button.png?ssl=1" data-recalc-dims="1" data-lazy-src="https://i2.wp.com/gru.gq/wp-content/plugins/patron-button-and-widgets-by-codebard/images/become_a_patron_button.png?ssl=1&amp;is-pending-load=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"></a></p></div>
<!--<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="https://gru.gq/2021/02/28/solarwind-enough-with-the-password-already/"
    dc:identifier="https://gru.gq/2021/02/28/solarwind-enough-with-the-password-already/"
    dc:title="SolarWind, enough with the password already!"
    trackback:ping="https://gru.gq/2021/02/28/solarwind-enough-with-the-password-already/trackback/" />
</rdf:RDF>-->
</div></article>
		

		
		

		</main></div></div></div></div>]]>
            </description>
            <link>https://gru.gq/2021/02/28/solarwind-enough-with-the-password-already/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26286940</guid>
            <pubDate>Sat, 27 Feb 2021 18:31:19 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Not Getting Royalty Free Illustrations and Components? These Site May Help You]]>
            </title>
            <description>
<![CDATA[
Score 6 | Comments 0 (<a href="https://news.ycombinator.com/item?id=26286169">thread link</a>) | @farseenmanekhan
<br/>
February 27, 2021 | https://www.dev-stuff.tech/2021/02/not-getting-royalty-free-illustrations.html | <a href="https://web.archive.org/web/*/https://www.dev-stuff.tech/2021/02/not-getting-royalty-free-illustrations.html">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
<meta content="$ilp.uphold.com/GYJa7Bw4R3zj" name="monetization"><div><p><a href="https://1.bp.blogspot.com/-snp60hXrwqU/YCgJ5G1VyOI/AAAAAAAABHQ/GLZkNXhjYWwFHOdLdU0rJA-fRUYe1sDiACLcBGAsYHQ/s1920/sigmund-AxAPuIRWHGk-unsplash.jpg"><img alt="" data-original-height="1280" data-original-width="1920" height="426" src="https://1.bp.blogspot.com/-snp60hXrwqU/YCgJ5G1VyOI/AAAAAAAABHQ/GLZkNXhjYWwFHOdLdU0rJA-fRUYe1sDiACLcBGAsYHQ/w640-h426/sigmund-AxAPuIRWHGk-unsplash.jpg" width="640"></a></p><p>To give your website a modern look , you decide to add illustrations , but unfortunately you don't know how to make Illustrations and you google for illustrations , but chances are your site might be taken down under copyright infringement
So here are some websites where you can get Royalty Free Illustrations and Components to Add them to your Website or App
</p><ul>
<li>uidesigndaily.com</li>
<li>100dailyui.webflow.io</li>
<li>opendoodles.com</li>
<li>humaaans.com</li>
<li>products.ls.graphics</li>
<li>error404.fun</li>
<li>drawkit.io</li>
<li>absurd.design</li>
<li>undraw.co</li>
<li>manypixels.co</li>
<li>openpeeps.com</li>
<li>animaticons.co</li>
</ul></div>
</div></div>]]>
            </description>
            <link>https://www.dev-stuff.tech/2021/02/not-getting-royalty-free-illustrations.html</link>
            <guid isPermaLink="false">hacker-news-small-sites-26286169</guid>
            <pubDate>Sat, 27 Feb 2021 17:05:12 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[A single cell slime mold makes decisions without a central nervous system]]>
            </title>
            <description>
<![CDATA[
Score 168 | Comments 75 (<a href="https://news.ycombinator.com/item?id=26285926">thread link</a>) | @gmays
<br/>
February 27, 2021 | https://www.tum.de/nc/en/about-tum/news/press-releases/details/36462/ | <a href="https://web.archive.org/web/*/https://www.tum.de/nc/en/about-tum/news/press-releases/details/36462/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
				
<div id="c49300"><figure><img title="Prof. Dr. Karen Alim in ihrem Labor" alt="Prof. Dr. Karen Alim in ihrem Labor" src="https://www.tum.de/fileadmin/_processed_/f/7/csm_2102xx_Karen_Alim_lab_2100_60155babf1.jpg" width="1280" height="540"><figcaption>
				
					Prof. Dr. Karen Alim in her laboratory.
				
				<p><span>
					
						Image: Bilderfest / TUM
					
				</span></p></figcaption></figure><div><div><article itemscope="itemscope" itemtype="http://schema.org/Article"><header><p itemprop="description">
					Having a memory of past events enables us to take smarter decisions about the future. Researchers at the Max-Planck Institute for Dynamics and Self-Organization (MPI-DS) and the Technical University of Munich (TUM) have now identified how the slime mold Physarum polycephalum saves memories ‚Äì although it has no nervous system.
				</p></header><section><p>The ability to store and recover information gives an organism a clear advantage when searching for food or avoiding harmful environments. Traditionally it has been attributed to organisms that have a nervous system.</p><p>A new study authored by Mirna Kramar (MPI-DS) and <a href="https://www.professoren.tum.de/en/alim-karen" title="Profile of Prof. Dr. Karen Alim" target="_blank">Prof. Karen Alim</a> (TUM and MPI-DS) challenges this view by uncovering the surprising abilities of a highly dynamic, single-celled organism to store and retrieve information about its environment.</p><div id="c62766"><div><div><p>The slime mold Physarum polycephalum has been puzzling researchers for many decades. Existing at the crossroads between the kingdoms of animals, plants and fungi, this unique organism provides insight into the early evolutionary history of eukaryotes ‚Äì to which also humans belong.</p><p>Its body is a giant single cell made up of interconnected tubes that form intricate networks. This single amoeba-like cell may stretch several centimeters or even meters, featuring as the largest cell on earth in the Guinness Book of World Records.</p></div></div></div><div id="c62767"><div><div><p>‚ÄúIt is very exciting when a project develops from a simple experimental observation‚Äù, says Karen Alim, head of the Biological Physics and Morphogenesis group at the MPI-DS in G√∂ttingen and professor for the <a href="http://www.bpm.ph.tum.de/" target="_blank">Theory of Biological Networks</a> at the Technical University of Munich.</p><p>When the researchers followed the migration and feeding process of the organism and observed a distinct imprint of a food source on the pattern of thicker and thinner tubes of the network long after feeding.</p><p>‚ÄúGiven P. polycephalum's highly dynamic network reorganization, the persistence of this imprint sparked the idea that the network architecture itself could serve as memory of the past‚Äú, says Karen Alim. However, they first needed to explain the mechanism behind the imprint formation.</p></div></div></div><div id="c62768"><div><div><p>For this purpose the researchers combined microscopic observations of the adaption of the tubular network with theoretical modeling. An encounter with food triggers the release of a chemical that travels from the location where food was found throughout the organism and softens the tubes in the network, making the whole organism reorient its migration towards the food.</p><p>‚ÄúThe gradual softening is where the existing imprints of previous food sources come into play and where information is stored and retrieved‚Äù, says first author Mirna Kramar. ‚ÄúPast feeding events are embedded in the hierarchy of tube diameters, specifically in the arrangement of thick and thin tubes in the network.‚Äù</p><p>‚ÄúFor the softening chemical that is now transported, the thick tubes in the network act as highways in traffic networks, enabling quick transport across the whole organism‚Äù, adds Mirna Kramar. ‚ÄúPrevious encounters imprinted in the network architecture thus weigh into the decision about the future direction of migration.‚Äù</p></div></div></div><div id="c62769"><div><div><p>‚ÄûGiven the simplicity of this living network, the ability of Physarum to form memories is intriguing. It is remarkable that the organism relies on such a simple mechanism and yet controls it in such a fine-tuned manner,‚Äù says Karen Alim.</p><p>‚ÄúThese results present an important piece of the puzzle in understanding the behavior of this ancient organism and at the same time points to universal principles underlying behavior. We envision potential applications of our findings in designing smart materials and building soft robots that navigate through complex environments‚Äù, concludes Karen Alim.</p></div></div></div><div><div><div><h3>
		Corporate Communications Center
	</h3></div></div></div><section></section></section></article></div></div><section><h2>
			Article at tum.de
		</h2><div><div><article><a title="ERC supports pioneering research projects at TUM" href="https://www.tum.de/en/about-tum/news/press-releases/details/36230-1/"><figure><img alt="Schleimpilz Physarum polycephalum" src="https://www.tum.de/fileadmin/_processed_/f/b/csm_Physarum_polycephalum_2100_6fd9eb4a44.jpg" width="1280" height="720" title="Physarum polycephalum ERC Grants"><figcaption></figcaption></figure></a><header><h2><a title="ERC supports pioneering research projects at TUM" href="https://www.tum.de/en/about-tum/news/press-releases/details/36230-1/">
						ERC supports pioneering research projects at TUM
					</a></h2><p>
					
						From new methods for examining individual cells, physical basics of the reactions of vascular systems and the development of better prognostic methods for osteoporosis to intelligent tools for urban planning and the...
				</p></header></article></div></div></section><!-- news uid 36459 --></div>


				
			</div></div>]]>
            </description>
            <link>https://www.tum.de/nc/en/about-tum/news/press-releases/details/36462/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26285926</guid>
            <pubDate>Sat, 27 Feb 2021 16:37:09 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Taxing Families Like Companies]]>
            </title>
            <description>
<![CDATA[
Score 43 | Comments 91 (<a href="https://news.ycombinator.com/item?id=26285606">thread link</a>) | @mooreds
<br/>
February 27, 2021 | https://americancompass.org/the-commons/taxing-families-like-companies/ | <a href="https://web.archive.org/web/*/https://americancompass.org/the-commons/taxing-families-like-companies/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
      
<div>
  <p>Sign up to receive The Commons posts in your inbox.</p>
  
</div>
<div>
    
  <div>
    <p><img data-src="https://americancompass.org/wp-content/uploads/2021/02/stellrweb-djb1whucfBY-unsplash-scaled.jpg" src="https://americancompass.org/wp-content/uploads/2021/02/stellrweb-djb1whucfBY-unsplash-scaled.jpg"></p><p><em>[Note: This post is from the policy forum <a href="https://americancompass.org/essays/7-proposals-to-make-america-more-family-friendly/">7 Proposals to Make America More Family-Friendly</a>.]</em></p>
<p>If families are people, and corporations are people, it stands to reason that families should be allowed to incorporate and file their taxes accordingly.</p>
<p>The benefits to incorporating are fairly obvious: corporations are taxed on their net income, and they enjoy a lower tax rate. Families, on the other hand, pay taxes on their revenue. And while families enjoy a few miscellaneous deductions and credits, they largely miss out on the good stuff. Corporations get to deduct nearly all capital expenditures; families receive no direct tax benefit for feeding their kids, purchasing clothes, buying a minivan, filling that minivan with unleaded, homeschooling or other education expenses, fixing a furnace, upgrading technology, or even moving to a safer neighborhood. If a corporation can demonstrate a net loss on the year, even due to its own aggressive spending habits, it doesn‚Äôt pay taxes. If a family loses money, the tax code doesn‚Äôt care.<span id="more-3557"></span></p>
<p>As a result, families pay a disproportionate share of federal tax receipts. In <a href="https://www.irs.gov/pub/irs-pdf/p55b.pdf">2019</a>, individuals paid just under 70 percent of all federal taxes, while corporations paid just 25 percent. Take payroll taxes out of the equation, and those numbers become even more lopsided: individuals paid nearly $1.6 trillion to the federal government while corporations paid about $226 billion.</p>
<p>This is not to suggest that corporations should be taxed on their revenue, or that we should dramatically increase corporate taxes. Lower taxes and reduced regulatory burdens can, at least in theory, encourage capital formation. So if Republicans are so eager to pass a $1.7 trillion, unfunded corporate tax cut on the belief that it would spur business investment, as they did in 2017, shouldn‚Äôt they be willing to consider a similar approach to other forms of capital formation‚Äînamely, human capital formation?</p>
<p>We are in the midst of a fertility crisis, which only worsened during the COVID-19 pandemic. The U.S. has already reached an all-time-low fertility rate of 1.71 births per woman, and Brookings estimates that there will be a ‚Äú<a href="https://www.brookings.edu/research/half-a-million-fewer-children-the-coming-covid-baby-bust/">baby bust</a>‚Äù in 2021 of at least 300,000 fewer American births. The long-term effects of such a decline in human capital would be far-reaching. Shrinking populations don‚Äôt often lend themselves to growing economies.</p>
<p>Financial pressures are one of the main, addressable sources of the crisis. As American Compass‚Äôs recent Home Building Survey <a href="https://americancompass.org/essays/home-building-survey-part-1/">showed</a>, half of parenting-age adults want more children than they currently have. And for all but the most well-off, these parents cite the inability to afford more children as the primary reason for this deficit.</p>
<p>If we were to find a similar impediment to the formation or growth of American businesses, wouldn‚Äôt we do something about it? Wouldn‚Äôt we have done something already?</p>
<p>We could create new deductions or expand existing credits to attempt to level the playing field between corporations and families. Options include: boosting the Child Tax Credit, reworking the Earned Income Tax Credit, extending the Child and Dependent Care Tax Credit beyond two dependents or above the current $6,000 cap, or even expanding the scope of 529 savings accounts to include all K-12 schooling options.</p>
<p>Or, we could go big and allow families access to the same tax treatment that Amazon and General Electric enjoy. Instead of a Child Tax Credit, let families write off their grocery bills. Instead of deductions for mortgage interest that only kick in if tax filers earn enough income to itemize, let families deduct all housing costs. Instead of an inadequate childcare deduction, let families deduct the entire expense. Why not? Families are corporations, my friend.</p>
<p>For decades, supply-side ideology has led Republicans to cut taxes and regulation on behalf of corporations. Now, as financial pressures constrain the supply of future Americans, we should embrace supply-side <em>oikonomics</em> and let families incorporate.</p>
    <p><a href="https://americancompass.org/the-commons/">Return to the Commons</a>
  </p></div>
  <div>
    <div>
      <p><img src="https://americancompass.org/wp-content/uploads/2021/02/Schweppe_Headshot-150x150.jpg" width="96" height="96" alt="Jon Schweppe"></p><div>
        
        <p>Jon Schweppe is the director of policy and government affairs at American Principles Project.</p>
                
              </div>
    </div>
  </div>
    
</div>
<p>
  <h3>Related Posts</h3>
</p>
<section>
    <div>
    <h5><a href="https://americancompass.org/the-commons/let-them-eat-daycare/">Let Them Eat Daycare</a></h5>
    
    <p>Our policy debates center on helping working families, but they routinely fail to capture those families‚Äô preferences for their own lives or for policies that would help them most. Proposals most useful to households with all adults in the workforce, like subsidized childcare or paid leave, often receive far more attention from policymakers and pundits [‚Ä¶]</p>
  </div>
    <div>
    <h5><a href="https://americancompass.org/the-commons/dont-federalize-family-policy/">Don‚Äôt Federalize Family Policy</a></h5>
    
    <p>[Note: This comment is from a&nbsp;series of responses&nbsp;to the proposal for a&nbsp;Family Income Supplemental Credit.] Although this is a response to the interesting and compelling Family Income Supplemental Credit (Fisc) proposal by Oren Cass and Wells King, it is meant, more broadly, to engage with those on the political right who argue for more forcefully [‚Ä¶]</p>
  </div>
  </section>
        
      </div></div>]]>
            </description>
            <link>https://americancompass.org/the-commons/taxing-families-like-companies/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26285606</guid>
            <pubDate>Sat, 27 Feb 2021 15:54:52 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Phantom Types in Gleam]]>
            </title>
            <description>
<![CDATA[
Score 34 | Comments 11 (<a href="https://news.ycombinator.com/item?id=26284976">thread link</a>) | @pd-andy
<br/>
February 27, 2021 | https://blog.pd-andy.dev/phantom-types-in-gleam | <a href="https://web.archive.org/web/*/https://blog.pd-andy.dev/phantom-types-in-gleam">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div itemprop="text"><p>In this post we're going to be looking at a more advanced use of <a target="_blank" href="https://gleam.run/">Gleam</a>'s type system, known as phantom types. Hopefully by the end of this you'll have another tool in your belt to help you better model data in your programs. And fear not, because many languages support phantom types (most common functional programming languages support them, but so do others like Rust, and TypeScript, and even <a target="_blank" href="https://marcosh.github.io/post/2020/05/26/phantom-types-in-php.html">PHP</a>) so you can apply this knowledge elsewhere! </p>
<p>Before we get stuck into some examples, let's tackle the obvious question.</p>
<hr>
<h2 id="what-are-phantom-types">What are phantom types?</h2>
<p>A phantom type is a type parameter that appears on the left hand side of a type's definition but not on the right hand side. In other words, it's a type parameter that is never used by any of a type's constructors.</p>
<pre><code>pub type Example(phantom) {
    Example
}
</code></pre>
<p>In the <code>Example</code> type we have a type parameter, <code>phantom</code>, that isn't used in the type's constructor. Phantom types can be used to provide additional safety or context to values without paying the runtime cost of carrying additional data around. Everything is handled at compile time!</p>
<blockquote>
<p>üí° In some languages, the compiler may emit a warning (or refuse to compile at all) when a type has unused type parameters. Often there are language-specific solutions to this, like <a target="_blank" href="https://doc.rust-lang.org/std/marker/struct.PhantomData.html">PhantomData</a> in Rust or <a target="_blank" href="https://medium.com/@dhruvrajvanshi/advanced-typescript-patterns-6cf8826c7944">impossible fields</a> in TypeScript.</p>
</blockquote>
<p>The rest of this article will see us going over <strong>four</strong> different scenarios where phantom types can come in to play. The whole article is a bit long so if any of the examples describes a scenario that fits you perfectly, feel free to jump straight to it!</p>
<hr>
<h2 id="example-one-dealing-with-ids">Example One: Dealing with Ids.</h2>
<p>To understand why phantom types might be useful, let's start with a common scenario. Imagine we're building a social blogging platform like <a target="_blank" href="http://dev.to/">dev.to</a> or <a target="_blank" href="http://medium.com/">medium.com</a>. We want to support different users and blog posts, so we assign a unique id to all of these things.</p>
<p>We're a scrappy, fast-moving startup so we implement the simplest possible system for managing IDs: just type aliasing <code>Int</code>s to get things going.</p>
<pre><code>pub type Id = Int

pub fn next (id: Id) -&gt; Id {
    id + 1
}
</code></pre>
<p>Our platform supports Reddit-style upvoting or liking of posts, and we have a function just for that. It takes in the <code>Id</code> of a post to upvote and the <code>Id</code> of the user that upvoted it, and does some magic to make the upvote happen.</p>
<pre><code>pub fn upvote_post (user_id: Id, post_id: Id) -&gt; Nil {
    // Get a post from the database and upvote it.
    ...
}
</code></pre>
<p>This lets us rush to production, but maybe you've already spotted a potential problem with what we have so far. It's only a matter of time until someone gets the parameters the wrong way round and now a totally unrelated user has upvoted a random post.</p>
<p>One solution would be to stop aliasing <code>Int</code> and define new types for <code>PostId</code> and <code>UserId</code> instead.</p>
<pre><code>pub type PostId { PostId(Int) }
pub type UserId { UserId(Int) }
</code></pre>
<p>Now the two id types are successfully disjoint, but as a consequence we'll end up with a lot more duplicated code. We'll have to have separate <code>next</code> methods to increment each id type, similarly if we want to unwrap the type we'll need separate <code>to_int</code> functions, and the story is the same for <code>to_string</code>, and so on...</p>
<p>Really, the underlying representation of an <code>Id</code> stays the same no matter how we use it. Instead, we'd like the context an <code>Id</code> is used in to determine whether it is valid or not.</p>
<pre><code>pub opaque type Id(a) {
    Id(Int)
}

pub fn new () -&gt; Id(a) {
    Id(0)
}
</code></pre>
<p>We've now redefined our <code>Id</code> type to include a type parameter, <code>a</code>, but notice how that parameter isn't used in the type's constructor: this is where the name <strong>phantom type</strong> comes from. The second  thing to notice is that our <code>new</code> function returns an id with that generic <code>a</code> parameter. This lets <em>callers of the function</em> determine what the type of <code>a</code> should be.</p>
<pre><code>let foo: Id(String)      = new()
let bar: Id(Float)       = new()
let baz: Id(Option(Int)) = new()
</code></pre>
<p>Now, <code>foo</code>, <code>bar</code>, and <code>baz</code> are all incompatible with each other. We couldn't check them for equality, for example, because the types don't match up. Fundamental to phantom types is the fact that there is no runtime component, <code>foo</code> may be annotated as <code>Id(String)</code> but no such string exists at runtime, the same for <code>Id(Float)</code> or any other parameter. </p>
<pre><code>foo == bar // Uh oh, compile error!
</code></pre>
<p>This is powerful because we gain the ability to tell the compiler a fact about a particular <code>Id</code>, and the compiler will do extra work to ensure we don't make any mistakes.</p>
<pre><code>pub type User {
    User(id: Id(User), name: String)
}

pub type Post {
    Post(id: Id(Post), content: String)
}

pub fn upvote_post (user_id: Id(User), post_id: Id(Post)) -&gt; Nil {
    // Get a post from the database and upvote it.
    ...
}
</code></pre>
<p>In the snippet above, we've defined <code>User</code> and <code>Post</code> types and parameterised the <code>Id</code> type accordingly. Knowing what we know so far about phantom types, we can see that the new type signature for <code>upvote_post</code> will prevent us from accidentally swapping the order of the ids.</p>
<pre><code>let user = User(id: new(), name: "pd-andy")
let post = Post(id: new(), content: "Phantom Types in Gleam...")

upvote_post(post.id, user.id) // Uh oh, compile error!
</code></pre>
<p>Even though our phantom type lets us specialise the <code>Id</code> type, we can still write functions that work on <em>all</em> ids by leaving the type parameter as a variable.</p>
<pre><code>pub fn show (id: Id(a)) -&gt; String {
    let Id(n) = id
    int.to_string(n)
}

show(user.id)
show(post.id)
</code></pre>
<p>The ability to restrict or open up functions to different <code>Id</code>s is where a lot of the power with phantom types comes from. </p>
<h2 id="example-two-handling-money">Example Two: Handling money.</h2>
<p>Let's consider another scenario. We want to build an application that can handle monetary transactions such that we can easily work with currencies of the same type, but different currencies must be explicitly converted via an exchange rate before they can be used together.</p>
<p>Similar to our id scenario, the underlying representation for a value of currency is always the same.</p>
<pre><code>pub opaque type Currency(a) {
  Currency(Float)
}

pub fn from_float (x: Float) -&gt; Currency(a) {
  Currency(x)
}
</code></pre>
<p>As before, our <code>Currency</code> type has a single type parameter that we'll use to <em>tag</em> values with a particular type of currency. We also need to define some types to act as our currency tags. Because these types are only used for annotations, we'll make them opaque. </p>
<pre><code>pub opaque type USD { USD }
pub opaque type GBP { GBP }
</code></pre>
<p>Now we can use everything we've defined so far to create some different currencies.</p>
<pre><code>let dollars: Currency(USD) = from_float(2.50)
let pennies: Currency(GBP) = from_float(0.55)
</code></pre>
<p>Right now we have some currency values, but we can't do a whole lot with them. While they're wrapped up in our <code>Currency</code> type, we can't use any arithmetic operators or pass these values to functions expecting <code>Float</code>s.</p>
<p>Let's remedy that by writing two functions, <code>update</code> and <code>combine</code>. We'll use <code>update</code> to apply a function to the value wrapped by a <code>Currency</code>, and we'll use <code>combine</code> to apply a function to two <code>Currency</code> values.</p>
<blockquote>
<p>üí° For other data structures these functions might be called <code>map</code> and <code>map2</code>. These imply the type can change, for example <code>list.map</code> can be used to turn a <code>List(a)</code> into a <code>List(b)</code>. </p>
<p>Because we want to preserve the type (so we can't convert <code>Currency(USD)</code> to <code>Currency(GBP)</code>) we give these functions different names so there aren't any mismatched expectations.</p>
</blockquote>
<pre><code>pub fn update (a: Currency(a), f: fn (Float) -&gt; Float) -&gt; Currency(a) {
  let Currency(x) = a
  x |&gt; f |&gt; from_float
}

pub fn combine (a: Currency(a), b: Currency(a), f: fn (Float, Float) -&gt; Float) -&gt; Currency(a) {
    let Currency(x) = a
    let Currency(y) = b
    f(x, y) |&gt; from_float
}
</code></pre>
<p>Because the type parameter for <code>Currency</code> doesn't change (these function take a <code>Currency(a)</code> and return a <code>Currency(a)</code>), they can't change the tag of any currency passed in.</p>
<blockquote>
<p>üí° Both <code>update</code> and <code>combine</code> are examples of <strong>higher-order functions</strong>.  That is, they are functions that take <em>other functions</em> as one of their arguments (or return a new function themselves).</p>
</blockquote>
<p>We can use these two functions to define some more functions so we can actually <em>do</em> things with currency values, like doubling something or adding two currencies together.</p>
<pre><code>pub fn double (a: Currency(a)) -&gt; Currency(a) {
    update(a, fn (x) { x * 2 })
}

pub fn add (a: Currency(a), b: Currency(a)) -&gt; Currency(a) {
    combine(a, b, fn (x, y) { x + y })
}
</code></pre>
<p>We can call these functions with any type of currency, but for something like <code>add</code> we get compile-time safety that ensures we only add two currencies of the same type.</p>
<pre><code>double(dollars)       //=&gt; from_float(5.00): Currency(USD)
add(pennies, pennies) //=&gt; from_float(1.10): Currency(GBP)

add(dollars, pennies) //=&gt; I won't compile!
</code></pre>
<p>But what if we <em>want</em> to add two currencies together? To do that we need a way of converting one currency to another with an exchange rate. We can use phantom types again here to define an</p>
<p><code>Exchange</code> type that describes the exchange rate from one currency to another.</p>
<pre><code>pub opaque type Exchange (from, to) {
    Exchange(Float)
}

pub fn exchange_rate (r: Float) -&gt; Exchange(from, to) {
    Exchange(r)
}
</code></pre>
<p>Now, just like we did for currencies, we can define an exchange rate to go from <code>GBP</code> to <code>USD</code> (and vice versa).</p>
<pre><code>let gbp_to_usd: Exchange(GBP, USD) = exchange_rate(1.41)
let usd_to_gbp: Exchange(USD, GBP) = exchange_rate(0.71)
</code></pre>
<p>Using everything we know about phantom types, we can define a <code>convert</code> function that is type safe; we'll never be able to pass in the wrong exchange rate because all the phantom types have to match up!</p>
<pre><code>pub fn convert (a: Currency(from), e: Exchange(from, to)) -&gt; Currency(to) {
    let Currency(x) = a
    let Exchange(r) = e
    x *. r |&gt; from_float
}
</code></pre>
<p>Although our module provided the <code>USD</code> and <code>GBP</code> types to act as currency tags, the functions we've written are general to all currencies but retain their type safety. If consumers of the module want to define another type of currency, they can do that and our functions will still work.</p>
<hr>
<h2 id="example-three-validating-data">Example Three: Validating data.</h2>
<p>So far the two examples we have seen in <code>Id</code> and <code>Currency</code> have been used to provide a general API across types ‚Ä¶</p></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://blog.pd-andy.dev/phantom-types-in-gleam">https://blog.pd-andy.dev/phantom-types-in-gleam</a></em></p>]]>
            </description>
            <link>https://blog.pd-andy.dev/phantom-types-in-gleam</link>
            <guid isPermaLink="false">hacker-news-small-sites-26284976</guid>
            <pubDate>Sat, 27 Feb 2021 14:17:31 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[A new chapter ‚Äì full-time working from a van in a forest]]>
            </title>
            <description>
<![CDATA[
Score 304 | Comments 229 (<a href="https://news.ycombinator.com/item?id=26284635">thread link</a>) | @ghuntley
<br/>
February 27, 2021 | https://ghuntley.com/a-new-chapter | <a href="https://web.archive.org/web/*/https://ghuntley.com/a-new-chapter">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
              <p>For many people, the year 2020 will go down as a moment in time of hardship in their lives but for me, the year 2019 was dramatically harder as it was the realization that a long-term relationship wasn't going to work out and that everyone, including my children, would be homeless within 14 days. <em>Oomph</em>.</p><figure><div><div><p><img src="https://ghuntley.com/content/images/2021/02/IMG_20191111_094714.jpg" width="2000" height="2667" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/IMG_20191111_094714.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/IMG_20191111_094714.jpg 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/IMG_20191111_094714.jpg 1600w, https://ghuntley.com/content/images/size/w2400/2021/02/IMG_20191111_094714.jpg 2400w" sizes="(min-width: 720px) 720px"></p><p><img src="https://ghuntley.com/content/images/2021/02/vlcsnap-2021-02-23-14h54m12s813.png" width="1920" height="1080" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/vlcsnap-2021-02-23-14h54m12s813.png 600w, https://ghuntley.com/content/images/size/w1000/2021/02/vlcsnap-2021-02-23-14h54m12s813.png 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/vlcsnap-2021-02-23-14h54m12s813.png 1600w, https://ghuntley.com/content/images/2021/02/vlcsnap-2021-02-23-14h54m12s813.png 1920w" sizes="(min-width: 720px) 720px"></p></div><div><p><img src="https://ghuntley.com/content/images/2021/02/2021-02-23_14-48-25-1.jpg" width="2000" height="769" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/2021-02-23_14-48-25-1.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/2021-02-23_14-48-25-1.jpg 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/2021-02-23_14-48-25-1.jpg 1600w, https://ghuntley.com/content/images/size/w2400/2021/02/2021-02-23_14-48-25-1.jpg 2400w" sizes="(min-width: 720px) 720px"></p><p><img src="https://ghuntley.com/content/images/2021/02/_95SAnmj.jpg-large-1.jpg" width="1536" height="2048" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/_95SAnmj.jpg-large-1.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/_95SAnmj.jpg-large-1.jpg 1000w, https://ghuntley.com/content/images/2021/02/_95SAnmj.jpg-large-1.jpg 1536w" sizes="(min-width: 720px) 720px"></p></div></div><figcaption>Over the course of five years more than $110,000 had been spent on rent at that dumpster of a house.&nbsp;</figcaption></figure><p>I packed all of my artefacts and office equipment into a u-haul and left everything else, including the family car to my now ex-wife. To cut a long story short the cost of housing in Sydney, Australia and sole-income was a leading factor in the dissolution of the relationship.</p><figure><img src="https://ghuntley.com/content/images/2021/02/image-1.png" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/image-1.png 600w, https://ghuntley.com/content/images/size/w1000/2021/02/image-1.png 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/image-1.png 1600w, https://ghuntley.com/content/images/2021/02/image-1.png 1896w" sizes="(min-width: 720px) 720px"><figcaption>https://www.theguardian.com/australia-news/2018/mar/15/sydney-more-expensive-to-live-in-than-london-and-new-york-study-finds</figcaption></figure><p>I'm doing excellent, <em>now</em>, but back then the entire experience left me shattered, soul destroyed and burnt out beyond belief. Luckily an el-rando, now friend, saw that I was in need and reached out:</p><blockquote>"Heading camping to Stradbroke week after next if you want to totally unplug. <strong>If you need anything, let me know</strong>."</blockquote><p>I just want to say, thank-you. I needed that. </p><p>Dear reader, if you ever find yourself in crisis or a situation similar to mine please do not hesitate to <a href="https://ghuntley.com/contact">contact me</a> if you need a shoulder or advice. You deserve to live a life that makes you happy and not miserable.</p><p>People often ask me what got you interested in #vanlife, now you know. It wasn't an interest as-per-say but more of a necessity and a key ingredient to ensuring my children would grow up with a father in their lives. </p><p>I first heard about the concept of #vanlife back in 2015 after reading this article about a <a href="https://jalopnik.com/google-software-engineer-lives-in-a-van-to-avoid-san-fr-1737619550">Google employee who lived in a box-truck in the company's parking lot</a>:</p><blockquote>‚ÄúI realized I was paying an exorbitant amount of money for the apartment I was staying in ‚Äî and I was almost never home,‚Äù he says. ‚ÄúIt‚Äôs really hard to justify throwing that kind of money away. You‚Äôre essentially burning it ‚Äî you‚Äôre not putting equity in anything and you‚Äôre not building it up for a future ‚Äî and that was really hard for me to reconcile"</blockquote><p>The events that followed the Stradbroke camping trip put me on a path towards thinking about okay, what-next and how will I get there? Fast-forward a couple of months later I found myself on my own month-long camping trip down in Tasmania where I learned some important life lessons, bushcraft skills and met some <a href="https://www.onemanonebikeoneworld.com/2015/10/australia-at-home-in-crunchy-town/">interesting characters</a>, some of whom were living #vanlife.</p><figure><div><div><p><img src="https://ghuntley.com/content/images/2021/02/93956755_10157390553498505_8259160674995798016_o.jpg" width="1438" height="772" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/93956755_10157390553498505_8259160674995798016_o.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/93956755_10157390553498505_8259160674995798016_o.jpg 1000w, https://ghuntley.com/content/images/2021/02/93956755_10157390553498505_8259160674995798016_o.jpg 1438w" sizes="(min-width: 720px) 720px"></p><p><img src="https://ghuntley.com/content/images/2021/02/1-dLCs9WWLvE1Goul018u-Jg-1.jpeg" width="2000" height="2872" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/1-dLCs9WWLvE1Goul018u-Jg-1.jpeg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/1-dLCs9WWLvE1Goul018u-Jg-1.jpeg 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/1-dLCs9WWLvE1Goul018u-Jg-1.jpeg 1600w, https://ghuntley.com/content/images/2021/02/1-dLCs9WWLvE1Goul018u-Jg-1.jpeg 2162w" sizes="(min-width: 720px) 720px"></p><p><img src="https://ghuntley.com/content/images/2021/02/IMG_20200222_091110.jpg" width="2000" height="1500" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/IMG_20200222_091110.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/IMG_20200222_091110.jpg 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/IMG_20200222_091110.jpg 1600w, https://ghuntley.com/content/images/size/w2400/2021/02/IMG_20200222_091110.jpg 2400w" sizes="(min-width: 720px) 720px"></p></div><div><p><img src="https://ghuntley.com/content/images/2021/02/2021-02-23_14-15-36.jpg" width="2000" height="914" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/2021-02-23_14-15-36.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/2021-02-23_14-15-36.jpg 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/2021-02-23_14-15-36.jpg 1600w, https://ghuntley.com/content/images/size/w2400/2021/02/2021-02-23_14-15-36.jpg 2400w" sizes="(min-width: 720px) 720px"></p><p><img src="https://ghuntley.com/content/images/2021/02/2021-02-23_14-14-28.jpg" width="2000" height="872" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/2021-02-23_14-14-28.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/2021-02-23_14-14-28.jpg 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/2021-02-23_14-14-28.jpg 1600w, https://ghuntley.com/content/images/size/w2400/2021/02/2021-02-23_14-14-28.jpg 2400w" sizes="(min-width: 720px) 720px"></p><p><img src="https://ghuntley.com/content/images/2021/02/2021-02-23_14-18-14.jpg" width="2000" height="856" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/2021-02-23_14-18-14.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/2021-02-23_14-18-14.jpg 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/2021-02-23_14-18-14.jpg 1600w, https://ghuntley.com/content/images/size/w2400/2021/02/2021-02-23_14-18-14.jpg 2400w" sizes="(min-width: 720px) 720px"></p></div><div><p><img src="https://ghuntley.com/content/images/2021/02/IMG_20200308_082035-1.jpg" width="2000" height="1500" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/IMG_20200308_082035-1.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/IMG_20200308_082035-1.jpg 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/IMG_20200308_082035-1.jpg 1600w, https://ghuntley.com/content/images/size/w2400/2021/02/IMG_20200308_082035-1.jpg 2400w" sizes="(min-width: 720px) 720px"></p><p><img src="https://ghuntley.com/content/images/2021/02/Alana-Una-Divine.jpg" width="960" height="720" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/Alana-Una-Divine.jpg 600w, https://ghuntley.com/content/images/2021/02/Alana-Una-Divine.jpg 960w" sizes="(min-width: 720px) 720px"></p><p><img src="https://ghuntley.com/content/images/2021/02/26756404_10155262413212066_7256284448836424591_o.jpg" width="1440" height="1080" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/26756404_10155262413212066_7256284448836424591_o.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/26756404_10155262413212066_7256284448836424591_o.jpg 1000w, https://ghuntley.com/content/images/2021/02/26756404_10155262413212066_7256284448836424591_o.jpg 1440w" sizes="(min-width: 720px) 720px"></p></div></div></figure><p>I was amazed at the quality of life these people had, how they were able to make ends meet and their resourcefulness. They also knew how to have a freaking good time...</p><figure><iframe width="200" height="113" src="https://www.youtube.com/embed/umxjUjqRdOY?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></figure><p>Over the course of a month, a small group of people <a href="https://www.google.com.au/maps/place/41%C2%B018'37.0%22S+147%C2%B047'54.2%22E/@-41.3102818,147.7966608,555m/data=!3m2!1e3!4b1!4m14!1m7!3m6!1s0xaa775776abb20549:0x403c94dd0ddf450!2sScottsdale+TAS+7260,+Australia!3b1!8m2!3d-41.166667!4d147.516667!3m5!1s0x0:0x0!7e2!8m2!3d-41.3102849!4d147.7983983">camping on crown land</a> grew to over 500 people. Love was free and it was custom to hug <em>everyone</em>. Meanwhile, in a parallel universe, this was happening...</p><figure><div><div><p><img src="https://ghuntley.com/content/images/2021/02/IMG_20200324_154236.jpg" width="1386" height="1848" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/IMG_20200324_154236.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/IMG_20200324_154236.jpg 1000w, https://ghuntley.com/content/images/2021/02/IMG_20200324_154236.jpg 1386w" sizes="(min-width: 720px) 720px"></p><p><img src="https://ghuntley.com/content/images/2021/02/IMG_20200324_153304_MP.jpg" width="1386" height="1848" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/IMG_20200324_153304_MP.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/IMG_20200324_153304_MP.jpg 1000w, https://ghuntley.com/content/images/2021/02/IMG_20200324_153304_MP.jpg 1386w" sizes="(min-width: 720px) 720px"></p></div></div></figure><p>With the new-found knowledge and experiences, I flew back to sunny Queensland, Australia and started my research. After watching hundreds of hours of videos on YouTube I found this video, which to this day, represents my north star:</p><figure><iframe width="200" height="113" src="https://www.youtube.com/embed/l-DgMYB6L0c?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></figure><p>Over the months that followed through 2020, my father and mother helped make the dream a reality. I never wanted to live in Sydney, Australia ever again, yet, much to my dismay, my children would remain living in a city that makes no sense. Putting together a van was a major step in getting my life back on track and ensuring that my children would know their father.</p><figure><div><div><p><img src="https://ghuntley.com/content/images/2021/02/IMG_20200402_162953.jpg" width="300" height="225" alt=""></p><p><img src="https://ghuntley.com/content/images/2021/02/IMG_20200419_112842.jpg" width="2000" height="1500" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/IMG_20200419_112842.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/IMG_20200419_112842.jpg 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/IMG_20200419_112842.jpg 1600w, https://ghuntley.com/content/images/size/w2400/2021/02/IMG_20200419_112842.jpg 2400w" sizes="(min-width: 720px) 720px"></p><p><img src="https://ghuntley.com/content/images/2021/02/IMG_20200701_112931.jpg" width="1386" height="1848" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/IMG_20200701_112931.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/IMG_20200701_112931.jpg 1000w, https://ghuntley.com/content/images/2021/02/IMG_20200701_112931.jpg 1386w" sizes="(min-width: 720px) 720px"></p></div><div><p><img src="https://ghuntley.com/content/images/2021/02/PXL_20201128_062424513.jpg" width="2000" height="1500" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/PXL_20201128_062424513.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/PXL_20201128_062424513.jpg 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/PXL_20201128_062424513.jpg 1600w, https://ghuntley.com/content/images/size/w2400/2021/02/PXL_20201128_062424513.jpg 2400w" sizes="(min-width: 720px) 720px"></p><p><img src="https://ghuntley.com/content/images/2021/02/PXL_20201204_222041572.MP.jpg" width="1386" height="1848" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/PXL_20201204_222041572.MP.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/PXL_20201204_222041572.MP.jpg 1000w, https://ghuntley.com/content/images/2021/02/PXL_20201204_222041572.MP.jpg 1386w" sizes="(min-width: 720px) 720px"></p></div><div><p><img src="https://ghuntley.com/content/images/2021/02/IMG_20200919_094643.jpg" width="1386" height="1848" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/IMG_20200919_094643.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/IMG_20200919_094643.jpg 1000w, https://ghuntley.com/content/images/2021/02/IMG_20200919_094643.jpg 1386w" sizes="(min-width: 720px) 720px"></p><p><img src="https://ghuntley.com/content/images/2021/02/PXL_20201204_011641497.jpg" width="1386" height="1848" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/PXL_20201204_011641497.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/PXL_20201204_011641497.jpg 1000w, https://ghuntley.com/content/images/2021/02/PXL_20201204_011641497.jpg 1386w" sizes="(min-width: 720px) 720px"></p></div></div></figure><p>It's now 2021, I'm doing better than I was in the relationship and my children are having more <em>quality time</em> with their father than they have ever had. Over the last 12 months during various stages of the van kit-out, my kids and I have been going away on overnight, weekend and school holiday adventures where they get to experience the sights and sounds of Australia.</p><figure><div><div><p><img src="https://ghuntley.com/content/images/2021/02/PXL_20210103_102322442.PORTRAIT-2.jpg" width="2000" height="1500" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/PXL_20210103_102322442.PORTRAIT-2.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/PXL_20210103_102322442.PORTRAIT-2.jpg 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/PXL_20210103_102322442.PORTRAIT-2.jpg 1600w, https://ghuntley.com/content/images/size/w2400/2021/02/PXL_20210103_102322442.PORTRAIT-2.jpg 2400w" sizes="(min-width: 720px) 720px"></p><p><img src="https://ghuntley.com/content/images/2021/02/PXL_20210103_095904261.PORTRAIT.jpg" width="1386" height="1848" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/PXL_20210103_095904261.PORTRAIT.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/PXL_20210103_095904261.PORTRAIT.jpg 1000w, https://ghuntley.com/content/images/2021/02/PXL_20210103_095904261.PORTRAIT.jpg 1386w" sizes="(min-width: 720px) 720px"></p><p><img src="https://ghuntley.com/content/images/2021/02/PXL_20210103_100004979.PORTRAIT.jpg" width="1386" height="1848" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/PXL_20210103_100004979.PORTRAIT.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/PXL_20210103_100004979.PORTRAIT.jpg 1000w, https://ghuntley.com/content/images/2021/02/PXL_20210103_100004979.PORTRAIT.jpg 1386w" sizes="(min-width: 720px) 720px"></p></div></div></figure><p>On the relationship front, I'm pleased to share that there has been minimal conflict and day-by-day we each learn to love and respect each other as the parents of our children. A large part of that is due to some early advice I received from a man who had also recently divorced:</p><blockquote>It will all work out. Just keep the focus on the kids and relationship will improve. We're at the stage where my ex will come around and have drinks with my girlfriend and I. You have drop everything (hurt, money, etc) from before on the floor and move past it. You'll be much happier.</blockquote><p>To that person, thank you for sharing your perspectives and advice on how to ensure that, unlike you see in the movies, co-parenting does not need to be adversarial.</p><figure><img src="https://ghuntley.com/content/images/2021/02/image-2.png" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/image-2.png 600w, https://ghuntley.com/content/images/size/w1000/2021/02/image-2.png 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/image-2.png 1600w, https://ghuntley.com/content/images/size/w2400/2021/02/image-2.png 2400w" sizes="(min-width: 720px) 720px"></figure><div><p>So, in summary - everything has been going well but there was still one thing left to resolve:</p><p>‚úîÔ∏è housing.<br>‚úîÔ∏è conflict free co-parenting.<br>‚úîÔ∏è children having quality time with their father.<br>üöß <em>meaningful </em>work</p></div><p>Approx 21% to 35% of our time awake is spent at work and every two years that goes by at a company you don't like (or unemployed) is wasting 2% of your working life. Time is valuable and there are no guarantees that tomorrow will come thus it is exceedinly important for happiness that you find work that is <em>meaningful and that treats you well</em>.</p><figure><iframe width="200" height="113" src="https://www.youtube.com/embed/mQkBnS4OOqU?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><figcaption>One of my first employers had meaningful work but didn't treat people well.&nbsp;</figcaption></figure><p>Work keeps us busy. &nbsp;It gives us structure, it defines us as functioning, contributing, worthwhile citizens. &nbsp;It makes us part of the team, a community of fellow workers ‚Äî even if we do our work remotely in isolation. </p><h2 id="meaningful-work">meaningful work</h2><p>Pause for a moment and think about this...</p><blockquote>What brings meaning into your life? </blockquote><p>After what I had been through in 2019 I spent a considerable amount of time in 2020 thinking about the above question. </p><p>The clock rolled over to 2021 and fortunately I have answers to the above question, a kick-ass van but what good is a van if you can't go on adventures and work remotely from it indefinitely?</p><figure><div><div><p><img src="https://ghuntley.com/content/images/2021/02/PXL_20201217_041851644.jpg" width="2000" height="1500" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/PXL_20201217_041851644.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/PXL_20201217_041851644.jpg 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/PXL_20201217_041851644.jpg 1600w, https://ghuntley.com/content/images/size/w2400/2021/02/PXL_20201217_041851644.jpg 2400w" sizes="(min-width: 720px) 720px"></p><p><img src="https://ghuntley.com/content/images/2021/02/PXL_20201214_034618899.jpg" width="1386" height="1848" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/PXL_20201214_034618899.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/PXL_20201214_034618899.jpg 1000w, https://ghuntley.com/content/images/2021/02/PXL_20201214_034618899.jpg 1386w" sizes="(min-width: 720px) 720px"></p></div><div><p><img src="https://ghuntley.com/content/images/2021/02/PXL_20201214_034540072.jpg" width="1386" height="1848" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/PXL_20201214_034540072.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/PXL_20201214_034540072.jpg 1000w, https://ghuntley.com/content/images/2021/02/PXL_20201214_034540072.jpg 1386w" sizes="(min-width: 720px) 720px"></p><p><img src="https://ghuntley.com/content/images/2021/02/PXL_20201214_034733334.MP.jpg" width="290" height="218" alt=""></p></div></div><figcaption>This is my office, as it is now. The interior design is temporary.</figcaption></figure><p>So anyway, I've got some news... </p><p>The founders of Gitpod recently approached me about joining them and it was a no-brainer. I have joined <a href="https://gitpod.io/?utm_medium=website&amp;utm_campaign=meaningful-work&amp;utm_source=ghuntley">Gitpod</a>. üéâ</p><p>The company is remote-first (‚úîÔ∏è), embraces asyncrony (‚úîÔ∏è), filled with brilliant people (‚úîÔ∏è), the product is open-source (‚úîÔ∏è) and built on GitHub (‚úîÔ∏è) using the light weight Visual Studio code process (‚úîÔ∏è). </p><figure><blockquote><p lang="en" dir="ltr">I was pitching the VSCode development process, with its 1-month release cycle to an open source project this morning.<br>All projects could benefit from embracing this model: <a href="https://t.co/ymkVy0OBoD">https://t.co/ymkVy0OBoD</a></p>‚Äî Miguel de Icaza (@migueldeicaza) <a href="https://twitter.com/migueldeicaza/status/1364582599000260615?ref_src=twsrc%5Etfw">February 24, 2021</a></blockquote>

</figure><p>Gitpod has been a meaningful and key piece of software in my toolkit over the last couple years because Gitpod enables me to develop on any device from anywhere. I can hop between pull-requests with a single click and there's no waiting because <a href="https://www.gitpod.io/docs/prebuilds/">the pull-request has already been pre-compiled</a>. </p><figure><iframe width="200" height="150" src="https://www.youtube.com/embed/KR8ESjGYsXI?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></figure><p>Gitpod has enabled me to standardize development environments between people and, like docker, move to ephemeral instances so that I never experience "but it works on my machine" ever again.</p><p>I could talk for hours on end on how meaningful the work Gitpod is doing and how it makes it easier for open-source maintainers to onboard new contributors to their project but it's better that you just <em><a href="https://gitpod.io/#https://github.com/gitpod-io/website/">experience it for yourself</a></em>.</p><figure><a href="https://gitpod.io/#https://github.com/gitpod-io/website/"><div><p>Gitpod ‚Äì Dev environments built for the cloud</p><p>Gitpod streamlines developer workflows by providing prebuilt, collaborative development environments in your browser ‚Äì powered by VS Code.</p><p><img src="https://gitpod.io/images/gitpod-196x196.png"></p></div><p><img src="https://www.gitpod.io/media-image.jpg"></p></a><figcaption>Try Gitpod for yourself by mashing the above link!</figcaption></figure><figure><img src="https://ghuntley.com/content/images/2021/02/image-3.png" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/image-3.png 600w, https://ghuntley.com/content/images/size/w1000/2021/02/image-3.png 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/image-3.png 1600w, https://ghuntley.com/content/images/size/w2400/2021/02/image-3.png 2400w" sizes="(min-width: 720px) 720px"><figcaption>Visit https://gitpod.io/#https://github.com/gitpod-io/website/ in your browser</figcaption></figure><p>So, that's the news. Things are doing really well. I want to say thank-you for those whom <a href="https://ghuntley.com/support">have supported me</a> over the last couple years whilst I figured this all out.</p><p>This chapter is only just beginning. I'm blogging more and <a href="https://twitter.com/geoffreyhuntley">tweeting less</a> so if you want to learn about sweet places to visit in Australia, working remotely from a van or how I get internet whilst camping out in a remote forest, like, <a href="https://ghuntley.com/signup/">subscribe</a> (free) and enter your email address to be notified when future blog posts ship.</p><figure><blockquote><p lang="en" dir="ltr">Have some personal news and an exciting announcement to share with you...<a href="https://t.co/BbKl6cWKeO">https://t.co/BbKl6cWKeO</a></p>‚Äî *void malloc(geoff, üê£) (@GeoffreyHuntley) <a href="https://twitter.com/GeoffreyHuntley/status/1365067454494351364?ref_src=twsrc%5Etfw">February 25, 2021</a></blockquote>

</figure><figure><div><div><p><img src="https://ghuntley.com/content/images/2021/02/2021-02-12_7-03-15-1.jpg" width="2000" height="863" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/2021-02-12_7-03-15-1.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/2021-02-12_7-03-15-1.jpg 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/2021-02-12_7-03-15-1.jpg 1600w, https://ghuntley.com/content/images/size/w2400/2021/02/2021-02-12_7-03-15-1.jpg 2400w" sizes="(min-width: 720px) 720px"></p><p><img src="https://ghuntley.com/content/images/2021/02/2021-02-12_6-51-28-1.jpg" width="2000" height="875" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/2021-02-12_6-51-28-1.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/2021-02-12_6-51-28-1.jpg 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/2021-02-12_6-51-28-1.jpg 1600w, https://ghuntley.com/content/images/size/w2400/2021/02/2021-02-12_6-51-28-1.jpg 2400w" sizes="(min-width: 720px) 720px"></p><p><img src="https://ghuntley.com/content/images/2021/02/Photo_6553666_DJI_66_jpg_21669666_0_2020122385728_photo_original-2.jpg" width="1980" height="1485" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/Photo_6553666_DJI_66_jpg_21669666_0_2020122385728_photo_original-2.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/Photo_6553666_DJI_66_jpg_21669666_0_2020122385728_photo_original-2.jpg 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/Photo_6553666_DJI_66_jpg_21669666_0_2020122385728_photo_original-2.jpg 1600w, https://ghuntley.com/content/images/2021/02/Photo_6553666_DJI_66_jpg_21669666_0_2020122385728_photo_original-2.jpg 1980w" sizes="(min-width: 720px) 720px"></p></div><div><p><img src="https://ghuntley.com/content/images/2021/02/2021-02-12_7-00-57-1.jpg" width="2000" height="877" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/2021-02-12_7-00-57-1.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/2021-02-12_7-00-57-1.jpg 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/2021-02-12_7-00-57-1.jpg 1600w, https://ghuntley.com/content/images/size/w2400/2021/02/2021-02-12_7-00-57-1.jpg 2400w" sizes="(min-width: 720px) 720px"></p><p><img src="https://ghuntley.com/content/images/2021/02/Photo_6554005_DJI_405_jpg_6288768_0_202121019728_photo_original-PANO-2.jpg" width="2000" height="1007" alt="" srcset="https://ghuntley.com/content/images/size/w600/2021/02/Photo_6554005_DJI_405_jpg_6288768_0_202121019728_photo_original-PANO-2.jpg 600w, https://ghuntley.com/content/images/size/w1000/2021/02/Photo_6554005_DJI_405_jpg_6288768_0_202121019728_photo_original-PANO-2.jpg 1000w, https://ghuntley.com/content/images/size/w1600/2021/02/Photo_6554005_DJI_405_jpg_6288768_0_202121019728_photo_original-PANO-2.jpg 1600w, https://ghuntley.com/content/images/size/w2400/2021/02/Photo_6554005_DJI_405_jpg_6288768_0_202121019728_photo_original-PANO-2.jpg 2400w" sizes="(min-width: 720px) 720px"></p></div></div></figure>
            </div></div>]]>
            </description>
            <link>https://ghuntley.com/a-new-chapter</link>
            <guid isPermaLink="false">hacker-news-small-sites-26284635</guid>
            <pubDate>Sat, 27 Feb 2021 13:11:53 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[A Vim Guide for Advanced Users]]>
            </title>
            <description>
<![CDATA[
Score 577 | Comments 170 (<a href="https://news.ycombinator.com/item?id=26284618">thread link</a>) | @asicsp
<br/>
February 27, 2021 | https://thevaluable.dev/vim-advanced/ | <a href="https://web.archive.org/web/*/https://thevaluable.dev/vim-advanced/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div role="main">
    <article>
        

        <section>
            
                <picture>
                    
                        <source srcset="https://thevaluable.dev/images/2021/02_vim_advanced/vim-advanced.webp" type="image/webp">
                    
                    <img src="https://thevaluable.dev/images/2021/02_vim_advanced/vim-advanced.jpg" alt="Vim for advanced users">
                </picture>
            

            <p>Welcome to the third part of this series aimed to help you unleash a power never seen on Earth using the Almighty Vim. If you don‚Äôt understand what‚Äôs happening in this article, I recommend you to read the previous ones of the series first:</p>
<ol>
<li><a href="https://thevaluable.dev/vim-beginner/">Vim for beginners</a></li>
<li><a href="https://thevaluable.dev/vim-intermediate/">Vim for intermediate users</a></li>
</ol>
<p>We‚Äôll see together in this article:</p>
<ul>
<li>Some nice keystrokes beginning with <code>g</code>.</li>
<li>What ranges are and how to use them.</li>
<li>The quickfix list and the location lists.</li>
<li>The marvelous substitute command.</li>
<li>The crazy useful <code>:global</code> (or <code>:g</code>) command.</li>
<li>What marks are and what you can do with them.</li>
<li>How to increase and decrease numbers with a single keystroke.</li>
<li>How to sort text with a nice command.</li>
</ul>
<p>But before going into the juicy content of this article, I‚Äôve some recommendations for you, dear reader:</p>
<ol>
<li>Fire up your Vim and play around with the commands and keystrokes while reading. It‚Äôs the best way for you to remember everything which blew you away. You‚Äôll then be able to be blown away whenever you like for the rest of your life.</li>
<li>Don‚Äôt use a cheatsheet; write your own as you read. It will allow you to come back easily to the commands you find the most useful for <em>your own needs</em>.</li>
</ol>
<p>Enough rambling. Let‚Äôs begin!</p>
<h2 id="useful-g-keystrokes">Useful ‚Äúg‚Äù Keystrokes</h2>
<p>Let‚Äôs begin gently with a mixed bag of keystrokes starting with <code>g</code>. There are many of these ‚Äúg‚Äù commands in Vim, and we already saw some of them in the previous articles. Can you recall them?</p>
<p>You can use these keystrokes in NORMAL mode:</p>
<ul>
<li><code>gf</code> - Edit the file located at the filepath under your cursor.
<ul>
<li>You can use <code>CTRL+W CTRL+F</code> to open the file in a new window.</li>
<li>It can open the URL under your cursor if you have the plugin <code>netrw</code>.</li>
</ul>
</li>
<li><code>gx</code> - Open the file located at the filepath under your cursor.
<ul>
<li>It will use the default application used by your OS for this filetype.</li>
<li>It works with URLs too. It will open your favorite browser and load the website.</li>
<li>It only works if you have the plugin <code>netrw</code>.</li>
</ul>
</li>
<li><code>gi</code> - Move to the last insertion you did and switch to INSERT mode.
<ul>
<li>Pretty useful if you stopped your editing to look at some other file.</li>
<li>It uses marks under the hood: more on that later in this article.</li>
</ul>
</li>
<li><code>gv</code> - Start VISUAL mode and use the selection made during the last VISUAL mode.</li>
<li><code>gn</code> - Select the match of your last search:
<ol>
<li>Move to the last searched match.</li>
<li>Switch to VISUAL mode (if you weren‚Äôt in VISUAL mode already).</li>
<li>Select the match.</li>
<li>You can continue to hit <code>n</code> (or <code>gn</code>) to select the area between the current match and the next match.</li>
</ol>
</li>
<li><code>gI</code> - Insert text at the beginning of the line, no matter what the first characters are.
<ul>
<li>The keystroke <code>I</code> insert text <em>just before the first non-blank characters</em> of the line.</li>
</ul>
</li>
</ul>
<p>To try out <code>gf</code> and <code>gx</code>, you can write for example <code>https://www.google.com/</code> in Vim, place your cursor on it, and hit the keystrokes. Don‚Äôt forget the trailing slash in your URL.</p>
<p>You‚Äôll soon discover an inconvenience with <code>gx</code>: when you use it on a filepath, Vim will hang till you close the file. That‚Äôs why I‚Äôve created the following mapping you can add to your <code>.vimrc</code>:</p>
<pre><code>nnoremap gX :silent :execute
            \ "!xdg-open" expand('%:p:h') . "/" . expand("&lt;cfile&gt;") " &amp;"&lt;cr&gt;
</code></pre><p>It maps the keystroke <code>gX</code> to use <code>xdg-open</code>  with the filepath under your cursor. It will open the file with your favorite application <em>in the background</em>. The program <code>xdg-open</code> will only work on Linux-based systems; for MacOS, try <code>open</code> instead.</p>


  




    





  





<h2 id="ranges">Ranges</h2>
<p>Now that we‚Äôre done with the appetizers, let‚Äôs discover the first real dish of our Vim feast: the ranges. You can apply them to many commands, making them terribly powerful.</p>
<h3 id="basics">Basics</h3>
<p>In Vim‚Äôs help, every command accepting a range will have the string of characters <code>[range]</code> in front of them. Multiple line specifiers are possible, separated by commas <code>,</code>.</p>
<p>Here are the most interesting ranges you can use:</p>
<ul>
<li><code>&lt;number&gt;</code> - Any number <code>&lt;number&gt;</code> in your range refers to a line number.</li>
<li><code>.</code> - Represent the current line (often the default range).</li>
<li><code>$</code> - Represent the last line of the current buffer.</li>
<li><code>%</code> - Represent the entire file (same as <code>1,$</code>).</li>
<li><code>*</code> - Use the last selection you‚Äôve made during the last VISUAL mode.</li>
</ul>
<p>For example, using the command <code>:d</code>:</p>
<ul>
<li><code>:1,40d</code> - Delete line 1 to 40 included.</li>
<li><code>:2,$d</code> - Delete every line from the second one till the end of the file.</li>
<li><code>:.,$d</code> - Delete every line from the current one till the end of the file.</li>
<li><code>:%d</code> - Delete every line.</li>
</ul>
<p>You can also do some arithmetic with ranges if you want. For example, let‚Äôs imagine your cursor is on the line 60: the range <code>.,.+10</code> will be equivalent to the range <code>60,70</code>.</p>
<h3 id="visual-mode-and-range">Visual Mode and Range</h3>
<p>If you switch to COMMAND-LINE mode after doing some selection in VISUAL mode, you‚Äôll see these two symbols appearing: <code>'&lt;</code> and <code>'&gt;</code> with a comma <code>,</code> in between. This is a range too!</p>
<p>The symbols <code>'&lt;</code> represents the first line you‚Äôve selected and <code>'&gt;</code> the last line. Each of these are marks; again, we‚Äôll see more about marks below.</p>
<p>In practice, the ranges <code>'&lt;,'&gt;</code> and <code>*</code> are synonym, but you‚Äôll have more flexibility with the first. For example, you can execute a command from the first line you‚Äôve selected till the end of the file with the range <code>'&lt;,$</code>.</p>


  




    





  

<div>
    
    <div>
         <ul>
<li><code>:help [range]</code></li>
<li><code>:help v_:</code></li>
<li><code>:help '&lt;</code></li>
<li><code>:help '&gt;</code></li>
</ul>
 
    </div>
</div>



<h2 id="vims-quickfix-and-location-list">Vim‚Äôs Quickfix And Location List</h2>
<p>Now, let‚Äôs talk about a very useful data structure available in Vim, the quickfix list.</p>
<p>Don‚Äôt confuse the quickfix list and the quickfix window: these are two different entities. The first is a data structure, the second can display this data structure.</p>
<h3 id="quickfix-lists">Quickfix Lists</h3>
<p>You can think of a quickfix list as a set of positions in one or multiple files.</p>
<h4 id="basics-1">Basics</h4>
<p>Let‚Äôs take an example: what happens if you run the command <code>:vimgrep hello *</code>?</p>
<ol>
<li>It will search the pattern ‚Äúhello‚Äù in every file of your working directory.</li>
<li>It will populate a quickfix list with every position matching your pattern ‚Äúhello‚Äù.</li>
<li>It will move your cursor to the first position of the quickfix list.</li>
</ol>
<p>If you want to know more about vimgrep and other tools you can search with, I <a href="https://thevaluable.dev/vim-search-find-replace/">wrote an article about that</a>. Other commands (like <code>:make</code> or <code>:grep</code>) also populate automatically a quickfix list.</p>
<p>Let‚Äôs expand the mystery around marks: these positions in the quickfix list are in fact hidden mark!</p>
<p>The quickfix list is often used to display specific errors in a codebase, often spit out from a compiler or a linter (via the command <code>:make</code> for example), but not only, as we just saw. I call the entries of a quickfix list ‚Äúpositions‚Äù to be more general, but sometimes Vim‚Äôs help will refer to them as ‚Äúerrors‚Äù. Don‚Äôt be confused: it‚Äôs the same idea.</p>
<p>Among other conditions, a quickfix list entry needs to have a filename for you to be able to jump to its position. Otherwise, the entry doesn‚Äôt point to anything. Difficult to move to anything.</p>
<h4 id="useful-commands">Useful Commands</h4>
<p>Here are the commands you can use to navigate through the current quickfix list:</p>
<ul>
<li><code>:cl</code> or <code>:clist</code> - Display all valid entries of the current quickfix list. You can add a range as argument (only numbers).</li>
<li><code>:cc &lt;number&gt;</code> - Move to the <code>&lt;number&gt;</code>th entry of the current quickfix list.</li>
<li><code>:cnext</code> or <code>:cn</code> - Move to the next entry of the current quickfix list.</li>
<li><code>:cprevious</code> or <code>:cp</code> - Move to the previous entry of the current quickfix list.</li>
<li><code>:cfirst</code> or <code>:cfir</code> - Move to the first entry of the current quickfix list.</li>
<li><code>:clast</code> or <code>:clas</code> - Move to the last entry of the current quickfix list.</li>
</ul>
<p>Here are additional commands which make quickfix lists really powerful:</p>
<ul>
<li><code>:cdo &lt;cmd&gt;</code> - Execute a command <code>&lt;cmd&gt;</code> on each valid entry of the current quickfix list.</li>
<li><code>:cexpr &lt;expr&gt;</code> or <code>:cex &lt;expr&gt;</code> - Create a quickfix list using the result of evaluating the Vimscript expression <code>&lt;expr&gt;</code>.</li>
<li><code>:caddexpr &lt;expr&gt;</code> or <code>:cadde &lt;expr&gt;</code> - Appends the result of evaluating the Vimscript expression <code>&lt;expr&gt;</code> to the current quickfix list.</li>
</ul>
<p>If you have no clue how to use the last two commands, you can do for example:</p>
<ul>
<li><code>:cex []</code> - Empty the current quickfix list.</li>
<li><code>:cex system("&lt;cmd&gt;")</code> - Populate your quickfix list with any shell command <code>&lt;cmd&gt;</code>. You can try it with <code>ls</code> for example.</li>
</ul>
<h3 id="the-quickfix-window">The Quickfix Window</h3>
<p>What about displaying the current quickfix list in a new buffer? You can do that with the following command:</p>
<ul>
<li><code>:copen</code> or <code>:cope</code> - Open a window (with a special buffer) to show the current quickfix list.</li>
</ul>
<p>You can only have one quickfix window open. To move to the position of the selected entry of the quickfix list in the quickfix window, hit <code>ENTER</code> or <code>.cc</code>.</p>
<h3 id="location-lists">Location Lists</h3>
<p>A location list is similar to a quickfix list, except that the first is local to a window and the second is global to your Vim instance. In other words, you can have multiple location lists available at the same time (one per window open), but you can only have access to one quickfix list.</p>
<p>The commands for location lists are similar to the ones for the quickfix lists; often, you‚Äôll only have to replace the first <code>c</code> (qui<code>c</code>fix) of the command with <code>l</code> (<code>l</code>ocation).</p>
<p>For example:</p>
<ul>
<li><code>:lli</code> or <code>:llist</code> - Display all valid entries of the current location list. You can add a range as argument (only numbers).</li>
<li><code>:ll &lt;number&gt;</code> - Move to the entry <code>&lt;number&gt;</code> of the current location list.</li>
<li><code>:lnext</code> or <code>:lne</code> - Move to the next entry of the current quickfix list.</li>
</ul>
<p>To populate your location list you can also use the commands <code>:lvimgrep</code> or <code>:lmake</code> for example.</p>
<p>Often, Vim users will use the quickfix list for anything related to errors in their codebase, and the location list for search results. But it‚Äôs up to you at the end of the day. With Vim, you‚Äôre the master of your destiny.</p>


  




    





  

<div>
    
    <div>
         <ul>
<li><code>:help quickfix</code></li>
<li><code>:help quickfix-window</code></li>
<li><code>:help location-list</code></li>
<li><code>:help location-list-window</code></li>
<li><code>:help expr</code></li>
<li><code>:help system()</code></li>
</ul>
 
    </div>
</div>



<h2 id="vims-registers">Vim‚Äôs Registers</h2>
<p>The registers are another big dish in our Vim feast. You can think of registers as places where you can read or write some text. I like to think about them as Vim‚Äôs clipboards.</p>
<h3 id="specifying-a-register">Specifying a Register</h3>
<p>Here‚Äôs a command and a NORMAL mode keystroke to display and <em>specify</em> registers:</p>
<ul>
<li><code>:registers</code> or <code>:reg</code> - Display the content of your registers.</li>
<li><code>"&lt;reg&gt;</code> - This keystroke <em>specif‚Ä¶</em></li></ul></section></article></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://thevaluable.dev/vim-advanced/">https://thevaluable.dev/vim-advanced/</a></em></p>]]>
            </description>
            <link>https://thevaluable.dev/vim-advanced/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26284618</guid>
            <pubDate>Sat, 27 Feb 2021 13:06:30 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[$38M USD moved for half a penny]]>
            </title>
            <description>
<![CDATA[
Score 29 | Comments 63 (<a href="https://news.ycombinator.com/item?id=26284143">thread link</a>) | @hggh
<br/>
February 27, 2021 | https://nitter.42l.fr/WhaleAlertBch/status/1365427359264956416 | <a href="https://web.archive.org/web/*/https://nitter.42l.fr/WhaleAlertBch/status/1365427359264956416">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><div>
                        <h2>Transaction c33e23505c95f1cf55e3133d423500686b1c809d3de963ddf4e1257f924b7be2 - Bitcoin Cash (BCH)...</h2>
                        <p>Providing block, transaction, and address data for the BCH and BTC chains.</p>
                        <p><span>explorer.bitcoin.com</span>
                      </p></div></div></div>]]>
            </description>
            <link>https://nitter.42l.fr/WhaleAlertBch/status/1365427359264956416</link>
            <guid isPermaLink="false">hacker-news-small-sites-26284143</guid>
            <pubDate>Sat, 27 Feb 2021 11:26:53 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[The Bupstash Garbage Collector]]>
            </title>
            <description>
<![CDATA[
Score 42 | Comments 10 (<a href="https://news.ycombinator.com/item?id=26282771">thread link</a>) | @andrewchambers
<br/>
February 26, 2021 | https://acha.ninja/blog/the_bupstash_garbage_collector/ | <a href="https://web.archive.org/web/*/https://acha.ninja/blog/the_bupstash_garbage_collector/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
				<h2 id="overview">Overview</h2>
<p>My backup tool <a href="https://github.com/andrewchambers/bupstash">bupstash</a> stores backups in a repository as an evergrowing set of
encrypted data trees which use content addressing and structural sharing
to deduplicate data. In order to delete unused backups we need to do something very similar to how
many programming languages free unreferenced memory - garbage collection. This post will
explain the evolution and implementation of the garbage collector in bupstash for the curious.</p>
<h2 id="stop-mark-and-sweep">Stop, mark and sweep.</h2>
<p>The initial version of the bupstash garbage collector was a naive stop-the-world
garbage collector. It walks all backup data trees creating a set of reachable data chunks
by address and then deletes unreachable data.</p>
<p>The algorithm can be described as:</p>
<ul>
<li>Stop the world.</li>
<li>Mark.</li>
<li>Sweep.</li>
<li>Restart the world.</li>
</ul>
<p>Here is the pseudo code:</p>
<pre><code>lock_repository()
reachable_addresses = empty_set()

for data_tree in all_backups():
  
  work_list = new_work_list_from_backup(data_tree.root_address)
  
  until work_list.is_empty():
    
    node_height, node_address = work_list.pop()
    reachable_addresses.add(node_address)
    
    if node_height != 0:
      add_child_nodes_to_worklist(work_list, node_address)

for chunk_address in repository:
  if not reachable_addresses.has(chunk_address):
    delete_chunk(chunk_address)

unlock_repository()
</code></pre><p>This algorithm is short and sweet, but if the repository is very large our repository becomes unavailable
for a potentially long time. The next version shortens the downtime of the repository significantly.</p>
<h2 id="mark-stop-mark-and-sweep">Mark, stop, mark and sweep.</h2>
<p>The bupstash v0.6.4 garbage collector takes advantage of two facts:</p>
<ul>
<li>Because many backups share data with each other, we can memoize the walk phase to skip work.</li>
<li>Because backups are immutable while the repository is unlocked, we can walk most of them without
stopping the world.</li>
</ul>
<p>This time we walk the repository without the repository locked, then lock it and walk
the repository again using our memoization to quickly complete the job. If any new backups
appeared during our first walk, we are guaranteed to mark them now that the repository lock is held. Doing the majority of the slow mark phase without locking the repository greatly increases
the repository availability for other operations.</p>
<p>The algorithm can be described as:</p>
<ul>
<li>Memoized mark repository.</li>
<li>Stop the world.</li>
<li>Memoized mark repository.</li>
<li>Sweep.</li>
<li>Restart the world.</li>
</ul>
<p>Here is the pseudo code:</p>
<pre><code>walked_trees = empty_set()
reachable_addresses = empty_set()

func walk_repository():

  for data_tree in all_backups():

    if walked_trees.has(data_tree):
      continue

    walked_trees.add(data_tree)
    
    work_list = new_work_list_from_backup(data_tree.root_address)
    
    until work_list.is_empty():
      
      node_height, node_address = work_list.pop()
      already_walked = reachable_addresses.has(node_address)
      reachable_addresses.add(node_address)
      
      if node_height != 0 and not already_walked:
        add_child_nodes_to_worklist(work_list, node_address)

walk_repository()
lock_repository()
walk_repository()

for chunk_address in repository:
  if not reachable_addresses.has(chunk_address):
    delete_chunk(chunk_address)

unlock_repository()
</code></pre><h2 id="mark-stop-mark-bloom-adjust-and-sweep">Mark, stop, mark, bloom adjust, and sweep</h2>
<p>The next version of the garbage collector is a WIP unreleased version.</p>
<p>In bupstash each data chunk address is 32 bytes, which means we need at least 32 bytes of RAM per chunk in the repository to successfully perform a garbage collection. For a repository containing a 100 million chunks or
more this could easily exhaust memory on a busy or small system.</p>
<p>If we are willing to accept a very low probability of retaining some extra data, we can reduce this down
to a few <em>bits</em> per chunk reducing memory usage by 64x or more.
To do this we use a probabilistic data structure called a <a href="https://en.wikipedia.org/wiki/Bloom_filter">bloom filter</a> to track reachable addresses.</p>
<p>Bloom filters have two downsides:</p>
<ul>
<li>They can have false positives. For us this means we might keep a data chunk by accident we could have actually freed.</li>
<li>We must presize them. They cannot grow if we got the size wrong.</li>
</ul>
<p>Luckily for us these downsides are not bad:</p>
<ul>
<li>Because memory use is so low per address, we can generously size our bloom filter reducing false positives to less than one percent, even for large repositories.</li>
<li>We can easily detect when a bloom filter gets overly full and produces many false positives, and thus adjust it‚Äôs size for future garbage collections.</li>
</ul>
<p>As a bonus, the bupstash implementation of a bloom filter is actually simpler than a hash table, with the implemenation
weighing in at around 30 lines of code plus tests and helpers.</p>
<p>The algorithm can be described as:</p>
<ul>
<li>Memoized mark repository.</li>
<li>Stop the world.</li>
<li>Memoized mark the repository.</li>
<li>Adjust bloom filter size.</li>
<li>Sweep.</li>
<li>Restart the world.</li>
</ul>
<p>Here is the pseudo code:</p>
<pre><code>walked_trees = empty_set()
walked_addresses = empty_cache()
reachable_addresses = empty_bloom_filter(repository_bloom_size())

func walk_repository():

  for data_tree in all_backups():

    if walked_trees.has(data_tree):
      continue

    walked_trees.add(data_tree)
    work_list = new_work_list_from_backup(data_tree.root_address)
    
    until work_list.is_empty():
      
      node_height, node_address = work_list.pop()
      already_walked = walked_addresses.has(node_address)
      reachable_addresses.add(node_address)
      walked_addresses.add(node_address)
      
      if node_height != 0 and not already_walked:
        add_child_nodes_to_worklist(work_list, node_address)

walk_repository()
lock_repository()
walk_repository()

if bloom_filter_overutilized(reachable_addresses):
  increase_bloom_filter_size_for_next_gc()
else if bloom_filter_underutilized(reachable_addresses):
  decrease_bloom_filter_size_for_next_gc()

for chunk_address in repository:
  if not reachable_addresses.has(chunk_address):
    delete_chunk(chunk_address)

unlock_repository()
</code></pre><p>One thing to note about this implementation is that because the bloom filter has false positives we can not use it to skip processing addresses, instead
we must introduce a new cache for this purpose. A cache also lets us put a fixed upper bound on memory usage for large repositories.</p>
<p>Overall for large repositories, the addition of a bloom filter reduces ram requirements from the gigabyte range down to tens of megabytes while increasing the repository size by only a fraction of a percent.</p>

<p>The bupstash garbage collector tries hard to keep the repository avaliable as long
as possible while also providing excellent performance with a small memory profile. If you are implementing
a content addressed storage system, this post will hopefully provide you with some new ideas.</p>
<p>In the future bupstash could follow the same path as programming language garbage collectors to find more improvements:</p>
<ul>
<li>Parallelism in the mark phase.</li>
<li>Parallelism in the sweep phase.</li>
<li>Incremental collection.</li>
<li>Object generations.</li>
<li>Write barriers</li>
<li>Yet to be invented techniques‚Ä¶</li>
</ul>
<p>As always, thanks for reading and please feel free to give <a href="https://github.com/andrewchambers/bupstash">bupstash</a> a try.</p>

			</div></div>]]>
            </description>
            <link>https://acha.ninja/blog/the_bupstash_garbage_collector/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26282771</guid>
            <pubDate>Sat, 27 Feb 2021 04:59:53 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Do farmers have the right to repair their own equipment?]]>
            </title>
            <description>
<![CDATA[
Score 52 | Comments 39 (<a href="https://news.ycombinator.com/item?id=26282642">thread link</a>) | @curmudgeon22
<br/>
February 26, 2021 | https://www.albertafarmexpress.ca/news/do-farmers-have-the-right-to-repair-their-own-equipment/ | <a href="https://web.archive.org/web/*/https://www.albertafarmexpress.ca/news/do-farmers-have-the-right-to-repair-their-own-equipment/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div>
<div>
<p><span><span>Reading Time: </span> <span>5</span> <span>minutes</span></span></p><p>It‚Äôs a story that‚Äôs becoming more and more common.</p>
<p>You‚Äôre smack dab in the middle of harvest and an error code appears on your combine‚Äôs monitor. A call to the dealership results in a long wait for a technician to come out, with anxiety rising with every passing hour because priceless harvesting time is being lost or, worse, nasty weather is moving in.</p>
<p>Then when the technician gets to your farm, he determines what is needed is to reset (or ‚Äòflash‚Äô) the onboard computer.</p>
<p>That happened to Cole Siegle last fall when he was harvesting canola, leaving the Fairview-area producer to wonder why he can‚Äôt have access to the same diagnostic tools.</p>
<div id="attachment_133445"><p><img loading="lazy" src="https://static.albertafarmexpress.ca/wp-content/uploads/2021/02/22120509/repair-rights1-siegle-supplied-150x150.jpg" alt="" width="150" height="150" srcset="https://static.albertafarmexpress.ca/wp-content/uploads/2021/02/22120509/repair-rights1-siegle-supplied-150x150.jpg 150w, https://static.albertafarmexpress.ca/wp-content/uploads/2021/02/22120509/repair-rights1-siegle-supplied.jpg 300w" sizes="(max-width: 150px) 100vw, 150px"></p><p>Cole Siegle.<br><small><i>photo:</i><span> Supplied </span></small></p></div>
<p>‚ÄúIf I could have done that myself or been able to use a mechanic or a technician who‚Äôs closer to me, our downtime could have gone from six hours to two hours,‚Äù he said. ‚ÄúThat four hours could have been the difference between getting&nbsp;a crop off before the snow or not.‚Äù</p>
<p>But these days it‚Äôs dealerships ‚Äî via sales and service agreements with manufacturers ‚Äî that have legal access to these diagnostic tools. So when an error message pops up, farmers and independent mechanics are out in the cold, sometimes literally.</p>

<ul>
<li><strong>Read more: <a href="https://www.albertafarmexpress.ca/news/connectivity-grey-under-new-trade-agreement/">Connectivity ‚Äògrey‚Äô under new trade agreement</a></strong></li>
<li><strong>Read more: <a href="https://www.albertafarmexpress.ca/news/remote-diagnostics-blocked-by-poor-internet-on-farms/">Remote diagnostics blocked by poor internet on farms</a></strong></li>

</ul>
<p>‚ÄúAs a producer I think we need access to these diagnostic tools,‚Äù said Siegle. ‚ÄúIf (manufacturers) want to continue to build equipment like this that‚Äôs fine, but we need access to the laptops with the programs that we can plug into our equipment so we can buy whatever part we need.‚Äù</p>
<p>Equipment manufacturers make a lot of repair information public, including what codes mean, but giving access to proprietary tools raises several issues, said John Schmeiser, CEO of the Western Equipment Dealers Association.</p>
<p>The hardware and software Siegle and other farmers wish to acquire for repair purposes can also be used to modify equipment to the detriment of machinery, warranties, the lawfulness of their operations and even their own safety, he said.</p>
<p>‚ÄúI applaud the manufacturers that put a lot of stuff online&nbsp;like parts, service manuals and operational guides. But it‚Äôs a slippery slope,‚Äù said Schmeiser.</p>
<p>‚ÄúWhen you provide special tools to somebody outside a controlled environment like the manufacturer/dealer&nbsp;relationship, that opens the door for illegal modification. They lose that control when they provide&nbsp;diagnostic or special tools to a third-party retailer with whom they don‚Äôt have the same sales and services agreement.‚Äù</p>
<h2>Repair versus modify</h2>
<p>‚ÄòRight to repair‚Äô is a term being thrown around a lot in ag circles today, but it means different things to different people.</p>
<p>For Siegle and other like-minded producers, it means the right to either repair equipment themselves or hire an unaffiliated local mechanic ‚Äî just as farmers have done throughout the history of mechanized agriculture.</p>
<div id="attachment_133446"><p><img loading="lazy" src="https://static.albertafarmexpress.ca/wp-content/uploads/2021/02/22120516/SchmeiserJohn-150x150.jpg" alt="" width="150" height="150" srcset="https://static.albertafarmexpress.ca/wp-content/uploads/2021/02/22120516/SchmeiserJohn-150x150.jpg 150w, https://static.albertafarmexpress.ca/wp-content/uploads/2021/02/22120516/SchmeiserJohn.jpg 300w" sizes="(max-width: 150px) 100vw, 150px"></p><p>John Schmeiser.<br><small><i>photo:</i><span> Supplied </span></small></p></div>
<p>But Schmeiser argues that farmers‚Äô right to repair is already entrenched in law in many jurisdictions (including Alberta) as long as the owner is using the equipment for its intended purpose and doesn‚Äôt violate manufacturer standards.</p>
<p>The right to repair (R2R) movement (which started in the tech sphere but expanded to other areas, such as ag equipment) is actually a front for promoting the ‚Äòright to modify,‚Äô he said.</p>
<p>Often that means making modifications to bypass environmental controls in order to boost vehicle horsepower.</p>

<p>‚ÄúThere are over 25 states that had R2R bills introduced ‚Äî every one impacting farm equipment has been defeated,‚Äù said Schmeiser. ‚ÄúThey haven‚Äôt passed&nbsp;because as the state representatives were hearing the rationale coming from R2R advocates, they were finding out that what they were really looking for is to modify the equipment in a manner where&nbsp;it can get around emission standards and violate U.S. Environmental Protection Agency laws and regulations.‚Äù</p>
<h2>DEF delete and chipping</h2>
<p>There are two specific actions that concern Schmeiser‚Äôs association (a Missouri-based advocacy group for equipment dealerships with a Canadian headquarters in Calgary).</p>
<p>One is circumventing Diesel Exhaust Fluid (or DEF) emissions systems using grey-market ‚ÄòDEF delete‚Äô kits to boost horsepower on tractors and combines. Another is ‚Äòchipping‚Äô or ‚Äòtuning,‚Äô which usually refers to adding a specific chip to increase horsepower.</p>
<p>Bypassing emissions control systems contravenes the Canadian Environmental Protection Act, leaving producers open to fines, said Schmeiser, adding he was unsure of the Canadian penalties but breaches of similar U.S. laws have produced fines in excess of $300,000.</p>
<p>Part of the problem is that not everyone knows this practice is illegal. Another is it comes with a host of potential risks including damaged equipment, voided warranties, reduced trade-in value, insurance cancellation and even safety, he said.</p>
<p>‚ÄúWe have seen an unusual number of combine fires this (past) year,‚Äù said Schmeiser.</p>
<p>‚ÄúNow, we have had some dry conditions but in some of those cases the combines were running hotter (due to alterations).</p>

<p>‚ÄúThe insurance company will look at it from the standpoint that you have altered your combine away from the manufacturer‚Äôs original standards and you are going to be denied insurance coverage in a situation like that.‚Äù</p>
<p>But Siegle isn‚Äôt convinced.</p>
<p>He said he has no interest in making such modifications to his equipment and suggested it‚Äôs a straw man argument from manufacturing and dealership interests seeking exclusive control over the diagnostic tools.</p>
<p>The kind of modification Siegle is concerned about losing is the legal ability to place, for example, a third-party manufacturer‚Äôs custom header on a John Deere combine. Specifically, he worries about big manufacturers denying third-party companies the codes required for an implement to interact with a tractor or combine.</p>
<p>Schmeiser said this isn‚Äôt considered modification but rather interoperability or connectivity: A third party designing an implement to attach to another manufacturer‚Äôs product. This is a long-standing tradition in the manufacturing and dealership industries that few if anyone has any interest in ceasing, he said (see accompanying story).</p>
<h2>The business aspect</h2>
<p>All of this still does not answer Siegle‚Äôs fundamental question: Why can‚Äôt I ‚Äî or mechanics unaffiliated with specific manufacturers ‚Äî have all the tools required to diagnose and fix a mechanical problem?</p>
<p>In the past it was relatively easy for mechanically minded producers and unaffiliated mechanics to repair machinery because it ran on tried-and-traditional engineering principles. This is still by and large the case, said Schmeiser, adding 95 per cent of equipment issues can still be fixed mechanically.</p>
<p>He said he understands the frustration farmers feel by not having diagnostic tools at their fingertips. But at the same time dealerships have rights as well, especially when one considers the considerable training and expense needed to obtain service contracts with manufacturers.</p>
<p>‚ÄúWhat the farmer is speaking to is the frustration of being down. He wants to get up and running as quickly as possible. We get that,‚Äù said Schmeiser.</p>
<p>‚ÄúBut the moment the manufacturers start providing special tools or diagnostics&nbsp;equipment to businesses that are outside of their dealer contracts, doesn‚Äôt that diminish the value of the contract in the dealer‚Äôs eyes as well?‚Ä¶ So what‚Äôs the incentive for the manufacturer&nbsp;to provide special tools or even service manuals to a third party that would be competing with somebody they have a contractual relationship with&nbsp;(and) who is also making a substantial financial investment to be the representative for the manufacturer?‚Äù</p> </div>
</div></div>]]>
            </description>
            <link>https://www.albertafarmexpress.ca/news/do-farmers-have-the-right-to-repair-their-own-equipment/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26282642</guid>
            <pubDate>Sat, 27 Feb 2021 04:40:58 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[How to Read Assembly Language]]>
            </title>
            <description>
<![CDATA[
Score 6 | Comments 0 (<a href="https://news.ycombinator.com/item?id=26282634">thread link</a>) | @swolchok
<br/>
February 26, 2021 | https://wolchok.org/posts/how-to-read-assembly-language/ | <a href="https://web.archive.org/web/*/https://wolchok.org/posts/how-to-read-assembly-language/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div><div><p>Why, in 2021, does anyone need to learn about assembly language?
First, reading assembly language is the way to know <em>exactly</em> what
your program is doing. Why, <em>exactly</em>, is that C++ program 1 MiB (say)
instead of 100 KiB? Is it possible to squeeze some more performance
out of that function that gets called all the time?</p><p>For C++ in particular, it is easy to forget or just not notice some
operation (e.g., an implicit conversion or a call to a copy
constructor or destructor) that is implied by the source code and
language semantics, but not spelled out explicitly. Looking at the
assembly generated by the compiler puts everything in plain sight.</p><p>Second, the more practical reason: so far, posts on this blog haven‚Äôt
required an understanding of assembly language, despite constant
links to <a href="https://godbolt.org/">Compiler Explorer</a>. By <a href="https://twitter.com/ScottWolchok/status/1361022423399755776">popular
demand</a>,
however, our next topic will be parameter passing, and for that, we
will need a basic understanding of assembly language. We will focus
only on <em>reading</em> assembly language, not writing it.</p><p>The basic unit of assembly language is the <strong>instruction</strong>. Each
machine instruction is a small operation, like adding two numbers,
loading some data from memory, jumping to another memory location
(like the dreaded <a href="https://en.wikipedia.org/wiki/Goto">goto</a>
statement), or calling or returning from a function. (The x86
architecture has <a href="https://en.wikipedia.org/wiki/Complex_instruction_set_computer">lots of not-so-small
instructions</a>
as well. Some of these are <a href="https://stackoverflow.com/questions/5959890/enter-vs-push-ebp-mov-ebp-esp-sub-esp-imm-and-leave-vs-mov-esp-ebp">legacy
cruft</a>
built up over the 40-odd years of the architecture‚Äôs existence, and
others are <a href="https://en.wikipedia.org/wiki/Advanced_Vector_Extensions">newfangled
additions</a>. )</p><p>Our first toy example will get us acquainted with simple
instructions. It just calculates the square of the
<a href="https://en.wikipedia.org/wiki/Norm_(mathematics)#Euclidean_norm">norm</a>
of a 2D vector:</p><div><pre><code data-lang="c++"><span>#include</span> <span>&lt;cstdint&gt;</span><span>
</span><span></span>
<span>struct</span> <span>Vec2</span> {
    <span>int64_t</span> x;
    <span>int64_t</span> y;
};

<span>int64_t</span> <span>normSquared</span>(Vec2 v) {
    <span>return</span> v.x <span>*</span> v.x <span>+</span> v.y <span>*</span> v.y;
}
</code></pre></div><p>and here is the resulting x86_64 assembly from clang 11, <a href="https://godbolt.org/#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAM1QDsCBlZAQwBtMQBGAFlICsupVs1qhkAUgBMAISnTSAZ0ztkBPHUqZa6AMKpWAVwC2tQVvQAZPLUwA5YwCNMxEADZSAB1QLC62nsMTQS8fNTorG3sjJxd3JRUw2gYCZmICAONTTkVlTFU/ZNSCCLtHZzdFFLSMoOyFKuLrUujy1wBKRVQDYmQOAHIpAGZrZEMsAGpxQZ1kevx6KexxAAYAQRXV%2BuIDVXGANTzJSYB2WTXxi/HrAlduAH0CcYAPKbPVy6v6W4fxgE9XjbiY4AEQBaw212%2Bj1oJCMDAAjgZUph0BADsgjgA3NonN4fYiYAjdWjjTEAOie4wAVKSKZMZLTftTGWD1iC%2Bh1WCA%2BgBWPqkUx9Zb81DcnRyOTjBRdHqYemDTj8gjc4VtDoAaxAg0GZO1ev1BvcXL63H5guFpFFfX5ChAy1IyqFHNIcFgSDQRg8eHYZAoEA9Xp9KGEok4nGW2So3oIzltEAcKv5DmsqV%2B3MVpA9Ri0BAA8rRWGmnaQsEYRMB2ImS3gCflMZhbcXME88gYY%2Bn%2BddlB2hHgHMRU3osD2CMQ8EYOx0aPQmGwODx%2BIIQ2IJTJew5bZAOqgPIlGwBaXODcb7uZTYESGRySQW%2BJ5RKabQ1LKkcwlKIxYLeXx0Z9f0J%2BO%2BZQuHUuT5HQhTVPomSCHe4FJA0QEtCBlRFH%2BdSIU0H7lJwHTSt0vRcJy3J8gKVZWk8AAcrj7rc4yjOW4xhmSyxkpw4wQLghAkPK2TjHonres4vE4uKV4yEqiZqqQmrarqBoKdqRrcqaZHFlaNp2g6UkujAiAoKggk%2BuQlABkJLgMaG4aRtGsaUAmxbJrQqY9lmOb5oWValuWlbFvgtZqPWjYWs2rbtn0GZdsaFqsH2A7EL8Q79Bao7jpOpDTowLCVguAiSEI5YoKu8ixRu8DbrufgHkeJ5noMF7FTeNpgQ%2BEDmOhr7aEhn7ZCEP7%2BNBtSeN%2BiTdThOQJAUDQdXBiSQY0kTAbB02DS%2B9RFGNIF4TKhG4UIJFmuR3JUTRdGWcATGcCxbEcVxRDELxpD8YZgbCUMkiicVklOtJsk6opin7Sah3qdymn2o6qrEX0kggxaGnaT9HT1sQPgaNwQA%3D%3D">via Compiler Explorer</a>:<sup id="fnref:1"><a href="#fn:1" role="doc-noteref">1</a></sup></p><div><pre><code data-lang="asm">        <span>imulq</span>   %rdi, %rdi
        <span>imulq</span>   %rsi, %rsi
        <span>leaq</span>    (%rsi,%rdi), %rax
        <span>retq</span>
</code></pre></div><p>Let‚Äôs talk about that first instruction: <code>imulq %rdi, %rdi</code>. This
instruction <a href="https://www.felixcloutier.com/x86/imul">performs signed integer
multiplication</a>. The <code>q</code>
suffix tells us that it is operating on 64-bit quantities. (In
contrast, <code>l</code>, <code>w</code>, and <code>b</code> would denote 32-bit, 16-bit, and 8-bit,
respectively.) It multiplies the value in the first given register
(<code>rdi</code>; register names are prefixed with a <code>%</code> sign) by the value in
the second register and stores the result in that second
register. This is squaring <code>v.x</code> in our example C++ code.</p><p>The second instruction does the same with the value in <code>%rsi</code>, which
squares <code>v.y</code>.</p><p>Next, we have an odd instruction: <code>leaq (%rsi,%rdi), %rax</code>. <code>lea</code>
stands for ‚Äúload effective address‚Äù, and it stores the address of the
first operand into the second operand. <code>(%rsi, %rdi)</code> means ‚Äúthe
memory location pointed to by <code>%rsi + %rdi</code>‚Äù, so this is just adding
<code>%rsi</code> and <code>%rdi</code> and storing the result in <code>%rax</code>. <code>lea</code> is a quirky
x86-specific instruction; on a more
<a href="https://en.wikipedia.org/wiki/Reduced_instruction_set_computer">RISC</a>-y
architecture like ARM64, we would expect to see a plain old <code>add</code>
instruction.<sup id="fnref:2"><a href="#fn:2" role="doc-noteref">2</a></sup></p><p>Finally, <code>retq</code> returns from the <code>normSquared</code> function.</p><p>Let‚Äôs take a brief detour to explain what the registers we saw in our
example are. Registers are the ‚Äúvariables‚Äù of assembly
langauge. Unlike your favorite programming language (probably), there
are a finite number of them, they have standardized names, and the
ones we‚Äôll be talking about are at most 64 bits in size. Some of them
have specific uses that we‚Äôll see later. I wouldn‚Äôt be able to rattle
this off from memory, but <a href="https://en.wikipedia.org/wiki/X86-64#Architectural_features">per
Wikipedia</a>,
the full list<sup id="fnref:3"><a href="#fn:3" role="doc-noteref">3</a></sup> of 16 registers on x86_64 is <code>rax</code>, <code>rcx</code>, <code>rdx</code>, <code>rbx</code>,
<code>rsp</code>, <code>rbp</code>, <code>rsi</code>, <code>rdi</code>, <code>r8</code>, <code>r9</code>, <code>r10</code>, <code>r11</code>, <code>r12</code>, <code>r13</code>,
<code>r14</code>, and <code>r15</code>.</p><p>Now, let‚Äôs extend our example to debug print the <code>Vec2</code> in <code>normSquared</code>:</p><div><pre><code data-lang="c++"><span>#include</span> <span>&lt;cstdint&gt;</span><span>
</span><span></span>
<span>struct</span> <span>Vec2</span> {
    <span>int64_t</span> x;
    <span>int64_t</span> y;
<span>    <span>void</span> <span>debugPrint</span>() <span>const</span>;
</span>};

<span>int64_t</span> <span>normSquared</span>(Vec2 v) {
<span>    v.debugPrint();
</span>    <span>return</span> v.x <span>*</span> v.x <span>+</span> v.y <span>*</span> v.y;
}
</code></pre></div><p>and, again, let‚Äôs see <a href="https://godbolt.org/#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAM1QDsCBlZAQwBtMQBGAFlICsupVs1qhkAUgBMAISnTSAZ0ztkBPHUqZa6AMKpWAVwC2tEJICcpLegAyeWpgByxgEaZiIAGykADqgWE6rR6hiaCfgFqdHYOzkZuHt5KKlG0DATMxAQhxqYWisqYqkHpmQQxTq7uXooZWTlhnLVlFXEJXgCUiqgGxMgcAORSAMz2yIZYANTiwzrICgT49DPY4gAMAILrGwvEBqqTAGpFktMA7LKbk9eT9gSe3AD6BJMAHjOXGze39A/PkwBPD7bb4AN1QeHQkywLgMwAACsQ7hAOpM0LQFsDNuIzgARLFbTZ3P4vWgkIwMACOBkymHQEGOyFOoNROM%2BYIAdDC4YjkR0Cd9iJgCL1aJNQRzXpMAFTiyXTGRygEypUEnG4gZdVggAYAVgGpFMAzWBtQOp0cjkkwUPT6mAVw04BoIOpNHS6AGsQMNhhyff6A4HvNqBtwDUaTaQzQMDQoQGtSC7jZrSHBYEg0EYfHh2GQKBBM9ncyhhKJOJw1k0qDmCO44xAXK6DS57JkATqnaRM0YtAQAPK0Vjt5OkLBGETAdhN0d4IXFUGYOMjzCvIoGWsdg13ZSboR4FzENt6LC7ghIoybro0ehMNgcHj8QSlsSWmR7lxxyBdVA%2BVJLgC0fbDJM/4LOgMy4hIMhyJIkbJEUqSaNoDSmE01itFUHhNBEgR0Ch4T%2BLhtAYfE1RNPBxR0KU9T6LkggUak1HlPYlSkVhzQ0aEqEccxsSYVwXQ2r0/QCUIOr6oa07Rq8AAcnj/g8aLPpM5YcmsHKcJMEC4IQJAOk0kx6FmObuPpqIWtBMjOk27qkF6Pp%2BoGTk%2BsGOphpJI7RrG8aJjZqYwIgKCoMZubkJQhYmR44wTuWlakNWrC1sQ9aNiOLa0G2u7dr2A5DtOY4TlOI74HOagLkukYrmuG4DJ224hpGrD7oexAAsegyRmeeAXrVKbXowLBTg%2BAiSEIE4oK%2B8hNR%2B8Dfr%2BQQAUBIFgRBUGyDIsGxoUlGmBA1j4Zwo3oSxbRkcMviEakB2jThqQke0nDnQxJR1NktGNKNz1Ua991nTx108b9WHDIJtoiZwWrieGUk6rJ8mKdFogqZwakaVpOlEMQ%2BmkIZwVFqZIySOZk3Wcmtn2b6znOWJobQ55OreQmSZupDAySHTkZeb5ZNdAuyVBCA3BAA">the generated assembly</a>:</p><div><pre><code data-lang="asm">        <span>subq</span>    <span>$24</span>, %rsp
        <span>movq</span>    %rdi, <span>8</span>(%rsp)
        <span>movq</span>    %rsi, <span>16</span>(%rsp)
        <span>leaq</span>    <span>8</span>(%rsp), %rdi
        <span>callq</span>   <span>Vec2</span>::<span>debugPrint</span>() <span>const</span>
        <span>movq</span>    <span>8</span>(%rsp), %rcx
        <span>movq</span>    <span>16</span>(%rsp), %rax
        <span>imulq</span>   %rcx, %rcx
        <span>imulq</span>   %rax, %rax
        <span>addq</span>    %rcx, %rax
        <span>addq</span>    <span>$24</span>, %rsp
        <span>retq</span>
</code></pre></div><p>In addition to the obvious call to <code>Vec2::debugPrint() const</code>, we have
some other new instructions and registers! <code>%rsp</code> is special: it is
the ‚Äústack pointer‚Äù, used to maintain the <a href="https://en.wikipedia.org/wiki/Call_stack">function call
stack</a>. It points to the
bottom of the stack, which grows ‚Äúdown‚Äù (toward lower addresses) on
x86. So, our <code>subq $24, %rsp</code> instruction is making space for three
64-bit integers on the stack. (In general, setting up the stack and
registers at the start of your function is called the <a href="https://en.wikipedia.org/wiki/Function_prologue">function
prologue</a>.) Then, the
following two <code>mov</code> instructions store the first and second arguments
to <code>normSquared</code>, which are <code>v.x</code> and <code>v.y</code> (more about how parameter
passing words in the next blog post!) to the stack, effectively
creating a copy of <code>v</code> in memory at the address <code>%rsp + 8</code>. Next, we
load the address of our copy of <code>v</code> into <code>%rdi</code> with <code>leaq 8(%rsp), %rdi</code> and then call <code>Vec2::debugPrint() const</code>.</p><p>After <code>debugPrint</code> has returned, we load <code>v.x</code> and <code>v.y</code> back into
<code>%rcx</code> and <code>%rax</code>. We have the same <code>imulq</code> and <code>addq</code> instructions as
before. Finally, we <code>addq $24, %rsp</code> to clean up the 24
bytes<sup id="fnref:4"><a href="#fn:4" role="doc-noteref">4</a></sup> of stack space we allocated at the start of
our function (called the <a href="https://en.wikipedia.org/wiki/Function_prologue#Epilogue">function
epilogue</a>),
and then return to our caller with <code>retq</code>.</p><p>Now, let‚Äôs look at a different example. Suppose that we want to print
an uppercased C string and we‚Äôd like to avoid heap allocations for
smallish strings.<sup id="fnref:5"><a href="#fn:5" role="doc-noteref">5</a></sup> We might write something like
the following:</p><div><pre><code data-lang="c++"><span>#include</span> <span>&lt;cstdio&gt;</span><span>
</span><span>#include</span> <span>&lt;cstring&gt;</span><span>
</span><span>#include</span> <span>&lt;memory&gt;</span><span>
</span><span></span>
<span>void</span> <span>copyUppercase</span>(<span>char</span> <span>*</span>dest, <span>const</span> <span>char</span> <span>*</span>src);

<span>constexpr</span> size_t MAX_STACK_ARRAY_SIZE <span>=</span> <span>1024</span>;

<span>void</span> <span>printUpperCase</span>(<span>const</span> <span>char</span> <span>*</span>s) {
    <span>auto</span> sSize <span>=</span> strlen(s);
    <span>if</span> (sSize <span>&lt;=</span> MAX_STACK_ARRAY_SIZE) {
        <span>char</span> temp[sSize <span>+</span> <span>1</span>];
        copyUppercase(temp, s);
        puts(temp);
    } <span>else</span> {
        <span>// std::make_unique_for_overwrite is missing on Godbolt.
</span><span></span>        std<span>::</span>unique_ptr<span>&lt;</span><span>char</span>[]<span>&gt;</span> temp(<span>new</span> <span>char</span>[sSize <span>+</span> <span>1</span>]);
        copyUppercase(temp.get(), s);
        puts(temp.get());
    }
}
</code></pre></div><p>Here is <a href="https://godbolt.org/#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAM1QDsCBlZAQwBtMQBGAFlICsupVs1qhkAUgBMAISnTSAZ0ztkBPHUqZa6AMKpWAVwC2tEAHZeW9ABk8tTADljAI0zEuANlIAHVAsLqtHqGJua8vv5qdLb2Tkau7pxeSipRtAwEzMQEwcamForKmKqBGVkEMY4ubp6Kmdm5oQUK9RV2VfE1SQCUiqgGxMgcAORSAMx2yIZYANTiYzrILfio89jiAAwAguOT05hzC0sExHbAa5s7khO0Uwaz8zpGmEYkAJ4X25cAbqh46DM0N43gBVbzeNwsJQQZAILIzABUWBapEBdBagLhxERCkG3Xmsi%2B2zQtBamAAHt5sf4AF6YAD6BBmAFktgANekMAAqWx0AGl6VsAEpCrYATU5AEkAFrYQ4AERmnA2km4BMuPz%2BAKpdgIYIhxB0zGhJIxsPhCIU3TmZkJWxmDpmzAMRBmCgYeDpCrdJ3YtAgVvV20dMzwVBmAY9Xse80VrI53N5AuFoolDBl2Gt4ltlxDIfN2IIL284gArNJ3Z6DnIlWX5UH7XmHUDQeDIcbMBAi0ZvKjA2M7U2Hd4XQou8X8QPc47s4rlEobYOhwB6Zc%2B9AgEBGZgAawZBloeAAjgYGTRiPTUN83AB3U5F0MKGZGPAKfyiGZ0GZ6Ht4djY7BKVYEg3AAOmnJtlk3A9j1PelvBOR4CzLWRS3rMY5W7bwIHsG9MSyFDK2jGRazQyclybFt9XbaEsNA4BMAICBejdciILzEcCDHOiGKY7o2ODGczHrL5hOGXpWBAYZS2GUhTGGDZZNQKSdDkGsFH6QZq2uThZIIKTFP40gdxAbgxlAsZlTGABOMxS1LMZSySAAOSQhCk7hZPkxTSGU4ZZIUEANlIfSFPE0g4FgJA0F/f9yEoGLvD/GophEYBOGVThSCoP8i2IQKIGcAzZOcOwsjeKTdNIGLnnoAB5WhWAqsLSCwbdRHYYrWrwYhijUa9ApailihdEYqt1ZRKtk1g8GcYhyr0LAppC04jCm3oaHoJg2A4Hh%2BEEYRRBQNSZCEWbAsgXpUAQwJBoAWjqsYZju5ZYwkGQ5EkDZnqoWhUDu69VBIKsfr%2Bu6D2IfRWDu4DrqfO7fv%2Bikhhu9EAqKEoNAgKxGlMLKrEqOIEkECIAjoXGSb8MnaEJ6pEkKVJSlaCmspSPqmfKWnOnplpyhZupOfaImul6DSBiGLgJKkmS5K6vzyWcjw7o8bhAUO4AlU4UCNlAzgI1wQgSDmHTUR/JL/2NyzrVUj6ZD04qjJMsZzMkUszNLMxrI2MxnIc653OGTzZZavyAqCkKHYimBEBQVBYrceKYTj82UvVjKNiynLWDygqipa0raHK5aaq0AgGqarq2rSzqWvwXqSgGrrhuQUblomySWpmuaFowEYfJOPA1uGXSNroRgWE6vaBDc9Xjtt%2BQu4u5jfNR0kpIep6XoIdA3pO6QvtB/7AaIU4vQRsGIahmHUDhw%2B7uRzBV4UdHGaxnH9DyQQCaFunKciQJ%2BakzSFzYmrMMZpDKA0D%2BoQwGv3SK0EBXQBZQJCHjZBbRYi/04KLTSEtsEBxlt5JSUkFZKxVmrNKmtta631vgE%2BlssrfmTslbE4xJDWz3vbMKjsQDXFAu7VU3AHKK0kNZaypYZ4eS8nLKSYdgqhUMlLYYkhpEh1kRHbhvRrz5UCKZIAA%3D">the generated assembly</a>:<sup id="fnref:6"><a href="#fn:6" role="doc-noteref">6</a></sup></p><div><pre><code data-lang="asm"><span>printUpperCase</span>(<span>char</span> <span>const</span>*):                  <span># @printUpperCase(char const*)
</span><span></span>        <span>pushq</span>   %rbp
        <span>movq</span>    %rsp, %rbp
        <span>pushq</span>   %r15
        <span>pushq</span>   %r14
        <span>pushq</span>   %rbx
        <span>pushq</span>   %rax
        <span>movq</span>    %rdi, %r14
        <span>callq</span>   <span>strlen</span>
        <span>leaq</span>    <span>1</span>(%rax), %rdi
        <span>cmpq</span>    <span>$1024</span>, %rax                     <span># imm = 0x400
</span><span></span>        <span>ja</span>      <span>.LBB0_2</span>
        <span>movq</span>    %rsp, %r15
        <span>movq</span>    %rsp, %rbx
        <span>addq</span>    <span>$15</span>, %rdi
        <span>andq</span>    <span>$-16</span>, %rdi
        <span>subq</span>    %rdi, %rbx
        <span>movq</span>    %rbx, %rsp
        <span>movq</span>    %rbx, %rdi
        <span>movq</span>    %r14, %rsi
        <span>callq</span>   <span>copyUppercase</span>(<span>char</span>*, <span>char</span> <span>const</span>*)
        <span>movq</span>    %rbx, %rdi
        <span>callq</span>   <span>puts</span>
        <span>movq</span>    %r15, %rsp
        <span>leaq</span>    -<span>24</span>(%rbp), %rsp
        <span>popq</span>    %rbx
        <span>popq</span>    %r14
        <span>popq</span>    %r15
        <span>popq</span>    %rbp
        <span>retq</span>
.LBB0_2:
        <span>callq</span>   <span>operator</span> <span>new</span>[](<span>unsigned</span> <span>long</span>)
        <span>movq</span>    %rax, %rbx
        <span>movq</span>    %rax, %rdi
        <span>movq</span>    %r14, %rsi
        <span>callq</span>   <span>copyUppercase</span>(<span>char</span>*, <span>char</span> <span>const</span>*)
        <span>movq</span>    %rbx, %rdi
        <span>callq</span>   <span>puts</span>
        <span>movq</span>    %rbx, %rdi
        <span>leaq</span>    -<span>24</span>(%rbp), %rsp
        <span>popq</span>    %rbx
        <span>popq</span>    %r14
        <span>popq</span>    %r15
        <span>popq</span>    %rbp
        <span>jmp</span>     <span>operator</span> <span>delete</span>[](<span>void</span>*)                          <span># TAILCALL
</span></code></pre></div><p>Our function prologue has gotten a lot longer, and we have some new
control flow instructions as well. Let‚Äôs take a closer look at the
prologue:</p><div><pre><code data-lang="asm">        <span>pushq</span>   %rbp
        <span>movq</span>    %rsp, %rbp
        <span>pushq</span>   %r15
        <span>pushq</span>   %r14
        <span>pushq</span>   %rbx
        <span>pushq</span>   %rax
        <span>movq</span>    %rdi, %r14
</code></pre></div><p>The <code>pushq %rbp; movq %rsp, %rbp</code> sequence is very common: it pushes
the <a href="https://en.wikipedia.org/wiki/Call_stack#FRAME-POINTER">frame
pointer</a>
stored in <code>%rbp</code> to the stack and saves the old stack pointer
(which is the new frame pointer) in <code>%rbp</code>. The following four
<code>pushq</code> instructions store registers that <a href="https://en.wikipedia.org/wiki/X86_calling_conventions#System_V_AMD64_ABI">we need to save before
using</a>.<sup id="fnref:7"><a href="#fn:7" role="doc-noteref">7</a></sup>
Finally, we save our first argument (<code>%rdi</code>) in <code>%r14</code>.</p><p>On to the function body. We call <code>strlen(s)</code> with <code>callq strlen</code> and
store <code>sSize + 1</code> in <code>%rdi</code> with <code>lea 1(%rax), %rdi</code>.</p><p>Next, we finally see our first <code>if</code> statement! <code>cmpq $1024, %rax</code> sets
the <a href="https://en.wikipedia.org/wiki/FLAGS_register">flags register</a>
according to the result of <code>%rax - $1024</code>, and then <code>ja .LBB0_2</code>
(‚Äújump if above‚Äù) transfers control to the location labeled <code>.LBB0_2</code>
if the flags indicate that <code>%rax &gt; 1024</code>. In general, higher-level
control-flow primitives like <code>if</code>/<code>else</code> statements and loops are
implemented in assembly using conditional jump instructions.</p><p>Let‚Äôs first look at the path where <code>%rax &lt;= 1024</code> and thus the branch
to <code>.LBB0_2</code> was not taken. We have a blob of instructions to create
<code>char temp[sSize + 1]</code> on the stack:</p><div><pre><code data-lang="asm">        <span>movq</span>    %rsp, %r15
        <span>movq</span>    %rsp, %rbx
        <span>addq</span>    <span>$15</span>, %rdi
        <span>andq</span>    <span>$-16</span>, %rdi
        <span>subq</span>    %rdi, %rbx
        <span>movq</span>    %rbx, %rsp
</code></pre></div><p>We save <code>%rsp</code> to <code>%r15</code> and <code>%rbx</code> for later
use.<sup id="fnref:8"><a href="#fn:8" role="doc-noteref">8</a></sup> Then, we add 15 to <code>%rdi</code> (which,
remember, contains the size of our array), mask off the lower 4 bits
with <code>andq $-16, %rdi</code>, and subtract the result from <code>%rbx</code>, which we
then put back into <code>%rsp</code>. In short, this rounds the array size up to
the next multiple of 16 bytes and makes space for it on the stack.</p><p>The following block simply calls <code>copyUppercase</code> and <code>puts</code> as written in the code:</p><div><pre><code data-lang="asm">        <span>movq</span>    %rbx, %rdi
        <span>movq</span>    %r14, %rsi
        <span>callq</span>   <span>copyUppercase</span>(<span>char</span>*, <span>char</span> <span>const</span>*)
        <span>movq</span>    %rbx, %rdi
        <span>callq</span>   <span>puts</span>
</code></pre></div><p>Finally, we have our function epilogue:</p><div><pre><code data-lang="asm">        <span>movq</span>    %r15, %rsp
        <span>leaq</span>    -<span>24</span>(%rbp), %rsp
        <span>popq</span>    %rbx
        <span>popq</span>    %r14
        <span>popq</span>    %r15
        <span>popq</span>    %rbp
        <span>retq</span>
</code></pre></div><p>We restore the stack pointer to deallocate our variable-length array
using <code>leaq</code>. Then, we <code>popq</code> the registers we saved during the
function prologue and return control to our caller, and we are done.</p><p>Next, let‚Äôs look at the path when <code>%rax &gt; 1024</code> and we branch to
<code>.LBB0_2</code>. This path is more ‚Ä¶</p></div></div></div>
<br/><p><em>Article truncated for RSS feed. Read the full article at <a href="https://wolchok.org/posts/how-to-read-assembly-language/">https://wolchok.org/posts/how-to-read-assembly-language/</a></em></p>]]>
            </description>
            <link>https://wolchok.org/posts/how-to-read-assembly-language/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26282634</guid>
            <pubDate>Sat, 27 Feb 2021 04:40:32 GMT</pubDate>
        </item>
        <item>
            <title>
<![CDATA[Mining Ethereum on M1 Mac GPU]]>
            </title>
            <description>
<![CDATA[
Score 152 | Comments 125 (<a href="https://news.ycombinator.com/item?id=26281864">thread link</a>) | @gyf304
<br/>
February 26, 2021 | https://blog.yifangu.com/2021/02/26/mining-ethereum-on-a-m1-mac-gpu/ | <a href="https://web.archive.org/web/*/https://blog.yifangu.com/2021/02/26/mining-ethereum-on-a-m1-mac-gpu/">archive.org</a>
<br/><!-- hnss:readable-content --><hr/><div id="readability-page-1" class="page"><div id="content">

	<section id="primary">
		<main id="main">

			
<article id="post-444">

	

	
	<div>
		
<p>TL;DR: It‚Äôs possible to mine Ethereum on a M1 Mac GPU. Hashrate is about 2Mh/s.</p>



<figure><img data-attachment-id="452" data-permalink="https://blog.yifangu.com/image-1-5/" data-orig-file="https://yifangucom.files.wordpress.com/2021/02/image-1.png" data-orig-size="1338,754" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="image-1" data-image-description="" data-medium-file="https://yifangucom.files.wordpress.com/2021/02/image-1.png?w=300" data-large-file="https://yifangucom.files.wordpress.com/2021/02/image-1.png?w=750" src="https://yifangucom.files.wordpress.com/2021/02/image-1.png?w=1024" alt="" srcset="https://yifangucom.files.wordpress.com/2021/02/image-1.png?w=1024 1024w, https://yifangucom.files.wordpress.com/2021/02/image-1.png?w=150 150w, https://yifangucom.files.wordpress.com/2021/02/image-1.png?w=300 300w, https://yifangucom.files.wordpress.com/2021/02/image-1.png?w=768 768w, https://yifangucom.files.wordpress.com/2021/02/image-1.png 1338w" sizes="(max-width: 1024px) 100vw, 1024px"><figcaption>Mining on a M1 Mac</figcaption></figure>



<p>I‚Äôve had my M1 MacBook Air for a bit of time now, and I also recently started mining Ethereum. I can‚Äôt help asking myself: What‚Äôs Ethereum mining performance like on a M1 Mac?</p>



<p>The obvious thing to do first is to run the off-the-shelf <code>ethminer</code>, which gives the following error:</p>



<pre><code>ethminer 0.19.0-alpha.0
Build: darwin/release/appleclang

Unrecognized platform Apple
Error: No usable mining devices found</code></pre>



<p>Not good. Apparently Apple GPUs are not whitelisted in ethminer. That should be easy to fix. Relevant lines are in <code>libethash-cl/CLMiner.cpp</code>, and I added Apple GPUs to the whitelist, pretending it‚Äôs an Intel GPU.</p>



<p>Then <code>boost</code> won‚Äôt compile since it‚Äôs trying to compile with a <code>-fcoalesce-templates</code> argument, which doesn‚Äôt exist in recent clang versions. So I have to update <code>boost</code> to the latest version, and fix relevant <code>asio</code> code since <code>ethminer</code> was using deprecated <code>asio</code> APIs.</p>



<p>I also need to upgrade OpenSSL to the latest version to have it support darwin + arm64.</p>



<p>After getting everything to compile. Here‚Äôs the result:</p>



<pre><code>ethminer 0.19.0-17+commit.ce52c740.dirty
Build: darwin/release/appleclang

 i 19:51:36          Configured pool eth-us-east1.nanopool.org:9999
 i 19:51:36          Selected pool eth-us-east1.nanopool.org:9999
 i 19:51:36          Connection remotely closed by eth-us-east1.nanopool.org
 i 19:51:36          Stratum mode : EthereumStratum/1.0.0 (NiceHash)
 i 19:51:36          Established connection to eth-us-east1.nanopool.org [144.217.14.139:9999]
 i 19:51:36          Spinning up miners...
cl 19:51:36 cl-0     Using Device : Intel GPU 0.0 Apple M1 OpenCL 1.2  Memory : 10.67 GB (11453251584 B)
 i 19:51:36          Extranonce set to 778d
 i 19:51:36          Extranonce set to 778d
 i 19:51:36          Authorized worker [REDACTED]
 i 19:51:36          Epoch : 397 Difficulty : 10.00 Gh
 i 19:51:36          Job: c7fc5311‚Ä¶ eth-us-east1.nanopool.org [144.217.14.139:9999]
cl 19:51:38 cl-0     Generating split DAG + Light (total): 4.10 GB
 i 19:51:38          Job: 40a57756‚Ä¶ eth-us-east1.nanopool.org [144.217.14.139:9999]
cl 19:51:38 cl-0     OpenCL kernel
cl 19:51:38 cl-0     Creating DAG buffer, size: 4.10 GB, free: 6.57 GB
cl 19:51:38 cl-0     Creating light cache buffer, size: 65.62 MB
cl 19:51:38 cl-0     Loading kernels
cl 19:51:38 cl-0     Creating buffer for header.
cl 19:51:38 cl-0     Creating mining buffer
 m 19:51:41          0:00 A0 0.00 h - cl0 0.00
 i 19:51:42          Job: 077b62f6‚Ä¶ eth-us-east1.nanopool.org [144.217.14.139:9999]
 m 19:51:46          0:00 A0 0.00 h - cl0 0.00
 i 19:51:46          Job: 2835839e‚Ä¶ eth-us-east1.nanopool.org [144.217.14.139:9999]
 m 19:51:51          0:00 A0 0.00 h - cl0 0.00
 m 19:51:56          0:00 A0 0.00 h - cl0 0.00
 i 19:51:57          Job: 97f724e7‚Ä¶ eth-us-east1.nanopool.org [144.217.14.139:9999]
 m 19:52:01          0:00 A0 0.00 h - cl0 0.00
 m 19:52:06          0:00 A0 0.00 h - cl0 0.00
 m 19:52:11          0:00 A0 0.00 h - cl0 0.00
 m 19:52:16          0:00 A0 0.00 h - cl0 0.00
 i 19:52:16          Job: 54df0504‚Ä¶ eth-us-east1.nanopool.org [144.217.14.139:9999]
 m 19:52:21          0:00 A0 0.00 h - cl0 0.00
cl 19:52:22 cl-0     4.10 GB of DAG data generated in 44,060 ms.
 m 19:52:26          0:00 A0 184.16 Kh - cl0 184.16
 m 19:52:31          0:00 A0 1.96 Mh - cl0 1.96
 m 19:52:36          0:01 A0 1.98 Mh - cl0 1.98
 i 19:52:39          Job: d3b1da5e‚Ä¶ eth-us-east1.nanopool.org [144.217.14.139:9999]
 m 19:52:41          0:01 A0 1.99 Mh - cl0 1.99
cl 19:52:43 cl-0     Job: 54df0504‚Ä¶ Sol: 0x778d000001d14c71
 i 19:52:43          **Accepted 150 ms. eth-us-east1.nanopool.org [144.217.14.139:9999]
 m 19:52:46          0:01 A1 1.95 Mh - cl0 1.95
 m 19:52:51          0:01 A1 2.07 Mh - cl0 2.07
 m 19:52:56          0:01 A1 2.00 Mh - cl0 2.00
 m 19:53:01          0:01 A1 1.98 Mh - cl0 1.98
 i 19:53:01          Job: ccc2b97f‚Ä¶ eth-us-east1.nanopool.org [144.217.14.139:9999]
 m 19:53:06          0:01 A1 1.97 Mh - cl0 1.97
 i 19:53:07          Job: 23919d82‚Ä¶ eth-us-east1.nanopool.org [144.217.14.139:9999]
^C i 19:53:10 main     Got interrupt ...
 i 19:53:10 main     Disconnected from eth-us-east1.nanopool.org [144.217.14.139:9999]
 i 19:53:10 main     Shutting down miners...
 i 19:53:16 main     Terminated!</code></pre>



<p>Code is available at <a rel="noreferrer noopener" href="https://github.com/gyf304/ethminer-m1" target="_blank">https://github.com/gyf304/ethminer-m1</a></p>



<h2>Is it worth it?</h2>



<p>Um. Not really. At current Ethereum prices (2021-02-26), it generates $0.14 of profit per day. It‚Äôs still a profit, but very miniscule.</p>
	</div><!-- .entry-content -->

	<!-- .entry-footer -->

			<!-- .author-bio -->
	
</article><!-- #post-${ID} -->

	<nav role="navigation" aria-label="Posts">
		<h2>Post navigation</h2>
		
	</nav>
<!-- #comments -->

		</main><!-- #main -->
	</section><!-- #primary -->


	</div></div>]]>
            </description>
            <link>https://blog.yifangu.com/2021/02/26/mining-ethereum-on-a-m1-mac-gpu/</link>
            <guid isPermaLink="false">hacker-news-small-sites-26281864</guid>
            <pubDate>Sat, 27 Feb 2021 01:32:56 GMT</pubDate>
        </item>
    </channel>
</rss>
